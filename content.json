{"meta":{"title":"fyupeng","subtitle":"","description":"","author":"fyupeng","url":"http://fyupeng.github.io","root":"/"},"pages":[{"title":"404 Not Foundï¼šè¯¥é¡µæ— æ³•æ˜¾ç¤º","date":"2022-06-24T18:09:11.552Z","updated":"2022-06-24T18:09:11.552Z","comments":false,"path":"/404.html","permalink":"http://fyupeng.github.io/404.html","excerpt":"","text":""},{"title":"å…³äºŽ","date":"2022-11-29T15:22:07.251Z","updated":"2022-11-29T15:22:07.251Z","comments":false,"path":"about/index.html","permalink":"http://fyupeng.github.io/about/index.html","excerpt":"","text":"Hi there ðŸ‘‹æˆ‘æ˜¯ä¸€åç¨‹åºå‘˜å°ç™½ fyupengï¼Œç›®å‰è¿˜å¤„äºŽå­¦ä¹ é˜¶æ®µï¼Œæœ‰ä¸è¶³ä¹‹å¤„ï¼Œè¿˜è¯·åŒ…æ¶µã€‚ æˆ‘çš„å…¬ä¼—å· Tonyæœ‰è¯è¯´ ç›®å‰åŒæ­¥å­¦ä¹ ç›¸å…³æ–‡ç« ï¼Œæ–‡ç« å†…å®¹æ·±å…¥æµ…å‡ºã€‚ Languages and Tools: Github State: Open Source Projects: åŸºäºŽSpringBoot + Rpc-Netty-Frameworkçš„åˆ†å¸ƒå¼åšå®¢ç®¡ç†åŽç«¯apié¡¹ç›® åŸºäºŽ Nacos çš„ RPC åˆ†å¸ƒå¼å¾®æœåŠ¡æ¡†æž¶ åŸºäºŽ ZooKeeper æ³¨å†Œä¸­å¿ƒçš„ çŸ­è§†é¢‘å¾®ä¿¡å°ç¨‹åº api æŽ¥å£ å’Œ åŽå°ç®¡ç† é¡¹ç›® å’–å•¡è®¢é¤ç³»ç»Ÿ vue+vantå®žçŽ°çš„ç§»åŠ¨ç½‘é¡µç«¯ åŸºäºŽåŽŸç”Ÿ JS + Servlet çš„ åšå®¢ ç®¡ç†ç³»ç»Ÿ åŸºäºŽä¸»æµæ¡†æž¶ SpringBoot çš„å«æœ‰æ¤ç‰©é‰´åˆ«åŠŸèƒ½çš„ åšå®¢ ç®¡ç†ç³»ç»Ÿ My Learning Blogï¼š hexo ä¸ªæ€§åŒ–åšå®¢ï¼ˆç»¼åˆæ€§åšå®¢ï¼ŒåŒ…æ‹¬é¢ç»ã€Javaç¬”è®°ã€Javaå­¦ä¹ æ¡†æž¶ã€ç®—æ³•ç­‰ç­‰ï¼‰ CSDNï¼ˆä¾§é‡ç‚¹å­¦ä¹ é‡åˆ°çš„éš¾é¢˜å¦‚ä½•è§£å†³çš„ç‚¹æ»´è®°å½•ã€çŽ¯å¢ƒéƒ¨ç½²é‡åˆ°çš„é—®é¢˜ã€ç®—æ³•åˆ·é¢˜ç­‰ç­‰ï¼‰ 51CTOï¼ˆä¾§é‡ç‚¹åœ¨äºŽå­¦ä¹ ç¬”è®°è®°å½•ç­‰ç­‰ï¼‰ åšå®¢å›­ï¼ˆä¾§é‡ç‚¹åœ¨äºŽæ”¶è—å¤§ä½¬çš„æŠ€æœ¯æ–‡ç« ï¼‰ è‡ªå»ºåšå®¢ï¼ˆä¸ªäººæ­å»ºçš„æœåŠ¡å™¨åšå®¢é¡¹ç›®ã€ä½¿ç”¨Nginxåå‘ä»£ç†æŽ¥å£æœåŠ¡ï¼Œåšå®¢æ”¾äº†ä¸€äº›ä¸ªäººåˆ·è¿‡çš„ leetcode ç®—æ³•å¸¸è§é¢˜åž‹ï¼Œå¯¹ç§»åŠ¨ç«¯ä½¿ç”¨äººç¾¤å‹å¥½ï¼‰"},{"title":"ä¹¦å•","date":"2022-08-06T04:17:35.416Z","updated":"2022-08-06T04:17:35.416Z","comments":false,"path":"books/index.html","permalink":"http://fyupeng.github.io/books/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2022-06-24T18:09:11.561Z","updated":"2022-06-24T18:09:11.561Z","comments":false,"path":"categories/index.html","permalink":"http://fyupeng.github.io/categories/index.html","excerpt":"","text":""},{"title":"","date":"2022-06-24T17:19:04.497Z","updated":"2022-06-24T17:19:04.497Z","comments":true,"path":"fonts/README.html","permalink":"http://fyupeng.github.io/fonts/README.html","excerpt":"","text":"Font AssetsIf you are providing web font files, this is the place to put them. The fonts task will copy them over to the destination specified in config.json, and file names will be reved in production builds (if enabled). If you donâ€™t plan using web fonts, or are relying on an external service like Google Fonts, feel free to delete this folder and the tasks.fonts config in gulpfile.js/config.json. Tasks and Files1gulpfile.js/tasks/fonts All this task does is copy fonts from ./src/fonts to ./public/fonts. A sass +font-face mixin is included in ./src/stylesheets/base/mixins."},{"title":"","date":"2022-06-24T17:19:04.494Z","updated":"2022-06-24T17:19:04.494Z","comments":true,"path":"css/style.css","permalink":"http://fyupeng.github.io/css/style.css","excerpt":"","text":"@charset \"UTF-8\"; /** * global variables and mixins */ /** * font family */ /** * */ /* Mixins */ /** * bootstrap */ /*! * Bootstrap v3.3.7 (http://getbootstrap.com) * Copyright 2011-2016 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE) */ /*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */ html { font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; } body { margin: 0; } article, aside, details, figcaption, figure, footer, header, hgroup, main, menu, nav, section, summary { display: block; } audio, canvas, progress, video { display: inline-block; vertical-align: baseline; } audio:not([controls]) { display: none; height: 0; } [hidden], template { display: none; } a { background-color: transparent; } a:active, a:hover { outline: 0; } abbr[title] { border-bottom: 1px dotted; } b, strong { font-weight: bold; } dfn { font-style: italic; } h1 { font-size: 2em; margin: 0.67em 0; } mark { background: #ff0; color: #000; } small { font-size: 80%; } sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } sup { top: -0.5em; } sub { bottom: -0.25em; } img { border: 0; } svg:not(:root) { overflow: hidden; } figure { margin: 1em 40px; } hr { -webkit-box-sizing: content-box; box-sizing: content-box; height: 0; } pre { overflow: auto; } code, kbd, pre, samp { font-family: monospace,monospace; font-size: 1em; } button, input, optgroup, select, textarea { color: inherit; font: inherit; margin: 0; } button { overflow: visible; } button, select { text-transform: none; } button, html input[type=\"button\"], input[type=\"reset\"], input[type=\"submit\"] { -webkit-appearance: button; cursor: pointer; } button[disabled], html input[disabled] { cursor: default; } button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; } input { line-height: normal; } input[type=\"checkbox\"], input[type=\"radio\"] { -webkit-box-sizing: border-box; box-sizing: border-box; padding: 0; } input[type=\"number\"]::-webkit-inner-spin-button, input[type=\"number\"]::-webkit-outer-spin-button { height: auto; } input[type=\"search\"] { -webkit-appearance: textfield; -webkit-box-sizing: content-box; box-sizing: content-box; } input[type=\"search\"]::-webkit-search-cancel-button, input[type=\"search\"]::-webkit-search-decoration { -webkit-appearance: none; } fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; } legend { border: 0; padding: 0; } textarea { overflow: auto; } optgroup { font-weight: bold; } table { border-collapse: collapse; border-spacing: 0; } td, th { padding: 0; } /*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */ * { -webkit-box-sizing: border-box; box-sizing: border-box; } *:before, *:after { -webkit-box-sizing: border-box; box-sizing: border-box; } html { font-size: 10px; -webkit-tap-highlight-color: transparent; } input, button, select, textarea { font-family: inherit; font-size: inherit; line-height: inherit; } a { color: #2196f3; text-decoration: none; } a:hover, a:focus { color: #0a6ebd; text-decoration: underline; } a:focus { outline: 5px auto -webkit-focus-ring-color; outline-offset: -2px; } figure { margin: 0; } img { vertical-align: middle; } .img-responsive { display: block; max-width: 100%; height: auto; } .img-rounded { border-radius: 6px; } .img-thumbnail { padding: 4px; line-height: 1.57143; background-color: #fff; border: 1px solid #ddd; border-radius: 4px; -webkit-transition: all 0.2s ease-in-out; transition: all 0.2s ease-in-out; display: inline-block; max-width: 100%; height: auto; } .img-circle { border-radius: 50%; } hr { margin-top: 21px; margin-bottom: 21px; border: 0; border-top: 1px solid #eeeeee; } .sr-only { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; } .sr-only-focusable:active, .sr-only-focusable:focus { position: static; width: auto; height: auto; margin: 0; overflow: visible; clip: auto; } [role=\"button\"] { cursor: pointer; } h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6 { font-family: inherit; font-weight: 500; line-height: 1.1; color: inherit; } h1 small, h1 .small, h2 small, h2 .small, h3 small, h3 .small, h4 small, h4 .small, h5 small, h5 .small, h6 small, h6 .small, .h1 small, .h1 .small, .h2 small, .h2 .small, .h3 small, .h3 .small, .h4 small, .h4 .small, .h5 small, .h5 .small, .h6 small, .h6 .small { font-weight: normal; line-height: 1; color: #777777; } h1, .h1, h2, .h2, h3, .h3 { margin-top: 21px; margin-bottom: 10.5px; } h1 small, h1 .small, .h1 small, .h1 .small, h2 small, h2 .small, .h2 small, .h2 .small, h3 small, h3 .small, .h3 small, .h3 .small { font-size: 65%; } h4, .h4, h5, .h5, h6, .h6 { margin-top: 10.5px; margin-bottom: 10.5px; } h4 small, h4 .small, .h4 small, .h4 .small, h5 small, h5 .small, .h5 small, .h5 .small, h6 small, h6 .small, .h6 small, .h6 .small { font-size: 75%; } h1, .h1 { font-size: 30px; } h2, .h2 { font-size: 26px; } h3, .h3 { font-size: 22px; } h4, .h4 { font-size: 18px; } h5, .h5 { font-size: 14px; } h6, .h6 { font-size: 12px; } p { margin: 0 0 10.5px; } .lead { margin-bottom: 21px; font-size: 16px; font-weight: 300; line-height: 1.4; } small, .small { font-size: 85%; } mark, .mark { background-color: #fcf8e3; padding: .2em; } .text-left { text-align: left; } .text-right { text-align: right; } .text-center { text-align: center; } .text-justify { text-align: justify; } .text-nowrap { white-space: nowrap; } .text-lowercase { text-transform: lowercase; } .text-uppercase, .initialism { text-transform: uppercase; } .text-capitalize { text-transform: capitalize; } .text-muted { color: #777777 !important; } .text-primary { color: #2196f3; } a.text-primary:hover, a.text-primary:focus { color: #0c7cd5; } .text-success { color: #3c763d; } a.text-success:hover, a.text-success:focus { color: #2b542c; } .text-info { color: #31708f; } a.text-info:hover, a.text-info:focus { color: #245269; } .text-warning { color: #8a6d3b; } a.text-warning:hover, a.text-warning:focus { color: #66512c; } .text-danger { color: #a94442; } a.text-danger:hover, a.text-danger:focus { color: #843534; } .bg-primary { color: #fff; } .bg-primary { background-color: #2196f3; } a.bg-primary:hover, a.bg-primary:focus { background-color: #0c7cd5; } .bg-success { background-color: #dff0d8; } a.bg-success:hover, a.bg-success:focus { background-color: #c1e2b3; } .bg-info { background-color: #d9edf7; } a.bg-info:hover, a.bg-info:focus { background-color: #afd9ee; } .bg-warning { background-color: #fcf8e3; } a.bg-warning:hover, a.bg-warning:focus { background-color: #f7ecb5; } .bg-danger { background-color: #f2dede; } a.bg-danger:hover, a.bg-danger:focus { background-color: #e4b9b9; } .page-header { padding-bottom: 9.5px; margin: 42px 0 21px; border-bottom: 1px solid #eeeeee; } ul, ol { margin-top: 0; margin-bottom: 10.5px; } ul ul, ul ol, ol ul, ol ol { margin-bottom: 0; } .list-unstyled { padding-left: 0; list-style: none; } .list-inline { padding-left: 0; list-style: none; margin-left: -5px; } .list-inline > li { display: inline-block; padding-left: 5px; padding-right: 5px; } dl { margin-top: 0; margin-bottom: 21px; } dt, dd { line-height: 1.57143; } dt { font-weight: bold; } dd { margin-left: 0; } .dl-horizontal dd:before, .dl-horizontal dd:after { content: \" \"; display: table; } .dl-horizontal dd:after { clear: both; } abbr[title], abbr[data-original-title] { cursor: help; border-bottom: 1px dotted #777777; } .initialism { font-size: 90%; } blockquote { padding: 10.5px 16px; margin: 0 0 21px; border: 1px dotted #eeeeee; border-left: 3px solid #eeeeee; background-color: #fbfbfb; } blockquote p:last-child, blockquote ul:last-child, blockquote ol:last-child { margin-bottom: 0; } blockquote footer, blockquote small, blockquote .small { display: block; font-size: 80%; line-height: 1.57143; color: #777777; } blockquote footer:before, blockquote small:before, blockquote .small:before { content: '\\2014 \\00A0'; } .blockquote-reverse, blockquote.pull-right { padding-right: 15px; padding-left: 0; border-right: 5px solid #eeeeee; border-left: 0; text-align: right; } .blockquote-reverse footer:before, .blockquote-reverse small:before, .blockquote-reverse .small:before, blockquote.pull-right footer:before, blockquote.pull-right small:before, blockquote.pull-right .small:before { content: ''; } .blockquote-reverse footer:after, .blockquote-reverse small:after, .blockquote-reverse .small:after, blockquote.pull-right footer:after, blockquote.pull-right small:after, blockquote.pull-right .small:after { content: '\\00A0 \\2014'; } address { margin-bottom: 21px; font-style: normal; line-height: 1.57143; } .container { margin-right: auto; margin-left: auto; padding-left: 15px; padding-right: 15px; } .container:before, .container:after { content: \" \"; display: table; } .container:after { clear: both; } .container-fluid { margin-right: auto; margin-left: auto; padding-left: 15px; padding-right: 15px; } .container-fluid:before, .container-fluid:after { content: \" \"; display: table; } .container-fluid:after { clear: both; } .row { margin-left: -15px; margin-right: -15px; } .row:before, .row:after { content: \" \"; display: table; } .row:after { clear: both; } .col-xs-1, .col-sm-1, .col-md-1, .col-lg-1, .col-xs-2, .col-sm-2, .col-md-2, .col-lg-2, .col-xs-3, .col-sm-3, .col-md-3, .col-lg-3, .col-xs-4, .col-sm-4, .col-md-4, .col-lg-4, .col-xs-5, .col-sm-5, .col-md-5, .col-lg-5, .col-xs-6, .col-sm-6, .col-md-6, .col-lg-6, .col-xs-7, .col-sm-7, .col-md-7, .col-lg-7, .col-xs-8, .col-sm-8, .col-md-8, .col-lg-8, .col-xs-9, .col-sm-9, .col-md-9, .col-lg-9, .col-xs-10, .col-sm-10, .col-md-10, .col-lg-10, .col-xs-11, .col-sm-11, .col-md-11, .col-lg-11, .col-xs-12, .col-sm-12, .col-md-12, .col-lg-12 { position: relative; min-height: 1px; padding-left: 15px; padding-right: 15px; } .col-xs-1, .col-xs-2, .col-xs-3, .col-xs-4, .col-xs-5, .col-xs-6, .col-xs-7, .col-xs-8, .col-xs-9, .col-xs-10, .col-xs-11, .col-xs-12 { float: left; } .col-xs-1 { width: 8.33333%; } .col-xs-2 { width: 16.66667%; } .col-xs-3 { width: 25%; } .col-xs-4 { width: 33.33333%; } .col-xs-5 { width: 41.66667%; } .col-xs-6 { width: 50%; } .col-xs-7 { width: 58.33333%; } .col-xs-8 { width: 66.66667%; } .col-xs-9 { width: 75%; } .col-xs-10 { width: 83.33333%; } .col-xs-11 { width: 91.66667%; } .col-xs-12 { width: 100%; } .col-xs-pull-0 { right: auto; } .col-xs-pull-1 { right: 8.33333%; } .col-xs-pull-2 { right: 16.66667%; } .col-xs-pull-3 { right: 25%; } .col-xs-pull-4 { right: 33.33333%; } .col-xs-pull-5 { right: 41.66667%; } .col-xs-pull-6 { right: 50%; } .col-xs-pull-7 { right: 58.33333%; } .col-xs-pull-8 { right: 66.66667%; } .col-xs-pull-9 { right: 75%; } .col-xs-pull-10 { right: 83.33333%; } .col-xs-pull-11 { right: 91.66667%; } .col-xs-pull-12 { right: 100%; } .col-xs-push-0 { left: auto; } .col-xs-push-1 { left: 8.33333%; } .col-xs-push-2 { left: 16.66667%; } .col-xs-push-3 { left: 25%; } .col-xs-push-4 { left: 33.33333%; } .col-xs-push-5 { left: 41.66667%; } .col-xs-push-6 { left: 50%; } .col-xs-push-7 { left: 58.33333%; } .col-xs-push-8 { left: 66.66667%; } .col-xs-push-9 { left: 75%; } .col-xs-push-10 { left: 83.33333%; } .col-xs-push-11 { left: 91.66667%; } .col-xs-push-12 { left: 100%; } .col-xs-offset-0 { margin-left: 0%; } .col-xs-offset-1 { margin-left: 8.33333%; } .col-xs-offset-2 { margin-left: 16.66667%; } .col-xs-offset-3 { margin-left: 25%; } .col-xs-offset-4 { margin-left: 33.33333%; } .col-xs-offset-5 { margin-left: 41.66667%; } .col-xs-offset-6 { margin-left: 50%; } .col-xs-offset-7 { margin-left: 58.33333%; } .col-xs-offset-8 { margin-left: 66.66667%; } .col-xs-offset-9 { margin-left: 75%; } .col-xs-offset-10 { margin-left: 83.33333%; } .col-xs-offset-11 { margin-left: 91.66667%; } .col-xs-offset-12 { margin-left: 100%; } .btn { display: inline-block; margin-bottom: 0; font-weight: normal; text-align: center; vertical-align: middle; -ms-touch-action: manipulation; touch-action: manipulation; cursor: pointer; background-image: none; border: 1px solid transparent; white-space: nowrap; padding: 6px 12px; font-size: 14px; line-height: 1.57143; border-radius: 4px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .btn:focus, .btn.focus, .btn:active:focus, .btn:active.focus, .btn.active:focus, .btn.active.focus { outline: 5px auto -webkit-focus-ring-color; outline-offset: -2px; } .btn:hover, .btn:focus, .btn.focus { color: #333; text-decoration: none; } .btn:active, .btn.active { outline: 0; background-image: none; -webkit-box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125); box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.125); } .btn.disabled, .btn[disabled], fieldset[disabled] .btn { cursor: not-allowed; opacity: 0.65; filter: alpha(opacity=65); -webkit-box-shadow: none; box-shadow: none; } a.btn.disabled, fieldset[disabled] a.btn { pointer-events: none; } .btn-default { color: #333; background-color: #fff; border-color: #ccc; } .btn-default:focus, .btn-default.focus { color: #333; background-color: #e6e6e6; border-color: #8c8c8c; } .btn-default:hover { color: #333; background-color: #e6e6e6; border-color: #adadad; } .btn-default:active, .btn-default.active, .open > .btn-default.dropdown-toggle { color: #333; background-color: #e6e6e6; border-color: #adadad; } .btn-default:active:hover, .btn-default:active:focus, .btn-default:active.focus, .btn-default.active:hover, .btn-default.active:focus, .btn-default.active.focus, .open > .btn-default.dropdown-toggle:hover, .open > .btn-default.dropdown-toggle:focus, .open > .btn-default.dropdown-toggle.focus { color: #333; background-color: #d4d4d4; border-color: #8c8c8c; } .btn-default:active, .btn-default.active, .open > .btn-default.dropdown-toggle { background-image: none; } .btn-default.disabled:hover, .btn-default.disabled:focus, .btn-default.disabled.focus, .btn-default[disabled]:hover, .btn-default[disabled]:focus, .btn-default[disabled].focus, fieldset[disabled] .btn-default:hover, fieldset[disabled] .btn-default:focus, fieldset[disabled] .btn-default.focus { background-color: #fff; border-color: #ccc; } .btn-default .badge { color: #fff; background-color: #333; } .btn-primary { color: #fff; background-color: #2196f3; border-color: #0d8aee; } .btn-primary:focus, .btn-primary.focus { color: #fff; background-color: #0c7cd5; border-color: #064475; } .btn-primary:hover { color: #fff; background-color: #0c7cd5; border-color: #0a68b4; } .btn-primary:active, .btn-primary.active, .open > .btn-primary.dropdown-toggle { color: #fff; background-color: #0c7cd5; border-color: #0a68b4; } .btn-primary:active:hover, .btn-primary:active:focus, .btn-primary:active.focus, .btn-primary.active:hover, .btn-primary.active:focus, .btn-primary.active.focus, .open > .btn-primary.dropdown-toggle:hover, .open > .btn-primary.dropdown-toggle:focus, .open > .btn-primary.dropdown-toggle.focus { color: #fff; background-color: #0a68b4; border-color: #064475; } .btn-primary:active, .btn-primary.active, .open > .btn-primary.dropdown-toggle { background-image: none; } .btn-primary.disabled:hover, .btn-primary.disabled:focus, .btn-primary.disabled.focus, .btn-primary[disabled]:hover, .btn-primary[disabled]:focus, .btn-primary[disabled].focus, fieldset[disabled] .btn-primary:hover, fieldset[disabled] .btn-primary:focus, fieldset[disabled] .btn-primary.focus { background-color: #2196f3; border-color: #0d8aee; } .btn-primary .badge { color: #2196f3; background-color: #fff; } .btn-success { color: #fff; background-color: #5cb85c; border-color: #4cae4c; } .btn-success:focus, .btn-success.focus { color: #fff; background-color: #449d44; border-color: #255625; } .btn-success:hover { color: #fff; background-color: #449d44; border-color: #398439; } .btn-success:active, .btn-success.active, .open > .btn-success.dropdown-toggle { color: #fff; background-color: #449d44; border-color: #398439; } .btn-success:active:hover, .btn-success:active:focus, .btn-success:active.focus, .btn-success.active:hover, .btn-success.active:focus, .btn-success.active.focus, .open > .btn-success.dropdown-toggle:hover, .open > .btn-success.dropdown-toggle:focus, .open > .btn-success.dropdown-toggle.focus { color: #fff; background-color: #398439; border-color: #255625; } .btn-success:active, .btn-success.active, .open > .btn-success.dropdown-toggle { background-image: none; } .btn-success.disabled:hover, .btn-success.disabled:focus, .btn-success.disabled.focus, .btn-success[disabled]:hover, .btn-success[disabled]:focus, .btn-success[disabled].focus, fieldset[disabled] .btn-success:hover, fieldset[disabled] .btn-success:focus, fieldset[disabled] .btn-success.focus { background-color: #5cb85c; border-color: #4cae4c; } .btn-success .badge { color: #5cb85c; background-color: #fff; } .btn-info { color: #fff; background-color: #56CCF2; border-color: #3ec5f0; } .btn-info:focus, .btn-info.focus { color: #fff; background-color: #27beee; border-color: #0d7ea3; } .btn-info:hover { color: #fff; background-color: #27beee; border-color: #11aee0; } .btn-info:active, .btn-info.active, .open > .btn-info.dropdown-toggle { color: #fff; background-color: #27beee; border-color: #11aee0; } .btn-info:active:hover, .btn-info:active:focus, .btn-info:active.focus, .btn-info.active:hover, .btn-info.active:focus, .btn-info.active.focus, .open > .btn-info.dropdown-toggle:hover, .open > .btn-info.dropdown-toggle:focus, .open > .btn-info.dropdown-toggle.focus { color: #fff; background-color: #11aee0; border-color: #0d7ea3; } .btn-info:active, .btn-info.active, .open > .btn-info.dropdown-toggle { background-image: none; } .btn-info.disabled:hover, .btn-info.disabled:focus, .btn-info.disabled.focus, .btn-info[disabled]:hover, .btn-info[disabled]:focus, .btn-info[disabled].focus, fieldset[disabled] .btn-info:hover, fieldset[disabled] .btn-info:focus, fieldset[disabled] .btn-info.focus { background-color: #56CCF2; border-color: #3ec5f0; } .btn-info .badge { color: #56CCF2; background-color: #fff; } .btn-warning { color: #fff; background-color: #F09819; border-color: #e18b0f; } .btn-warning:focus, .btn-warning.focus { color: #fff; background-color: #c97c0d; border-color: #694107; } .btn-warning:hover { color: #fff; background-color: #c97c0d; border-color: #a7670b; } .btn-warning:active, .btn-warning.active, .open > .btn-warning.dropdown-toggle { color: #fff; background-color: #c97c0d; border-color: #a7670b; } .btn-warning:active:hover, .btn-warning:active:focus, .btn-warning:active.focus, .btn-warning.active:hover, .btn-warning.active:focus, .btn-warning.active.focus, .open > .btn-warning.dropdown-toggle:hover, .open > .btn-warning.dropdown-toggle:focus, .open > .btn-warning.dropdown-toggle.focus { color: #fff; background-color: #a7670b; border-color: #694107; } .btn-warning:active, .btn-warning.active, .open > .btn-warning.dropdown-toggle { background-image: none; } .btn-warning.disabled:hover, .btn-warning.disabled:focus, .btn-warning.disabled.focus, .btn-warning[disabled]:hover, .btn-warning[disabled]:focus, .btn-warning[disabled].focus, fieldset[disabled] .btn-warning:hover, fieldset[disabled] .btn-warning:focus, fieldset[disabled] .btn-warning.focus { background-color: #F09819; border-color: #e18b0f; } .btn-warning .badge { color: #F09819; background-color: #fff; } .btn-danger { color: #fff; background-color: #FF512F; border-color: #ff3c16; } .btn-danger:focus, .btn-danger.focus { color: #fff; background-color: #fb2900; border-color: #951800; } .btn-danger:hover { color: #fff; background-color: #fb2900; border-color: #d72300; } .btn-danger:active, .btn-danger.active, .open > .btn-danger.dropdown-toggle { color: #fff; background-color: #fb2900; border-color: #d72300; } .btn-danger:active:hover, .btn-danger:active:focus, .btn-danger:active.focus, .btn-danger.active:hover, .btn-danger.active:focus, .btn-danger.active.focus, .open > .btn-danger.dropdown-toggle:hover, .open > .btn-danger.dropdown-toggle:focus, .open > .btn-danger.dropdown-toggle.focus { color: #fff; background-color: #d72300; border-color: #951800; } .btn-danger:active, .btn-danger.active, .open > .btn-danger.dropdown-toggle { background-image: none; } .btn-danger.disabled:hover, .btn-danger.disabled:focus, .btn-danger.disabled.focus, .btn-danger[disabled]:hover, .btn-danger[disabled]:focus, .btn-danger[disabled].focus, fieldset[disabled] .btn-danger:hover, fieldset[disabled] .btn-danger:focus, fieldset[disabled] .btn-danger.focus { background-color: #FF512F; border-color: #ff3c16; } .btn-danger .badge { color: #FF512F; background-color: #fff; } .btn-link { color: #2196f3; font-weight: normal; border-radius: 0; } .btn-link, .btn-link:active, .btn-link.active, .btn-link[disabled], fieldset[disabled] .btn-link { background-color: transparent; -webkit-box-shadow: none; box-shadow: none; } .btn-link, .btn-link:hover, .btn-link:focus, .btn-link:active { border-color: transparent; } .btn-link:hover, .btn-link:focus { color: #0a6ebd; text-decoration: underline; background-color: transparent; } .btn-link[disabled]:hover, .btn-link[disabled]:focus, fieldset[disabled] .btn-link:hover, fieldset[disabled] .btn-link:focus { color: #777777; text-decoration: none; } .btn-lg { padding: 10px 16px; font-size: 18px; line-height: 1.33333; border-radius: 6px; } .btn-sm { padding: 5px 10px; font-size: 12px; line-height: 1.5; border-radius: 3px; } .btn-xs { padding: 1px 5px; font-size: 12px; line-height: 1.5; border-radius: 3px; } .btn-block { display: block; width: 100%; } .btn-block + .btn-block { margin-top: 5px; } input[type=\"submit\"].btn-block, input[type=\"reset\"].btn-block, input[type=\"button\"].btn-block { width: 100%; } .fade { opacity: 0; -webkit-transition: opacity 0.15s linear; transition: opacity 0.15s linear; } .fade.in { opacity: 1; } .collapse { display: none; } .collapse.in { display: block; } tr.collapse.in { display: table-row; } tbody.collapse.in { display: table-row-group; } .collapsing { position: relative; height: 0; overflow: hidden; -webkit-transition-property: height,visibility; transition-property: height,visibility; -webkit-transition-duration: 0.35s; transition-duration: 0.35s; -webkit-transition-timing-function: ease; transition-timing-function: ease; } .caret { display: inline-block; width: 0; height: 0; margin-left: 2px; vertical-align: middle; border-top: 4px dashed; border-top: 4px solid \\9; border-right: 4px solid transparent; border-left: 4px solid transparent; } .dropup, .dropdown { position: relative; } .dropdown-toggle:focus { outline: 0; } .dropdown-menu { position: absolute; top: 100%; left: 0; z-index: 1000; display: none; float: left; min-width: 160px; padding: 5px 0; margin: 2px 0 0; list-style: none; font-size: 14px; text-align: left; background-color: #fff; border: 1px solid #ccc; border: 1px solid rgba(0, 0, 0, 0.15); border-radius: 4px; -webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175); background-clip: padding-box; } .dropdown-menu.pull-right { right: 0; left: auto; } .dropdown-menu .divider { height: 1px; margin: 9.5px 0; overflow: hidden; background-color: #e5e5e5; } .dropdown-menu > li > a { display: block; padding: 3px 20px; clear: both; font-weight: normal; line-height: 1.57143; color: #333333; white-space: nowrap; } .dropdown-menu > li > a:hover, .dropdown-menu > li > a:focus { text-decoration: none; color: #262626; background-color: #f5f5f5; } .dropdown-menu > .active > a, .dropdown-menu > .active > a:hover, .dropdown-menu > .active > a:focus { color: #fff; text-decoration: none; outline: 0; background-color: #2196f3; } .dropdown-menu > .disabled > a, .dropdown-menu > .disabled > a:hover, .dropdown-menu > .disabled > a:focus { color: #777777; } .dropdown-menu > .disabled > a:hover, .dropdown-menu > .disabled > a:focus { text-decoration: none; background-color: transparent; background-image: none; filter: progid:DXImageTransform.Microsoft.gradient(enabled = false); cursor: not-allowed; } .open > .dropdown-menu { display: block; } .open > a { outline: 0; } .dropdown-menu-right { left: auto; right: 0; } .dropdown-menu-left { left: 0; right: auto; } .dropdown-header { display: block; padding: 3px 20px; font-size: 12px; line-height: 1.57143; color: #777777; white-space: nowrap; } .dropdown-backdrop { position: fixed; left: 0; right: 0; bottom: 0; top: 0; z-index: 990; } .pull-right > .dropdown-menu { right: 0; left: auto; } .dropup .caret, .navbar-fixed-bottom .dropdown .caret { border-top: 0; border-bottom: 4px dashed; border-bottom: 4px solid \\9; content: \"\"; } .dropup .dropdown-menu, .navbar-fixed-bottom .dropdown .dropdown-menu { top: auto; bottom: 100%; margin-bottom: 2px; } .input-group { position: relative; display: table; border-collapse: separate; } .input-group[class*=\"col-\"] { float: none; padding-left: 0; padding-right: 0; } .input-group .form-control { position: relative; z-index: 2; float: left; width: 100%; margin-bottom: 0; } .input-group .form-control:focus { z-index: 3; } .input-group-addon, .input-group-btn, .input-group .form-control { display: table-cell; } .input-group-addon:not(:first-child):not(:last-child), .input-group-btn:not(:first-child):not(:last-child), .input-group .form-control:not(:first-child):not(:last-child) { border-radius: 0; } .input-group-addon, .input-group-btn { width: 1%; white-space: nowrap; vertical-align: middle; } .input-group-addon { padding: 6px 12px; font-size: 14px; font-weight: normal; line-height: 1; color: #555555; text-align: center; background-color: #eeeeee; border: 1px solid #ccc; border-radius: 4px; } .input-group-addon.input-sm, .input-group-sm > .input-group-addon, .input-group-sm > .input-group-btn > .input-group-addon.btn { padding: 5px 10px; font-size: 12px; border-radius: 3px; } .input-group-addon.input-lg, .input-group-lg > .input-group-addon, .input-group-lg > .input-group-btn > .input-group-addon.btn { padding: 10px 16px; font-size: 18px; border-radius: 6px; } .input-group-addon input[type=\"radio\"], .input-group-addon input[type=\"checkbox\"] { margin-top: 0; } .input-group .form-control:first-child, .input-group-addon:first-child, .input-group-btn:first-child > .btn, .input-group-btn:first-child > .btn-group > .btn, .input-group-btn:first-child > .dropdown-toggle, .input-group-btn:last-child > .btn:not(:last-child):not(.dropdown-toggle), .input-group-btn:last-child > .btn-group:not(:last-child) > .btn { border-bottom-right-radius: 0; border-top-right-radius: 0; } .input-group-addon:first-child { border-right: 0; } .input-group .form-control:last-child, .input-group-addon:last-child, .input-group-btn:last-child > .btn, .input-group-btn:last-child > .btn-group > .btn, .input-group-btn:last-child > .dropdown-toggle, .input-group-btn:first-child > .btn:not(:first-child), .input-group-btn:first-child > .btn-group:not(:first-child) > .btn { border-bottom-left-radius: 0; border-top-left-radius: 0; } .input-group-addon:last-child { border-left: 0; } .input-group-btn { position: relative; font-size: 0; white-space: nowrap; } .input-group-btn > .btn { position: relative; } .input-group-btn > .btn + .btn { margin-left: -1px; } .input-group-btn > .btn:hover, .input-group-btn > .btn:focus, .input-group-btn > .btn:active { z-index: 2; } .input-group-btn:first-child > .btn, .input-group-btn:first-child > .btn-group { margin-right: -1px; } .input-group-btn:last-child > .btn, .input-group-btn:last-child > .btn-group { z-index: 2; margin-left: -1px; } .nav { margin-bottom: 0; padding-left: 0; list-style: none; } .nav:before, .nav:after { content: \" \"; display: table; } .nav:after { clear: both; } .nav > li { position: relative; display: block; } .nav > li > a { position: relative; display: block; padding: 10px 15px; } .nav > li > a:hover, .nav > li > a:focus { text-decoration: none; background-color: #eeeeee; } .nav > li.disabled > a { color: #777777; } .nav > li.disabled > a:hover, .nav > li.disabled > a:focus { color: #777777; text-decoration: none; background-color: transparent; cursor: not-allowed; } .nav .open > a, .nav .open > a:hover, .nav .open > a:focus { background-color: #eeeeee; border-color: #2196f3; } .nav .nav-divider { height: 1px; margin: 9.5px 0; overflow: hidden; background-color: #e5e5e5; } .nav > li > a > img { max-width: none; } .nav-tabs { border-bottom: 1px solid #f2f2f2; } .nav-tabs > li { float: left; margin-bottom: -1px; } .nav-tabs > li > a { margin-right: 2px; line-height: 1.57143; border: 1px solid transparent; border-radius: 4px 4px 0 0; } .nav-tabs > li > a:hover { border-color: #eeeeee #eeeeee #f2f2f2; } .nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus { color: #555555; background-color: #fff; border: 1px solid #f2f2f2; border-bottom-color: transparent; cursor: default; } .nav-pills > li { float: left; } .nav-pills > li > a { border-radius: 4px; } .nav-pills > li + li { margin-left: 2px; } .nav-pills > li.active > a, .nav-pills > li.active > a:hover, .nav-pills > li.active > a:focus { color: #fff; background-color: #2196f3; } .nav-stacked > li { float: none; } .nav-stacked > li + li { margin-top: 2px; margin-left: 0; } .nav-justified, .nav-tabs.nav-justified { width: 100%; } .nav-justified > li, .nav-tabs.nav-justified > li { float: none; } .nav-justified > li > a, .nav-tabs.nav-justified > li > a { text-align: center; margin-bottom: 5px; } .nav-justified > .dropdown .dropdown-menu { top: auto; left: auto; } .nav-tabs-justified, .nav-tabs.nav-justified { border-bottom: 0; } .nav-tabs-justified > li > a, .nav-tabs.nav-justified > li > a { margin-right: 0; border-radius: 4px; } .nav-tabs-justified > .active > a, .nav-tabs.nav-justified > .active > a, .nav-tabs-justified > .active > a:hover, .nav-tabs.nav-justified > .active > a:hover, .nav-tabs-justified > .active > a:focus, .nav-tabs.nav-justified > .active > a:focus { border: 1px solid #f2f2f2; } .tab-content > .tab-pane { display: none; } .tab-content > .active { display: block; } .nav-tabs .dropdown-menu { margin-top: -1px; border-top-right-radius: 0; border-top-left-radius: 0; } .navbar { position: relative; min-height: 50px; margin-bottom: 21px; border: 1px solid transparent; } .navbar:before, .navbar:after { content: \" \"; display: table; } .navbar:after { clear: both; } .navbar-header:before, .navbar-header:after { content: \" \"; display: table; } .navbar-header:after { clear: both; } .navbar-collapse { overflow-x: visible; padding-right: 15px; padding-left: 15px; border-top: 1px solid transparent; -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1); box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1); -webkit-overflow-scrolling: touch; } .navbar-collapse:before, .navbar-collapse:after { content: \" \"; display: table; } .navbar-collapse:after { clear: both; } .navbar-collapse.in { overflow-y: auto; } .navbar-fixed-top .navbar-collapse, .navbar-fixed-bottom .navbar-collapse { max-height: 340px; } .container > .navbar-header, .container > .navbar-collapse, .container-fluid > .navbar-header, .container-fluid > .navbar-collapse { margin-right: -15px; margin-left: -15px; } .navbar-static-top { z-index: 1000; border-width: 0 0 1px; } .navbar-fixed-top, .navbar-fixed-bottom { position: fixed; right: 0; left: 0; z-index: 1030; } .navbar-fixed-top { top: 0; border-width: 0 0 1px; } .navbar-fixed-bottom { bottom: 0; margin-bottom: 0; border-width: 1px 0 0; } .navbar-brand { float: left; padding: 14.5px 15px; font-size: 18px; line-height: 21px; height: 50px; } .navbar-brand:hover, .navbar-brand:focus { text-decoration: none; } .navbar-brand > img { display: block; } .navbar-toggle { position: relative; float: right; margin-right: 15px; padding: 10px 10px; margin-top: 8px; margin-bottom: 8px; background-color: transparent; background-image: none; border: 1px solid transparent; border-radius: 4px; } .navbar-toggle:focus { outline: 0; } .navbar-toggle .icon-bar { display: block; width: 22px; height: 2px; border-radius: 1px; } .navbar-toggle .icon-bar + .icon-bar { margin-top: 3px; } .navbar-nav { margin: 7.25px -15px; } .navbar-nav > li > a { padding-top: 10px; padding-bottom: 10px; line-height: 21px; } .navbar-form { margin-left: -15px; margin-right: -15px; padding: 10px 15px; border-top: 1px solid transparent; border-bottom: 1px solid transparent; -webkit-box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1),0 1px 0 rgba(255, 255, 255, 0.1); box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1),0 1px 0 rgba(255, 255, 255, 0.1); margin-top: 7.5px; margin-bottom: 7.5px; } .navbar-nav > li > .dropdown-menu { margin-top: 0; border-top-right-radius: 0; border-top-left-radius: 0; } .navbar-fixed-bottom .navbar-nav > li > .dropdown-menu { margin-bottom: 0; border-top-right-radius: 4px; border-top-left-radius: 4px; border-bottom-right-radius: 0; border-bottom-left-radius: 0; } .navbar-btn { margin-top: 7.5px; margin-bottom: 7.5px; } .navbar-btn.btn-sm { margin-top: 10px; margin-bottom: 10px; } .navbar-btn.btn-xs { margin-top: 14px; margin-bottom: 14px; } .navbar-text { margin-top: 14.5px; margin-bottom: 14.5px; } .navbar-default { background-color: #f8f8f8; border-color: #e7e7e7; } .navbar-default .navbar-brand { color: #777; } .navbar-default .navbar-brand:hover, .navbar-default .navbar-brand:focus { color: #5e5e5e; background-color: transparent; } .navbar-default .navbar-text { color: #777; } .navbar-default .navbar-nav > li > a { color: #777; } .navbar-default .navbar-nav > li > a:hover, .navbar-default .navbar-nav > li > a:focus { color: #333; background-color: transparent; } .navbar-default .navbar-nav > .active > a, .navbar-default .navbar-nav > .active > a:hover, .navbar-default .navbar-nav > .active > a:focus { color: #555; background-color: #e7e7e7; } .navbar-default .navbar-nav > .disabled > a, .navbar-default .navbar-nav > .disabled > a:hover, .navbar-default .navbar-nav > .disabled > a:focus { color: #ccc; background-color: transparent; } .navbar-default .navbar-toggle { border-color: #ddd; } .navbar-default .navbar-toggle:hover, .navbar-default .navbar-toggle:focus { background-color: #ddd; } .navbar-default .navbar-toggle .icon-bar { background-color: #888; } .navbar-default .navbar-collapse, .navbar-default .navbar-form { border-color: #e7e7e7; } .navbar-default .navbar-nav > .open > a, .navbar-default .navbar-nav > .open > a:hover, .navbar-default .navbar-nav > .open > a:focus { background-color: #e7e7e7; color: #555; } .navbar-default .navbar-link { color: #777; } .navbar-default .navbar-link:hover { color: #333; } .navbar-default .btn-link { color: #777; } .navbar-default .btn-link:hover, .navbar-default .btn-link:focus { color: #333; } .navbar-default .btn-link[disabled]:hover, .navbar-default .btn-link[disabled]:focus, fieldset[disabled] .navbar-default .btn-link:hover, fieldset[disabled] .navbar-default .btn-link:focus { color: #ccc; } .navbar-inverse { background-color: #222; border-color: #090909; } .navbar-inverse .navbar-brand { color: #9d9d9d; } .navbar-inverse .navbar-brand:hover, .navbar-inverse .navbar-brand:focus { color: #fff; background-color: transparent; } .navbar-inverse .navbar-text { color: #9d9d9d; } .navbar-inverse .navbar-nav > li > a { color: #9d9d9d; } .navbar-inverse .navbar-nav > li > a:hover, .navbar-inverse .navbar-nav > li > a:focus { color: #fff; background-color: transparent; } .navbar-inverse .navbar-nav > .active > a, .navbar-inverse .navbar-nav > .active > a:hover, .navbar-inverse .navbar-nav > .active > a:focus { color: #fff; background-color: #090909; } .navbar-inverse .navbar-nav > .disabled > a, .navbar-inverse .navbar-nav > .disabled > a:hover, .navbar-inverse .navbar-nav > .disabled > a:focus { color: #444; background-color: transparent; } .navbar-inverse .navbar-toggle { border-color: #333; } .navbar-inverse .navbar-toggle:hover, .navbar-inverse .navbar-toggle:focus { background-color: #333; } .navbar-inverse .navbar-toggle .icon-bar { background-color: #fff; } .navbar-inverse .navbar-collapse, .navbar-inverse .navbar-form { border-color: #101010; } .navbar-inverse .navbar-nav > .open > a, .navbar-inverse .navbar-nav > .open > a:hover, .navbar-inverse .navbar-nav > .open > a:focus { background-color: #090909; color: #fff; } .navbar-inverse .navbar-link { color: #9d9d9d; } .navbar-inverse .navbar-link:hover { color: #fff; } .navbar-inverse .btn-link { color: #9d9d9d; } .navbar-inverse .btn-link:hover, .navbar-inverse .btn-link:focus { color: #fff; } .navbar-inverse .btn-link[disabled]:hover, .navbar-inverse .btn-link[disabled]:focus, fieldset[disabled] .navbar-inverse .btn-link:hover, fieldset[disabled] .navbar-inverse .btn-link:focus { color: #444; } .pager { padding-left: 0; margin: 21px 0; list-style: none; text-align: center; } .pager:before, .pager:after { content: \" \"; display: table; } .pager:after { clear: both; } .pager li { display: inline; } .pager li > a, .pager li > span { display: inline-block; padding: 5px 14px; background-color: #fff; border: 1px solid #ddd; border-radius: 15px; } .pager li > a:hover, .pager li > a:focus { text-decoration: none; background-color: #eeeeee; } .pager .next > a, .pager .next > span { float: right; } .pager .previous > a, .pager .previous > span { float: left; } .pager .disabled > a, .pager .disabled > a:hover, .pager .disabled > a:focus, .pager .disabled > span { color: #777777; background-color: #fff; cursor: not-allowed; } .badge { display: inline-block; min-width: 10px; padding: 3px 7px; font-size: 12px; font-weight: bold; color: #fff; line-height: 1; vertical-align: middle; white-space: nowrap; text-align: center; background-color: #777777; border-radius: 10px; } .badge:empty { display: none; } .btn .badge { position: relative; top: -1px; } .btn-xs .badge, .btn-group-xs > .btn .badge { top: 0; padding: 1px 5px; } .list-group-item.active > .badge, .nav-pills > .active > a > .badge { color: #2196f3; background-color: #fff; } .list-group-item > .badge { float: right; } .list-group-item > .badge + .badge { margin-right: 5px; } .nav-pills > li > a > .badge { margin-left: 3px; } a.badge:hover, a.badge:focus { color: #fff; text-decoration: none; cursor: pointer; } .thumbnail { display: block; padding: 4px; margin-bottom: 21px; line-height: 1.57143; background-color: #fff; border: 1px solid #ddd; border-radius: 4px; -webkit-transition: border 0.2s ease-in-out; transition: border 0.2s ease-in-out; } .thumbnail > img, .thumbnail a > img { display: block; max-width: 100%; height: auto; margin-left: auto; margin-right: auto; } .thumbnail .caption { padding: 9px; color: #333333; } a.thumbnail:hover, a.thumbnail:focus, a.thumbnail.active { border-color: #2196f3; } .media { margin-top: 15px; } .media:first-child { margin-top: 0; } .media, .media-body { zoom: 1; overflow: hidden; } .media-body { width: 10000px; } .media-object { display: block; } .media-object.img-thumbnail { max-width: none; } .media-right, .media > .pull-right { padding-left: 10px; } .media-left, .media > .pull-left { padding-right: 10px; } .media-left, .media-right, .media-body { display: table-cell; vertical-align: top; } .media-middle { vertical-align: middle; } .media-middle .media-left, .media-middle .media-right, .media-middle .media-body { vertical-align: middle; } .media-bottom { vertical-align: bottom; } .media-bottom .media-left, .media-bottom .media-right, .media-bottom .media-body { vertical-align: bottom; } .media-heading { margin-top: 0; margin-bottom: 5px; } .media-list { padding-left: 0; list-style: none; } .embed-responsive { position: relative; display: block; height: 0; padding: 0; overflow: hidden; } .embed-responsive .embed-responsive-item, .embed-responsive iframe, .embed-responsive embed, .embed-responsive object, .embed-responsive video { position: absolute; top: 0; left: 0; bottom: 0; height: 100%; width: 100%; border: 0; } .embed-responsive-16by9 { padding-bottom: 56.25%; } .embed-responsive-4by3 { padding-bottom: 75%; } .well { min-height: 20px; padding: 19px; margin-bottom: 20px; background-color: #f5f5f5; border: 1px solid #e3e3e3; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.05); } .well blockquote { border-color: #ddd; border-color: rgba(0, 0, 0, 0.15); } .well-lg { padding: 24px; border-radius: 6px; } .well-sm { padding: 9px; border-radius: 3px; } .close { float: right; font-size: 24px; line-height: 1; color: #000; text-shadow: 0 1px 0 #fff; opacity: 0.2; filter: alpha(opacity=20); } .close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; opacity: 0.5; filter: alpha(opacity=50); } button.close { padding: 0; cursor: pointer; background: transparent; border: 0; -webkit-appearance: none; } .modal-open { overflow: hidden; } .modal { display: none; overflow: hidden; position: fixed; top: 0; right: 0; bottom: 0; left: 0; z-index: 1050; -webkit-overflow-scrolling: touch; outline: 0; } .modal.fade .modal-dialog { -webkit-transform: translate(0, -25%); -ms-transform: translate(0, -25%); transform: translate(0, -25%); -webkit-transition: -webkit-transform 0.3s ease-out; transition: -webkit-transform 0.3s ease-out; transition: transform 0.3s ease-out; transition: transform 0.3s ease-out,-webkit-transform 0.3s ease-out; } .modal.in .modal-dialog { -webkit-transform: translate(0, 0); -ms-transform: translate(0, 0); transform: translate(0, 0); } .modal-open .modal { overflow-x: hidden; overflow-y: auto; } .modal-dialog { position: relative; width: auto; margin: 10px; } .modal-content { position: relative; background-color: #fff; border-radius: 6px; -webkit-box-shadow: 0 3px 9px rgba(0, 0, 0, 0.05); box-shadow: 0 3px 9px rgba(0, 0, 0, 0.05); background-clip: padding-box; outline: 0; } .modal-backdrop { position: fixed; top: 0; right: 0; bottom: 0; left: 0; z-index: 1040; background-color: #000; } .modal-backdrop.fade { opacity: 0; filter: alpha(opacity=0); } .modal-backdrop.in { opacity: 0.5; filter: alpha(opacity=50); } .modal-header { padding: 15px; border-bottom: 1px solid #e5e5e5; } .modal-header:before, .modal-header:after { content: \" \"; display: table; } .modal-header:after { clear: both; } .modal-header .close { margin-top: -2px; } .modal-title { margin: 0; line-height: 1.57143; } .modal-body { position: relative; padding: 15px; } .modal-footer { padding: 15px; text-align: right; border-top: 1px solid #e5e5e5; } .modal-footer:before, .modal-footer:after { content: \" \"; display: table; } .modal-footer:after { clear: both; } .modal-footer .btn + .btn { margin-left: 5px; margin-bottom: 0; } .modal-footer .btn-group .btn + .btn { margin-left: -1px; } .modal-footer .btn-block + .btn-block { margin-left: 0; } .modal-scrollbar-measure { position: absolute; top: -9999px; width: 50px; height: 50px; overflow: scroll; } .tooltip { position: absolute; z-index: 1070; display: block; font-family: \"PingHei\",\"PingFang SC\",Helvetica Neue,\"Work Sans\",\"Hiragino Sans GB\",\"Microsoft YaHei\",SimSun,sans-serif; font-style: normal; font-weight: normal; letter-spacing: normal; line-break: auto; line-height: 1.57143; text-align: left; text-align: start; text-decoration: none; text-shadow: none; text-transform: none; white-space: normal; word-break: normal; word-spacing: normal; word-wrap: normal; font-size: 12px; opacity: 0; filter: alpha(opacity=0); } .tooltip.in { opacity: 0.9; filter: alpha(opacity=90); } .tooltip.top { margin-top: -3px; padding: 5px 0; } .tooltip.right { margin-left: 3px; padding: 0 5px; } .tooltip.bottom { margin-top: 3px; padding: 5px 0; } .tooltip.left { margin-left: -3px; padding: 0 5px; } .tooltip-inner { max-width: 200px; padding: 3px 8px; color: #fff; text-align: center; background-color: #000; border-radius: 4px; } .tooltip-arrow { position: absolute; width: 0; height: 0; border-color: transparent; border-style: solid; } .tooltip.top .tooltip-arrow { bottom: 0; left: 50%; margin-left: -5px; border-width: 5px 5px 0; border-top-color: #000; } .tooltip.top-left .tooltip-arrow { bottom: 0; right: 5px; margin-bottom: -5px; border-width: 5px 5px 0; border-top-color: #000; } .tooltip.top-right .tooltip-arrow { bottom: 0; left: 5px; margin-bottom: -5px; border-width: 5px 5px 0; border-top-color: #000; } .tooltip.right .tooltip-arrow { top: 50%; left: 0; margin-top: -5px; border-width: 5px 5px 5px 0; border-right-color: #000; } .tooltip.left .tooltip-arrow { top: 50%; right: 0; margin-top: -5px; border-width: 5px 0 5px 5px; border-left-color: #000; } .tooltip.bottom .tooltip-arrow { top: 0; left: 50%; margin-left: -5px; border-width: 0 5px 5px; border-bottom-color: #000; } .tooltip.bottom-left .tooltip-arrow { top: 0; right: 5px; margin-top: -5px; border-width: 0 5px 5px; border-bottom-color: #000; } .tooltip.bottom-right .tooltip-arrow { top: 0; left: 5px; margin-top: -5px; border-width: 0 5px 5px; border-bottom-color: #000; } .clearfix:before, .clearfix:after { content: \" \"; display: table; } .clearfix:after { clear: both; } .center-block { display: block; margin-left: auto; margin-right: auto; } .pull-right { float: right !important; } .pull-left { float: left !important; } .hide { display: none !important; } .show { display: block !important; } .invisible { visibility: hidden; } .text-hide { font: 0/0 a; color: transparent; text-shadow: none; background-color: transparent; border: 0; } .hidden { display: none !important; } .affix { position: fixed; } @-ms-viewport { width: device-width; } .visible-xs { display: none !important; } .visible-sm { display: none !important; } .visible-md { display: none !important; } .visible-lg { display: none !important; } .visible-xs-block, .visible-xs-inline, .visible-xs-inline-block, .visible-sm-block, .visible-sm-inline, .visible-sm-inline-block, .visible-md-block, .visible-md-inline, .visible-md-inline-block, .visible-lg-block, .visible-lg-inline, .visible-lg-inline-block { display: none !important; } .visible-print { display: none !important; } .visible-print-block { display: none !important; } .visible-print-inline { display: none !important; } .visible-print-inline-block { display: none !important; } /** * application */ /*! * IE10 viewport hack for Surface/desktop Windows 8 bug * Copyright 2014-2015 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE) */ /* * See the Getting Started docs for more information: * http://getbootstrap.com/getting-started/#support-ie10-width */ @-ms-viewport { width: device-width; } @-o-viewport { width: device-width; } @viewport { width: device-width; } /* * scrollbar */ ::-webkit-scrollbar { width: 6px; height: 4px; background: transparent; } ::-webkit-scrollbar-thumb { background: rgba(0, 0, 0, 0.15); } ::-webkit-scrollbar-thumb:window-inactive { background: rgba(0, 0, 0, 0.1); } ::-webkit-scrollbar-thumb:vertical { height: 4px; background: rgba(0, 0, 0, 0.15); } ::-webkit-scrollbar-thumb:horizontal { width: 4px; background: rgba(0, 0, 0, 0.15); } ::-webkit-scrollbar-thumb:vertical:hover { background-color: rgba(0, 0, 0, 0.3); } ::-webkit-scrollbar-thumb:vertical:active { background-color: rgba(0, 0, 0, 0.5); } ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); -webkit-box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.1); box-shadow: inset 0 0 3px rgba(0, 0, 0, 0.1); } ::-webkit-scrollbar-track-piece { background: rgba(0, 0, 0, 0.15); } *, *:before, *:after { -webkit-box-sizing: border-box; box-sizing: border-box; } html, body { position: relative; overflow-x: hidden; } body { padding-right: 0 !important; font-family: \"PingHei\",\"PingFang SC\",Helvetica Neue,\"Work Sans\",\"Hiragino Sans GB\",\"Microsoft YaHei\",SimSun,sans-serif; font-size: 14px; line-height: 1.57143; color: #333333; background-color: #fff; } a { color: #333333; text-decoration: none; } a:focus, a:hover { color: #0a6ebd; text-decoration: none; } a.active { color: #0a6ebd; } .active > a { color: #0a6ebd; } input, button, select, textarea, .btn { outline: none !important; } input:focus, input:hover, input:active, button:focus, button:hover, button:active, select:focus, select:hover, select:active, textarea:focus, textarea:hover, textarea:active, .btn:focus, .btn:hover, .btn:active { outline: none !important; } /*------------------ Fluidity response ------------------------------*/ img, canvas, iframe, video, svg { max-width: 100%; height: auto; } /*------------------ clear ------------------------------*/ .clear { height: 0; font-size: 0; line-height: 0; overflow: hidden; clear: both; } .clearfix:before, .clearfix:after { display: table; line-height: 0; content: \"\"; } .clearfix:after { clear: both; } .clearfix { *zoom: 1; } /*other*/ .clickable { cursor: pointer; } .scrollable { overflow-x: hidden; overflow-y: auto; } /*transform*/ .transform-no { -ms-transform: none !important; -webkit-transform: none !important; transform: none !important; } /*---------------------------------------------------- * color *---------------------------------------------------*/ .text-dark { color: #333 !important; } .text-grey { color: #999 !important; } /*text-white*/ .text-white { color: #fff !important; } .text-white a:hover, .text-white a:hover i, .text-white:hover { color: rgba(255, 255, 255, 0.8); } .text-white a.list-group-item.active i { color: #fff; } .text-white .accordion-list p { font-size: 12px; height: 84px; line-height: 21px; color: rgba(255, 255, 255, 0.8); } /*background-color*/ .bg-no { background: none !important; } .bg-alpha { background-color: transparent !important; } .bg-inverse, .bg-inverse a { color: #fff; } .btn.bg-inverse:hover, .btn.bg-inverse:focus, .btn.bg-inverse.focus { color: rgba(255, 255, 255, 0.8); } .bg { background-color: #f6f6f6 !important; } /*---------------------------------------------------- * z-index *---------------------------------------------------*/ .z-no { z-index: inherit; } .z1 { z-index: 1; } .z2 { z-index: 2; } .z3 { z-index: 3; } .z4 { z-index: 4; } .zmin { z-index: -1; } .zmax { z-index: 999; } /*---------------------------------------------------- * margin *---------------------------------------------------*/ /* All */ .m { margin: 5px !important; } .m-no { margin: 0 !important; } .m-0x { margin: 10px !important; } .m-1x { margin: 15px !important; } .m-2x { margin: 20px !important; } .m-3x { margin: 30px !important; } .m-4x { margin: 60px !important; } .m-5x { margin: 100px !important; } /* Vertical */ .mv { margin-top: 5px !important; margin-bottom: 5px !important; } .mv-no { margin-top: 0 !important; margin-bottom: 0 !important; } .mv-0x { margin-top: 10px !important; margin-bottom: 10px !important; } .mv-1x { margin-top: 15px !important; margin-bottom: 15px !important; } .mv-2x { margin-top: 20px !important; margin-bottom: 20px !important; } .mv-3x { margin-top: 30px !important; margin-bottom: 30px !important; } .mv-4x { margin-top: 60px !important; margin-bottom: 60px !important; } .mv-5x { margin-top: 100px !important; margin-bottom: 100px !important; } /* Horizontal */ .mh { margin-left: 5px !important; margin-right: 5px !important; } .mh-no { margin-left: 0 !important; margin-right: 0 !important; } .mh-0x { margin-left: 10px !important; margin-right: 10px !important; } .mh-1x { margin-left: 15px !important; margin-right: 15px !important; } .mh-2x { margin-left: 20px !important; margin-right: 20px !important; } .mh-3x { margin-left: 30px !important; margin-right: 30px !important; } .mh-4x { margin-left: 60px !important; margin-right: 60px !important; } .mh-5x { margin-left: 100px !important; margin-right: 100px !important; } /* margin Top */ .mt { margin-top: 5px !important; } .mt-no { margin-top: 0 !important; } .mt-0x { margin-top: 10px !important; } .mt-1x { margin-top: 15px !important; } .mt-2x { margin-top: 20px !important; } .mt-3x { margin-top: 30px !important; } .mt-4x { margin-top: 60px !important; } .mt-5x { margin-top: 100px !important; } /* margin Bottom */ .mb { margin-bottom: 5px !important; } .mb-no { margin-bottom: 0 !important; } .mb-0x { margin-bottom: 10px !important; } .mb-1x { margin-bottom: 15px !important; } .mb-2x { margin-bottom: 20px !important; } .mb-3x { margin-bottom: 30px !important; } .mb-4x { margin-bottom: 60px !important; } .mb-5x { margin-bottom: 100px !important; } /* margin left */ .ml { margin-left: 5px !important; } .ml-no { margin-left: 0 !important; } .ml-0x { margin-left: 10px !important; } .ml-1x { margin-left: 15px !important; } .ml-2x { margin-left: 20px !important; } .ml-3x { margin-left: 30px !important; } .ml-4x { margin-left: 60px !important; } .ml-5x { margin-left: 100px !important; } /* margin right */ .mr { margin-right: 5px !important; } .mr-no { margin-right: 0 !important; } .mr-0x { margin-right: 10px !important; } .mr-1x { margin-right: 15px !important; } .mr-2x { margin-right: 20px !important; } .mr-3x { margin-right: 30px !important; } .mr-4x { margin-right: 60px !important; } .mr-5x { margin-right: 100px !important; } /*---------------------------------------------------- * padding *---------------------------------------------------*/ /* All */ .p { padding: 5px !important; } .p-no { padding: 0 !important; } .p-0x { padding: 10px !important; } .p-1x { padding: 15px !important; } .p-2x { padding: 20px !important; } .p-3x { padding: 30px !important; } .p-4x { padding: 60px !important; } .p-5x { padding: 100px !important; } /* Vertical */ .pv { padding-top: 5px !important; padding-bottom: 5px !important; } .pv-no { padding-top: 0 !important; padding-bottom: 0 !important; } .pv-0x { padding-top: 10px !important; padding-bottom: 10px !important; } .pv-1x { padding-top: 15px !important; padding-bottom: 15px !important; } .pv-2x { padding-top: 20px !important; padding-bottom: 20px !important; } .pv-3x { padding-top: 30px !important; padding-bottom: 30px !important; } .pv-4x { padding-top: 60px !important; padding-bottom: 60px !important; } .pv-5x { padding-top: 100px !important; padding-bottom: 100px !important; } /* Horizontal */ .ph { padding-left: 5px !important; padding-right: 5px !important; } .ph-no { padding-left: 0 !important; padding-right: 0 !important; } .ph-0x { padding-left: 10px !important; padding-right: 10px !important; } .ph-1x { padding-left: 15px !important; padding-right: 15px !important; } .ph-2x { padding-left: 20px !important; padding-right: 20px !important; } .ph-3x { padding-left: 30px !important; padding-right: 30px !important; } .ph-4x { padding-left: 60px !important; padding-right: 60px !important; } .ph-5x { padding-left: 100px !important; padding-right: 100px !important; } /* padding Top */ .pt { padding-top: 5px !important; } .pt-no { padding-top: 0 !important; } .pt-0x { padding-top: 10px !important; } .pt-1x { padding-top: 15px !important; } .pt-2x { padding-top: 20px !important; } .pt-3x { padding-top: 30px !important; } .pt-4x { padding-top: 60px !important; } .pt-5x { padding-top: 100px !important; } /* padding Bottom */ .pb { padding-bottom: 5px !important; } .pb-no { padding-bottom: 0 !important; } .pb-0x { padding-bottom: 10px !important; } .pb-1x { padding-bottom: 15px !important; } .pb-2x { padding-bottom: 20px !important; } .pb-3x { padding-bottom: 30px !important; } .pb-4x { padding-bottom: 60px !important; } .pb-5x { padding-bottom: 100px !important; } /* padding left */ .pl { padding-left: 5px !important; } .pl-no { padding-left: 0 !important; } .pl-0x { padding-left: 10px !important; } .pl-1x { padding-left: 15px !important; } .pl-2x { padding-left: 20px !important; } .pl-3x { padding-left: 30px !important; } .pl-4x { padding-left: 60px !important; } .pl-5x { padding-left: 100px !important; } /* padding right */ .pr { padding-right: 5px !important; } .pr-no { padding-right: 0 !important; } .pr-0x { padding-right: 10px !important; } .pr-1x { padding-right: 15px !important; } .pr-2x { padding-right: 20px !important; } .pr-3x { padding-right: 30px !important; } .pr-4x { padding-right: 60px !important; } .pr-5x { padding-right: 100px !important; } /*---------------------------------------------------- * border *---------------------------------------------------*/ .b { border: 1px solid #ddd; } .b-no { border: none !important; } /*---------------------------------------------------- * border-radius *---------------------------------------------------*/ /*----------------------css border-radius----------------*/ .r-rounded { border-radius: 2em !important; padding-left: 1em; padding-right: 1em; overflow: hidden; } .r-circle { border-radius: 50% !important; overflow: hidden; } .r-no { border-radius: 0 !important; } /*---------------------------------------------------- * width and height *---------------------------------------------------*/ .w-auto { width: auto !important; } .w-full, .w-full img { width: 100% !important; max-width: 100% !important; } /*---------------------------------------------------- * text *---------------------------------------------------*/ .lh-2x { line-height: 2.0; } /*----------------- css text --------------------*/ .text-break { word-break: break-all !important; word-wrap: break-word !important; } .text-undecorate { text-decoration: none !important; } .text-underline { text-decoration: underline !important; } .text-through { text-decoration: line-through !important; } .text-sub { vertical-align: sub !important; } .text-super { vertical-align: super !important; } .text-indent, .text-indent p, .text-indent div { text-indent: 2em; } /*text wrap*/ .text-nowrap { /*display: block;*/ max-width: 100%; overflow: hidden !important; text-overflow: ellipsis !important; white-space: nowrap !important; word-wrap: normal !important; -moz-binding: url(\"ellipsis.xml\"); } .text-nowrap-1x { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 1; -webkit-box-flex: 1; line-height: 24px; height: 24px; word-break: break-all !important; word-wrap: break-word !important; } .text-nowrap-2x { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-height: 24px; height: 48px; word-break: break-all !important; word-wrap: break-word !important; } .text-nowrap-3x { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 3; line-height: 24px; height: 72px; word-break: break-all !important; word-wrap: break-word !important; } .text-nowrap-4x { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 4; line-height: 24px; height: 96px; word-break: break-all !important; word-wrap: break-word !important; } .text-nowrap-5x { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 5; line-height: 24px; height: 120px; word-break: break-all !important; word-wrap: break-word !important; } /*---------------------------------------------------- * thumb *---------------------------------------------------*/ .thumb { width: 16px; display: inline-block; overflow: hidden; } .thumb-xs { width: 32px; display: inline-block; overflow: hidden; } .thumb-sm { width: 48px; display: inline-block; overflow: hidden; } .thumb-md { width: 64px; display: inline-block; overflow: hidden; } .thumb-lg { width: 96px; display: inline-block; overflow: hidden; } .thumb-xl { width: 128px; display: inline-block; overflow: hidden; } .thumb-wrapper { padding: 2px; border: 1px solid #dbe2e7; } .thumb img, .thumb-0x img, .thumb-1x img, .thumb-2x img, .thumb-3x img, .thumb-4x img, .thumb-5x img, .thumb-6x img, .thumb-btn img { height: auto; max-width: 100%; vertical-align: middle; } /*---------------------------------------------------- * img hover style *---------------------------------------------------*/ /*img gray*/ img.img-gray, .img-gray img { -webkit-filter: grayscale(100%); -moz-filter: grayscale(100%); -ms-filter: grayscale(100%); -o-filter: grayscale(100%); filter: grayscale(100%); -webkit-filter: gray; filter: gray; } img.img-gray:hover, .img-gray:hover img { -webkit-filter: grayscale(0); -moz-filter: grayscale(0); -ms-filter: grayscale(0); -o-filter: grayscale(0); filter: grayscale(0); } /*img-rotate*/ img.img-rotate, .img-rotate img { -webkit-transition: -webkit-transform 0.3s ease; transition: -webkit-transform 0.3s ease; transition: transform 0.3s ease; transition: transform 0.3s ease,-webkit-transform 0.3s ease; } img.img-rotate:hover, .img-rotate:hover img { transform: rotate(360deg); -ms-transform: rotate(360deg); /* IE 9 */ -moz-transform: rotate(360deg); /* Firefox */ -webkit-transform: rotate(360deg); /* Safari and Chrome */ -o-transform: rotate(360deg); } /*img-burn*/ img.img-burn, .img-burn img { position: relative; -webkit-transition: all 0.8s ease-in-out; transition: all 0.8s ease-in-out; } img.img-burn:hover, .img-burn:hover img { -webkit-transform: scale(1.2) rotate(2deg); -ms-transform: scale(1.2) rotate(2deg); transform: scale(1.2) rotate(2deg); } /*hover-up*/ img.hover-up, .hover-up img { position: relative; top: 0; -webkit-transition: top .3s ease-out; transition: top .3s ease-out; } img.hover-up:hover, .hover-up:hover img { top: -6px; } /*Button components*/ .text-active, .active > .text, .active > .auto .text, .collapsed > .text, .collapsed > .auto .text { display: none !important; } .active > .text-active, .active > .auto .text-active, .collapsed > .text-active, .collapsed > .auto .text-active { display: inline-block !important; } /*Button components end here*/ /** * paper */ .shadow-no { -webkit-box-shadow: none; box-shadow: none; } .shadow, .hover-shadow:hover { -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); } /*radio*/ .radio { margin-left: 20px; } .radio label { display: inline-block; position: relative; padding-left: 5px; } .radio label:before { content: \"\"; display: inline-block; position: absolute; width: 17px; height: 17px; left: 0; margin-left: -20px; border: 1px solid #cccccc; border-radius: 50%; background-color: #fff; -webkit-transition: border 0.15s ease-in-out; transition: border 0.15s ease-in-out; } .radio label:after { display: inline-block; position: absolute; content: \" \"; width: 11px; height: 11px; left: 3px; top: 3px; margin-left: -20px; border-radius: 50%; background-color: #555555; -webkit-transform: scale(0, 0); -ms-transform: scale(0, 0); transform: scale(0, 0); -webkit-transition: -webkit-transform 0.1s cubic-bezier(0.8, -0.33, 0.2, 1.33); transition: -webkit-transform 0.1s cubic-bezier(0.8, -0.33, 0.2, 1.33); transition: transform 0.1s cubic-bezier(0.8, -0.33, 0.2, 1.33); transition: transform 0.1s cubic-bezier(0.8, -0.33, 0.2, 1.33),-webkit-transform 0.1s cubic-bezier(0.8, -0.33, 0.2, 1.33); } .radio input[type=radio] { display: none; } .radio input[type=radio]:checked + label:after { -webkit-transform: scale(1, 1); -ms-transform: scale(1, 1); transform: scale(1, 1); } .radio input[type=radio]:disabled + label { opacity: 0.65; } .radio input[type=radio]:disabled + label:before { cursor: not-allowed; } .hover-grow { -webkit-transition: all .2s linear; transition: all .2s linear; } .hover-grow:hover { -webkit-transform: translate3d(0, -2px, 0); transform: translate3d(0, -2px, 0); } fieldset { padding: 0; margin: 0; border: 0; min-width: 0; } legend { display: block; width: 100%; padding: 0; margin-bottom: 21px; font-size: 21px; line-height: inherit; color: #333333; border: 0; border-bottom: 1px solid #e5e5e5; } label { display: inline-block; max-width: 100%; margin-bottom: 5px; font-weight: bold; } input[type=\"search\"] { -webkit-box-sizing: border-box; box-sizing: border-box; } input[type=\"radio\"], input[type=\"checkbox\"] { margin: 4px 0 0; margin-top: 1px \\9; line-height: normal; } input[type=\"file\"] { display: block; } input[type=\"range\"] { display: block; width: 100%; } select[multiple], select[size] { height: auto; } input[type=\"file\"]:focus, input[type=\"radio\"]:focus, input[type=\"checkbox\"]:focus { outline: 5px auto -webkit-focus-ring-color; outline-offset: -2px; } output { display: block; padding-top: 7px; font-size: 14px; line-height: 1.57143; color: #555555; } .form-control { display: block; width: 100%; height: 35px; padding: 6px 12px; font-size: 14px; line-height: 1.57143; color: #555555; background-color: #fff; background-image: none; border: 1px solid #ccc; border-radius: 4px; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075); -webkit-transition: border-color ease-in-out 0.15s,box-shadow ease-in-out 0.15s; -webkit-transition: border-color ease-in-out 0.15s,-webkit-box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s,-webkit-box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s,box-shadow ease-in-out 0.15s; transition: border-color ease-in-out 0.15s,box-shadow ease-in-out 0.15s,-webkit-box-shadow ease-in-out 0.15s; } .form-control:focus { border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),0 0 8px rgba(102, 175, 233, 0.6); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075),0 0 8px rgba(102, 175, 233, 0.6); } .form-control::-moz-placeholder { color: #999; opacity: 1; } .form-control:-ms-input-placeholder { color: #999; } .form-control::-webkit-input-placeholder { color: #999; } .form-control::-ms-expand { border: 0; background-color: transparent; } .form-control[disabled], .form-control[readonly], fieldset[disabled] .form-control { background-color: #eeeeee; opacity: 1; } .form-control[disabled], fieldset[disabled] .form-control { cursor: not-allowed; } textarea.form-control { height: auto; } input[type=\"search\"] { -webkit-appearance: none; } /* * Component: list * ---------------- */ .list-disc { list-style: disc !important; } .list-alpha { list-style: upper-alpha !important; } .list-decimal { list-style: decimal !important; } .list-outside { list-style-position: outside !important; } .list-inside { list-style-position: inside !important; } .list-square { list-style: none; } .list-square li:before { color: #ccc; content: \"â–ª\"; font-size: 12px; margin-right: 6px; -webkit-transition: 0.2s ease; transition: 0.2s ease; } .list-circle-num, .list-square-num { counter-reset: list1; } .list-circle-num > li, .list-square-num > li { list-style: none outside none; margin-bottom: 13px; } .list-circle-num > li:before { counter-increment: list1; content: counter(list1) \"\"; width: 24px; height: 24px; text-align: center; border-radius: 12px; font-size: 15px; border-width: 1px; border-style: solid; margin: 0 16px 0 0; display: inline-block; vertical-align: middle; } .list-square-num > li:before { counter-increment: list1; content: counter(list1) \"\"; width: 24px; height: 24px; text-align: center; border-radius: 5px; font-size: 15px; border-width: 1px; border-style: solid; margin: 0 16px 0 0; display: inline-block; vertical-align: middle; } .list-circle-num > li > ol, .list-square-num > li > ol { counter-reset: list2; } .list-circle-num > li > ol > li, .list-square-num > li > ol > li { margin-bottom: 13px; } .list-circle-num > li > ol > li:before { counter-increment: list2; content: counter(list1) \".\" counter(list2) \"\"; width: 24px; height: 24px; text-align: center; border-radius: 12px; font-size: 15px; border-width: 1px; border-style: solid; margin: 0 16px 0 0; display: inline-block; vertical-align: middle; } .list-square-num > li > ol > li:before { counter-increment: list2; content: counter(list1) \".\" counter(list2) \"\"; width: 24px; height: 24px; text-align: center; border-radius: 5px; font-size: 15px; border-width: 1px; border-style: solid; margin: 0 16px 0 0; display: inline-block; vertical-align: middle; } .list-circle-num[class*=\"list-full\"] > li::before, .list-square-num[class*=\"list-full\"] > li::before { background: #de4a32; color: #ffffff; } .label { display: inline-block; padding: .3em .6em; font-size: 75%; font-weight: bold; line-height: 1; color: #777777; text-align: center; white-space: nowrap; vertical-align: baseline; border-radius: .25em; } .label:empty { display: none; } .btn .label { position: relative; top: -1px; } a.label:hover, a.label:focus { color: #333333; text-decoration: none; cursor: pointer; } .label-default { background-color: #eeeeee; } .label-default[href]:hover, .label-default[href]:focus { background-color: #d5d5d5; } .label-primary { background-color: #2196f3; color: #fff; } .label-primary[href]:hover, .label-primary[href]:focus { background-color: #0c7cd5; } .label-success { background-color: #5cb85c; color: #fff; } .label-success[href]:hover, .label-success[href]:focus { background-color: #449d44; } .label-info { background-color: #56CCF2; color: #fff; } .label-info[href]:hover, .label-info[href]:focus { background-color: #27beee; } .label-warning { background-color: #F09819; color: #fff; } .label-warning[href]:hover, .label-warning[href]:focus { background-color: #c97c0d; } .label-danger { background-color: #FF512F; color: #fff; } .label-danger[href]:hover, .label-danger[href]:focus { background-color: #fb2900; } .panel { margin-bottom: 21px; background-color: #fff; border: 1px solid #f2f2f2; } .panel .article-title { display: -webkit-box; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 2; font-size: 18px; line-height: 32px; height: 64px; word-break: break-all !important; word-wrap: break-word !important; } .panel-body { padding: 15px; } .panel-body:before, .panel-body:after { content: \" \"; display: table; } .panel-body:after { clear: both; } .panel-heading { padding: 10px 15px; border-bottom: 1px solid #f2f2f2; } .panel-heading > .dropdown .dropdown-toggle { color: inherit; } .panel-title { margin-top: 0; margin-bottom: 0; font-size: 16px; color: inherit; } .panel-title > a, .panel-title > small, .panel-title > .small, .panel-title > small > a, .panel-title > .small > a { color: inherit; text-decoration: none; } .panel-footer { padding: 10px 15px; border-top: 1px solid #f2f2f2; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; } /** * panel-group-base */ .panel.b-no { border: 0; margin-bottom: 0; } .panel.b-no .panel-heading, .panel.b-no .panel-body, .panel.b-no .panel-footer { border: 0; padding-left: 0; padding-right: 0; } /* Badger*/ .panel-badger { position: relative; } .panel-badger:after { content: \"\"; position: absolute; top: 0; width: 0; height: 0; border-width: 4px; border-style: solid; border-color: #777777 transparent transparent #777777; } .panel-badger:hover:after { border-color: #2196f3 transparent transparent #2196f3; } .badger-danger:after { border-color: #FF512F transparent transparent #FF512F; } .badger-warning:after { border-color: #F09819 transparent transparent #F09819; } .badger-success:after { border-color: #5cb85c transparent transparent #5cb85c; } .badger-info:after { border-color: #56CCF2 transparent transparent #56CCF2; } .badger-primary:after { border-color: #2196f3 transparent transparent #2196f3; } /* bg shortcodes */ .bg-gradient-info span, .bg-gradient-info:before { background: #56CCF2; background: -webkit-linear-gradient(left, #56CCF2 0%, #2F80ED 80%, #2F80ED 100%); background: -webkit-gradient(linear, left top, right top, from(#56CCF2), color-stop(80%, #2F80ED), to(#2F80ED)); background: linear-gradient(to right, #56CCF2 0%, #2F80ED 80%, #2F80ED 100%); } .bg-gradient-primary span, .bg-gradient-primary:before { background: #396afc; background: -webkit-linear-gradient(left, #396afc 0%, #2948ff 80%, #2948ff 100%); background: -webkit-gradient(linear, left top, right top, from(#396afc), color-stop(80%, #2948ff), to(#2948ff)); background: linear-gradient(to right, #396afc 0%, #2948ff 80%, #2948ff 100%); } .bg-gradient-success span, .bg-gradient-success:before { background: #44ea76; background: -webkit-linear-gradient(left, #44ea76 0%, #39fad7 80%, #39fad7 100%); background: -webkit-gradient(linear, left top, right top, from(#44ea76), color-stop(80%, #39fad7), to(#39fad7)); background: linear-gradient(to right, #44ea76 0%, #39fad7 80%, #39fad7 100%); } .bg-gradient-warning span, .bg-gradient-warning:before { background: #FF512F; background: -webkit-linear-gradient(left, #FF512F 0%, #F09819 80%, #F09819 100%); background: -webkit-gradient(linear, left top, right top, from(#FF512F), color-stop(80%, #F09819), to(#F09819)); background: linear-gradient(to right, #FF512F 0%, #F09819 80%, #F09819 100%); } .bg-gradient-danger span, .bg-gradient-danger:before { background: #FF512F; background: -webkit-linear-gradient(left, #FF512F 0%, #DD2476 80%, #DD2476 100%); background: -webkit-gradient(linear, left top, right top, from(#FF512F), color-stop(80%, #DD2476), to(#DD2476)); background: linear-gradient(to right, #FF512F 0%, #DD2476 80%, #DD2476 100%); } /* Button fancy */ .btn-fancy { display: inline-block; font-size: 17px; letter-spacing: 0.03em; text-transform: uppercase; color: #ffffff; position: relative; } .btn-fancy:before { content: ''; display: inline-block; height: 40px; position: absolute; bottom: -5px; left: 30px; right: 30px; z-index: -1; -webkit-filter: blur(20px) brightness(0.95); filter: blur(20px) brightness(0.95); -webkit-transform-style: preserve-3d; transform-style: preserve-3d; -webkit-transition: all 0.3s ease-out; transition: all 0.3s ease-out; } .btn-fancy i { margin-top: -1px; margin-right: 20px; font-size: 1.265em; vertical-align: middle; } .btn-fancy span { display: inline-block; padding: 18px 60px; border-radius: 50em; position: relative; z-index: 2; will-change: transform,filter; -webkit-transform-style: preserve-3d; transform-style: preserve-3d; -webkit-transition: all 0.3s ease-out; transition: all 0.3s ease-out; } .btn-fancy:focus, .btn-fancy:active { color: #ffffff; } .btn-fancy:hover { color: #ffffff; } .btn-fancy:hover span { -webkit-filter: brightness(1.05) contrast(1.05); filter: brightness(1.05) contrast(1.05); -webkit-transform: scale(0.95); -ms-transform: scale(0.95); transform: scale(0.95); } .btn-fancy:hover:before { bottom: 0; -webkit-filter: blur(10px) brightness(0.95); filter: blur(10px) brightness(0.95); } .btn-fancy.pop-onhover:before { opacity: 0; bottom: 10px; } .btn-fancy.pop-onhover:hover:before { bottom: -7px; opacity: 1; -webkit-filter: blur(20px); filter: blur(20px); } .btn-fancy.pop-onhover:hover span { -webkit-transform: scale(1.04); -ms-transform: scale(1.04); transform: scale(1.04); } .btn-fancy.pop-onhover:hover:active span { -webkit-filter: brightness(1) contrast(1); filter: brightness(1) contrast(1); -webkit-transform: scale(1); -ms-transform: scale(1); transform: scale(1); -webkit-transition: all 0.15s ease-out; transition: all 0.15s ease-out; } .btn-fancy.pop-onhover:hover:active:before { bottom: 0; -webkit-filter: blur(10px) brightness(0.95); filter: blur(10px) brightness(0.95); -webkit-transition: all 0.2s ease-out; transition: all 0.2s ease-out; } /* * Component: table * css like github * ---------------- */ table { border: 1px solid #f2f2f2; } table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td, table > tfoot > tr > th, table > tfoot > tr > td { border: 1px solid #f2f2f2; } table > tbody > tr:nth-of-type(odd) { background-color: #f8f8f8; } table > tbody > tr:hover { background-color: #fbfbfb; } table { padding: 0; width: 100%; max-width: 100%; margin: 10px 0; } table > thead > tr > th, table > thead > tr > td, table > tbody > tr > th, table > tbody > tr > td, table > tfoot > tr > th, table > tfoot > tr > td { padding: 6px 13px; } table > tbody + tbody { border-top: 2px solid #f2f2f2; } table table { background-color: #fff; } .modal button.close { position: absolute; right: 10px; top: 10px; z-index: 99; } .modal-small .modal-dialog { width: 480px; } @font-face { font-family: \"icon\"; src: url(\"iconfont.eot?t=1525101408939\"); /* IE9*/ src: url(\"iconfont.eot?t=1525101408939#iefix\") format(\"embedded-opentype\"),url(\"data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAD7sAAsAAAAAWwQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW806XY21hcAAAAYAAAANEAAAIGLFwHIlnbHlmAAAExAAANNEAAEiYkGD74GhlYWQAADmYAAAALwAAADYSZuy5aGhlYQAAOcgAAAAeAAAAJAkLBTVobXR4AAA56AAAAC0AAAGIiyoAAGxvY2EAADoYAAAAxgAAAMbA6a6WbWF4cAAAOuAAAAAfAAAAIAF5ATNuYW1lAAA7AAAAAUIAAAI9Divfm3Bvc3QAADxEAAACpwAAA/BaS1xneJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2Bk4WCcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGBwYKt7MYW7438AQw9zI0AoUZgTJAQDiFQwleJzN1UlP1WccxfEvg6iIivMInehgi0oHWkoROg/SQmeQtohujG6Mm4ZYVi51KyUS2NSEdNU0hjRNF41peAO+BYzn/kl8C8aeh8PG2qQrk/LkQ+69yX24PM/5nQusAxqs0xr9cIo6P6L+e79at/p6A82rrzfWH/fzcd70e9qZVLsOqUvd6lW/BjWsMY1rQmd0Tud1QVO6omnN6LoWdVNLuqXbuqN7teZaW62jNlCbr0ariep0NVPNVgvVjWqpWl7pWbm0Mn937v59/51J4f07V/fv8/5DGlnb/+zq/hd1WVcf2H/5of3Hvf90de1f9390P3U+o3FmvX5aXQteP/PL2vp1dS3yG78/sP54aP3p9RdL/1hl/0520sEBenidY7zNcfp4i3c4xCv08wK7OcIEW9nHUV7mIG08xWO8xGZO8QYf8zgfsYkn2cOn1Pt+P2QLu3iGDbzL+wyxg/do4Tm284Rver9zMcAH7OV5PqObLuehZOBFmniVZxnmJNs4zHp6eZrP+YIv+YqvGWGUE4zxDZ+wkW/5jtcY9Mm0+l9oeqQ38B/X8z/5aSm/GufWnp2yyTX+iCLKXKoufOuoPnz/qCGcBNQYzgRaF04HagrnBK0PJwZtCGcHbQynCDWH84Q2hZOFWsIZQ5vDaUNbwrlDW8MJRK3hLKJt4VSi7eF8oh1Bed/OcGbRrnB60e5wjtGecKLR3nC20b5wytH+cN7RgXDy0cGgfPa2KGeu9vBcuG/CE4I6w7OCDoenBh0JytkcDU8S6grKZ+wOTxfqDcq99UXpWx0Lzx7qD8pZDgblDIbCk4mGg3JvI+FpRaPhuUUngvK+saCc8Xh4qtFElPTpTHjS0dmg3M+58PSj80E5pwtBOeOLUb4z9EO4JdBUuC/Q5aDc1ZVwh6Cr4TZB00E5s5mgnOX1KN89Wgy3DroZ5XtLS+EmQreCkvflcDuh2+GeQneCcpb3wt1FrTncYtTawn1GrSPcbNQGwh1HbT7cdlSj4d6jGg83INXJcBdSTYRbkep0uB+ppsNNSfVjUPabCbcn1bVwj1LNhhuVaiHcrVQ3wi1LtRTuW6rlcPOy0hPuYFYuhduYlflwL3N3Lmj9G/Y/t0h4nJW8CZwcVdU3XOferqqu7urqru7qqt737pq1e6bXZCaZmSQz2ZNJMplshKxsCQlLAiQYwho2UbYHH4UgO4OAig8gimIARWRRQRFFRMQHF1A/EUVZTBffudUzISrv9/6+6e5b5y516y7nnvM/594ajue4D39NH6EhLsC1cb3cMLeM40DohIxC4pA2q0XSCcE0HzQ0hZpZMy1mM0U6E4yMoOnlerVgCKLgBQUSUEmX62aRmFCrDpB+KOtxgHA0MubPx/z0anCFzMTF1kJyGwST2Zh3oNta0DWolVMB5x7Z7w/7/Z9yCjzvJMThVWCnoUu85BKsO3hvJPhIsp0kQQ6bkcVrPamof/Nl1VPieUMCOP98CERTyl2DakTF7zkRPeAPiz6PMxTxZHMa7PmNOxSQ44XXOfxjff0c/R49gVM4Pxflclw3x+XTatpM19K1rJpWKyqtpYOGAq2+5f+DIAm4wjoLoMd6/rPWWz+ZSRzHmJXKkmrVehqvSysVy9+6fhE+eczZx1g/ss6y/gR7HnnkEFSWVqtLK/Bv16l2XUV/SRcgpXN5bNV0bFehhGMaGACjCGYBB9mfhFqhzmNMF0QFQ0djAPKCbvSaWFTPNep+s+AQBQIe0emlYTLrIYlcdML4TbzLvMVJCXlDSgLZddWOlwZfgvtVojV7QdIdTl71wql3X+1zqdZlnz8QPUdwejUXXDxxtoMkJaoSnzX+kgT9T7696mLqvHNWu05vKUrCfUUSIQ6RD7vUq74AWxTJd9GN1mUc58C+fIk26Bjn5FQuwi3FnlQLLWZRpwh+imho2DGRdSeOnQ1qQqZQq9YbahF5qF7WMUFU640BvjaZAHszPZkjXzjQuvanonBZ+4ql5WhyePNwKhpN4SUZTc9Mm8VIyGWnZsKZTG8mQ34Ssq+1kF1HKFX3fnmJEQnnO3zeeqpneLgHU+CvH9HWj30Bl9cI53uSrUScL8omjV4MP+QkXDVxXC9T7GGmP4YiXLqra3ZXV9p6ZpIgOycJ+CGw6+wu+Pcr13rOh1+gr9JjuRncHG4hPqdShE6oD0KFPWAAGgV78Qk4RNCoGLqYVSBYUQDHUxR0lohfYwBKINYbAbViNJDBs6KZVSsw/kMSIA84iOMeQbFeBMPvWBMNh5Mk4fbM9K2nBA5pvp8LIVWfg5HuntUpNeV5gHjdB7oD/PuLkhfevmR8ezj6N1iYbxsZOckxyDs2ZR3p8bXVQcnB09LMC8fi/mm0tDVV2rYIZEo7BtLLOp8jc3quS8+ZDtc3G6tWkaebF82dS7qn+vobej3tQkrhOjguoGbVhs4EUcGeeYxWC9kMdjioZuu+mlkJZgdopaz/9ZGnoL8HStP7N/SRGx4p9uZ6ZeERgEfAHWrvz23eQ6LNZ0j9vo5p01Y2GlbNegSKM4bNuBq3nvgNRKOxFf5oyn/hkXm1yB2cmzO4TntexQTgADaKQHHhIYFRBWi9UcgeyauaglgEwl3+9oFT37jrHmvVGusLq3cTsnt1KwSfUyoPAwyXWRiIoDC7HW64bM/dVHzk2O0PWQFy1po1ZxE7BCOqAYxUKiMsdDq9AO32mrqc7qEVTuZ8nMYlcE3h0ugEsZbOFGZCPpiuTf2qdRTDOt0zt5y52TpUnkv+1vRM/eaWCS3PfaG9Ov+OO+ZX2588ePCpgwfH29qq8+dzBJ9xH/0RXYQ8jfVDfXKJNkATQciYUISZUK0zsW6ADqVQcVZ39yyd3GZYL4YGDWuxkSqmmqlRAx4wyHJjqFgcKhrWSynMNgx4UB/FzGIqZC0NcfaznkF5183N5bbis1B8FQFnFoQgjmgZmbZSNnRDr9iDiwOvgBHQgzjgGbNgtpggyyRCAwZYewIJvJq8zu5psLVQBFwUosAKl6CggG6QPxR8W5SuepdineeC6R356Oxb1y6Zt2FRLNcxDdw3CVqA52/iIar5Pcu3jY5veWCB7A9GHXCeGIzowmftfOs0X6F/7sJh0+fi3ZpL9mr9QzMrmuKWNJmX4G9zYvcYkYjR3KAHO6dBqG/ASM02YFpnKAi6JLg1yfqjJAej4F6QiQzPckM06JbIzW5ZdlvvYY0B15Mub5BA2OtijxMEp6gDCQioFh0BTWiN2x30V3QjF8SR4yTsp4kLHnCeUCZIKEEb9aqZwQXCmANlpsmYNJhFoaqyAQ6qOLwVlckKJFQ2vJhOX7RW4fgGdWtc8utSHK6FL7p0p3SbS4kGt0OlsMmswHYtCh5NgYp5E0SCqzB2E6aCBw7CV0AlRAVrmRTyO/H2q6zlKNFdobjisk7RYm+YVYCq+UZMg2tdCqZtYzdqWAMONurGigmfdSl2356ij9IZqJkZf5t1YhZyqPUM1HMGE6R5oWAWsYe6kQB6361rAts/YX3v7F3kjFMhuedWX3vC+t3aN9atgpV2mLplLyROO4PsOtv63idODqy91Ztof2ElrFr3xtqVZHzdG1My50rkw11IuVBbcRIVJcBv7+SFcFYOXoFXMtZca27mXyl6unWLdQts2mM9DPMi/0pxLT14M/013Yw6sMwNMOnNM+6tIeOabApwlaLAVnGC0qJAcRpVTTcqDDQ1cAmzqUFxR9NM+rEVjZrwKBoaPO+B21pDS8VAxhMBRAfWphvF7wTCEf833J5PYAfuCYQh4r/Yoi6PxwVNe/g/ojcR0Xsu3kV2YT1eTyzfvKpQg6sFxGphf/NKfxgU18bTBYyQXf6I9TtFU/D7ZOvCxg+V1IfvYx8FxI2IGUUtiBgxmzH1SrnBYIp9mYmrz16ryHJMuePSrjcEsU5fa59e3Hjh17fdeXkwcvmOoRP8mhqJjKxt72kvRRe+cDa/e8V4/+x+Y2g6ubu/Q1JHb7rmtNlryEpY3E9FZcc8apDoqkqteMxOwdBX7B7wZOYWhFabJuhZtMRtwAiqyXqBoadCBkU0qkVDCCJiEisMcuBMMAlufxuCzpSmXm/UCy3a0OuM3XShwWqo13SBFWNYjKWblewA0DPjca/qKK+Q+/+7Txyv86pvOpx+DkDa5Y8HZswcFuMeWZaMNf1EkKSYI97v8WpRXvYIKlnqcwBRnLCWBgRZCimiNC8k6U7F5eBDLoD9pxPatSxdX+IknS6fTyyBc7QxZ+36ywwIlRyS+wSXX1W8OTUfcWdnhb2y6vKHe86N1c8oKgGf43MrXXGy5hvgDfq6zyqnTy3FUrosK5nd5XhCDV3G5g6H6sM76S/oMahTOlDXTeNWcGP/qvFMjGTTNiibCVnGfP2g2rBMZczbCwIn6pxR5xoFzmTyNsMGplBloKNeZuOqaygJcBUdfM7heO5gK4QIuCXrXbffHXTKsjOIBEiSG6zfPWP9nefB/cwz4EZZ+/dnYNrM0RUPrhjdl85m0/ts8hMZJAfIn7GeG3/ocPzwRqzT2uuUNcnNhLAqg8Qqtd6VJXiH1XF0nYf/PPBvNbXImWw8RBtrvUZXo/wJIwbv5WZy49wqHBEGqkRbchotgZlVGYBqqKh0kL+yDOcZgXqRoM5JkEZAVwgqnQFi5As2LqszsTXAmMyGZQWzl8AfJ9IM6qUn/ti6/uCJJ34AzwlOp7BFEEVhJ0+9PmElTxWVHz+K/pATBCWbc/BtpsfpC3v6ZgrizLIcFujKP2At1vewtj9CV4Z6Ml2H73odpr3eJLAFAvEAtIJvOrSITHppMOwhTe6jCH1YCfHqzLaeJX4pHHE6MzuH6+vQsvPYcuw25JONXBVl2AZuO45IC4VpqG7LDUbohg057RRcQKh4mEKvtnrfQAvSrFAby+NCqjH2GGTjgSqeMuyfYakFLMgYJqjla9lgNlgJVmqVGrnkn+XdtaWN2nGBoNNheLountnomD3rwE1jy0mf2SkFNTmQVuLgj8blpTOSx67ZOn2GImfVaPuo5JPnOXlfutccCLRBPF0x+/0FOH/owIGhi+iGcNeiYxf34QrW3Wq0zQ96NrUqM7/SALJg7vqh0VRWCrclZDWttc3JNzriYvOCXE/fYoDOztmZkJ5wuj0SkF5YFg5lSE92wXC1ow2gO7dokXo9e8BFQzY/vUffow4uhnZ1FTXAPG4tt5ehnQFi23PY5YJoD5y9VNB+KwByx4Ct4hBjMmGFKoJJJCyMo1lHwd8QGC8lQMij8VTDHAbSKnVd1HRasO1wNh0NVtjQmWmAuVhFb71Afh9xCIFE6YCYJU46bfOJV9HpXqq/unc/cI32jdanz76F0lvOPvtWSm/93GkZAeTU3PPzhf7PG4mYHkkk5jq9TurzOR1wrksBx6Vut6K4Vyi819m5wMPLKGpkt9u3r0cXqYMGfR6Nmgfgk6JG52SzOcEdTZjDic6D0opt5JJtgrTlpBM2WPc5jlu+bKfIr1624mxo0y+TSK+WS/Y0rv0pCRZSlIQK8cU8KKqHetTXZInui4le3es+VnIrUJJEShyaxxcEgnZofG59luh2J/wgB6//PNfCSvfTP9ElnMl0LzIXGweUTzaMRz1rBFEjMLDUUgEKk3BmjUc7KSNmG6ilsJhRx1KFbEEIGij7xGwhqweNzcllHakqIYvqM1YAOXBcbVtHJTK3LdsGc+vzlwG5dPusU8pkJwCJGElI6BFKdqycvyCfSkVTkGork7KZInByrB2S2UI6GFq6YNPaSMS7VTMgFsuk/JGli7auz+e9a2JfhBBcALtPXg8Q107wQ753E8ZP/tJTk7r3egfQExGvcxDwQCDPB7rRCrkJtnzIzbCesJ6Y8SEHW+iJ1qOVD6xbJiZg0weV1n376Ad0O1dAlGXrROZMOEpUIUvZgspGXnYivXp2WdfTKXLuHbshEczx1OhNpYLGnEIuSeVZX3kcDqzP9xKh8FSHwZNYya9dd85ZUX8yrSwY7olAOBHqz3Rbb//gqdNmxI4xjfKUz+MK+hd6MhfFGaqhfbscG5exYWs2jU1gEpfBoNqkMlIxz8at2DZarqMxggZKHGUvczu1YiLOJRooR+fRuqCakI00r4tkgWwbhTNGTyKD+INto7y/DQbqcwHn7T2P3x/x+z3WpxihAqieb0wmwUsD0Ww2YhVHtxGsIIW1LB3dTqxn3oPhegPNtL/4PQc9qoqB/+Mo7Ksb+/ok/RX5E0oFr+136uGmc0u4Y7nN3PHcNhyMbA0FXsPgs2bDQMGXP8rWNKf8CPzHJZpZBvPTNsyvMVSJ2QHbKGxBRQOtpny6lga0lpnFDPPOqXVUuuGL+we7ezpqzc3lWYTMKvfOBpjdG83larkcebgVO5JWz+WKNcjHrFmxAtTInAo8ioZs1+F/yl6vTHk32qjepos83+yBQ9Om/Wb69L5t1WXxk46PLa7efqTu8qz7IYs11bMPfEya9zWsGgqx116rzCH4hOaXve473V47qJ0Kq6dPnz65pq+nH9LjuSJXYpLUzFMEdpRHUclTQW/keTRY6yZFa0gXuqFeyBdyBo9L38zXzV76T+qy7rqE1/hLrLtczNwcJaoEbdDmkHgnGQiqfv731g+g6L7A+gsP275n/Yjc/ikJkQ2Fv7lQ6A5KkvV4AgLi69Z9Lpl/4AFCBRe43bKHb1dfBs0tmJmXwZt7XZTsdXYL/V+6CbkbLTXbaIWWqK+oKNcrKi45ZGeRmWE12xbDhfa4dV22HOpSreuigkATqRHoKd9AIHR5CMj1ldJIKk4FAR6HfTm/37o4UXQ7vWD9rLqCQrtWIqQYtH5GV1ShHbxOd9HGeF+iL9AxtEHq3Gnck5AHtur7Icl7+RI/yEMlKXj5LJKOCjYs6VAxLmZLAibVBvnKIFEHBdMbDCYDg1opWEnqXqOk1waDvfAhcXhcEiUEqCSgCSs7eR5pJ0phmE2dTtmOAuZJHlkQHA4CvODyCtajDirxmOkUBNGBtzt4QVIkRXB5JBH/DqHd63Cg9BQw/VGnWwTCOwRJcLkTWjwfyIZC3nhEDfrdWCdFDO0QecEb0P2ReCgUiRQKWiKZTAQCBX8mbMQjAbdXERUXDwSrESWfx+ULo4L0hTOBWDze7pJDhpFJ68FEPB9OBTW/DxvLUwpAqVNyKj45EBRD4UggkEimu7JGLpTNdqWxdCASDnm1gM+FY8Cz4rzk8vvQhPOF1Hxc69DTmWzuJGQP7IQXx0IA7L0oeSWXTc9hAyU53W4Hi2L/eJcHR1DkYQFQh8Ppsn6L9r8bW+DyyE5JclBM5nnRDVTgnbbLlCfUjf0yBEFyYHYMCBXdoupV3ZG4kcpEAwENG62xtvpzmZQRjahej+zBGcMxc/AeJxaNRA1fKOLPmXEXDlo8EctGfKGEpqlurypKIk9nt8ZBwqJ6KhyLJYKpLj2Ec5Blo4bjHIs4Q3pQln2K2y2wcRAQiPtUOaiH1Eg8Hkym01kjFAoZ2XS6IxGLhX2GN4LGCtbusH2cbE0fpDfQDba3mIO0bRG3bORKGgc0kADUomBkyT4kYpFmXyQGeIW74m28i3+Zd/CHidR8OpgGIRak45G49XIwAkMO3vELzGfPcOIznkY7fzZK3zauHe3xCjfEzWK+aRAcCJ0MMY8gKtco5ALMtZQpgdhATVidNGSIJuSzLXmbEfhsgpQR+Rchg8s5qyXgSAw+fNb6Gz86EgR/3nwWPGjF/G3D9EWjqzIZ73eUyIxZM3ctWvql0UWnDww0n++JtUWjbTHgekE2woZsBx/2ePSI7rEDOpv/9d2rrms8tZF3/Pqeu3/dvKIUjfFk+DK9dM6lZ2+M4t/Gsw+c/YgWjbZHo0FPUFGCURYoH5EtO+9i+grdj+MbR0uvwQ1z61Dj4BDX0JizFYaqY6+BSaU0c76Zap5BoQF7B0cTKi1t8jGRALMJGy31bPsmbN1ELrXmrJ+vesg3PD4AV7SteS3Jj8C3SrqPB4vKTLuGVfVrssouX/fYl9uZtpy2CGDRNEYt30nIzk84Ti2RiF1ebv5cmpXqJDdZvGdcCGnthMhnq/KdHp/PcydW9DFU8/tYL6tv2iKCFNmxYvnOSb/M48hvPVwXog6GyhF1FEweTVUeOa6FL7A/jbztIGAaF7Vo/iPX7wC0PKNHfP5HCCoWBjXrEbQ3h7XBwsAYwNjA4AoC1j1ab3xgjJCxgXivBquArBhs5WZKpZFisflipljEK+nM4rVUIu5M/It+0//FeKZVA5Z3fNUfZLetIEH/Vx2ttIEVzb8Du2GkCN8DVgMShcmUqbX1M3qIdnMphvZA80JAC2o2f9s7LY2AbZDlkcuTwOt8owSqQQ95v1PSXe6335aDbih+R0mAstedcp0NnqT1mztfP/4Z+F9ZOWS94xCj4rnniogBnCAf8ro13nxH198x+Z/cnPlB858n28+/EzHeGi7EzcbnM+XHM3snYDIPbaBeKEEeBxYRN1qCqMWTgNaDgBZLI4/rjtcrZVTmhUFU5Ga+gFSWcPv5oAf0pyWJ9Lzvjrjf7yGS9DToniC/3y18UnBaT7sF8TWR1MCNchF03smD5uCdbqiB+CunIFvPuuknBTfNHJa9pP27Ushj/eEigTgvwkpC0nfbwSdDr8v6nUi7SND1suC2npU8QD5DyDUErb6aS/yFM0g7iRNCrskx/h96Iz0HUd0cW56Yk/b+pO1m23qGrgDzIjXqOUP384XGlD8AC7dMQMW2TGwYTk9uWG9f356TBW9ETqTP/VXRPGXfub/qDruJL6YTUVKmgXL9Zy9u/lVweldXqxWPsrraFgpvK9cDxKHLTpk4EwsLu+C0zxwoKbozEhLEgNvc+Yn9v+w2d+ybu1AJOrxK95pOzJ5mvdMTilTKsjJexdAd84zUNv/AmZQJSO7CX4/vHJ30k95s70MtQxt2i428EM4MMD9RlZlHLRJNhwLbCRFtj3uduf0wwTZPGcmsiiBKc7bGmGuwPrk/FUAUyzzZlJVj/ieU/EaFPkE72i5du/E6wemSne4v71g5ITol6nFqf1+x4u+a00MlpzixcseX3U7Z5RSu27Tu0rYOKnt6wOd+4BkqukSEB8qTd7t90OORrWTxvn1drsp3DsC1++4rHvhOxUVeIBBIlKME3KqLZIbmTQMi+ySAzQcu2kIIQgWAafOHMpjvk0m0ktAAQQlKogvcXs9mUaCEete6wesm58oqaSZiM1xkPjGHrLg0M0qGZ5nEtnG+RP8LMaCLC6Lemc2dgGOnC2bLhg82ipPW/wAEisQsiAoRE8TQmXskoFCR8UyRIosgnE2h+BECAsUibF+jyHxMzMtiDlBcH426wdziZJCfk9BV3exIzXCePi3XScjKk+Ze6G4Px+76fCiac6nVVObCcyveWi/vdIa13j2n9UfaSzlZ8VPX+TB8vkylE5VeGg77r/7BlWOSLBKECwwighpIuaPzT/753WszOEafyXX6XaWiJmR0eeassG/ErC6QVsN2r8bz0ZhDCHh9Gu9QfSLRmo8rfYUOORolLoccSGiN0yR+5UoaSJHUJutNNeGT5gd9Q6IvJBpe/v7slg4loqq8K+oKliOdcnbKz/w05egFnIaRYJbZdhUxq+KnVrFdyuTDtb3ZLxjX3HfNNXu2rqRnf7a9fcfd1lK4/+7928+c3Nd7hfwdbWWdMzguwLSehKPcOGJmqrxg5i8g/2yrg5WzsqTWthHqba14yS1bJfIO8rrVBGJW4VGr0cZc723wzLuC8I+pvYSH6Zt0K9omVa6v5Um1GdxsGdlTRFahRmsF1Bv2h4k3ZqMIBSYwUMN8M1gPt81Rgyi3Qs7qxYtCOQcJSUuvWDx+/elFWX/g0nT6lK9NV0I7SgLiZ+3weYHNwqw+y/3TheR2+Kos0/TSnqFzhtwO18JjlO7jah6nc7ROFlxy69ilDxj8zuND6sLdql/yeD/Vlpp+Rj90N0KHkEO5Dw/Rx+kgWqtxtFmKiBMWcxvQOt3HXfWvfmEDdYjtLDfYajfrDZ0imc2YVbNOy5hYqAWYx535+zCT2TeYg/xrn10whGDD9nJprGS2VQ8t1LBkkj2Fz7TumvyhYAywBIPVUrCrwacLhDt0mOcPH3qUhWlZjyBI0GJ9izxzl5WK9VmzR5IJ6Dwxk+5qJxek2nztCXHfSbEZghjJOrLtvhXWnlgKcm3ecFeb/5tX0FqXxxfJAHhmuB3gOuU8qJ09G9oWXlw7b7vsTar5/NZjgnr94adXj6QNrMKPKmLOYjVHB6Za8Oihwyc4xcEZfFqPqOXuWTet6zB81ni1IBNBaCOUVw1dtxZ3F9xBf3zWttUEMhGPO5s49vZ/dm+blojOmfdgMv+pbxupVK5LxDzdt8q6OZvtnzY7TrMl6YJyV2SuCDoF3SVtOA3kzuFKH2A5f1xs9E2/+dgZDWXSp3IPfYnOQG4UcR6jXIzxOiJjNa3a13rDFMRswcQxx2gtPUpPP3wVzTXN7URofgA/6unY3t54uLt/84y89Ta93WrSGVutAFxs7YPMIetbCzYVdh179qrCutEtWyb3EO7ju+lyzselEUkt43ZwZyKv9PTaZzumQS/bddRq+f9IyNicY29fijbeannRyw3dYSAOZzxTLSAgaAlKJuaYTGy0wFgLpqFZQBByT/lD4ctsIwFY8DtZZZQqAwo3T+cdO/sXCsLC/p13dMod4bZarc3QJNB++BxoTi1k1mr//KkjlPCJoaQX3px4BU1Ph8+TOGGgNJZMregZOD7p8aFh43gFdnnDoi8RFrzQw3bS3IqCwOIIdXs8dOxnc6GxWm0slPvssaE4DG4aBM/1/0PI/1zvYZFrZUkOhfFn3UwuOVXyGw2tqwqpGLJitUtrGJL/1EtgjiCFQzL+JuXe4/RHdJSbgfOYsLekapO7oGwzivkzcd0UbG8vAqYWqNCDCOcTYLu/2BERzhS4bnrvJ1UeTqhStV3saRhDuhTduRXKitdRWiRUD1Tc87sciqcCx+0MBB3yp75MeOuDJ5+03of9B/9YpqprmbDcbxiu8HicF/OR4N7lS/t7kCM7BEWRCkQc7ukbXbEn6O+NnSm6e/9045Mg8A7r/ck+3Iw68FjUf0yKtLYKjCk4zURewnY8tlJsD6RZLxDuijudrj6vInn8A1Qac0irnLE3c7k3Y85VkmNMogN+j6R4+1zOz9P18NyjwesqvdtFukpcvxEgHwqKaCwHQ3mAjevFVVTc3lv5jPbgz4+c8XiDNLkw8iy2KVBRGTuxoUJKRUY0xCzbNcyC2gIjeRQ5KrYqZMovP+Tr9D30c9ms/OlGIqwQ+BvertADd38tD59v3vfmjfmv3U2eaz5EB8LhAUoWNq/iZ7udTucIT25qPuaoJEmXb4XTucLX/Emy4miNzT10H92JdggXQP7XbaiLkzo1PLgyGNNXbZSIKczyZ4re9ssOwpGdOgUunt4XFN3UIagaXHvB6XsANi3vrkpKhuQLpRkAPkjFXV4XJU4qzg86vX7fouInbyPk0O1PP0MCC04Pi3qXS5YC9eyOGxzkrGP3TThgRnf9RDNXBLJ00OyBS/aU5p0v80Cd24bDM+bE28Dxo4nzH3Y4X+SOjOsh8lvbju+wfV62X1LVDNDL2LFqXmgd5dF4YKOroznSyqCKtU9yW2/KXpDgYrXb/2e1+Qe1O5PpzpD/svY55WG40ud7y86A1XCxE7sjW3+QndY+Vf2zv/slNcMKv8RyrF12MZZsy8Pz6SX0fNT6EW4Rt5o7EQe9YYgG+4mmaDbsX8MwGzTdSOcH7I0rtovCLBF2wKaCMItpaNRN9naKmGUGsMk2WVA7UV4stErTPLBjKq3ZsX158HuvV/ckvemar5b2JnK6z7cgsLNL+wJMA+t7pBgNSctcPQk5nnBmcdqcHm2nkXXIbtkbEkZ5t/uHXcWHZb/ZFn+4Vj4N+va4ZU8i5RSfsZ6Eb4em9Zf9eaVn8krqQU88i6KuQ+/o8Jh8Qg66IoETI016yhnuWuy1WJwSRzm2X3IKbYv2uwJAwKu8JhuOxV7we05KXZZoB+Kj2w8fpIQ4qnHDevcwQMAnJozqnvaAzxkPVfZMYpxX6Z9oBtdOlp2dhJpiL9lgIauiZdNix7rDUDPMGMgithINYPaByoQUvfbwQZ4/eLi72wOhXWpbLNam7oKQp8fKL3xw2PH4eQ4XHHCMfHWh7DjvcXLXJ8QTZPkE8RO0+SkHLbtSBNLuXuogZzS/2hYGMu5e5AxZaYi0kWjcucg9qf9epM9j+9xocdYQb6P1krcPB7UOEdFyvWYfQmSwjymh4KSzqdbaMGBYkO2rFYEv26cQWyUrU7exMxrkTYcR9dCL7XCOEgjE/AB+OKj4gYbCzTXJGA3EAtCTJYfT3ZjTPEZhu692qf9ixQOBGz0eERf3Wwq7NN8KKPBpr9/vtXYrgTMCysUhnZJQ9AIsq9ye64FU+mt2Ojle8fuV5kGWToCFzQ+VADfp07gN7bMN2G8NdcVx/4rXxMllJ+SzH3UV87PMjdHPOh1k6nkm49uK7dGYLMOOObB4J8uZLMM8ca37FCBc3xJClvS1wrhp9pkm3Ay+/71Li2l3/a/PbuTRUU2z1iD9yW965yCtzPF+85P/GiXSker6ljzL6uszT/j4mqai1kn/h7pa0am9pjvpT+hCmy/yXJnbhCNk71Cj6NcENhnZI6drjBZPfFzkKKdZkDnNivYpHSbmGGe0Tu0UmEJj53pglScQ8DzNWn4ZeGVrpexD3PhFmW2X/B9jvzr8bpodEL1BT4ArHJEh4G1+WdECXvJDdpzaGQq7gXSRzeC3GQqDS5ArogH/gx4Wj/r9DyitjMC70JWiEjtfENebyz0ZCjkPOc/LmNHbzCoaJpPpcppCRm7elO6c9GXc7rgf7VX7BDKUmYleM2t5djo6mA7mgxhqKAYnTyQnwLbh+cYAaSC2Z2vcHjHyc0gbuucvkLZ+9WnrbfC+DN9GTeR6ef2amzzihruuHhw+nsAhnzenweF1u0Ypmbdlx9NOxwS45o/MWwB0vWPoM58ZoltrUGvfyi8QYO3JO/aZiULbqcI7sdi8Ppjv2Fgujbm3Ot23TLb7XvoiHUfeX89O/RQpynFaq1bKCcoWbxUBZkYhQS1BUI4buBTYIXbkY2TqSnmAGCzBZImkVm1MnVLCu/EWUSfvhrL1UmKdM+KW1kTaw3rEF8+OnNTfvnS43eiu5dY2lECvmSwnwkk1mfzMiV0rhtt+efnm0aFS1+qbdw+7ehld7G7REEmW01GvECQul89V8mqa14xm6rFAYbgrPy1nOHXF6elJatFYIBebtszomL9m8+W9ruHdN6/uKg2NTtHdxaGWPL7H8TTOlwPtNx/23ETVJhFRgm52fs0kv965Z89euLr5XvP9JWQlGW/ea/12MZwIJy2hrlUbNm60vmWdADcMWB3w0/ivBqzfQnRgUs7/if6dPIfSJGefRReFDCrCKirCctJW3DiG7IQCU5eNwIDtoYcjhcyPSsKKiKDwH/D4VYSIIPz4xwI0niKymBZF8hTxCHiFDZjJR3n+xz/m8cKK744KwvutGzFB+PELPCq55hK8R8J7yYOMoLJ14/uCwG544ceCXQHWM+Xvf4Z+jU7jvFwA7f0ol0R9Zdoneo+s1ZZMp2k1zXZfeTSG/v1KLzn8jhaLaVRm4eF3qNz8zubN8Jy1BW6yev+TotMAi/09GIsFqVuLHf4udf+ip6fnb729ve/gr8WnP6XH0SFsVdI+Mdc6+z7p+WNHNphS0nT7VHGBbnWk51zhcpeX9uy4BHXB5de+nhGsO6cvpQv7po3ShfCj1cu/cKbTmYP82EuXX/ZiTL/+6sxx86f1LaWwoNG3xLbPvkqvoLtta3BqLLg8wlz2qkOAb+Qb7Af4EQMNYH1Wxpvc+Aa41W9tKMBFWWv/fJhft75+07A13LwI7rFWuYGz7oXxDzkIrV65eveDS756mvXWLFAvr1j3VKyR8cn1+HX6FJ2P+HqN7S1keicdbJ0SMmpGL1uFIoO4aITaUJbWbSegvf1fsuFtzVY97CgAw1pBtgsktk6zCq3pgyd5futZhMyGPVvcHrTQKC8A3boXmofIWZvR/uCpg3fChwhxRuCY5R7P8mNgLttcOPw/Hr+qLID1y2V5+XpYyNLoqKLClZSEr9m8c+fma8JUdYtARcoTyRm+dtPatZuuCRNKeV4KCNYi2b923edKoli8ft1O9uJJWIWd664vimLpc+vWsgTbNsaF9B75Bufn4lwbN8wt5Vawc9VMpjD7LKgpJJtWeVs8sXdsAiiIakzZBvO2c6jCjqSgQCoMECaJxLSmNwomijGxUrC38otd86uxjvZp03IzR9utF0HNlbyxtHre1Vo+6qt1/ReZGavk68KOyMmLqytnJiEzY2Vl+ng9RK1DvoNGKZ4PS/A9/pUPPiAPgy/b31kaCKgr+orDXRo58b2MGYz5hKutD5z+ZKin7W4SLWjLRtJD49WeNYO5roWbKpHiKyEIJDKe0vsz7TnH/n6LDnAy4+08StR0YHJ/KZ+usZmcOqmgYjo9JhVqztuSMsiFoSQ0Y+SMVMi6H5Ih602Mb0mdYqTg+/jDlC31UKrCyJTRPAkeNVJc6+WIR8nv2JldSE8ez0uzfXSmjWHCeqdQBigXyLOFSqVgHSS/xUjzjVYiPIrXSXvlBvLgpK/E9pNMfU6g1cPfn/qRByo/wM+kv+Of9NfUbe+lDSFvb+fOwha0bDBBa50jEgsaw8R2VNTLDGkVib26NTTN7ZOxBaHl92V8XsgE6sydbmBey/9f1ifvbG0/1auTxp9eFZmUYFE0mynXv4yQZf2K0jsLYFav8oawf6uirNkmQsh6DdaNjJzoXTg8sjMoUJPC4qGhS7o7XZnsuSNLNwA1r/Z99bqrHgWnSVz5TnPHGTvMzhRPu5vfmqxMmaz8KXHbGkXZeo4MBpyACSxZJ1gCy9HIT7deLmIGPXetAreObBZg5eUn+zzzR6SgNxQaOTVsFHrrl/X31SV178JQ88WrX3A9cVUkFBo8s6urWOzqPaM/BFeQoTJ7pgGwrH/GMqz07fF9FJ9BP73VRT56J+MXaHOUuFlsBTEFwz4p0X77xbDP/acadVFImYUSsd3hKUNPsgOZJntRwDz6dQ36wzQ7Z5nubTxo3fhgo/dIDI57sLF6wnpsolbyuSS1VJuAoSn6r2qgUAEI+tS+pQBL+6YvgcFOyeNxdQxU77qrOtDh8nikTpv2HzxY7g96Fb2/zCjN5w32r3VCrS0XcZAVAwMrCFk6yUvvIS850TZNonyYzs3hljDMZbS8YtqkgCwjHEH7hcF3BlCPYPnW2X/WJRQV7Kxa3t6MTbT2aCcpco/qCx+64OrHHPOHMntS05I+n4ve1q8ZRlsi8bKWTJqGQZ523HXW/tsovW1/uBI5NlydbV3oCQY9AcP4gkfTPFiYRMm2AwQLzN3dfcIM0QUkk9/9uY0G3m0a462L9da2TxHyqW3brqBuoTJuHndcMKIBaJHg1LWFK35OX6IBLsh1cNWj1m7FYG8wTL6QoKJ8zIpCie2/MrjNoHcQaJaprIqapXua/vY6QL399ZO0Hu2k1+2I4f9gL8/v/cBvGH7yZ79h/eBnfY0XBho0gAUtrq0O2/ygbmM+fa693rxVNWCvw7EXDJVw7B7rc5CzLmOIFfZO2Qy34vxEkHJyCiKhCMoI9spFI4+YOZAN1MvIegLCLEYa61Dq9LpEB3TBpq9Yv9v+j22OKHmi7hBdVi9M/GO7I+qAJ5qvwphouCear9Id1kOwULbumXAbovUlksGIPGXL/YjeTL2or5NcilnZAVsF2i7PMjtcS21fqYN5BHHuCQetEwktP9ChSDYbOe8LiOprWcef74/kchFwwDoBspUcOK1N1s92QqwyvRIDmFkszoQXstUs0LvPY7c98BYMQa6cA9G60zps3zoNbm1OS/Qm8IuFYabNt4fot+kc+x2pLFfBNTnKZtJuZJr5bQPpKRVdLYhH0YGjJDWb58CU8V0x0o1KLStmzaw6eYaNXGz9w+VV3OByeb0LrGU2/RV25PQoen3zgsZCgIUNcp59jUAx07wg0w1zHoXYI3PXPvKPQ6uhO0vOzaIhPlvR0SZjwRIMlKD3LoWtUgXWYQVHV9TkMkXAmp67a6Jy111wLtYH3Zmp/fRL6XfpXkTbCDSBp6YKvCqBSnk1T6vWEngQnm/eAt+GJ8+1vgHzyC+a1pW7YAcUf9+0rPfASYg1/Wtw9Tdb581voa9R9q6IjDIggei0zg3ibNv7qJPuUMrUib3pkWeGFabSakPP2dsiaH0GWqXYGeo8FrM3UFL00cX3ro1mV3+61DcLDnZdNn7MuQvHNt5p9Z677ox/nqV/+l5yDkj7MtFzXl06b/RrC1/cm+0U1m1b+d/wc8+csVvmEd85dJPlDvGBkVmpzSNDdxwLm2ZvSN5yIAIwR7/g5mwUznzIOj+oQSI/OCd72/mz77feOufGzPpvbWiHuusbD6iiAac/NLVvd4PdR5Oh3ULDLOi2/VVvsBOOAtdyadovKuoV9h6BiRDuyo4wzFfzjkg4GkXj9Wdznt33fettHjav1AgJBebGxtd/H7w89FpPfx0cet7xUL8iBAN+r0D+uPYk4K0PH9/59aFzaERyl7QUD/D4Kcc+u2eqPV+hf6VnMxQMbLc5wbTz1K4TShs2oKjOyWxfwg2bXDLIkjXfnfJbV/hSsuSIgV+FL0tBeqbD7bZulkIRw2nNU1QS52U5rsAWvaDAfa7AkXNNr9Etk7jPPgfATr2zRTG1Y46PrLS2zDMfbZnbC8kmszZMCLQOKLfebGvgike8ACgM6fdoZ9ulx2z+DG/vkN+3Y+WE0ymBQwPtH2Nj/9CcMnU6nRMrd9zX2iL/zKZ1l7V1UrcCPeCVH3yWeH0Oqjx1t+zFBMVa1NdHXgKU1IlyjMg+NwrcoflsT1ySBNhy4MAWcPpkAtPnz8oQl+oGEq0kA8TeET/X7QXPZtElsi1x2SuTC91+hHTzpvZFf0n/Qk2UoB3cYvYWFNPI1EY67LCq/TIzZCa7SlrKjPnrzADOScP2pgZsr7gCXjAbA8SGR2xlgEUdvavTzdnC/OyaLavTh+eI8zIrrZ/kZkX6+PrhyPCi4Wgg0M/Xm5E5hfdLKzOF6PDiOZHDDb4/inmRTW2b06u2rM3OE+cczqzqTZOuNuhZ+ZPRfJ52tVnPI5XLU388NvSlEev5ZJbE434/0tCTzJDD/08+m4vFSSYJvSNfnBWP00zyjNSZZpejkB99Ydx6vq2TTMmMr9Jn6SKU5kOMD2zT2GA2NHu9krm/zUKGReyX3BosQwEEjIP2K5iTGZPFBA1+2de3bebNMzF0ejXntgULFj+5BENR8w5imnn8SQtj0cJ/5MGxeM+2vj4WOjVF3LbkycULFrBQ9AaWstRCNLbwpOPN/8ydxCrfpr9Eu5XJ/CJXRjk1NCXzW7K9cZT8Nyg7w83jlNLWK4dpdqasTtG8NDNoFQxAJc/e2szSYPMF9roO6ZbcbnfzXpseR/qWUSmTa16XyLtHXZBQ6Q6fD+AtKwOvziB68zuzeb+f7Az4+OG3yKjb78bvSVN7fi9CgYTiEIlZP5Y8VoeKUiuiwk8169DeB2A68qZHsb57xEZ9le7iGnZfWliKvXmitnYmG6bYsLVu0GjYNioyptjavRJV1Fa1lm+VwSyGtwg3dwOBkcb+/Yu2ZaMFz+yJrpFCf/elx7S3H3Npd39hpGtitqcQzW5btH9/YwTIhrm5YnF+sUhPR7JvlXftmPWQWEqHykZq0f3pkVpbn5N0dBBnX1ttJH3/opRRDqVLIiwcW+td1Td3w3IoziuV5hUnbaEnSIVplACi8QaYcEov3BMOwz291imk3GuNGwbci/SUDHyLXE9VVl5i/vmGBORE63Iss6ds3Qobqc+6PBy2Lu+FjbDxSP3fZuVxyRkSSkjCha1VvXAtXNtrrSKPG9Y4Rix86r2t+mlbq37mhMIHmHB9GTZat5Zhj2FQX691q3VrL+wJh7Fqz6SvYJfNWx95akqILBpcP3LaHOxXkP1zhixzQtZE9mpQmr0exCw1NR2wydaPP4r+9/irE/TqiTFry8TYGNw0NtbUyR+a+vtjK8aQfgSDowh6evvh0+jV7e3t53TgH0uHt8fsvzvHJv8mWhcbr11p+zpa7c/+f7cWRFNMwiB8bGtI4eWN/eck4u/T+R2HT6dX4bP3YyPaV7AG/PYXG2ecE4u9P4kRj35m8v82QumP7/0E3PRxT1qE3fqPZ5j/l34deWcr+/HPgsUTEysmJj7ueW9PjN1559jE//9nivZOXoMt1Y9/Jpmxe/fU9+Oe/Hz/VH7/7tbaQF4/k/zd9gcw3pXY6jDhsSoMWSyAoar1mB2QdzCw/jVjSt5fT39PT0T8Hsda/hXymjy22z7hjJcBeHfDfkL2byD+1rX5Z5DgSrJwuvWutYsspCfYaUeVWWPtst6dvpDAlSBNXzi51q7BtYbtBZUNSkVFKavCK9Z1sGM+7LCuw9V83fzJ2GT7sI+vkeftMeYQf2E3ReY3NoEFDTsCcNpjj1lfgWUre3J/+cvma2DZY4/1XLP5L3/J9ayEZfCVxx7DcDLzKjvzqqlMbur9/tfodO5M7kqm85gas0+rMT1WmtopbXmS2S4CJifgCFn+t2T2v2UGodzbcpgwFzPzLX98pOWKZqeuAr3sfTj2Bl150hldZmdIikD+Wwq76NCV0xMyce2RJJJbf/zqVJ97dlkQoh4SzXjCkiE4owqJpZWwoMpHp4Y91Cgo7dAmJxWfQ4mKHlUIyymPSpWo4PGJ4cl0QVaFiDul+KgnPP/BkQm34E0syfW4wq4npIjkz2YdXWBJkqPP06474669rrBEs1m+01zwwEhZUIWogmpUjjgFQ4p6CgbxhLH2I6miLoU9mRhR2k3ZIbnbvFHR58Hn8ZKMNGtyGNPlNmyfT4apDHh5unv2hJx0KpkeSfquhM3Ank/qhNfoLTRlv1WTnnqtium+jw7jN+ydUebHszf1W7tdGKf7rNW+YNAH1BsEGCxZt+CVDJSI4NMg6Gt+cNaNNOgj6e2fpkF4Iehb7wtC0BsoDRC8wKbSINhp9Mazmh/g5dPbf+ILctz/CyPCp1AAAAB4nGNgZGBgAGL181tmxPPbfGXgZmEAgeu8IQkI+n81qy5zI5DLwcAEEgUAFjoJXQB4nGNgZGBgbvjfwBDDGsQABKy6DIwMqCAJAFLvA0wAAHicY2FgYGB+ycDAwoAFM+IQJxZj00+hmaxBJKi/D6V/ALEohX6hMQYAGPYEswAAAAAAAAAAdgDCASgBmgHOAkQChgLSAwQDOgPWBEQEfgSsBR4FaAX8BoQHEAesCGwI3Aj4CTwJsgpWCqwK7gxADHIM8A14De4OLg6gDxIPrhBSEHIQpBEEEeYSHhLOEzATeBO+FCQUbhUWFWYV4hZyFwYXYhfeGAoYahi2GO4ZKhmsGiQaWhp8GpYbUBu8HDYcjBzIHRgdlh28Hi4edh6sHzAfsCASIHwg4CD4IRAhKCFAIaAh2iIMIkYihiKoIt4i+CMqJAIkTAAAeJxjYGRgYEhiVGfgZQABJiDmAkIGhv9gPgMAF7QBrgB4nF2Qy07CQBSG/0JBLYkLjSbuZmGM0aRcXBjZksCeBXsoUy5pO810IOFpXPoELl36FCZufBH/lgMLOjmn3/nPbTIArvALD/vvhrZnDz6jPddwhjvhOnUl7PPcCzfQwqNwk/qLcIBnvAq3cI0ZJ3j+BaMnbIQ9nONduIZLfAjXqX8K++Qv4QZu8S3cpP4jHGCCP+EWHry3YGD11Om5mu3UKjJZbDIXlDDWi00ytSWWNtG2WJlMdcNOGY50pu2hr9gues7FKrYmVUMO0EliVG7NWkcuXDqX99vtWPQwMimvMYCFxhSOfs7nmmFHv0IEgwxx5R3rDsqYdQs+R8Iee1QP/wmzFgXjMlLoIkTnmB0xm1UVp/sKbDm1R9Vxp6JZdqSkodxAc2NCVsir3JpKRD3EsurK0UebJz6pD6vd6T8/OGF2AAB4nG1SaZfURBTtO52k093TuIIbooK7BPcRUUBQEQX3XdZK5SVV3ZWqTC3TM/PrqXSE+UKdk3PuW/KWe99oazS82ejxr8QWxkiQIsMEOaaYYY5tLHAMT+BJPIWn8QyexXGcwHN4Hi/gRbyEk3gZp/AKXsVrOI0zeB1v4E28hbfxDt7FeziLAufwPj7Ah/gIH+MTfIodfIbz+BwX8AW+xEVcwmV8hSu4iq/xDb7FNXyH6/geP+AGbuJH/ISf8Qt+xW/4HX/gT/yFv/EP/sV/uIXbuIO7uIf7YCjBR9jPK8l0/2UisJLpKTcVFbWxq6Q1ltJDIUXIldQrqqTO6SAGpVIL5xlf0T4XTDc09qzJo8fW0olEmJYyR8xyMemsWRL3WeygTDPxa+k92ayRXoQy8bKldM9ITlljTKMoXZMszbajpiXtaxaUn/Z1Nz3TThhNOQ/dYC4lW4Z09zA6p33PwcuV4askQppw0/ZlxvGP1AlmaaglmKqTHi08aR4Tik3XpDRmNS2lL0PczOc149S7UmqZVOkhN0ZtO8PjJkUbyWBZZUJkLIuMSd3Mh502Q2zt7uZOhA2edlLHlcn5JLLkkjL6xjE462sXTpCqszhLQ74nq587Y0p27CB1q4OOsmWgpdRJL0uipPOzlnVFy+yK7CCC2SNbK7OOHATbKObcpKQoC6d5bVRFtjAd6WzASSQkpMGRdeOoZbamqKDPdGjLQRbFyrF1Lu/Vk3vk8p3zFTnZ6EllZVluJIrDzQ9MqJgptPE03WyyIV/QYTBJfy2LhwU2gSyOI4ydxWNRVFRmrf+HimqfDzB08wFY2Qifc6ZIV8weewgKLoivjsxW6uAWj8xOBXcU7C/L9bfgaFqRklya4JI+Z6tpZrWVMc0J2aVxZaLR6AG9AyuUAA==\") format(\"woff\"),url(\"iconfont.ttf?t=1525101408939\") format(\"truetype\"),url(\"iconfont.svg?t=1525101408939#icon\") format(\"svg\"); } .icon { display: inline-block; font: normal normal normal 14px/1 icon; font-size: inherit; text-rendering: auto; -webkit-font-smoothing: antialiased; -webkit-text-stroke-width: 0.2px; -moz-osx-font-smoothing: grayscale; } .icon-diandian:before { content: \"\\e63a\"; } .icon-huaban:before { content: \"\\e63c\"; } .icon-code-fork:before { content: \"\\e67a\"; } .icon-more:before { content: \"\\e6c0\"; } .icon-zhihu:before { content: \"\\e6d1\"; } .icon-linkedin:before { content: \"\\e724\"; } .icon-eye-fill:before { content: \"\\e64f\"; } .icon-stackexchange:before { content: \"\\e8b2\"; } .icon-tag:before { content: \"\\e6a3\"; } .icon-starfish:before { content: \"\\e62e\"; } .icon-home:before { content: \"\\e660\"; } .icon-search:before { content: \"\\e61c\"; } .icon-project:before { content: \"\\e63e\"; } .icon-dialog:before { content: \"\\e613\"; } .icon-twitter:before { content: \"\\ec9c\"; } .icon-github:before { content: \"\\e70a\"; } .icon-time:before { content: \"\\e669\"; } .icon-voice:before { content: \"\\e65a\"; } .icon-google:before { content: \"\\e601\"; } .icon-weibo:before { content: \"\\e64b\"; } .icon-segmentfault:before { content: \"\\e610\"; } .icon-star-fill:before { content: \"\\e630\"; } .icon-phone:before { content: \"\\e68a\"; } .icon-cup-fill:before { content: \"\\e614\"; } .icon-jiaju:before { content: \"\\e671\"; } .icon-qzone:before { content: \"\\e603\"; } .icon-home-fill:before { content: \"\\e617\"; } .icon-clock:before { content: \"\\e618\"; } .icon-file:before { content: \"\\e66f\"; } .icon-comment:before { content: \"\\e61a\"; } .icon-cup:before { content: \"\\e62c\"; } .icon-share:before { content: \"\\e66a\"; } .icon-star-half:before { content: \"\\e62f\"; } .icon-star:before { content: \"\\e619\"; } .icon-tencent-weibo:before { content: \"\\e602\"; } .icon-book:before { content: \"\\e79d\"; } .icon-bitbucket:before { content: \"\\e64e\"; } .icon-facebook:before { content: \"\\e6e3\"; } .icon-email:before { content: \"\\e667\"; } .icon-zcool:before { content: \"\\e60c\"; } .icon-social-media:before { content: \"\\e68b\"; } .icon-douban:before { content: \"\\e60f\"; } .icon-coding:before { content: \"\\e600\"; } .icon-github-fill:before { content: \"\\e71d\"; } .icon-qq:before { content: \"\\e611\"; } .icon-shu-fill:before { content: \"\\e615\"; } .icon-pinterest:before { content: \"\\e697\"; } .icon-tags:before { content: \"\\e6c4\"; } .icon-bill:before { content: \"\\e61b\"; } .icon-shu:before { content: \"\\e616\"; } .icon-book-shelf:before { content: \"\\e60d\"; } .icon-target:before { content: \"\\e695\"; } .icon-profile:before { content: \"\\e6e2\"; } .icon-alipay:before { content: \"\\e938\"; } .icon-skype:before { content: \"\\e604\"; } .icon-juejin:before { content: \"\\e605\"; } .icon-code:before { content: \"\\e73f\"; } .icon-list:before { content: \"\\e61e\"; } .icon-map-marker:before { content: \"\\e609\"; } .icon-stackoverflow:before { content: \"\\e606\"; } .icon-hourglass:before { content: \"\\e60e\"; } .icon-behance:before { content: \"\\e67b\"; } .icon-folder-open:before { content: \"\\e6b4\"; } .icon-folder:before { content: \"\\e60a\"; } .icon-menu:before { content: \"\\e607\"; } .icon-users:before { content: \"\\e60b\"; } .icon-eye:before { content: \"\\e657\"; } .icon-wechat:before { content: \"\\e65e\"; } .icon-number:before { content: \"\\e658\"; } .icon-gitlab:before { content: \"\\e67c\"; } .icon-rss:before { content: \"\\e63d\"; } .icon-archives:before { content: \"\\e62d\"; } .icon-68design:before { content: \"\\e608\"; } .icon-dribble:before { content: \"\\e982\"; } .icon-wepay:before { content: \"\\e629\"; } .icon-youdao-note:before { content: \"\\e8a6\"; } .icon-book-fill:before { content: \"\\e659\"; } .icon-hezuo:before { content: \"\\e6e5\"; } .icon-link:before { content: \"\\e635\"; } .icon-archives-fill:before { content: \"\\e694\"; } .icon-anchor:before { content: \"\\e858\"; } .icon-angle-down:before { content: \"\\e85e\"; } .icon-angle-left:before { content: \"\\e85f\"; } .icon-angle-up:before { content: \"\\e860\"; } .icon-angle-right:before { content: \"\\e862\"; } .icon-calendar:before { content: \"\\e895\"; } .icon-calendar-check:before { content: \"\\e896\"; } .icon-calendar-minus:before { content: \"\\e897\"; } .icon-calendar-plus:before { content: \"\\e899\"; } .icon-calendar-times:before { content: \"\\e89a\"; } .icon-close:before { content: \"\\e8c4\"; } .icon-delicious:before { content: \"\\e8e2\"; } .icon-plus:before { content: \"\\e99d\"; } .icon-gg:before { content: \"\\e6fd\"; } .icon-friendship:before { content: \"\\e612\"; } .icon-gitee:before { content: \"\\e61d\"; } pre .comment { color: #8e908c; } pre .variable, pre .attribute, pre .tag, pre .regexp, pre .ruby .constant, pre .xml .tag .title, pre .xml .pi, pre .xml .doctype, pre .html .doctype, pre .css .id, pre .css .class, pre .css .pseudo { color: #c82829; } pre .number, pre .preprocessor, pre .built_in, pre .literal, pre .params, pre .constant { color: #f5871f; } pre .ruby .class .title, pre .css .rules .attribute { color: #718c00; } pre .string, pre .value, pre .inheritance, pre .header, pre .ruby .symbol, pre .xml .cdata { color: #718c00; } pre .title, pre .css .hexcolor { color: #3e999f; } pre .function, pre .python .decorator, pre .python .title, pre .ruby .function .title, pre .ruby .title .keyword, pre .perl .sub, pre .javascript .title, pre .js .title, pre .coffeescript .title { color: #4271ae; } pre .keyword, pre .javascript .function, pre .js .function { color: #8959a8; } pre, .highlight { background: #fafafa; margin: 10px 0; padding: 15px 10px; overflow: auto; font-size: 13px; color: #4d4d4c; line-height: 1.5; } .highlight .gutter pre, .gist .gist-file .gist-data .line-numbers { color: #666; } code { text-shadow: 0 1px #fff; padding: 0.2em 0.4em; margin: 0 0.3em; color: #555; background: #eee; border-radius: 3px; font-size: 85%; } pre code { background: none; text-shadow: none; padding: 0; } .highlight { position: relative; padding: 32px 10px 0 10px; border-radius: 4px; } .highlight:before { display: block; content: ' '; height: 32px; position: absolute; top: 0; left: 0; right: 0; background-color: #f6f6f6; padding: 0 10px; border-top-left-radius: 4px; border-top-right-radius: 4px; } .highlight:after { content: \" \"; position: absolute; border-radius: 50%; background: #fc625d; width: 10px; height: 10px; top: 0; left: 15px; margin-top: 11px; -webkit-box-shadow: 20px 0 #fdbc40,40px 0 #35cd4b; box-shadow: 20px 0 #fdbc40,40px 0 #35cd4b; } .highlight pre { border: none; margin: 0; } .highlight table { position: relative; border: none; width: 100%; margin: 0; padding: 0; } .highlight tr { border: none; } .highlight td, .highlight th { border: none; padding: 0; } .highlight td.code, .highlight th.code { width: 100% !important; } .highlight figcaption { font-size: 0.85em; color: #8e908c; line-height: 1em; margin-bottom: 1em; } .highlight figcaption a { float: right; } .highlight .line { height: 24px; line-height: 24px; } .highlight .gutter pre { text-align: right; padding-right: 0; padding-left: 0; color: #ccc; } /* * Sidebar */ /* Hide for mobile, show later */ .header { background-color: #fbfbfb; } .sidebar { background-color: #fdfdfd; } .sidebar .slimContent { padding: 20px; } .main { position: relative; min-height: 100vh; padding: 15px; } .main:before, .main:after { content: \" \"; display: table; } .main:after { clear: both; } .footer { padding: 20px; background-color: #fbfbfb; } /* * main-center */ body.main-center .sidebar { left: auto; right: 0; border-left: 1px solid #f6f6f6; border-right: 0; } /* * main-left */ body.main-left .header { left: auto; right: 0; border-left: 1px solid #f6f6f6; border-right: 0; } body.main-left .sidebar { left: auto; right: 0; border-left: 1px solid #f6f6f6; border-right: 0; } body.main-left .footer { left: auto; right: 0; } /* * main-right */ body.no-sidebar .sidebar { display: none !important; } /** * Sidebar navigation */ .main-nav { float: none !important; } .main-nav > li { display: block; width: 100%; position: relative; } .main-nav > li > a { color: #555555; } .main-nav > li .menu-title { margin-left: 15px; } .main-nav > .active a, .main-nav > .active a:hover, .main-nav > .active a:focus { color: #333333; background: #f4f4f4; } /** * profile-block */ .profile-block { padding: 20px 15px 10px 15px; } #avatar { width: 64px; height: 64px; display: inline-block; } #avatar img { width: 100%; max-height: 100%; height: auto !important; } #name { font-size: 18px; margin-top: 10px; margin-bottom: 0; } #title { font-size: 13px; margin-top: 5px; margin-bottom: 5px; } /** * search */ .sidebar-form { border-radius: 3px; border: 1px solid #eee; margin: 0 15px 15px 15px; } .sidebar-form input[type=\"text\"], .sidebar-form .btn { -webkit-box-shadow: none; box-shadow: none; background-color: transparent; border: 1px solid transparent; height: 32px; } .sidebar-form input[type=\"text\"]:focus, .sidebar-form .btn:focus { outline: none; } .sidebar-form input[type=\"text\"] { color: #666; border-top-left-radius: 2px; border-top-right-radius: 0; border-bottom-right-radius: 0; border-bottom-left-radius: 2px; } .sidebar-form input[type=\"text\"]:focus, .sidebar-form input[type=\"text\"]:focus + .input-group-btn .btn { background-color: #fff; color: #666; } .sidebar-form .btn { color: #999; border-top-left-radius: 0; border-top-right-radius: 2px; border-bottom-right-radius: 2px; border-bottom-left-radius: 0; } .header { /** * navbar */ } .header .navbar-collapse { padding-left: 0; padding-right: 0; } .header .navbar-collapse .navbar-nav { margin: 0; } .header .navbar-toggle .icon-bar { background-color: #2196f3; } /* * Main content */ .main .pager { text-align: left; margin: 10px 0; } .main .pager .disabled { cursor: not-allowed; } .main .pager > a, .main .pager > .page-number { line-height: 32px; /* float: left; */ } .main .pager a { color: #666; border: 0; line-height: 32px; padding: 0; } .main .pager a:link, .main .pager a:visited { background-color: transparent; } .main .pager a:hover { color: #0a6ebd; background-color: transparent; } .main .pager .prev { margin-right: 10px; } .main .pager .page-number.current { color: #2196f3; } .main .pager .page-number + .page-number { margin-left: 10px; } .main .pager .page-number + .next { margin-left: 10px; } .main .total-article { margin: 10px 0; line-height: 32px; color: #999; } .main .page-header { margin-top: 0; } .main .article-list article { border-bottom: 1px solid #f2f2f2; } .main .article-list article:last-child { border-bottom: 0; } .main .article-meta { font-size: 13px; color: #999; } .main .article-meta a { color: #999; } .main .article-meta a:hover { color: #0a6ebd; text-decoration: none; } .main .article-meta span + span { margin-left: 10px; } .main .content { min-height: 85vh; } .main.has-sticky .content { margin-bottom: 70px; } #comments .gitment-footer-container, #comments .gitment-footer-project-link { display: none !important; } .panel .label, .widget .label { font-weight: normal; } .widget:before, .widget:after { content: \" \"; display: table; } .widget:after { clear: both; } .widget .widget-title { font-size: 18px; color: #000; } .widget time { color: #999; font-size: 12px; text-transform: uppercase; } .widget p { margin-bottom: 0; } .widget ul { margin-left: 0; padding-left: 0; list-style: none; } .widget .category-link { color: #0a6ebd; } .category-list-count, .tag-list-count, .archive-list-count { padding-left: 5px; color: #999; font-size: 0.85em; } .category-list-count:before, .tag-list-count:before, .archive-list-count:before { content: \"(\"; } .category-list-count:after, .tag-list-count:after, .archive-list-count:after { content: \")\"; } .category-list, .archive-list, .tag-list { line-height: 1.75; } .category-list li:before, .archive-list li:before, .tag-list li:before { color: #ccc; content: \"â–ª\"; font-size: 12px; margin-right: 6px; -webkit-transition: 0.2s ease; transition: 0.2s ease; } .category-list-child { padding-left: 15px; } .recent-post-list li + li { margin-top: 15px; } .recent-post-list li .item-thumb, .recent-post-list li .item-inner { display: table-cell; vertical-align: middle; } .recent-post-list li .item-thumb { opacity: 1; padding-right: 10px; -webkit-transition: all 0.2s ease; transition: all 0.2s ease; } .recent-post-list li .item-thumb .thumb { width: 50px; height: 50px; display: block; position: relative; overflow: hidden; } .recent-post-list li .item-thumb .thumb span { width: 100%; height: 100%; display: block; } .recent-post-list li .item-thumb .thumb .thumb-image { position: absolute; background-size: cover; background-position: center; } .recent-post-list li .item-thumb .thumb .thumb-none { background-image: url(\"../images/thumb-default.png\"); background-size: 100% 100%; } .recent-post-list li:hover .item-thumb { opacity: 0.8; } .sidebar-toc.collapse { display: none !important; } .sidebar-toc.in { display: block !important; } .tagcloud a { display: inline-block; margin-bottom: 0.2em; padding: .3em .6em; font-size: 75% !important; line-height: 1; background-color: #eee; text-align: center; white-space: nowrap; vertical-align: baseline; border-radius: .25em; } .bar .pager .next > a, .bar .pager .next > span { float: none; } .bar.bar-footer { position: relative; background-color: #fff; bottom: -15px; } .bar.bar-footer:before { content: ''; position: absolute; width: -webkit-calc(100% + 30px); width: calc(100% + 30px); height: 52px; left: -15px; border-top: 1px solid #f6f6f6; border-bottom: 1px solid #fff; background-color: #fff; } .bar .bar-inner { position: relative; z-index: 9; } .bar .bar-inner:before, .bar .bar-inner:after { content: \" \"; display: table; } .bar .bar-inner:after { clear: both; } .bar .bar-right { margin: 10px 0; float: right; } .toggle-toc { cursor: pointer; margin-left: 10px; } .toggle-toc a { display: inline-block; line-height: 32px; text-align: center; } /** * footer */ .footer { color: #999; } .footer .copyright { font-size: 12px; } .footer .copyright a { color: #999; text-decoration: none; } .footer .copyright a:hover { color: #0a6ebd; } /** * .wave-icon */ .wave-icon { display: inline-block; position: relative; } .wave-icon .wave-circle { display: block; border-radius: 50%; background-color: transparent; } .wave-icon .wave-circle:before, .wave-icon .wave-circle:after { content: ''; border: 10px solid #2196f3; background: #2196f3; border-radius: 50%; position: absolute; top: 50%; left: 50%; z-index: 1; } .wave-icon .wave-circle:before { height: 74px; width: 74px; -webkit-animation: pulse 5s ease-out; animation: pulse 5s ease-out; -webkit-animation-iteration-count: infinite; animation-iteration-count: infinite; margin-top: -37px; margin-left: -37px; opacity: 0; } .wave-icon .wave-circle:after { height: 98px; width: 98px; -webkit-animation: pulse 5s ease-out; animation: pulse 5s ease-out; -webkit-animation-iteration-count: infinite; animation-iteration-count: infinite; margin-top: -49px; margin-left: -49px; opacity: 0.3; } .wave-icon .icon { position: relative; display: block; width: 50px; height: 50px; line-height: 50px; text-align: center; background-color: #2196f3; border-radius: 50%; font-size: 24px; color: #fff; z-index: 2; } .wave-icon.wave-icon-info .wave-circle:before, .wave-icon.wave-icon-info .wave-circle:after { border: 10px solid #56CCF2; background: #56CCF2; } .wave-icon.wave-icon-info .icon { background-color: #56CCF2; } .wave-icon.wave-icon-primary .wave-circle:before, .wave-icon.wave-icon-primary .wave-circle:after { border: 10px solid #2196f3; background: #2196f3; } .wave-icon.wave-icon-primary .icon { background-color: #2196f3; } .wave-icon.wave-icon-warning .wave-circle:before, .wave-icon.wave-icon-warning .wave-circle:after { border: 10px solid #F09819; background: #F09819; } .wave-icon.wave-icon-warning .icon { background-color: #F09819; } .wave-icon.wave-icon-success .wave-circle:before, .wave-icon.wave-icon-success .wave-circle:after { border: 10px solid #5cb85c; background: #5cb85c; } .wave-icon.wave-icon-success .icon { background-color: #5cb85c; } .wave-icon.wave-icon-danger .wave-circle:before, .wave-icon.wave-icon-danger .wave-circle:after { border: 10px solid #FF512F; background: #FF512F; } .wave-icon.wave-icon-danger .icon { background-color: #FF512F; } @-webkit-keyframes pulse { 0% { -webkit-transform: scale(0); opacity: 0.0; } 25% { -webkit-transform: scale(0); opacity: 0.1; } 50% { -webkit-transform: scale(0.1); opacity: 0.3; } 75% { -webkit-transform: scale(0.5); opacity: 0.5; } 100% { -webkit-transform: scale(1); opacity: 0.0; } } .repo-list { list-style: none; padding-left: 0; } .repo { position: relative; list-style-type: none; border: 1px solid #f2f2f2; margin-bottom: 15px; overflow: hidden; } .repo-title { padding: 0 15px; margin: 15px 0; font-size: 16px; font-weight: 600; } .repo-body { display: -webkit-box; padding: 0 15px; margin: 0 0 20px; overflow: hidden; text-overflow: ellipsis; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-height: 1.5em; height: 3em; word-break: break-all !important; word-wrap: break-word !important; } .repo-image { position: relative; display: table; width: 101%; height: 3px; margin: -1px -1px 15px; background-color: #666; } .repo-meta { padding: 0 15px; margin-top: 5px; margin-bottom: 15px; color: #777; font-size: 12px; text-align: right; } .repo-meta:before, .repo-meta:after { content: \" \"; display: table; } .repo-meta:after { clear: both; } .repo-meta .meta + .meta { margin-left: 15px; } /* * Global add-ons */ .text-collapsed { display: none; } .text-in { display: inline-block; } .collapsed .text-collapsed { display: inline-block; } .collapsed .text-in { display: none; } .sub-header { padding-bottom: 10px; border-bottom: 1px solid #eee; } .article-header { margin-bottom: 20px; } .article-footer { margin-top: 20px; } /** * collection */ .collection { position: relative; } .collection a.collection-item { display: block; -webkit-transition: .25s; transition: .25s; color: #777777; } .collection a:not(.active):hover { color: #333333; } .collection .collection-item { padding: 8px 0; margin: 0; } .article-list .article-title { font-size: 18px; } .article-toc .toc-title { font-size: 18px; color: #000; } .article-toc .toc { list-style: none; padding-left: 0; line-height: 2.0; } .article-toc .toc ol { list-style: none; padding-left: 10px; } .article-toc .toc .toc-item { position: relative; } .article-toc .toc .toc-item .markdownIt-Anchor { position: absolute; left: 0; right: 0; top: 0; padding: 14px 0; } .marked-body h1, .marked-body h2, .marked-body h3, .marked-body h4, .marked-body h5, .marked-body h6 { margin-top: 24px; margin-bottom: 16px; font-weight: 600; line-height: 1.25; } .marked-body h1 { padding-bottom: 0.3em; font-size: 2em; border-bottom: 1px solid #f2f2f2; } .marked-body h2 { padding-bottom: 0.3em; font-size: 1.5em; border-bottom: 1px solid #f2f2f2; } .marked-body a { color: #2196f3; text-decoration: none; } .marked-body a:focus, .marked-body a:hover { color: #0a6ebd; text-decoration: none; } .marked-body ul, .marked-body ol { padding-left: 0; margin-left: 20px; } /* * We are hiding the invisible nav outside the screen * so we need to avoid the horizontal scroll */ body.okayNav-loaded { overflow-x: hidden; } .okayNav { position: relative; } .okayNav:before, .okayNav:after { content: \" \"; display: table; } .okayNav:after { clear: both; } .okayNav:not(.loaded) { visibility: hidden; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; } .okayNav ul { /* We want two navigations - one hidden and one visible */ float: left; padding-left: 0; } .okayNav ul li { display: inline-block; margin-left: 15px; } .okayNav a { position: relative; z-index: 1; } .okayNav a.active { color: #0a6ebd; } .okayNav__nav--visible { overflow: hidden; white-space: nowrap; } .okayNav__nav--visible li { display: inline-block; margin-left: 15px; } .okayNav__nav--visible li:first-child { margin-left: 0; } .okayNav__nav--visible a { /* Link styling for the visible part of the nav */ display: block; -webkit-transition: color 200ms cubic-bezier(0.55, 0, 0.1, 1); transition: color 200ms cubic-bezier(0.55, 0, 0.1, 1); } .okayNav__nav--visible:empty ~ .okayNav__menu-toggle { top: 0; } /* Link styling for the off-screen part of the nav */ .okayNav__nav--invisible { display: none; position: absolute; width: 100%; top: 24px; overflow-y: auto; -webkit-overflow-scrolling: touch; -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); padding-top: 15px; padding-bottom: 15px; background: #fff; } .okayNav__nav--invisible li { display: inline-block; } .okayNav__nav--invisible li a { display: block; padding: 6px 15px; min-width: 100px; } .okayNav__nav--invisible.nav-left { left: 0; } .okayNav__nav--invisible.nav-right { right: 0; } .okayNav__nav--invisible.transition-enabled { -webkit-transition: -webkit-transform 400ms cubic-bezier(0.55, 0, 0.1, 1); transition: -webkit-transform 400ms cubic-bezier(0.55, 0, 0.1, 1); transition: transform 400ms cubic-bezier(0.55, 0, 0.1, 1); transition: transform 400ms cubic-bezier(0.55, 0, 0.1, 1),-webkit-transform 400ms cubic-bezier(0.55, 0, 0.1, 1); } .okayNav__nav--invisible.nav-open { display: block; z-index: 99; border: 1px solid #f2f2f2; } /* Kebab icon */ .okayNav__menu-toggle { position: relative; z-index: 1; float: right; cursor: pointer; -webkit-transition: -webkit-transform 400ms cubic-bezier(0.55, 0, 0.1, 1); transition: -webkit-transform 400ms cubic-bezier(0.55, 0, 0.1, 1); transition: transform 400ms cubic-bezier(0.55, 0, 0.1, 1); transition: transform 400ms cubic-bezier(0.55, 0, 0.1, 1),-webkit-transform 400ms cubic-bezier(0.55, 0, 0.1, 1); } .okayNav__menu-toggle.okay-invisible { position: absolute; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; pointer-events: none; opacity: 0; } .okayNav__menu-toggle span { background: #666; display: inline-block; width: 2px; height: 2px; margin: auto 1px; pointer-events: none; border-radius: 50%; vertical-align: middle; } .okayNav__menu-toggle.icon--active { /* Kebab icon when off-screen nav is open */ } .okayNav__menu-toggle.icon--active span { background: #0a6ebd; } .okayNav a { color: #2e2e33; font-weight: 400; } .okayNav a:hover { color: #0a6ebd; } /** * social-links */ .social-links { list-style: none; padding: 0; text-align: left; } .social-links li { list-style: none; display: inline-block; margin-left: 10px; } .social-links li:first-child { margin-left: 0; } .header .social-links { padding: 10px 20px; } .footer .social-links { margin-bottom: 5px; } @font-face { font-family: \"socialshare\"; src: url(\"../fonts/iconfont.eot\"); /* IE9*/ src: url(\"../fonts/iconfont.eot?#iefix\") format(\"embedded-opentype\"),url(\"../fonts/iconfont.woff\") format(\"woff\"),url(\"../fonts/iconfont.ttf\") format(\"truetype\"),url(\"../fonts/iconfont.svg#iconfont\") format(\"svg\"); } .social-share { display: inline-block; font-size: 16px; } .social-share a { position: relative; text-decoration: none; margin-left: 16px; display: inline-block; outline: none; line-height: 32px; } .social-share .social-share-icon { position: relative; display: inline-block; height: 32px; line-height: 32px; color: #999; text-align: center; vertical-align: middle; -webkit-transition: background 0.6s ease-out 0s; transition: background 0.6s ease-out 0s; } .social-share .social-share-icon:hover { color: #666; } .social-share .icon-weibo:hover { color: #ff763b; } .social-share .icon-tencent:hover { color: #56b6e7; } .social-share .icon-qq:hover { color: #56b6e7; } .social-share .icon-qzone:hover { color: #FDBE3D; } .social-share .icon-douban:hover { color: #33b045; } .social-share .icon-linkedin:hover { color: #0077B5; } .social-share .icon-facebook:hover { color: #44619D; } .social-share .icon-google:hover { color: #db4437; } .social-share .icon-twitter:hover { color: #55acee; } .social-share .icon-diandian:hover { color: #307DCA; } .social-share .icon-wechat { position: relative; } .social-share .icon-wechat:hover { color: #7bc549; } .social-share .icon-wechat .wechat-qrcode { display: none; border: 1px solid #eee; position: absolute; z-index: 9; top: -209px; left: -90px; width: 200px; height: 200px; color: #666; font-size: 12px; text-align: center; background-color: #fff; -webkit-transition: all 200ms; transition: all 200ms; -webkit-tansition: all 350ms; -moz-transition: all 350ms; } .social-share .icon-wechat .wechat-qrcode.bottom { top: 40px; left: -84px; } .social-share .icon-wechat .wechat-qrcode.bottom:after { display: none; } .social-share .icon-wechat .wechat-qrcode h4 { font-weight: normal; height: 26px; line-height: 26px; font-size: 12px; background-color: #f3f3f3; margin: 0; padding: 0; color: #777; } .social-share .icon-wechat .wechat-qrcode .qrcode { width: 105px; margin: 15px auto; } .social-share .icon-wechat .wechat-qrcode .qrcode table { margin: 0 !important; } .social-share .icon-wechat .wechat-qrcode .help p { font-weight: normal; line-height: 16px; padding: 0; margin: 0; } .social-share .icon-wechat .wechat-qrcode:before { content: ''; position: absolute; left: 50%; margin-left: -6px; bottom: -15px; width: 0; height: 0; border-width: 8px 6px 6px 6px; border-style: solid; border-color: #eee transparent transparent transparent; } .social-share .icon-wechat .wechat-qrcode:after { content: ''; position: absolute; left: 50%; margin-left: -6px; bottom: -13px; width: 0; height: 0; border-width: 8px 6px 6px 6px; border-style: solid; border-color: #fff transparent transparent transparent; } .social-share .icon-wechat:hover .wechat-qrcode { display: block; } .btn-donate { position: absolute; bottom: 10px; left: 50%; margin-left: -25px; width: 50px; height: 50px; line-height: 50px; padding: 0; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 99; } .btn-donate:focus, .btn-donate:hover, .btn-donate:active { border-color: transparent !important; outline: none !important; } .btn-donate.btn-fancy { background-color: transparent; } .btn-donate.btn-fancy span { width: 50px; height: 50px; padding: 0; } .donate { overflow: hidden; } .donate-box { text-align: center; padding-top: 30px; } .donate-box .donate-head { width: 100%; height: 80px; text-align: center; line-height: 60px; color: #a3a3a3; font-size: 16px; position: relative; } .donate-box .donate-head:before, .donate-box .donate-head:after { font-family: Arial,Helvetica,sans-serif; background: none; width: 0px; height: 0px; font-style: normal; color: #eee; font-size: 100px; position: absolute; top: 15px; } .donate-box .donate-head:before { content: '\\201c'; left: 30px; } .donate-box .donate-head:after { content: '\\201d'; right: 70px; } .donate-box .donate-footer { padding-top: 35px; } .donate-box .donate-payimg { display: inline-block; padding: 10px; border: 6px solid #ea5f00; margin: 0 auto; border-radius: 3px; } .donate-box .donate-payimg img { display: block; text-align: center; width: 140px; height: 140px; } .book .media-middle { display: inline-block; width: 115px; } .ins-search { display: none; } .ins-search.show { display: block; } .ins-selectable { cursor: pointer; } .ins-search-mask, .ins-search-container { position: fixed; } .ins-search-mask { top: 0; left: 0; width: 100%; height: 100%; z-index: 1050; background: rgba(0, 0, 0, 0.5); } .ins-input-wrapper { position: relative; } .ins-search-input { width: 100%; border: none; outline: none; font-size: 16px; -webkit-box-shadow: none; box-shadow: none; font-weight: 200; border-radius: 0; background: #fff; line-height: 20px; -webkit-box-sizing: border-box; box-sizing: border-box; padding: 12px 28px 12px 20px; border-bottom: 1px solid #e2e2e2; font-family: \"Microsoft Yahei Light\",\"Microsoft Yahei\",Helvetica,Arial,sans-serif; } .ins-close { top: 50%; right: 6px; width: 20px; height: 20px; font-size: 24px; margin-top: -15px; position: absolute; text-align: center; opacity: 1.0; color: #666; display: inline-block; } .ins-close:hover { color: #006bde; } .ins-search-container { left: 50%; top: 100px; z-index: 1051; bottom: 100px; -webkit-box-sizing: border-box; box-sizing: border-box; width: 540px; margin-left: -270px; } .ins-section-wrapper { left: 0; right: 0; top: 45px; bottom: 0; overflow-y: auto; position: absolute; } .ins-section-container { position: relative; background: #f7f7f7; } .ins-section { font-size: 14px; line-height: 16px; } .ins-section .ins-section-header, .ins-section .ins-search-item { padding: 8px 15px; } .ins-section .ins-section-header { color: #9a9a9a; border-bottom: 1px solid #e2e2e2; } .ins-section .ins-slug { margin-left: 5px; color: #9a9a9a; } .ins-section .ins-slug:before { content: '('; } .ins-section .ins-slug:after { content: ')'; } .ins-section .ins-search-item header, .ins-section .ins-search-item .ins-search-preview { overflow: hidden; white-space: nowrap; text-overflow: ellipsis; } .ins-section .ins-search-item header .icon { margin-right: 8px; } .ins-section .ins-search-item .ins-search-preview { height: 15px; font-size: 12px; color: #9a9a9a; margin: 5px 0 0 20px; } .ins-section .ins-search-item:hover, .ins-section .ins-search-item.active { color: #fff; background: #006bde; } .ins-section .ins-search-item:hover .ins-slug, .ins-section .ins-search-item.active .ins-slug, .ins-section .ins-search-item:hover .ins-search-preview, .ins-section .ins-search-item.active .ins-search-preview { color: #fff; } .theme-black .header, .theme-blue .header, .theme-green .header, .theme-purple .header { color: #fff; } .theme-black .header a, .theme-blue .header a, .theme-green .header a, .theme-purple .header a { color: #efefef; } .theme-black .header #location, .theme-blue .header #location, .theme-green .header #location, .theme-purple .header #location { color: rgba(255, 255, 255, 0.75) !important; } .theme-black .header .navbar-toggle .icon-bar, .theme-blue .header .navbar-toggle .icon-bar, .theme-green .header .navbar-toggle .icon-bar, .theme-purple .header .navbar-toggle .icon-bar { background-color: #fff; } .theme-black .footer, .theme-blue .footer, .theme-green .footer, .theme-purple .footer { color: rgba(255, 255, 255, 0.75); } .theme-black .footer a, .theme-blue .footer a, .theme-green .footer a, .theme-purple .footer a { color: rgba(255, 255, 255, 0.75); } .theme-black .header a:focus, .theme-black .header a:hover, .theme-black .header a.active, .theme-black .footer a:focus, .theme-black .footer a:hover, .theme-black .footer a.active, .theme-blue .header a:focus, .theme-blue .header a:hover, .theme-blue .header a.active, .theme-blue .footer a:focus, .theme-blue .footer a:hover, .theme-blue .footer a.active, .theme-green .header a:focus, .theme-green .header a:hover, .theme-green .header a.active, .theme-green .footer a:focus, .theme-green .footer a:hover, .theme-green .footer a.active, .theme-purple .header a:focus, .theme-purple .header a:hover, .theme-purple .header a.active, .theme-purple .footer a:focus, .theme-purple .footer a:hover, .theme-purple .footer a.active { color: #fff; } .theme-black .main-nav > li > a:focus, .theme-black .main-nav > li > a:hover, .theme-black .main-nav > li > a.active, .theme-blue .main-nav > li > a:focus, .theme-blue .main-nav > li > a:hover, .theme-blue .main-nav > li > a.active, .theme-green .main-nav > li > a:focus, .theme-green .main-nav > li > a:hover, .theme-green .main-nav > li > a.active, .theme-purple .main-nav > li > a:focus, .theme-purple .main-nav > li > a:hover, .theme-purple .main-nav > li > a.active { color: #fff; background: rgba(0, 0, 0, 0.15); } .theme-black .main-nav > .active a, .theme-black .main-nav > .active a:focus, .theme-black .main-nav > .active a:hover, .theme-black .main-nav > .active a.active, .theme-blue .main-nav > .active a, .theme-blue .main-nav > .active a:focus, .theme-blue .main-nav > .active a:hover, .theme-blue .main-nav > .active a.active, .theme-green .main-nav > .active a, .theme-green .main-nav > .active a:focus, .theme-green .main-nav > .active a:hover, .theme-green .main-nav > .active a.active, .theme-purple .main-nav > .active a, .theme-purple .main-nav > .active a:focus, .theme-purple .main-nav > .active a:hover, .theme-purple .main-nav > .active a.active { color: #fff; background: rgba(0, 0, 0, 0.2); } .theme-black .search .sidebar-form, .theme-blue .search .sidebar-form, .theme-green .search .sidebar-form, .theme-purple .search .sidebar-form { border: 0; background: rgba(0, 0, 0, 0.2); } .theme-black .search .sidebar-form input::-webkit-input-placeholder, .theme-blue .search .sidebar-form input::-webkit-input-placeholder, .theme-green .search .sidebar-form input::-webkit-input-placeholder, .theme-purple .search .sidebar-form input::-webkit-input-placeholder { color: rgba(255, 255, 255, 0.5); } .theme-black .search .sidebar-form input:-moz-placeholder, .theme-blue .search .sidebar-form input:-moz-placeholder, .theme-green .search .sidebar-form input:-moz-placeholder, .theme-purple .search .sidebar-form input:-moz-placeholder { color: rgba(255, 255, 255, 0.5); } .theme-black .search .sidebar-form input::-moz-placeholder, .theme-blue .search .sidebar-form input::-moz-placeholder, .theme-green .search .sidebar-form input::-moz-placeholder, .theme-purple .search .sidebar-form input::-moz-placeholder { color: rgba(255, 255, 255, 0.5); } .theme-black .search .sidebar-form input:-ms-input-placeholder, .theme-blue .search .sidebar-form input:-ms-input-placeholder, .theme-green .search .sidebar-form input:-ms-input-placeholder, .theme-purple .search .sidebar-form input:-ms-input-placeholder { color: rgba(255, 255, 255, 0.5); } .theme-black .search input[type=\"text\"], .theme-blue .search input[type=\"text\"], .theme-green .search input[type=\"text\"], .theme-purple .search input[type=\"text\"] { color: #666; } .theme-black .search input[type=\"text\"] + .input-group-btn .btn, .theme-blue .search input[type=\"text\"] + .input-group-btn .btn, .theme-green .search input[type=\"text\"] + .input-group-btn .btn, .theme-purple .search input[type=\"text\"] + .input-group-btn .btn { color: rgba(255, 255, 255, 0.5); } .theme-black .search input[type=\"text\"]:focus, .theme-black .search input[type=\"text\"]:focus + .input-group-btn .btn, .theme-blue .search input[type=\"text\"]:focus, .theme-blue .search input[type=\"text\"]:focus + .input-group-btn .btn, .theme-green .search input[type=\"text\"]:focus, .theme-green .search input[type=\"text\"]:focus + .input-group-btn .btn, .theme-purple .search input[type=\"text\"]:focus, .theme-purple .search input[type=\"text\"]:focus + .input-group-btn .btn { background-color: #fff; color: #666; } .theme-black .header { background: #1a2433; background: -webkit-linear-gradient(left, #1a2433 0%, #253449 80%, #253449 100%); background: -webkit-gradient(linear, left top, right top, from(#1a2433), color-stop(80%, #253449), to(#253449)); background: linear-gradient(to right, #1a2433 0%, #253449 80%, #253449 100%); } .theme-blue .header { background: #0062c5; background: -webkit-linear-gradient(left, #0062c5 0%, #0073e6 80%, #0073e6 100%); background: -webkit-gradient(linear, left top, right top, from(#0062c5), color-stop(80%, #0073e6), to(#0073e6)); background: linear-gradient(to right, #0062c5 0%, #0073e6 80%, #0073e6 100%); } .theme-green .header { background: #08a283; background: -webkit-linear-gradient(left, #08a283 0%, #0ac29d 80%, #0ac29d 100%); background: -webkit-gradient(linear, left top, right top, from(#08a283), color-stop(80%, #0ac29d), to(#0ac29d)); background: linear-gradient(to right, #08a283 0%, #0ac29d 80%, #0ac29d 100%); } .theme-purple .header { background: #494683; background: -webkit-linear-gradient(left, #494683 0%, #555299 80%, #555299 100%); background: -webkit-gradient(linear, left top, right top, from(#494683), color-stop(80%, #555299), to(#555299)); background: linear-gradient(to right, #494683 0%, #555299 80%, #555299 100%); } @media (min-width: 767px) { .modal-center { text-align: center; padding: 0 !important; } .modal-center:before { content: ''; display: inline-block; height: 100%; vertical-align: middle; margin-right: -4px; } .modal-center .modal-dialog { display: inline-block; text-align: left; vertical-align: middle; } .donate-box .donate-footer { margin: 0 -15px -16px -15px; } } @media (min-width: 768px) { .lead { font-size: 21px; } .dl-horizontal dt { float: left; width: 160px; clear: left; text-align: right; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; } .dl-horizontal dd { margin-left: 180px; } .container { width: 750px; } .col-sm-1, .col-sm-2, .col-sm-3, .col-sm-4, .col-sm-5, .col-sm-6, .col-sm-7, .col-sm-8, .col-sm-9, .col-sm-10, .col-sm-11, .col-sm-12 { float: left; } .col-sm-1 { width: 8.33333%; } .col-sm-2 { width: 16.66667%; } .col-sm-3 { width: 25%; } .col-sm-4 { width: 33.33333%; } .col-sm-5 { width: 41.66667%; } .col-sm-6 { width: 50%; } .col-sm-7 { width: 58.33333%; } .col-sm-8 { width: 66.66667%; } .col-sm-9 { width: 75%; } .col-sm-10 { width: 83.33333%; } .col-sm-11 { width: 91.66667%; } .col-sm-12 { width: 100%; } .col-sm-pull-0 { right: auto; } .col-sm-pull-1 { right: 8.33333%; } .col-sm-pull-2 { right: 16.66667%; } .col-sm-pull-3 { right: 25%; } .col-sm-pull-4 { right: 33.33333%; } .col-sm-pull-5 { right: 41.66667%; } .col-sm-pull-6 { right: 50%; } .col-sm-pull-7 { right: 58.33333%; } .col-sm-pull-8 { right: 66.66667%; } .col-sm-pull-9 { right: 75%; } .col-sm-pull-10 { right: 83.33333%; } .col-sm-pull-11 { right: 91.66667%; } .col-sm-pull-12 { right: 100%; } .col-sm-push-0 { left: auto; } .col-sm-push-1 { left: 8.33333%; } .col-sm-push-2 { left: 16.66667%; } .col-sm-push-3 { left: 25%; } .col-sm-push-4 { left: 33.33333%; } .col-sm-push-5 { left: 41.66667%; } .col-sm-push-6 { left: 50%; } .col-sm-push-7 { left: 58.33333%; } .col-sm-push-8 { left: 66.66667%; } .col-sm-push-9 { left: 75%; } .col-sm-push-10 { left: 83.33333%; } .col-sm-push-11 { left: 91.66667%; } .col-sm-push-12 { left: 100%; } .col-sm-offset-0 { margin-left: 0%; } .col-sm-offset-1 { margin-left: 8.33333%; } .col-sm-offset-2 { margin-left: 16.66667%; } .col-sm-offset-3 { margin-left: 25%; } .col-sm-offset-4 { margin-left: 33.33333%; } .col-sm-offset-5 { margin-left: 41.66667%; } .col-sm-offset-6 { margin-left: 50%; } .col-sm-offset-7 { margin-left: 58.33333%; } .col-sm-offset-8 { margin-left: 66.66667%; } .col-sm-offset-9 { margin-left: 75%; } .col-sm-offset-10 { margin-left: 83.33333%; } .col-sm-offset-11 { margin-left: 91.66667%; } .col-sm-offset-12 { margin-left: 100%; } .navbar-right .dropdown-menu { right: 0; left: auto; } .navbar-right .dropdown-menu-left { left: 0; right: auto; } .nav-justified > li, .nav-tabs.nav-justified > li { display: table-cell; width: 1%; } .nav-justified > li > a, .nav-tabs.nav-justified > li > a { margin-bottom: 0; } .nav-tabs-justified > li > a, .nav-tabs.nav-justified > li > a { border-bottom: 1px solid #f2f2f2; border-radius: 4px 4px 0 0; } .nav-tabs-justified > .active > a, .nav-tabs.nav-justified > .active > a, .nav-tabs-justified > .active > a:hover, .nav-tabs.nav-justified > .active > a:hover, .nav-tabs-justified > .active > a:focus, .nav-tabs.nav-justified > .active > a:focus { border-bottom-color: #fff; } .navbar { border-radius: 4px; } .navbar-header { float: left; } .navbar-collapse { width: auto; border-top: 0; -webkit-box-shadow: none; box-shadow: none; } .navbar-collapse.collapse { display: block !important; height: auto !important; padding-bottom: 0; overflow: visible !important; } .navbar-collapse.in { overflow-y: visible; } .navbar-fixed-top .navbar-collapse, .navbar-static-top .navbar-collapse, .navbar-fixed-bottom .navbar-collapse { padding-left: 0; padding-right: 0; } .container > .navbar-header, .container > .navbar-collapse, .container-fluid > .navbar-header, .container-fluid > .navbar-collapse { margin-right: 0; margin-left: 0; } .navbar-static-top { border-radius: 0; } .navbar-fixed-top, .navbar-fixed-bottom { border-radius: 0; } .navbar > .container .navbar-brand, .navbar > .container-fluid .navbar-brand { margin-left: -15px; } .navbar-toggle { display: none; } .navbar-nav { float: left; margin: 0; } .navbar-nav > li { float: left; } .navbar-nav > li > a { padding-top: 14.5px; padding-bottom: 14.5px; } .navbar-form .form-group { display: inline-block; margin-bottom: 0; vertical-align: middle; } .navbar-form .form-control { display: inline-block; width: auto; vertical-align: middle; } .navbar-form .form-control-static { display: inline-block; } .navbar-form .input-group { display: inline-table; vertical-align: middle; } .navbar-form .input-group .input-group-addon, .navbar-form .input-group .input-group-btn, .navbar-form .input-group .form-control { width: auto; } .navbar-form .input-group > .form-control { width: 100%; } .navbar-form .control-label { margin-bottom: 0; vertical-align: middle; } .navbar-form .radio, .navbar-form .checkbox { display: inline-block; margin-top: 0; margin-bottom: 0; vertical-align: middle; } .navbar-form .radio label, .navbar-form .checkbox label { padding-left: 0; } .navbar-form .radio input[type=\"radio\"], .navbar-form .checkbox input[type=\"checkbox\"] { position: relative; margin-left: 0; } .navbar-form .has-feedback .form-control-feedback { top: 0; } .navbar-form { width: auto; border: 0; margin-left: 0; margin-right: 0; padding-top: 0; padding-bottom: 0; -webkit-box-shadow: none; box-shadow: none; } .navbar-text { float: left; margin-left: 15px; margin-right: 15px; } .navbar-left { float: left !important; } .navbar-right { float: right !important; margin-right: -15px; } .navbar-right ~ .navbar-right { margin-right: 0; } .modal-dialog { width: 600px; margin: 30px auto; } .modal-content { -webkit-box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05); } .modal-sm { width: 300px; } .header { position: fixed; top: 0; bottom: 0; left: 0; z-index: 1000; display: block; padding: 0; overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */ border-right: 1px solid #f6f6f6; width: 4.16667%; } .sidebar { position: fixed; top: 0; bottom: 0; left: 0; display: block; padding: 0; overflow-x: hidden; overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */ border-right: 1px solid #f6f6f6; width: 33.33333%; } .main { width: 62.5%; padding-right: 20px; padding-left: 20px; } .footer { position: fixed; left: 0; bottom: 0; background-color: transparent; z-index: 1050; width: 4.16667%; } body.main-center .main { margin-left: 4.16667%; } body.main-left .sidebar { margin-right: 4.16667%; } body.main-right .sidebar { margin-left: 4.16667%; } body.main-right .main { margin-left: 37.5%; } body.no-sidebar.main-left .main { width: 95.83333333%; margin-right: 4.16667%; } body.no-sidebar.main-right .main, body.no-sidebar.main-center .main { width: 95.83333333%; margin-left: 4.16667%; } .header .navbar-header { float: none; } #avatar img { padding: 5px; } .bar.bar-footer:before { width: -webkit-calc(100% + 40px); width: calc(100% + 40px); left: -20px; } .header .social-links { display: none; } } @media (min-width: 992px) { .slimContent{ margin-top: 20px; } .container { width: 970px; } .col-md-1, .col-md-2, .col-md-3, .col-md-4, .col-md-5, .col-md-6, .col-md-7, .col-md-8, .col-md-9, .col-md-10, .col-md-11, .col-md-12 { float: left; } .col-md-1 { width: 8.33333%; } .col-md-2 { width: 16.66667%; } .col-md-3 { width: 25%; } .col-md-4 { width: 33.33333%; } .col-md-5 { width: 41.66667%; } .col-md-6 { width: 50%; } .col-md-7 { width: 58.33333%; } .col-md-8 { width: 66.66667%; } .col-md-9 { width: 75%; } .col-md-10 { width: 83.33333%; } .col-md-11 { width: 91.66667%; } .col-md-12 { width: 100%; } .col-md-pull-0 { right: auto; } .col-md-pull-1 { right: 8.33333%; } .col-md-pull-2 { right: 16.66667%; } .col-md-pull-3 { right: 25%; } .col-md-pull-4 { right: 33.33333%; } .col-md-pull-5 { right: 41.66667%; } .col-md-pull-6 { right: 50%; } .col-md-pull-7 { right: 58.33333%; } .col-md-pull-8 { right: 66.66667%; } .col-md-pull-9 { right: 75%; } .col-md-pull-10 { right: 83.33333%; } .col-md-pull-11 { right: 91.66667%; } .col-md-pull-12 { right: 100%; } .col-md-push-0 { left: auto; } .col-md-push-1 { left: 8.33333%; } .col-md-push-2 { left: 16.66667%; } .col-md-push-3 { left: 25%; } .col-md-push-4 { left: 33.33333%; } .col-md-push-5 { left: 41.66667%; } .col-md-push-6 { left: 50%; } .col-md-push-7 { left: 58.33333%; } .col-md-push-8 { left: 66.66667%; } .col-md-push-9 { left: 75%; } .col-md-push-10 { left: 83.33333%; } .col-md-push-11 { left: 91.66667%; } .col-md-push-12 { left: 100%; } .col-md-offset-0 { margin-left: 0%; } .col-md-offset-1 { margin-left: 8.33333%; } .col-md-offset-2 { margin-left: 16.66667%; } .col-md-offset-3 { margin-left: 25%; } .col-md-offset-4 { margin-left: 33.33333%; } .col-md-offset-5 { margin-left: 41.66667%; } .col-md-offset-6 { margin-left: 50%; } .col-md-offset-7 { margin-left: 58.33333%; } .col-md-offset-8 { margin-left: 66.66667%; } .col-md-offset-9 { margin-left: 75%; } .col-md-offset-10 { margin-left: 83.33333%; } .col-md-offset-11 { margin-left: 91.66667%; } .col-md-offset-12 { margin-left: 100%; } .modal-lg { width: 900px; } .header { width: 16.66667%; } .sidebar { width: 25%; } .sidebar .slimContent { padding-right: 25px; padding-left: 25px; } .main { width: 58.33333%; padding-right: 25px; padding-left: 25px; } .footer { width: 16.66667%; } body.main-center .main { margin-left: 16.66667%; } body.main-left .sidebar { margin-right: 16.66667%; } body.main-right .sidebar { margin-left: 16.66667%; } body.main-right .main { margin-left: 41.66667%; } body.no-sidebar.main-left .main { width: 83.33333333%; margin-right: 16.66667%; } body.no-sidebar.main-right .main, body.no-sidebar.main-center .main { width: 83.33333333%; margin-left: 16.66667%; } .bar.bar-footer:before { width: -webkit-calc(100% + 50px); width: calc(100% + 50px); left: -25px; } .marked-body .headerlink:before, .marked-body .markdownIt-Anchor:before { display: inline-block; width: 18px; content: \"#\"; color: #0a6ebd; text-align: right; float: left; visibility: hidden; } .marked-body .headerlink:before { margin-left: -15px; padding-right: 2px; } .marked-body .markdownIt-Anchor:before { margin-left: -20px; } .marked-body h1:hover .headerlink:before, .marked-body h1:hover .markdownIt-Anchor:before, .marked-body h2:hover .headerlink:before, .marked-body h2:hover .markdownIt-Anchor:before, .marked-body h3:hover .headerlink:before, .marked-body h3:hover .markdownIt-Anchor:before, .marked-body h4:hover .headerlink:before, .marked-body h4:hover .markdownIt-Anchor:before, .marked-body h5:hover .headerlink:before, .marked-body h5:hover .markdownIt-Anchor:before, .marked-body h6:hover .headerlink:before, .marked-body h6:hover .markdownIt-Anchor:before { visibility: visible; } } @media (min-width: 1200px) { .container { width: 1170px; } .col-lg-1, .col-lg-2, .col-lg-3, .col-lg-4, .col-lg-5, .col-lg-6, .col-lg-7, .col-lg-8, .col-lg-9, .col-lg-10, .col-lg-11, .col-lg-12 { float: left; } .col-lg-1 { width: 8.33333%; } .col-lg-2 { width: 16.66667%; } .col-lg-3 { width: 25%; } .col-lg-4 { width: 33.33333%; } .col-lg-5 { width: 41.66667%; } .col-lg-6 { width: 50%; } .col-lg-7 { width: 58.33333%; } .col-lg-8 { width: 66.66667%; } .col-lg-9 { width: 75%; } .col-lg-10 { width: 83.33333%; } .col-lg-11 { width: 91.66667%; } .col-lg-12 { width: 100%; } .col-lg-pull-0 { right: auto; } .col-lg-pull-1 { right: 8.33333%; } .col-lg-pull-2 { right: 16.66667%; } .col-lg-pull-3 { right: 25%; } .col-lg-pull-4 { right: 33.33333%; } .col-lg-pull-5 { right: 41.66667%; } .col-lg-pull-6 { right: 50%; } .col-lg-pull-7 { right: 58.33333%; } .col-lg-pull-8 { right: 66.66667%; } .col-lg-pull-9 { right: 75%; } .col-lg-pull-10 { right: 83.33333%; } .col-lg-pull-11 { right: 91.66667%; } .col-lg-pull-12 { right: 100%; } .col-lg-push-0 { left: auto; } .col-lg-push-1 { left: 8.33333%; } .col-lg-push-2 { left: 16.66667%; } .col-lg-push-3 { left: 25%; } .col-lg-push-4 { left: 33.33333%; } .col-lg-push-5 { left: 41.66667%; } .col-lg-push-6 { left: 50%; } .col-lg-push-7 { left: 58.33333%; } .col-lg-push-8 { left: 66.66667%; } .col-lg-push-9 { left: 75%; } .col-lg-push-10 { left: 83.33333%; } .col-lg-push-11 { left: 91.66667%; } .col-lg-push-12 { left: 100%; } .col-lg-offset-0 { margin-left: 0%; } .col-lg-offset-1 { margin-left: 8.33333%; } .col-lg-offset-2 { margin-left: 16.66667%; } .col-lg-offset-3 { margin-left: 25%; } .col-lg-offset-4 { margin-left: 33.33333%; } .col-lg-offset-5 { margin-left: 41.66667%; } .col-lg-offset-6 { margin-left: 50%; } .col-lg-offset-7 { margin-left: 58.33333%; } .col-lg-offset-8 { margin-left: 66.66667%; } .col-lg-offset-9 { margin-left: 75%; } .col-lg-offset-10 { margin-left: 83.33333%; } .col-lg-offset-11 { margin-left: 91.66667%; } .col-lg-offset-12 { margin-left: 100%; } .visible-lg { display: block !important; } table.visible-lg { display: table !important; } tr.visible-lg { display: table-row !important; } th.visible-lg, td.visible-lg { display: table-cell !important; } .visible-lg-block { display: block !important; } .visible-lg-inline { display: inline !important; } .visible-lg-inline-block { display: inline-block !important; } .hidden-lg { display: none !important; } .header { width: 16.66667%; } .sidebar { width: 23%; } .sidebar .slimContent { padding-right: 30px; padding-left: 30px; } .main { width: 60.33333%; padding-right: 30px; padding-left: 30px; } .footer { width: 16.66667%; } body.main-center .main { margin-left: 16.66667%; } body.main-left .sidebar { margin-right: 16.66667%; } body.main-right .sidebar { margin-left: 16.66667%; } body.main-right .main { margin-left: 39.66667%; } body.no-sidebar.main-left .main { width: 83.33333333%; margin-right: 16.66667%; } body.no-sidebar.main-right .main, body.no-sidebar.main-center .main { width: 83.33333333%; margin-left: 16.66667%; } .main-nav > li > a { padding: 10px 20px; } .bar.bar-footer:before { width: -webkit-calc(100% + 60px); width: calc(100% + 60px); left: -30px; } } @media (min-width: 1440px) { .header { width: 16.66667%; } .sidebar { width: 21%; } .main { width: 62.33333%; } .footer { width: 16.66667%; } body.main-center .main { margin-left: 16.66667%; } body.main-left .sidebar { margin-right: 16.66667%; } body.main-right .sidebar { margin-left: 16.66667%; } body.main-right .main { margin-left: 37.66667%; } body.no-sidebar.main-left .main { width: 83.33333333%; margin-right: 16.66667%; } body.no-sidebar.main-right .main, body.no-sidebar.main-center .main { width: 83.33333333%; margin-left: 16.66667%; } .header #title { font-size: 15px; } } @media (max-width: 1199px) { .main-nav > li > a { padding: 6px 20px; } .bar .pager li a span { display: none; } .footer .copyright { display: none; } } @media (max-width: 767px) { .navbar-nav .open .dropdown-menu { position: static; float: none; width: auto; margin-top: 0; background-color: transparent; border: 0; -webkit-box-shadow: none; box-shadow: none; } .navbar-nav .open .dropdown-menu > li > a, .navbar-nav .open .dropdown-menu .dropdown-header { padding: 5px 15px 5px 25px; } .navbar-nav .open .dropdown-menu > li > a { line-height: 21px; } .navbar-nav .open .dropdown-menu > li > a:hover, .navbar-nav .open .dropdown-menu > li > a:focus { background-image: none; } .navbar-form .form-group { margin-bottom: 5px; } .navbar-form .form-group:last-child { margin-bottom: 0; } .navbar-default .navbar-nav .open .dropdown-menu > li > a { color: #777; } .navbar-default .navbar-nav .open .dropdown-menu > li > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > li > a:focus { color: #333; background-color: transparent; } .navbar-default .navbar-nav .open .dropdown-menu > .active > a, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > .active > a:focus { color: #555; background-color: #e7e7e7; } .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a, .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:hover, .navbar-default .navbar-nav .open .dropdown-menu > .disabled > a:focus { color: #ccc; background-color: transparent; } .navbar-inverse .navbar-nav .open .dropdown-menu > .dropdown-header { border-color: #090909; } .navbar-inverse .navbar-nav .open .dropdown-menu .divider { background-color: #090909; } .navbar-inverse .navbar-nav .open .dropdown-menu > li > a { color: #9d9d9d; } .navbar-inverse .navbar-nav .open .dropdown-menu > li > a:hover, .navbar-inverse .navbar-nav .open .dropdown-menu > li > a:focus { color: #fff; background-color: transparent; } .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a, .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a:hover, .navbar-inverse .navbar-nav .open .dropdown-menu > .active > a:focus { color: #fff; background-color: #090909; } .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a, .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a:hover, .navbar-inverse .navbar-nav .open .dropdown-menu > .disabled > a:focus { color: #444; background-color: transparent; } .visible-xs { display: block !important; } table.visible-xs { display: table !important; } tr.visible-xs { display: table-row !important; } th.visible-xs, td.visible-xs { display: table-cell !important; } .visible-xs-block { display: block !important; } .visible-xs-inline { display: inline !important; } .visible-xs-inline-block { display: inline-block !important; } .hidden-xs { display: none !important; } body { padding-top: 53px; } .list-circle-num, .list-square-num { margin: 0 0 40px; } .modal-xs-full .modal-dialog, .modal-xs-full .modal-content { height: 100%; width: 100%; margin: 0; border-radius: 0; -webkit-box-shadow: none; box-shadow: none; } .modal-xs-full .modal-dialog .donate-box, .modal-xs-full .modal-content .donate-box { padding-top: 50px; } .highlight table:before { display: block; content: ' '; height: 38px; position: absolute; top: 0; left: 0; right: 0; margin-left: -10px; margin-right: -10px; margin-top: -38px; background-color: #f6f6f6; border-top-left-radius: 4px; border-top-right-radius: 4px; } .header { position: fixed; left: 0; right: 0; top: 0; width: 100%; z-index: 1050; } .header:before, .header:after { content: \" \"; display: table; } .header:after { clear: both; } .sidebar { display: none; } .main { min-height: auto; } .main-nav > li > a { padding: 10px 20px; } .sidebar-form { border: 0; margin: 9px 45px 9px 0; } .sidebar-form .input-group-btn .btn { color: #2196f3; } .sidebar-form input[type=\"text\"]:focus { background-color: transparent; } .sidebar-form input[type=\"text\"]:focus + .input-group-btn .btn { color: #2196f3; background-color: transparent; } .header .navbar-toggle { position: absolute; top: 0; right: 0; margin-right: 5px; } .header .navbar-toggle .icon-bar { width: 18px; } .header .search { width: 90%; float: right; } .header .profile-block { padding: 0; margin: 10px 0; width: 8.33333%; float: left; } .header #avatar { width: 32px; height: 32px; } .header #name, .header #title, .header #location { display: none; } #main-navbar { position: absolute; width: 100%; background-color: #fbfbfb; border-bottom: 1px solid #f6f6f6; z-index: 99; } .main .content { min-height: auto; } .sidebar-toc.in { position: fixed; top: 50px; bottom: 50px; z-index: 9; } .bar.bar-footer { top: auto !important; bottom: 0 !important; } .footer { display: none; position: static; } .footer .copyright { display: block; } .social-links .tooltip { display: none !important; visibility: hidden; } .theme-black .search input[type=\"text\"]:focus, .theme-blue .search input[type=\"text\"]:focus, .theme-green .search input[type=\"text\"]:focus, .theme-purple .search input[type=\"text\"]:focus { background-color: transparent; } .theme-black .search input[type=\"text\"]:focus + .input-group-btn .btn, .theme-blue .search input[type=\"text\"]:focus + .input-group-btn .btn, .theme-green .search input[type=\"text\"]:focus + .input-group-btn .btn, .theme-purple .search input[type=\"text\"]:focus + .input-group-btn .btn { color: rgba(255, 255, 255, 0.5); background-color: transparent; } .theme-black #main-navbar { background: #1a2433; background: -webkit-linear-gradient(left, #1a2433 0%, #253449 80%, #253449 100%); background: -webkit-gradient(linear, left top, right top, from(#1a2433), color-stop(80%, #253449), to(#253449)); background: linear-gradient(to right, #1a2433 0%, #253449 80%, #253449 100%); } .theme-blue #main-navbar { background: #0062c5; background: -webkit-linear-gradient(left, #0062c5 0%, #0073e6 80%, #0073e6 100%); background: -webkit-gradient(linear, left top, right top, from(#0062c5), color-stop(80%, #0073e6), to(#0073e6)); background: linear-gradient(to right, #0062c5 0%, #0073e6 80%, #0073e6 100%); } .theme-green #main-navbar { background: #08a283; background: -webkit-linear-gradient(left, #08a283 0%, #0ac29d 80%, #0ac29d 100%); background: -webkit-gradient(linear, left top, right top, from(#08a283), color-stop(80%, #0ac29d), to(#0ac29d)); background: linear-gradient(to right, #08a283 0%, #0ac29d 80%, #0ac29d 100%); } .theme-purple #main-navbar { background: #494683; background: -webkit-linear-gradient(left, #494683 0%, #555299 80%, #555299 100%); background: -webkit-gradient(linear, left top, right top, from(#494683), color-stop(80%, #555299), to(#555299)); background: linear-gradient(to right, #494683 0%, #555299 80%, #555299 100%); } } @media screen and (max-width: 559px),screen and (max-height: 479px) { .ins-search-container { top: 0; left: 0; margin: 0; width: 100%; height: 100%; background: #f7f7f7; } } @media (max-width: 480px) { .header #avatar { width: 24px; height: 24px; margin-top: 3px; margin-left: 15px; } } @media (min-width: 768px) and (max-width: 991px) { .visible-sm { display: block !important; } table.visible-sm { display: table !important; } tr.visible-sm { display: table-row !important; } th.visible-sm, td.visible-sm { display: table-cell !important; } .visible-sm-block { display: block !important; } .visible-sm-inline { display: inline !important; } .visible-sm-inline-block { display: inline-block !important; } .hidden-sm { display: none !important; } .sidebar-form { display: none; } .header .main-nav > li > a { text-align: center; padding-left: 0; padding-right: 0; } .header .main-nav > li > a span { display: none; } .header .profile-block { padding-top: 10px; padding-left: 0; padding-right: 0; } .header #avatar { width: 32px; height: 32px; } .footer { padding-left: 0; padding-right: 0; } .social-links { display: block; width: 100%; text-align: center; margin-bottom: 0; } .social-links:before, .social-links:after { content: \" \"; display: table; } .social-links:after { clear: both; } .social-links li { display: block; margin-left: 0; margin-top: 10px; } .social-links li:before, .social-links li:after { content: \" \"; display: table; } .social-links li:after { clear: both; } .social-links .tooltip { display: none !important; visibility: hidden; } } @media (min-width: 992px) and (max-width: 1199px) { .visible-md { display: block !important; } table.visible-md { display: table !important; } tr.visible-md { display: table-row !important; } th.visible-md, td.visible-md { display: table-cell !important; } .visible-md-block { display: block !important; } .visible-md-inline { display: inline !important; } .visible-md-inline-block { display: inline-block !important; } .hidden-md { display: none !important; } } @media print { *, *:before, *:after { background: transparent !important; color: #000 !important; -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; } a, a:visited { text-decoration: underline; } a[href]:after { content: \" (\" attr(href) \")\"; } abbr[title]:after { content: \" (\" attr(title) \")\"; } a[href^=\"#\"]:after, a[href^=\"javascript:\"]:after { content: \"\"; } pre, blockquote { border: 1px solid #999; page-break-inside: avoid; } thead { display: table-header-group; } tr, img { page-break-inside: avoid; } img { max-width: 100% !important; } p, h2, h3 { orphans: 3; widows: 3; } h2, h3 { page-break-after: avoid; } .navbar { display: none; } .btn > .caret, .dropup > .btn > .caret { border-top-color: #000 !important; } .label { border: 1px solid #000; } .table { border-collapse: collapse !important; } .table td, .table th { background-color: #fff !important; } .table-bordered th, .table-bordered td { border: 1px solid #ddd !important; } .visible-print { display: block !important; } table.visible-print { display: table !important; } tr.visible-print { display: table-row !important; } th.visible-print, td.visible-print { display: table-cell !important; } .visible-print-block { display: block !important; } .visible-print-inline { display: inline !important; } .visible-print-inline-block { display: inline-block !important; } .hidden-print { display: none !important; } } @media (max-device-width: 480px) and (orientation: landscape) { .navbar-fixed-top .navbar-collapse, .navbar-fixed-bottom .navbar-collapse { max-height: 200px; } }"},{"title":"","date":"2022-06-24T17:19:04.511Z","updated":"2022-06-24T17:19:04.511Z","comments":true,"path":"js/application.js","permalink":"http://fyupeng.github.io/js/application.js","excerpt":"","text":"$(function() { // bootstrap tooltip $('[data-toggle=\"tooltip\"]').tooltip(); // slimscroll if (typeof $.fn.slimScroll != 'undefined') { $(\".sidebar .slimContent\").slimScroll({ height: $(window).height(), color: \"rgba(0,0,0,0.15)\", size: \"5px\", position: 'right', // allowPageScroll: true }); } $('#collapseToc').on('shown.bs.collapse', function() { // do somethingâ€¦ // slimscroll if (typeof $.fn.slimScroll != 'undefined') { $(\".sidebar .slimContent\").slimScroll().on('slimscroll'); } }); // geopattern èƒŒæ™¯ç”Ÿæˆ $(\".geopattern\").each(function() { $(this).geopattern($(this).data('pattern-id')); }); // okayNav var navigation = $('#nav-main').okayNav({ swipe_enabled: false, // If true, you'll be able to swipe left/right to open the navigation }); // modalå±…ä¸­ // $('.modal').on('shown.bs.modal', function(e) { // $(this).show(); // var modalDialog = $(this).find(\".modal-dialog\"); // // Applying the top margin on modal dialog to align it vertically center // modalDialog.css(\"margin-top\", Math.max(0, ($(window).height() - modalDialog.height()) / 2)); // }); // sticky $('[data-stick-bottom]').keepInView({ fixed: false, parentClass: \"has-sticky\", customClass: \"sticky\", trigger: 'bottom', zindex: 42, edgeOffset: 0 }); $('[data-stick-top]').keepInView({ fixed: true, parentClass: \"has-sticky\", customClass: \"sticky\", trigger: 'top', zindex: 42, edgeOffset: 0 }); // menu auto highlight var menuHighlight = $(\"ul.main-nav\").hasClass('menu-highlight'); if (menuHighlight) { var currentPathname = location.pathname, $menuList = $(\"ul.main-nav>li\"), activeIndex = -1; for (var i = 0, length = $menuList.length; i < length; i++) { var itemHref = $($menuList[i]).find('a').attr('href'); if (currentPathname.indexOf(itemHref) > -1 || (currentPathname === '/' && (itemHref === '/.' || itemHref === '/' || itemHref === 'index.html' || itemHref === '/index.html'))) { activeIndex = i; } $($menuList[i]).removeClass('active'); } $menuList[activeIndex] && $($menuList[activeIndex]).addClass('active'); } });"},{"title":"","date":"2022-06-24T17:19:04.496Z","updated":"2022-06-24T17:19:04.496Z","comments":true,"path":"css/style.min.css","permalink":"http://fyupeng.github.io/css/style.min.css","excerpt":"","text":"@charset \"UTF-8\";/*! * Bootstrap v3.3.7 (http://getbootstrap.com) * Copyright 2011-2016 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE) *//*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}b,optgroup,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0}mark{background:#ff0;color:#000}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0;vertical-align:middle}svg:not(:root){overflow:hidden}hr{-webkit-box-sizing:content-box;box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{-webkit-box-sizing:border-box;box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;-webkit-box-sizing:content-box;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}textarea{overflow:auto}td,th{padding:0}/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:transparent}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a:focus{outline:-webkit-focus-ring-color auto 5px;outline-offset:-2px}figure{margin:0}.img-responsive{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{padding:4px;line-height:1.57143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:21px;margin-bottom:21px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role=button]{cursor:pointer}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-weight:400;line-height:1;color:#777}.h1,.h2,.h3,h1,h2,h3{margin-top:21px;margin-bottom:10.5px}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small{font-size:65%}.h4,.h5,.h6,h4,h5,h6{margin-top:10.5px;margin-bottom:10.5px}.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-size:75%}.h1,h1{font-size:30px}.h2,h2{font-size:26px}.h3,h3{font-size:22px}.h4,h4{font-size:18px}.h5,h5{font-size:14px}.h6,h6{font-size:12px}p{margin:0 0 10.5px}.lead{margin-bottom:21px;font-size:16px;font-weight:300;line-height:1.4}.small,small{font-size:85%}.mark,mark{background-color:#fcf8e3;padding:.2em}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.text-lowercase{text-transform:lowercase}.initialism,.text-uppercase{text-transform:uppercase}.text-capitalize{text-transform:capitalize}.text-muted{color:#777!important}.text-primary{color:#2196f3}a.text-primary:focus,a.text-primary:hover{color:#0c7cd5}.text-success{color:#3c763d}a.text-success:focus,a.text-success:hover{color:#2b542c}.text-info{color:#31708f}a.text-info:focus,a.text-info:hover{color:#245269}.text-warning{color:#8a6d3b}a.text-warning:focus,a.text-warning:hover{color:#66512c}.text-danger{color:#a94442}a.text-danger:focus,a.text-danger:hover{color:#843534}.bg-primary{color:#fff;background-color:#2196f3}a.bg-primary:focus,a.bg-primary:hover{background-color:#0c7cd5}.bg-success{background-color:#dff0d8}a.bg-success:focus,a.bg-success:hover{background-color:#c1e2b3}.bg-info{background-color:#d9edf7}a.bg-info:focus,a.bg-info:hover{background-color:#afd9ee}.bg-warning{background-color:#fcf8e3}a.bg-warning:focus,a.bg-warning:hover{background-color:#f7ecb5}.bg-danger{background-color:#f2dede}a.bg-danger:focus,a.bg-danger:hover{background-color:#e4b9b9}.page-header{padding-bottom:9.5px;margin:42px 0 21px;border-bottom:1px solid #eee}ol,ul{margin-top:0;margin-bottom:10.5px}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}.list-unstyled{padding-left:0;list-style:none}.list-inline{padding-left:0;list-style:none;margin-left:-5px}.list-inline>li{display:inline-block;padding-left:5px;padding-right:5px}dl{margin-top:0;margin-bottom:21px}dd,dt{line-height:1.57143}dt{font-weight:700}dd{margin-left:0}.dl-horizontal dd:after,.dl-horizontal dd:before{content:\" \";display:table}.dl-horizontal dd:after{clear:both}abbr[data-original-title],abbr[title]{cursor:help;border-bottom:1px dotted #777}.initialism{font-size:90%}blockquote{padding:10.5px 16px;margin:0 0 21px;border:1px dotted #eee;border-left:3px solid #eee;background-color:#fbfbfb}blockquote ol:last-child,blockquote p:last-child,blockquote ul:last-child{margin-bottom:0}blockquote .small,blockquote footer,blockquote small{display:block;font-size:80%;line-height:1.57143;color:#777}blockquote .small:before,blockquote footer:before,blockquote small:before{content:'\\2014 \\00A0'}.blockquote-reverse,blockquote.pull-right{padding-right:15px;padding-left:0;border-right:5px solid #eee;border-left:0;text-align:right}.blockquote-reverse .small:before,.blockquote-reverse footer:before,.blockquote-reverse small:before,blockquote.pull-right .small:before,blockquote.pull-right footer:before,blockquote.pull-right small:before{content:''}.blockquote-reverse .small:after,.blockquote-reverse footer:after,.blockquote-reverse small:after,blockquote.pull-right .small:after,blockquote.pull-right footer:after,blockquote.pull-right small:after{content:'\\00A0 \\2014'}address{margin-bottom:21px;font-style:normal;line-height:1.57143}.container{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}.container:after,.container:before{content:\" \";display:table}.container:after{clear:both}.container-fluid{margin-right:auto;margin-left:auto;padding-left:15px;padding-right:15px}.container-fluid:after,.container-fluid:before{content:\" \";display:table}.container-fluid:after{clear:both}.row{margin-left:-15px;margin-right:-15px}.row:after,.row:before{content:\" \";display:table}.row:after{clear:both}.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{position:relative;min-height:1px;padding-left:15px;padding-right:15px}.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{float:left}.col-xs-1{width:8.33333%}.col-xs-2{width:16.66667%}.col-xs-3{width:25%}.col-xs-4{width:33.33333%}.col-xs-5{width:41.66667%}.col-xs-6{width:50%}.col-xs-7{width:58.33333%}.col-xs-8{width:66.66667%}.col-xs-9{width:75%}.col-xs-10{width:83.33333%}.col-xs-11{width:91.66667%}.col-xs-12{width:100%}.col-xs-pull-0{right:auto}.col-xs-pull-1{right:8.33333%}.col-xs-pull-2{right:16.66667%}.col-xs-pull-3{right:25%}.col-xs-pull-4{right:33.33333%}.col-xs-pull-5{right:41.66667%}.col-xs-pull-6{right:50%}.col-xs-pull-7{right:58.33333%}.col-xs-pull-8{right:66.66667%}.col-xs-pull-9{right:75%}.col-xs-pull-10{right:83.33333%}.col-xs-pull-11{right:91.66667%}.col-xs-pull-12{right:100%}.col-xs-push-0{left:auto}.col-xs-push-1{left:8.33333%}.col-xs-push-2{left:16.66667%}.col-xs-push-3{left:25%}.col-xs-push-4{left:33.33333%}.col-xs-push-5{left:41.66667%}.col-xs-push-6{left:50%}.col-xs-push-7{left:58.33333%}.col-xs-push-8{left:66.66667%}.col-xs-push-9{left:75%}.col-xs-push-10{left:83.33333%}.col-xs-push-11{left:91.66667%}.col-xs-push-12{left:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333%}.col-xs-offset-2{margin-left:16.66667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333%}.col-xs-offset-5{margin-left:41.66667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333%}.col-xs-offset-8{margin-left:66.66667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333%}.col-xs-offset-11{margin-left:91.66667%}.col-xs-offset-12{margin-left:100%}.btn{display:inline-block;margin-bottom:0;font-weight:400;text-align:center;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;padding:6px 12px;font-size:14px;line-height:1.57143;border-radius:4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn.active.focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn:active:focus,.btn:focus{outline:-webkit-focus-ring-color auto 5px;outline-offset:-2px}.btn.focus,.btn:focus,.btn:hover{color:#333;text-decoration:none}.btn.active,.btn:active{outline:0;background-image:none;-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,.125);box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;opacity:.65;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none}a.btn.disabled,fieldset[disabled] a.btn{pointer-events:none}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default.focus,.btn-default:focus{color:#333;background-color:#e6e6e6;border-color:#8c8c8c}.btn-default:hover{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default.active,.btn-default:active,.open>.btn-default.dropdown-toggle{color:#333;background-color:#e6e6e6;border-color:#adadad;background-image:none}.btn-default.active.focus,.btn-default.active:focus,.btn-default.active:hover,.btn-default:active.focus,.btn-default:active:focus,.btn-default:active:hover,.open>.btn-default.dropdown-toggle.focus,.open>.btn-default.dropdown-toggle:focus,.open>.btn-default.dropdown-toggle:hover{color:#333;background-color:#d4d4d4;border-color:#8c8c8c}.btn-default.disabled.focus,.btn-default.disabled:focus,.btn-default.disabled:hover,.btn-default[disabled].focus,.btn-default[disabled]:focus,.btn-default[disabled]:hover,fieldset[disabled] .btn-default.focus,fieldset[disabled] .btn-default:focus,fieldset[disabled] .btn-default:hover{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#2196f3;border-color:#0d8aee}.btn-primary.focus,.btn-primary:focus{color:#fff;background-color:#0c7cd5;border-color:#064475}.btn-primary:hover{color:#fff;background-color:#0c7cd5;border-color:#0a68b4}.btn-primary.active,.btn-primary:active,.open>.btn-primary.dropdown-toggle{color:#fff;background-color:#0c7cd5;border-color:#0a68b4;background-image:none}.btn-primary.active.focus,.btn-primary.active:focus,.btn-primary.active:hover,.btn-primary:active.focus,.btn-primary:active:focus,.btn-primary:active:hover,.open>.btn-primary.dropdown-toggle.focus,.open>.btn-primary.dropdown-toggle:focus,.open>.btn-primary.dropdown-toggle:hover{color:#fff;background-color:#0a68b4;border-color:#064475}.btn-primary.disabled.focus,.btn-primary.disabled:focus,.btn-primary.disabled:hover,.btn-primary[disabled].focus,.btn-primary[disabled]:focus,.btn-primary[disabled]:hover,fieldset[disabled] .btn-primary.focus,fieldset[disabled] .btn-primary:focus,fieldset[disabled] .btn-primary:hover{background-color:#2196f3;border-color:#0d8aee}.btn-primary .badge{color:#2196f3;background-color:#fff}.btn-success{color:#fff;background-color:#5cb85c;border-color:#4cae4c}.btn-success.focus,.btn-success:focus{color:#fff;background-color:#449d44;border-color:#255625}.btn-success:hover{color:#fff;background-color:#449d44;border-color:#398439}.btn-success.active,.btn-success:active,.open>.btn-success.dropdown-toggle{color:#fff;background-color:#449d44;border-color:#398439;background-image:none}.btn-success.active.focus,.btn-success.active:focus,.btn-success.active:hover,.btn-success:active.focus,.btn-success:active:focus,.btn-success:active:hover,.open>.btn-success.dropdown-toggle.focus,.open>.btn-success.dropdown-toggle:focus,.open>.btn-success.dropdown-toggle:hover{color:#fff;background-color:#398439;border-color:#255625}.btn-success.disabled.focus,.btn-success.disabled:focus,.btn-success.disabled:hover,.btn-success[disabled].focus,.btn-success[disabled]:focus,.btn-success[disabled]:hover,fieldset[disabled] .btn-success.focus,fieldset[disabled] .btn-success:focus,fieldset[disabled] .btn-success:hover{background-color:#5cb85c;border-color:#4cae4c}.btn-success .badge{color:#5cb85c;background-color:#fff}.btn-info{color:#fff;background-color:#56ccf2;border-color:#3ec5f0}.btn-info.focus,.btn-info:focus{color:#fff;background-color:#27beee;border-color:#0d7ea3}.btn-info:hover{color:#fff;background-color:#27beee;border-color:#11aee0}.btn-info.active,.btn-info:active,.open>.btn-info.dropdown-toggle{color:#fff;background-color:#27beee;border-color:#11aee0;background-image:none}.btn-info.active.focus,.btn-info.active:focus,.btn-info.active:hover,.btn-info:active.focus,.btn-info:active:focus,.btn-info:active:hover,.open>.btn-info.dropdown-toggle.focus,.open>.btn-info.dropdown-toggle:focus,.open>.btn-info.dropdown-toggle:hover{color:#fff;background-color:#11aee0;border-color:#0d7ea3}.btn-info.disabled.focus,.btn-info.disabled:focus,.btn-info.disabled:hover,.btn-info[disabled].focus,.btn-info[disabled]:focus,.btn-info[disabled]:hover,fieldset[disabled] .btn-info.focus,fieldset[disabled] .btn-info:focus,fieldset[disabled] .btn-info:hover{background-color:#56ccf2;border-color:#3ec5f0}.btn-info .badge{color:#56ccf2;background-color:#fff}.btn-warning{color:#fff;background-color:#f09819;border-color:#e18b0f}.btn-warning.focus,.btn-warning:focus{color:#fff;background-color:#c97c0d;border-color:#694107}.btn-warning:hover{color:#fff;background-color:#c97c0d;border-color:#a7670b}.btn-warning.active,.btn-warning:active,.open>.btn-warning.dropdown-toggle{color:#fff;background-color:#c97c0d;border-color:#a7670b;background-image:none}.btn-warning.active.focus,.btn-warning.active:focus,.btn-warning.active:hover,.btn-warning:active.focus,.btn-warning:active:focus,.btn-warning:active:hover,.open>.btn-warning.dropdown-toggle.focus,.open>.btn-warning.dropdown-toggle:focus,.open>.btn-warning.dropdown-toggle:hover{color:#fff;background-color:#a7670b;border-color:#694107}.btn-warning.disabled.focus,.btn-warning.disabled:focus,.btn-warning.disabled:hover,.btn-warning[disabled].focus,.btn-warning[disabled]:focus,.btn-warning[disabled]:hover,fieldset[disabled] .btn-warning.focus,fieldset[disabled] .btn-warning:focus,fieldset[disabled] .btn-warning:hover{background-color:#f09819;border-color:#e18b0f}.btn-warning .badge{color:#f09819;background-color:#fff}.btn-danger{color:#fff;background-color:#ff512f;border-color:#ff3c16}.btn-danger.focus,.btn-danger:focus{color:#fff;background-color:#fb2900;border-color:#951800}.btn-danger:hover{color:#fff;background-color:#fb2900;border-color:#d72300}.btn-danger.active,.btn-danger:active,.open>.btn-danger.dropdown-toggle{color:#fff;background-color:#fb2900;border-color:#d72300;background-image:none}.btn-danger.active.focus,.btn-danger.active:focus,.btn-danger.active:hover,.btn-danger:active.focus,.btn-danger:active:focus,.btn-danger:active:hover,.open>.btn-danger.dropdown-toggle.focus,.open>.btn-danger.dropdown-toggle:focus,.open>.btn-danger.dropdown-toggle:hover{color:#fff;background-color:#d72300;border-color:#951800}.btn-danger.disabled.focus,.btn-danger.disabled:focus,.btn-danger.disabled:hover,.btn-danger[disabled].focus,.btn-danger[disabled]:focus,.btn-danger[disabled]:hover,fieldset[disabled] .btn-danger.focus,fieldset[disabled] .btn-danger:focus,fieldset[disabled] .btn-danger:hover{background-color:#ff512f;border-color:#ff3c16}.btn-danger .badge{color:#ff512f;background-color:#fff}.btn-link{color:#2196f3;font-weight:400;border-radius:0}.btn-link,.btn-link.active,.btn-link:active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;-webkit-box-shadow:none;box-shadow:none}.btn-link,.btn-link:active,.btn-link:focus,.btn-link:hover{border-color:transparent}.btn-link:focus,.btn-link:hover{color:#0a6ebd;text-decoration:underline;background-color:transparent}.btn-link[disabled]:focus,.btn-link[disabled]:hover,fieldset[disabled] .btn-link:focus,fieldset[disabled] .btn-link:hover{color:#777;text-decoration:none}.btn-lg{padding:10px 16px;font-size:18px;line-height:1.33333;border-radius:6px}.btn-sm{padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}.btn-xs{padding:1px 5px;font-size:12px;line-height:1.5;border-radius:3px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:5px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.fade{opacity:0;-webkit-transition:opacity .15s linear;transition:opacity .15s linear}.fade.in{opacity:1}.collapse{display:none}.collapse.in{display:block}tr.collapse.in{display:table-row}tbody.collapse.in{display:table-row-group}.collapsing{position:relative;height:0;overflow:hidden;-webkit-transition-property:height,visibility;transition-property:height,visibility;-webkit-transition-duration:.35s;transition-duration:.35s;-webkit-transition-timing-function:ease;transition-timing-function:ease}.caret{display:inline-block;width:0;height:0;margin-left:2px;vertical-align:middle;border-top:4px dashed;border-top:4px solid\\9;border-right:4px solid transparent;border-left:4px solid transparent}.dropdown,.dropup{position:relative}.dropdown-toggle:focus{outline:0}.dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;list-style:none;font-size:14px;text-align:left;background-color:#fff;border:1px solid #ccc;border:1px solid rgba(0,0,0,.15);border-radius:4px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,.175);box-shadow:0 6px 12px rgba(0,0,0,.175);background-clip:padding-box}.dropdown-menu.pull-right{right:0;left:auto}.dropdown-menu .divider{height:1px;margin:9.5px 0;overflow:hidden;background-color:#e5e5e5}.dropdown-menu>li>a{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.57143;color:#333;white-space:nowrap}.dropdown-menu>li>a:focus,.dropdown-menu>li>a:hover{text-decoration:none;color:#262626;background-color:#f5f5f5}.dropdown-menu>.active>a,.dropdown-menu>.active>a:focus,.dropdown-menu>.active>a:hover{color:#fff;text-decoration:none;outline:0;background-color:#2196f3}.dropdown-menu>.disabled>a,.dropdown-menu>.disabled>a:focus,.dropdown-menu>.disabled>a:hover{color:#777}.dropdown-menu>.disabled>a:focus,.dropdown-menu>.disabled>a:hover{text-decoration:none;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled=false);cursor:not-allowed}.open>.dropdown-menu{display:block}.open>a{outline:0}.dropdown-menu-right{left:auto;right:0}.dropdown-menu-left{left:0;right:auto}.dropdown-header{display:block;padding:3px 20px;font-size:12px;line-height:1.57143;color:#777;white-space:nowrap}.dropdown-backdrop{position:fixed;left:0;right:0;bottom:0;top:0;z-index:990}.pull-right>.dropdown-menu{right:0;left:auto}.dropup .caret,.navbar-fixed-bottom .dropdown .caret{border-top:0;border-bottom:4px dashed;border-bottom:4px solid\\9;content:\"\"}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:100%;margin-bottom:2px}.input-group{position:relative;display:table;border-collapse:separate}.input-group[class*=col-]{float:none;padding-left:0;padding-right:0}.input-group .form-control{position:relative;z-index:2;float:left;width:100%;margin-bottom:0}.input-group .form-control:focus{z-index:3}.input-group .form-control,.input-group-addon,.input-group-btn{display:table-cell}.input-group .form-control:not(:first-child):not(:last-child),.input-group-addon:not(:first-child):not(:last-child),.input-group-btn:not(:first-child):not(:last-child){border-radius:0}.input-group-addon,.input-group-btn{width:1%;white-space:nowrap;vertical-align:middle}.input-group-addon{padding:6px 12px;font-size:14px;font-weight:400;line-height:1;color:#555;text-align:center;background-color:#eee;border:1px solid #ccc;border-radius:4px}.input-group-addon.input-sm,.input-group-sm>.input-group-addon,.input-group-sm>.input-group-btn>.input-group-addon.btn{padding:5px 10px;font-size:12px;border-radius:3px}.input-group-addon.input-lg,.input-group-lg>.input-group-addon,.input-group-lg>.input-group-btn>.input-group-addon.btn{padding:10px 16px;font-size:18px;border-radius:6px}.input-group-addon input[type=checkbox],.input-group-addon input[type=radio]{margin-top:0}.input-group .form-control:first-child,.input-group-addon:first-child,.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group>.btn,.input-group-btn:first-child>.dropdown-toggle,.input-group-btn:last-child>.btn-group:not(:last-child)>.btn,.input-group-btn:last-child>.btn:not(:last-child):not(.dropdown-toggle){border-bottom-right-radius:0;border-top-right-radius:0}.input-group-addon:first-child{border-right:0}.input-group .form-control:last-child,.input-group-addon:last-child,.input-group-btn:first-child>.btn-group:not(:first-child)>.btn,.input-group-btn:first-child>.btn:not(:first-child),.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group>.btn,.input-group-btn:last-child>.dropdown-toggle{border-bottom-left-radius:0;border-top-left-radius:0}.input-group-addon:last-child{border-left:0}.input-group-btn{position:relative;font-size:0;white-space:nowrap}.input-group-btn>.btn{position:relative}.input-group-btn>.btn+.btn{margin-left:-1px}.input-group-btn>.btn:active,.input-group-btn>.btn:focus,.input-group-btn>.btn:hover{z-index:2}.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group{margin-right:-1px}.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group{z-index:2;margin-left:-1px}.nav{margin-bottom:0;padding-left:0;list-style:none}.nav:after,.nav:before{content:\" \";display:table}.nav:after{clear:both}.nav>li{position:relative;display:block}.nav>li>a{position:relative;display:block;padding:10px 15px}.nav>li>a:focus,.nav>li>a:hover{text-decoration:none;background-color:#eee}.nav>li.disabled>a{color:#777}.nav>li.disabled>a:focus,.nav>li.disabled>a:hover{color:#777;text-decoration:none;background-color:transparent;cursor:not-allowed}.nav .open>a,.nav .open>a:focus,.nav .open>a:hover{background-color:#eee;border-color:#2196f3}.nav .nav-divider{height:1px;margin:9.5px 0;overflow:hidden;background-color:#e5e5e5}.nav>li>a>img{max-width:none}.nav-tabs{border-bottom:1px solid #f2f2f2}.nav-tabs>li{float:left;margin-bottom:-1px}.nav-tabs>li>a{margin-right:2px;line-height:1.57143;border:1px solid transparent;border-radius:4px 4px 0 0}.nav-tabs>li>a:hover{border-color:#eee #eee #f2f2f2}.nav-tabs>li.active>a,.nav-tabs>li.active>a:focus,.nav-tabs>li.active>a:hover{color:#555;background-color:#fff;border:1px solid #f2f2f2;border-bottom-color:transparent;cursor:default}.nav-pills>li{float:left}.nav-pills>li>a{border-radius:4px}.nav-pills>li+li{margin-left:2px}.nav-pills>li.active>a,.nav-pills>li.active>a:focus,.nav-pills>li.active>a:hover{color:#fff;background-color:#2196f3}.nav-stacked>li{float:none}.nav-stacked>li+li{margin-top:2px;margin-left:0}.nav-justified,.nav-tabs.nav-justified{width:100%}.nav-justified>li,.nav-tabs.nav-justified>li{float:none}.nav-justified>li>a,.nav-tabs.nav-justified>li>a{text-align:center;margin-bottom:5px}.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}.nav-tabs-justified,.nav-tabs.nav-justified{border-bottom:0}.nav-tabs-justified>li>a,.nav-tabs.nav-justified>li>a{margin-right:0;border-radius:4px}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover,.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border:1px solid #f2f2f2}.tab-content>.tab-pane{display:none}.tab-content>.active{display:block}.nav-tabs .dropdown-menu{margin-top:-1px;border-top-right-radius:0;border-top-left-radius:0}.navbar{position:relative;min-height:50px;margin-bottom:21px;border:1px solid transparent}.navbar:after,.navbar:before{content:\" \";display:table}.navbar:after{clear:both}.navbar-header:after,.navbar-header:before{content:\" \";display:table}.navbar-header:after{clear:both}.navbar-collapse{overflow-x:visible;padding-right:15px;padding-left:15px;border-top:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1);-webkit-overflow-scrolling:touch}.navbar-collapse:after,.navbar-collapse:before{content:\" \";display:table}.navbar-collapse:after{clear:both}.navbar-collapse.in{overflow-y:auto}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:340px}.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:-15px;margin-left:-15px}.navbar-static-top{z-index:1000;border-width:0 0 1px}.navbar-fixed-bottom,.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}.navbar-brand{float:left;padding:14.5px 15px;font-size:18px;line-height:21px;height:50px}.navbar-brand:focus,.navbar-brand:hover{text-decoration:none}.navbar-brand>img{display:block}.navbar-toggle{position:relative;float:right;margin-right:15px;padding:10px;margin-top:8px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle:focus{outline:0}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:3px}.navbar-nav{margin:7.25px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:21px}.navbar-form{padding:10px 15px;border-top:1px solid transparent;border-bottom:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 1px 0 rgba(255,255,255,.1);margin:7.5px -15px}.navbar-nav>li>.dropdown-menu{margin-top:0;border-top-right-radius:0;border-top-left-radius:0}.navbar-fixed-bottom .navbar-nav>li>.dropdown-menu{margin-bottom:0;border-radius:4px 4px 0 0}.navbar-btn{margin-top:7.5px;margin-bottom:7.5px}.navbar-btn.btn-sm{margin-top:10px;margin-bottom:10px}.navbar-btn.btn-xs{margin-top:14px;margin-bottom:14px}.navbar-text{margin-top:14.5px;margin-bottom:14.5px}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-brand:focus,.navbar-default .navbar-brand:hover{color:#5e5e5e;background-color:transparent}.navbar-default .navbar-nav>li>a,.navbar-default .navbar-text{color:#777}.navbar-default .navbar-nav>li>a:focus,.navbar-default .navbar-nav>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav>.active>a,.navbar-default .navbar-nav>.active>a:focus,.navbar-default .navbar-nav>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav>.disabled>a,.navbar-default .navbar-nav>.disabled>a:focus,.navbar-default .navbar-nav>.disabled>a:hover{color:#ccc;background-color:transparent}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#e7e7e7}.navbar-default .navbar-nav>.open>a,.navbar-default .navbar-nav>.open>a:focus,.navbar-default .navbar-nav>.open>a:hover{background-color:#e7e7e7;color:#555}.navbar-default .navbar-link{color:#777}.navbar-default .navbar-link:hover{color:#333}.navbar-default .btn-link{color:#777}.navbar-default .btn-link:focus,.navbar-default .btn-link:hover{color:#333}.navbar-default .btn-link[disabled]:focus,.navbar-default .btn-link[disabled]:hover,fieldset[disabled] .navbar-default .btn-link:focus,fieldset[disabled] .navbar-default .btn-link:hover{color:#ccc}.navbar-inverse{background-color:#222;border-color:#090909}.navbar-inverse .navbar-brand{color:#9d9d9d}.navbar-inverse .navbar-brand:focus,.navbar-inverse .navbar-brand:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>li>a,.navbar-inverse .navbar-text{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a:focus,.navbar-inverse .navbar-nav>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>.active>a,.navbar-inverse .navbar-nav>.active>a:focus,.navbar-inverse .navbar-nav>.active>a:hover{color:#fff;background-color:#090909}.navbar-inverse .navbar-nav>.disabled>a,.navbar-inverse .navbar-nav>.disabled>a:focus,.navbar-inverse .navbar-nav>.disabled>a:hover{color:#444;background-color:transparent}.navbar-inverse .navbar-toggle{border-color:#333}.navbar-inverse .navbar-toggle:focus,.navbar-inverse .navbar-toggle:hover{background-color:#333}.navbar-inverse .navbar-toggle .icon-bar{background-color:#fff}.navbar-inverse .navbar-collapse,.navbar-inverse .navbar-form{border-color:#101010}.navbar-inverse .navbar-nav>.open>a,.navbar-inverse .navbar-nav>.open>a:focus,.navbar-inverse .navbar-nav>.open>a:hover{background-color:#090909;color:#fff}.navbar-inverse .navbar-link{color:#9d9d9d}.navbar-inverse .navbar-link:hover{color:#fff}.navbar-inverse .btn-link{color:#9d9d9d}.navbar-inverse .btn-link:focus,.navbar-inverse .btn-link:hover{color:#fff}.navbar-inverse .btn-link[disabled]:focus,.navbar-inverse .btn-link[disabled]:hover,fieldset[disabled] .navbar-inverse .btn-link:focus,fieldset[disabled] .navbar-inverse .btn-link:hover{color:#444}.pager{padding-left:0;margin:21px 0;list-style:none;text-align:center}.pager:after,.pager:before{content:\" \";display:table}.pager:after{clear:both}.pager li{display:inline}.pager li>a,.pager li>span{display:inline-block;padding:5px 14px;background-color:#fff;border:1px solid #ddd;border-radius:15px}.pager li>a:focus,.pager li>a:hover{text-decoration:none;background-color:#eee}.pager .next>a,.pager .next>span{float:right}.pager .previous>a,.pager .previous>span{float:left}.pager .disabled>a,.pager .disabled>a:focus,.pager .disabled>a:hover,.pager .disabled>span{color:#777;background-color:#fff;cursor:not-allowed}.badge{display:inline-block;min-width:10px;padding:3px 7px;font-size:12px;font-weight:700;color:#fff;line-height:1;vertical-align:middle;white-space:nowrap;text-align:center;background-color:#777;border-radius:10px}.badge:empty{display:none}.btn .badge{position:relative;top:-1px}.btn-group-xs>.btn .badge,.btn-xs .badge{top:0;padding:1px 5px}.list-group-item.active>.badge,.nav-pills>.active>a>.badge{color:#2196f3;background-color:#fff}.list-group-item>.badge{float:right}.list-group-item>.badge+.badge{margin-right:5px}.nav-pills>li>a>.badge{margin-left:3px}a.badge:focus,a.badge:hover{color:#fff;text-decoration:none;cursor:pointer}.thumbnail{display:block;padding:4px;margin-bottom:21px;line-height:1.57143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:border .2s ease-in-out;transition:border .2s ease-in-out}.thumbnail a>img,.thumbnail>img{display:block;max-width:100%;height:auto;margin-left:auto;margin-right:auto}.thumbnail .caption{padding:9px;color:#333}a.thumbnail.active,a.thumbnail:focus,a.thumbnail:hover{border-color:#2196f3}.media{margin-top:15px}.media:first-child{margin-top:0}.media,.media-body{zoom:1;overflow:hidden}.media-body{width:10000px}.media-object{display:block}.media-object.img-thumbnail{max-width:none}.media-right,.media>.pull-right{padding-left:10px}.media-left,.media>.pull-left{padding-right:10px}.media-body,.media-left,.media-right{display:table-cell;vertical-align:top}.media-middle,.media-middle .media-body,.media-middle .media-left,.media-middle .media-right{vertical-align:middle}.media-bottom,.media-bottom .media-body,.media-bottom .media-left,.media-bottom .media-right{vertical-align:bottom}.media-heading{margin-top:0;margin-bottom:5px}.media-list{padding-left:0;list-style:none}.embed-responsive{position:relative;display:block;height:0;padding:0;overflow:hidden}.embed-responsive .embed-responsive-item,.embed-responsive embed,.embed-responsive iframe,.embed-responsive object,.embed-responsive video{position:absolute;top:0;left:0;bottom:0;height:100%;width:100%;border:0}.embed-responsive-16by9{padding-bottom:56.25%}.embed-responsive-4by3{padding-bottom:75%}.well{min-height:20px;padding:19px;margin-bottom:20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.05);box-shadow:inset 0 1px 1px rgba(0,0,0,.05)}.well blockquote{border-color:#ddd;border-color:rgba(0,0,0,.15)}.well-lg{padding:24px;border-radius:6px}.well-sm{padding:9px;border-radius:3px}.close{float:right;font-size:24px;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.2;filter:alpha(opacity=20)}.close:focus,.close:hover{color:#000;text-decoration:none;cursor:pointer;opacity:.5;filter:alpha(opacity=50)}button.close{padding:0;cursor:pointer;background:0 0;border:0;-webkit-appearance:none}.modal-open{overflow:hidden}.modal{display:none;overflow:hidden;position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;-webkit-overflow-scrolling:touch;outline:0}.modal.fade .modal-dialog{-webkit-transform:translate(0,-25%);-ms-transform:translate(0,-25%);transform:translate(0,-25%);-webkit-transition:-webkit-transform .3s ease-out;transition:-webkit-transform .3s ease-out;transition:transform .3s ease-out;transition:transform .3s ease-out,-webkit-transform .3s ease-out}.modal.in .modal-dialog{-webkit-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0)}.modal-open .modal{overflow-x:hidden;overflow-y:auto}.modal-dialog{position:relative;width:auto;margin:10px}.modal-content{position:relative;background-color:#fff;border-radius:6px;-webkit-box-shadow:0 3px 9px rgba(0,0,0,.05);box-shadow:0 3px 9px rgba(0,0,0,.05);background-clip:padding-box;outline:0}.modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000}.modal-backdrop.fade{opacity:0;filter:alpha(opacity=0)}.modal-backdrop.in{opacity:.5;filter:alpha(opacity=50)}.modal-header{padding:15px;border-bottom:1px solid #e5e5e5}.modal-header:after,.modal-header:before{content:\" \";display:table}.modal-header:after{clear:both}.modal-header .close{margin-top:-2px}.modal-title{margin:0;line-height:1.57143}.modal-body{position:relative;padding:15px}.modal-footer{padding:15px;text-align:right;border-top:1px solid #e5e5e5}.modal-footer:after,.modal-footer:before{content:\" \";display:table}.modal-footer:after{clear:both}.modal-footer .btn+.btn{margin-left:5px;margin-bottom:0}.modal-footer .btn-group .btn+.btn{margin-left:-1px}.modal-footer .btn-block+.btn-block{margin-left:0}.modal-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.tooltip{position:absolute;z-index:1070;display:block;font-family:PingHei,\"PingFang SC\",Helvetica Neue,\"Work Sans\",\"Hiragino Sans GB\",\"Microsoft YaHei\",SimSun,sans-serif;font-style:normal;font-weight:400;letter-spacing:normal;line-break:auto;line-height:1.57143;text-align:left;text-align:start;text-decoration:none;text-shadow:none;text-transform:none;white-space:normal;word-break:normal;word-spacing:normal;word-wrap:normal;font-size:12px;opacity:0;filter:alpha(opacity=0)}.tooltip.in{opacity:.9;filter:alpha(opacity=90)}.tooltip.top{margin-top:-3px;padding:5px 0}.tooltip.right{margin-left:3px;padding:0 5px}.tooltip.bottom{margin-top:3px;padding:5px 0}.tooltip.left{margin-left:-3px;padding:0 5px}.tooltip-inner{max-width:200px;padding:3px 8px;color:#fff;text-align:center;background-color:#000;border-radius:4px}.tooltip-arrow{position:absolute;width:0;height:0;border-color:transparent;border-style:solid}.tooltip.top .tooltip-arrow{bottom:0;left:50%;margin-left:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.top-left .tooltip-arrow{bottom:0;right:5px;margin-bottom:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.top-right .tooltip-arrow{bottom:0;left:5px;margin-bottom:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.right .tooltip-arrow{top:50%;left:0;margin-top:-5px;border-width:5px 5px 5px 0;border-right-color:#000}.tooltip.left .tooltip-arrow{top:50%;right:0;margin-top:-5px;border-width:5px 0 5px 5px;border-left-color:#000}.tooltip.bottom .tooltip-arrow{top:0;left:50%;margin-left:-5px;border-width:0 5px 5px;border-bottom-color:#000}.tooltip.bottom-left .tooltip-arrow{top:0;right:5px;margin-top:-5px;border-width:0 5px 5px;border-bottom-color:#000}.tooltip.bottom-right .tooltip-arrow{top:0;left:5px;margin-top:-5px;border-width:0 5px 5px;border-bottom-color:#000}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important}.affix{position:fixed}@-ms-viewport{width:device-width}.visible-lg,.visible-lg-block,.visible-lg-inline,.visible-lg-inline-block,.visible-md,.visible-md-block,.visible-md-inline,.visible-md-inline-block,.visible-print,.visible-print-block,.visible-print-inline,.visible-print-inline-block,.visible-sm,.visible-sm-block,.visible-sm-inline,.visible-sm-inline-block,.visible-xs,.visible-xs-block,.visible-xs-inline,.visible-xs-inline-block{display:none!important}/*! * IE10 viewport hack for Surface/desktop Windows 8 bug * Copyright 2014-2015 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE) */@-o-viewport{width:device-width}@viewport{width:device-width}::-webkit-scrollbar{width:6px;height:4px;background:0 0}::-webkit-scrollbar-thumb{background:rgba(0,0,0,.15)}::-webkit-scrollbar-thumb:window-inactive{background:rgba(0,0,0,.1)}::-webkit-scrollbar-thumb:vertical{height:4px;background:rgba(0,0,0,.15)}::-webkit-scrollbar-thumb:horizontal{width:4px;background:rgba(0,0,0,.15)}::-webkit-scrollbar-thumb:vertical:hover{background-color:rgba(0,0,0,.3)}::-webkit-scrollbar-thumb:vertical:active{background-color:rgba(0,0,0,.5)}::-webkit-scrollbar-track{background:rgba(0,0,0,.1);-webkit-box-shadow:inset 0 0 3px rgba(0,0,0,.1);box-shadow:inset 0 0 3px rgba(0,0,0,.1)}::-webkit-scrollbar-track-piece{background:rgba(0,0,0,.15)}body,html{position:relative;overflow-x:hidden}body{padding-right:0!important;font-family:PingHei,\"PingFang SC\",Helvetica Neue,\"Work Sans\",\"Hiragino Sans GB\",\"Microsoft YaHei\",SimSun,sans-serif;font-size:14px;line-height:1.57143;color:#333;background-color:#fff}a{color:#333;text-decoration:none}a:focus,a:hover{color:#0a6ebd;text-decoration:none}.active>a,a.active{color:#0a6ebd}.btn,button,input,select,textarea{outline:0!important}.btn:active,.btn:focus,.btn:hover,button:active,button:focus,button:hover,input:active,input:focus,input:hover,select:active,select:focus,select:hover,textarea:active,textarea:focus,textarea:hover{outline:0!important}canvas,iframe,img,svg,video{max-width:100%;height:auto}.clear{height:0;font-size:0;line-height:0;overflow:hidden;clear:both}.clearfix:after,.clearfix:before{content:\" \";display:table;line-height:0;content:\"\"}.clearfix:after{clear:both}.clearfix{*zoom:1}.clickable{cursor:pointer}.scrollable{overflow-x:hidden;overflow-y:auto}.transform-no{-ms-transform:none!important;-webkit-transform:none!important;transform:none!important}.text-dark{color:#333!important}.text-grey{color:#999!important}.text-white{color:#fff!important}.text-white a:hover,.text-white a:hover i,.text-white:hover{color:rgba(255,255,255,.8)}.text-white a.list-group-item.active i{color:#fff}.text-white .accordion-list p{font-size:12px;height:84px;line-height:21px;color:rgba(255,255,255,.8)}.bg-no{background:0 0!important}.bg-alpha{background-color:transparent!important}.bg-inverse,.bg-inverse a{color:#fff}.btn.bg-inverse.focus,.btn.bg-inverse:focus,.btn.bg-inverse:hover{color:rgba(255,255,255,.8)}.bg{background-color:#f6f6f6!important}.z-no{z-index:inherit}.z1{z-index:1}.z2{z-index:2}.z3{z-index:3}.z4{z-index:4}.zmin{z-index:-1}.zmax{z-index:999}.m{margin:5px!important}.m-no{margin:0!important}.m-0x{margin:10px!important}.m-1x{margin:15px!important}.m-2x{margin:20px!important}.m-3x{margin:30px!important}.m-4x{margin:60px!important}.m-5x{margin:100px!important}.mv{margin-top:5px!important;margin-bottom:5px!important}.mv-no{margin-top:0!important;margin-bottom:0!important}.mv-0x{margin-top:10px!important;margin-bottom:10px!important}.mv-1x{margin-top:15px!important;margin-bottom:15px!important}.mv-2x{margin-top:20px!important;margin-bottom:20px!important}.mv-3x{margin-top:30px!important;margin-bottom:30px!important}.mv-4x{margin-top:60px!important;margin-bottom:60px!important}.mv-5x{margin-top:100px!important;margin-bottom:100px!important}.mh{margin-left:5px!important;margin-right:5px!important}.mh-no{margin-left:0!important;margin-right:0!important}.mh-0x{margin-left:10px!important;margin-right:10px!important}.mh-1x{margin-left:15px!important;margin-right:15px!important}.mh-2x{margin-left:20px!important;margin-right:20px!important}.mh-3x{margin-left:30px!important;margin-right:30px!important}.mh-4x{margin-left:60px!important;margin-right:60px!important}.mh-5x{margin-left:100px!important;margin-right:100px!important}.mt{margin-top:5px!important}.mt-no{margin-top:0!important}.mt-0x{margin-top:10px!important}.mt-1x{margin-top:15px!important}.mt-2x{margin-top:20px!important}.mt-3x{margin-top:30px!important}.mt-4x{margin-top:60px!important}.mt-5x{margin-top:100px!important}.mb{margin-bottom:5px!important}.mb-no{margin-bottom:0!important}.mb-0x{margin-bottom:10px!important}.mb-1x{margin-bottom:15px!important}.mb-2x{margin-bottom:20px!important}.mb-3x{margin-bottom:30px!important}.mb-4x{margin-bottom:60px!important}.mb-5x{margin-bottom:100px!important}.ml{margin-left:5px!important}.ml-no{margin-left:0!important}.ml-0x{margin-left:10px!important}.ml-1x{margin-left:15px!important}.ml-2x{margin-left:20px!important}.ml-3x{margin-left:30px!important}.ml-4x{margin-left:60px!important}.ml-5x{margin-left:100px!important}.mr{margin-right:5px!important}.mr-no{margin-right:0!important}.mr-0x{margin-right:10px!important}.mr-1x{margin-right:15px!important}.mr-2x{margin-right:20px!important}.mr-3x{margin-right:30px!important}.mr-4x{margin-right:60px!important}.mr-5x{margin-right:100px!important}.p{padding:5px!important}.p-no{padding:0!important}.p-0x{padding:10px!important}.p-1x{padding:15px!important}.p-2x{padding:20px!important}.p-3x{padding:30px!important}.p-4x{padding:60px!important}.p-5x{padding:100px!important}.pv{padding-top:5px!important;padding-bottom:5px!important}.pv-no{padding-top:0!important;padding-bottom:0!important}.pv-0x{padding-top:10px!important;padding-bottom:10px!important}.pv-1x{padding-top:15px!important;padding-bottom:15px!important}.pv-2x{padding-top:20px!important;padding-bottom:20px!important}.pv-3x{padding-top:30px!important;padding-bottom:30px!important}.pv-4x{padding-top:60px!important;padding-bottom:60px!important}.pv-5x{padding-top:100px!important;padding-bottom:100px!important}.ph{padding-left:5px!important;padding-right:5px!important}.ph-no{padding-left:0!important;padding-right:0!important}.ph-0x{padding-left:10px!important;padding-right:10px!important}.ph-1x{padding-left:15px!important;padding-right:15px!important}.ph-2x{padding-left:20px!important;padding-right:20px!important}.ph-3x{padding-left:30px!important;padding-right:30px!important}.ph-4x{padding-left:60px!important;padding-right:60px!important}.ph-5x{padding-left:100px!important;padding-right:100px!important}.pt{padding-top:5px!important}.pt-no{padding-top:0!important}.pt-0x{padding-top:10px!important}.pt-1x{padding-top:15px!important}.pt-2x{padding-top:20px!important}.pt-3x{padding-top:30px!important}.pt-4x{padding-top:60px!important}.pt-5x{padding-top:100px!important}.pb{padding-bottom:5px!important}.pb-no{padding-bottom:0!important}.pb-0x{padding-bottom:10px!important}.pb-1x{padding-bottom:15px!important}.pb-2x{padding-bottom:20px!important}.pb-3x{padding-bottom:30px!important}.pb-4x{padding-bottom:60px!important}.pb-5x{padding-bottom:100px!important}.pl{padding-left:5px!important}.pl-no{padding-left:0!important}.pl-0x{padding-left:10px!important}.pl-1x{padding-left:15px!important}.pl-2x{padding-left:20px!important}.pl-3x{padding-left:30px!important}.pl-4x{padding-left:60px!important}.pl-5x{padding-left:100px!important}.pr{padding-right:5px!important}.pr-no{padding-right:0!important}.pr-0x{padding-right:10px!important}.pr-1x{padding-right:15px!important}.pr-2x{padding-right:20px!important}.pr-3x{padding-right:30px!important}.pr-4x{padding-right:60px!important}.pr-5x{padding-right:100px!important}.b{border:1px solid #ddd}.b-no{border:none!important}.r-rounded{border-radius:2em!important;padding-left:1em;padding-right:1em;overflow:hidden}.r-circle{border-radius:50%!important;overflow:hidden}.r-no{border-radius:0!important}.w-auto{width:auto!important}.w-full,.w-full img{width:100%!important;max-width:100%!important}.lh-2x{line-height:2}.text-break{word-break:break-all!important;word-wrap:break-word!important}.text-undecorate{text-decoration:none!important}.text-underline{text-decoration:underline!important}.text-through{text-decoration:line-through!important}.text-sub{vertical-align:sub!important}.text-super{vertical-align:super!important}.text-indent,.text-indent div,.text-indent p{text-indent:2em}.text-nowrap{max-width:100%;overflow:hidden!important;text-overflow:ellipsis!important;white-space:nowrap!important;word-wrap:normal!important;-moz-binding:url(ellipsis.xml)}.text-nowrap-1x{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:1;-webkit-box-flex:1;line-height:24px;height:24px;word-break:break-all!important;word-wrap:break-word!important}.text-nowrap-2x{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-height:24px;height:48px;word-break:break-all!important;word-wrap:break-word!important}.text-nowrap-3x{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:3;line-height:24px;height:72px;word-break:break-all!important;word-wrap:break-word!important}.text-nowrap-4x{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:4;line-height:24px;height:96px;word-break:break-all!important;word-wrap:break-word!important}.text-nowrap-5x{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:5;line-height:24px;height:120px;word-break:break-all!important;word-wrap:break-word!important}.thumb{width:16px;display:inline-block;overflow:hidden}.thumb-xs{width:32px;display:inline-block;overflow:hidden}.thumb-sm{width:48px;display:inline-block;overflow:hidden}.thumb-md{width:64px;display:inline-block;overflow:hidden}.thumb-lg{width:96px;display:inline-block;overflow:hidden}.thumb-xl{width:128px;display:inline-block;overflow:hidden}.thumb-wrapper{padding:2px;border:1px solid #dbe2e7}.thumb img,.thumb-0x img,.thumb-1x img,.thumb-2x img,.thumb-3x img,.thumb-4x img,.thumb-5x img,.thumb-6x img,.thumb-btn img{height:auto;max-width:100%;vertical-align:middle}.img-gray img,img.img-gray{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%);-webkit-filter:gray;filter:gray}.img-gray:hover img,img.img-gray:hover{-webkit-filter:grayscale(0);-moz-filter:grayscale(0);-ms-filter:grayscale(0);-o-filter:grayscale(0);filter:grayscale(0)}.img-rotate img,img.img-rotate{-webkit-transition:-webkit-transform .3s ease;transition:-webkit-transform .3s ease;transition:transform .3s ease;transition:transform .3s ease,-webkit-transform .3s ease}.img-rotate:hover img,img.img-rotate:hover{transform:rotate(360deg);-ms-transform:rotate(360deg);-moz-transform:rotate(360deg);-webkit-transform:rotate(360deg);-o-transform:rotate(360deg)}.img-burn img,img.img-burn{position:relative;-webkit-transition:all .8s ease-in-out;transition:all .8s ease-in-out}.img-burn:hover img,img.img-burn:hover{-webkit-transform:scale(1.2) rotate(2deg);-ms-transform:scale(1.2) rotate(2deg);transform:scale(1.2) rotate(2deg)}.hover-up img,img.hover-up{position:relative;top:0;-webkit-transition:top .3s ease-out;transition:top .3s ease-out}.hover-up:hover img,img.hover-up:hover{top:-6px}.active>.auto .text,.active>.text,.collapsed>.auto .text,.collapsed>.text,.text-active{display:none!important}.active>.auto .text-active,.active>.text-active,.collapsed>.auto .text-active,.collapsed>.text-active{display:inline-block!important}.shadow-no{-webkit-box-shadow:none;box-shadow:none}.hover-shadow:hover,.shadow{-webkit-box-shadow:0 1px 2px rgba(0,0,0,.05);box-shadow:0 1px 2px rgba(0,0,0,.05)}.radio{margin-left:20px}.radio label{display:inline-block;position:relative;padding-left:5px}.radio label:before{content:\"\";display:inline-block;position:absolute;width:17px;height:17px;left:0;margin-left:-20px;border:1px solid #ccc;border-radius:50%;background-color:#fff;-webkit-transition:border .15s ease-in-out;transition:border .15s ease-in-out}.radio label:after{display:inline-block;position:absolute;content:\" \";width:11px;height:11px;left:3px;top:3px;margin-left:-20px;border-radius:50%;background-color:#555;-webkit-transform:scale(0,0);-ms-transform:scale(0,0);transform:scale(0,0);-webkit-transition:-webkit-transform .1s cubic-bezier(.8,-.33,.2,1.33);transition:-webkit-transform .1s cubic-bezier(.8,-.33,.2,1.33);transition:transform .1s cubic-bezier(.8,-.33,.2,1.33);transition:transform .1s cubic-bezier(.8,-.33,.2,1.33),-webkit-transform .1s cubic-bezier(.8,-.33,.2,1.33)}.radio input[type=radio]{display:none}.radio input[type=radio]:checked+label:after{-webkit-transform:scale(1,1);-ms-transform:scale(1,1);transform:scale(1,1)}.radio input[type=radio]:disabled+label{opacity:.65}.radio input[type=radio]:disabled+label:before{cursor:not-allowed}.hover-grow{-webkit-transition:all .2s linear;transition:all .2s linear}.hover-grow:hover{-webkit-transform:translate3d(0,-2px,0);transform:translate3d(0,-2px,0)}fieldset{padding:0;margin:0;border:0;min-width:0}legend{display:block;width:100%;padding:0;margin-bottom:21px;font-size:21px;line-height:inherit;color:#333;border:0;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type=search]{-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-appearance:none}input[type=checkbox],input[type=radio]{margin:4px 0 0;margin-top:1px\\9;line-height:normal}input[type=file]{display:block}input[type=range]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type=checkbox]:focus,input[type=file]:focus,input[type=radio]:focus{outline:-webkit-focus-ring-color auto 5px;outline-offset:-2px}output{display:block;padding-top:7px;font-size:14px;line-height:1.57143;color:#555}.form-control{display:block;width:100%;height:35px;padding:6px 12px;font-size:14px;line-height:1.57143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;-webkit-transition:border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s,-webkit-box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#999;opacity:1}.form-control:-ms-input-placeholder{color:#999}.form-control::-webkit-input-placeholder{color:#999}.form-control::-ms-expand{border:0;background-color:transparent}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{background-color:#eee;opacity:1}.form-control[disabled],fieldset[disabled] .form-control{cursor:not-allowed}textarea.form-control{height:auto}.list-disc{list-style:disc!important}.list-alpha{list-style:upper-alpha!important}.list-decimal{list-style:decimal!important}.list-outside{list-style-position:outside!important}.list-inside{list-style-position:inside!important}.list-square{list-style:none}.list-square li:before{color:#ccc;content:\"â–ª\";font-size:12px;margin-right:6px;-webkit-transition:.2s ease;transition:.2s ease}.list-circle-num,.list-square-num{counter-reset:list1}.list-circle-num>li,.list-square-num>li{list-style:none;margin-bottom:13px}.list-circle-num>li:before{counter-increment:list1;content:counter(list1) \"\";width:24px;height:24px;text-align:center;border-radius:12px;font-size:15px;border-width:1px;border-style:solid;margin:0 16px 0 0;display:inline-block;vertical-align:middle}.list-square-num>li:before{counter-increment:list1;content:counter(list1) \"\";width:24px;height:24px;text-align:center;border-radius:5px;font-size:15px;border-width:1px;border-style:solid;margin:0 16px 0 0;display:inline-block;vertical-align:middle}.list-circle-num>li>ol,.list-square-num>li>ol{counter-reset:list2}.list-circle-num>li>ol>li,.list-square-num>li>ol>li{margin-bottom:13px}.list-circle-num>li>ol>li:before{counter-increment:list2;content:counter(list1) \".\" counter(list2) \"\";width:24px;height:24px;text-align:center;border-radius:12px;font-size:15px;border-width:1px;border-style:solid;margin:0 16px 0 0;display:inline-block;vertical-align:middle}.list-square-num>li>ol>li:before{counter-increment:list2;content:counter(list1) \".\" counter(list2) \"\";width:24px;height:24px;text-align:center;border-radius:5px;font-size:15px;border-width:1px;border-style:solid;margin:0 16px 0 0;display:inline-block;vertical-align:middle}.list-circle-num[class*=list-full]>li::before,.list-square-num[class*=list-full]>li::before{background:#de4a32;color:#fff}.label{display:inline-block;padding:.3em .6em;font-size:75%;font-weight:700;line-height:1;color:#777;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}.label:empty{display:none}.btn .label{position:relative;top:-1px}a.label:focus,a.label:hover{color:#333;text-decoration:none;cursor:pointer}.label-default{background-color:#eee}.label-default[href]:focus,.label-default[href]:hover{background-color:#d5d5d5}.label-primary{background-color:#2196f3;color:#fff}.label-primary[href]:focus,.label-primary[href]:hover{background-color:#0c7cd5}.label-success{background-color:#5cb85c;color:#fff}.label-success[href]:focus,.label-success[href]:hover{background-color:#449d44}.label-info{background-color:#56ccf2;color:#fff}.label-info[href]:focus,.label-info[href]:hover{background-color:#27beee}.label-warning{background-color:#f09819;color:#fff}.label-warning[href]:focus,.label-warning[href]:hover{background-color:#c97c0d}.label-danger{background-color:#ff512f;color:#fff}.label-danger[href]:focus,.label-danger[href]:hover{background-color:#fb2900}.panel{margin-bottom:21px;background-color:#fff;border:1px solid #f2f2f2}.panel .article-title{display:-webkit-box;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:2;font-size:18px;line-height:32px;height:64px;word-break:break-all!important;word-wrap:break-word!important}.panel-body{padding:15px}.panel-body:after,.panel-body:before{content:\" \";display:table}.panel-body:after{clear:both}.panel-heading{padding:10px 15px;border-bottom:1px solid #f2f2f2}.panel-heading>.dropdown .dropdown-toggle{color:inherit}.panel-title{margin-top:0;margin-bottom:0;font-size:16px;color:inherit}.panel-title>.small,.panel-title>.small>a,.panel-title>a,.panel-title>small,.panel-title>small>a{color:inherit;text-decoration:none}.panel-footer{padding:10px 15px;border-top:1px solid #f2f2f2;border-bottom-right-radius:3px;border-bottom-left-radius:3px}.panel.b-no{border:0;margin-bottom:0}.panel.b-no .panel-body,.panel.b-no .panel-footer,.panel.b-no .panel-heading{border:0;padding-left:0;padding-right:0}.panel-badger{position:relative}.panel-badger:after{content:\"\";position:absolute;top:0;width:0;height:0;border-width:4px;border-style:solid;border-color:#777 transparent transparent #777}.panel-badger:hover:after{border-color:#2196f3 transparent transparent #2196f3}.badger-danger:after{border-color:#ff512f transparent transparent #ff512f}.badger-warning:after{border-color:#f09819 transparent transparent #f09819}.badger-success:after{border-color:#5cb85c transparent transparent #5cb85c}.badger-info:after{border-color:#56ccf2 transparent transparent #56ccf2}.badger-primary:after{border-color:#2196f3 transparent transparent #2196f3}.bg-gradient-info span,.bg-gradient-info:before{background:#56ccf2;background:-webkit-linear-gradient(left,#56ccf2 0,#2f80ed 80%,#2f80ed 100%);background:-webkit-gradient(linear,left top,right top,from(#56ccf2),color-stop(80%,#2f80ed),to(#2f80ed));background:linear-gradient(to right,#56ccf2 0,#2f80ed 80%,#2f80ed 100%)}.bg-gradient-primary span,.bg-gradient-primary:before{background:#396afc;background:-webkit-linear-gradient(left,#396afc 0,#2948ff 80%,#2948ff 100%);background:-webkit-gradient(linear,left top,right top,from(#396afc),color-stop(80%,#2948ff),to(#2948ff));background:linear-gradient(to right,#396afc 0,#2948ff 80%,#2948ff 100%)}.bg-gradient-success span,.bg-gradient-success:before{background:#44ea76;background:-webkit-linear-gradient(left,#44ea76 0,#39fad7 80%,#39fad7 100%);background:-webkit-gradient(linear,left top,right top,from(#44ea76),color-stop(80%,#39fad7),to(#39fad7));background:linear-gradient(to right,#44ea76 0,#39fad7 80%,#39fad7 100%)}.bg-gradient-warning span,.bg-gradient-warning:before{background:#ff512f;background:-webkit-linear-gradient(left,#ff512f 0,#f09819 80%,#f09819 100%);background:-webkit-gradient(linear,left top,right top,from(#ff512f),color-stop(80%,#f09819),to(#f09819));background:linear-gradient(to right,#ff512f 0,#f09819 80%,#f09819 100%)}.bg-gradient-danger span,.bg-gradient-danger:before{background:#ff512f;background:-webkit-linear-gradient(left,#ff512f 0,#dd2476 80%,#dd2476 100%);background:-webkit-gradient(linear,left top,right top,from(#ff512f),color-stop(80%,#dd2476),to(#dd2476));background:linear-gradient(to right,#ff512f 0,#dd2476 80%,#dd2476 100%)}.btn-fancy{display:inline-block;font-size:17px;letter-spacing:.03em;text-transform:uppercase;color:#fff;position:relative}.btn-fancy:before{content:'';display:inline-block;height:40px;position:absolute;bottom:-5px;left:30px;right:30px;z-index:-1;-webkit-filter:blur(20px) brightness(.95);filter:blur(20px) brightness(.95);-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transition:all .3s ease-out;transition:all .3s ease-out}.btn-fancy i{margin-top:-1px;margin-right:20px;font-size:1.265em;vertical-align:middle}.btn-fancy span{display:inline-block;padding:18px 60px;border-radius:50em;position:relative;z-index:2;will-change:transform,filter;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transition:all .3s ease-out;transition:all .3s ease-out}.btn-fancy:active,.btn-fancy:focus{color:#fff}.btn-fancy:hover{color:#fff}.btn-fancy:hover span{-webkit-filter:brightness(1.05) contrast(1.05);filter:brightness(1.05) contrast(1.05);-webkit-transform:scale(.95);-ms-transform:scale(.95);transform:scale(.95)}.btn-fancy:hover:before{bottom:0;-webkit-filter:blur(10px) brightness(.95);filter:blur(10px) brightness(.95)}.btn-fancy.pop-onhover:before{opacity:0;bottom:10px}.btn-fancy.pop-onhover:hover:before{bottom:-7px;opacity:1;-webkit-filter:blur(20px);filter:blur(20px)}.btn-fancy.pop-onhover:hover span{-webkit-transform:scale(1.04);-ms-transform:scale(1.04);transform:scale(1.04)}.btn-fancy.pop-onhover:hover:active span{-webkit-filter:brightness(1) contrast(1);filter:brightness(1) contrast(1);-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);-webkit-transition:all .15s ease-out;transition:all .15s ease-out}.btn-fancy.pop-onhover:hover:active:before{bottom:0;-webkit-filter:blur(10px) brightness(.95);filter:blur(10px) brightness(.95);-webkit-transition:all .2s ease-out;transition:all .2s ease-out}table,table>tbody>tr>td,table>tbody>tr>th,table>tfoot>tr>td,table>tfoot>tr>th,table>thead>tr>td,table>thead>tr>th{border:1px solid #f2f2f2}table>tbody>tr:nth-of-type(odd){background-color:#f8f8f8}table>tbody>tr:hover{background-color:#fbfbfb}table{border-collapse:collapse;border-spacing:0;padding:0;width:100%;max-width:100%;margin:10px 0}table>tbody>tr>td,table>tbody>tr>th,table>tfoot>tr>td,table>tfoot>tr>th,table>thead>tr>td,table>thead>tr>th{padding:6px 13px}table>tbody+tbody{border-top:2px solid #f2f2f2}table table{background-color:#fff}.modal button.close{position:absolute;right:10px;top:10px;z-index:99}.modal-small .modal-dialog{width:480px}@font-face{font-family:icon;src:url(iconfont.eot?t=1525101408939);src:url(iconfont.eot?t=1525101408939#iefix) format(\"embedded-opentype\"),url(\"data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAD7sAAsAAAAAWwQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW806XY21hcAAAAYAAAANEAAAIGLFwHIlnbHlmAAAExAAANNEAAEiYkGD74GhlYWQAADmYAAAALwAAADYSZuy5aGhlYQAAOcgAAAAeAAAAJAkLBTVobXR4AAA56AAAAC0AAAGIiyoAAGxvY2EAADoYAAAAxgAAAMbA6a6WbWF4cAAAOuAAAAAfAAAAIAF5ATNuYW1lAAA7AAAAAUIAAAI9Divfm3Bvc3QAADxEAAACpwAAA/BaS1xneJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2Bk4WCcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGBwYKt7MYW7438AQw9zI0AoUZgTJAQDiFQwleJzN1UlP1WccxfEvg6iIivMInehgi0oHWkoROg/SQmeQtohujG6Mm4ZYVi51KyUS2NSEdNU0hjRNF41peAO+BYzn/kl8C8aeh8PG2qQrk/LkQ+69yX24PM/5nQusAxqs0xr9cIo6P6L+e79at/p6A82rrzfWH/fzcd70e9qZVLsOqUvd6lW/BjWsMY1rQmd0Tud1QVO6omnN6LoWdVNLuqXbuqN7teZaW62jNlCbr0ariep0NVPNVgvVjWqpWl7pWbm0Mn937v59/51J4f07V/fv8/5DGlnb/+zq/hd1WVcf2H/5of3Hvf90de1f9390P3U+o3FmvX5aXQteP/PL2vp1dS3yG78/sP54aP3p9RdL/1hl/0520sEBenidY7zNcfp4i3c4xCv08wK7OcIEW9nHUV7mIG08xWO8xGZO8QYf8zgfsYkn2cOn1Pt+P2QLu3iGDbzL+wyxg/do4Tm284Rver9zMcAH7OV5PqObLuehZOBFmniVZxnmJNs4zHp6eZrP+YIv+YqvGWGUE4zxDZ+wkW/5jtcY9Mm0+l9oeqQ38B/X8z/5aSm/GufWnp2yyTX+iCLKXKoufOuoPnz/qCGcBNQYzgRaF04HagrnBK0PJwZtCGcHbQynCDWH84Q2hZOFWsIZQ5vDaUNbwrlDW8MJRK3hLKJt4VSi7eF8oh1Bed/OcGbRrnB60e5wjtGecKLR3nC20b5wytH+cN7RgXDy0cGgfPa2KGeu9vBcuG/CE4I6w7OCDoenBh0JytkcDU8S6grKZ+wOTxfqDcq99UXpWx0Lzx7qD8pZDgblDIbCk4mGg3JvI+FpRaPhuUUngvK+saCc8Xh4qtFElPTpTHjS0dmg3M+58PSj80E5pwtBOeOLUb4z9EO4JdBUuC/Q5aDc1ZVwh6Cr4TZB00E5s5mgnOX1KN89Wgy3DroZ5XtLS+EmQreCkvflcDuh2+GeQneCcpb3wt1FrTncYtTawn1GrSPcbNQGwh1HbT7cdlSj4d6jGg83INXJcBdSTYRbkep0uB+ppsNNSfVjUPabCbcn1bVwj1LNhhuVaiHcrVQ3wi1LtRTuW6rlcPOy0hPuYFYuhduYlflwL3N3Lmj9G/Y/t0h4nJW8CZwcVdU3XOferqqu7urqru7qqt737pq1e6bXZCaZmSQz2ZNJMplshKxsCQlLAiQYwho2UbYHH4UgO4OAig8gimIARWRRQRFFRMQHF1A/EUVZTBffudUzISrv9/6+6e5b5y516y7nnvM/594ajue4D39NH6EhLsC1cb3cMLeM40DohIxC4pA2q0XSCcE0HzQ0hZpZMy1mM0U6E4yMoOnlerVgCKLgBQUSUEmX62aRmFCrDpB+KOtxgHA0MubPx/z0anCFzMTF1kJyGwST2Zh3oNta0DWolVMB5x7Z7w/7/Z9yCjzvJMThVWCnoUu85BKsO3hvJPhIsp0kQQ6bkcVrPamof/Nl1VPieUMCOP98CERTyl2DakTF7zkRPeAPiz6PMxTxZHMa7PmNOxSQ44XXOfxjff0c/R49gVM4Pxflclw3x+XTatpM19K1rJpWKyqtpYOGAq2+5f+DIAm4wjoLoMd6/rPWWz+ZSRzHmJXKkmrVehqvSysVy9+6fhE+eczZx1g/ss6y/gR7HnnkEFSWVqtLK/Bv16l2XUV/SRcgpXN5bNV0bFehhGMaGACjCGYBB9mfhFqhzmNMF0QFQ0djAPKCbvSaWFTPNep+s+AQBQIe0emlYTLrIYlcdML4TbzLvMVJCXlDSgLZddWOlwZfgvtVojV7QdIdTl71wql3X+1zqdZlnz8QPUdwejUXXDxxtoMkJaoSnzX+kgT9T7696mLqvHNWu05vKUrCfUUSIQ6RD7vUq74AWxTJd9GN1mUc58C+fIk26Bjn5FQuwi3FnlQLLWZRpwh+imho2DGRdSeOnQ1qQqZQq9YbahF5qF7WMUFU640BvjaZAHszPZkjXzjQuvanonBZ+4ql5WhyePNwKhpN4SUZTc9Mm8VIyGWnZsKZTG8mQ34Ssq+1kF1HKFX3fnmJEQnnO3zeeqpneLgHU+CvH9HWj30Bl9cI53uSrUScL8omjV4MP+QkXDVxXC9T7GGmP4YiXLqra3ZXV9p6ZpIgOycJ+CGw6+wu+Pcr13rOh1+gr9JjuRncHG4hPqdShE6oD0KFPWAAGgV78Qk4RNCoGLqYVSBYUQDHUxR0lohfYwBKINYbAbViNJDBs6KZVSsw/kMSIA84iOMeQbFeBMPvWBMNh5Mk4fbM9K2nBA5pvp8LIVWfg5HuntUpNeV5gHjdB7oD/PuLkhfevmR8ezj6N1iYbxsZOckxyDs2ZR3p8bXVQcnB09LMC8fi/mm0tDVV2rYIZEo7BtLLOp8jc3quS8+ZDtc3G6tWkaebF82dS7qn+vobej3tQkrhOjguoGbVhs4EUcGeeYxWC9kMdjioZuu+mlkJZgdopaz/9ZGnoL8HStP7N/SRGx4p9uZ6ZeERgEfAHWrvz23eQ6LNZ0j9vo5p01Y2GlbNegSKM4bNuBq3nvgNRKOxFf5oyn/hkXm1yB2cmzO4TntexQTgADaKQHHhIYFRBWi9UcgeyauaglgEwl3+9oFT37jrHmvVGusLq3cTsnt1KwSfUyoPAwyXWRiIoDC7HW64bM/dVHzk2O0PWQFy1po1ZxE7BCOqAYxUKiMsdDq9AO32mrqc7qEVTuZ8nMYlcE3h0ugEsZbOFGZCPpiuTf2qdRTDOt0zt5y52TpUnkv+1vRM/eaWCS3PfaG9Ov+OO+ZX2588ePCpgwfH29qq8+dzBJ9xH/0RXYQ8jfVDfXKJNkATQciYUISZUK0zsW6ADqVQcVZ39yyd3GZYL4YGDWuxkSqmmqlRAx4wyHJjqFgcKhrWSynMNgx4UB/FzGIqZC0NcfaznkF5183N5bbis1B8FQFnFoQgjmgZmbZSNnRDr9iDiwOvgBHQgzjgGbNgtpggyyRCAwZYewIJvJq8zu5psLVQBFwUosAKl6CggG6QPxR8W5SuepdineeC6R356Oxb1y6Zt2FRLNcxDdw3CVqA52/iIar5Pcu3jY5veWCB7A9GHXCeGIzowmftfOs0X6F/7sJh0+fi3ZpL9mr9QzMrmuKWNJmX4G9zYvcYkYjR3KAHO6dBqG/ASM02YFpnKAi6JLg1yfqjJAej4F6QiQzPckM06JbIzW5ZdlvvYY0B15Mub5BA2OtijxMEp6gDCQioFh0BTWiN2x30V3QjF8SR4yTsp4kLHnCeUCZIKEEb9aqZwQXCmANlpsmYNJhFoaqyAQ6qOLwVlckKJFQ2vJhOX7RW4fgGdWtc8utSHK6FL7p0p3SbS4kGt0OlsMmswHYtCh5NgYp5E0SCqzB2E6aCBw7CV0AlRAVrmRTyO/H2q6zlKNFdobjisk7RYm+YVYCq+UZMg2tdCqZtYzdqWAMONurGigmfdSl2356ij9IZqJkZf5t1YhZyqPUM1HMGE6R5oWAWsYe6kQB6361rAts/YX3v7F3kjFMhuedWX3vC+t3aN9atgpV2mLplLyROO4PsOtv63idODqy91Ztof2ElrFr3xtqVZHzdG1My50rkw11IuVBbcRIVJcBv7+SFcFYOXoFXMtZca27mXyl6unWLdQts2mM9DPMi/0pxLT14M/013Yw6sMwNMOnNM+6tIeOabApwlaLAVnGC0qJAcRpVTTcqDDQ1cAmzqUFxR9NM+rEVjZrwKBoaPO+B21pDS8VAxhMBRAfWphvF7wTCEf833J5PYAfuCYQh4r/Yoi6PxwVNe/g/ojcR0Xsu3kV2YT1eTyzfvKpQg6sFxGphf/NKfxgU18bTBYyQXf6I9TtFU/D7ZOvCxg+V1IfvYx8FxI2IGUUtiBgxmzH1SrnBYIp9mYmrz16ryHJMuePSrjcEsU5fa59e3Hjh17fdeXkwcvmOoRP8mhqJjKxt72kvRRe+cDa/e8V4/+x+Y2g6ubu/Q1JHb7rmtNlryEpY3E9FZcc8apDoqkqteMxOwdBX7B7wZOYWhFabJuhZtMRtwAiqyXqBoadCBkU0qkVDCCJiEisMcuBMMAlufxuCzpSmXm/UCy3a0OuM3XShwWqo13SBFWNYjKWblewA0DPjca/qKK+Q+/+7Txyv86pvOpx+DkDa5Y8HZswcFuMeWZaMNf1EkKSYI97v8WpRXvYIKlnqcwBRnLCWBgRZCimiNC8k6U7F5eBDLoD9pxPatSxdX+IknS6fTyyBc7QxZ+36ywwIlRyS+wSXX1W8OTUfcWdnhb2y6vKHe86N1c8oKgGf43MrXXGy5hvgDfq6zyqnTy3FUrosK5nd5XhCDV3G5g6H6sM76S/oMahTOlDXTeNWcGP/qvFMjGTTNiibCVnGfP2g2rBMZczbCwIn6pxR5xoFzmTyNsMGplBloKNeZuOqaygJcBUdfM7heO5gK4QIuCXrXbffHXTKsjOIBEiSG6zfPWP9nefB/cwz4EZZ+/dnYNrM0RUPrhjdl85m0/ts8hMZJAfIn7GeG3/ocPzwRqzT2uuUNcnNhLAqg8Qqtd6VJXiH1XF0nYf/PPBvNbXImWw8RBtrvUZXo/wJIwbv5WZy49wqHBEGqkRbchotgZlVGYBqqKh0kL+yDOcZgXqRoM5JkEZAVwgqnQFi5As2LqszsTXAmMyGZQWzl8AfJ9IM6qUn/ti6/uCJJ34AzwlOp7BFEEVhJ0+9PmElTxWVHz+K/pATBCWbc/BtpsfpC3v6ZgrizLIcFujKP2At1vewtj9CV4Z6Ml2H73odpr3eJLAFAvEAtIJvOrSITHppMOwhTe6jCH1YCfHqzLaeJX4pHHE6MzuH6+vQsvPYcuw25JONXBVl2AZuO45IC4VpqG7LDUbohg057RRcQKh4mEKvtnrfQAvSrFAby+NCqjH2GGTjgSqeMuyfYakFLMgYJqjla9lgNlgJVmqVGrnkn+XdtaWN2nGBoNNheLountnomD3rwE1jy0mf2SkFNTmQVuLgj8blpTOSx67ZOn2GImfVaPuo5JPnOXlfutccCLRBPF0x+/0FOH/owIGhi+iGcNeiYxf34QrW3Wq0zQ96NrUqM7/SALJg7vqh0VRWCrclZDWttc3JNzriYvOCXE/fYoDOztmZkJ5wuj0SkF5YFg5lSE92wXC1ow2gO7dokXo9e8BFQzY/vUffow4uhnZ1FTXAPG4tt5ehnQFi23PY5YJoD5y9VNB+KwByx4Ct4hBjMmGFKoJJJCyMo1lHwd8QGC8lQMij8VTDHAbSKnVd1HRasO1wNh0NVtjQmWmAuVhFb71Afh9xCIFE6YCYJU46bfOJV9HpXqq/unc/cI32jdanz76F0lvOPvtWSm/93GkZAeTU3PPzhf7PG4mYHkkk5jq9TurzOR1wrksBx6Vut6K4Vyi819m5wMPLKGpkt9u3r0cXqYMGfR6Nmgfgk6JG52SzOcEdTZjDic6D0opt5JJtgrTlpBM2WPc5jlu+bKfIr1624mxo0y+TSK+WS/Y0rv0pCRZSlIQK8cU8KKqHetTXZInui4le3es+VnIrUJJEShyaxxcEgnZofG59luh2J/wgB6//PNfCSvfTP9ElnMl0LzIXGweUTzaMRz1rBFEjMLDUUgEKk3BmjUc7KSNmG6ilsJhRx1KFbEEIGij7xGwhqweNzcllHakqIYvqM1YAOXBcbVtHJTK3LdsGc+vzlwG5dPusU8pkJwCJGElI6BFKdqycvyCfSkVTkGork7KZInByrB2S2UI6GFq6YNPaSMS7VTMgFsuk/JGli7auz+e9a2JfhBBcALtPXg8Q107wQ753E8ZP/tJTk7r3egfQExGvcxDwQCDPB7rRCrkJtnzIzbCesJ6Y8SEHW+iJ1qOVD6xbJiZg0weV1n376Ad0O1dAlGXrROZMOEpUIUvZgspGXnYivXp2WdfTKXLuHbshEczx1OhNpYLGnEIuSeVZX3kcDqzP9xKh8FSHwZNYya9dd85ZUX8yrSwY7olAOBHqz3Rbb//gqdNmxI4xjfKUz+MK+hd6MhfFGaqhfbscG5exYWs2jU1gEpfBoNqkMlIxz8at2DZarqMxggZKHGUvczu1YiLOJRooR+fRuqCakI00r4tkgWwbhTNGTyKD+INto7y/DQbqcwHn7T2P3x/x+z3WpxihAqieb0wmwUsD0Ww2YhVHtxGsIIW1LB3dTqxn3oPhegPNtL/4PQc9qoqB/+Mo7Ksb+/ok/RX5E0oFr+136uGmc0u4Y7nN3PHcNhyMbA0FXsPgs2bDQMGXP8rWNKf8CPzHJZpZBvPTNsyvMVSJ2QHbKGxBRQOtpny6lga0lpnFDPPOqXVUuuGL+we7ezpqzc3lWYTMKvfOBpjdG83larkcebgVO5JWz+WKNcjHrFmxAtTInAo8ioZs1+F/yl6vTHk32qjepos83+yBQ9Om/Wb69L5t1WXxk46PLa7efqTu8qz7IYs11bMPfEya9zWsGgqx116rzCH4hOaXve473V47qJ0Kq6dPnz65pq+nH9LjuSJXYpLUzFMEdpRHUclTQW/keTRY6yZFa0gXuqFeyBdyBo9L38zXzV76T+qy7rqE1/hLrLtczNwcJaoEbdDmkHgnGQiqfv731g+g6L7A+gsP275n/Yjc/ikJkQ2Fv7lQ6A5KkvV4AgLi69Z9Lpl/4AFCBRe43bKHb1dfBs0tmJmXwZt7XZTsdXYL/V+6CbkbLTXbaIWWqK+oKNcrKi45ZGeRmWE12xbDhfa4dV22HOpSreuigkATqRHoKd9AIHR5CMj1ldJIKk4FAR6HfTm/37o4UXQ7vWD9rLqCQrtWIqQYtH5GV1ShHbxOd9HGeF+iL9AxtEHq3Gnck5AHtur7Icl7+RI/yEMlKXj5LJKOCjYs6VAxLmZLAibVBvnKIFEHBdMbDCYDg1opWEnqXqOk1waDvfAhcXhcEiUEqCSgCSs7eR5pJ0phmE2dTtmOAuZJHlkQHA4CvODyCtajDirxmOkUBNGBtzt4QVIkRXB5JBH/DqHd63Cg9BQw/VGnWwTCOwRJcLkTWjwfyIZC3nhEDfrdWCdFDO0QecEb0P2ReCgUiRQKWiKZTAQCBX8mbMQjAbdXERUXDwSrESWfx+ULo4L0hTOBWDze7pJDhpFJ68FEPB9OBTW/DxvLUwpAqVNyKj45EBRD4UggkEimu7JGLpTNdqWxdCASDnm1gM+FY8Cz4rzk8vvQhPOF1Hxc69DTmWzuJGQP7IQXx0IA7L0oeSWXTc9hAyU53W4Hi2L/eJcHR1DkYQFQh8Ppsn6L9r8bW+DyyE5JclBM5nnRDVTgnbbLlCfUjf0yBEFyYHYMCBXdoupV3ZG4kcpEAwENG62xtvpzmZQRjahej+zBGcMxc/AeJxaNRA1fKOLPmXEXDlo8EctGfKGEpqlurypKIk9nt8ZBwqJ6KhyLJYKpLj2Ec5Blo4bjHIs4Q3pQln2K2y2wcRAQiPtUOaiH1Eg8Hkym01kjFAoZ2XS6IxGLhX2GN4LGCtbusH2cbE0fpDfQDba3mIO0bRG3bORKGgc0kADUomBkyT4kYpFmXyQGeIW74m28i3+Zd/CHidR8OpgGIRak45G49XIwAkMO3vELzGfPcOIznkY7fzZK3zauHe3xCjfEzWK+aRAcCJ0MMY8gKtco5ALMtZQpgdhATVidNGSIJuSzLXmbEfhsgpQR+Rchg8s5qyXgSAw+fNb6Gz86EgR/3nwWPGjF/G3D9EWjqzIZ73eUyIxZM3ctWvql0UWnDww0n++JtUWjbTHgekE2woZsBx/2ePSI7rEDOpv/9d2rrms8tZF3/Pqeu3/dvKIUjfFk+DK9dM6lZ2+M4t/Gsw+c/YgWjbZHo0FPUFGCURYoH5EtO+9i+grdj+MbR0uvwQ1z61Dj4BDX0JizFYaqY6+BSaU0c76Zap5BoQF7B0cTKi1t8jGRALMJGy31bPsmbN1ELrXmrJ+vesg3PD4AV7SteS3Jj8C3SrqPB4vKTLuGVfVrssouX/fYl9uZtpy2CGDRNEYt30nIzk84Ti2RiF1ebv5cmpXqJDdZvGdcCGnthMhnq/KdHp/PcydW9DFU8/tYL6tv2iKCFNmxYvnOSb/M48hvPVwXog6GyhF1FEweTVUeOa6FL7A/jbztIGAaF7Vo/iPX7wC0PKNHfP5HCCoWBjXrEbQ3h7XBwsAYwNjA4AoC1j1ab3xgjJCxgXivBquArBhs5WZKpZFisflipljEK+nM4rVUIu5M/It+0//FeKZVA5Z3fNUfZLetIEH/Vx2ttIEVzb8Du2GkCN8DVgMShcmUqbX1M3qIdnMphvZA80JAC2o2f9s7LY2AbZDlkcuTwOt8owSqQQ95v1PSXe6335aDbih+R0mAstedcp0NnqT1mztfP/4Z+F9ZOWS94xCj4rnniogBnCAf8ro13nxH198x+Z/cnPlB858n28+/EzHeGi7EzcbnM+XHM3snYDIPbaBeKEEeBxYRN1qCqMWTgNaDgBZLI4/rjtcrZVTmhUFU5Ga+gFSWcPv5oAf0pyWJ9Lzvjrjf7yGS9DToniC/3y18UnBaT7sF8TWR1MCNchF03smD5uCdbqiB+CunIFvPuuknBTfNHJa9pP27Ushj/eEigTgvwkpC0nfbwSdDr8v6nUi7SND1suC2npU8QD5DyDUErb6aS/yFM0g7iRNCrskx/h96Iz0HUd0cW56Yk/b+pO1m23qGrgDzIjXqOUP384XGlD8AC7dMQMW2TGwYTk9uWG9f356TBW9ETqTP/VXRPGXfub/qDruJL6YTUVKmgXL9Zy9u/lVweldXqxWPsrraFgpvK9cDxKHLTpk4EwsLu+C0zxwoKbozEhLEgNvc+Yn9v+w2d+ybu1AJOrxK95pOzJ5mvdMTilTKsjJexdAd84zUNv/AmZQJSO7CX4/vHJ30k95s70MtQxt2i428EM4MMD9RlZlHLRJNhwLbCRFtj3uduf0wwTZPGcmsiiBKc7bGmGuwPrk/FUAUyzzZlJVj/ieU/EaFPkE72i5du/E6wemSne4v71g5ITol6nFqf1+x4u+a00MlpzixcseX3U7Z5RSu27Tu0rYOKnt6wOd+4BkqukSEB8qTd7t90OORrWTxvn1drsp3DsC1++4rHvhOxUVeIBBIlKME3KqLZIbmTQMi+ySAzQcu2kIIQgWAafOHMpjvk0m0ktAAQQlKogvcXs9mUaCEete6wesm58oqaSZiM1xkPjGHrLg0M0qGZ5nEtnG+RP8LMaCLC6Lemc2dgGOnC2bLhg82ipPW/wAEisQsiAoRE8TQmXskoFCR8UyRIosgnE2h+BECAsUibF+jyHxMzMtiDlBcH426wdziZJCfk9BV3exIzXCePi3XScjKk+Ze6G4Px+76fCiac6nVVObCcyveWi/vdIa13j2n9UfaSzlZ8VPX+TB8vkylE5VeGg77r/7BlWOSLBKECwwighpIuaPzT/753WszOEafyXX6XaWiJmR0eeassG/ErC6QVsN2r8bz0ZhDCHh9Gu9QfSLRmo8rfYUOORolLoccSGiN0yR+5UoaSJHUJutNNeGT5gd9Q6IvJBpe/v7slg4loqq8K+oKliOdcnbKz/w05egFnIaRYJbZdhUxq+KnVrFdyuTDtb3ZLxjX3HfNNXu2rqRnf7a9fcfd1lK4/+7928+c3Nd7hfwdbWWdMzguwLSehKPcOGJmqrxg5i8g/2yrg5WzsqTWthHqba14yS1bJfIO8rrVBGJW4VGr0cZc723wzLuC8I+pvYSH6Zt0K9omVa6v5Um1GdxsGdlTRFahRmsF1Bv2h4k3ZqMIBSYwUMN8M1gPt81Rgyi3Qs7qxYtCOQcJSUuvWDx+/elFWX/g0nT6lK9NV0I7SgLiZ+3weYHNwqw+y/3TheR2+Kos0/TSnqFzhtwO18JjlO7jah6nc7ROFlxy69ilDxj8zuND6sLdql/yeD/Vlpp+Rj90N0KHkEO5Dw/Rx+kgWqtxtFmKiBMWcxvQOt3HXfWvfmEDdYjtLDfYajfrDZ0imc2YVbNOy5hYqAWYx535+zCT2TeYg/xrn10whGDD9nJprGS2VQ8t1LBkkj2Fz7TumvyhYAywBIPVUrCrwacLhDt0mOcPH3qUhWlZjyBI0GJ9izxzl5WK9VmzR5IJ6Dwxk+5qJxek2nztCXHfSbEZghjJOrLtvhXWnlgKcm3ecFeb/5tX0FqXxxfJAHhmuB3gOuU8qJ09G9oWXlw7b7vsTar5/NZjgnr94adXj6QNrMKPKmLOYjVHB6Za8Oihwyc4xcEZfFqPqOXuWTet6zB81ni1IBNBaCOUVw1dtxZ3F9xBf3zWttUEMhGPO5s49vZ/dm+blojOmfdgMv+pbxupVK5LxDzdt8q6OZvtnzY7TrMl6YJyV2SuCDoF3SVtOA3kzuFKH2A5f1xs9E2/+dgZDWXSp3IPfYnOQG4UcR6jXIzxOiJjNa3a13rDFMRswcQxx2gtPUpPP3wVzTXN7URofgA/6unY3t54uLt/84y89Ta93WrSGVutAFxs7YPMIetbCzYVdh179qrCutEtWyb3EO7ju+lyzselEUkt43ZwZyKv9PTaZzumQS/bddRq+f9IyNicY29fijbeannRyw3dYSAOZzxTLSAgaAlKJuaYTGy0wFgLpqFZQBByT/lD4ctsIwFY8DtZZZQqAwo3T+cdO/sXCsLC/p13dMod4bZarc3QJNB++BxoTi1k1mr//KkjlPCJoaQX3px4BU1Ph8+TOGGgNJZMregZOD7p8aFh43gFdnnDoi8RFrzQw3bS3IqCwOIIdXs8dOxnc6GxWm0slPvssaE4DG4aBM/1/0PI/1zvYZFrZUkOhfFn3UwuOVXyGw2tqwqpGLJitUtrGJL/1EtgjiCFQzL+JuXe4/RHdJSbgfOYsLekapO7oGwzivkzcd0UbG8vAqYWqNCDCOcTYLu/2BERzhS4bnrvJ1UeTqhStV3saRhDuhTduRXKitdRWiRUD1Tc87sciqcCx+0MBB3yp75MeOuDJ5+03of9B/9YpqprmbDcbxiu8HicF/OR4N7lS/t7kCM7BEWRCkQc7ukbXbEn6O+NnSm6e/9045Mg8A7r/ck+3Iw68FjUf0yKtLYKjCk4zURewnY8tlJsD6RZLxDuijudrj6vInn8A1Qac0irnLE3c7k3Y85VkmNMogN+j6R4+1zOz9P18NyjwesqvdtFukpcvxEgHwqKaCwHQ3mAjevFVVTc3lv5jPbgz4+c8XiDNLkw8iy2KVBRGTuxoUJKRUY0xCzbNcyC2gIjeRQ5KrYqZMovP+Tr9D30c9ms/OlGIqwQ+BvertADd38tD59v3vfmjfmv3U2eaz5EB8LhAUoWNq/iZ7udTucIT25qPuaoJEmXb4XTucLX/Emy4miNzT10H92JdggXQP7XbaiLkzo1PLgyGNNXbZSIKczyZ4re9ssOwpGdOgUunt4XFN3UIagaXHvB6XsANi3vrkpKhuQLpRkAPkjFXV4XJU4qzg86vX7fouInbyPk0O1PP0MCC04Pi3qXS5YC9eyOGxzkrGP3TThgRnf9RDNXBLJ00OyBS/aU5p0v80Cd24bDM+bE28Dxo4nzH3Y4X+SOjOsh8lvbju+wfV62X1LVDNDL2LFqXmgd5dF4YKOroznSyqCKtU9yW2/KXpDgYrXb/2e1+Qe1O5PpzpD/svY55WG40ud7y86A1XCxE7sjW3+QndY+Vf2zv/slNcMKv8RyrF12MZZsy8Pz6SX0fNT6EW4Rt5o7EQe9YYgG+4mmaDbsX8MwGzTdSOcH7I0rtovCLBF2wKaCMItpaNRN9naKmGUGsMk2WVA7UV4stErTPLBjKq3ZsX158HuvV/ckvemar5b2JnK6z7cgsLNL+wJMA+t7pBgNSctcPQk5nnBmcdqcHm2nkXXIbtkbEkZ5t/uHXcWHZb/ZFn+4Vj4N+va4ZU8i5RSfsZ6Eb4em9Zf9eaVn8krqQU88i6KuQ+/o8Jh8Qg66IoETI016yhnuWuy1WJwSRzm2X3IKbYv2uwJAwKu8JhuOxV7we05KXZZoB+Kj2w8fpIQ4qnHDevcwQMAnJozqnvaAzxkPVfZMYpxX6Z9oBtdOlp2dhJpiL9lgIauiZdNix7rDUDPMGMgithINYPaByoQUvfbwQZ4/eLi72wOhXWpbLNam7oKQp8fKL3xw2PH4eQ4XHHCMfHWh7DjvcXLXJ8QTZPkE8RO0+SkHLbtSBNLuXuogZzS/2hYGMu5e5AxZaYi0kWjcucg9qf9epM9j+9xocdYQb6P1krcPB7UOEdFyvWYfQmSwjymh4KSzqdbaMGBYkO2rFYEv26cQWyUrU7exMxrkTYcR9dCL7XCOEgjE/AB+OKj4gYbCzTXJGA3EAtCTJYfT3ZjTPEZhu692qf9ixQOBGz0eERf3Wwq7NN8KKPBpr9/vtXYrgTMCysUhnZJQ9AIsq9ye64FU+mt2Ojle8fuV5kGWToCFzQ+VADfp07gN7bMN2G8NdcVx/4rXxMllJ+SzH3UV87PMjdHPOh1k6nkm49uK7dGYLMOOObB4J8uZLMM8ca37FCBc3xJClvS1wrhp9pkm3Ay+/71Li2l3/a/PbuTRUU2z1iD9yW965yCtzPF+85P/GiXSker6ljzL6uszT/j4mqai1kn/h7pa0am9pjvpT+hCmy/yXJnbhCNk71Cj6NcENhnZI6drjBZPfFzkKKdZkDnNivYpHSbmGGe0Tu0UmEJj53pglScQ8DzNWn4ZeGVrpexD3PhFmW2X/B9jvzr8bpodEL1BT4ArHJEh4G1+WdECXvJDdpzaGQq7gXSRzeC3GQqDS5ArogH/gx4Wj/r9DyitjMC70JWiEjtfENebyz0ZCjkPOc/LmNHbzCoaJpPpcppCRm7elO6c9GXc7rgf7VX7BDKUmYleM2t5djo6mA7mgxhqKAYnTyQnwLbh+cYAaSC2Z2vcHjHyc0gbuucvkLZ+9WnrbfC+DN9GTeR6ef2amzzihruuHhw+nsAhnzenweF1u0Ypmbdlx9NOxwS45o/MWwB0vWPoM58ZoltrUGvfyi8QYO3JO/aZiULbqcI7sdi8Ppjv2Fgujbm3Ot23TLb7XvoiHUfeX89O/RQpynFaq1bKCcoWbxUBZkYhQS1BUI4buBTYIXbkY2TqSnmAGCzBZImkVm1MnVLCu/EWUSfvhrL1UmKdM+KW1kTaw3rEF8+OnNTfvnS43eiu5dY2lECvmSwnwkk1mfzMiV0rhtt+efnm0aFS1+qbdw+7ehld7G7REEmW01GvECQul89V8mqa14xm6rFAYbgrPy1nOHXF6elJatFYIBebtszomL9m8+W9ruHdN6/uKg2NTtHdxaGWPL7H8TTOlwPtNx/23ETVJhFRgm52fs0kv965Z89euLr5XvP9JWQlGW/ea/12MZwIJy2hrlUbNm60vmWdADcMWB3w0/ivBqzfQnRgUs7/if6dPIfSJGefRReFDCrCKirCctJW3DiG7IQCU5eNwIDtoYcjhcyPSsKKiKDwH/D4VYSIIPz4xwI0niKymBZF8hTxCHiFDZjJR3n+xz/m8cKK744KwvutGzFB+PELPCq55hK8R8J7yYOMoLJ14/uCwG544ceCXQHWM+Xvf4Z+jU7jvFwA7f0ol0R9Zdoneo+s1ZZMp2k1zXZfeTSG/v1KLzn8jhaLaVRm4eF3qNz8zubN8Jy1BW6yev+TotMAi/09GIsFqVuLHf4udf+ip6fnb729ve/gr8WnP6XH0SFsVdI+Mdc6+z7p+WNHNphS0nT7VHGBbnWk51zhcpeX9uy4BHXB5de+nhGsO6cvpQv7po3ShfCj1cu/cKbTmYP82EuXX/ZiTL/+6sxx86f1LaWwoNG3xLbPvkqvoLtta3BqLLg8wlz2qkOAb+Qb7Af4EQMNYH1Wxpvc+Aa41W9tKMBFWWv/fJhft75+07A13LwI7rFWuYGz7oXxDzkIrV65eveDS756mvXWLFAvr1j3VKyR8cn1+HX6FJ2P+HqN7S1keicdbJ0SMmpGL1uFIoO4aITaUJbWbSegvf1fsuFtzVY97CgAw1pBtgsktk6zCq3pgyd5futZhMyGPVvcHrTQKC8A3boXmofIWZvR/uCpg3fChwhxRuCY5R7P8mNgLttcOPw/Hr+qLID1y2V5+XpYyNLoqKLClZSEr9m8c+fma8JUdYtARcoTyRm+dtPatZuuCRNKeV4KCNYi2b923edKoli8ft1O9uJJWIWd664vimLpc+vWsgTbNsaF9B75Bufn4lwbN8wt5Vawc9VMpjD7LKgpJJtWeVs8sXdsAiiIakzZBvO2c6jCjqSgQCoMECaJxLSmNwomijGxUrC38otd86uxjvZp03IzR9utF0HNlbyxtHre1Vo+6qt1/ReZGavk68KOyMmLqytnJiEzY2Vl+ng9RK1DvoNGKZ4PS/A9/pUPPiAPgy/b31kaCKgr+orDXRo58b2MGYz5hKutD5z+ZKin7W4SLWjLRtJD49WeNYO5roWbKpHiKyEIJDKe0vsz7TnH/n6LDnAy4+08StR0YHJ/KZ+usZmcOqmgYjo9JhVqztuSMsiFoSQ0Y+SMVMi6H5Ih602Mb0mdYqTg+/jDlC31UKrCyJTRPAkeNVJc6+WIR8nv2JldSE8ez0uzfXSmjWHCeqdQBigXyLOFSqVgHSS/xUjzjVYiPIrXSXvlBvLgpK/E9pNMfU6g1cPfn/qRByo/wM+kv+Of9NfUbe+lDSFvb+fOwha0bDBBa50jEgsaw8R2VNTLDGkVib26NTTN7ZOxBaHl92V8XsgE6sydbmBey/9f1ifvbG0/1auTxp9eFZmUYFE0mynXv4yQZf2K0jsLYFav8oawf6uirNkmQsh6DdaNjJzoXTg8sjMoUJPC4qGhS7o7XZnsuSNLNwA1r/Z99bqrHgWnSVz5TnPHGTvMzhRPu5vfmqxMmaz8KXHbGkXZeo4MBpyACSxZJ1gCy9HIT7deLmIGPXetAreObBZg5eUn+zzzR6SgNxQaOTVsFHrrl/X31SV178JQ88WrX3A9cVUkFBo8s6urWOzqPaM/BFeQoTJ7pgGwrH/GMqz07fF9FJ9BP73VRT56J+MXaHOUuFlsBTEFwz4p0X77xbDP/acadVFImYUSsd3hKUNPsgOZJntRwDz6dQ36wzQ7Z5nubTxo3fhgo/dIDI57sLF6wnpsolbyuSS1VJuAoSn6r2qgUAEI+tS+pQBL+6YvgcFOyeNxdQxU77qrOtDh8nikTpv2HzxY7g96Fb2/zCjN5w32r3VCrS0XcZAVAwMrCFk6yUvvIS850TZNonyYzs3hljDMZbS8YtqkgCwjHEH7hcF3BlCPYPnW2X/WJRQV7Kxa3t6MTbT2aCcpco/qCx+64OrHHPOHMntS05I+n4ve1q8ZRlsi8bKWTJqGQZ523HXW/tsovW1/uBI5NlydbV3oCQY9AcP4gkfTPFiYRMm2AwQLzN3dfcIM0QUkk9/9uY0G3m0a462L9da2TxHyqW3brqBuoTJuHndcMKIBaJHg1LWFK35OX6IBLsh1cNWj1m7FYG8wTL6QoKJ8zIpCie2/MrjNoHcQaJaprIqapXua/vY6QL399ZO0Hu2k1+2I4f9gL8/v/cBvGH7yZ79h/eBnfY0XBho0gAUtrq0O2/ygbmM+fa693rxVNWCvw7EXDJVw7B7rc5CzLmOIFfZO2Qy34vxEkHJyCiKhCMoI9spFI4+YOZAN1MvIegLCLEYa61Dq9LpEB3TBpq9Yv9v+j22OKHmi7hBdVi9M/GO7I+qAJ5qvwphouCear9Id1kOwULbumXAbovUlksGIPGXL/YjeTL2or5NcilnZAVsF2i7PMjtcS21fqYN5BHHuCQetEwktP9ChSDYbOe8LiOprWcef74/kchFwwDoBspUcOK1N1s92QqwyvRIDmFkszoQXstUs0LvPY7c98BYMQa6cA9G60zps3zoNbm1OS/Qm8IuFYabNt4fot+kc+x2pLFfBNTnKZtJuZJr5bQPpKRVdLYhH0YGjJDWb58CU8V0x0o1KLStmzaw6eYaNXGz9w+VV3OByeb0LrGU2/RV25PQoen3zgsZCgIUNcp59jUAx07wg0w1zHoXYI3PXPvKPQ6uhO0vOzaIhPlvR0SZjwRIMlKD3LoWtUgXWYQVHV9TkMkXAmp67a6Jy111wLtYH3Zmp/fRL6XfpXkTbCDSBp6YKvCqBSnk1T6vWEngQnm/eAt+GJ8+1vgHzyC+a1pW7YAcUf9+0rPfASYg1/Wtw9Tdb581voa9R9q6IjDIggei0zg3ibNv7qJPuUMrUib3pkWeGFabSakPP2dsiaH0GWqXYGeo8FrM3UFL00cX3ro1mV3+61DcLDnZdNn7MuQvHNt5p9Z677ox/nqV/+l5yDkj7MtFzXl06b/RrC1/cm+0U1m1b+d/wc8+csVvmEd85dJPlDvGBkVmpzSNDdxwLm2ZvSN5yIAIwR7/g5mwUznzIOj+oQSI/OCd72/mz77feOufGzPpvbWiHuusbD6iiAac/NLVvd4PdR5Oh3ULDLOi2/VVvsBOOAtdyadovKuoV9h6BiRDuyo4wzFfzjkg4GkXj9Wdznt33fettHjav1AgJBebGxtd/H7w89FpPfx0cet7xUL8iBAN+r0D+uPYk4K0PH9/59aFzaERyl7QUD/D4Kcc+u2eqPV+hf6VnMxQMbLc5wbTz1K4TShs2oKjOyWxfwg2bXDLIkjXfnfJbV/hSsuSIgV+FL0tBeqbD7bZulkIRw2nNU1QS52U5rsAWvaDAfa7AkXNNr9Etk7jPPgfATr2zRTG1Y46PrLS2zDMfbZnbC8kmszZMCLQOKLfebGvgike8ACgM6fdoZ9ulx2z+DG/vkN+3Y+WE0ymBQwPtH2Nj/9CcMnU6nRMrd9zX2iL/zKZ1l7V1UrcCPeCVH3yWeH0Oqjx1t+zFBMVa1NdHXgKU1IlyjMg+NwrcoflsT1ySBNhy4MAWcPpkAtPnz8oQl+oGEq0kA8TeET/X7QXPZtElsi1x2SuTC91+hHTzpvZFf0n/Qk2UoB3cYvYWFNPI1EY67LCq/TIzZCa7SlrKjPnrzADOScP2pgZsr7gCXjAbA8SGR2xlgEUdvavTzdnC/OyaLavTh+eI8zIrrZ/kZkX6+PrhyPCi4Wgg0M/Xm5E5hfdLKzOF6PDiOZHDDb4/inmRTW2b06u2rM3OE+cczqzqTZOuNuhZ+ZPRfJ52tVnPI5XLU388NvSlEev5ZJbE434/0tCTzJDD/08+m4vFSSYJvSNfnBWP00zyjNSZZpejkB99Ydx6vq2TTMmMr9Jn6SKU5kOMD2zT2GA2NHu9krm/zUKGReyX3BosQwEEjIP2K5iTGZPFBA1+2de3bebNMzF0ejXntgULFj+5BENR8w5imnn8SQtj0cJ/5MGxeM+2vj4WOjVF3LbkycULFrBQ9AaWstRCNLbwpOPN/8ydxCrfpr9Eu5XJ/CJXRjk1NCXzW7K9cZT8Nyg7w83jlNLWK4dpdqasTtG8NDNoFQxAJc/e2szSYPMF9roO6ZbcbnfzXpseR/qWUSmTa16XyLtHXZBQ6Q6fD+AtKwOvziB68zuzeb+f7Az4+OG3yKjb78bvSVN7fi9CgYTiEIlZP5Y8VoeKUiuiwk8169DeB2A68qZHsb57xEZ9le7iGnZfWliKvXmitnYmG6bYsLVu0GjYNioyptjavRJV1Fa1lm+VwSyGtwg3dwOBkcb+/Yu2ZaMFz+yJrpFCf/elx7S3H3Npd39hpGtitqcQzW5btH9/YwTIhrm5YnF+sUhPR7JvlXftmPWQWEqHykZq0f3pkVpbn5N0dBBnX1ttJH3/opRRDqVLIiwcW+td1Td3w3IoziuV5hUnbaEnSIVplACi8QaYcEov3BMOwz291imk3GuNGwbci/SUDHyLXE9VVl5i/vmGBORE63Iss6ds3Qobqc+6PBy2Lu+FjbDxSP3fZuVxyRkSSkjCha1VvXAtXNtrrSKPG9Y4Rix86r2t+mlbq37mhMIHmHB9GTZat5Zhj2FQX691q3VrL+wJh7Fqz6SvYJfNWx95akqILBpcP3LaHOxXkP1zhixzQtZE9mpQmr0exCw1NR2wydaPP4r+9/irE/TqiTFry8TYGNw0NtbUyR+a+vtjK8aQfgSDowh6evvh0+jV7e3t53TgH0uHt8fsvzvHJv8mWhcbr11p+zpa7c/+f7cWRFNMwiB8bGtI4eWN/eck4u/T+R2HT6dX4bP3YyPaV7AG/PYXG2ecE4u9P4kRj35m8v82QumP7/0E3PRxT1qE3fqPZ5j/l34deWcr+/HPgsUTEysmJj7ueW9PjN1559jE//9nivZOXoMt1Y9/Jpmxe/fU9+Oe/Hz/VH7/7tbaQF4/k/zd9gcw3pXY6jDhsSoMWSyAoar1mB2QdzCw/jVjSt5fT39PT0T8Hsda/hXymjy22z7hjJcBeHfDfkL2byD+1rX5Z5DgSrJwuvWutYsspCfYaUeVWWPtst6dvpDAlSBNXzi51q7BtYbtBZUNSkVFKavCK9Z1sGM+7LCuw9V83fzJ2GT7sI+vkeftMeYQf2E3ReY3NoEFDTsCcNpjj1lfgWUre3J/+cvma2DZY4/1XLP5L3/J9ayEZfCVxx7DcDLzKjvzqqlMbur9/tfodO5M7kqm85gas0+rMT1WmtopbXmS2S4CJifgCFn+t2T2v2UGodzbcpgwFzPzLX98pOWKZqeuAr3sfTj2Bl150hldZmdIikD+Wwq76NCV0xMyce2RJJJbf/zqVJ97dlkQoh4SzXjCkiE4owqJpZWwoMpHp4Y91Cgo7dAmJxWfQ4mKHlUIyymPSpWo4PGJ4cl0QVaFiDul+KgnPP/BkQm34E0syfW4wq4npIjkz2YdXWBJkqPP06474669rrBEs1m+01zwwEhZUIWogmpUjjgFQ4p6CgbxhLH2I6miLoU9mRhR2k3ZIbnbvFHR58Hn8ZKMNGtyGNPlNmyfT4apDHh5unv2hJx0KpkeSfquhM3Ank/qhNfoLTRlv1WTnnqtium+jw7jN+ydUebHszf1W7tdGKf7rNW+YNAH1BsEGCxZt+CVDJSI4NMg6Gt+cNaNNOgj6e2fpkF4Iehb7wtC0BsoDRC8wKbSINhp9Mazmh/g5dPbf+ILctz/CyPCp1AAAAB4nGNgZGBgAGL181tmxPPbfGXgZmEAgeu8IQkI+n81qy5zI5DLwcAEEgUAFjoJXQB4nGNgZGBgbvjfwBDDGsQABKy6DIwMqCAJAFLvA0wAAHicY2FgYGB+ycDAwoAFM+IQJxZj00+hmaxBJKi/D6V/ALEohX6hMQYAGPYEswAAAAAAAAAAdgDCASgBmgHOAkQChgLSAwQDOgPWBEQEfgSsBR4FaAX8BoQHEAesCGwI3Aj4CTwJsgpWCqwK7gxADHIM8A14De4OLg6gDxIPrhBSEHIQpBEEEeYSHhLOEzATeBO+FCQUbhUWFWYV4hZyFwYXYhfeGAoYahi2GO4ZKhmsGiQaWhp8GpYbUBu8HDYcjBzIHRgdlh28Hi4edh6sHzAfsCASIHwg4CD4IRAhKCFAIaAh2iIMIkYihiKoIt4i+CMqJAIkTAAAeJxjYGRgYEhiVGfgZQABJiDmAkIGhv9gPgMAF7QBrgB4nF2Qy07CQBSG/0JBLYkLjSbuZmGM0aRcXBjZksCeBXsoUy5pO810IOFpXPoELl36FCZufBH/lgMLOjmn3/nPbTIArvALD/vvhrZnDz6jPddwhjvhOnUl7PPcCzfQwqNwk/qLcIBnvAq3cI0ZJ3j+BaMnbIQ9nONduIZLfAjXqX8K++Qv4QZu8S3cpP4jHGCCP+EWHry3YGD11Om5mu3UKjJZbDIXlDDWi00ytSWWNtG2WJlMdcNOGY50pu2hr9gues7FKrYmVUMO0EliVG7NWkcuXDqX99vtWPQwMimvMYCFxhSOfs7nmmFHv0IEgwxx5R3rDsqYdQs+R8Iee1QP/wmzFgXjMlLoIkTnmB0xm1UVp/sKbDm1R9Vxp6JZdqSkodxAc2NCVsir3JpKRD3EsurK0UebJz6pD6vd6T8/OGF2AAB4nG1SaZfURBTtO52k093TuIIbooK7BPcRUUBQEQX3XdZK5SVV3ZWqTC3TM/PrqXSE+UKdk3PuW/KWe99oazS82ejxr8QWxkiQIsMEOaaYYY5tLHAMT+BJPIWn8QyexXGcwHN4Hi/gRbyEk3gZp/AKXsVrOI0zeB1v4E28hbfxDt7FeziLAufwPj7Ah/gIH+MTfIodfIbz+BwX8AW+xEVcwmV8hSu4iq/xDb7FNXyH6/geP+AGbuJH/ISf8Qt+xW/4HX/gT/yFv/EP/sV/uIXbuIO7uIf7YCjBR9jPK8l0/2UisJLpKTcVFbWxq6Q1ltJDIUXIldQrqqTO6SAGpVIL5xlf0T4XTDc09qzJo8fW0olEmJYyR8xyMemsWRL3WeygTDPxa+k92ayRXoQy8bKldM9ITlljTKMoXZMszbajpiXtaxaUn/Z1Nz3TThhNOQ/dYC4lW4Z09zA6p33PwcuV4askQppw0/ZlxvGP1AlmaaglmKqTHi08aR4Tik3XpDRmNS2lL0PczOc149S7UmqZVOkhN0ZtO8PjJkUbyWBZZUJkLIuMSd3Mh502Q2zt7uZOhA2edlLHlcn5JLLkkjL6xjE462sXTpCqszhLQ74nq587Y0p27CB1q4OOsmWgpdRJL0uipPOzlnVFy+yK7CCC2SNbK7OOHATbKObcpKQoC6d5bVRFtjAd6WzASSQkpMGRdeOoZbamqKDPdGjLQRbFyrF1Lu/Vk3vk8p3zFTnZ6EllZVluJIrDzQ9MqJgptPE03WyyIV/QYTBJfy2LhwU2gSyOI4ydxWNRVFRmrf+HimqfDzB08wFY2Qifc6ZIV8weewgKLoivjsxW6uAWj8xOBXcU7C/L9bfgaFqRklya4JI+Z6tpZrWVMc0J2aVxZaLR6AG9AyuUAA==\") format(\"woff\"),url(iconfont.ttf?t=1525101408939) format(\"truetype\"),url(iconfont.svg?t=1525101408939#icon) format(\"svg\")}.icon{display:inline-block;font:14px/1 icon;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}.icon-diandian:before{content:\"\\e63a\"}.icon-huaban:before{content:\"\\e63c\"}.icon-code-fork:before{content:\"\\e67a\"}.icon-more:before{content:\"\\e6c0\"}.icon-zhihu:before{content:\"\\e6d1\"}.icon-linkedin:before{content:\"\\e724\"}.icon-eye-fill:before{content:\"\\e64f\"}.icon-stackexchange:before{content:\"\\e8b2\"}.icon-tag:before{content:\"\\e6a3\"}.icon-starfish:before{content:\"\\e62e\"}.icon-home:before{content:\"\\e660\"}.icon-search:before{content:\"\\e61c\"}.icon-project:before{content:\"\\e63e\"}.icon-dialog:before{content:\"\\e613\"}.icon-twitter:before{content:\"\\ec9c\"}.icon-github:before{content:\"\\e70a\"}.icon-time:before{content:\"\\e669\"}.icon-voice:before{content:\"\\e65a\"}.icon-google:before{content:\"\\e601\"}.icon-weibo:before{content:\"\\e64b\"}.icon-segmentfault:before{content:\"\\e610\"}.icon-star-fill:before{content:\"\\e630\"}.icon-phone:before{content:\"\\e68a\"}.icon-cup-fill:before{content:\"\\e614\"}.icon-jiaju:before{content:\"\\e671\"}.icon-qzone:before{content:\"\\e603\"}.icon-home-fill:before{content:\"\\e617\"}.icon-clock:before{content:\"\\e618\"}.icon-file:before{content:\"\\e66f\"}.icon-comment:before{content:\"\\e61a\"}.icon-cup:before{content:\"\\e62c\"}.icon-share:before{content:\"\\e66a\"}.icon-star-half:before{content:\"\\e62f\"}.icon-star:before{content:\"\\e619\"}.icon-tencent-weibo:before{content:\"\\e602\"}.icon-book:before{content:\"\\e79d\"}.icon-bitbucket:before{content:\"\\e64e\"}.icon-facebook:before{content:\"\\e6e3\"}.icon-email:before{content:\"\\e667\"}.icon-zcool:before{content:\"\\e60c\"}.icon-social-media:before{content:\"\\e68b\"}.icon-douban:before{content:\"\\e60f\"}.icon-coding:before{content:\"\\e600\"}.icon-github-fill:before{content:\"\\e71d\"}.icon-qq:before{content:\"\\e611\"}.icon-shu-fill:before{content:\"\\e615\"}.icon-pinterest:before{content:\"\\e697\"}.icon-tags:before{content:\"\\e6c4\"}.icon-bill:before{content:\"\\e61b\"}.icon-shu:before{content:\"\\e616\"}.icon-book-shelf:before{content:\"\\e60d\"}.icon-target:before{content:\"\\e695\"}.icon-profile:before{content:\"\\e6e2\"}.icon-alipay:before{content:\"\\e938\"}.icon-skype:before{content:\"\\e604\"}.icon-juejin:before{content:\"\\e605\"}.icon-code:before{content:\"\\e73f\"}.icon-list:before{content:\"\\e61e\"}.icon-map-marker:before{content:\"\\e609\"}.icon-stackoverflow:before{content:\"\\e606\"}.icon-hourglass:before{content:\"\\e60e\"}.icon-behance:before{content:\"\\e67b\"}.icon-folder-open:before{content:\"\\e6b4\"}.icon-folder:before{content:\"\\e60a\"}.icon-menu:before{content:\"\\e607\"}.icon-users:before{content:\"\\e60b\"}.icon-eye:before{content:\"\\e657\"}.icon-wechat:before{content:\"\\e65e\"}.icon-number:before{content:\"\\e658\"}.icon-gitlab:before{content:\"\\e67c\"}.icon-rss:before{content:\"\\e63d\"}.icon-archives:before{content:\"\\e62d\"}.icon-68design:before{content:\"\\e608\"}.icon-dribble:before{content:\"\\e982\"}.icon-wepay:before{content:\"\\e629\"}.icon-youdao-note:before{content:\"\\e8a6\"}.icon-book-fill:before{content:\"\\e659\"}.icon-hezuo:before{content:\"\\e6e5\"}.icon-link:before{content:\"\\e635\"}.icon-archives-fill:before{content:\"\\e694\"}.icon-anchor:before{content:\"\\e858\"}.icon-angle-down:before{content:\"\\e85e\"}.icon-angle-left:before{content:\"\\e85f\"}.icon-angle-up:before{content:\"\\e860\"}.icon-angle-right:before{content:\"\\e862\"}.icon-calendar:before{content:\"\\e895\"}.icon-calendar-check:before{content:\"\\e896\"}.icon-calendar-minus:before{content:\"\\e897\"}.icon-calendar-plus:before{content:\"\\e899\"}.icon-calendar-times:before{content:\"\\e89a\"}.icon-close:before{content:\"\\e8c4\"}.icon-delicious:before{content:\"\\e8e2\"}.icon-plus:before{content:\"\\e99d\"}.icon-gg:before{content:\"\\e6fd\"}.icon-friendship:before{content:\"\\e612\"}.icon-gitee:before{content:\"\\e61d\"}pre .comment{color:#8e908c}pre .attribute,pre .css .class,pre .css .id,pre .css .pseudo,pre .html .doctype,pre .regexp,pre .ruby .constant,pre .tag,pre .variable,pre .xml .doctype,pre .xml .pi,pre .xml .tag .title{color:#c82829}pre .built_in,pre .constant,pre .literal,pre .number,pre .params,pre .preprocessor{color:#f5871f}pre .css .rules .attribute,pre .header,pre .inheritance,pre .ruby .class .title,pre .ruby .symbol,pre .string,pre .value,pre .xml .cdata{color:#718c00}pre .css .hexcolor,pre .title{color:#3e999f}pre .coffeescript .title,pre .function,pre .javascript .title,pre .js .title,pre .perl .sub,pre .python .decorator,pre .python .title,pre .ruby .function .title,pre .ruby .title .keyword{color:#4271ae}pre .javascript .function,pre .js .function,pre .keyword{color:#8959a8}.highlight,pre{background:#fafafa;margin:10px 0;padding:15px 10px;overflow:auto;font-size:13px;color:#4d4d4c;line-height:1.5}.gist .gist-file .gist-data .line-numbers,.highlight .gutter pre{color:#666}code{text-shadow:0 1px #fff;padding:.2em .4em;margin:0 .3em;color:#555;background:#eee;border-radius:3px;font-size:85%}pre code{background:0 0;text-shadow:none;padding:0}.highlight{position:relative;padding:32px 10px 0;border-radius:4px}.highlight:before{display:block;content:' ';height:32px;position:absolute;top:0;left:0;right:0;background-color:#f6f6f6;padding:0 10px;border-top-left-radius:4px;border-top-right-radius:4px}.highlight:after{content:\" \";position:absolute;border-radius:50%;background:#fc625d;width:10px;height:10px;top:0;left:15px;margin-top:11px;-webkit-box-shadow:20px 0 #fdbc40,40px 0 #35cd4b;box-shadow:20px 0 #fdbc40,40px 0 #35cd4b}.highlight pre{border:none;margin:0}.highlight table{position:relative;border:none;width:100%;margin:0;padding:0}.highlight tr{border:none}.highlight td,.highlight th{border:none;padding:0}.highlight td.code,.highlight th.code{width:100%!important}.highlight figcaption{font-size:.85em;color:#8e908c;line-height:1em;margin-bottom:1em}.highlight figcaption a{float:right}.highlight .line{height:24px;line-height:24px}.highlight .gutter pre{text-align:right;padding-right:0;padding-left:0;color:#ccc}.header{background-color:#fbfbfb}.sidebar{background-color:#fdfdfd}.sidebar .slimContent{padding:20px}.main{position:relative;min-height:100vh;padding:15px}.main:after,.main:before{content:\" \";display:table}.main:after{clear:both}.footer{padding:20px;background-color:#fbfbfb;color:#999}body.main-center .sidebar,body.main-left .header,body.main-left .sidebar{left:auto;right:0;border-left:1px solid #f6f6f6;border-right:0}body.main-left .footer{left:auto;right:0}body.no-sidebar .sidebar{display:none!important}.main-nav{float:none!important}.main-nav>li{display:block;width:100%;position:relative}.main-nav>li>a{color:#555}.main-nav>li .menu-title{margin-left:15px}.main-nav>.active a,.main-nav>.active a:focus,.main-nav>.active a:hover{color:#333;background:#f4f4f4}.profile-block{padding:20px 15px 10px}#avatar{width:64px;height:64px;display:inline-block}#avatar img{width:100%;max-height:100%;height:auto!important}#name{font-size:18px;margin-top:10px;margin-bottom:0}#title{font-size:13px;margin-top:5px;margin-bottom:5px}.sidebar-form{border-radius:3px;border:1px solid #eee;margin:0 15px 15px}.sidebar-form .btn,.sidebar-form input[type=text]{-webkit-box-shadow:none;box-shadow:none;background-color:transparent;border:1px solid transparent;height:32px}.sidebar-form .btn:focus,.sidebar-form input[type=text]:focus{outline:0}.sidebar-form input[type=text]{color:#666;border-radius:2px 0 0 2px}.sidebar-form input[type=text]:focus,.sidebar-form input[type=text]:focus+.input-group-btn .btn{background-color:#fff;color:#666}.sidebar-form .btn{color:#999;border-radius:0 2px 2px 0}.header .navbar-collapse{padding-left:0;padding-right:0}.header .navbar-collapse .navbar-nav{margin:0}.header .navbar-toggle .icon-bar{background-color:#2196f3}.main .pager{text-align:left;margin:10px 0}.main .pager .disabled{cursor:not-allowed}.main .pager>.page-number,.main .pager>a{line-height:32px;float:left}.main .pager a{color:#666;border:0;line-height:32px;padding:0}.main .pager a:link,.main .pager a:visited{background-color:transparent}.main .pager a:hover{color:#0a6ebd;background-color:transparent}.main .pager .prev{margin-right:10px}.main .pager .page-number.current{color:#2196f3}.main .pager .page-number+.next,.main .pager .page-number+.page-number{margin-left:10px}.main .total-article{margin:10px 0;line-height:32px;color:#999}.main .page-header{margin-top:0}.main .article-list article{border-bottom:1px solid #f2f2f2}.main .article-list article:last-child{border-bottom:0}.main .article-meta{font-size:13px;color:#999}.main .article-meta a{color:#999}.main .article-meta a:hover{color:#0a6ebd;text-decoration:none}.main .article-meta span+span{margin-left:10px}.main .content{min-height:85vh}.main.has-sticky .content{margin-bottom:70px}#comments .gitment-footer-container,#comments .gitment-footer-project-link{display:none!important}.panel .label,.widget .label{font-weight:400}.widget:after,.widget:before{content:\" \";display:table}.widget:after{clear:both}.widget .widget-title{font-size:18px;color:#000}.widget time{color:#999;font-size:12px;text-transform:uppercase}.widget p{margin-bottom:0}.widget ul{margin-left:0;padding-left:0;list-style:none}.widget .category-link{color:#0a6ebd}.archive-list-count,.category-list-count,.tag-list-count{padding-left:5px;color:#999;font-size:.85em}.archive-list-count:before,.category-list-count:before,.tag-list-count:before{content:\"(\"}.archive-list-count:after,.category-list-count:after,.tag-list-count:after{content:\")\"}.archive-list,.category-list,.tag-list{line-height:1.75}.archive-list li:before,.category-list li:before,.tag-list li:before{color:#ccc;content:\"â–ª\";font-size:12px;margin-right:6px;-webkit-transition:.2s ease;transition:.2s ease}.category-list-child{padding-left:15px}.recent-post-list li+li{margin-top:15px}.recent-post-list li .item-inner,.recent-post-list li .item-thumb{display:table-cell;vertical-align:middle}.recent-post-list li .item-thumb{opacity:1;padding-right:10px;-webkit-transition:all .2s ease;transition:all .2s ease}.recent-post-list li .item-thumb .thumb{width:50px;height:50px;display:block;position:relative;overflow:hidden}.recent-post-list li .item-thumb .thumb span{width:100%;height:100%;display:block}.recent-post-list li .item-thumb .thumb .thumb-image{position:absolute;background-size:cover;background-position:center}.recent-post-list li .item-thumb .thumb .thumb-none{background-image:url(../images/thumb-default.png);background-size:100% 100%}.recent-post-list li:hover .item-thumb{opacity:.8}.sidebar-toc.collapse{display:none!important}.sidebar-toc.in{display:block!important}.tagcloud a{display:inline-block;margin-bottom:.2em;padding:.3em .6em;font-size:75%!important;line-height:1;background-color:#eee;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}.bar .pager .next>a,.bar .pager .next>span{float:none}.bar.bar-footer{position:relative;background-color:#fff;bottom:-15px}.bar.bar-footer:before{content:'';position:absolute;width:-webkit-calc(100% + 30px);width:calc(100% + 30px);height:52px;left:-15px;border-top:1px solid #f6f6f6;border-bottom:1px solid #fff;background-color:#fff}.bar .bar-inner{position:relative;z-index:9}.bar .bar-inner:after,.bar .bar-inner:before{content:\" \";display:table}.bar .bar-inner:after{clear:both}.bar .bar-right{margin:10px 0;float:right}.toggle-toc{cursor:pointer;margin-left:10px}.toggle-toc a{display:inline-block;line-height:32px;text-align:center}.footer .copyright{font-size:12px}.footer .copyright a{color:#999;text-decoration:none}.footer .copyright a:hover{color:#0a6ebd}.wave-icon{display:inline-block;position:relative}.wave-icon .wave-circle{display:block;border-radius:50%;background-color:transparent}.wave-icon .wave-circle:after,.wave-icon .wave-circle:before{content:'';border:10px solid #2196f3;background:#2196f3;border-radius:50%;position:absolute;top:50%;left:50%;z-index:1}.wave-icon .wave-circle:before{height:74px;width:74px;-webkit-animation:5s ease-out infinite pulse;animation:5s ease-out infinite pulse;margin-top:-37px;margin-left:-37px;opacity:0}.wave-icon .wave-circle:after{height:98px;width:98px;-webkit-animation:5s ease-out infinite pulse;animation:5s ease-out infinite pulse;margin-top:-49px;margin-left:-49px;opacity:.3}.wave-icon .icon{position:relative;display:block;width:50px;height:50px;line-height:50px;text-align:center;background-color:#2196f3;border-radius:50%;font-size:24px;color:#fff;z-index:2}.wave-icon.wave-icon-info .wave-circle:after,.wave-icon.wave-icon-info .wave-circle:before{border:10px solid #56ccf2;background:#56ccf2}.wave-icon.wave-icon-info .icon{background-color:#56ccf2}.wave-icon.wave-icon-primary .wave-circle:after,.wave-icon.wave-icon-primary .wave-circle:before{border:10px solid #2196f3;background:#2196f3}.wave-icon.wave-icon-primary .icon{background-color:#2196f3}.wave-icon.wave-icon-warning .wave-circle:after,.wave-icon.wave-icon-warning .wave-circle:before{border:10px solid #f09819;background:#f09819}.wave-icon.wave-icon-warning .icon{background-color:#f09819}.wave-icon.wave-icon-success .wave-circle:after,.wave-icon.wave-icon-success .wave-circle:before{border:10px solid #5cb85c;background:#5cb85c}.wave-icon.wave-icon-success .icon{background-color:#5cb85c}.wave-icon.wave-icon-danger .wave-circle:after,.wave-icon.wave-icon-danger .wave-circle:before{border:10px solid #ff512f;background:#ff512f}.wave-icon.wave-icon-danger .icon{background-color:#ff512f}@-webkit-keyframes pulse{0%{-webkit-transform:scale(0);opacity:0}25%{-webkit-transform:scale(0);opacity:.1}50%{-webkit-transform:scale(.1);opacity:.3}75%{-webkit-transform:scale(.5);opacity:.5}100%{-webkit-transform:scale(1);opacity:0}}.repo-list{list-style:none;padding-left:0}.repo{position:relative;list-style-type:none;border:1px solid #f2f2f2;margin-bottom:15px;overflow:hidden}.repo-title{padding:0 15px;margin:15px 0;font-size:16px;font-weight:600}.repo-body{display:-webkit-box;padding:0 15px;margin:0 0 20px;overflow:hidden;text-overflow:ellipsis;-webkit-box-orient:vertical;-webkit-line-clamp:2;line-height:1.5em;height:3em;word-break:break-all!important;word-wrap:break-word!important}.repo-image{position:relative;display:table;width:101%;height:3px;margin:-1px -1px 15px;background-color:#666}.repo-meta{padding:0 15px;margin-top:5px;margin-bottom:15px;color:#777;font-size:12px;text-align:right}.repo-meta:after,.repo-meta:before{content:\" \";display:table}.repo-meta:after{clear:both}.repo-meta .meta+.meta{margin-left:15px}.text-collapsed{display:none}.collapsed .text-collapsed,.text-in{display:inline-block}.collapsed .text-in{display:none}.sub-header{padding-bottom:10px;border-bottom:1px solid #eee}.article-header{margin-bottom:20px}.article-footer{margin-top:20px}.collection{position:relative}.collection a.collection-item{display:block;-webkit-transition:.25s;transition:.25s;color:#777}.collection a:not(.active):hover{color:#333}.collection .collection-item{padding:8px 0;margin:0}.article-list .article-title{font-size:18px}.article-toc .toc-title{font-size:18px;color:#000}.article-toc .toc{list-style:none;padding-left:0;line-height:2}.article-toc .toc ol{list-style:none;padding-left:10px}.article-toc .toc .toc-item{position:relative}.article-toc .toc .toc-item .markdownIt-Anchor{position:absolute;left:0;right:0;top:0;padding:14px 0}.marked-body h1,.marked-body h2,.marked-body h3,.marked-body h4,.marked-body h5,.marked-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.marked-body h1{padding-bottom:.3em;font-size:2em;border-bottom:1px solid #f2f2f2}.marked-body h2{padding-bottom:.3em;font-size:1.5em;border-bottom:1px solid #f2f2f2}.marked-body a{color:#2196f3;text-decoration:none}.marked-body a:focus,.marked-body a:hover{color:#0a6ebd;text-decoration:none}.marked-body ol,.marked-body ul{padding-left:0;margin-left:20px}body.okayNav-loaded{overflow-x:hidden}.okayNav{position:relative}.okayNav:after,.okayNav:before{content:\" \";display:table}.okayNav:after{clear:both}.okayNav:not(.loaded){visibility:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.okayNav ul{float:left;padding-left:0}.okayNav ul li{display:inline-block;margin-left:15px}.okayNav a{position:relative;z-index:1;color:#2e2e33;font-weight:400}.okayNav a.active{color:#0a6ebd}.okayNav__nav--visible{overflow:hidden;white-space:nowrap}.okayNav__nav--visible li{display:inline-block;margin-left:15px}.okayNav__nav--visible li:first-child{margin-left:0}.okayNav__nav--visible a{display:block;-webkit-transition:color .2s cubic-bezier(.55,0,.1,1);transition:color .2s cubic-bezier(.55,0,.1,1)}.okayNav__nav--visible:empty~.okayNav__menu-toggle{top:0}.okayNav__nav--invisible{display:none;position:absolute;width:100%;top:24px;overflow-y:auto;-webkit-overflow-scrolling:touch;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.05);box-shadow:0 1px 2px rgba(0,0,0,.05);padding-top:15px;padding-bottom:15px;background:#fff}.okayNav__nav--invisible li{display:inline-block}.okayNav__nav--invisible li a{display:block;padding:6px 15px;min-width:100px}.okayNav__nav--invisible.nav-left{left:0}.okayNav__nav--invisible.nav-right{right:0}.okayNav__nav--invisible.transition-enabled{-webkit-transition:-webkit-transform .4s cubic-bezier(.55,0,.1,1);transition:-webkit-transform .4s cubic-bezier(.55,0,.1,1);transition:transform .4s cubic-bezier(.55,0,.1,1);transition:transform .4s cubic-bezier(.55,0,.1,1),-webkit-transform .4s cubic-bezier(.55,0,.1,1)}.okayNav__nav--invisible.nav-open{display:block;z-index:99;border:1px solid #f2f2f2}.okayNav__menu-toggle{position:relative;z-index:1;float:right;cursor:pointer;-webkit-transition:-webkit-transform .4s cubic-bezier(.55,0,.1,1);transition:-webkit-transform .4s cubic-bezier(.55,0,.1,1);transition:transform .4s cubic-bezier(.55,0,.1,1);transition:transform .4s cubic-bezier(.55,0,.1,1),-webkit-transform .4s cubic-bezier(.55,0,.1,1)}.okayNav__menu-toggle.okay-invisible{position:absolute;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none;opacity:0}.okayNav__menu-toggle span{background:#666;display:inline-block;width:2px;height:2px;margin:auto 1px;pointer-events:none;border-radius:50%;vertical-align:middle}.okayNav__menu-toggle.icon--active span{background:#0a6ebd}.okayNav a:hover{color:#0a6ebd}.social-links{list-style:none;padding:0;text-align:left}.social-links li{list-style:none;display:inline-block;margin-left:10px}.social-links li:first-child{margin-left:0}.header .social-links{padding:10px 20px}.footer .social-links{margin-bottom:5px}@font-face{font-family:socialshare;src:url(../fonts/iconfont.eot);src:url(../fonts/iconfont.eot?#iefix) format(\"embedded-opentype\"),url(../fonts/iconfont.woff) format(\"woff\"),url(../fonts/iconfont.ttf) format(\"truetype\"),url(../fonts/iconfont.svg#iconfont) format(\"svg\")}.social-share{display:inline-block;font-size:16px}.social-share a{position:relative;text-decoration:none;margin-left:16px;display:inline-block;outline:0;line-height:32px}.social-share .social-share-icon{position:relative;display:inline-block;height:32px;line-height:32px;color:#999;text-align:center;vertical-align:middle;-webkit-transition:background .6s ease-out 0s;transition:background .6s ease-out 0s}.social-share .social-share-icon:hover{color:#666}.social-share .icon-weibo:hover{color:#ff763b}.social-share .icon-qq:hover,.social-share .icon-tencent:hover{color:#56b6e7}.social-share .icon-qzone:hover{color:#fdbe3d}.social-share .icon-douban:hover{color:#33b045}.social-share .icon-linkedin:hover{color:#0077b5}.social-share .icon-facebook:hover{color:#44619d}.social-share .icon-google:hover{color:#db4437}.social-share .icon-twitter:hover{color:#55acee}.social-share .icon-diandian:hover{color:#307dca}.social-share .icon-wechat{position:relative}.social-share .icon-wechat:hover{color:#7bc549}.social-share .icon-wechat .wechat-qrcode{display:none;border:1px solid #eee;position:absolute;z-index:9;top:-209px;left:-90px;width:200px;height:200px;color:#666;font-size:12px;text-align:center;background-color:#fff;-webkit-transition:all .2s;transition:all .2s;-webkit-tansition:all 350ms;-moz-transition:all 350ms}.social-share .icon-wechat .wechat-qrcode.bottom{top:40px;left:-84px}.social-share .icon-wechat .wechat-qrcode.bottom:after{display:none}.social-share .icon-wechat .wechat-qrcode h4{font-weight:400;height:26px;line-height:26px;font-size:12px;background-color:#f3f3f3;margin:0;padding:0;color:#777}.social-share .icon-wechat .wechat-qrcode .qrcode{width:105px;margin:15px auto}.social-share .icon-wechat .wechat-qrcode .qrcode table{margin:0!important}.social-share .icon-wechat .wechat-qrcode .help p{font-weight:400;line-height:16px;padding:0;margin:0}.social-share .icon-wechat .wechat-qrcode:before{content:'';position:absolute;left:50%;margin-left:-6px;bottom:-15px;width:0;height:0;border-width:8px 6px 6px;border-style:solid;border-color:#eee transparent transparent}.social-share .icon-wechat .wechat-qrcode:after{content:'';position:absolute;left:50%;margin-left:-6px;bottom:-13px;width:0;height:0;border-width:8px 6px 6px;border-style:solid;border-color:#fff transparent transparent}.social-share .icon-wechat:hover .wechat-qrcode{display:block}.btn-donate{position:absolute;bottom:10px;left:50%;margin-left:-25px;width:50px;height:50px;line-height:50px;padding:0;border-radius:50%;font-size:18px;cursor:pointer;z-index:99}.btn-donate:active,.btn-donate:focus,.btn-donate:hover{border-color:transparent!important;outline:0!important}.btn-donate.btn-fancy{background-color:transparent}.btn-donate.btn-fancy span{width:50px;height:50px;padding:0}.donate{overflow:hidden}.donate-box{text-align:center;padding-top:30px}.donate-box .donate-head{width:100%;height:80px;text-align:center;line-height:60px;color:#a3a3a3;font-size:16px;position:relative}.donate-box .donate-head:after,.donate-box .donate-head:before{font-family:Arial,Helvetica,sans-serif;background:0 0;width:0;height:0;font-style:normal;color:#eee;font-size:100px;position:absolute;top:15px}.donate-box .donate-head:before{content:'\\201c';left:30px}.donate-box .donate-head:after{content:'\\201d';right:70px}.donate-box .donate-footer{padding-top:35px}.donate-box .donate-payimg{display:inline-block;padding:10px;border:6px solid #ea5f00;margin:0 auto;border-radius:3px}.donate-box .donate-payimg img{display:block;text-align:center;width:140px;height:140px}.book .media-middle{display:inline-block;width:115px}.ins-search{display:none}.ins-search.show{display:block}.ins-selectable{cursor:pointer}.ins-search-container,.ins-search-mask{position:fixed}.ins-search-mask{top:0;left:0;width:100%;height:100%;z-index:1050;background:rgba(0,0,0,.5)}.ins-input-wrapper{position:relative}.ins-search-input{width:100%;border:none;outline:0;font-size:16px;-webkit-box-shadow:none;box-shadow:none;font-weight:200;border-radius:0;background:#fff;line-height:20px;-webkit-box-sizing:border-box;box-sizing:border-box;padding:12px 28px 12px 20px;border-bottom:1px solid #e2e2e2;font-family:\"Microsoft Yahei Light\",\"Microsoft Yahei\",Helvetica,Arial,sans-serif}.ins-close{top:50%;right:6px;width:20px;height:20px;font-size:24px;margin-top:-15px;position:absolute;text-align:center;opacity:1;color:#666;display:inline-block}.ins-close:hover{color:#006bde}.ins-search-container{left:50%;top:100px;z-index:1051;bottom:100px;-webkit-box-sizing:border-box;box-sizing:border-box;width:540px;margin-left:-270px}.ins-section-wrapper{left:0;right:0;top:45px;bottom:0;overflow-y:auto;position:absolute}.ins-section-container{position:relative;background:#f7f7f7}.ins-section{font-size:14px;line-height:16px}.ins-section .ins-search-item,.ins-section .ins-section-header{padding:8px 15px}.ins-section .ins-section-header{color:#9a9a9a;border-bottom:1px solid #e2e2e2}.ins-section .ins-slug{margin-left:5px;color:#9a9a9a}.ins-section .ins-slug:before{content:'('}.ins-section .ins-slug:after{content:')'}.ins-section .ins-search-item .ins-search-preview,.ins-section .ins-search-item header{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.ins-section .ins-search-item header .icon{margin-right:8px}.ins-section .ins-search-item .ins-search-preview{height:15px;font-size:12px;color:#9a9a9a;margin:5px 0 0 20px}.ins-section .ins-search-item.active,.ins-section .ins-search-item:hover{color:#fff;background:#006bde}.ins-section .ins-search-item.active .ins-search-preview,.ins-section .ins-search-item.active .ins-slug,.ins-section .ins-search-item:hover .ins-search-preview,.ins-section .ins-search-item:hover .ins-slug,.theme-black .header,.theme-blue .header,.theme-green .header,.theme-purple .header{color:#fff}.theme-black .header a,.theme-blue .header a,.theme-green .header a,.theme-purple .header a{color:#efefef}.theme-black .header #location,.theme-blue .header #location,.theme-green .header #location,.theme-purple .header #location{color:rgba(255,255,255,.75)!important}.theme-black .header .navbar-toggle .icon-bar,.theme-blue .header .navbar-toggle .icon-bar,.theme-green .header .navbar-toggle .icon-bar,.theme-purple .header .navbar-toggle .icon-bar{background-color:#fff}.theme-black .footer,.theme-black .footer a,.theme-blue .footer,.theme-blue .footer a,.theme-green .footer,.theme-green .footer a,.theme-purple .footer,.theme-purple .footer a{color:rgba(255,255,255,.75)}.theme-black .footer a.active,.theme-black .footer a:focus,.theme-black .footer a:hover,.theme-black .header a.active,.theme-black .header a:focus,.theme-black .header a:hover,.theme-blue .footer a.active,.theme-blue .footer a:focus,.theme-blue .footer a:hover,.theme-blue .header a.active,.theme-blue .header a:focus,.theme-blue .header a:hover,.theme-green .footer a.active,.theme-green .footer a:focus,.theme-green .footer a:hover,.theme-green .header a.active,.theme-green .header a:focus,.theme-green .header a:hover,.theme-purple .footer a.active,.theme-purple .footer a:focus,.theme-purple .footer a:hover,.theme-purple .header a.active,.theme-purple .header a:focus,.theme-purple .header a:hover{color:#fff}.theme-black .main-nav>li>a.active,.theme-black .main-nav>li>a:focus,.theme-black .main-nav>li>a:hover,.theme-blue .main-nav>li>a.active,.theme-blue .main-nav>li>a:focus,.theme-blue .main-nav>li>a:hover,.theme-green .main-nav>li>a.active,.theme-green .main-nav>li>a:focus,.theme-green .main-nav>li>a:hover,.theme-purple .main-nav>li>a.active,.theme-purple .main-nav>li>a:focus,.theme-purple .main-nav>li>a:hover{color:#fff;background:rgba(0,0,0,.15)}.theme-black .main-nav>.active a,.theme-black .main-nav>.active a.active,.theme-black .main-nav>.active a:focus,.theme-black .main-nav>.active a:hover,.theme-blue .main-nav>.active a,.theme-blue .main-nav>.active a.active,.theme-blue .main-nav>.active a:focus,.theme-blue .main-nav>.active a:hover,.theme-green .main-nav>.active a,.theme-green .main-nav>.active a.active,.theme-green .main-nav>.active a:focus,.theme-green .main-nav>.active a:hover,.theme-purple .main-nav>.active a,.theme-purple .main-nav>.active a.active,.theme-purple .main-nav>.active a:focus,.theme-purple .main-nav>.active a:hover{color:#fff;background:rgba(0,0,0,.2)}.theme-black .search .sidebar-form,.theme-blue .search .sidebar-form,.theme-green .search .sidebar-form,.theme-purple .search .sidebar-form{border:0;background:rgba(0,0,0,.2)}.theme-black .search .sidebar-form input::-webkit-input-placeholder,.theme-blue .search .sidebar-form input::-webkit-input-placeholder,.theme-green .search .sidebar-form input::-webkit-input-placeholder,.theme-purple .search .sidebar-form input::-webkit-input-placeholder{color:rgba(255,255,255,.5)}.theme-black .search .sidebar-form input:-moz-placeholder,.theme-blue .search .sidebar-form input:-moz-placeholder,.theme-green .search .sidebar-form input:-moz-placeholder,.theme-purple .search .sidebar-form input:-moz-placeholder{color:rgba(255,255,255,.5)}.theme-black .search .sidebar-form input::-moz-placeholder,.theme-blue .search .sidebar-form input::-moz-placeholder,.theme-green .search .sidebar-form input::-moz-placeholder,.theme-purple .search .sidebar-form input::-moz-placeholder{color:rgba(255,255,255,.5)}.theme-black .search .sidebar-form input:-ms-input-placeholder,.theme-blue .search .sidebar-form input:-ms-input-placeholder,.theme-green .search .sidebar-form input:-ms-input-placeholder,.theme-purple .search .sidebar-form input:-ms-input-placeholder{color:rgba(255,255,255,.5)}.theme-black .search input[type=text],.theme-blue .search input[type=text],.theme-green .search input[type=text],.theme-purple .search input[type=text]{color:#666}.theme-black .search input[type=text]+.input-group-btn .btn,.theme-blue .search input[type=text]+.input-group-btn .btn,.theme-green .search input[type=text]+.input-group-btn .btn,.theme-purple .search input[type=text]+.input-group-btn .btn{color:rgba(255,255,255,.5)}.theme-black .search input[type=text]:focus,.theme-black .search input[type=text]:focus+.input-group-btn .btn,.theme-blue .search input[type=text]:focus,.theme-blue .search input[type=text]:focus+.input-group-btn .btn,.theme-green .search input[type=text]:focus,.theme-green .search input[type=text]:focus+.input-group-btn .btn,.theme-purple .search input[type=text]:focus,.theme-purple .search input[type=text]:focus+.input-group-btn .btn{background-color:#fff;color:#666}.theme-black .header{background:#1a2433;background:-webkit-linear-gradient(left,#1a2433 0,#253449 80%,#253449 100%);background:-webkit-gradient(linear,left top,right top,from(#1a2433),color-stop(80%,#253449),to(#253449));background:linear-gradient(to right,#1a2433 0,#253449 80%,#253449 100%)}.theme-blue .header{background:#0062c5;background:-webkit-linear-gradient(left,#0062c5 0,#0073e6 80%,#0073e6 100%);background:-webkit-gradient(linear,left top,right top,from(#0062c5),color-stop(80%,#0073e6),to(#0073e6));background:linear-gradient(to right,#0062c5 0,#0073e6 80%,#0073e6 100%)}.theme-green .header{background:#08a283;background:-webkit-linear-gradient(left,#08a283 0,#0ac29d 80%,#0ac29d 100%);background:-webkit-gradient(linear,left top,right top,from(#08a283),color-stop(80%,#0ac29d),to(#0ac29d));background:linear-gradient(to right,#08a283 0,#0ac29d 80%,#0ac29d 100%)}.theme-purple .header{background:#494683;background:-webkit-linear-gradient(left,#494683 0,#555299 80%,#555299 100%);background:-webkit-gradient(linear,left top,right top,from(#494683),color-stop(80%,#555299),to(#555299));background:linear-gradient(to right,#494683 0,#555299 80%,#555299 100%)}@media (min-width:767px){.modal-center{text-align:center;padding:0!important}.modal-center:before{content:'';display:inline-block;height:100%;vertical-align:middle;margin-right:-4px}.modal-center .modal-dialog{display:inline-block;text-align:left;vertical-align:middle}.donate-box .donate-footer{margin:0 -15px -16px}}@media (min-width:768px){.lead{font-size:21px}.dl-horizontal dt{float:left;width:160px;clear:left;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dl-horizontal dd{margin-left:180px}.container{width:750px}.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9{float:left}.col-sm-1{width:8.33333%}.col-sm-2{width:16.66667%}.col-sm-3{width:25%}.col-sm-4{width:33.33333%}.col-sm-5{width:41.66667%}.col-sm-6{width:50%}.col-sm-7{width:58.33333%}.col-sm-8{width:66.66667%}.col-sm-9{width:75%}.col-sm-10{width:83.33333%}.col-sm-11{width:91.66667%}.col-sm-12{width:100%}.col-sm-pull-0{right:auto}.col-sm-pull-1{right:8.33333%}.col-sm-pull-2{right:16.66667%}.col-sm-pull-3{right:25%}.col-sm-pull-4{right:33.33333%}.col-sm-pull-5{right:41.66667%}.col-sm-pull-6{right:50%}.col-sm-pull-7{right:58.33333%}.col-sm-pull-8{right:66.66667%}.col-sm-pull-9{right:75%}.col-sm-pull-10{right:83.33333%}.col-sm-pull-11{right:91.66667%}.col-sm-pull-12{right:100%}.col-sm-push-0{left:auto}.col-sm-push-1{left:8.33333%}.col-sm-push-2{left:16.66667%}.col-sm-push-3{left:25%}.col-sm-push-4{left:33.33333%}.col-sm-push-5{left:41.66667%}.col-sm-push-6{left:50%}.col-sm-push-7{left:58.33333%}.col-sm-push-8{left:66.66667%}.col-sm-push-9{left:75%}.col-sm-push-10{left:83.33333%}.col-sm-push-11{left:91.66667%}.col-sm-push-12{left:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333%}.col-sm-offset-2{margin-left:16.66667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333%}.col-sm-offset-5{margin-left:41.66667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333%}.col-sm-offset-8{margin-left:66.66667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333%}.col-sm-offset-11{margin-left:91.66667%}.col-sm-offset-12{margin-left:100%}.navbar-right .dropdown-menu{right:0;left:auto}.navbar-right .dropdown-menu-left{left:0;right:auto}.nav-justified>li,.nav-tabs.nav-justified>li{display:table-cell;width:1%}.nav-justified>li>a,.nav-tabs.nav-justified>li>a{margin-bottom:0}.nav-tabs-justified>li>a,.nav-tabs.nav-justified>li>a{border-bottom:1px solid #f2f2f2;border-radius:4px 4px 0 0}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover,.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border-bottom-color:#fff}.navbar{border-radius:4px}.navbar-header{float:left}.navbar-collapse{width:auto;border-top:0;-webkit-box-shadow:none;box-shadow:none}.navbar-collapse.collapse{display:block!important;height:auto!important;padding-bottom:0;overflow:visible!important}.navbar-collapse.in{overflow-y:visible}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse,.navbar-static-top .navbar-collapse{padding-left:0;padding-right:0}.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}.navbar-fixed-bottom,.navbar-fixed-top,.navbar-static-top{border-radius:0}.navbar>.container .navbar-brand,.navbar>.container-fluid .navbar-brand{margin-left:-15px}.navbar-toggle{display:none}.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:14.5px;padding-bottom:14.5px}.navbar-form .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.navbar-form .form-control{display:inline-block;width:auto;vertical-align:middle}.navbar-form .form-control-static{display:inline-block}.navbar-form .input-group{display:inline-table;vertical-align:middle}.navbar-form .input-group .form-control,.navbar-form .input-group .input-group-addon,.navbar-form .input-group .input-group-btn{width:auto}.navbar-form .input-group>.form-control{width:100%}.navbar-form .control-label{margin-bottom:0;vertical-align:middle}.navbar-form .checkbox,.navbar-form .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.navbar-form .checkbox label,.navbar-form .radio label{padding-left:0}.navbar-form .checkbox input[type=checkbox],.navbar-form .radio input[type=radio]{position:relative;margin-left:0}.navbar-form .has-feedback .form-control-feedback{top:0}.navbar-form{width:auto;border:0;margin-left:0;margin-right:0;padding-top:0;padding-bottom:0;-webkit-box-shadow:none;box-shadow:none}.navbar-text{float:left;margin-left:15px;margin-right:15px}.navbar-left{float:left!important}.navbar-right{float:right!important;margin-right:-15px}.navbar-right~.navbar-right{margin-right:0}.modal-dialog{width:600px;margin:30px auto}.modal-content{-webkit-box-shadow:0 5px 15px rgba(0,0,0,.05);box-shadow:0 5px 15px rgba(0,0,0,.05)}.modal-sm{width:300px}.header{position:fixed;top:0;bottom:0;left:0;z-index:1000;display:block;padding:0;overflow-y:auto;border-right:1px solid #f6f6f6;width:4.16667%}.sidebar{position:fixed;top:0;bottom:0;left:0;display:block;padding:0;overflow-x:hidden;overflow-y:auto;border-right:1px solid #f6f6f6;width:33.33333%}.main{width:62.5%;padding-right:20px;padding-left:20px}.footer{position:fixed;left:0;bottom:0;background-color:transparent;z-index:1050;width:4.16667%}body.main-center .main{margin-left:4.16667%}body.main-left .sidebar{margin-right:4.16667%}body.main-right .sidebar{margin-left:4.16667%}body.main-right .main{margin-left:37.5%}body.no-sidebar.main-left .main{width:95.83333333%;margin-right:4.16667%}body.no-sidebar.main-center .main,body.no-sidebar.main-right .main{width:95.83333333%;margin-left:4.16667%}.header .navbar-header{float:none}#avatar img{padding:5px}.bar.bar-footer:before{width:-webkit-calc(100% + 40px);width:calc(100% + 40px);left:-20px}.header .social-links{display:none}}@media (min-width:992px){.container{width:970px}.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{float:left}.col-md-1{width:8.33333%}.col-md-2{width:16.66667%}.col-md-3{width:25%}.col-md-4{width:33.33333%}.col-md-5{width:41.66667%}.col-md-6{width:50%}.col-md-7{width:58.33333%}.col-md-8{width:66.66667%}.col-md-9{width:75%}.col-md-10{width:83.33333%}.col-md-11{width:91.66667%}.col-md-12{width:100%}.col-md-pull-0{right:auto}.col-md-pull-1{right:8.33333%}.col-md-pull-2{right:16.66667%}.col-md-pull-3{right:25%}.col-md-pull-4{right:33.33333%}.col-md-pull-5{right:41.66667%}.col-md-pull-6{right:50%}.col-md-pull-7{right:58.33333%}.col-md-pull-8{right:66.66667%}.col-md-pull-9{right:75%}.col-md-pull-10{right:83.33333%}.col-md-pull-11{right:91.66667%}.col-md-pull-12{right:100%}.col-md-push-0{left:auto}.col-md-push-1{left:8.33333%}.col-md-push-2{left:16.66667%}.col-md-push-3{left:25%}.col-md-push-4{left:33.33333%}.col-md-push-5{left:41.66667%}.col-md-push-6{left:50%}.col-md-push-7{left:58.33333%}.col-md-push-8{left:66.66667%}.col-md-push-9{left:75%}.col-md-push-10{left:83.33333%}.col-md-push-11{left:91.66667%}.col-md-push-12{left:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333%}.col-md-offset-2{margin-left:16.66667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333%}.col-md-offset-5{margin-left:41.66667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333%}.col-md-offset-8{margin-left:66.66667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333%}.col-md-offset-11{margin-left:91.66667%}.col-md-offset-12{margin-left:100%}.modal-lg{width:900px}.header{width:16.66667%}.sidebar{width:25%}.sidebar .slimContent{padding-right:25px;padding-left:25px}.main{width:58.33333%;padding-right:25px;padding-left:25px}.footer{width:16.66667%}body.main-center .main{margin-left:16.66667%}body.main-left .sidebar{margin-right:16.66667%}body.main-right .sidebar{margin-left:16.66667%}body.main-right .main{margin-left:41.66667%}body.no-sidebar.main-left .main{width:83.33333333%;margin-right:16.66667%}body.no-sidebar.main-center .main,body.no-sidebar.main-right .main{width:83.33333333%;margin-left:16.66667%}.bar.bar-footer:before{width:-webkit-calc(100% + 50px);width:calc(100% + 50px);left:-25px}.marked-body .headerlink:before,.marked-body .markdownIt-Anchor:before{display:inline-block;width:18px;content:\"#\";color:#0a6ebd;text-align:right;float:left;visibility:hidden}.marked-body .headerlink:before{margin-left:-15px;padding-right:2px}.marked-body .markdownIt-Anchor:before{margin-left:-20px}.marked-body h1:hover .headerlink:before,.marked-body h1:hover .markdownIt-Anchor:before,.marked-body h2:hover .headerlink:before,.marked-body h2:hover .markdownIt-Anchor:before,.marked-body h3:hover .headerlink:before,.marked-body h3:hover .markdownIt-Anchor:before,.marked-body h4:hover .headerlink:before,.marked-body h4:hover .markdownIt-Anchor:before,.marked-body h5:hover .headerlink:before,.marked-body h5:hover .markdownIt-Anchor:before,.marked-body h6:hover .headerlink:before,.marked-body h6:hover .markdownIt-Anchor:before{visibility:visible}}@media (min-width:1200px){.container{width:1170px}.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9{float:left}.col-lg-1{width:8.33333%}.col-lg-2{width:16.66667%}.col-lg-3{width:25%}.col-lg-4{width:33.33333%}.col-lg-5{width:41.66667%}.col-lg-6{width:50%}.col-lg-7{width:58.33333%}.col-lg-8{width:66.66667%}.col-lg-9{width:75%}.col-lg-10{width:83.33333%}.col-lg-11{width:91.66667%}.col-lg-12{width:100%}.col-lg-pull-0{right:auto}.col-lg-pull-1{right:8.33333%}.col-lg-pull-2{right:16.66667%}.col-lg-pull-3{right:25%}.col-lg-pull-4{right:33.33333%}.col-lg-pull-5{right:41.66667%}.col-lg-pull-6{right:50%}.col-lg-pull-7{right:58.33333%}.col-lg-pull-8{right:66.66667%}.col-lg-pull-9{right:75%}.col-lg-pull-10{right:83.33333%}.col-lg-pull-11{right:91.66667%}.col-lg-pull-12{right:100%}.col-lg-push-0{left:auto}.col-lg-push-1{left:8.33333%}.col-lg-push-2{left:16.66667%}.col-lg-push-3{left:25%}.col-lg-push-4{left:33.33333%}.col-lg-push-5{left:41.66667%}.col-lg-push-6{left:50%}.col-lg-push-7{left:58.33333%}.col-lg-push-8{left:66.66667%}.col-lg-push-9{left:75%}.col-lg-push-10{left:83.33333%}.col-lg-push-11{left:91.66667%}.col-lg-push-12{left:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333%}.col-lg-offset-2{margin-left:16.66667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333%}.col-lg-offset-5{margin-left:41.66667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333%}.col-lg-offset-8{margin-left:66.66667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333%}.col-lg-offset-11{margin-left:91.66667%}.col-lg-offset-12{margin-left:100%}.visible-lg{display:block!important}table.visible-lg{display:table!important}tr.visible-lg{display:table-row!important}td.visible-lg,th.visible-lg{display:table-cell!important}.visible-lg-block{display:block!important}.visible-lg-inline{display:inline!important}.visible-lg-inline-block{display:inline-block!important}.hidden-lg{display:none!important}.header{width:16.66667%}.sidebar{width:23%}.sidebar .slimContent{padding-right:30px;padding-left:30px}.main{width:60.33333%;padding-right:30px;padding-left:30px}.footer{width:16.66667%}body.main-center .main{margin-left:16.66667%}body.main-left .sidebar{margin-right:16.66667%}body.main-right .sidebar{margin-left:16.66667%}body.main-right .main{margin-left:39.66667%}body.no-sidebar.main-left .main{width:83.33333333%;margin-right:16.66667%}body.no-sidebar.main-center .main,body.no-sidebar.main-right .main{width:83.33333333%;margin-left:16.66667%}.main-nav>li>a{padding:10px 20px}.bar.bar-footer:before{width:-webkit-calc(100% + 60px);width:calc(100% + 60px);left:-30px}}@media (min-width:1440px){.header{width:16.66667%}.sidebar{width:21%}.main{width:62.33333%}.footer{width:16.66667%}body.main-center .main{margin-left:16.66667%}body.main-left .sidebar{margin-right:16.66667%}body.main-right .sidebar{margin-left:16.66667%}body.main-right .main{margin-left:37.66667%}body.no-sidebar.main-left .main{width:83.33333333%;margin-right:16.66667%}body.no-sidebar.main-center .main,body.no-sidebar.main-right .main{width:83.33333333%;margin-left:16.66667%}.header #title{font-size:15px}}@media (max-width:1199px){.main-nav>li>a{padding:6px 20px}.bar .pager li a span,.footer .copyright{display:none}}@media (max-width:767px){.navbar-nav .open .dropdown-menu{position:static;float:none;width:auto;margin-top:0;background-color:transparent;border:0;-webkit-box-shadow:none;box-shadow:none}.navbar-nav .open .dropdown-menu .dropdown-header,.navbar-nav .open .dropdown-menu>li>a{padding:5px 15px 5px 25px}.navbar-nav .open .dropdown-menu>li>a{line-height:21px}.navbar-nav .open .dropdown-menu>li>a:focus,.navbar-nav .open .dropdown-menu>li>a:hover{background-image:none}.navbar-form .form-group{margin-bottom:5px}.navbar-form .form-group:last-child{margin-bottom:0}.navbar-default .navbar-nav .open .dropdown-menu>li>a{color:#777}.navbar-default .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav .open .dropdown-menu>.active>a,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#ccc;background-color:transparent}.navbar-inverse .navbar-nav .open .dropdown-menu>.dropdown-header{border-color:#090909}.navbar-inverse .navbar-nav .open .dropdown-menu .divider{background-color:#090909}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:hover{color:#fff;background-color:#090909}.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#444;background-color:transparent}.visible-xs{display:block!important}table.visible-xs{display:table!important}tr.visible-xs{display:table-row!important}td.visible-xs,th.visible-xs{display:table-cell!important}.visible-xs-block{display:block!important}.visible-xs-inline{display:inline!important}.visible-xs-inline-block{display:inline-block!important}.hidden-xs{display:none!important}body{padding-top:53px}.list-circle-num,.list-square-num{margin:0 0 40px}.modal-xs-full .modal-content,.modal-xs-full .modal-dialog{height:100%;width:100%;margin:0;border-radius:0;-webkit-box-shadow:none;box-shadow:none}.modal-xs-full .modal-content .donate-box,.modal-xs-full .modal-dialog .donate-box{padding-top:50px}.highlight table:before{display:block;content:' ';height:38px;position:absolute;top:0;left:0;right:0;margin-left:-10px;margin-right:-10px;margin-top:-38px;background-color:#f6f6f6;border-top-left-radius:4px;border-top-right-radius:4px}.header{position:fixed;left:0;right:0;top:0;width:100%;z-index:1050}.header:after,.header:before{content:\" \";display:table}.header:after{clear:both}.sidebar{display:none}.main{min-height:auto}.main-nav>li>a{padding:10px 20px}.sidebar-form{border:0;margin:9px 45px 9px 0}.sidebar-form .input-group-btn .btn{color:#2196f3}.sidebar-form input[type=text]:focus{background-color:transparent}.sidebar-form input[type=text]:focus+.input-group-btn .btn{color:#2196f3;background-color:transparent}.header .navbar-toggle{position:absolute;top:0;right:0;margin-right:5px}.header .navbar-toggle .icon-bar{width:18px}.header .search{width:90%;float:right}.header .profile-block{padding:0;margin:10px 0;width:8.33333%;float:left}.header #avatar{width:32px;height:32px}.header #location,.header #name,.header #title{display:none}#main-navbar{position:absolute;width:100%;background-color:#fbfbfb;border-bottom:1px solid #f6f6f6;z-index:99}.main .content{min-height:auto}.sidebar-toc.in{position:fixed;top:50px;bottom:50px;z-index:9}.bar.bar-footer{top:auto!important;bottom:0!important}.footer{display:none;position:static}.footer .copyright{display:block}.social-links .tooltip{display:none!important;visibility:hidden}.theme-black .search input[type=text]:focus,.theme-blue .search input[type=text]:focus,.theme-green .search input[type=text]:focus,.theme-purple .search input[type=text]:focus{background-color:transparent}.theme-black .search input[type=text]:focus+.input-group-btn .btn,.theme-blue .search input[type=text]:focus+.input-group-btn .btn,.theme-green .search input[type=text]:focus+.input-group-btn .btn,.theme-purple .search input[type=text]:focus+.input-group-btn .btn{color:rgba(255,255,255,.5);background-color:transparent}.theme-black #main-navbar{background:#1a2433;background:-webkit-linear-gradient(left,#1a2433 0,#253449 80%,#253449 100%);background:-webkit-gradient(linear,left top,right top,from(#1a2433),color-stop(80%,#253449),to(#253449));background:linear-gradient(to right,#1a2433 0,#253449 80%,#253449 100%)}.theme-blue #main-navbar{background:#0062c5;background:-webkit-linear-gradient(left,#0062c5 0,#0073e6 80%,#0073e6 100%);background:-webkit-gradient(linear,left top,right top,from(#0062c5),color-stop(80%,#0073e6),to(#0073e6));background:linear-gradient(to right,#0062c5 0,#0073e6 80%,#0073e6 100%)}.theme-green #main-navbar{background:#08a283;background:-webkit-linear-gradient(left,#08a283 0,#0ac29d 80%,#0ac29d 100%);background:-webkit-gradient(linear,left top,right top,from(#08a283),color-stop(80%,#0ac29d),to(#0ac29d));background:linear-gradient(to right,#08a283 0,#0ac29d 80%,#0ac29d 100%)}.theme-purple #main-navbar{background:#494683;background:-webkit-linear-gradient(left,#494683 0,#555299 80%,#555299 100%);background:-webkit-gradient(linear,left top,right top,from(#494683),color-stop(80%,#555299),to(#555299));background:linear-gradient(to right,#494683 0,#555299 80%,#555299 100%)}}@media screen and (max-width:559px),screen and (max-height:479px){.ins-search-container{top:0;left:0;margin:0;width:100%;height:100%;background:#f7f7f7}}@media (max-width:480px){.header #avatar{width:24px;height:24px;margin-top:3px;margin-left:15px}}@media (min-width:768px) and (max-width:991px){.visible-sm{display:block!important}table.visible-sm{display:table!important}tr.visible-sm{display:table-row!important}td.visible-sm,th.visible-sm{display:table-cell!important}.visible-sm-block{display:block!important}.visible-sm-inline{display:inline!important}.visible-sm-inline-block{display:inline-block!important}.hidden-sm{display:none!important}.sidebar-form{display:none}.header .main-nav>li>a{text-align:center;padding-left:0;padding-right:0}.header .main-nav>li>a span{display:none}.header .profile-block{padding-top:10px;padding-left:0;padding-right:0}.header #avatar{width:32px;height:32px}.footer{padding-left:0;padding-right:0}.social-links{display:block;width:100%;text-align:center;margin-bottom:0}.social-links:after,.social-links:before{content:\" \";display:table}.social-links:after{clear:both}.social-links li{display:block;margin-left:0;margin-top:10px}.social-links li:after,.social-links li:before{content:\" \";display:table}.social-links li:after{clear:both}.social-links .tooltip{display:none!important;visibility:hidden}}@media (min-width:992px) and (max-width:1199px){.visible-md{display:block!important}table.visible-md{display:table!important}tr.visible-md{display:table-row!important}td.visible-md,th.visible-md{display:table-cell!important}.visible-md-block{display:block!important}.visible-md-inline{display:inline!important}.visible-md-inline-block{display:inline-block!important}.hidden-md{display:none!important}}@media print{*,:after,:before{background:0 0!important;color:#000!important;-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}a,a:visited{text-decoration:underline}a[href]:after{content:\" (\" attr(href) \")\"}abbr[title]:after{content:\" (\" attr(title) \")\"}a[href^=\"#\"]:after,a[href^=\"javascript:\"]:after{content:\"\"}blockquote,pre{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}.navbar{display:none}.btn>.caret,.dropup>.btn>.caret{border-top-color:#000!important}.label{border:1px solid #000}.table{border-collapse:collapse!important}.table td,.table th{background-color:#fff!important}.table-bordered td,.table-bordered th{border:1px solid #ddd!important}.visible-print{display:block!important}table.visible-print{display:table!important}tr.visible-print{display:table-row!important}td.visible-print,th.visible-print{display:table-cell!important}.visible-print-block{display:block!important}.visible-print-inline{display:inline!important}.visible-print-inline-block{display:inline-block!important}.hidden-print{display:none!important}}@media (max-device-width:480px) and (orientation:landscape){.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:200px}}"},{"title":"","date":"2022-06-24T17:19:04.512Z","updated":"2022-06-24T17:19:04.512Z","comments":true,"path":"js/application.min.js","permalink":"http://fyupeng.github.io/js/application.min.js","excerpt":"","text":"$(function(){$('[data-toggle=\"tooltip\"]').tooltip(),\"undefined\"!=typeof $.fn.slimScroll&&$(\".sidebar .slimContent\").slimScroll({height:$(window).height(),color:\"rgba(0,0,0,0.15)\",size:\"5px\",position:\"right\"}),$(\"#collapseToc\").on(\"shown.bs.collapse\",function(){\"undefined\"!=typeof $.fn.slimScroll&&$(\".sidebar .slimContent\").slimScroll().on(\"slimscroll\")}),$(\".geopattern\").each(function(){$(this).geopattern($(this).data(\"pattern-id\"))});$(\"#nav-main\").okayNav({swipe_enabled:!1});$(\"[data-stick-bottom]\").keepInView({fixed:!1,parentClass:\"has-sticky\",customClass:\"sticky\",trigger:\"bottom\",zindex:42,edgeOffset:0}),$(\"[data-stick-top]\").keepInView({fixed:!0,parentClass:\"has-sticky\",customClass:\"sticky\",trigger:\"top\",zindex:42,edgeOffset:0});var t=$(\"ul.main-nav\").hasClass(\"menu-highlight\");if(t){for(var e=location.pathname,i=$(\"ul.main-nav>li\"),a=-1,s=0,n=i.length;s-1||\"/\"===e&&(\"/.\"===o||\"/\"===o||\"index.html\"===o||\"/index.html\"===o))&&(a=s),$(i[s]).removeClass(\"active\")}i[a]&&$(i[a]).addClass(\"active\")}});"},{"title":"","date":"2022-06-24T17:19:04.513Z","updated":"2022-06-24T17:19:04.513Z","comments":true,"path":"js/insight.js","permalink":"http://fyupeng.github.io/js/insight.js","excerpt":"","text":"/** * Insight search plugin * @author PPOffice { @link https://github.com/ppoffice } */ (function ($, CONFIG) { var $main = $('.ins-search'); var $input = $main.find('.ins-search-input'); var $wrapper = $main.find('.ins-section-wrapper'); var $container = $main.find('.ins-section-container'); $main.parent().remove('.ins-search'); $('body').append($main); function section (title) { return $('').addClass('ins-section') .append($('').addClass('ins-section-header').text(title)); } function searchItem (icon, title, slug, preview, url) { return $('').addClass('ins-selectable').addClass('ins-search-item') .append($('').append($('').addClass('icon').addClass('icon-' + icon)).append(title != null && title != '' ? title : CONFIG.TRANSLATION['UNTITLED']) .append(slug ? $('').addClass('ins-slug').text(slug) : null)) .append(preview ? $('').addClass('ins-search-preview').text(preview) : null) .attr('data-url', url); } function sectionFactory (type, array) { var sectionTitle; var $searchItems; if (array.length === 0) return null; sectionTitle = CONFIG.TRANSLATION[type]; switch (type) { case 'POSTS': case 'PAGES': $searchItems = array.map(function (item) { // Use config.root instead of permalink to fix url issue return searchItem('file', item.title, null, item.text.slice(0, 150), CONFIG.ROOT_URL + item.path); }); break; case 'CATEGORIES': case 'TAGS': $searchItems = array.map(function (item) { return searchItem(type === 'CATEGORIES' ? 'folder' : 'tag', item.name, item.slug, null, item.permalink); }); break; default: return null; } return section(sectionTitle).append($searchItems); } function extractToSet (json, key) { var values = {}; var entries = json.pages.concat(json.posts); entries.forEach(function (entry) { if (entry[key]) { entry[key].forEach(function (value) { values[value.name] = value; }); } }); var result = []; for (var key in values) { result.push(values[key]); } return result; } function parseKeywords (keywords) { return keywords.split(' ').filter(function (keyword) { return !!keyword; }).map(function (keyword) { return keyword.toUpperCase(); }); } /** * Judge if a given post/page/category/tag contains all of the keywords. * @param Object obj Object to be weighted * @param Array fields Object's fields to find matches */ function filter (keywords, obj, fields) { var result = false; var keywordArray = parseKeywords(keywords); var containKeywords = keywordArray.filter(function (keyword) { var containFields = fields.filter(function (field) { if (!obj.hasOwnProperty(field)) return false; if (obj[field].toUpperCase().indexOf(keyword) > -1) return true; }); if (containFields.length > 0) return true; return false; }); return containKeywords.length === keywordArray.length; } function filterFactory (keywords) { return { POST: function (obj) { return filter(keywords, obj, ['title', 'text']); }, PAGE: function (obj) { return filter(keywords, obj, ['title', 'text']); }, CATEGORY: function (obj) { return filter(keywords, obj, ['name', 'slug']); }, TAG: function (obj) { return filter(keywords, obj, ['name', 'slug']); } }; } /** * Calculate the weight of a matched post/page/category/tag. * @param Object obj Object to be weighted * @param Array fields Object's fields to find matches * @param Array weights Weight of every field */ function weight (keywords, obj, fields, weights) { var value = 0; parseKeywords(keywords).forEach(function (keyword) { var pattern = new RegExp(keyword, 'img'); // Global, Multi-line, Case-insensitive fields.forEach(function (field, index) { if (obj.hasOwnProperty(field)) { var matches = obj[field].match(pattern); value += matches ? matches.length * weights[index] : 0; } }); }); return value; } function weightFactory (keywords) { return { POST: function (obj) { return weight(keywords, obj, ['title', 'text'], [3, 1]); }, PAGE: function (obj) { return weight(keywords, obj, ['title', 'text'], [3, 1]); }, CATEGORY: function (obj) { return weight(keywords, obj, ['name', 'slug'], [1, 1]); }, TAG: function (obj) { return weight(keywords, obj, ['name', 'slug'], [1, 1]); } }; } function search (json, keywords) { var WEIGHTS = weightFactory(keywords); var FILTERS = filterFactory(keywords); var posts = json.posts; var pages = json.pages; var tags = extractToSet(json, 'tags'); var categories = extractToSet(json, 'categories'); return { posts: posts.filter(FILTERS.POST).sort(function (a, b) { return WEIGHTS.POST(b) - WEIGHTS.POST(a); }).slice(0, 5), pages: pages.filter(FILTERS.PAGE).sort(function (a, b) { return WEIGHTS.PAGE(b) - WEIGHTS.PAGE(a); }).slice(0, 5), categories: categories.filter(FILTERS.CATEGORY).sort(function (a, b) { return WEIGHTS.CATEGORY(b) - WEIGHTS.CATEGORY(a); }).slice(0, 5), tags: tags.filter(FILTERS.TAG).sort(function (a, b) { return WEIGHTS.TAG(b) - WEIGHTS.TAG(a); }).slice(0, 5) }; } function searchResultToDOM (searchResult) { $container.empty(); for (var key in searchResult) { $container.append(sectionFactory(key.toUpperCase(), searchResult[key])); } } function scrollTo ($item) { if ($item.length === 0) return; var wrapperHeight = $wrapper[0].clientHeight; var itemTop = $item.position().top - $wrapper.scrollTop(); var itemBottom = $item[0].clientHeight + $item.position().top; if (itemBottom > wrapperHeight + $wrapper.scrollTop()) { $wrapper.scrollTop(itemBottom - $wrapper[0].clientHeight); } if (itemTop < 0) { $wrapper.scrollTop($item.position().top); } } function selectItemByDiff (value) { var $items = $.makeArray($container.find('.ins-selectable')); var prevPosition = -1; $items.forEach(function (item, index) { if ($(item).hasClass('active')) { prevPosition = index; return; } }); var nextPosition = ($items.length + prevPosition + value) % $items.length; $($items[prevPosition]).removeClass('active'); $($items[nextPosition]).addClass('active'); scrollTo($($items[nextPosition])); } function gotoLink ($item) { if ($item && $item.length) { location.href = $item.attr('data-url'); } } $.getJSON(CONFIG.CONTENT_URL, function (json) { if (location.hash.trim() === '#ins-search') { $main.addClass('show'); } $input.on('input', function () { var keywords = $(this).val(); searchResultToDOM(search(json, keywords)); }); $input.trigger('input'); }); $(document).on('click focus', '.search-form-input', function () { $main.addClass('show'); $main.find('.ins-search-input').focus(); }).on('click', '.ins-search-item', function () { gotoLink($(this)); }).on('click', '.ins-close', function () { $main.removeClass('show'); }).on('keydown', function (e) { if (!$main.hasClass('show')) return; switch (e.keyCode) { case 27: // ESC $main.removeClass('show'); break; case 38: // UP selectItemByDiff(-1); break; case 40: // DOWN selectItemByDiff(1); break; case 13: //ENTER gotoLink($container.find('.ins-selectable.active').eq(0)); break; } }); })(jQuery, window.INSIGHT_CONFIG);"},{"title":"","date":"2022-06-24T17:19:04.514Z","updated":"2022-06-24T17:19:04.514Z","comments":true,"path":"js/jquery.min.js","permalink":"http://fyupeng.github.io/js/jquery.min.js","excerpt":"","text":"/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */ !function(a,b){\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error(\"jQuery requires a window with a document\");return b(a)}:b(a)}(\"undefined\"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m=\"1.12.4\",n=function(a,b){return new n.fn.init(a,b)},o=/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g,p=/^-ms-/,q=/-([\\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:\"\",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for(\"boolean\"==typeof g&&(j=g,g=arguments[h]||{},h++),\"object\"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:\"jQuery\"+(m+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return\"function\"===n.type(a)},isArray:Array.isArray||function(a){return\"array\"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||\"object\"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,\"constructor\")&&!k.call(a.constructor.prototype,\"isPrototypeOf\"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+\"\":\"object\"==typeof a||\"function\"==typeof a?i[j.call(a)]||\"object\":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,\"ms-\").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?\"\":(a+\"\").replace(o,\"\")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,\"string\"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return\"string\"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),d=function(){return a.apply(b||this,c.concat(e.call(arguments)))},d.guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),\"function\"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(a,b){i[\"[object \"+b+\"]\"]=b.toLowerCase()});function s(a){var b=!!a&&\"length\"in a&&a.length,c=n.type(a);return\"function\"===c||n.isWindow(a)?!1:\"array\"===c||0===b||\"number\"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=\"sizzle\"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1"},{"title":"å‹æƒ…é“¾æŽ¥","date":"2022-06-24T18:09:11.563Z","updated":"2022-06-24T18:09:11.563Z","comments":true,"path":"links/index.html","permalink":"http://fyupeng.github.io/links/index.html","excerpt":"","text":""},{"title":"","date":"2022-06-24T18:07:49.466Z","updated":"2022-06-24T18:07:49.466Z","comments":true,"path":"js/plugin.js","permalink":"http://fyupeng.github.io/js/plugin.js","excerpt":"","text":"/** * baiduTemplateç®€å•å¥½ç”¨çš„Javascriptæ¨¡æ¿å¼•æ“Ž 1.0.6 ç‰ˆæœ¬ * http://baidufe.github.com/BaiduTemplate * å¼€æºåè®®ï¼šBSD License * æµè§ˆå™¨çŽ¯å¢ƒå ç”¨å‘½åç©ºé—´ baidu.template ï¼ŒnodejsçŽ¯å¢ƒç›´æŽ¥å®‰è£… npm install baidutemplate * @param str{String} domç»“ç‚¹IDï¼Œæˆ–è€…æ¨¡æ¿string * @param data{Object} éœ€è¦æ¸²æŸ“çš„jsonå¯¹è±¡ï¼Œå¯ä»¥ä¸ºç©ºã€‚å½“dataä¸º{}æ—¶ï¼Œä»ç„¶è¿”å›žhtmlã€‚ * @return å¦‚æžœæ— dataï¼Œç›´æŽ¥è¿”å›žç¼–è¯‘åŽçš„å‡½æ•°ï¼›å¦‚æžœæœ‰dataï¼Œè¿”å›žhtmlã€‚ * @author wangxiao * @email 1988wangxiao@gmail.com */ ;(function(window){ //å–å¾—æµè§ˆå™¨çŽ¯å¢ƒçš„baiduå‘½åç©ºé—´ï¼Œéžæµè§ˆå™¨çŽ¯å¢ƒç¬¦åˆcommonjsè§„èŒƒexportså‡ºåŽ» //ä¿®æ­£åœ¨nodejsçŽ¯å¢ƒä¸‹ï¼Œé‡‡ç”¨baidu.templateå˜é‡å var baidu = typeof module === 'undefined' ? (window.baidu = window.baidu || {}) : module.exports; //æ¨¡æ¿å‡½æ•°ï¼ˆæ”¾ç½®äºŽbaidu.templateå‘½åç©ºé—´ä¸‹ï¼‰ baidu.template = function(str, data){ //æ£€æŸ¥æ˜¯å¦æœ‰è¯¥idçš„å…ƒç´ å­˜åœ¨ï¼Œå¦‚æžœæœ‰å…ƒç´ åˆ™èŽ·å–å…ƒç´ çš„innerHTML/valueï¼Œå¦åˆ™è®¤ä¸ºå­—ç¬¦ä¸²ä¸ºæ¨¡æ¿ var fn = (function(){ //åˆ¤æ–­å¦‚æžœæ²¡æœ‰documentï¼Œåˆ™ä¸ºéžæµè§ˆå™¨çŽ¯å¢ƒ if(!window.document){ return bt._compile(str); }; //HTML5è§„å®šIDå¯ä»¥ç”±ä»»ä½•ä¸åŒ…å«ç©ºæ ¼å­—ç¬¦çš„å­—ç¬¦ä¸²ç»„æˆ var element = document.getElementById(str); if (element) { //å–åˆ°å¯¹åº”idçš„domï¼Œç¼“å­˜å…¶ç¼–è¯‘åŽçš„HTMLæ¨¡æ¿å‡½æ•° if (bt.cache[str]) { return bt.cache[str]; }; //textareaæˆ–inputåˆ™å–valueï¼Œå…¶å®ƒæƒ…å†µå–innerHTML var html = /^(textarea|input)$/i.test(element.nodeName) ? element.value : element.innerHTML; return bt._compile(html); }else{ //æ˜¯æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªå‡½æ•° //å¦‚æžœç›´æŽ¥ä¼ å…¥å­—ç¬¦ä¸²ä½œä¸ºæ¨¡æ¿ï¼Œåˆ™å¯èƒ½å˜åŒ–è¿‡å¤šï¼Œå› æ­¤ä¸è€ƒè™‘ç¼“å­˜ return bt._compile(str); }; })(); //æœ‰æ•°æ®åˆ™è¿”å›žHTMLå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰æ•°æ®åˆ™è¿”å›žå‡½æ•° æ”¯æŒdata={}çš„æƒ…å†µ var result = bt._isObject(data) ? fn( data ) : fn; fn = null; return result; }; //å–å¾—å‘½åç©ºé—´ baidu.template var bt = baidu.template; //æ ‡è®°å½“å‰ç‰ˆæœ¬ bt.versions = bt.versions || []; bt.versions.push('1.0.6'); //ç¼“å­˜ å°†å¯¹åº”idæ¨¡æ¿ç”Ÿæˆçš„å‡½æ•°ç¼“å­˜ä¸‹æ¥ã€‚ bt.cache = {}; //è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå¯ä»¥å«æœ‰æ­£åˆ™ä¸­çš„å­—ç¬¦ï¼Œå¯ä»¥æ˜¯HTMLæ³¨é‡Šå¼€å¤´ bt.LEFT_DELIMITER = bt.LEFT_DELIMITER||'{ %'; bt.RIGHT_DELIMITER = bt.RIGHT_DELIMITER||'% }'; //è‡ªå®šä¹‰é»˜è®¤æ˜¯å¦è½¬ä¹‰ï¼Œé»˜è®¤ä¸ºé»˜è®¤è‡ªåŠ¨è½¬ä¹‰ bt.ESCAPE = true; //HTMLè½¬ä¹‰ bt._encodeHTML = function (source) { return String(source) .replace(/&/g,'&amp;') .replace(//g,'&gt;') .replace(/\\\\/g,'&#92;') .replace(/\"/g,'&quot;') .replace(/'/g,'&#39;'); }; //è½¬ä¹‰å½±å“æ­£åˆ™çš„å­—ç¬¦ bt._encodeReg = function (source) { return String(source).replace(/([.*+?^=!:${}()|[\\]/\\\\])/g,'\\\\$1'); }; //è½¬ä¹‰UI UIå˜é‡ä½¿ç”¨åœ¨HTMLé¡µé¢æ ‡ç­¾onclickç­‰äº‹ä»¶å‡½æ•°å‚æ•°ä¸­ bt._encodeEventHTML = function (source) { return String(source) .replace(/&/g,'&amp;') .replace(//g,'&gt;') .replace(/\"/g,'&quot;') .replace(/'/g,'&#39;') .replace(/\\\\\\\\/g,'\\\\') .replace(/\\\\\\//g,'\\/') .replace(/\\\\n/g,'\\n') .replace(/\\\\r/g,'\\r'); }; //å°†å­—ç¬¦ä¸²æ‹¼æŽ¥ç”Ÿæˆå‡½æ•°ï¼Œå³ç¼–è¯‘è¿‡ç¨‹(compile) bt._compile = function(str){ var funBody = \"var _template_fun_array=[];\\nvar fn=(function(__data__){\\nvar _template_varName='';\\nfor(name in __data__){\\n_template_varName+=('var '+name+'=__data__[\\\"'+name+'\\\"];');\\n};\\neval(_template_varName);\\n_template_fun_array.push('\"+bt._analysisStr(str)+\"');\\n_template_varName=null;\\n})(_template_object);\\nfn = null;\\nreturn _template_fun_array.join('');\\n\"; return new Function(\"_template_object\",funBody); }; //åˆ¤æ–­æ˜¯å¦æ˜¯Objectç±»åž‹ bt._isObject = function (source) { return 'function' === typeof source || !!(source && 'object' === typeof source); }; //è§£æžæ¨¡æ¿å­—ç¬¦ä¸² bt._analysisStr = function(str){ //å–å¾—åˆ†éš”ç¬¦ var _left_ = bt.LEFT_DELIMITER; var _right_ = bt.RIGHT_DELIMITER; //å¯¹åˆ†éš”ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œæ”¯æŒæ­£åˆ™ä¸­çš„å…ƒå­—ç¬¦ï¼Œå¯ä»¥æ˜¯HTMLæ³¨é‡Š var _left = bt._encodeReg(_left_); var _right = bt._encodeReg(_right_); str = String(str) //åŽ»æŽ‰åˆ†éš”ç¬¦ä¸­jsæ³¨é‡Š .replace(new RegExp(\"(\"+_left+\"[^\"+_right+\"]*)//.*\\n\",\"g\"), \"$1\") //åŽ»æŽ‰æ³¨é‡Šå†…å®¹ //é»˜è®¤æ”¯æŒHTMLæ³¨é‡Šï¼Œå°†HTMLæ³¨é‡ŠåŒ¹é…æŽ‰çš„åŽŸå› æ˜¯ç”¨æˆ·æœ‰å¯èƒ½ç”¨ æ¥åšåˆ†å‰²ç¬¦ .replace(new RegExp(\"\", \"g\"),\"\") .replace(new RegExp(_left+\"\\\\*.*?\\\\*\"+_right, \"g\"),\"\") //æŠŠæ‰€æœ‰æ¢è¡ŒåŽ»æŽ‰ \\rå›žè½¦ç¬¦ \\tåˆ¶è¡¨ç¬¦ \\næ¢è¡Œç¬¦ .replace(new RegExp(\"[\\\\r\\\\t\\\\n]\",\"g\"), \"\") //ç”¨æ¥å¤„ç†éžåˆ†éš”ç¬¦å†…éƒ¨çš„å†…å®¹ä¸­å«æœ‰ æ–œæ  \\ å•å¼•å· â€˜ ï¼Œå¤„ç†åŠžæ³•ä¸ºHTMLè½¬ä¹‰ .replace(new RegExp(_left+\"(?:(?!\"+_right+\")[\\\\s\\\\S])*\"+_right+\"|((?:(?!\"+_left+\")[\\\\s\\\\S])+)\",\"g\"),function (item, $1) { var str = ''; if($1){ //å°† æ–œæ  å•å¼• HTMLè½¬ä¹‰ str = $1.replace(/\\\\/g,\"&#92;\").replace(/'/g,'&#39;'); while(/\"+8*h+\")\");for(c.getLengthInBits()+4=8*h)&&(c.put(o,8),!(c.getLengthInBits()>=8*h));)c.put(a,8);return C(c,n)};return w.addData=function(r){var t=c(r);p.push(t),v=null},w.isDark=function(r,t){if(0>r||r>=d||0>t||t>=d)throw new Error(r+\",\"+t);return h[r][t]},w.getModuleCount=function(){return d},w.make=function(){m(!1,y())},w.createTableTag=function(r,t){r=r||2,t=\"undefined\"==typeof t?4*r:t;var e=\"\";e+='',e+=\"\";for(var n=0;nt&&e>=n&&o>e){var i=Math.floor((t-n)/r),a=Math.floor((e-n)/r);return w.isDark(a,i)?0:1}return 1})},w};t.stringToBytes=function(r){for(var t=new Array,e=0;e>=1;return t};return f.getBCHTypeInfo=function(r){for(var t=r=t))for(var f=-1;1>=f;f+=1)0>o+f||o+f>=t||(0!=u||0!=f)&&a==r.isDark(n+u,o+f)&&(i+=1);i>5&&(e+=3+i-5)}for(var n=0;t-1>n;n+=1)for(var o=0;t-1>o;o+=1){var c=0;r.isDark(n,o)&&(c+=1),r.isDark(n+1,o)&&(c+=1),r.isDark(n,o+1)&&(c+=1),r.isDark(n+1,o+1)&&(c+=1),(0==c||4==c)&&(e+=3)}for(var n=0;t>n;n+=1)for(var o=0;t-6>o;o+=1)r.isDark(n,o)&&!r.isDark(n,o+1)&&r.isDark(n,o+2)&&r.isDark(n,o+3)&&r.isDark(n,o+4)&&!r.isDark(n,o+5)&&r.isDark(n,o+6)&&(e+=40);for(var o=0;t>o;o+=1)for(var n=0;t-6>n;n+=1)r.isDark(n,o)&&!r.isDark(n+1,o)&&r.isDark(n+2,o)&&r.isDark(n+3,o)&&r.isDark(n+4,o)&&!r.isDark(n+5,o)&&r.isDark(n+6,o)&&(e+=40);for(var s=0,o=0;t>o;o+=1)for(var n=0;t>n;n+=1)r.isDark(n,o)&&(s+=1);var l=Math.abs(100*s/t/t-50)/5;return e+=10*l},f}(),a=function(){for(var r=new Array(256),t=new Array(256),e=0;8>e;e+=1)r[e]=1e;e+=1)t[r[e]]=e;var n={};return n.glog=function(r){if(1>r)throw new Error(\"glog(\"+r+\")\");return t[r]},n.gexp=function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return r[t]},n}(),u=function(){var r=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t=function(r,t){var e={};return e.totalCount=r,e.dataCount=t,e},e={},o=function(t,e){switch(e){case n.L:return r[4*(t-1)+0];case n.M:return r[4*(t-1)+1];case n.Q:return r[4*(t-1)+2];case n.H:return r[4*(t-1)+3];default:return}};return e.getRSBlocks=function(r,e){var n=o(r,e);if(\"undefined\"==typeof n)throw new Error(\"bad rs block @ typeNumber:\"+r+\"/errorCorrectLevel:\"+e);for(var i=n.length/3,a=new Array,u=0;i>u;u+=1)for(var f=n[3*u+0],c=n[3*u+1],s=n[3*u+2],l=0;f>l;l+=1)a.push(t(c,s));return a},e}(),f=function(){var r=new Array,t=0,e={};return e.getBuffer=function(){return r},e.getAt=function(t){var e=Math.floor(t/8);return 1==(r[e]>>>7-t%8&1)},e.put=function(r,t){for(var n=0;t>n;n+=1)e.putBit(1==(r>>>t-n-1&1))},e.getLengthInBits=function(){return t},e.putBit=function(e){var n=Math.floor(t/8);r.length>>t%8),t+=1},e},c=function(r){var n=e.MODE_8BIT_BYTE,o=t.stringToBytes(r),i={};return i.getMode=function(){return n},i.getLength=function(r){return o.length},i.write=function(r){for(var t=0;t>>8)},t.writeBytes=function(r,e,n){e=e||0,n=n||r.length;for(var o=0;n>o;o+=1)t.writeByte(r[o+e])},t.writeString=function(r){for(var e=0;er);else{if(26>r)return 65+r;if(52>r)return 97+(r-26);if(62>r)return 48+(r-52);if(62==r)return 43;if(63==r)return 47}throw new Error(\"n:\"+r)};return o.writeByte=function(n){for(r=r>>t-6),t-=6},o.flush=function(){if(t>0&&(i(ro;){if(e>=t.length){if(0==o)return-1;throw new Error(\"unexpected end of file./\"+o)}var r=t.charAt(e);if(e+=1,\"=\"==r)return o=0,-1;r.match(/^\\s$/)||(n=n>o-8&255;return o-=8,i};var a=function(r){if(r>=65&&90>=r)return r-65;if(r>=97&&122>=r)return r-97+26;if(r>=48&&57>=r)return r-48+52;if(43==r)return 62;if(47==r)return 63;throw new Error(\"c:\"+r)};return i},d=function(r,t){var e=r,n=t,o=new Array(r*t),i={};i.setPixel=function(r,t,n){o[t*e+r]=n},i.write=function(r){r.writeString(\"GIF87a\"),r.writeShort(e),r.writeShort(n),r.writeByte(128),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(255),r.writeByte(255),r.writeByte(255),r.writeString(\",\"),r.writeShort(0),r.writeShort(0),r.writeShort(e),r.writeShort(n),r.writeByte(0);var t=2,o=u(t);r.writeByte(t);for(var i=0;o.length-i>255;)r.writeByte(255),r.writeBytes(o,i,255),i+=255;r.writeByte(o.length-i),r.writeBytes(o,i,o.length-i),r.writeByte(0),r.writeString(\";\")};var a=function(r){var t=r,e=0,n=0,o={};return o.write=function(r,o){if(r>>>o!=0)throw new Error(\"length over\");for(;e+o>=8;)t.writeByte(255&(r>=8-e,n=0,e=0;n|=r12,128|n>>6&63,128|63&n):(e++,n=65536+((1023&n)18,128|n>>12&63,128|n>>6&63,128|63&n))}return t}return t(r)}}(r),r}()),function(r){r.fn.share=function(t){function e(t,e){var n=o(e);\"prepend\"==e.mode?n.reverse():n,n.length&&r.each(n,function(n,o){var a=i(o,e),u=e.initialized?t.find(\".icon-\"+o):r('');return!u.length||(u.prop(\"aria-label\",\"åˆ†äº«åˆ° \"+h[o]),u.prop(\"href\",a),\"wechat\"===o?u.prop(\"tabindex\",-1):u.prop(\"target\",\"_blank\"),void(e.initialized||(\"prepend\"==e.mode?t.prepend(u):t.append(u))))})}function n(r,t){var e=r.find(\"a.icon-wechat\");e.length&&(e.append(''+t.wechatQrcodeTitle+''+t.wechatQrcodeHelper+\"\"),e.find(\".qrcode\").qrcode({render:\"image\",size:t.wechatQrcodeSize,text:t.url}),e.offset().top"},{"title":"Repositories","date":"2022-06-25T04:52:51.994Z","updated":"2022-06-25T04:52:51.994Z","comments":false,"path":"repository/index.html","permalink":"http://fyupeng.github.io/repository/index.html","excerpt":"","text":""},{"title":"","date":"2022-06-24T18:11:07.170Z","updated":"2022-06-24T18:11:07.170Z","comments":true,"path":"js/plugin.min.js","permalink":"http://fyupeng.github.io/js/plugin.min.js","excerpt":"","text":"!function(t){var e=\"undefined\"==typeof module?t.baidu=t.baidu||{}:module.exports;e.template=function(e,n){var o=function(){if(!t.document)return i._compile(e);var n=document.getElementById(e);if(n){if(i.cache[e])return i.cache[e];var o=/^(textarea|input)$/i.test(n.nodeName)?n.value:n.innerHTML;return i._compile(o)}return i._compile(e)}(),r=i._isObject(n)?o(n):o;return o=null,r};var i=e.template;i.versions=i.versions||[],i.versions.push(\"1.0.6\"),i.cache={},i.LEFT_DELIMITER=i.LEFT_DELIMITER||\"{ %\",i.RIGHT_DELIMITER=i.RIGHT_DELIMITER||\"% }\",i.ESCAPE=!0,i._encodeHTML=function(t){return String(t).replace(/&/g,\"&amp;\").replace(//g,\"&gt;\").replace(/\\\\/g,\"&#92;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\")},i._encodeReg=function(t){return String(t).replace(/([.*+?^=!:${}()|[\\]\\/\\\\])/g,\"\\\\$1\")},i._encodeEventHTML=function(t){return String(t).replace(/&/g,\"&amp;\").replace(//g,\"&gt;\").replace(/\"/g,\"&quot;\").replace(/'/g,\"&#39;\").replace(/\\\\\\\\/g,\"\\\\\").replace(/\\\\\\//g,\"/\").replace(/\\\\n/g,\"\\n\").replace(/\\\\r/g,\"\\r\")},i._compile=function(t){var e=\"var _template_fun_array=[];\\nvar fn=(function(__data__){\\nvar _template_varName='';\\nfor(name in __data__){\\n_template_varName+=('var '+name+'=__data__[\\\"'+name+'\\\"];');\\n};\\neval(_template_varName);\\n_template_fun_array.push('\"+i._analysisStr(t)+\"');\\n_template_varName=null;\\n})(_template_object);\\nfn = null;\\nreturn _template_fun_array.join('');\\n\";return new Function(\"_template_object\",e)},i._isObject=function(t){return\"function\"==typeof t||!(!t||\"object\"!=typeof t)},i._analysisStr=function(t){var e=i.LEFT_DELIMITER,n=i.RIGHT_DELIMITER,o=i._encodeReg(e),r=i._encodeReg(n);return t=String(t).replace(new RegExp(\"(\"+o+\"[^\"+r+\"]*)//.*\\n\",\"g\"),\"$1\").replace(new RegExp(\"\",\"g\"),\"\").replace(new RegExp(o+\"\\\\*.*?\\\\*\"+r,\"g\"),\"\").replace(new RegExp(\"[\\\\r\\\\t\\\\n]\",\"g\"),\"\").replace(new RegExp(o+\"(?:(?!\"+r+\")[\\\\s\\\\S])*\"+r+\"|((?:(?!\"+o+\")[\\\\s\\\\S])+)\",\"g\"),function(t,e){var i=\"\";if(e)for(i=e.replace(/\\\\/g,\"&#92;\").replace(/'/g,\"&#39;\");/i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}var i,n,o,r=t.h,s=t.s,a=t.l;if(0===s)i=n=o=a;else{var l=.5>a?a*(1+s):a+s-a*s,h=2*a-l;i=e(h,l,r+1/3),n=e(h,l,r),o=e(h,l,r-1/3)}return{r:Math.round(255*i),g:Math.round(255*n),b:Math.round(255*o)}}e.exports={hex2rgb:i,rgb2hex:n,rgb2hsl:o,hsl2rgb:r,rgb2rgbString:function(t){return\"rgb(\"+[t.r,t.g,t.b].join(\",\")+\")\"}}},{}],3:[function(t,e){!function(i){\"use strict\";function n(t){return function(e,i){return\"object\"==typeof e&&(i=e,e=null),(null===e||void 0===e)&&(e=(new Date).toString()),i||(i={}),t.call(this,e,i)}}var o=t(\"./pattern\"),r=e.exports={generate:n(function(t,e){return new o(t,e)})};i&&(i.fn.geopattern=n(function(t,e){return this.each(function(){var n=i(this).attr(\"data-title-sha\");n&&(e=i.extend({hash:n},e));var o=r.generate(t,e);i(this).css(\"background-image\",o.toDataUrl())})}))}(\"undefined\"!=typeof jQuery?jQuery:null)},{\"./pattern\":4}],4:[function(t,e){(function(i){\"use strict\";function n(t,e,i){return parseInt(t.substr(e,i||1),16)}function o(t,e,i,n,o){var r=parseFloat(t),s=i-e,a=o-n;return(r-e)*a/s+n}function r(t){return t%2===0?k:_}function s(t){return o(t,0,15,S,I)}function a(t){var e=t,i=e/2,n=Math.sin(60*Math.PI/180)*e;return[0,n,i,0,i+e,0,2*e,n,i+e,2*n,i,2*n,0,n].join(\",\")}function l(t,e){var i=.66*e;return[[0,0,t/2,e-i,t/2,e,0,i,0,0],[t/2,e-i,t,0,t,i,t/2,e,t/2,e-i]].map(function(t){return t.join(\",\")})}function h(t){return[[t,0,t,3*t],[0,t,3*t,t]]}function c(t){var e=t,i=.33*e;return[i,0,e-i,0,e,i,e,e-i,e-i,e,i,e,0,e-i,0,i,i,0].join(\",\")}function u(t,e){var i=t/2;return[i,0,t,e,0,e,i,0].join(\",\")}function f(t,e){return[t/2,0,t,e/2,t/2,e,0,e/2].join(\",\")}function p(t){return[0,0,t,t,0,t,0,0].join(\",\")}function d(t,e,i,n,o){var a=p(n),l=s(o[0]),h=r(o[0]),c={stroke:E,\"stroke-opacity\":x,\"fill-opacity\":l,fill:h};t.polyline(a,c).transform({translate:[e+n,i],scale:[-1,1]}),t.polyline(a,c).transform({translate:[e+n,i+2*n],scale:[1,-1]}),l=s(o[1]),h=r(o[1]),c={stroke:E,\"stroke-opacity\":x,\"fill-opacity\":l,fill:h},t.polyline(a,c).transform({translate:[e+n,i+2*n],scale:[-1,-1]}),t.polyline(a,c).transform({translate:[e+n,i],scale:[1,1]})}function g(t,e,i,n,o){var a=s(o),l=r(o),h=p(n),c={stroke:E,\"stroke-opacity\":x,\"fill-opacity\":a,fill:l};t.polyline(h,c).transform({translate:[e,i+n],scale:[1,-1]}),t.polyline(h,c).transform({translate:[e+2*n,i+n],scale:[-1,-1]}),t.polyline(h,c).transform({translate:[e,i+n],scale:[1,1]}),t.polyline(h,c).transform({translate:[e+2*n,i+n],scale:[-1,1]})}function v(t,e){var i=t/2;return[0,0,e,i,0,t,0,0].join(\",\")}var m=t(\"extend\"),y=t(\"./color\"),b=t(\"./sha1\"),w=t(\"./svg\"),T={baseColor:\"#933c3c\"},C=[\"octogons\",\"overlappingCircles\",\"plusSigns\",\"xes\",\"sineWaves\",\"hexagons\",\"overlappingRings\",\"plaid\",\"triangles\",\"squares\",\"concentricCircles\",\"diamonds\",\"tessellation\",\"nestedSquares\",\"mosaicSquares\",\"chevrons\"],_=\"#222\",k=\"#ddd\",E=\"#000\",x=.02,S=.02,I=.15,A=e.exports=function(t,e){return this.opts=m({},T,e),this.hash=e.hash||b(t),this.svg=new w,this.generateBackground(),this.generatePattern(),this};A.prototype.toSvg=function(){return this.svg.toString()},A.prototype.toString=function(){return this.toSvg()},A.prototype.toBase64=function(){var t,e=this.toSvg();return t=\"undefined\"!=typeof window&&\"function\"==typeof window.btoa?window.btoa(e):new i(e).toString(\"base64\")},A.prototype.toDataUri=function(){return\"data:image/svg+xml;base64,\"+this.toBase64()},A.prototype.toDataUrl=function(){return'url(\"'+this.toDataUri()+'\")'},A.prototype.generateBackground=function(){var t,e,i,r;this.opts.color?i=y.hex2rgb(this.opts.color):(e=o(n(this.hash,14,3),0,4095,0,359),r=n(this.hash,17),t=y.rgb2hsl(y.hex2rgb(this.opts.baseColor)),t.h=(360*t.h-e+360)%360/360,t.s=r%2===0?Math.min(1,(100*t.s+r)/100):Math.max(0,(100*t.s-r)/100),i=y.hsl2rgb(t)),this.color=y.rgb2hex(i),this.svg.rect(0,0,\"100%\",\"100%\",{fill:y.rgb2rgbString(i)})},A.prototype.generatePattern=function(){var t=this.opts.generator;if(t){if(C.indexOf(t)f;f++)for(u=0;6>u;u++)c=n(this.hash,i),t=u%2===0?f*g:f*g+g/2,l=s(c),e=r(c),h={fill:e,\"fill-opacity\":l,stroke:E,\"stroke-opacity\":x},this.svg.polyline(m,h).transform({translate:[u*d*1.5-v/2,t-g/2]}),0===u&&this.svg.polyline(m,h).transform({translate:[6*d*1.5-v/2,t-g/2]}),0===f&&(t=u%2===0?6*g:6*g+g/2,this.svg.polyline(m,h).transform({translate:[u*d*1.5-v/2,t-g/2]})),0===u&&0===f&&this.svg.polyline(m,h).transform({translate:[6*d*1.5-v/2,5*g+g/2]}),i++},A.prototype.geoSineWaves=function(){var t,e,i,a,l,h,c,u=Math.floor(o(n(this.hash,0),0,15,100,400)),f=Math.floor(o(n(this.hash,1),0,15,30,100)),p=Math.floor(o(n(this.hash,2),0,15,3,30));for(this.svg.setWidth(u),this.svg.setHeight(36*p),e=0;36>e;e++)h=n(this.hash,e),i=s(h),t=r(h),c=u/4*.7,l={fill:\"none\",stroke:t,opacity:i,\"stroke-width\":\"\"+p+\"px\"},a=\"M0 \"+f+\" C \"+c+\" 0, \"+(u/2-c)+\" 0, \"+u/2+\" \"+f+\" S \"+(u-c)+\" \"+2*f+\", \"+u+\" \"+f+\" S \"+(1.5*u-c)+\" 0, \"+1.5*u+\", \"+f,this.svg.path(a,l).transform({translate:[-u/4,p*e-1.5*f]}),this.svg.path(a,l).transform({translate:[-u/4,p*e-1.5*f+36*p]})},A.prototype.geoChevrons=function(){var t,e,i,a,h,c,u,f=o(n(this.hash,0),0,15,30,80),p=o(n(this.hash,0),0,15,30,80),d=l(f,p);for(this.svg.setWidth(6*f),this.svg.setHeight(6*p*.66),e=0,u=0;6>u;u++)for(c=0;6>c;c++)h=n(this.hash,e),i=s(h),t=r(h),a={stroke:E,\"stroke-opacity\":x,fill:t,\"fill-opacity\":i,\"stroke-width\":1},this.svg.group(a).transform({translate:[c*f,u*p*.66-p/2]}).polyline(d).end(),0===u&&this.svg.group(a).transform({translate:[c*f,6*p*.66-p/2]}).polyline(d).end(),e+=1},A.prototype.geoPlusSigns=function(){var t,e,i,a,l,c,u,f,p=o(n(this.hash,0),0,15,10,25),d=3*p,g=h(p);for(this.svg.setWidth(12*p),this.svg.setHeight(12*p),i=0,f=0;6>f;f++)for(u=0;6>u;u++)c=n(this.hash,i),a=s(c),e=r(c),t=f%2===0?0:1,l={fill:e,stroke:E,\"stroke-opacity\":x,\"fill-opacity\":a},this.svg.group(l).transform({translate:[u*d-u*p+t*p-p,f*d-f*p-d/2]}).rect(g).end(),0===u&&this.svg.group(l).transform({translate:[4*d-u*p+t*p-p,f*d-f*p-d/2]}).rect(g).end(),0===f&&this.svg.group(l).transform({translate:[u*d-u*p+t*p-p,4*d-f*p-d/2]}).rect(g).end(),0===u&&0===f&&this.svg.group(l).transform({translate:[4*d-u*p+t*p-p,4*d-f*p-d/2]}).rect(g).end(),i++},A.prototype.geoXes=function(){var t,e,i,a,l,c,u,f,p=o(n(this.hash,0),0,15,10,25),d=h(p),g=3*p*.943;for(this.svg.setWidth(3*g),this.svg.setHeight(3*g),i=0,f=0;6>f;f++)for(u=0;6>u;u++)c=n(this.hash,i),a=s(c),t=u%2===0?f*g-.5*g:f*g-.5*g+g/4,e=r(c),l={fill:e,opacity:a},this.svg.group(l).transform({translate:[u*g/2-g/2,t-f*g/2],rotate:[45,g/2,g/2]}).rect(d).end(),0===u&&this.svg.group(l).transform({translate:[6*g/2-g/2,t-f*g/2],rotate:[45,g/2,g/2]}).rect(d).end(),0===f&&(t=u%2===0?6*g-g/2:6*g-g/2+g/4,this.svg.group(l).transform({translate:[u*g/2-g/2,t-6*g/2],rotate:[45,g/2,g/2]}).rect(d).end()),5===f&&this.svg.group(l).transform({translate:[u*g/2-g/2,t-11*g/2],rotate:[45,g/2,g/2]}).rect(d).end(),0===u&&0===f&&this.svg.group(l).transform({translate:[6*g/2-g/2,t-6*g/2],rotate:[45,g/2,g/2]}).rect(d).end(),i++},A.prototype.geoOverlappingCircles=function(){var t,e,i,a,l,h,c,u=n(this.hash,0),f=o(u,0,15,25,200),p=f/2;for(this.svg.setWidth(6*p),this.svg.setHeight(6*p),e=0,c=0;6>c;c++)for(h=0;6>h;h++)l=n(this.hash,e),i=s(l),t=r(l),a={fill:t,opacity:i},this.svg.circle(h*p,c*p,p,a),0===h&&this.svg.circle(6*p,c*p,p,a),0===c&&this.svg.circle(h*p,6*p,p,a),0===h&&0===c&&this.svg.circle(6*p,6*p,p,a),e++},A.prototype.geoOctogons=function(){var t,e,i,a,l,h,u=o(n(this.hash,0),0,15,10,60),f=c(u);for(this.svg.setWidth(6*u),this.svg.setHeight(6*u),e=0,h=0;6>h;h++)for(l=0;6>l;l++)a=n(this.hash,e),i=s(a),t=r(a),this.svg.polyline(f,{fill:t,\"fill-opacity\":i,stroke:E,\"stroke-opacity\":x}).transform({translate:[l*u,h*u]}),e+=1},A.prototype.geoSquares=function(){var t,e,i,a,l,h,c=o(n(this.hash,0),0,15,10,60);for(this.svg.setWidth(6*c),this.svg.setHeight(6*c),e=0,h=0;6>h;h++)for(l=0;6>l;l++)a=n(this.hash,e),i=s(a),t=r(a),this.svg.rect(l*c,h*c,c,c,{fill:t,\"fill-opacity\":i,stroke:E,\"stroke-opacity\":x}),e+=1},A.prototype.geoConcentricCircles=function(){var t,e,i,a,l,h,c=n(this.hash,0),u=o(c,0,15,10,60),f=u/5;for(this.svg.setWidth(6*(u+f)),this.svg.setHeight(6*(u+f)),e=0,h=0;6>h;h++)for(l=0;6>l;l++)a=n(this.hash,e),i=s(a),t=r(a),this.svg.circle(l*u+l*f+(u+f)/2,h*u+h*f+(u+f)/2,u/2,{fill:\"none\",stroke:t,opacity:i,\"stroke-width\":f+\"px\"}),a=n(this.hash,39-e),i=s(a),t=r(a),this.svg.circle(l*u+l*f+(u+f)/2,h*u+h*f+(u+f)/2,u/4,{fill:t,\"fill-opacity\":i}),e+=1},A.prototype.geoOverlappingRings=function(){var t,e,i,a,l,h,c,u=n(this.hash,0),f=o(u,0,15,10,60),p=f/4;for(this.svg.setWidth(6*f),this.svg.setHeight(6*f),e=0,c=0;6>c;c++)for(h=0;6>h;h++)l=n(this.hash,e),i=s(l),t=r(l),a={fill:\"none\",stroke:t,opacity:i,\"stroke-width\":p+\"px\"},this.svg.circle(h*f,c*f,f-p/2,a),0===h&&this.svg.circle(6*f,c*f,f-p/2,a),0===c&&this.svg.circle(h*f,6*f,f-p/2,a),0===h&&0===c&&this.svg.circle(6*f,6*f,f-p/2,a),e+=1},A.prototype.geoTriangles=function(){var t,e,i,a,l,h,c,f,p=n(this.hash,0),d=o(p,0,15,15,80),g=d/2*Math.sqrt(3),v=u(d,g);for(this.svg.setWidth(3*d),this.svg.setHeight(6*g),e=0,f=0;6>f;f++)for(c=0;6>c;c++)h=n(this.hash,e),i=s(h),t=r(h),l={fill:t,\"fill-opacity\":i,stroke:E,\"stroke-opacity\":x},a=f%2===0?c%2===0?180:0:c%2!==0?180:0,this.svg.polyline(v,l).transform({translate:[c*d*.5-d/2,g*f],rotate:[a,d/2,g/2]}),0===c&&this.svg.polyline(v,l).transform({translate:[6*d*.5-d/2,g*f],rotate:[a,d/2,g/2]}),e+=1},A.prototype.geoDiamonds=function(){var t,e,i,a,l,h,c,u,p=o(n(this.hash,0),0,15,10,50),d=o(n(this.hash,1),0,15,10,50),g=f(p,d);for(this.svg.setWidth(6*p),this.svg.setHeight(3*d),i=0,u=0;6>u;u++)for(c=0;6>c;c++)h=n(this.hash,i),a=s(h),e=r(h),l={fill:e,\"fill-opacity\":a,stroke:E,\"stroke-opacity\":x},t=u%2===0?0:p/2,this.svg.polyline(g,l).transform({translate:[c*p-p/2+t,d/2*u-d/2]}),0===c&&this.svg.polyline(g,l).transform({translate:[6*p-p/2+t,d/2*u-d/2]}),0===u&&this.svg.polyline(g,l).transform({translate:[c*p-p/2+t,d/2*6-d/2]}),0===c&&0===u&&this.svg.polyline(g,l).transform({translate:[6*p-p/2+t,d/2*6-d/2]}),i+=1},A.prototype.geoNestedSquares=function(){var t,e,i,a,l,h,c,u=o(n(this.hash,0),0,15,4,12),f=7*u;for(this.svg.setWidth(6*(f+u)+6*u),this.svg.setHeight(6*(f+u)+6*u),e=0,c=0;6>c;c++)for(h=0;6>h;h++)l=n(this.hash,e),i=s(l),t=r(l),a={fill:\"none\",stroke:t,opacity:i,\"stroke-width\":u+\"px\"},this.svg.rect(h*f+h*u*2+u/2,c*f+c*u*2+u/2,f,f,a),l=n(this.hash,39-e),i=s(l),t=r(l),a={fill:\"none\",stroke:t,opacity:i,\"stroke-width\":u+\"px\"},this.svg.rect(h*f+h*u*2+u/2+2*u,c*f+c*u*2+u/2+2*u,3*u,3*u,a),e+=1},A.prototype.geoMosaicSquares=function(){var t,e,i,r=o(n(this.hash,0),0,15,15,50);for(this.svg.setWidth(8*r),this.svg.setHeight(8*r),t=0,i=0;4>i;i++)for(e=0;4>e;e++)e%2===0?i%2===0?g(this.svg,e*r*2,i*r*2,r,n(this.hash,t)):d(this.svg,e*r*2,i*r*2,r,[n(this.hash,t),n(this.hash,t+1)]):i%2===0?d(this.svg,e*r*2,i*r*2,r,[n(this.hash,t),n(this.hash,t+1)]):g(this.svg,e*r*2,i*r*2,r,n(this.hash,t)),t+=1},A.prototype.geoPlaid=function(){var t,e,i,o,a,l,h,c=0,u=0;for(e=0;36>e;)o=n(this.hash,e),c+=o+5,h=n(this.hash,e+1),i=s(h),t=r(h),a=h+5,this.svg.rect(0,c,\"100%\",a,{opacity:i,fill:t}),c+=a,e+=2;for(e=0;36>e;)o=n(this.hash,e),u+=o+5,h=n(this.hash,e+1),i=s(h),t=r(h),l=h+5,this.svg.rect(u,0,l,\"100%\",{opacity:i,fill:t}),u+=l,e+=2;this.svg.setWidth(u),this.svg.setHeight(c)},A.prototype.geoTessellation=function(){var t,e,i,a,l,h=o(n(this.hash,0),0,15,5,40),c=h*Math.sqrt(3),u=2*h,f=h/2*Math.sqrt(3),p=v(h,f),d=3*h+2*f,g=2*c+2*h;for(this.svg.setWidth(d),this.svg.setHeight(g),e=0;20>e;e++)switch(l=n(this.hash,e),i=s(l),t=r(l),a={stroke:E,\"stroke-opacity\":x,fill:t,\"fill-opacity\":i,\"stroke-width\":1},e){case 0:this.svg.rect(-h/2,-h/2,h,h,a),this.svg.rect(d-h/2,-h/2,h,h,a),this.svg.rect(-h/2,g-h/2,h,h,a),this.svg.rect(d-h/2,g-h/2,h,h,a);break;case 1:this.svg.rect(u/2+f,c/2,h,h,a);break;case 2:this.svg.rect(-h/2,g/2-h/2,h,h,a),this.svg.rect(d-h/2,g/2-h/2,h,h,a);break;case 3:this.svg.rect(u/2+f,1.5*c+h,h,h,a);break;case 4:this.svg.polyline(p,a).transform({translate:[h/2,-h/2],rotate:[0,h/2,f/2]}),this.svg.polyline(p,a).transform({translate:[h/2,g- -h/2],rotate:[0,h/2,f/2],scale:[1,-1]});break;case 5:this.svg.polyline(p,a).transform({translate:[d-h/2,-h/2],rotate:[0,h/2,f/2],scale:[-1,1]}),this.svg.polyline(p,a).transform({translate:[d-h/2,g+h/2],rotate:[0,h/2,f/2],scale:[-1,-1]});break;case 6:this.svg.polyline(p,a).transform({translate:[d/2+h/2,c/2]});break;case 7:this.svg.polyline(p,a).transform({translate:[d-d/2-h/2,c/2],scale:[-1,1]});break;case 8:this.svg.polyline(p,a).transform({translate:[d/2+h/2,g-c/2],scale:[1,-1]});break;case 9:this.svg.polyline(p,a).transform({translate:[d-d/2-h/2,g-c/2],scale:[-1,-1]});break;case 10:this.svg.polyline(p,a).transform({translate:[h/2,g/2-h/2]});break;case 11:this.svg.polyline(p,a).transform({translate:[d-h/2,g/2-h/2],scale:[-1,1]});break;case 12:this.svg.rect(0,0,h,h,a).transform({translate:[h/2,h/2],rotate:[-30,0,0]});break;case 13:this.svg.rect(0,0,h,h,a).transform({scale:[-1,1],translate:[-d+h/2,h/2],rotate:[-30,0,0]});break;case 14:this.svg.rect(0,0,h,h,a).transform({translate:[h/2,g/2-h/2-h],rotate:[30,0,h]});break;case 15:this.svg.rect(0,0,h,h,a).transform({scale:[-1,1],translate:[-d+h/2,g/2-h/2-h],rotate:[30,0,h]});break;case 16:this.svg.rect(0,0,h,h,a).transform({scale:[1,-1],translate:[h/2,-g+g/2-h/2-h],rotate:[30,0,h]});break;case 17:this.svg.rect(0,0,h,h,a).transform({scale:[-1,-1],translate:[-d+h/2,-g+g/2-h/2-h],rotate:[30,0,h]});break;case 18:this.svg.rect(0,0,h,h,a).transform({scale:[1,-1],translate:[h/2,-g+h/2],rotate:[-30,0,0]});break;case 19:this.svg.rect(0,0,h,h,a).transform({scale:[-1,-1],translate:[-d+h/2,-g+h/2],rotate:[-30,0,0]})}}}).call(this,t(\"buffer\").Buffer)},{\"./color\":2,\"./sha1\":5,\"./svg\":6,buffer:8,extend:9}],5:[function(t,e){\"use strict\";function i(){function t(){for(var t=16;80>t;t++){var e=u[t-3]^u[t-8]^u[t-14]^u[t-16];u[t]=e>31}var i,n,o=s,r=a,p=l,d=h,g=c;for(t=0;80>t;t++){20>t?(i=d^r&(p^d),n=1518500249):40>t?(i=r^p^d,n=1859775393):60>t?(i=r&p|d&(r|p),n=2400959708):(i=r^p^d,n=3395469782);var v=(o>27)+i+g+n+(0|u[t]);g=d,d=p,p=r>2,r=o,o=v}for(s=s+o|0,a=a+r|0,l=l+p|0,h=h+d|0,c=c+g|0,f=0,t=0;16>t;t++)u[t]=0}function e(e){u[f]|=(255&e)o;o++)e(t[o])}function o(t){for(var e=\"\",i=28;i>=0;i-=4)e+=(t>>i&15).toString(16);return e}function r(){e(128),(f>14||14===f&&24>p)&&t(),f=14,p=24,e(0),e(0),e(d>0xffffffffff?d/1099511627776:0),e(d>4294967295?d/4294967296:0);for(var i=24;i>=0;i-=8)e(d>>i);return o(s)+o(a)+o(l)+o(h)+o(c)}var s=1732584193,a=4023233417,l=2562383102,h=271733878,c=3285377520,u=new Uint32Array(80),f=0,p=24,d=0;return{update:n,digest:r}}e.exports=function(t){if(void 0===t)return i();var e=i();return e.update(t),e.digest()}},{}],6:[function(t,e){\"use strict\";function i(){return this.width=100,this.height=100,this.svg=new o(\"svg\"),this.context=[],this.setAttributes(this.svg,{xmlns:\"http://www.w3.org/2000/svg\",width:this.width,height:this.height}),this}var n=t(\"extend\"),o=t(\"./xml\");e.exports=i,i.prototype.currentContext=function(){return this.context[this.context.length-1]||this.svg},i.prototype.end=function(){return this.context.pop(),this},i.prototype.currentNode=function(){var t=this.currentContext();return t.lastChild||t},i.prototype.transform=function(t){return this.currentNode().setAttribute(\"transform\",Object.keys(t).map(function(e){return e+\"(\"+t[e].join(\",\")+\")\"}).join(\" \")),this},i.prototype.setAttributes=function(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})},i.prototype.setWidth=function(t){this.svg.setAttribute(\"width\",Math.floor(t))},i.prototype.setHeight=function(t){this.svg.setAttribute(\"height\",Math.floor(t))},i.prototype.toString=function(){return this.svg.toString()},i.prototype.rect=function(t,e,i,r,s){var a=this;if(Array.isArray(t))return t.forEach(function(t){a.rect.apply(a,t.concat(s))}),this;var l=new o(\"rect\");return this.currentContext().appendChild(l),this.setAttributes(l,n({x:t,y:e,width:i,height:r},s)),this},i.prototype.circle=function(t,e,i,r){var s=new o(\"circle\");return this.currentContext().appendChild(s),this.setAttributes(s,n({cx:t,cy:e,r:i},r)),this},i.prototype.path=function(t,e){var i=new o(\"path\");return this.currentContext().appendChild(i),this.setAttributes(i,n({d:t},e)),this},i.prototype.polyline=function(t,e){var i=this;if(Array.isArray(t))return t.forEach(function(t){i.polyline(t,e)}),this;var r=new o(\"polyline\");return this.currentContext().appendChild(r),this.setAttributes(r,n({points:t},e)),this},i.prototype.group=function(t){var e=new o(\"g\");return this.currentContext().appendChild(e),this.context.push(e),this.setAttributes(e,n({},t)),this}},{\"./xml\":7,extend:9}],7:[function(t,e){\"use strict\";var i=e.exports=function(t){return this instanceof i?(this.tagName=t,this.attributes=Object.create(null),this.children=[],this.lastChild=null,this):new i(t)};i.prototype.appendChild=function(t){return this.children.push(t),this.lastChild=t,this},i.prototype.setAttribute=function(t,e){return this.attributes[t]=e,this},i.prototype.toString=function(){var t=this;return[\"\",t.children.map(function(t){return t.toString()}).join(\"\"),\"\"].join(\"\")}},{}],8:[function(){},{}],9:[function(t,e){function i(t){if(!t||\"[object Object]\"!==o.call(t)||t.nodeType||t.setInterval)return!1;var e=n.call(t,\"constructor\"),i=n.call(t.constructor.prototype,\"isPrototypeOf\");if(t.constructor&&!e&&!i)return!1;var r;for(r in t);return void 0===r||n.call(t,r)}var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=function r(){var t,e,n,o,s,a,l=arguments[0]||{},h=1,c=arguments.length,u=!1;for(\"boolean\"==typeof l&&(u=l,l=arguments[1]||{},h=2),\"object\"!=typeof l&&\"function\"!=typeof l&&(l={});c>h;h++)if(null!=(t=arguments[h]))for(e in t)n=l[e],o=t[e],l!==o&&(u&&o&&(i(o)||(s=Array.isArray(o)))?(s?(s=!1,a=n&&Array.isArray(n)?n:[]):a=n&&i(n)?n:{},l[e]=r(u,a,o)):void 0!==o&&(l[e]=o));return l}},{}]},{},[1])(1)}),function(){\"use strict\";if(navigator.userAgent.match(/IEMobile\\/10\\.0/)){var t=document.createElement(\"style\");t.appendChild(document.createTextNode(\"@-ms-viewport{width:auto!important}\")),document.querySelector(\"head\").appendChild(t)}}(),function(t){\"function\"==typeof define&&define.amd?define([\"jquery\"],t):\"object\"==typeof module&&module.exports?module.exports=function(e,i){return void 0===i&&(i=\"undefined\"!=typeof window?require(\"jquery\"):require(\"jquery\")(e)),t(i),i}:t(jQuery)}(function(t){function e(e,i){var o=this;this.options=t.extend({},n,i),o.navigation=t(e),o.document=t(document),o.window=t(window),\"\"==this.options.parent?this.options.parent=o.navigation.parent():\"\",o.nav_open=!1,o.parent_full_width=0,o.radCoef=180/Math.PI,o.sTouch={x:0,y:0},o.cTouch={x:0,y:0},o.sTime=0,o.nav_position=0,o.percent_open=0,o.nav_moving=!1,o.init()}var i=\"okayNav\",n={parent:\"\",toggle_icon_class:\"okayNav__menu-toggle\",toggle_icon_content:\"\",align_right:!0,swipe_enabled:!0,threshold:50,resize_delay:10,beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},itemHidden:function(){},itemDisplayed:function(){}};t.extend(e.prototype,{init:function(){var e=this;t(\"body\").addClass(\"okayNav-loaded\"),e.navigation.addClass(\"okayNav loaded\").children(\"ul\").addClass(\"okayNav__nav--visible\"),e.options.align_right?e.navigation.append('').append(''+e.options.toggle_icon_content+\"\"):e.navigation.prepend('').prepend(''+e.options.toggle_icon_content+\"\"),e.nav_visible=e.navigation.children(\".okayNav__nav--visible\"),e.nav_invisible=e.navigation.children(\".okayNav__nav--invisible\"),e.toggle_icon=e.navigation.children(\".\"+e.options.toggle_icon_class),e.toggle_icon_width=e.toggle_icon.outerWidth(!0),e.default_width=e.getChildrenWidth(e.navigation),e.parent_full_width=t(e.options.parent).outerWidth(!0),e.last_visible_child_width=0,e.initEvents(),e.nav_visible.contents().filter(function(){return this.nodeType=Node.TEXT_NODE&&/\\S/.test(this.nodeValue)===!1}).remove(),1==e.options.swipe_enabled&&e.initSwipeEvents()},initEvents:function(){var e=this;e.document.on(\"click.okayNav\",function(i){var n=t(i.target);e.nav_open===!0&&0==n.closest(\".okayNav\").length&&e.closeInvisibleNav(),i.target===e.toggle_icon.get(0)&&(i.preventDefault(),e.toggleInvisibleNav())});var i=e._debounce(function(){e.recalcNav()},e.options.resize_delay);e.window.on(\"load.okayNav resize.okayNav\",i)},initSwipeEvents:function(){var e=this;e.document.on(\"touchstart.okayNav\",function(i){if(e.nav_invisible.removeClass(\"transition-enabled\"),1==i.originalEvent.touches.length){var n=i.originalEvent.touches[0];(n.pageXt(e.options.parent).outerWidth(!0)-25&&1==e.options.align_right||e.nav_open===!0)&&(e.sTouch.x=e.cTouch.x=n.pageX,e.sTouch.y=e.cTouch.y=n.pageY,e.sTime=Date.now())}}).on(\"touchmove.okayNav\",function(t){var i=t.originalEvent.touches[0];e._triggerMove(i.pageX,i.pageY),e.nav_moving=!0}).on(\"touchend.okayNav\",function(t){e.sTouch={x:0,y:0},e.cTouch={x:0,y:0},e.sTime=0,e.percent_open>100-e.options.threshold?(e.nav_position=0,e.closeInvisibleNav()):1==e.nav_moving&&(e.nav_position=e.nav_invisible.width(),e.openInvisibleNav()),e.nav_moving=!1,e.nav_invisible.addClass(\"transition-enabled\")})},_getDirection:function(t){return this.options.align_right?t>0?-1:1:t=a||0>e||e>=a)&&s.isDark(t,e)}var s=t(n,i);s.addData(e),s.make(),o=o||0;var a=s.getModuleCount(),l=s.getModuleCount()+2*o,h=function(t,e,i,n){var o=this.isDark,r=1/l;this.isDark=function(s,a){var l=a*r,h=s*r,c=l+r,u=h+r;return o(s,a)&&(t>c||l>i||e>u||h>n)}};this.text=e,this.level=i,this.version=n,this.moduleCount=l,this.isDark=r,this.addBlank=h}function i(t,i,n,o,r){n=Math.max(1,n||1),o=Math.min(40,o||40);for(var s=n;o>=s;s+=1)try{return new e(t,i,s,r)}catch(t){}}function n(t,e,i){var n=i.size,o=\"bold \"+i.mSize*n+\"px \"+i.fontname,r=v(\"\")[0].getContext(\"2d\");r.font=o;var s=r.measureText(i.label).width,a=i.mSize,l=s/n,h=(1-l)*i.mPosX,c=(1-a)*i.mPosY,u=h+l,f=c+a,p=.01;1===i.mode?t.addBlank(0,c-p,n,f+p):t.addBlank(h-p,c-p,u+p,f+p),e.fillStyle=i.fontcolor,e.font=o,e.fillText(i.label,h*n,c*n+.75*i.mSize*n)}function o(t,e,i){var n=i.size,o=i.image.naturalWidth||1,r=i.image.naturalHeight||1,s=i.mSize,a=s*o/r,l=(1-a)*i.mPosX,h=(1-s)*i.mPosY,c=l+a,u=h+s,f=.01;3===i.mode?t.addBlank(0,h-f,n,u+f):t.addBlank(l-f,h-f,c+f,u+f),e.drawImage(i.image,l*n,h*n,a*n,s*n)}function r(t,e,i){v(i.background).is(\"img\")?e.drawImage(i.background,0,0,i.size,i.size):i.background&&(e.fillStyle=i.background,e.fillRect(i.left,i.top,i.size,i.size));var r=i.mode;1===r||2===r?n(t,e,i):(3===r||4===r)&&o(t,e,i)}function s(t,e,i,n,o,r,s,a){t.isDark(s,a)&&e.rect(n,o,r,r)}function a(t,e,i,n,o,r,s,a,l,h){s?t.moveTo(e+r,i):t.moveTo(e,i),a?(t.lineTo(n-r,i),t.arcTo(n,i,n,o,r)):t.lineTo(n,i),l?(t.lineTo(n,o-r),t.arcTo(n,o,e,o,r)):t.lineTo(n,o),h?(t.lineTo(e+r,o),t.arcTo(e,o,e,i,r)):t.lineTo(e,o),s?(t.lineTo(e,i+r),t.arcTo(e,i,n,i,r)):t.lineTo(e,i)}function l(t,e,i,n,o,r,s,a,l,h){s&&(t.moveTo(e+r,i),t.lineTo(e,i),t.lineTo(e,i+r),t.arcTo(e,i,e+r,i,r)),a&&(t.moveTo(n-r,i),t.lineTo(n,i),t.lineTo(n,i+r),t.arcTo(n,i,n-r,i,r)),l&&(t.moveTo(n-r,o),t.lineTo(n,o),t.lineTo(n,o-r), t.arcTo(n,o,n-r,o,r)),h&&(t.moveTo(e+r,o),t.lineTo(e,o),t.lineTo(e,o-r),t.arcTo(e,o,e+r,o,r))}function h(t,e,i,n,o,r,s,h){var c=t.isDark,u=n+r,f=o+r,p=i.radius*r,d=s-1,g=s+1,v=h-1,m=h+1,y=c(s,h),b=c(d,v),w=c(d,h),T=c(d,m),C=c(s,m),_=c(g,m),k=c(g,h),E=c(g,v),x=c(s,v);y?a(e,n,o,u,f,p,!w&&!x,!w&&!C,!k&&!C,!k&&!x):l(e,n,o,u,f,p,w&&x&&b,w&&C&&T,k&&C&&_,k&&x&&E)}function c(t,e,i){var n,o,r=t.moduleCount,a=i.size/r,l=s;for(y&&i.radius>0&&i.radiusn;n+=1)for(o=0;r>o;o+=1){var c=i.left+o*a,u=i.top+n*a,f=a;l(t,e,i,c,u,f,n,o)}if(v(i.fill).is(\"img\")){e.strokeStyle=\"rgba(0,0,0,0.5)\",e.lineWidth=2,e.stroke();var p=e.globalCompositeOperation;e.globalCompositeOperation=\"destination-out\",e.fill(),e.globalCompositeOperation=p,e.clip(),e.drawImage(i.fill,0,0,i.size,i.size),e.restore()}else e.fillStyle=i.fill,e.fill()}function u(t,e){var n=i(e.text,e.ecLevel,e.minVersion,e.maxVersion,e.quiet);if(!n)return null;var o=v(t).data(\"qrcode\",n),s=o[0].getContext(\"2d\");return r(n,s,e),c(n,s,e),o}function f(t){var e=v(\"\").attr(\"width\",t.size).attr(\"height\",t.size);return u(e,t)}function p(t){return v(\"\").attr(\"src\",f(t)[0].toDataURL(\"image/png\"))}function d(t){var e=i(t.text,t.ecLevel,t.minVersion,t.maxVersion,t.quiet);if(!e)return null;var n,o,r=t.size,s=t.background,a=Math.floor,l=e.moduleCount,h=a(r/l),c=a(.5*(r-h*l)),u={position:\"relative\",left:0,top:0,padding:0,margin:0,width:r,height:r},f={position:\"absolute\",padding:0,margin:0,width:h,height:h,\"background-color\":t.fill},p=v(\"\").data(\"qrcode\",e).css(u);for(s&&p.css(\"background-color\",s),n=0;l>n;n+=1)for(o=0;l>o;o+=1)e.isDark(n,o)&&v(\"\").css(f).css({left:c+o*h,top:c+n*h}).appendTo(p);return p}function g(t){return m&&\"canvas\"===t.render?f(t):m&&\"image\"===t.render?p(t):d(t)}var v=jQuery,m=function(){var t=document.createElement(\"canvas\");return Boolean(t.getContext&&t.getContext(\"2d\"))}(),y=\"[object Opera]\"!==Object.prototype.toString.call(window.opera),b={render:\"canvas\",minVersion:1,maxVersion:40,ecLevel:\"L\",left:0,top:0,size:200,fill:\"#000\",background:null,text:\"no text\",radius:0,quiet:0,mode:0,mSize:.1,mPosX:.5,mPosY:.5,label:\"no label\",fontname:\"sans\",fontcolor:\"#000\",image:null};v.fn.qrcode=function(t){var e=v.extend({},b,t);return this.each(function(){\"canvas\"===this.nodeName.toLowerCase()?u(this,e):v(this).append(g(e))})}}(function(){var t=function(){function t(e,i){if(\"undefined\"==typeof e.length)throw new Error(e.length+\"/\"+i);var n=function(){for(var t=0;t=n;n+=1)-1>=e+n||e+n>=p||(i>=0&&6>=i&&(0==n||6==n)||n>=0&&6>=n&&(0==i||6==i)||i>=2&&4>=i&&n>=2&&4>=n?f[t+i][e+n]=!0:f[t+i][e+n]=!1)},w=function(){for(var t=0,e=0,i=0;8>i;i+=1){y(!0,i);var n=r.getLostPoint(m);(0==i||t>n)&&(t=n,e=i)}return e},T=function(){for(var t=8;p-8>t;t+=1)null==f[t][6]&&(f[t][6]=t%2==0);for(var e=8;p-8>e;e+=1)null==f[6][e]&&(f[6][e]=e%2==0)},C=function(){for(var t=r.getPatternPosition(c),e=0;e=a;a+=1)-2==s||2==s||-2==a||2==a||0==s&&0==a?f[n+s][o+a]=!0:f[n+s][o+a]=!1}},_=function(t){for(var e=r.getBCHTypeNumber(c),i=0;18>i;i+=1){var n=!t&&1==(e>>i&1);f[Math.floor(i/3)][i%3+p-8-3]=n}for(var i=0;18>i;i+=1){var n=!t&&1==(e>>i&1);f[i%3+p-8-3][Math.floor(i/3)]=n}},k=function(t,e){for(var i=u>o&1);6>o?f[o][8]=s:8>o?f[o+1][8]=s:f[p-15+o][8]=s}for(var o=0;15>o;o+=1){var s=!t&&1==(n>>o&1);8>o?f[8][p-o-1]=s:9>o?f[8][15-o-1+1]=s:f[8][15-o-1]=s}f[p-8][8]=!t},E=function(t,e){for(var i=-1,n=p-1,o=7,s=0,a=r.getMaskFunction(e),l=p-1;l>0;l-=2)for(6==l&&(l-=1);;){for(var h=0;2>h;h+=1)if(null==f[n][l-h]){var c=!1;s>>o&1));var u=a(n,l-h);u&&(c=!c),f[n][l-h]=c,o-=1,-1==o&&(s+=1,o=7)}if(n+=i,0>n||n>=p){n-=i,i=-i;break}}},x=function(e,i){for(var n=0,o=0,s=0,a=new Array(i.length),l=new Array(i.length),h=0;h=n&&o>i){var r=Math.floor((e-n)/t),s=Math.floor((i-n)/t);return m.isDark(s,r)?0:1}return 1})},m};e.stringToBytes=function(t){for(var e=new Array,i=0;i>=1;return e};return l.getBCHTypeInfo=function(t){for(var e=t=e))for(var l=-1;1>=l;l+=1)0>o+l||o+l>=e||(0!=a||0!=l)&&s==t.isDark(n+a,o+l)&&(r+=1);r>5&&(i+=3+r-5)}for(var n=0;e-1>n;n+=1)for(var o=0;e-1>o;o+=1){var h=0;t.isDark(n,o)&&(h+=1),t.isDark(n+1,o)&&(h+=1),t.isDark(n,o+1)&&(h+=1),t.isDark(n+1,o+1)&&(h+=1),(0==h||4==h)&&(i+=3)}for(var n=0;e>n;n+=1)for(var o=0;e-6>o;o+=1)t.isDark(n,o)&&!t.isDark(n,o+1)&&t.isDark(n,o+2)&&t.isDark(n,o+3)&&t.isDark(n,o+4)&&!t.isDark(n,o+5)&&t.isDark(n,o+6)&&(i+=40);for(var o=0;e>o;o+=1)for(var n=0;e-6>n;n+=1)t.isDark(n,o)&&!t.isDark(n+1,o)&&t.isDark(n+2,o)&&t.isDark(n+3,o)&&t.isDark(n+4,o)&&!t.isDark(n+5,o)&&t.isDark(n+6,o)&&(i+=40);for(var c=0,o=0;e>o;o+=1)for(var n=0;e>n;n+=1)t.isDark(n,o)&&(c+=1);var u=Math.abs(100*c/e/e-50)/5;return i+=10*u},l}(),s=function(){for(var t=new Array(256),e=new Array(256),i=0;8>i;i+=1)t[i]=1i;i+=1)e[t[i]]=i;var n={};return n.glog=function(t){if(1>t)throw new Error(\"glog(\"+t+\")\");return e[t]},n.gexp=function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return t[e]},n}(),a=function(){var t=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e=function(t,e){var i={};return i.totalCount=t,i.dataCount=e,i},i={},o=function(e,i){switch(i){case n.L:return t[4*(e-1)+0];case n.M:return t[4*(e-1)+1];case n.Q:return t[4*(e-1)+2];case n.H:return t[4*(e-1)+3];default:return}};return i.getRSBlocks=function(t,i){var n=o(t,i);if(\"undefined\"==typeof n)throw new Error(\"bad rs block @ typeNumber:\"+t+\"/errorCorrectLevel:\"+i);for(var r=n.length/3,s=new Array,a=0;r>a;a+=1)for(var l=n[3*a+0],h=n[3*a+1],c=n[3*a+2],u=0;l>u;u+=1)s.push(e(h,c));return s},i}(),l=function(){var t=new Array,e=0,i={};return i.getBuffer=function(){return t},i.getAt=function(e){var i=Math.floor(e/8);return 1==(t[i]>>>7-e%8&1)},i.put=function(t,e){for(var n=0;e>n;n+=1)i.putBit(1==(t>>>e-n-1&1))},i.getLengthInBits=function(){return e},i.putBit=function(i){var n=Math.floor(e/8);t.length>>e%8),e+=1},i},h=function(t){var n=i.MODE_8BIT_BYTE,o=e.stringToBytes(t),r={};return r.getMode=function(){return n},r.getLength=function(t){return o.length},r.write=function(t){for(var e=0;e>>8)},e.writeBytes=function(t,i,n){i=i||0,n=n||t.length;for(var o=0;n>o;o+=1)e.writeByte(t[o+i])},e.writeString=function(t){for(var i=0;it);else{if(26>t)return 65+t;if(52>t)return 97+(t-26);if(62>t)return 48+(t-52);if(62==t)return 43;if(63==t)return 47}throw new Error(\"n:\"+t)};return o.writeByte=function(n){for(t=t>>e-6),e-=6},o.flush=function(){if(e>0&&(r(to;){if(i>=e.length){if(0==o)return-1;throw new Error(\"unexpected end of file./\"+o)}var t=e.charAt(i);if(i+=1,\"=\"==t)return o=0,-1;t.match(/^\\s$/)||(n=n>o-8&255;return o-=8,r};var s=function(t){if(t>=65&&90>=t)return t-65;if(t>=97&&122>=t)return t-97+26;if(t>=48&&57>=t)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw new Error(\"c:\"+t)};return r},p=function(t,e){var i=t,n=e,o=new Array(t*e),r={};r.setPixel=function(t,e,n){o[e*i+t]=n},r.write=function(t){t.writeString(\"GIF87a\"),t.writeShort(i),t.writeShort(n),t.writeByte(128),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(0),t.writeByte(255),t.writeByte(255),t.writeByte(255),t.writeString(\",\"),t.writeShort(0),t.writeShort(0),t.writeShort(i),t.writeShort(n),t.writeByte(0);var e=2,o=a(e);t.writeByte(e);for(var r=0;o.length-r>255;)t.writeByte(255),t.writeBytes(o,r,255),r+=255;t.writeByte(o.length-r),t.writeBytes(o,r,o.length-r),t.writeByte(0),t.writeString(\";\")};var s=function(t){var e=t,i=0,n=0,o={};return o.write=function(t,o){if(t>>>o!=0)throw new Error(\"length over\");for(;i+o>=8;)e.writeByte(255&(t>=8-i,n=0,i=0;n|=t12,128|n>>6&63,128|63&n):(i++,n=65536+((1023&n)18,128|n>>12&63,128|n>>6&63,128|63&n))}return e}return e(t)}}(t),t}()),function(t){t.fn.share=function(e){function i(e,i){var n=o(i);\"prepend\"==i.mode?n.reverse():n,n.length&&t.each(n,function(n,o){var s=r(o,i),a=i.initialized?e.find(\".icon-\"+o):t('');return!a.length||(a.prop(\"aria-label\",\"åˆ†äº«åˆ° \"+f[o]),a.prop(\"href\",s),\"wechat\"===o?a.prop(\"tabindex\",-1):a.prop(\"target\",\"_blank\"),void(i.initialized||(\"prepend\"==i.mode?e.prepend(a):e.append(a))))})}function n(t,e){var i=t.find(\"a.icon-wechat\");i.length&&(i.append(''+e.wechatQrcodeTitle+''+e.wechatQrcodeHelper+\"\"),i.find(\".qrcode\").qrcode({render:\"image\",size:e.wechatQrcodeSize,text:e.url}),i.offset().top"},{"title":"æ ‡ç­¾","date":"2022-06-25T05:51:47.109Z","updated":"2022-06-25T05:51:47.109Z","comments":false,"path":"tags/index.html","permalink":"http://fyupeng.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"è…¾è®¯ä¸€é¢","slug":"è…¾è®¯ä¸€é¢","date":"2022-11-29T13:08:12.000Z","updated":"2022-11-29T13:10:20.156Z","comments":true,"path":"2022/11/29/è…¾è®¯ä¸€é¢/","link":"","permalink":"http://fyupeng.github.io/2022/11/29/%E8%85%BE%E8%AE%AF%E4%B8%80%E9%9D%A2/","excerpt":"","text":"è‡ªæˆ‘ä»‹ç»è¿™é‡Œä¸€ç¬”å¸¦è¿‡ï¼Œç»™å¯¹é¢ä»‹ç»è‡ªå·±å†…åœ¨ + å¤–åœ¨ + æ ¡å›­ç»åŽ† + æ ¡å›­é¡¹ç›® + æ„å‘å²—ä½ è…¾è®¯å­å…¬å¸äº‘æ™ºç ”å‘ä¸€é¢ 1. æœ‰äº†è§£è¿‡C++å—ï¼ŸæŽ¥å—è½¬è¯­è¨€å—ï¼Ÿ2. æœ‰æ²¡æœ‰äº†è§£è¿‡ä¸€äº›æ¡†æž¶çš„åº•å±‚åŽŸç†ã€åº•å±‚ä¼˜åŒ–ã€æ•°æ®åº“çš„ç´¢å¼•ä¼˜åŒ–3. äº†è§£è¿‡å“ªäº›Mapï¼Œå¯ä»¥ä»Žåº•å±‚ç®€å•è¯´ä¸‹å˜›ï¼Ÿæ¯”å¦‚æˆ‘æœ€å¸¸ä½¿ç”¨çš„æœ‰HashMapã€HashTableã€CurrentHashMapè¿™ä¸‰ç§ HashMapå®ƒçš„åº•å±‚æ˜¯é‡‡ç”¨äº†æ•°ç»„+é“¾è¡¨çš„æ•°æ®ç»“æž„ ä»Žæºç ä¸­åˆ†æžï¼ŒHashMapæœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Nodeï¼ŒHashMapé€šè¿‡æˆå‘˜å˜é‡tableï¼ˆNodeæ•°ç»„ç±»åž‹ï¼‰æ¥é‡‡å–putå’Œgetæ“ä½œï¼Œè¯¥æˆå‘˜å˜é‡ç”¨å…³é”®å­—transientåŠ ä»¥ä¿®é¥°ï¼Œè¡¨æ˜Žç¦æ­¢åºåˆ—åŒ–ã€‚ è€ŒNodeæ˜¯tableæ•°ç»„çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå†…éƒ¨æˆå‘˜æ•°æ®æœ‰hashã€keyã€valueå’ŒæŒ‡å‘Nodeç±»çš„next â€“ åˆå§‹åŒ–é˜¶æ®µ â€“ åœ¨è¿™é‡Œï¼Œputæ“ä½œåŽï¼Œtableä¼šå…ˆè°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å±•ï¼Œæ‰©å±•åŽtableæ‰ä»Žnullå˜ä¸º16ä½çš„Nodeæ•°ç»„ï¼Œåˆå§‹åŒ–åŽçš„æ¯ä¸€ä¸ªä¸‹æ ‡ä¾æ—§ä¸ºnullï¼Œå¹¶ä¸”åˆå§‹åŒ–é˜ˆå€¼thresholdï¼Œé»˜è®¤ä¸º0.75 * size,ä½œç”¨æ˜¯ä¸Žæˆå‘˜å˜é‡sizeï¼ˆæˆå‘˜å˜é‡sizeä¼šåœ¨æ¯æ¬¡putè€Œä¸”è¦è¯¥keyå€¼ä¸ºé¦–æ¬¡æ“ä½œå³ä¸å­˜åœ¨è¯¥Mapä¸­ä¼šè‡ªå¢žï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœsizeæ•°å³è¡¨æ˜Žputçš„key-valueå¯¹çš„æ•°é‡è¶…è¿‡é˜ˆå€¼thresholdï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œå³resizeæ–¹æ³•å¦ä¸€ä½œç”¨ã€‚ â€“ æ‰©å®¹é˜¶æ®µ â€“ æ‰©å®¹é˜¶æ®µæ›´ç®€å•ï¼Œå°±æ˜¯å°†é˜ˆå€¼*2æ¥æ‰©å®¹ï¼Œç„¶åŽéåŽ†æ•´ä¸ªtableå³Nodeæ•°ç»„ï¼Œå¦‚æžœå‘çŽ°æœ‰Nodeç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™é‡Œå°±å‡ºçŽ°äº†ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§ä¸ºæ¯ä¸ªç»“ç‚¹ä¸Šæ˜¯é“¾è¡¨ç»“æž„ï¼Œå¦ä¸€ç§åˆ™æ˜¯çº¢é»‘æ ‘ç»“æž„ã€‚ æ‰©å®¹æ“ä½œæ˜¯åˆ›å»ºæ–°tableæ¥æ‰©å®¹ï¼Œæ²¡æœ‰åœ¨æ—§tableä¸Šç›´æŽ¥æ‰©å®¹ï¼ŒéåŽ†æ—§tableè¿›è¡Œæ‰©å®¹æ—¶ï¼Œå°†ä¼šå¯¹æ¯ä¸ªtableæ§½ä½ç½®ç©ºï¼Œå¤šçº¿ç¨‹åœ¨æ‰©å®¹æ—¶ä¼šå‘ç”Ÿä¸€äº›å¯¼è‡´çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚ ConcurrentHashMapåœ¨JDK7æ‰©å®¹æ—¶ä½¿ç”¨åˆ°äº†ReentrantLockå¯¹æ®µåŠ é”ï¼Œè¿™æ ·è¯¥æ®µçš„æ—§tableä¹Ÿæ— æ³•æ“ä½œï¼ŒJDKåˆ™é€šè¿‡ä¸€ç§æ‰‹æ®µè®¾ç½®æ ‡å¿—ä½ï¼ŒåŽé¢æ“ä½œä½¿ç”¨CASä¹è§‚é”æ¥æ“ä½œï¼ŒæˆåŠŸåˆ™é€€å‡ºï¼Œä¸æˆåŠŸå‘çŽ°æ‰©å®¹æ ‡å¿—åŽåˆ™å‚ä¸Žæ‰©å®¹ã€‚ æ‰©å®¹æˆåŠŸçš„ç»“æžœå°±æ˜¯å‘ç”Ÿé“¾è¡¨è½¬ç§»æˆ–è€…æ˜¯çº¢é»‘æ ‘è½¬ç§»ï¼Œéƒ½æ˜¯ä¸ºäº†å°†èŠ‚ç‚¹åˆ†æ•£ï¼Œä»¥è‡³äºŽå‘æŒ¥å‡ºHashä¸€æ¬¡å‘½ä¸­å–å‡ºå’Œä¿å­˜çš„é«˜æ€§èƒ½ã€‚ å½“ç„¶åˆšå¼€å§‹æ²¡æœ‰ç»“ç‚¹æ•°æ®ï¼ŒoldTableä¸ºnullï¼Œä¸éœ€è¦è½¬ç§»ç»“ç‚¹ï¼Œç„¶åŽä»€ä¹ˆäº‹éƒ½æ²¡å¹²ï¼ŒæŽ¥ç€é€šè¿‡hashä¸Žtableçš„é•¿åº¦è¿›è¡Œ&amp;æ“ä½œå‘½ä¸­æ§½ä½ï¼Œputæ“ä½œä¼šä¿å­˜åˆ°æ•°ç»„å¯¹åº”ä¸‹æ ‡å¤„å³æ§½ä½ä¸­çš„ç»“ç‚¹ã€‚ â€“ ç»“ç‚¹åˆå§‹åŒ– â€“ ä¿å­˜ä¹‹å‰å¾ˆç®€å•ï¼Œå¾—åˆ¤æ–­å¯¹åº”Nodeæ•°ç»„ä¸‹æ ‡ç»“ç‚¹æ˜¯å¦ä¸ºnullï¼Œå› ä¸ºè¿™é‡Œæ˜¯æ‡’åŠ è½½å˜›ï¼Œåˆšå¼€å§‹æ²¡æœ‰åˆå§‹åŒ–æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œresizeåˆå§‹åŒ–æ–¹æ³•ä¹Ÿåªæ˜¯newäº†ä¸ªNodeæ•°ç»„ï¼Œè€Œä¸”è¿™ä¹Ÿä¸€æ ·æ˜¯æ‡’åŠ è½½ã€‚ æ‰€ä»¥åœ¨è¿™é‡Œä¼šå°†putä¸­keyçš„hashã€keyå’Œvalueå€¼å°è£…åˆ°Nodeç»“ç‚¹ä¸­å¹¶å®žä¾‹åŒ–ï¼Œç„¶åŽèµ‹å€¼åˆ°å¯¹åº”çš„Nodeæ•°ç»„ä¸‹æ ‡ä¸­ã€‚ å¦‚æžœç»“ç‚¹å·²ç»å®žä¾‹åŒ–äº†ï¼Œé‚£ä¹ˆè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯é“¾è¡¨å¯»å€ï¼ŒäºŒæ˜¯æ ‘å¯»å€ï¼Œç„¶åŽå°±æ˜¯æ‰¾åˆ°å°±è¦†ç›–ï¼Œæ‰¾ä¸åˆ°å°±è¿½åŠ ã€‚ â€“ é“¾è¡¨å¯»å€ â€“ å¯»å€å‰ä¼šå…ˆåˆ¤æ–­ç»“ç‚¹ç±»åž‹ï¼Œå¦‚æžœinstanceofä¸æ˜¯TreeNodeï¼Œé‚£ä¹ˆä¾¿æ˜¯é“¾è¡¨ï¼Œç„¶åŽå°±å¯ä»¥å¼€å§‹éåŽ†é“¾è¡¨äº†ï¼Œå¦‚æžœæ‰¾åˆ°äº†çš„è¯ï¼Œkey-valueå½“ç„¶å°±æ˜¯è¦è¦†ç›–äº†ï¼Œä½†æ˜¯è¿™é‡Œå¯¹keyçš„å¤„ç†åˆ†ä¸ºäº†ä¸¤ç§ï¼š åˆ†æžä¹‹å‰ï¼Œå…¶å®žé“¾è¡¨ä¸­æ‰€æœ‰ç»“ç‚¹éƒ½ä½äºŽåŒä¸€ä¸ªæ•°ç»„ä¸‹æ ‡ï¼Œé‚£ä¹ˆåº”è¯¥éƒ½å¿…é¡»æ»¡è¶³æ¯ä¸ªç»“ç‚¹çš„hashå€¼ç›¸åŒï¼Œå³æ§½ä½ç›¸åŒï¼Œæ‰€ä»¥ä¼šå†ä¸€æ¬¡åˆ¤æ–­hashå€¼ï¼Œæ‰ä¼šç”¨keyåŽ»æ¯”è¾ƒã€‚ å¦‚æžœkeyä¸ºåŸºæœ¬æ•°æ®ç±»åž‹ï¼Œé‚£ä¹ˆæ˜¯ç›´æŽ¥é€šè¿‡è¿ç®—ç¬¦==æ¥æ¯”è¾ƒçš„ï¼Œä¸ºtrueï¼Œé‚£ä¹ˆå°±ç›´æŽ¥è·³å‡ºé“¾è¡¨éåŽ†äº†ï¼Œç„¶åŽå°†åˆšåˆšåœ¨é“¾è¡¨è®¿é—®åŽå‘½ä¸­çš„Nodeç»“ç‚¹valueè¦†ç›– å¦‚æžœkeyä¸ºå¤æ‚ç±»åž‹ï¼Œé‚£ä¹ˆä»…ä»…é€šè¿‡==è¿ç®—ç¬¦æ¯”è¾ƒæ˜¯é”™è¯¯çš„ï¼Œè¿™é‡Œå°±éœ€è¦æˆ‘ä»¬åŽ»ä¸»åŠ¨é‡å†™equalsæ–¹æ³•ï¼Œè®©keyå€¼æ€Žä¹ˆæ¯”è¾ƒæ‰èƒ½ç›¸ç­‰ï¼Œå› ä¸ºé»˜è®¤equalsæ˜¯Objectæ¯”è¾ƒï¼Œè¿™é‡Œæ¶‰åŠåˆ°å†…å­˜æŒ‡é’ˆäº†ï¼Œæ‰€ä»¥åˆ›å»ºçš„å¯¹è±¡ä¸€èˆ¬å†…å­˜éƒ½ä¸åŒï¼Œé™¤éžæµ…æ‹·è´ã€‚ åªæ˜¯æˆ‘ä»¬ä¸€èˆ¬éƒ½ç”¨Stringç±»åž‹ï¼Œè€ŒStringç±»åž‹å·²ç»å¸®æˆ‘ä»¬é‡å†™è¿‡äº†ï¼Œè™½ç„¶Stringç±»åž‹ä¹Ÿç®—æ˜¯å¤æ‚ç±»åž‹ï¼Œå®ƒé‡å†™äº†Objectçš„equalsæ–¹æ³•ï¼Œä½¿å¾—ä¸åŒå¯¹è±¡å¯ä»¥è¿›è¡Œæ¯”è¾ƒï¼Œæ¯”è¾ƒçš„æ˜¯å¯¹åº”å­—ç¬¦ä¸²åºåˆ—çš„å†…å®¹æ˜¯å¦ç›¸åŒã€‚ å¦‚æžœæ²¡æ‰¾åˆ°ï¼Œé‚£ä¹ˆå°†å®žä¾‹åŒ–æ–°çš„Nodeç»“ç‚¹ï¼Œç„¶åŽè¿½åŠ åˆ°é“¾è¡¨æœ«å°¾ï¼Œåœ¨JDK7ä¸­æ˜¯è¿½åŠ åˆ°å¤´ç»“ç‚¹ï¼ŒåŽæ¥å‘çŽ°çº¿ç¨‹å®‰å…¨ï¼Œå³å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæœ‰å‡ çŽ‡ä¼šå¯¼è‡´é“¾è¡¨å‡ºçŽ°æ­»é”ã€‚ â€“ æ ‘å¯»å€ â€“ é¦–å…ˆäº†è§£ä¸‹TreeNodeï¼Œå®ƒç»§æ‰¿äº†LinkedHashMap.Entryï¼Œè€ŒEntryåˆç»§æ‰¿äº†HashMap.Nodeï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯è·Ÿé“¾è¡¨çš„Nodeç±»ä¼¼ï¼Œåªä¸è¿‡å¤šäº†ä¸€äº›æˆå‘˜å’Œæ–¹æ³•ã€‚ æ ‘å¯»å€æ˜¯åˆ¤æ–­ç»“ç‚¹æ˜¯å¦ä¸ºæ ‘èŠ‚ç‚¹ï¼Œä¸€èˆ¬åœ¨é“¾è¡¨è½¬å˜ä¸ºçº¢é»‘æ ‘ä¹‹åŽæ‰ä¼šè¿›è¡Œï¼Œçº¢é»‘æ ‘æ˜¯ä¸€æ£µå¹³è¡¡çš„äºŒå‰æœ‰åºæ ‘ï¼Œå³ç”±å“ˆå¸Œå€¼æŽ’åºçš„äºŒå‰æ ‘ï¼Œä»Žæ ¹èŠ‚ç‚¹ä¾æ¬¡æ¯”è¾ƒå“ˆå¸Œå€¼å¹¶éåŽ†åˆ°å¶å­èŠ‚ç‚¹ä¾æ—§æ²¡æœ‰æ‰¾åˆ°ï¼Œé€šè¿‡å“ˆå¸Œå€¼æ¯”è¾ƒçš„å¤§å°ç›´æŽ¥å®žä¾‹å‡ºä¸€ä¸ªæ–°çš„æ ‘èŠ‚ç‚¹ç»™åŽŸæ¥å¶å­èŠ‚ç‚¹çš„å·¦å­©å­èŠ‚ç‚¹æˆ–å³å­©å­èŠ‚ç‚¹ã€‚ å¦‚æžœæ‰¾åˆ°è¯¥èŠ‚ç‚¹ï¼Œä¸Žé“¾è¡¨ä¸€æ ·çš„æ–¹æ³•ï¼Œåˆ™ä¸­æ–­éåŽ†å¹¶å°†è¯¥èŠ‚ç‚¹è¿”å›žï¼Œåœ¨å¤–éƒ¨è¿›è¡Œèµ‹å€¼æ“ä½œã€‚ â€“ é“¾è¡¨è½¬ç§» â€“ é“¾è¡¨è½¬ç§»å‰ä¼šåˆ¤æ–­é“¾è¡¨æ˜¯å¦åªæœ‰è¡¨å¤´ï¼Œå³åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆé€šè¿‡å¯»æ‰¾è¯¥ç»“ç‚¹Nodeçš„Hashå€¼ï¼Œä¸Žæ‰©å®¹åŽçš„lenthé•¿åº¦&amp;æ“ä½œå‘½ä¸­æ–°çš„æ§½ä½ 1234567/**e : tableå³Nodeæ•°ç»„ä¸­çš„ä¸€ä¸ªä¸‹æ ‡å…ƒç´ newCap: æ–°tableçš„å®¹é‡e.hash: å“ˆå¸Œå€¼ï¼Œå¸¸ç”¨äºŽä¸Žtableé•¿åº¦åš&amp;æ“ä½œæ¥å‘½ä¸­å¯»å€newTab: æ–°table*/newTab[e.hash &amp; (newCap - 1)] = e; å¦‚æžœæ˜¯é“¾è¡¨ç»“æž„ï¼Œé‚£ä¹ˆæŒ‰ç…§hashå€¼å¯¹é“¾è¡¨æ‹†æˆé«˜ä½å’Œä½Žä½é“¾è¡¨ï¼Œè¿™é‡Œçš„é«˜ä½Žä½ä¸æ˜¯å­—é¢æ„æ€ï¼Œæˆ‘æ˜¯ç›´è¯‘æºç å­—é¢æ„æ€ï¼Œä»Žä»£ç åˆ†æžï¼š 12345678/** å¦‚æžœ hash äºŒè¿›åˆ¶æ•°ä¸­ ä¸Ž æ—§tableçš„å®¹é‡è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•° æ‰€åœ¨çš„ ä½ä¸º1 &amp; ä¸º çœŸï¼Œåˆ™è¡¨ç¤ºä¸ºé«˜ä½é“¾è¡¨å¦‚æžœ hash äºŒè¿›åˆ¶æ•°ä¸­ ä¸Ž æ—§tableçš„å®¹é‡è¡¨ç¤ºçš„äºŒè¿›åˆ¶æ•° æ‰€åœ¨çš„ ä½ä¸º1 &amp; ä¸º å‡ï¼Œåˆ™è¡¨ç¤ºä¸ºä½Žä½é“¾è¡¨ä»Žéšæœºæ€§è§’åº¦è€ƒè™‘ï¼Œè¿™ä¸¤ç§æ•£åˆ—å‡åŒ€çš„è¯å„å ä¸€åŠhash: 4å­—èŠ‚çš„ int ç±»åž‹oldCap: 4å­—èŠ‚çš„ int ç±»åž‹ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º 16ï¼ŒäºŒè¿›åˆ¶è¡¨ç¤ºä¸º 10000*/e.hash &amp; oldCap) == 0 ç”±äºŽæ–°tableæ˜¯æ—§tableçš„ä¸¤å€ï¼Œé‚£ä¹ˆä½Žä½é“¾è¡¨å‘½ä¸­èµ‹å€¼ç»™æ–°tableä¸­ä¸Žæ—§tableç›¸åŒçš„ä¸‹æ ‡ï¼Œè€Œé«˜ä½ä»Žå­—é¢ä¸Šç†è§£ï¼Œå°±è¦æ¯”ä½Žä½æ›´é å³ï¼Œæ‰€ä»¥å®ƒçš„ä¸‹æ ‡æ˜¯åŽŸä¸‹æ ‡+oldCapï¼ŒoldCapå¤§å°ä¹Ÿæ˜¯æ–°tableå¤§å°çš„ä¸€åŠï¼Œçœ‹å›¾ â€“ è½¬åŒ–çº¢é»‘æ ‘ â€“ è½¬åŒ–çº¢é»‘æ ‘åˆšå¼€å§‹æ˜¯ä¸ä¼šè§¦å‘çš„ï¼Œåœ¨putæ“ä½œçš„æ—¶å€™ï¼Œåœ¨tableä¸­æŸä¸ªæ§½éåŽ†é“¾è¡¨æ—¶ï¼Œå¦‚æžœé“¾è¡¨é•¿åº¦è¾¾åˆ°æ‰©å±•æ ‘é˜ˆå€¼8ï¼Œå¹¶ä¸”tableé•¿åº¦è¦å¤§äºŽ64ã€‚ é“¾è¡¨æ»¡è¶³é•¿åº¦8æ˜¯æ ‘è½¬ç§»çš„å¿…è¦æ¡ä»¶ï¼Œåœ¨tableåˆå§‹åŒ–åŽä¸”å‘ç”Ÿè½¬åŒ–çº¢é»‘æ ‘å‰ï¼Œä¼šå…ˆåŽ»åˆ¤æ–­tableé•¿åº¦æ˜¯å¦è¾¾åˆ°64ï¼Œæ²¡æœ‰åˆ™ä¼šæ‰©å®¹ï¼Œæ‰©å®¹å‰é¢ä¹Ÿè¯¦ç»†è¯´äº†ï¼Œä¸Šé¢çš„å›¾å°±å¾ˆæ˜Žç¡®ï¼Œè¾¾åˆ°8ä¸ªèŠ‚ç‚¹çš„é“¾è¡¨ï¼Œæ‰©å®¹åŽé“¾è¡¨æ‹†æˆä¸¤éƒ¨åˆ†ï¼Œå¾ˆæ˜Žæ˜¾æ²¡æœ‰å¿…è¦å†æ¬¡åŽ»è½¬åŒ–äº†ã€‚ å¦‚æžœé•¿åº¦æ»¡è¶³ï¼Œè¿™æ—¶ä¼šå…ˆè½¬å˜ä¸ºåŒå‘é“¾è¡¨ï¼Œç”¨äºŽè¾…åŠ©æ ‘èŠ‚ç‚¹å¢žåŠ å’Œåˆ é™¤ä»¥åŠç»´æŠ¤æ ‘æ ¹èŠ‚ç‚¹ã€‚ è½¬æ¢çº¢é»‘æ ‘æ˜¯ä»ŽéåŽ†è¯¥é“¾è¡¨å¼€å§‹ï¼Œç‰¹æ®Šå¤„ç†ç¬¬ä¸€ä¸ªé“¾è¡¨èŠ‚ç‚¹è½¬æˆæ ‘èŠ‚ç‚¹ï¼ŒéåŽ†è¿™æ£µæ ‘ï¼Œé€šè¿‡å“ˆå¸Œå€¼æž„é€ ä¸€é¢—æŽ’åºæ ‘ï¼Œæ¯æ¬¡æž„é€ æ–°èŠ‚ç‚¹éƒ½æ˜¯ä»Žå¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œä¸å¹³è¡¡å°±åˆ©ç”¨çº¢é»‘æ ‡è®°æ¥è½¬ä¸ºå¹³è¡¡æ ‘ã€‚ â€“ æ ‘è½¬ç§» â€“ æ ‘è½¬ç§»å‘ç”Ÿåœ¨resizeæ–¹æ³•ä¸­ï¼Œè§¦å‘çš„äº‹ä»¶æ˜¯å½“å‰putæˆåŠŸåŽçš„æ‰€æœ‰å…ƒç´ ä¸ªæ•°å¤§äºŽtableçš„é˜ˆå€¼ï¼ˆå®¹é‡ * è´Ÿè½½å› å­ï¼‰ï¼ŒæŽ¥ç€ä¼šå…ˆæ‰©å®¹tableçš„å®¹é‡ï¼Œæ ‘è½¬ç§»æ—¶ï¼Œåœ¨putæ—¶hashå‘½ä¸­çš„tableä¸­ä¸€ä¸ªæ’æ§½å‘çŽ°æ˜¯æ ‘èŠ‚ç‚¹ï¼Œå°±å¼€å§‹è½¬ç§»ï¼Œè½¬ç§»ä¸æ˜¯ä»Žæ ‘çš„é€»è¾‘è½¬ç§»ï¼Œè·Ÿé“¾è¡¨ä¸€æ ·ï¼Œåªä¸è¿‡è¿˜æœ‰è€ƒè™‘å‰ç½®èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è·Ÿæ ‘è½¬ç§»ä¸€æ ·æž„é€ åŒå‘é“¾è¡¨ï¼Œæ‹†æˆä¸¤æ¡å¾…è½¬ç§»æˆæ ‘çš„åŒå‘é“¾è¡¨ã€‚ æ‹†æˆçš„å­åŒå‘é“¾è¡¨ï¼Œé•¿åº¦å°äºŽ6å°±ç›´æŽ¥é€€åŒ–ä¸ºé“¾è¡¨ï¼Œå¦åˆ™æ‰å°†çº¢é»‘æ ‘è½¬ç§»åˆ°æ–°tableçš„é«˜ä½Žä½ä¸Šã€‚ â€“ ç‰¹æ®Škey â€“ å¯¹äºŽkeyä¸ºnullå€¼ï¼ŒJDK7ä¸ŽJDK8åšæ³•ä¸åŒï¼Œä½†ç»“æžœéƒ½æ˜¯ä»Žtableçš„0ä¸‹æ ‡å¼€å§‹éåŽ†ã€‚ JDK7çš„åšæ³•æ˜¯å¯¹Nullåšäº†å•ç‹¬çš„putå¤„ç†ï¼Œä¸ä¸Žéžç©ºçš„keyæ”¾ä¸€èµ·ï¼Œç›´æŽ¥å•ç‹¬åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œé¢éåŽ†tableçš„0ä¸‹æ ‡ã€‚ 1234public V put(K key, V value) &#123; if (key == null) return putForNullKey(value); int hash = hash(key); æ‰€ä»¥å¸¸å¸¸è¯´JDK7ç‰ˆæœ¬å¯è¯»æ€§æ¯”JDK8ç‰ˆæœ¬è¦å¼ºï¼Œè¿™æ˜¯æ— é¡»è´¨ç–‘çš„ã€‚ JDK8çš„åšæ³•æ›´ç»äº†ï¼Œæ˜¯å¯¹Nullåšäº†å•ç‹¬çš„hashå¤„ç†ï¼Œå› ä¸ºå‰é¢çš„JDK7ç‰ˆæœ¬å¯¹keyåšå•ç‹¬å¤„ç†ï¼Œæ— å¤–ä¹Žå°±æ˜¯nullæ²¡æ³•è°ƒç”¨æœ¬åœ°nativeæ–¹æ³•hashCodeå–çš„å“ˆå¸Œå€¼ï¼Œæ‰€ä»¥å¹²è„†å°±åœ¨å¤–é¢ä¼ å…¥hashå€¼ï¼Œå¹¶ä¸”å°†ä¸ºnullçš„keyå“ˆå¸Œå€¼å¤„ç†ä¸º0ã€‚ 1return putVal(hash(key), key, value, false, true); â€“ å“ˆå¸Œå®šä½ â€“ åœ¨HashMapä¸­å…¶å®žå“ˆå¸Œçš„å½±å“è¿˜æ˜¯è›®å¤§çš„ï¼Œæ‰€ä»¥ç‰ˆæœ¬è¿­ä»£å¯¹å“ˆå¸Œä¹Ÿåšäº†ä¸€äº›æ”¹è¿›ã€‚ JDK7ç‰ˆæœ¬çš„åšæ³•å…¶å®žä¹Ÿæ˜¯å°†32ä½çš„intå“ˆå¸Œç±»åž‹åœ¨å‘½ä¸­tableä¸­çš„ä¸‹æ ‡æ˜¯èƒ½å¤Ÿåˆ†å¸ƒå‡è¡¡ï¼Œå› ä¸ºtableçš„æ•°ç»„é•¿åº¦æ²¡æœ‰åƒå“ˆå¸Œå€¼ä¸€æ ·æ¯ä¸ªä½éšæœºå‡åŒ€ï¼Œå®ƒé«˜ä½å­—èŠ‚ä¸€èˆ¬ä¸º0ï¼Œè¿™å°±å¯¼è‡´å¾ˆå¤šæ—¶å€™ä¸åŒçš„å“ˆå¸Œå€¼é«˜ä½è™½ç„¶ä¸åŒï¼Œä½†ç»“æžœå‘½ä¸­äº†åŒä¸€ä¸ªä¸‹æ ‡ï¼ŒJDKçš„åšæ³•é€šè¿‡æ— ç¬¦å·å³ç§»ï¼Œè®©æ¯12ä½æ— å·®åˆ«å¼‚æˆ–ï¼Œå³é«˜ä½Žä½èƒ½å¤Ÿå¾ˆå¥½çš„åˆ©ç”¨åˆ°äº†ã€‚ 1234567h ^= k.hashCode();// This function ensures that hashCodes that differ only by// constant multiples at each bit position have a bounded// number of collisions (approximately 8 at default load factor).h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4); ä½†è¿™ç§åšæ³•è¿˜ä¸å¤Ÿæžè‡´ï¼ŒJDK8ç‰ˆæœ¬çš„åšæ³•ï¼Œæ›´åŠ ç®€å•æ˜Žäº†ã€‚ 1return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); 4. ä½ é¡¹ç›®ä¸­æ˜¯å¦‚ä½•åŽ»å®žçŽ°å¹‚ç­‰æ€§çš„ï¼Ÿå…ˆè¯´ä¸‹æˆ‘å¯¹å¹‚ç­‰æ€§çš„ç†è§£ï¼Œè¿™æ ·å†åŽ»ç†è§£æˆ‘é¡¹ç›®å¯¹å¹‚ç­‰æ€§çš„å¤„ç†ã€‚ å®šä¹‰ ç”¨æˆ·å¯¹äºŽåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æžœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ å®žçŽ° å¹‚ç­‰æ€§åœ¨RPCä¸Šçš„å®žçŽ°ï¼Œä¸ä»…è¦è€ƒè™‘ç»“æžœä¸€è‡´æ€§ï¼Œè¿˜æœ‰è€ƒè™‘è¯·æ±‚å¤±è´¥åŽè´Ÿè½½åˆ°å…¶ä»–æœºå™¨ä¾æ—§ä¿è¯å¹‚ç­‰æ€§ï¼Œè¿™å°±ä¸èƒ½ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ¥å®žçŽ°ï¼Œè€Œè¦ç”¨åˆ°åˆ†å¸ƒå¼ç¼“å­˜ï¼ŒæŽ¨èçš„åˆ†å¸ƒå¼ç¼“å­˜å¯ä»¥æ˜¯Redisã€‚ éœ€è¦è€ƒè™‘åˆ°é‡è¯•çš„æ—¶æœºæ¥æ°å½“è®¾ç½®ç¼“å­˜çš„å¤±æ•ˆæ—¶é—´ï¼Œä¸€èˆ¬é€»è¾‘ä¸Šåªè¦ä¿è¯è¯·æ±‚æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼åŽé‡è¯•è¯·æ±‚æˆåŠŸå³å¯å¤±æ•ˆï¼Œå¯ä»Žé€»è¾‘æˆåŠŸè°ƒç”¨åŽåŽ»æ‰‹åŠ¨å¤±æ•ˆï¼Œæˆ–è€…æ˜¯è¾¾åˆ°é˜ˆå€¼åŽæ‰‹åŠ¨å¤±æ•ˆï¼Œä¸è¿‡è¿™ç§åšæ³•å¢žå¤§äº†Redisçš„é˜»å¡žï¼Œå› ä¸ºRedisæ˜¯å•çº¿ç¨‹ï¼Œæ²¡æ³•åšåˆ°å¹¶å‘ï¼ŒJedisè™½ç„¶å¯ä»¥å¹¶å‘ï¼Œä½†ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œè€ŒJedisæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºç«‹è¿žæŽ¥ï¼Œ æ‰€ä»¥å¯ä»¥è€ƒè™‘å…±äº«ä¸€ä¸ªè¿žæŽ¥ï¼Œä¸è¿‡è¯·æ±‚é€Ÿåº¦å°†å¤§å¤§é™ä½Žã€‚ è€Œè€ƒè™‘Lettuceåˆ™éœ€è¦æå‰å‡†å¤‡çº¿ç¨‹æ± ï¼ŒåŽé¢å°±å¯ä»¥ç›´æŽ¥ä»Žä»Žçº¿ç¨‹æ± å–è¿žæŽ¥ï¼Œè¿žæŽ¥æ•°æ›´å¥½ç®¡æŽ§ï¼Œæ€§èƒ½ä¹Ÿç›¸å¯¹é«˜ä¸€äº›ã€‚ 5. RPCçš„åè®®è®²ä¸€è®²ï¼Œæ€Žä¹ˆå¤„ç†çš„ï¼ŸRPCçš„è¯·æ±‚è¿‡ç¨‹ï¼š æœåŠ¡ç«¯å¯åŠ¨ï¼Œå¹¶å°†æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼› å®¢æˆ·ç«¯å¯åŠ¨é€šè¿‡ä»£ç†è°ƒç”¨æ‰€éœ€çš„è¿œç¨‹æ–¹æ³•ï¼› ä»£ç†ä»Žæ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡ï¼Œå¹¶ä½¿ç”¨æŸç§è´Ÿè½½ç­–ç•¥è°ƒç”¨å…¶ä¸­ä¸€ä¸ªæœåŠ¡ï¼› ä»£ç†å°†å®¢æˆ·ç«¯æƒ³è¦è°ƒç”¨çš„æ–¹æ³•ç­‰è°ƒç”¨ä¿¡æ¯åºåˆ—åŒ–ï¼Œç„¶åŽé€šè¿‡ç½‘ç»œä¼ è¾“ç»™æœåŠ¡ç«¯ï¼› æœåŠ¡ç«¯æŽ¥æ”¶åˆ°æ•°æ®åŽï¼Œè¿›è¡Œååºåˆ—åŒ–ï¼› æœåŠ¡ç«¯å¾—åˆ°ååºåˆ—åŒ–çš„æ•°æ®ï¼ŒåŒ…å«éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€å‚æ•°æ•°æ®ï¼ŒæŽ¥ç€è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼› æœåŠ¡ç«¯è°ƒç”¨å®Œæˆå°†ç»“æžœè¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åŽé€šè¿‡ç½‘ç»œä¼ è¾“ç»™ä»£ç†ï¼› ä»£ç†æ‹¿åˆ°ç»“æžœåŽï¼Œå°†ç»“æžœååºåˆ—åŒ–ï¼Œç„¶åŽè¿”å›žç»™å®¢æˆ·ç«¯ï¼› å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æœåŠ¡ç«¯è¿œç¨‹æ–¹æ³•è°ƒç”¨çš„ç»“æžœï¼› 6. é¡¹ç›®ä¸­æ˜¯æ€Žä¹ˆåºåˆ—åŒ–çš„ï¼Ÿé¡¹ç›®ä¸­ä½¿ç”¨åˆ°äº†ä¸¤ç§åºåˆ—åŒ–æ–¹å¼ï¼Œä¸€ç§æ˜¯Jacksonï¼Œå¦ä¸€ç§æ˜¯Kryoåºåˆ—åŒ–ï¼› è¿™ä¸¤ç§åºåˆ—åŒ–å·¥å…·éƒ½æä¾›å¯¹Javaå¯¹è±¡çš„åºåˆ—åŒ–ï¼Œå³è½¬æˆäºŒè¿›åˆ¶ï¼Œç„¶åŽè¿›è¡Œç½‘ç»œä¼ è¾“ï¼› æŽ¥æ”¶åˆ°ç½‘ç»œä¼ è¾“çš„äºŒè¿›åˆ¶ï¼Œå†åè¿‡æ¥è¿›è¡Œååºåˆ—åŒ–æˆå¯¹è±¡ï¼› ä¸è¿‡é¡¹ç›®åºåˆ—åŒ–çš„æ˜¯æ ¸å¿ƒæ•°æ®ï¼Œå¯¹ä¸€äº›è¯·æ±‚åŒ…å¤´åè®®ï¼Œæ˜¯ä½¿ç”¨äº†è‡ªå®šä¹‰ç¼–è§£ç çš„æ–¹å¼ï¼› å¯¹ç‰¹å®šçš„å­—èŠ‚ç è¿›è¡Œç¼–è§£ç è§£æžï¼Œä»Žè€Œå¯ä»¥é¿å…å‡ºçŽ°ç²˜åŒ…çš„é—®é¢˜ï¼› æ‹†å®ŒåŒ…ä¹‹åŽï¼Œå¯¹åŒ…ä¸­çš„æ ¸å¿ƒæ•°æ®è¿›è¡Œååºåˆ—åŒ–æ“ä½œ; å½“ç„¶å…·ä½“çš„æ“ä½œè¿˜æœ‰è€ƒè™‘åˆ°åŒ…çš„å…¶ä»–å®‰å…¨é—®é¢˜ï¼Œæ¯”å¦‚é‡å‘åŒ…å’Œæ ¡éªŒç å¤±è´¥åŒ…ã€‚ 7.è¯´ä¸€è¯´æ·±æ‹·è´å’Œæµ…æ‹·è´æµ…æ‹·è´ä¸»è¦æ‹·è´äº†å¯¹è±¡çš„æŒ‡é’ˆï¼Œæœ¬èº«æ•°æ®å¼•ç”¨çš„æ˜¯åŒä¸€å—å†…å­˜ï¼› æ·±æ‹·è´åˆ™æ‹·è´äº†å¯¹è±¡æœ¬èº«ï¼Œå¼•ç”¨çš„æ˜¯ä¸åŒçš„å†…å­˜ã€‚ åœ¨Javaä¸­ï¼Œæ·±æ‹·è´å’Œæµ…æ‹·è´æœ‰Objectçš„cloneæ‹·è´æ–¹æ³•ï¼ˆæµ…æ‹·è´ï¼‰ï¼› Arrays.copyï¼ˆæµ…æ‹·è´ï¼‰å’ŒSystem.arraycopyï¼ˆæµ…æ‹·è´ï¼‰ åºåˆ—åŒ–åˆ™æ˜¯æ·±æ‹·è´ï¼Œæ¯”å¦‚Javaå†…ç½®çš„ObjectOutputStreamçš„writeObjectæ–¹æ³•å’ŒObjectInputStreamçš„readObjectæ–¹æ³•ï¼› æ›´æ·±å…¥æ¥è®²ï¼Œæµ…æ‹·è´ä¸­ï¼Œç›®æ ‡å¯¹è±¡å¯¹å†…å­˜çš„æ“ä½œä¼šå½±å“åˆ°åŽŸå¯¹è±¡ï¼Œè€Œæ·±æ‹·è´åˆ™å—å½±å“ã€‚ 8. TCPå’ŒUDPäº†è§£ä¸‹ï¼ŸTCPä¸ŽUDPéƒ½æ˜¯ä¼ è¾“å±‚åè®®ï¼ŒTCPåŸºäºŽè¿žæŽ¥çš„ï¼ŒUDPåŸºäºŽéžè¿žæŽ¥çš„ï¼› ä»Žè¿žæŽ¥ä¸Šçœ‹ï¼ŒTCPéœ€è¦æœ‰ä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å®Œæˆè¿žæŽ¥ï¼Œä¹‹åŽæ‰èƒ½è¿›è¡Œé€šä¿¡ï¼Œæ˜¯å¯é çš„è¿žæŽ¥ï¼› è€ŒUDPä¸éœ€è¦è¿žæŽ¥ï¼Œæ²¡æœ‰TCPä¸¥è°¨çš„ä¸‰æ¬¡æ¡æ‰‹ã€ç¡®è®¤è¿žæŽ¥å’Œå››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ï¼Œæ˜¯ä¸å¯é çš„è¿žæŽ¥ï¼› TCPå¯ä»¥ä¿è¯æœåŠ¡çš„å¯é ï¼Œä¸€èˆ¬ç”¨äºŽé«˜å¯é æœåŠ¡ï¼ŒUDPä¸èƒ½ä¿è¯æœåŠ¡æ˜¯å¦å¯é ã€‚ ç‰¹ç‚¹ TCPï¼š ç¨³å®šå¯é ï¼Œé€‚ç”¨äºŽè¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œéœ€è¦å‡†ç¡®æ— è¯¯çš„ä¼ è¾“ç»™å¯¹æ–¹ï¼Œæ¯”å¦‚æ–‡ä»¶ä¼ è¾“ã€å‘é€é‚®ä»¶å’Œæµè§ˆç½‘é¡µç­‰ï¼› UDPï¼š é€Ÿåº¦å¿«ï¼Œæ€§èƒ½æŸè€—å°‘ã€èµ„æºå ç”¨å°‘ï¼Œä½†æ˜¯å¯èƒ½äº§ç”Ÿä¸¢åŒ…ï¼Œæ‰€ä»¥é€‚ç”¨äºŽå¯¹å®žæ—¶æ€§è¦æ±‚è¾ƒé«˜ï¼Œä½†æ˜¯å¯¹å°‘é‡ä¸¢åŒ…ï¼Œå¹¶æ²¡æœ‰å¤ªå¤§çš„è¦æ±‚çš„åœºæ™¯ï¼Œæ¯”å¦‚åŸŸåæŸ¥è¯¢ã€ç”µè¯é€šä¿¡å’Œè§†é¢‘ç›´æ’­ç­‰ã€‚ 9. Httpåº•å±‚ä½¿ç”¨äº†ä»€ä¹ˆï¼šTCPåè®®ï¼Œæ˜¯åŸºäºŽè¿žæŽ¥çš„ã€‚ httpè¯·æ±‚æŠ¥æ–‡ HTTPè¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œï¼ˆrequest lineï¼‰ã€è¯·æ±‚å¤´éƒ¨ï¼ˆheaderï¼‰ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®ç­‰4ä¸ªéƒ¨åˆ†ç»„æˆã€‚ è¯·æ±‚è¡Œï¼šï¼ˆget/post æ–¹æ³•ï¼Œurlä¸­çš„pathè·¯å¾„ï¼Œhttpç‰ˆæœ¬ï¼‰ è¯·æ±‚å¤´éƒ¨ï¼ˆheaderï¼‰å…³é”®å­—/å€¼å¯¹ç»„æˆï¼Œæ¯è¡Œä¸€å¯¹ï¼Œå…³é”®å­—å’Œå€¼ç”¨è‹±æ–‡å†’å· è¯·æ±‚æ•°æ® (body) httpå“åº”æŠ¥æ–‡ HTTPå“åº”æŠ¥æ–‡ç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š çŠ¶æ€ç ï¼ˆStatus Codeï¼‰ï¼šæè¿°äº†å“åº”çš„çŠ¶æ€ã€‚å¯ä»¥ç”¨æ¥æ£€æŸ¥æ˜¯å¦æˆåŠŸå®Œæˆäº†è¯·æ±‚ã€‚è¯·æ±‚å¤±è´¥çš„æƒ…å†µä¸‹ï¼ŒçŠ¶æ€ç å¯ç”¨æ¥æ‰¾å‡ºå¤±è´¥çš„åŽŸå› ã€‚å¦‚æžœServletæ²¡æœ‰è¿”å›žçŠ¶æ€ç ï¼Œé»˜è®¤ä¼šè¿”å›žæˆåŠŸçš„çŠ¶æ€ç HttpServletResponse SC OKã€‚ HTTPå¤´éƒ¨ï¼ˆHTTP Headerï¼‰ï¼šå®ƒä»¬åŒ…å«äº†æ›´å¤šå…³äºŽå“åº”çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼šå¤´éƒ¨å¯ä»¥æŒ‡å®šä»»åŠ¡å“åº”è¿‡æœŸçš„è¿‡æœŸæ—¥æœŸï¼Œæˆ–è€…æ˜¯æŒ‡å®šç”¨æ¥ç»™ç”¨æˆ·å®‰å…¨çš„ä¼ è¾“å®žä½“å†…å®¹çš„ç¼–ç æ ¼å¼ã€‚å¦‚ä½•åœ¨Servletä¸­æ£€ç´¢HTTPçš„å¤´éƒ¨çœ‹è¿™é‡Œã€‚ ç©ºè¡Œ ä¸»ä½“ï¼ˆBodyï¼‰ï¼šå®ƒåŒ…å«äº†å“åº”çš„å†…å®¹ã€‚å®ƒå¯ä»¥åŒ…å«HTMLä»£ç ã€å›¾ç‰‡ç­‰ã€‚ä¸»ä½“æ˜¯ç”±ä¼ è¾“åœ¨HTTPæ¶ˆæ¯ä¸­ç´§è·Ÿåœ¨å¤´éƒ¨åŽé¢çš„æ•°æ®å­—èŠ‚ç»„æˆçš„ã€‚ è¯·æ±‚è¿‡ç¨‹ å®¢æˆ·ç«¯è¿žæŽ¥æœåŠ¡å™¨ï¼š å®¢æˆ·ç«¯ä¸€èˆ¬ä¸ºWebæµè§ˆå™¨ï¼Œé€šè¿‡urlè®¿é—®æœåŠ¡ç«¯ï¼Œä¸ŽæœåŠ¡ç«¯å»ºç«‹ä¸€ä¸ªTCPçš„å¥—æŽ¥å­—ã€‚ å‘é€HTTPè¯·æ±‚ï¼š é€šè¿‡TCPå¥—æŽ¥å­—ï¼Œå‘é€HTTPè¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€äº†ä¸€ä¸ªæ–‡æœ¬çš„è¯·æ±‚æŠ¥æ–‡ï¼Œä¸€ä¸ªè¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®å››éƒ¨åˆ†ç»„æˆã€‚ è¿”å›žHTTPå“åº”ï¼š WebæœåŠ¡å™¨è§£æžè¯·æ±‚ï¼Œå®šä½è¯·æ±‚èµ„æºã€‚æœåŠ¡å™¨å°†èµ„æºå‰¯æœ¬å†™åˆ°TCPå¥—æŽ¥å­—ï¼Œæœ‰å®¢æˆ·ç«¯è¯»å–ã€‚ä¸€ä¸ªå“åº”ç”±çŠ¶æ€è¡Œã€å“åº”å¤´éƒ¨ã€ç©ºè¡Œå’Œå“åº”æ•°æ®å››éƒ¨åˆ†ç»„æˆã€‚ é‡Šæ”¾TCPè¿žæŽ¥ï¼š å½“connectionæ¨¡å¼ä¸ºcloseï¼Œä¸»åŠ¨å…³é—­æ–¹ä¸ºæœåŠ¡ç«¯ï¼Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­è¿žæŽ¥ï¼Œé‡Šæ”¾TCPè¿žæŽ¥ï¼› å½“connectionæ¨¡å¼ä¸ºkeepaliveï¼Œåˆ™è¯¥è¿žæŽ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œåœ¨è¯¥æ—¶é—´å¯ä»¥ç»§ç»­æŽ¥æ”¶å…¶ä»–è¯·æ±‚ï¼Œé•¿è¿žæŽ¥å¤ç”¨ï¼Œä¸Ž2.0çš„å¤šè·¯å¤ç”¨ç›®çš„éƒ½æ˜¯ä¸ºäº†é‡ç”¨è¿žæŽ¥ï¼Œå‡å°‘è¿žæŽ¥å¼€é”€ã€‚ 10. ä¸‰æ¬¡æŒ¥æ‰‹è¯´ä¸‹ï¼Ÿä¸‰æ¬¡æŒ¥æ‰‹ä¸Žå››æ¬¡æŒ¥æ‰‹å¾ˆåƒï¼Œå…ˆè¯´ä¸‹å››æ¬¡æŒ¥æ‰‹ã€‚ å››æ¬¡æŒ¥æ‰‹ ç”±ä¸»åŠ¨å…³é—­æ–¹(Client)å‘èµ·ä¸­æ–­è¿žæŽ¥è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯FINæŠ¥æ–‡ï¼Œè¢«åŠ¨å…³é—­æ–¹(Server)æŽ¥æ”¶åˆ°FINæŠ¥æ–‡åŽï¼Œä»Žåè®®ä¸Šæ¥è¯´æ˜¯ä¸»åŠ¨å…³é—­æ–¹åœ¨ç­‰å¾…æ”¶åˆ°FIN + ACKæŠ¥æ–‡æ®µï¼Œè¢«åŠ¨å…³é—­æ–¹ç”±äºŽæœ‰æ•°æ®è¦æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡æŒ¥æ‰‹åªå‘äº†ACKç¡®è®¤å·ï¼ŒæŽ¥ç€ä¸»åŠ¨å…³é—­æ–¹è¿›å…¥FIN_WAITçŠ¶æ€ï¼Œç»§ç»­ç­‰å¾…è¢«åŠ¨å…³é—­æ–¹çš„FINæŠ¥æ–‡ã€‚ å½“è¢«åŠ¨å…³é—­æ–¹æ•°æ®å‘é€å®ŒæˆåŽï¼Œå°†å‘é€FINæŠ¥æ–‡ç»™ä¸»åŠ¨å…³é—­æ–¹ï¼Œä¸»åŠ¨å…³é—­æ–¹æ”¶åˆ°FINæŠ¥æ–‡åŽï¼Œä¸»åŠ¨å…³é—­æ–¹å®Œæˆå…³é—­ï¼Œä½†è¢«åŠ¨å…³é—­æ–¹å¹¶ä¸çŸ¥é“FINæŠ¥æ–‡æ˜¯å¦è¢«æŽ¥æ”¶æˆåŠŸï¼Œæ‰€ä»¥ä¸»åŠ¨å…³é—­æ–¹å…³é—­å‰è¿˜éœ€å‘é€ACKç»™è¢«åŠ¨å…³é—­æ–¹ï¼Œè¡¨ç¤ºå·²æˆåŠŸæŽ¥æ”¶è¢«åŠ¨å…³é—­æ–¹çš„FINæŠ¥æ–‡ï¼Œè¿™æ—¶è¢«åŠ¨å…³é—­æ–¹å°±å¯ä»¥æ–­å¼€è¿žæŽ¥äº†ã€‚ å¦‚æžœæ²¡æ”¶åˆ°å°†å†æ¬¡å‘é€FINæŠ¥æ–‡ç»™ä¸»åŠ¨å…³é—­æ–¹ï¼Œæœ€åŽä¸»åŠ¨å…³é—­æ–¹ä¹Ÿä¸çŸ¥é“è¢«åŠ¨å…³é—­æ–¹æ˜¯å¦æŽ¥æ”¶ï¼Œéœ€è¦ç­‰å¾…2MSLæ—¶é—´ï¼Œå¦‚æžœæ²¡æ”¶åˆ°é‡å‘åŒ…å³æˆåŠŸäº†ã€‚ ä¸‰æ¬¡æŒ¥æ‰‹ ä¸‰æ¬¡æŒ¥æ‰‹ä¸åŒäºŽå››æ¬¡æŒ¥æ‰‹ï¼Œä¸åŒæ˜¯ç¬¬äºŒæ¬¡ä¸Žç¬¬ä¸‰æ¬¡æŒ¥æ‰‹åˆå¹¶äº†ï¼Œå¦‚æžœæœåŠ¡ç«¯æ²¡æœ‰æ•°æ®è¦å‘é€ï¼Œå°±å¯ä»¥å°†ç¬¬äºŒæ¬¡ä¸Žç¬¬ä¸‰æ¬¡æŒ¥æ‰‹åˆå¹¶ï¼Œè€Œå¦‚æžœæœ‰æ•°æ®è¦å‘ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å…è®¸å»¶è¿Ÿæ”¶åˆ°ç¡®è®¤ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å¯ä»¥å°†ç»“æžœå°è£…åˆ°ç¬¬äºŒæ¬¡ä¸Žç¬¬ä¸‰æ¬¡åˆå¹¶çš„æŠ¥æ–‡æ®µä¸­ä¸€èµ·å‘é€ã€‚ 11. è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»ï¼Ÿ å®šä¹‰ è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ã€‚ åŒ…å«å…³ç³» çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œä¸€ä¸ªçº¿ç¨‹åªèƒ½å±žäºŽä¸€ä¸ªè¿›è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ å†…å­˜è§’åº¦ æ¯ä¸ªè¿›ç¨‹åˆ†é…äº†ä¸åŒçš„å†…å­˜ç©ºé—´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œè€ŒåŒä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹ï¼ˆç®€ç§°åŒç±»çº¿ç¨‹ï¼‰åœ¨å…¶åˆ†é…çš„æŒ‡å®šå†…å­˜ä¸­è¿è¡Œï¼Œéœ€è¦CPUæ¥è°ƒåº¦è¿™ä¸€å—å†…å­˜åŒºåŸŸã€‚ ç³»ç»Ÿä¸ä¼šä¸ºçº¿ç¨‹åˆ†é…èµ„æºï¼Œåªèƒ½é€šè¿‡CPUæ¥è°ƒåº¦å’Œåˆ†æ´¾èµ„æºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›ç¨‹åˆ†é…å†…å­˜èµ„æºï¼Œç„¶åŽçº¿ç¨‹éœ€è¦CPUæ¥è¿‡æ¸¡ä½¿ç”¨è¿™å—å†…å­˜ã€‚ è¿›ç¨‹åˆ‡æ¢å¼€é”€å¤§ï¼Œçº¿ç¨‹åˆ‡æ¢å¼€é”€å°ã€‚ å…±äº«è§’åº¦ åŒç±»çº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«å †ç©ºé—´å’Œæ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è™šæ‹Ÿæœºæ ˆå’Œç¨‹åºè®¡æ•°å™¨ã€‚ è¿›è¡Œå…±äº«çš„æ–¹å¼ çº¿ç¨‹å…±äº«çŽ¯å¢ƒï¼šè¿›ç¨‹ä»£ç æ®µã€è¿›ç¨‹å…¬æœ‰æ•°æ®ã€è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†å™¨ã€è¿›ç¨‹å½“å‰ç›®å½•å’Œè¿›ç¨‹ç”¨æˆ·IDä¸Žè¿›ç¨‹ç»„ID è¿›ç¨‹é€šä¿¡çš„æ–¹å¼ åŒ¿åç®¡é“ (PIPE) åŠåŒå·¥ï¼Œå³ä¸èƒ½åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šä¼ è¾“æ•°æ®ï¼Œæœ‰çš„ç³»ç»Ÿå¯èƒ½æ”¯æŒå…¨åŒå·¥ã€‚ é€Ÿåº¦æ…¢ï¼Œå®¹é‡æœ‰é™ï¼Œä¸”åªèƒ½åœ¨çˆ¶å­è¿›ç¨‹é—´ã€‚ç»å…¸çš„å½¢å¼å°±æ˜¯ç®¡é“ç”±çˆ¶è¿›ç¨‹åˆ›å»ºï¼Œè¿›ç¨‹forkå­è¿›ç¨‹ä¹‹åŽï¼Œå°±å¯ä»¥åœ¨çˆ¶å­è¿›ç¨‹ä¹‹é—´ä½¿ç”¨äº†ã€‚ å‘½åç®¡é“ (FIFO) ä¸æƒ³å…³çš„è¿›ç¨‹ä¹Ÿèƒ½å¤Ÿè¿›è¡Œæ•°æ®äº¤æ¢ã€‚ æ¶ˆæ¯é˜Ÿåˆ— æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°±æ˜¯ä¸€ä¸ªæ¶ˆæ¯çš„é“¾è¡¨ï¼Œæ˜¯ä¸€ç³»åˆ—ä¿å­˜åœ¨å†…æ ¸ä¸­æ¶ˆæ¯çš„åˆ—è¡¨ã€‚ ä¿¡å·é‡ ä¿¡å·é‡æ˜¯äº’æ–¥ä¿¡å·é‡ï¼Œèƒ½å¤Ÿç”¨æ¥åŒæ­¥é€šä¿¡ã€‚ å…±äº«å†…å­˜ é€šè¿‡å…±äº«å†…å­˜æœºåˆ¶æ¥å®žçŽ°ã€‚ å¥—æŽ¥å­— å¥—æŽ¥å­—é€šè¿‡Socketç»‘å®šå¥—æŽ¥å­—ï¼ŒæœåŠ¡ç«¯å¼€å¯ç›‘å¬è¢«åŠ¨è¿žæŽ¥ï¼Œå®¢æˆ·ç«¯ä¸»åŠ¨è¿žæŽ¥ï¼Œå‘å¥—æŽ¥å­—è¯»å†™æ•°æ®å®žçŽ°é€šä¿¡ã€‚ ä¿¡å· ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ï¼Œå¯åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸­äº¤äº’ï¼Œä¹Ÿå¯ä»¥åœ¨å†…æ ¸æ€ä¸­é€šçŸ¥ç”¨æˆ·æ€äº‹ä»¶çš„å‘ç”Ÿã€‚ 12. äº†è§£è¿‡CASå˜›ï¼ŸCASæ˜¯ä¸€ç§ä¹è§‚é”çš„å®žçŽ°ï¼ŒCASæ“ä½œåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°â€”â€”å†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸåŽŸå€¼ï¼ˆAï¼‰æœŸå¾…å€¼ï¼ˆBï¼‰ã€‚ å¦‚æžœå†…å­˜ä½ç½®çš„å€¼ä¸Žé¢„æœŸå€¼å‘åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæœŸå¾…å€¼ï¼Œå¦åˆ™ä¸åšä»»ä½•æ“ä½œã€‚ ç¼ºé™·ï¼šæ— æ³•è§£å†³ABAé—®é¢˜ï¼Œåœ¨Javaä¸­è§£å†³è¯¥é—®é¢˜ä½¿ç”¨åˆ°äº†AtomicStampReferenceå’ŒAtomicMarkableReferenceæ¥è§£å†³ æ•°æ®åº“ä¸­MySQLçš„é”æœºåˆ¶ä¹Ÿæ˜¯é€šè¿‡ä¹è§‚é”æ¥å®žçŽ°ï¼Œæ›´å…·ä½“çš„å®žçŽ°åˆ™æ˜¯MVCCå¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ã€‚ å…·ä½“æ˜¯ä¸¤ä¸ªæ•°æ®ç»“æž„ï¼Œä¸€ä¸ªä¸ºundo logæ—¥å¿—ï¼Œä¸€ä¸ªä¸ºreadViewå¯è¯»è§†å›¾ã€‚ æ¯å¼ è¡¨ä¸­éƒ½ä¼šæœ‰éšè—çš„ä¸¤åˆ—ï¼Œä¸€åˆ—æ˜¯undo logæŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰è¡Œæ•°æ®æ“ä½œæŒ‡å‘çš„æ•°æ®é“¾è¡¨ç»“æž„ï¼Œå¦ä¸€åˆ—ä¸ºäº‹åŠ¡ç‰ˆæœ¬å·idï¼Œå³æ¯æ¬¡äº‹åŠ¡å¼€å¯åŽéƒ½ä¼šèŽ·å–ä¸€ä¸ªè‡ªå¢žé•¿çš„äº‹åŠ¡idï¼Œè¿™æ ·åœ¨ReadViewå¯è¯»è§†å›¾ä¸­å®žçŽ°ä¹è§‚æ“ä½œï¼Œå›žåˆ°æœ€å…ˆå®šä¹‰ä¹è§‚é”ä¸‰ä¸ªæ“ä½œæ•°ï¼Œå®žçŽ°æ–¹å¼å·®ä¸å¤šã€‚ undo log ä¸»è¦å¯¹æ‰€æœ‰å¹¶å‘ä¿®æ”¹ç»“æžœä¿å­˜äº†ä¸‹æ¥ï¼Œå¹¶ä»¥é“¾è¡¨çš„å½¢å¼ç»„ç»‡ã€‚ ReadViewä¸»è¦å¤„ç†äº‹åŠ¡idçš„å¯è§æ€§ï¼ŒåŒ…å«å½“å‰æ´»è·ƒäº‹åŠ¡ç‰ˆæœ¬Idåˆ—è¡¨ï¼Œæ´»è·ƒæœ€å°äº‹åŠ¡idï¼ˆup_limit_idï¼‰å³å·²æäº¤æœ€å¤§äº‹åŠ¡id + 1ï¼Œæ´»è·ƒæœ€å¤§äº‹åŠ¡idï¼ˆlow_limit_idï¼‰å³æœ€å°ä¸å¯è§äº‹åŠ¡id - 1å’Œcreator_trx_idè¡¨ç¤ºå½“å‰äº‹åŠ¡å¼€å¯çš„ç‰ˆæœ¬å·ã€‚ æ´»è·ƒäº‹åŠ¡å³ä¸ºåŒä¸€æ—¶é—´å¹¶å‘ä¸‹ï¼Œæ‰€æœ‰å‘ç”Ÿäº†äº¤å‰çš„äº‹åŠ¡ã€‚ 13. ä½ çš„RPCé¡¹ç›®æ€Žä¹ˆæ€Žä¹ˆåˆ’åˆ†æ¨¡å—çš„ï¼Ÿ æœåŠ¡å‘çŽ°ï¼ˆä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–æœåŠ¡åŠå¯¹åº”åœ°å€ã€ä½¿ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æœåŠ¡ï¼‰ æœåŠ¡æ³¨å†Œè€…ï¼ˆæ³¨å†ŒæœåŠ¡åå’Œå¯¹åº”åœ°å€åˆ°æ³¨å†Œä¸­å¿ƒã€è¿žæŽ¥æ³¨å†Œä¸­å¿ƒã€æ¸…é™¤æœåŠ¡ï¼‰ æœåŠ¡æä¾›è€…ï¼ˆå­˜æ”¾æœåŠ¡å®žä¾‹ã€èŽ·å–æœåŠ¡å®žä¾‹ï¼‰ å®¢æˆ·ç«¯ä»£ç†ï¼ˆå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€å¤„ç†è¶…æ—¶é‡è¯•ã€è´Ÿè´£åˆ†å¸ƒå¼è¯·æ±‚idç”Ÿæˆï¼‰ æœåŠ¡ç«¯ï¼ˆå¯åŠ¨æœåŠ¡æ—¶å°†æœåŠ¡æ‰€æœ‰ç±»å®žä¾‹åŒ–å¹¶å­˜æ”¾åˆ°æœåŠ¡æä¾›è€…ï¼Œå°†æ‰€æœ‰æœåŠ¡ç±»å¯¹åº”æœåŠ¡åæ³¨å†Œåˆ°æœåŠ¡æ³¨å†Œè€…ã€å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ–¹æ³•ã€å¤„ç†è¶…æ—¶åŒ…ã€å¤„ç†é‡å‘åŒ…ã€å¤„ç†å¼‚å¸¸åŒ…ï¼‰ æœåŠ¡ç«¯å¤„ç†å™¨ï¼ˆä»ŽæœåŠ¡æä¾›è€…èŽ·å–æœåŠ¡å®žä¾‹ã€è¯»å–è¯·æ±‚åŒ…ä»£ç†æ‰§è¡ŒæœåŠ¡å¯¹åº”æ–¹æ³•ï¼‰ å¼‚æ­¥è¯·æ±‚æ± ï¼ˆå®¢æˆ·ç«¯è¯·æ±‚è°ƒç”¨åŽç«‹é©¬è¿”å›žfutureç»“æžœï¼Œç”±nettyå®¢æˆ·ç«¯æ­£ç¡®è¯»å–ç»“æžœåŽè¿”å›žç»™å¼‚æ­¥è¯·æ±‚æ± ï¼‰ ç¼–ç ä¸Žè§£ç å™¨ï¼ˆå¯¹è¯·æ±‚åŒ…å’Œå“åº”åŒ…çš„å°åŒ…å’Œæ‹†åŒ…ï¼‰ åŒ…æ£€æŸ¥å™¨ï¼ˆå¯¹è¯·æ±‚åŒ…å’Œå“åº”åŒ…çš„å®‰å…¨æ£€éªŒï¼‰ æ³¨å†Œä¸­å¿ƒï¼ˆæš´éœ²æœåŠ¡çœŸå®žåœ°å€å’Œç«¯å£å·ã€æä¾›æœåŠ¡æ³¨å†Œä¸Žå‘çŽ°ï¼‰ åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆç¼“å­˜æ—¶é—´æˆ³ä¸Žåºåˆ—å·ã€é‡è¯•è¯·æ±‚å·ä¸Žè¯·æ±‚ç»“æžœã€æœºå™¨ç ï¼‰ æœåŠ¡å®•æœºé’©å­ï¼ˆä¸­å¿ƒæœåŠ¡ä¸‹çº¿ä¸Žæœ¬åœ°æœåŠ¡æ¸…é™¤ã€ä¸‹çº¿æœºå™¨ç ã€çº¿ç¨‹æ± å…³é—­ï¼‰ 14. åšä¸€å¥—ç®—æ³•é¢˜å¦‚æœ‰å‡åºé“¾è¡¨ï¼šlist1 = [1,2,3]ï¼Œlist2 = [1,4,5]ï¼Œåˆ™åˆå¹¶åŽçš„é“¾è¡¨ï¼šlist = [1,1,2,3,4,5] 123456789101112131415161718192021222324252627private List concat(List list1, List list2) &#123; // å¤´ç»“ç‚¹å­˜å‚¨æ•°æ® List p = list1; List q = list2; List newNode = new List(); List head = newNode; while(p.next != null &amp;&amp; q.next != null) &#123; if (p.data &lt; q.data) &#123; newNode.next = p; p = p.next; &#125; else &#123; newNode.next = q; q = q.next; &#125; newNode = newNode.next; &#125; // list2 ä»å­˜åœ¨èŠ‚ç‚¹ if (p.next == null &amp;&amp; q.next != null) &#123; newNode.next = q; &#125; // list1 ä»å­˜åœ¨èŠ‚ç‚¹ if (p.next != null &amp;&amp; q.next == null) &#123; newNode.next = p; &#125; return head.next;&#125;","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"}],"author":"fyupeng"},{"title":"SpringBootæ•´åˆrpc-netty-framework","slug":"SpringBootæ•´åˆrpc-netty-framework","date":"2022-10-20T09:15:08.000Z","updated":"2022-10-20T09:29:20.128Z","comments":true,"path":"2022/10/20/SpringBootæ•´åˆrpc-netty-framework/","link":"","permalink":"http://fyupeng.github.io/2022/10/20/SpringBoot%E6%95%B4%E5%90%88rpc-netty-framework/","excerpt":"","text":"ä¸€ä¸ªåˆ†å¸ƒå¼å¾®æœåŠ¡RPCæ¡†æž¶ | è¿”å›ž ä½¿ç”¨æ•ˆæžœï¼š ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯ï¼šGET http://localhost:8081/user/hello?name=&quot;å¼ ä¸‰æ¥è®¿&quot; æµè§ˆå™¨è®¿é—®å®¢æˆ·ç«¯ï¼š æœåŠ¡ç«¯æŽ¥æ”¶æƒ…å†µï¼š æœåŠ¡ç«¯è´Ÿè½½æ³¨å†ŒæœåŠ¡ï¼š ä¸Šé¢çš„å®žçŽ°å°±å¥½æ¯”å®¢æˆ·ç«¯åªæ‹¿åˆ°æœåŠ¡ç«¯çš„apiæŽ¥å£ï¼ŒåŠ ä¸Šé…ç½®ä¸­å¿ƒåœ°å€å³å¯è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼ 1. åˆ›å»ºå·¥ç¨‹åˆ›å»ºä¸¤ä¸ªå·¥ç¨‹ï¼Œä¸€ä¸ªä½œä¸ºæœåŠ¡ç«¯SpringBootã€ä¸€ä¸ªä½œä¸ºå®¢æˆ·ç«¯SpringBootï¼ŒåŒæ—¶ä½œä¸ºåŽç«¯æŽ¥å£æœåŠ¡ åˆ›å»ºMavenå·¥ç¨‹çš„æ—¶å€™æŽ¨èä½¿ç”¨çˆ¶å­å·¥ç¨‹ä¾èµ–ï¼Œè€Œä¸”è¦æ³¨æ„å­æ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå…¶ä¸­ï¼š çˆ¶æ¨¡å—ï¼ˆrooté¡¹ç›®ï¼‰ï¼šè´Ÿè´£ç®¡ç†SpringBootç‰ˆæœ¬ã€ç»Ÿä¸€ç‰ˆæœ¬ã€JDKç‰ˆæœ¬ã€æ—¥å¿—ä¾èµ– 1234567891011121314151617181920212223242526272829303132333435&lt;profiles&gt; &lt;profile&gt; &lt;id&gt;jdk1.8&lt;/id&gt; &lt;activation&gt; &lt;activeByDefault&gt;true&lt;/activeByDefault&gt; &lt;jdk&gt;1.8&lt;/jdk&gt; &lt;/activation&gt; &lt;properties&gt; &lt;maven-compiler-source&gt;1.8&lt;/maven-compiler-source&gt; &lt;maven-compiler-target&gt;1.8&lt;/maven-compiler-target&gt; &lt;maven-copiler-compilerVersion&gt;1.8&lt;/maven-copiler-compilerVersion&gt; &lt;/properties&gt; &lt;/profile&gt;&lt;/profiles&gt;&lt;parent&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;&lt;version&gt;2.1.2.RELEASE&lt;/version&gt;&lt;relativePath/&gt;&lt;/parent&gt;&lt;dependencies&gt;&lt;!-- ä¸Ž logbakc æ•´åˆ --&gt;&lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;version&gt;1.18.10&lt;/version&gt;&lt;/dependency&gt;&lt;!-- æ—¥å¿—æ¡†æž¶ --&gt;&lt;dependency&gt; &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt; &lt;artifactId&gt;logback-classic&lt;/artifactId&gt; &lt;version&gt;1.2.3&lt;/version&gt;&lt;/dependency&gt;&lt;/dependencies&gt; ä¸»æ¨¡å—ï¼ˆå¯åŠ¨ç±»æ‰€åœ¨æ¨¡å—ï¼‰åº”é…ç½®mavenæ‰“åŒ…æ’ä»¶ï¼ŒSpringBootStarterWebï¼Œrpc-coreå’Œä¾èµ–Service/Controlleræ¨¡å—ï¼Œå®¢æˆ·ç«¯åªæœ‰Serviceæ¨¡å—ï¼ŒæœåŠ¡ç«¯åªæœ‰Controlleræ¨¡å— 12345678910111213141516171819202122232425262728&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.fyupeng&lt;/groupId&gt; &lt;artifactId&gt;springboot-rpc-service&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.fyupeng&lt;/groupId&gt; &lt;artifactId&gt;rpc-core&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt;&lt;/dependencies&gt;&lt;build&gt;&lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt;&lt;/plugins&gt;&lt;/build&gt; Service/Controlleræ¨¡å—ï¼šä¾èµ–apiæ¨¡å—å’Œcommonæ¨¡å—ï¼Œå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯è°ƒç”¨æœåŠ¡ï¼Œå½“ç„¶æ²¡æœ‰Serviceæ¨¡å—ï¼Œè®©ä¸»æ¨¡å—ä¾èµ–Controlleræ¨¡å—ï¼ŒControlleræ¨¡å—è¿˜è¦ä¸Žä¸»æ¨¡å—ä¸€æ ·ä¾èµ–SpringBootStarterWebå’Œrpc-core 123456789101112&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.fyupeng&lt;/groupId&gt; &lt;artifactId&gt;springboot-rpc-common&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;cn.fyupeng&lt;/groupId&gt; &lt;artifactId&gt;springboot-rpc-api&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; Commonæ¨¡å—ï¼Œä¾èµ–rpc-commonæ¨¡å— 1234567&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;cn.fyupeng&lt;/groupId&gt; &lt;artifactId&gt;rpc-common&lt;/artifactId&gt; &lt;version&gt;2.0.0&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; é¡¹ç›®åœ¨å‡†å¤‡æµ‹è¯•æœåŠ¡ç«¯çš„è‡ªåŠ¨å‘çŽ°æœåŠ¡åŠŸèƒ½æ—¶ï¼Œè¦ä¿è¯cn.fyupeng.@Serviceæ³¨è§£ç±»èƒ½å¤Ÿè¢«æ‰«æï¼Œä½¿ç”¨cn.fyupeng.util.ReflectUtilç±»å³å¯ã€‚ 12345678public class Test &#123; public static void main(String[] args) throws IOException &#123; Set&lt;Class&lt;?&gt;&gt; classes = ReflectUtil.getClasses(&quot;cn.fyupeng&quot;); for (Class&lt;?&gt; aClass : classes) &#123; System.out.println(aClass); &#125; &#125;&#125; 2. å®¢æˆ·ç«¯2.1 ç¼–å†™å¯åŠ¨å™¨æ–°å»ºcn.fyupengåŒ…ï¼ŒåŒ…ä¸‹æ–°å»ºå¯åŠ¨å™¨ç±» 1234567@SpringBootApplication@ComponentScan(basePackages = &#123;&quot;cn.fyupeng&quot;,&quot;org.utils&quot;&#125;)public class SpringBootClientStarter &#123; public static void main(String[] args) &#123; SpringApplication.run(SpringBootClientStarter.class, args); &#125;&#125; 2.2 ç¼–å†™é…ç½®æ–‡ä»¶123456# å•æœºæ¨¡å¼cn.fyupeng.nacos.register-addr=192.168.10.1:8848# é›†ç¾¤æ¨¡å¼cn.fyupeng.nacos.cluster.use=truecn.fyupeng.nacos.cluster.load-balancer=roundcn.fyupeng.nacos.cluster.nodes=192.168.10.1:8847|192.168.10.1:8848;192.168.10.1:8849 2.3 ç¼–å†™è‡ªå®šä¹‰é…ç½®ç±»2.4 ç¼–å†™apiæ³¨æ„ä¸Žå®¢æˆ·ç«¯åŒ…åå®Œå…¨ç›¸åŒ 123456789101112package cn.fyupeng.service;/** * @Auther: fyp * @Date: 2022/10/19 * @Description: HelloWorldæŽ¥å£ * @Package: cn.fyupeng.cn.fyupeng.controller * @Version: 1.0 */public interface HelloService &#123; String sayHello(String name);&#125; 2.5 ç¼–å†™æŽ§åˆ¶å™¨@PostConstructæ³¨è§£ä¸è¦ä¸Ž@Autowireå…¬ç”¨ï¼Œå› ä¸º@Autowireæ˜¯æœ¬åœ°ä¾èµ–çš„ï¼Œè€Œæˆ‘@PostConstructä¼šåœ¨è¯¥å˜é‡ä½¿ç”¨å‰è°ƒç”¨ï¼Œä¸è¿‡éœ€è¦è‡ªè¡ŒåŽ»å®žçŽ°ï¼Œæˆ‘çš„å®žçŽ°æ˜¯è¿œç¨‹ä¾èµ–ã€‚ è€Œ@Referenceæ²¡æœ‰ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼Œåªæœ‰åœ¨è¶…æ—¶é‡è¯•æ‰éœ€è¦æ ‡è®°ä¸Šï¼ @PostContructä¸Ž@Autowireåœ¨51ctoåšå®¢ä¸­æœ‰æ‰€è®²è§£ï¼Œè¯·è‡ªè¡Œåˆ°æˆ‘çš„githubä¸»é¡µget 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package cn.fyupeng.controller;import cn.fyupeng.anotion.Reference;import cn.fyupeng.loadbalancer.RandomLoadBalancer;import cn.fyupeng.net.netty.client.NettyClient;import cn.fyupeng.proxy.RpcClientProxy;import cn.fyupeng.serializer.CommonSerializer;import cn.fyupeng.service.HelloService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import org.utils.JSONResult;import javax.annotation.PostConstruct;/** * @Auther: fyp * @Date: 2022/10/19 * @Description: HelloWorldæŽ§åˆ¶å™¨ * @Package: cn.fyupeng.cn.fyupeng.controller * @Version: 1.0 */@RequestMapping(&quot;/user&quot;)@RestControllerpublic class HelloController &#123; //@Autowired //private HelloService helloService; private static final RandomLoadBalancer randomLoadBalancer = new RandomLoadBalancer(); private static final NettyClient nettyClient = new NettyClient(randomLoadBalancer, CommonSerializer.KRYO_SERIALIZER); private static final RpcClientProxy rpcClientProxy = new RpcClientProxy(nettyClient); @Reference(retries = 5, timeout = 600, asyncTime = 3000) //@Autowired private HelloService helloService; @PostConstruct public void init() &#123; helloService = rpcClientProxy.getProxy(HelloService.class, HelloController.class); &#125; @GetMapping(&quot;/hello&quot;) public JSONResult sayHello(String name) &#123; return JSONResult.ok(helloService.sayHello(name)); &#125;&#125; 3. æœåŠ¡ç«¯3.1 ç¼–å†™é…ç½®ç±»æ–°å»ºcn.fyupeng.configåŒ…ï¼Œåœ¨åŒ…ä¸‹æ–°å»ºèµ„æºé…ç½®ç±»ï¼Œç”¨äºŽæ³¨å…¥ç»‘å®šç«¯å£ 123456789101112131415@Configuration@ConfigurationProperties(prefix=&quot;cn.fyupeng.config&quot;)//ä¸ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶application.propertieså’Œapplication.yml@PropertySource(&quot;classpath:resource.properties&quot;)public class ResourceConfig &#123; private int serverPort; public int getServerPort() &#123; return serverPort; &#125; public void setServerPort(int serverPort) &#123; this.serverPort = serverPort; &#125;&#125; 3.2 ç¼–å†™å¯åŠ¨å™¨123456789101112131415161718192021222324252627282930313233343536373839@Slf4j@ServiceScan@SpringBootApplication@ComponentScan(basePackages = &#123;&quot;cn.fyupeng&quot;, &quot;org.utils&quot;&#125;)public class RpcServerStarter implements CommandLineRunner &#123; @Autowired private ResourceConfig resourceConfig; @PostConstruct public void init() &#123; Map&lt;String, String&gt; resourceLoaders = ResourceLoadUtils.load(&quot;resource.properties&quot;); if (resourceLoaders != null) &#123; String serverPort = resourceLoaders.get(&quot;cn.fyupeng.config.serverPort&quot;); resourceConfig.setServerPort(Integer.parseInt(serverPort)); &#125; &#125; public static void main(String[] args) &#123; SpringApplication.run(RpcServerStarter.class,args); &#125; @Override public void run(String... args) throws Exception &#123; //è¿™é‡Œä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›ä¸šåŠ¡å¤„ç†æ–¹æ³•ï¼Œæ¯”å¦‚ä¸€äº›åˆå§‹åŒ–å‚æ•°ç­‰ while(true)&#123; NettyServer nettyServer = null; try &#123; nettyServer = new NettyServer(&quot;192.168.2.185&quot;, resourceConfig.getServerPort(), SerializerCode.KRYO.getCode()); &#125; catch (RpcException e) &#123; e.printStackTrace(); &#125; log.info(&quot;Service bind in port with &quot;+ resourceConfig.getServerPort() +&quot; and start successfully!&quot;); nettyServer.start(); log.error(&quot;RegisterAndLoginService is diedï¼ŒService is restarting....&quot;); &#125; &#125;&#125; 3.3 ç¼–å†™é…ç½®æ–‡ä»¶æ³¨æ„config/resource.propertiesä¸Žèµ„æºç›®å½•ä¸‹çš„resource.propertiesä¸èƒ½åŒæ—¶å…¬ç”¨ï¼Œå‰è€…ä¼˜å…ˆçº§é«˜äºŽåŽè€… 123456789# ç”¨äºŽå¯åŠ¨ jar åŒ…ç«¯å£cn.fyupeng.config.serverPort=8082# ç”¨äºŽé…ç½®ä¸­å¿ƒå•æœºcn.fyupeng.nacos.register-addr=192.168.2.185:8848# ç”¨äºŽé…ç½®ä¸­å¿ƒé›†ç¾¤cn.fyupeng.nacos.cluster.use=truecn.fyupeng.nacos.cluster.load-balancer=roundcn.fyupeng.nacos.cluster.nodes=192.168.2.185:8847|192.168.2.185:8848;192.168.2.185:8849 3.4 ç¼–å†™apiæ³¨æ„ä¸Žå®¢æˆ·ç«¯åŒ…åå®Œå…¨ç›¸åŒ 123456789101112package cn.fyupeng.service;/** * @Auther: fyp * @Date: 2022/10/19 * @Description: HelloWorldæŽ¥å£ * @Package: cn.fyupeng.cn.fyupeng.controller * @Version: 1.0 */public interface HelloService &#123; String sayHello(String name);&#125; 3.5 ç¼–å†™ä¸šåŠ¡æ³¨æ„Serviceæ³¨è§£ä¸ºcn.fyupeng.service.HelloService 12345678910111213141516171819202122package cn.fyupeng.service.impl;import cn.fyupeng.anotion.Service;import cn.fyupeng.service.HelloService;/** * @Auther: fyp * @Date: 2022/10/19 * @Description: HelloWorldå®žçŽ°ç±» * @Package: cn.fyupeng.cn.fyupeng.controller.impl * @Version: 1.0 */@Servicepublic class HelloServiceImpl implements HelloService &#123; @Override public String sayHello(String name) &#123; return &quot;hello, my name is &quot; + name; &#125;&#125; ä¸ºäº†ä½¿ç”¨é…ç½®æ–‡ä»¶æ³¨å…¥æ¥å¯åŠ¨æœåŠ¡å¯¹åº”çš„ç«¯å£","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"RPC","slug":"RPC","permalink":"http://fyupeng.github.io/tags/RPC/"}],"author":null},{"title":"å°è¿ˆç§‘æŠ€ä¸€é¢","slug":"å°è¿ˆç§‘æŠ€ä¸€é¢","date":"2022-09-29T08:00:20.000Z","updated":"2022-09-29T08:02:24.370Z","comments":true,"path":"2022/09/29/å°è¿ˆç§‘æŠ€ä¸€é¢/","link":"","permalink":"http://fyupeng.github.io/2022/09/29/%E5%B0%8F%E8%BF%88%E7%A7%91%E6%8A%80%E4%B8%80%E9%9D%A2/","excerpt":"","text":"ç®€å•ä¸‰åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»è‡ªæˆ‘ä»‹ç»è¿™é‡Œä¸€ç¬”å¸¦è¿‡ï¼Œç»™å¯¹é¢ä»‹ç»è‡ªå·±å†…åœ¨ + å¤–åœ¨ + æ ¡å›­ç»åŽ† + æ ¡å›­é¡¹ç›® + æ„å‘å²—ä½ ä¸€é¢1. JavaåŸºç¡€1.1 åºåˆ—åŒ–å’Œååºåˆ—åŒ–é¦–å…ˆäº†è§£ä¸€ä¸‹åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¦‚å¿µ åºåˆ—åŒ–ï¼šå°†Javaå¯¹è±¡ä»¥äºŒè¿›åˆ¶å³å­—èŠ‚ç çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¯´æ˜¯ä¿å­˜Javaå¯¹è±¡çŠ¶æ€çš„è¿‡ç¨‹ï¼Œåºåˆ—åŒ–å¯ä»¥å®žçŽ°å¯¹è±¡ä¿å­˜çš„æŒä¹…åŒ–ï¼› ååºåˆ—åŒ–ï¼šå°†ä¿å­˜åœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„Javaå­—èŠ‚ç é‡æ–°è½¬æ¢ä¸ºJavaå¯¹è±¡çš„è¿‡ç¨‹ï¼› å…¶ä»–ç‰¹ç‚¹ï¼šä¸€èˆ¬RPCæ¡†æž¶åº•å±‚åè®®é€šä¿¡å°±æ˜¯é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–åœ¨ç½‘ç»œä¸Šä¼ è¾“Javaå¯¹è±¡ã€‚ åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å®žçŽ°ä¸»è¦æœ‰ä¸¤ç§ï¼Œå‡†ç¡®æ¥è¯´æœ‰ä¸‰ç§æ–¹æ³•ï¼š é‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ–æ–¹å¼ï¼Œå³é€šè¿‡ObjectOutPutStreamç±»çš„writeObject(OutputStream out)æ–¹æ³•æ¥åºåˆ—åŒ–åˆ°è¾“å‡ºæµä¸­ è¾“å‡ºæµå¯ä»¥é€‰æ‹©æ–‡ä»¶æµã€ä¹Ÿå¯ä»¥é€‰æ‹©ç®¡é“æµï¼Œç”šè‡³æ˜¯äºŒè¿›åˆ¶æµ æ–‡ä»¶æµæ˜¯ç›´æŽ¥å†™åˆ°æ–‡ä»¶ä¸­å†è¯»å–è½¬æˆå¯¹è±¡ï¼Œç®¡é“æµæ˜¯é€šè¿‡ç®¡é“ç¼“å­˜æ•°æ®ï¼Œç„¶åŽå†é€šè¿‡è¾“å…¥æµè¿žæŽ¥ç®¡é“è¯»å–è½¬æˆå¯¹è±¡ åºåˆ—åŒ–çš„å¯¹è±¡å¿…é¡»å®žçŽ°SeriablizedæŽ¥å£ï¼Œæ‰èƒ½å®Œæˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ“ä½œ 1234class Student implements Serializable &#123; private String name; private Integer age;&#125; ç¬¬ä¸€ç§å®žçŽ°ï¼ˆé‡‡ç”¨é»˜è®¤ï¼‰ 123456789101112131415//FileOutputStream fos = new FileOutputStream(&quot;D:\\\\student.txt&quot;); PipedOutputStream pos = new PipedOutputStream(); PipedInputStream pis = new PipedInputStream(); pis.connect(pos); ObjectOutputStream oos = new ObjectOutputStream(pos); Student student = new Student(); student.setAge(21); student.setName(&quot;zs&quot;); oos.writeObject(student); //FileInputStream fis = new FileInputStream(&quot;D:\\\\student.txt&quot;); ObjectInputStream ois = new ObjectInputStream(pis); Student res = (Student) ois.readObject(); System.out.println(res); ç¬¬äºŒç§å®žçŽ°ï¼ˆè‡ªå®šä¹‰ï¼‰ 12345678910111213141516// è‡ªå®šä¹‰åè®® æ¯”å¦‚æˆ‘å¯ä»¥å°†åŠ å…¥å¯¹è±¡å¤´ cafe babe private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException &#123; System.out.println(&quot;è‡ªå®šä¹‰ååºåˆ—åŒ–&quot;); int magic = in.readInt(); this.name = (String) in.readObject(); this.age = (Integer) in.readObject(); &#125; // è‡ªå®šä¹‰åè®® æ¯”å¦‚æˆ‘å¯ä»¥å°†åŠ å…¥å¯¹è±¡å¤´ cafe babe private void writeObject(ObjectOutputStream out) throws IOException &#123; System.out.println(&quot;è‡ªå®šä¹‰åºåˆ—åŒ–&quot;); // 4 å­—èŠ‚ é­”æ•° out.writeInt(0xCAFEBABE); out.writeObject(this.name); out.writeObject(this.age); &#125; ç¬¬ä¸‰ç§ï¼ˆè‡ªå®šä¹‰ï¼‰ å®žçŽ°æŽ¥å£Externalizableå¹¶é‡å†™æ–¹æ³•ï¼Œå…¶å®žè·Ÿç¬¬äºŒç§å·®åˆ«ä¸å¤§ï¼Œåªæ˜¯ç¬¬äºŒç§æœ‰é»˜è®¤çš„ç§æœ‰æ–¹æ³• 12345678910111213@Override public void writeExternal(ObjectOutput out) throws IOException &#123; System.out.println(&quot;å®žçŽ° Externalizable æŽ¥å£çš„è‡ªå®šä¹‰åºåˆ—åŒ–&quot;); out.writeObject(this.name); out.writeObject(this.age); &#125; @Override public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException &#123; System.out.println(&quot;å®žçŽ° Externalizable æŽ¥å£çš„è‡ªå®šä¹‰ååºåˆ—åŒ–&quot;); this.name = (String) in.readObject(); this.age = (Integer) in.readObject(); &#125; è§£å†³ååºåˆ—åŒ–ç ´åå•ä¾‹ åœ¨å•ä¾‹æ¨¡å¼ä¸­ï¼Œåºåˆ—åŒ–å¯ä»¥ç ´åå•ä¾‹ï¼Œè¿™æ˜¯éœ€è¦é‡å†™readResolve() æ–¹æ³•ï¼Œå°†ä¹‹å‰çš„å•ä¾‹å®žä¾‹å¯¹è±¡è¿”å›žå³å¯ä¿è¯å•ä¾‹ã€‚ è§£å†³åå°„ç ´åå•ä¾‹ åå°„åˆ›å»ºå¯¹è±¡æ ¹æœ¬ä¹Ÿæ˜¯è¦è°ƒç”¨æž„é€ æ–¹æ³•ï¼Œè€Œä¸”å¯ä»¥æ— è§†æž„é€ æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ï¼ˆpublicã€privateï¼‰ Javaè§„å®šåå°„ä¸èƒ½ç ´åæžšä¸¾ç±»åž‹ï¼Œé‡‡ç”¨æžšä¸¾æž„é€ å•ä¾‹ æž„é€ æ–¹æ³•æ‰§è¡Œå‰ï¼Œå•ä¾‹å®žä¾‹é€»è¾‘ä¸Šä¸åº”è¯¥åˆ›å»ºè€Œä¸”åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¯åˆ¤æ–­æ˜¯å¦å·²åˆ›å»ºæ¥é¿å…åå°„åˆ›å»ºå¤šä¸ªå®žä¾‹ï¼Œå‰æå•ä¾‹å·²å…ˆäºŽåå°„ 1.2 è¯´ä¸€è¯´æ•°æ®ç±»åž‹æœ‰å“ªäº›Javaæœ‰å…«ç§åŸºæœ¬æ•°æ®ç±»åž‹ + String 1ä¸ªä½çš„bitï¼Œå¸ƒå°”ç±»åž‹çš„booleanï¼Œ2ä¸ªå­—èŠ‚çš„shortï¼Œ4ä¸ªå­—èŠ‚çš„intã€charï¼Œ8ä¸ªå­—èŠ‚çš„longã€doubleã€float å…¶ä¸­åŸºæœ¬ç±»åž‹ä¸­çš„åŒ…è£…ç±»åž‹å¸¸ç”¨çš„æœ‰Integerã€Long å…¶ä¸­Integerä¼šè‡ªåŠ¨è¿›è¡Œæ‹†å°è£…å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ç›´æŽ¥è·Ÿintç±»åž‹æ¯”è¾ƒæ•°å€¼ä¸Šçš„å¤§å° åº•å±‚åœ¨-128-127ä¹‹é—´ä¼šåšç¼“å­˜ï¼Œåœ¨è¿™ä¹‹é—´é€šè¿‡Integer.valueOf(int)åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ª,ä½¿ç”¨äº†äº«å…ƒè®¾è®¡æ¨¡å¼ 123System.out.println(new Integer(1) == 1);System.out.println(Integer.valueOf(1) == Integer.valueOf(1));System.out.println(Integer.valueOf(128) == Integer.valueOf(128)); ç»“æžœ 123truetruefalse 1.3 æ•°æ®ç»“æž„ç»™ä½ ä½ ä¸ªæµè§ˆå™¨ï¼Œè¦æ±‚è®¾è®¡å‰è¿›å’ŒåŽé€€çš„æ•°æ®ç»“æž„ï¼Œä¼˜å…ˆè€ƒè™‘æ€§èƒ½ é‚£ä¹ˆç”±äºŽæµè§ˆå™¨å‰è¿›åŽé€€è®¿é—®ï¼Œæ˜¯ä¸€ç§FIFOçš„ç»“æž„ï¼Œæ¯”å¦‚ä½ è¿žç»­ç‚¹å‡»å‰è¿›å‡ ä¸ªé¡µé¢ï¼Œæœ€å…ˆè¿›çš„é¡µé¢æœ€åŽè¿”å›žï¼Œå³LIFO é‚£ä¹ˆå¯ä»¥è€ƒè™‘æ ˆçš„ç»“æž„è®¾è®¡ï¼Œæ ˆç»“æž„è®¾è®¡è¦è€ƒè™‘æ€§èƒ½ï¼Œé¦–å…ˆæˆ‘ä»¬å¯ä»¥åˆ†æžåˆ°ï¼Œæµè§ˆå™¨é¡µé¢è·³è½¬æ²¡æœ‰æ¶‰åŠåˆ°é¡µé¢çš„ä¿®æ”¹ï¼Œå³ç”¨äºŽæŸ¥è¯¢ é‚£ä¹ˆä¼˜å…ˆè€ƒè™‘æ•°ç»„è€Œä¸è€ƒè™‘é“¾è¡¨ æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸¤ä¸ªæ ˆæ•°ç»„ï¼Œä¸€ä¸ªç”¨äºŽå…¥æ ˆå·²å‰è¿›çš„é¡µé¢ï¼Œä¸€ä¸ªç”¨äºŽå…¥æ ˆå·²åŽé€€çš„é¡µé¢ï¼Œå–å…¶ä¸­ä¸€ä¸ªæ ˆé¡¶å…ƒç´ ä½œä¸ºå½“å‰é¡µé¢ 2. MySQL2.1 ç´¢å¼•åœ¨MySQLä¸­ï¼Œç›´æŽ¥å½±å“ç´¢å¼•ç±»åž‹çš„æ˜¯æ•°æ®åº“çš„å­˜å‚¨å¼•æ“Ž ä½¿ç”¨MyIsamå­˜å‚¨å¼•æ“Žï¼Œæ•°æ®æ–‡ä»¶å’Œç´¢å¼•æ˜¯åˆ†å¼€çš„ï¼Œç´¢å¼•ä¼šå¦å¤–å­˜å‚¨åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“Žï¼Œæ•°æ®å’Œç´¢å¼•éƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œä¸”æ˜¯ä»¥B+æ•°çš„æ•°æ®ç»“æž„å­˜å‚¨ï¼Œéžå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•å’Œç´¢å¼•å¯¹åº”çš„æ•°æ® å°±MyIsamå¼•æ“Žæ¥è¯´ï¼Œç´¢å¼•ä¸­æœ€ä¸»è¦çš„æ˜¯èšç°‡ç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯ä¸»é”®çš„é»˜è®¤ç´¢å¼• å•å€¼ç´¢å¼•å’Œå¤šå€¼ç´¢å¼•ï¼Œè¿™é‡Œæ˜¯æŒ‡ç»„åˆç´¢å¼•ï¼Œå¥½çš„ç»„åˆç´¢å¼•å¯ä»¥è¾¾åˆ°è¦†ç›–ç´¢å¼•ï¼Œå¯ä»¥åšåˆ°é¿å…å›žè¡¨ï¼Œè¿™é‡Œæ˜¯å› ä¸ºå¶å­èŠ‚ç‚¹é€šè¿‡è¦†ç›–ç´¢å¼•å¸¦äº†æ•°æ®ï¼Œå› ä¸ºB+æ ‘åªæœ‰å¶å­èŠ‚ç‚¹å¸¦æœ‰æ•°æ®ï¼Œéžå¶å­èŠ‚ç‚¹éƒ½æ˜¯ç´¢å¼• è€Œå¤šä¸ªç»„åˆç´¢å¼•ä¸‹ï¼Œæœ‰æ•ˆç´¢å¼•è¦åšåˆ°å·¦åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯å¿…é¡»ä»Žå·¦é¡ºåºåŒ¹é…åˆ°å³æŸ¥è¯¢ï¼Œå¦åˆ™ç´¢å¼•å°†å¤±æ•ˆ 2.2 å£è¿° sqlç»™ä½ ä¸€å¼ è¡¨ï¼Œæœ‰ä¸‰ä¸ªå­—æ®µï¼Œidã€äº§å“idã€å¤‡æ³¨ä¿¡æ¯ï¼ŒçŽ°åœ¨éœ€è¦ä½ æŸ¥è¯¢ç›¸åŒäº§å“idçš„è®°å½•ï¼Œç„¶åŽidå€¼ç›¸åŒçš„è®°å½•æ•°å¤§äºŽç­‰äºŽ5çš„äº§å“id é¦–å…ˆå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå®šä¹‰è¿™å¼ è¡¨ä¸ºS å› ä¸ºæ¶‰åŠç›¸åŒå­—æ®µçš„è®°å½•ï¼Œå¯ä»¥è€ƒè™‘ç›´æŽ¥åˆ†ç»„ï¼Œä½¿ç”¨èšåˆå‡½æ•° 123select pro_id from Sgroup by pro_idhaving count(pro_id) &gt;= 5 3. JVM3.1 çº¿ç¨‹çš„æ­»é”äº†è§£è¿‡å—ï¼Ÿæ¯”å¦‚æœ‰ä¸¤ä¸ªçº¿ç¨‹t1å’Œt2ï¼Œt1çº¿ç¨‹æœ‰èµ„æºr1ï¼Œt2æœ‰èµ„æºr2ï¼Œt1çº¿ç¨‹æ‰§è¡Œä»£ç ä¸­éœ€è¦èµ„æºr2ï¼Œä¸è¿‡è¿™æ®µä»£ç éœ€è¦t2çº¿ç¨‹æŠŠèµ„æºr2é‡Šæ”¾æ‰èƒ½æ‰§è¡Œï¼Œæ­¤æ—¶t2çº¿ç¨‹ä¹Ÿæ‰§è¡Œä»£ç ä¸­ï¼Œé‡Šæ”¾èµ„æºå‰éœ€è¦èŽ·å–èµ„æºr1ï¼Œä½†t2åˆéœ€è¦r2ï¼Œæ­¤æ—¶å¤„äºŽç›¸äº’ç­‰å¾…çš„çŠ¶æ€ï¼Œå°±å¯¼è‡´äº†æ­»é”ã€‚ ä»ŽJavaè§’åº¦æ¥è¯´ï¼Œèµ„æºç›¸å½“äºŽJavaçš„é”å¯¹è±¡ï¼Œæ˜¯äº’æ–¥çš„ï¼Œä¸€ä¸ªçº¿ç¨‹èŽ·å–é”å¯¹è±¡åŽï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åªèƒ½ç­‰å¾…ï¼Œt1çº¿ç¨‹èŽ·å–é”å¯¹è±¡r1ï¼Œä¹Ÿå°±æ˜¯å æœ‰äº†é”r1ï¼Œè¿™æ—¶çº¿ç¨‹t2ä¹Ÿæ˜¯å æœ‰äº†é”å¯¹è±¡r2ï¼Œè€Œçº¿ç¨‹t1éœ€è¦èŽ·å–é”å¯¹è±¡r2æ‰èƒ½å¾€ä¸‹æ‰§è¡Œä»£ç ï¼Œä½¿å¾—çº¿ç¨‹t1é˜»å¡žï¼Œè€Œçº¿ç¨‹t2å¤„äºŽé˜»å¡žç­‰å¾…é”å¯¹è±¡r1é‡Šæ”¾ï¼Œæ‰èƒ½é‡Šæ”¾é”å¯¹è±¡r2ï¼Œè¿™æ ·å°±å¯¼è‡´æ­»é”ã€‚ï¼ˆäº’ç›¸ç­‰å¾…ï¼‰ 4. JUC4.1 çº¿ç¨‹æ± æœ‰äº†è§£è¿‡å—ï¼Ÿçº¿ç¨‹æ± ä¸»è¦æœ‰æ ¸å¿ƒçº¿ç¨‹æ•°ã€æ•‘æ€¥çº¿ç¨‹å’Œé˜Ÿåˆ—ï¼Œé˜Ÿåˆ—åˆ†ä¸ºé˜»å¡žé˜Ÿåˆ—å’Œéžé˜»å¡žé˜Ÿåˆ—ã€‚ ç›®å‰çº¿ç¨‹æ± ä¸»è¦å¯ä»¥åˆ†ä¸ºå‡ ç±»ï¼š åªæœ‰æ ¸å¿ƒçº¿ç¨‹ã€æ— æ•‘æ€¥çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œæ­¤æ—¶ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€Œæ ¸å¿ƒçº¿ç¨‹åœ¨è½®è¯¢åœ°æ‰§è¡Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå¦‚æžœé˜Ÿåˆ—æ»¡æˆ–è€…é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºé—®é¢˜ã€‚ ä¸€èˆ¬è¿™ç§çº¿ç¨‹æ± çš„åšæ³•å°±æ˜¯ä½¿ç”¨äº†æ‹’ç»ç­–ç•¥ï¼Œæ‹’ç»ç­–ç•¥å¯åˆ†ä¸ºç›´æŽ¥ä¸¢å¼ƒæ–°ä»»åŠ¡ã€å¼‚å¸¸æŠ›å‡ºï¼ˆä¸»åŠ¨é€»è¾‘å¤„ç†ï¼‰ã€ä¸¢å¼ƒç­‰å¾…é˜Ÿåˆ—å¤´ç»“ç‚¹ã€æäº¤ä»»åŠ¡çº¿ç¨‹æ‰§è¡Œã€‚ æœ€åŽä¸€ä¸ªæ˜¯æŽ¨èä½¿ç”¨çš„ ä¸ä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºçŽ°ä¸šåŠ¡æŸå¤±ï¼› æäº¤ä»»åŠ¡çš„çº¿ç¨‹è¢«å ç”¨ï¼Œæ–°çš„ä»»åŠ¡ä¸å¯æäº¤ï¼Œå‡ç¼“ä»»åŠ¡æäº¤çš„é€Ÿåº¦ï¼Œç›¸å½“äºŽè´Ÿåé¦ˆï¼Œèƒ½ç»™åˆ°çº¿ç¨‹æ± ä¸€å®šçš„ç¼“å†²æœŸï¼› åªæœ‰æ•‘æ€¥çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œè¿™ç§çš„è¯æœ‰çº¿ç¨‹æ± newCachedThreadPoolï¼Œå®ƒèƒ½æ— é™åˆ›å»ºæ•‘æ€¥çº¿ç¨‹ï¼Œé˜Ÿåˆ—é‡‡ç”¨SynchronousQueue ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰å®¹é‡çš„é˜Ÿåˆ—ï¼Œåªæœ‰çº¿ç¨‹å–ä»»åŠ¡æ—¶æ‰èƒ½æäº¤ä»»åŠ¡ï¼› æœ€åŽæ˜¯ä¸€ç§æ ¸å¿ƒçº¿ç¨‹æ•°åªæœ‰1çš„çº¿ç¨‹æ± ï¼Œæ²¡æœ‰æ•‘æ€¥çº¿ç¨‹ï¼Œä»»åŠ¡é˜Ÿåˆ—æ— ç•Œï¼Œä¸€èˆ¬ä½œä¸ºå•çº¿ç¨‹ä»»åŠ¡ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰CPUçš„è½®è¯¢åˆ‡æ¢ï¼Œä»»åŠ¡çš„æ‰§è¡Œæ•ˆçŽ‡æœ€é«˜ï¼Œä¸è¿‡è¯·æ±‚æ•°å¤ªå¤šçš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯å®¹æ˜“å¯¼è‡´å†…å­˜æº¢å‡ºã€‚ éžé˜»å¡žé˜Ÿåˆ—å®žçŽ°çš„æœ‰CurrentLinkedQueueï¼Œå®ƒæ˜¯é€šè¿‡CASæ— é”åŒ–æœºåˆ¶çš„çº¿ç¨‹æ± é˜Ÿåˆ—ï¼Œæ¯ä¸ªçº¿ç¨‹é€šè¿‡for(;;)æ‰§è¡Œï¼Œæ˜¯ä¸€ä¸ªå•å‘ä¸”é€šè¿‡GCè‡ªåŠ¨å›žæ”¶å‡ºé˜ŸèŠ‚ç‚¹çš„ï¼Œåˆ©ç”¨å¯è¾¾æ€§ç®—æ³•åˆ†æžï¼Œå°†nextæŒ‡å‘è‡ªå·±ï¼Œå³å¯è§¦å‘å»¶è¿Ÿå›žæ”¶ï¼Œåˆ©ç”¨å…ƒç´ çš„ä¸å¯é‡ç”¨æ€§ï¼Œè§„é¿ABAé—®é¢˜ 5. Linuxç»™ä½ ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¦æ±‚ä½ æŸ¥è¯¢æœ€è¿‘ä¸€å¤©å†…ä¸­ï¼ŒåŒ¹é…åˆ°å…³é”®å­—çš„æ‰€æœ‰è®°å½•æ•°æ® ä¸€èˆ¬æ—¥å¿—å®žæ—¶æŸ¥è¯¢å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå®ƒä¼šå®žæ—¶æ›´æ–°ï¼Œè€Œä¸”ä¼šå¤„äºŽfgæ¨¡å¼ï¼Œtailæ‰“å°æ–‡ä»¶æœ«å°¾è®°å½•ï¼Œä¹Ÿå°±æ˜¯æœ€è¿‘ 1tail -100f catalina.log | grep &quot;å…³é”®å­—&quot; è€Œä½¿ç”¨catæ˜¯æŸ¥è¯¢åŽ†å²ï¼Œåªèƒ½æ‰“å°æ—¥å¿—åˆ°å±å¹• æ¯”å¦‚æŒ‰ç…§tailæˆ–headæ¥æŸ¥è¯¢å…³é”®å­—ä¸º20:çš„åŽ5æ¡æ•°æ®å¹¶æ˜¾ç¤ºè¡Œå· 1cat -n log.log4j | grep &quot;20:&quot; | tail -n 5 æ—¶é—´æ®µæŸ¥è¯¢ 1grep &#x27;2022-08-21 20:1[1-9]&#x27; log.log4j","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"}],"author":null},{"title":"å³å²¸ç‰©è”é¢ç»","slug":"å³å²¸ç‰©è”é¢ç»","date":"2022-09-25T10:28:50.000Z","updated":"2022-09-25T10:30:38.942Z","comments":true,"path":"2022/09/25/å³å²¸ç‰©è”é¢ç»/","link":"","permalink":"http://fyupeng.github.io/2022/09/25/%E5%8F%B3%E5%B2%B8%E7%89%A9%E8%81%94%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"ç®€å•ä¸‰åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»è‡ªæˆ‘ä»‹ç»è¿™é‡Œä¸€ç¬”å¸¦è¿‡ï¼Œç»™å¯¹é¢ä»‹ç»è‡ªå·±å†…åœ¨ + å¤–åœ¨ + æ ¡å›­ç»åŽ† + æ ¡å›­é¡¹ç›® + æ„å‘å²—ä½ æŠ€æœ¯é¢1. JavaåŸºç¡€ç¯‡1.1 Objectä½ çŸ¥é“å“ªäº›æ–¹æ³•?æˆ‘å°±å›žç­”äº†è‡ªå·±å¸¸ç”¨çš„ waitã€notifyã€notifyAll è¿™ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä»–è‡ªå·±ä¸æ€Žä¹ˆä½¿ç”¨ï¼Œå°±è·ŸæŠ€æœ¯å®˜è¯´æŠ±æ­‰ï¼Œå…¶ä»–ä¸æ€Žä¹ˆä½¿ç”¨ï¼Œå°±å›žç­”ä¸ä¸Šæ¥ï¼Œé¢è¯•å®˜ä¹Ÿä¸åœç•™åœ¨è¿™ä¸ªé—®é¢˜ä¸Šï¼Œç›´æŽ¥å¸¦åˆ°ä¸‹ä¸€ä¸ªè¯é¢˜ã€‚ æ‰€ä»¥è¿™é‡Œæ€»ç»“ä¸‹ï¼ŒObjectå…¶å®žè¿˜æœ‰ä¸€ä¸ª clone()æ–¹æ³•ï¼Œè¿™ä¸ªå›žç­”ä¸ä¸Šäº†å…¶å®žçœŸä¸åº”è¯¥ï¼Œå½“å‰æƒ³ä¸èµ·æ¥ï¼Œè¿˜æœ‰ä¸€ä¸ªèŽ·å–ç±»ä¿¡æ¯getClass()ï¼Œå¯ä»¥åšæ˜ å°„çš„ä¸œè¥¿ã€‚ 1.2 ä½ äº†è§£è¿‡å“ªäº›list ç±»åž‹å—å—¯ï¼Œæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ æ•°ç»„ï¼Œä¸€ç§æ˜¯é“¾è¡¨ï¼Œå³ArrayListå’ŒLinkedList 1.3 è¿™ä¸¤ç§æ€Žä¹ˆé€‰æ‹©ä½¿ç”¨ï¼Ÿä¸€èˆ¬çš„è¯ï¼Œå¦‚æžœè¯»æ“ä½œå¤§äºŽå¢žåˆ æ”¹çš„è¯ï¼Œä½¿ç”¨æ•°ç»„æ•ˆçŽ‡è¦æ¯”é“¾è¡¨çš„å¥½ï¼Œè€Œå¦‚æžœè¦é¢‘ç¹ä¿®æ”¹æ“ä½œï¼Œé‚£ä¹ˆä½¿ç”¨é“¾è¡¨æ›´å¥½ä¸€ç‚¹ æ‰€è°“å±‚å±‚é€’è¿›ï¼Œå°±åœ¨è¿™é‡Œäº† 1.4 é‚£ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿå‘ƒï¼Œå› ä¸ºæ•°ç»„å¦‚æžœä½ è¦å¢žåŠ ä¸€ä¸ªå…ƒç´ çš„è¯ï¼Œæ¯”å¦‚ä¸¾ä¾‹ï¼Œä½ æœ‰åä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä½ è¦åœ¨0å·ä¸‹æ ‡å¢žåŠ ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆä½ å¾—æŠŠåŽé¢10ä¸ªå…ƒç´ æ•´ä½“å‘åŽæŒªåˆ°ä¸€ä½ï¼Œè¿™é‡Œæˆ‘è¿˜ç”¨æ‰‹åŠ¿æ¯”åˆ’äº†ä¸€ä¸‹ï¼Œé¢è¯•å®˜ç‚¹å¤´ï¼Œç„¶åŽç¤ºæ„æˆ‘ç»§ç»­ï¼Œæˆ‘å°±è¯´é“¾è¡¨çš„è¯ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹æŒ‡é’ˆå°±å¯ä»¥äº†ï¼Œä¸ç”¨å¯¹æ•´ä½“ç§»åŠ¨ï¼Œå…¶å®žè¿™é‡Œåº”è¯¥å›žè°ƒå†…å­˜çš„è¿žç»­è·Ÿåˆ†æ•£ä¼šæ›´å¥½ä¸€ç‚¹ï¼Œå› ä¸ºæ•°ç»„æ˜¯å¼€è¾Ÿçš„è¿žç»­å†…å­˜ç©ºé—´ï¼Œè€Œé“¾è¡¨ä¸éœ€è¦ï¼Œå®ƒæ˜¯é›¶æ•£çš„ï¼Œæ‰€ä»¥é“¾è¡¨è¯»è¦ä½¿ç”¨æŒ‡é’ˆï¼Œè‡ªç„¶è€Œç„¶æ•°ç»„è¯»æ•ˆçŽ‡æ›´é«˜ã€‚ 2. Spring ç¯‡2.1 Spring æ˜¯å¹²ä»€ä¹ˆç”¨åˆ°ï¼ŸSpringå¯ä»¥æ–¹ä¾¿åœ°ç»™æˆ‘ä»¬ç®¡ç†åˆ›å»ºã€èŽ·å–å’Œkillå¯¹è±¡ï¼Œä¸éœ€è¦æˆ‘ä»¬åŽ»é¢å¤–åšè¿™ä¸€ä»½å·¥ä½œã€‚ 2.2 äº†è§£è¿‡ IOCå—ï¼ŸIOCæ˜¯æŽ§åˆ¶åè½¬çš„æ„æ€ï¼Œåœ¨Spring å®¹å™¨ä¸­ï¼Œåˆ›å»ºå¯¹è±¡çš„å·¥ä½œä¸å†ç”±æˆ‘ä»¬æ¥è´Ÿè´£ï¼Œè€Œæ˜¯äº¤ç”± Spring å®¹å™¨åŽ»ç®¡ç†å„ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ 2.3 è¯´ä¸€è¯´ Spring å®¹å™¨ç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæœ‰ä»€ä¹ˆç”¨ï¼Ÿç”±äºŽ Springå®¹å™¨é»˜è®¤ä½¿ç”¨çš„æ˜¯ Singleå•ä¾‹åˆ›å»ºå¯¹è±¡ï¼Œè¿™æ ·å„ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå¯¹è±¡æ˜¯å…±äº«çš„ï¼Œå°±å¯ä»¥åšåˆ°å¤šä¸ªç”¨æˆ·è¯·æ±‚è®¿é—®æ˜¯æ‹¿çš„æ˜¯åŒä¸€ä¸ªå®žä¾‹ï¼Œä¸ç”¨æ€»åŽ»åˆ›å»ºå¯¹è±¡ï¼Œå¯¼è‡´é¢‘ç¹çš„ GCåžƒåœ¾å›žæ”¶ã€‚ 2.4 è¯´ä¸€è¯´ Spring ä¸­å®¹å™¨å®ƒçš„åˆ›å»ºå®žä¾‹çš„ä½œç”¨åŸŸåœ¨ Springå®¹å™¨ä¸­ï¼Œæœ‰ä¸€ä¸ªå±žæ€§ scopeï¼Œå°±æ˜¯ä¸€ä¸ªä½œç”¨åŸŸï¼Œå®ƒå¯ä»¥æŒ‡æ˜Žåˆ›å»ºå¯¹è±¡æ˜¯é‡‡ç”¨å•ä¾‹è¿˜æ˜¯å…¶ä»–æ–¹å¼ å•ä¾‹çš„è¯å¤šä¸ªçº¿ç¨‹ä¸‹æ˜¯å…±äº«å®žä¾‹çš„ï¼Œå½“æ—¶åªæƒ³åˆ° Requestï¼Œä½†è¿™ä¸ªä¸æ˜¯çº¿ç¨‹çº§åˆ«çš„ï¼Œæ²¡å›žç­”ä¸Šæ¥ï¼Œæ²¡æƒ³åˆ° Prototypeï¼ˆåŽŸåž‹ï¼‰ï¼ŒæŠ€æœ¯å®˜å¸®æˆ‘è§£å›´äº†ï¼Œè¯´çŸ¥é“æˆ‘çŸ¥é“æƒ³è¯´ä»€ä¹ˆï¼Œå°±æ˜¯è¯´ä¸å‡ºæ¥å“ˆå“ˆã€‚ Prototype å®ƒæ˜¯ä¸€ä¸ªåŽŸåž‹ï¼Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­çš„åˆ›å»ºçš„å•ä¾‹æ˜¯äº’ä¸å¹²æ‰°çš„ï¼Œä¹Ÿå°±æ˜¯ç”Ÿå‘½å‘¨æœŸçš„å¤„äºŽçº¿ç¨‹ã€‚ å½“ç„¶è¿˜æœ‰å…¶ä»–ï¼Œå› ä¸ºä¸æ€Žä¹ˆä½¿ç”¨ï¼Œæ‰€ä»¥å°±æ²¡æœ‰æ€Žä¹ˆè¯´ã€‚ MySQL ç¯‡MySQL ä½ äº†è§£è¿‡å“ªäº›å¼•æ“Žå—¯ï¼Ÿè¿™ä¸ªæˆ‘äº†è§£è¿‡ä¸¤ä¸ªï¼ŒINNODBå’ŒMyisam è¿™ä¸¤ä¸ªæ˜¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘å°±è¯´äº†ç¬¬ä¸€ä¸ªé»˜è®¤ä¼šä½¿ç”¨ è¡Œé”ï¼ŒMyisam ä½¿ç”¨çš„æ˜¯è¡¨é” é¢è¯•å®˜ç»§ç»­è¿½é—®ï¼Œä¸ºä»€ä¹ˆï¼Ÿæ€Žä¹ˆåˆ¤æ–­çš„ï¼Ÿè¿™ä¸ªæˆ‘çœŸä¸çŸ¥é“è¯¥æ€Žä¹ˆå›žç­”ï¼Œæˆ‘å°±çžŽæ‰¯äº†é”å‡çº§ï¼Œå°±è¯´ INNODBå› ä¸ºé»˜è®¤ä½¿ç”¨è¡Œé”ï¼Œä½†æ˜¯å¦‚æžœå› ä¸ºæ²¡æœ‰ç´¢å¼•ä¼˜åŒ–æˆ–è€…è¯­å¥ä¼˜åŒ–ç­‰é—®é¢˜ï¼Œå¯èƒ½ä¼šå‡ºçŽ°é”å‡çº§çŽ°è±¡ï¼Œè¿™æ˜¯ Myisam æ²¡æœ‰çš„ã€‚ é¢è¯•å®˜ä¸€å¤´é›¾æ°´ï¼Œä½†æ²¡æœ‰åé©³ï¼Œå¥½ï¼Œç»§ç»­ä¸‹ä¸ªé—®é¢˜ã€‚ äº‹åŠ¡æœ‰äº†è§£å—ï¼Ÿæˆ‘è¯´æœ‰æœ‰ï¼Œè¿™å°±æ¥åŠ²äº†ï¼Œå°±è¯´INODB æœ‰äº‹åŠ¡ï¼Œä½†Myisam æ²¡æœ‰äº‹åŠ¡è¿™è¯´æ³•ï¼ŒçŽ°åœ¨æ‰æ˜Žç™½é¢è¯•å®˜è¯´è¿™ä¸¤ä¸ªå¼•æ“Žçš„åŒºåˆ«åŽŸæ¥åœ¨è¿™é‡Œã€‚ é¢è¯•å®˜æ²¡æœ‰ä¸ºéš¾ï¼ŒçŸ¥é“é—®çš„å·®ä¸å¤šäº†ï¼Œå°±å¼€å§‹æ‰‹æ’• SQL å£è¿°SQLç»™ä½ ä¸€ä¸ªè¡¨ï¼Œè¿™ä¸ªè¡¨æœ‰ä¸‰ä¸ªå­—æ®µï¼Œä¸€ä¸ªæ˜¯å­¦ç”Ÿ idï¼Œä¸€ä¸ªæ˜¯è¯¾ç¨‹å cnameï¼Œä¸€ä¸ªæ˜¯è¯¾ç¨‹æˆç»© cscore è¦æ±‚ï¼šå¦‚æžœæœ‰ä¸‰é—¨è¯¾ç¨‹ï¼Œè¦æ±‚æ‰¾å‡ºå­¦ç”Ÿçš„æ€»æˆç»©å¤§äºŽ270ï¼Œå¹¶ä¸”è¿”å›žå­¦ç”Ÿidå’Œæ€»æˆç»© çº³å°¼ï¼Œç¬¬ä¸€ä¸ªæƒ³æ³•å°±æ˜¯æƒ³ç€è¿žè¡¨æŸ¥è¯¢ï¼Œå½“æ—¶è§‰å¾—æ²¡æˆäº†ï¼Œå°±å¾ˆæŒ£æ‰Ž å£è¿°ï¼šå°±æ˜¯é€šè¿‡ä¸‰å¼ è¡¨è‡ªç„¶å…³è”ï¼Œå…³è”ä¸‰é—¨æˆç»©ï¼Œç„¶åŽå…³è”æ¡ä»¶æ˜¯å­¦ç”Ÿidï¼Œwhere æ˜¯ä¸‰é—¨æˆç»©ä¹‹å’Œå¤§äºŽ270 é¢è¯•å®˜è§‰å¾—æœ‰é—®é¢˜ï¼Œè¿™ç§åšæ³•ä¸é€šç”¨ï¼Œè¦æˆ‘å†æƒ³æƒ³å…¶ä»–æ–¹æ³• æƒ³äº†ä¸¤åˆ†é’Ÿï¼Œæ²¡æœ‰æ€ç»ªï¼Œç»™æˆ‘ä¸ªæç¤ºï¼šå¯ä»¥ä½¿ç”¨ group by åˆ†ç»„ï¼Ÿé‚£å°±ç®€å•äº†ï¼Œæˆ‘å°±ç›´æŽ¥å£è¿°äº†ï¼Œè¯´å¯ä»¥å…ˆåˆ†ç»„ï¼Œç„¶åŽåœ¨æ¯ä¸ªåˆ†ç»„é‡Œé¢ä½¿ç”¨èšåˆå‡½æ•°sumï¼Œå°†æ€»æˆç»©è¿™ä¸ªæ¡ä»¶æ»¡è¶³270çš„æŸ¥è¯¢å‡ºæ¥ å½“æ—¶å¾ˆç´§å¼ ï¼Œæ€•é”™äº†ï¼Œé¢è¯•å®˜ä¸€è„¸å¾®ç¬‘çš„è¯´ï¼Œæ˜¯çš„ï¼Œæ€è·¯æ˜¯å¯¹çš„ï¼Œä½ å¯ä»¥ç”¨åœ¨çº¸ä¸Šç”¨ç¬”å†™ä¸‹æ¥å—ï¼Ÿ ä»–çŸ¥é“æˆ‘å£è¿°å¯ä»¥ï¼Œä½†è¿˜æ˜¯ä¸ç›¸ä¿¡æˆ‘åŠ¨æ‰‹èƒ½åŠ›ï¼Œçž§ä¸èµ·äº†ï¼Œå¯èƒ½ä¹‹å‰ç”¨é‚£ä¸ªå…³è”çš„SQL æ‰‹å†™SQLï¼Œå‡ºçŽ°äº†ä¸€ç‚¹é—®é¢˜ï¼Œä½†åœ¨ä»–æå‡ºé—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ç«‹é©¬è¯´æˆ‘å¯ä»¥ä¿®æ”¹ä¸‹sqlå—ï¼Œæ”¹äº†å†ç»™ä»–çœ‹äº†ä¸‹ï¼Œå¯èƒ½å°±æ˜¯å› ä¸ºè¿™ä¸ªåŽŸå› ï¼Œè‡ªå·±ä¸ä»”ç»†å†™ï¼Œç»™è‡ªå·±åŸ‹å‘ï¼Œè®©é¢è¯•å®˜å¯¹æˆ‘æœ‰äº†è´¨ç–‘ äºŽæ˜¯è¿™æ¬¡æˆ‘å°±å¥½å¥½æ‹äº†æ‹æ€ç»ªï¼Œé¢è¯•å®˜çœ‹æˆ‘è¿Ÿè¿ŸæœªåŠ¨ç¬”ï¼Œè¯´ä¸ç”¨ç´§å¼ ï¼Œæ…¢æ…¢æƒ³ï¼Œå½“ç„¶æˆ‘è‚¯å®šä¸è¿™ä¹ˆæƒ³ï¼Œå½“æ—¶å·²ç»æœ‰æƒ³æ³•äº†ï¼Œåªæ˜¯æ€•åˆå†™é”™äº†SQLï¼Œå› ä¸ºå½“æ—¶å·²ç»æœ‰ä¸€ä¸ªæœˆæ²¡åˆ· åŠ›æ‰£ SQLé¢˜åž‹äº†ï¼Œæƒ³äº†ä¸¤åˆ†é’Ÿå·¦å³ï¼Œå†™äº†å‡ºæ¥ 1234select sc.sid, sum(sc.score) as sum_scorefrom SC scgroup by sc.sidhaving on sum(sc.score) &gt; 270 å°±è¿™æ ·ï¼Œé¢è¯•å®˜æ¯”è¾ƒæ»¡æ„ï¼Œå°±é—®æˆ‘ä¸ºä»€ä¹ˆå½“æ—¶æ²¡æƒ³å‡ºæ¥ï¼Œæˆ‘å°±è¯´å½“æ—¶ä»–è¯´ç»™ä¸‰ç§‘æˆç»©ï¼Œå¾ˆå®¹æ˜“å°±è®©äººæƒ³åˆ°ç”¨è”è¡¨ åˆ°è¿™é‡Œ SQL ä¹Ÿæ²¡ç»§ç»­å†™äº†","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"}],"author":null},{"title":"é•¿åŸŽè½¯ä»¶é¢ç»","slug":"é•¿åŸŽè½¯ä»¶é¢ç»","date":"2022-09-25T10:28:40.000Z","updated":"2022-09-25T15:23:04.149Z","comments":true,"path":"2022/09/25/é•¿åŸŽè½¯ä»¶é¢ç»/","link":"","permalink":"http://fyupeng.github.io/2022/09/25/%E9%95%BF%E5%9F%8E%E8%BD%AF%E4%BB%B6%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"ç®€å•ä¸‰åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»è‡ªæˆ‘ä»‹ç»è¿™é‡Œä¸€ç¬”å¸¦è¿‡ï¼Œç»™å¯¹é¢ä»‹ç»è‡ªå·±å†…åœ¨ + å¤–åœ¨ + æ ¡å›­ç»åŽ† + æ ¡å›­é¡¹ç›® + æ„å‘å²—ä½ æŠ€æœ¯é¢1. JavaåŸºç¡€ç¯‡1.1 è¯´ä¸€è¯´æ•°æ®ç»“æž„è¯´ä¸‹é“¾è¡¨çš„å±žæ€§ï¼ŒæŒ‡é’ˆå±žæ€§ æ ‘ç»“æž„äº†è§£è¿‡å—ï¼Ÿ å¶å­èŠ‚ç‚¹æ€Žä¹ˆå­˜å‚¨çš„ï¼Ÿ 2. Spring ç¯‡2.1 Spring MVC çš„åŽŸç†ä¸»è¦æœ‰5ä¸ªç»„ä»¶ï¼Œå‰ç«¯æŽ§åˆ¶å™¨ã€æ˜ å°„å™¨ã€å¤„ç†å™¨ã€å¤„ç†å™¨é€‚é…å™¨ã€è§†å›¾è§£æžå™¨ å‰ç«¯æŽ§åˆ¶å™¨ä¹Ÿå°±æ˜¯ä¸­å¤®å¤„ç†å™¨ï¼Œå®ƒä¸»è¦è´Ÿè´£å‰ç«¯ç”¨æˆ·çš„è¯·æ±‚å’Œå¯¹å…¶ä»–ç»„ä»¶çš„è½¬å‘è°ƒç”¨ï¼› å‰ç«¯æŽ§åˆ¶å™¨æŽ¥æ”¶åˆ°è¯·æ±‚åŽï¼Œä¼šæŠŠè¯·æ±‚è½¬å‘ç»™å¤„ç†å™¨æ˜ å°„å™¨ï¼Œå¤„ç†å™¨ä¼šæ ¹æ®é…ç½®æˆ–æ³¨è§£ï¼ˆ@Controllerï¼‰æ‰¾åˆ°æœ€ç»ˆè¦æ‰§è¡Œçš„Handlerï¼› ç„¶åŽå°†Handlerï¼ˆè‡ªå·±çš„ä¸šåŠ¡å¤„ç†ï¼‰å¯¹è±¡ä»¥åŠå…¶å¯¹åº”çš„æ‹¦æˆªå™¨ï¼Œå°è£…åˆ°HandlerExecutionChainå¯¹è±¡ä¸­å¹¶ä»¥å®ƒçš„å½¢å¼æ”¾å›žï¼› å‰ç«¯æŽ§åˆ¶å™¨æ ¹æ®èŽ·å–åˆ°çš„Handlerï¼ˆControllerï¼‰ï¼ŒåŽ»é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„HandlerAdapterï¼ˆå®ƒè¿˜æ”¯æŒServletã€HttpRequestHandlerã€ThrowawayControllerï¼‰ï¼ŒæˆåŠŸèŽ·å–åˆ°ä¼šå…ˆåŽ»æ‰§è¡Œæ‹¦æˆªå™¨ï¼› è¿™æ—¶å°†å¼€å§‹å¯¹æå–Requestä¸­çš„æ¨¡åž‹æ•°æ®ï¼Œå¹¶ä¸”å°†Handlerçš„å…¥å‚è¿›è¡Œæ•°æ®å¡«å……ï¼Œä»¥è‡³äºŽæˆ‘ä»¬å†™æŽ§åˆ¶å±‚æ–¹æ³•æ—¶ï¼Œå…¥å‚æ˜¯å‰ç«¯ä¼ æ¥çš„å€¼ï¼Œåœ¨å¡«å……è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®è‡ªå·±çš„é…ç½®ï¼ŒSpringè¿˜å¯ä»¥å¸®ä½ åšä¸€äº›é¢å¤–æ“ä½œï¼š Json/Xml æ•°æ®è½¬æ¢æˆå¯¹è±¡ æ ¼å¼åŒ–è¯·æ±‚æ•°æ® æ ¡éªŒ Handleræ‰§è¡Œå®ŒæˆåŽï¼Œè¿”å›žä¸€ä¸ªModelAndViewï¼ˆè§†å›¾å’Œè§†å›¾éœ€è¦å¡«å……çš„æ¨¡åž‹æ•°æ®ï¼‰ å‰ç«¯æŽ§åˆ¶å™¨æ ¹æ®è¿”å›žçš„ModelAndViewï¼Œé€‰æ‹©åˆé€‚çš„ViewResolver ViewResolver ç»“åˆModelå’ŒViewï¼Œæ¥æ¸²æŸ“è§†å›¾ æœ€ç»ˆå‰ç«¯æŽ§åˆ¶å™¨å°†æ¸²æŸ“ç»“æžœè¿”å›žç»™å®¢æˆ·ç«¯ 3. JVM ç¯‡3.1 è¯´ä¸€è¯´ä½ å¯¹jvmå†…å­˜ç»“æž„çš„ç†è§£jvm å†…å­˜æ¨¡åž‹ç”±ç¨‹åºè®¡æ•°å™¨ã€æ–¹æ³•åŒºã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †å’Œè¿è¡Œå¸¸é‡æ± ç»„æˆã€‚ æ–¹æ³•åŒºï¼šä¸»è¦æ˜¯å­˜å‚¨ç±»å˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡ä»¥åŠclassæè¿°ä¿¡æ¯ï¼ˆä¼šåœ¨ç±»åŠ è½½åŽåŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼‰ è™šæ‹Ÿæœºæ ˆï¼šè™šæ‹Ÿæœºæ ˆè·Ÿçº¿ç¨‹æ˜¯ç›´æŽ¥æŒ‚é’©çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸè·Ÿçº¿ç¨‹ä¸€æ ·ï¼Œè€Œä¸”è™šæ‹Ÿæœºæ ˆè®¾ç½®çš„å¤§å°ï¼ˆ-Xss1024kï¼Œ1024ä¸ªå­—èŠ‚1Må•è¯ç¼©å†™Stack Sizeï¼‰ï¼Œå½“è®¾ç½®è¿‡å¤§æ—¶ï¼Œåœ¨å †å¤§å°å›ºå®šçš„æƒ…å†µä¸‹ï¼Œæ€»å†…å­˜ = å †å†…å­˜ + çº¿ç¨‹æ•° * è™šæ‹Ÿæœºæ ˆå¤§å°ï¼Œå¯çº¿ç¨‹æ•°å°±ä¼šç›¸åº”å‡å°‘ï¼› æœ¬åœ°æ–¹æ³•æ ˆï¼šè·Ÿè™šæ‹Ÿæœºæ ˆç›¸ä¼¼ï¼Œä¸è¿‡ä¸æ˜¯ç”¨Javaå†™çš„ï¼› ç¨‹åºè®¡æ•°å™¨ï¼šçº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨è®©å‡ºCPUä¼šç”±å®ƒæ¥è®°å½•å½“å‰ä½ç½®ï¼Œä»¥ä¾¿æ¢å¤CPUè¿˜åœ¨åŽŸä½ç½®æ‰§è¡Œï¼› å †ï¼šå­˜æ”¾Javaå¯¹è±¡å®žä¾‹ï¼Œåœ¨JDK7ç‰ˆæœ¬ä¸­ï¼Œç”±æ–°ç”Ÿä»£ï¼ˆEdenåŒºã€SurvivoråŒºï¼‰å’Œ è€å¹´ä»£ç»„æˆï¼Œä¹Ÿæ˜¯GCåžƒåœ¾æ”¶é›†å™¨å¤„ç†çš„ä¸»è¦åŒºåŸŸï¼Œä¿—ç§°GCå †ï¼Œæ˜¯ç®¡ç†å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼› è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ”¾åœ¨æ–¹æ³•åŒºä¸­çš„ï¼Œä½œä¸ºæ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚ 3.2 å¯¹è±¡åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹å…¶å®žåœ¨ jvm ä¸­åŒ…æ‹¬äº†åŠ è½½ã€é“¾æŽ¥ï¼ˆåŒ…å«éªŒè¯ï¼ˆè™šæ‹Ÿæœºçš„å®‰å…¨æ€§ã€å¯¹è±¡å¤´ã€çˆ¶ç±»ä¸Žå­ç±»ä¸­finalç­‰å£°æ˜Žçš„å®‰å…¨æ€§æ ¡éªŒç­‰ç­‰ï¼‰ã€å‡†å¤‡ã€è§£æžï¼‰ã€åˆå§‹åŒ–ï¼› å‡†å¤‡é˜¶æ®µï¼šç”³è¯·å†…å­˜ç©ºé—´å¹¶å®Œæˆé»˜è®¤çš„åˆå§‹åŒ–ï¼Œæ¯”å¦‚intç±»åž‹é»˜è®¤åˆå§‹åŒ–ä¸º4ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œå¹¶åˆå§‹åŒ–ä¸º0ï¼› è§£æžé˜¶æ®µï¼šå°†å¸¸é‡æ± ä¸­çš„å¼•ç”¨è§£æžä¸ºç›´æŽ¥å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å°†ç±»ä¸­çš„å¸¸é‡æ± æ”¾åˆ°äº†è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ç›´æŽ¥è°ƒç”¨æ–¹æ³•æˆ–è€…å¼•ç”¨ç±»çš„æ—¶å€™ï¼Œæ˜¯éœ€è¦ç¬¦å·å¼•ç”¨çš„ï¼Œåªä¸è¿‡jvmå¸®æˆ‘ä»¬è‡ªåŠ¨å¼•ç”¨äº†å¸¸é‡ä¸­çš„ç¬¦å·ï¼Œå°±æˆç›´æŽ¥å¼•ç”¨ã€‚ åˆå§‹åŒ–é˜¶æ®µï¼šç”¨æˆ·çœŸæ­£çš„èµ‹å€¼æ“ä½œï¼Œå³è°ƒç”¨ç›¸åº”çš„æž„é€ å™¨æž„é€ å¯¹è±¡ï¼Œæž„é€ å¯¹è±¡åˆ›å»ºçš„æ—¶å€™ï¼Œå¦‚æžœæ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œç”±äºŽè™šæ‹Ÿæœºä¼˜åŒ–æœºåˆ¶ï¼Œä¼šå‡ºçŽ°æŒ‡ä»¤é‡æŽ’åºé—®é¢˜ï¼Œä»€ä¹ˆé—®é¢˜ï¼Ÿ åœ¨è¯¥åœºæ™¯ä¸­ï¼Œæž„é€ è¿‡ç¨‹åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼šç”³è¯·å†…å­˜ -&gt; æž„é€ å—æž„é€  -&gt; å†…å­˜åœ°å€è¿”å›žï¼Œè¿™é‡Œé¢çš„æŒ‡ä»¤ä¸ºäº†æ€§èƒ½ä¸Šçš„æç¤ºï¼Œè€Œä¸æ”¹å˜ç»“æžœï¼Œjvmå¯èƒ½ä¼šå°†å†…å­˜åœ°å€ä¹Ÿå°±æ˜¯æž„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡æŒ‡å‘çš„å†…å­˜åœ°å€æ”¾åˆ°æž„é€ å—è¿‡ç¨‹ä¸­è¿”å›žï¼Œè€Œæ²¡æœ‰ç­‰åˆ°æœ€åŽã€‚ å¼•ç”¨ï¼šç¼–è¯‘å™¨å¯ä»¥è‡ªç”±åœ°ä»¥ä¼˜åŒ–çš„åä¹‰å¯¹æŒ‡ä»¤çš„é¡ºåºè¿›è¡Œéšæ„å¤„ç†ã€‚ é‚£ä¹ˆæ€Žä¹ˆè§£å†³ï¼Ÿ å½“ç„¶æ˜¯ä¿è¯åŽŸå­æ€§å‘€ï¼ æ€Žä¹ˆä¿è¯ï¼Ÿ finalå£°æ˜Žä¸ä»…èƒ½ä¿è¯ç±»ä¸å¯ç»§æ‰¿ï¼Œæ–¹æ³•ä¸å¯é‡å†™ï¼Œå˜é‡ä¸å¯å˜ï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹ç‚¹å°±æ˜¯èƒ½ä¿è¯å¯è§æ€§ï¼Œåª²ç¾Žvolatile å¯è§æ€§ä¿è¯å°±æ˜¯å¯¹è±¡å¦‚æžœå·²ç»å¯è§ï¼ˆåœ°å€å·²ç»è¿”å›žäº†ï¼Œé‚£ä¹ˆä¿è¯å®ƒæž„é€ çš„å®Œæ•´æ€§ï¼Œä¹Ÿå°±æ˜¯æŒ‡ä»¤ä¸ä¼šå‘ç”Ÿé‡æŽ’ï¼‰æ€§ æ–‡ç« åˆ†äº«ï¼šhttps://qa.1r1g.com/sf/ask/451997661/ å†…å­˜æ¨¡åž‹å®˜æ–¹è®²è§£ï¼šhttp://www.cs.umd.edu/~pugh/java/memoryModel/jsr-133-faq.html æŽ¨èæ¯”è¾ƒå¥½çš„ç½‘ç«™ï¼šhttps://qa.1r1g.com/ è¡¥å…… å¦‚æžœç±»ä¸­çš„æˆå‘˜å˜é‡å£°æ˜Žä¸ºfinalå¹¶ä¸”æ˜¯åŸºæœ¬ç±»åž‹ï¼Œé‚£ä¹ˆèµ‹å€¼é˜¶æ®µä¼šåœ¨å‡†å¤‡é˜¶æ®µå°±å®Œæˆäº†ï¼Œè¿™äº›å¯å®žçŽ°ä¸€äº›å¹¶å‘å®‰å…¨æ€§åº”ç”¨ï¼› 3.2 GC åžƒåœ¾å›žæ”¶äº†è§£è¿‡å—äº†è§£è¿‡ä¸€ç‚¹ç‚¹ï¼Œæ²¡äº†ï¼Œä»–å°±ä¸é—®äº†â€¦â€¦ æˆ‘å°±æ˜¯ä¸“é—¨åŽ»çœ‹äº†gcä¸­çš„ä¸€äº›åŽŸç†ï¼Œæ¯”å¦‚å¤åˆ¶ç®—æ³•ã€å¹¶å‘æ ‡è®°ã€å¹¶å‘æ¸…é™¤ã€åˆ†ä»£å›žæ”¶ï¼Œè¿˜æœ‰Serialã€parNewã€parallel Scavengeå’Œg1è¿™äº›ï¼Œçœ‹ä¾†ä¸èƒ½å¤ªä½Žè°ƒäº†ã€‚ 3.3 JVM è°ƒä¼˜äº†è§£è¿‡å—ç­”æ¡ˆæ˜¯æ²¡æœ‰ï¼Œæ‰€ä»¥æ²¡æœ‰ä¸‹æ–‡äº†ï¼Œå¯æƒœè¿™ç¯‡é¢ç»æ¯”è¾ƒå‘å¾®ï¼Œå‘³é“ä¸å¤Ÿé¦™ã€‚ å› ä¸ºå°±æ˜¯ç®€å•ä½¿ç”¨è¿‡ï¼Œæ²¡æœ‰åœ¨å…·ä½“é¡¹ç›®åœºæ™¯ç”¨åˆ°ï¼Œä¸æ•¢å¹å˜˜ã€‚ 3.4 volatile èƒ½ä¿è¯åŽŸå­æ€§å—ä¸èƒ½ï¼Œvolatileå¯ä»¥ä¿è¯å¯è§æ€§ï¼Œå®ƒæ˜¯åœ¨jvmä¼˜åŒ–åŽï¼Œå‡ºçŽ°æŒ‡ä»¤é‡æŽ’åºåŽæ‰æœ‰çš„ï¼Œèƒ½å¤Ÿé˜²æ­¢æŒ‡ä»¤çš„é‡æŽ’åºï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡ä»¤é‡æŽ’åºå¯èƒ½ä¼šå…ˆå°†å¯¹è±¡åœ¨æ‰§è¡Œæž„é€ å‡½æ•°ä¸­ï¼Œæå‰æŠŠå¯¹è±¡æ‰€åœ¨åœ°å€ç»™è¿”å›žäº†ï¼Œè¿™å°±å¯èƒ½å¯¼è‡´æˆå‘˜å˜é‡å‡ºçŽ°ä¸ºnullçš„æƒ…å†µï¼Œæœ‰äº†volatileå°±ä¸ä¼šå‘ç”Ÿã€‚ volatileä¸€èˆ¬ä¿®é¥°äºŽå˜é‡ å½“ç„¶é™¤äº†è¿™ä¸ªï¼Œvolatileä¿è¯å¯è§æ€§è¿˜ä½“çŽ°åœ¨å†…å­˜ä¸Žé«˜é€Ÿç¼“å­˜ä¹‹é—´ï¼Œå¦‚æžœä¸€ä¸ªå˜é‡é€šè¿‡forå¾ªçŽ¯åŽ»æ‰§è¡Œï¼Œé‚£ä¹ˆjvmå°†è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œå°†å†…å­˜ä¸­çš„å˜é‡æ”¾åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œè¿™æ ·å®¹æ˜“å‡ºçŽ°å†…å­˜ä¸Žé«˜é€Ÿç¼“å­˜çš„ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œvolatileå¯ä»¥ä¿è¯å¯¹å†…å­˜ä¸­å˜é‡çš„ä¿®æ”¹åŠæ—¶åŒæ­¥åˆ°é«˜é€Ÿç¼“å­˜ä¸­ã€‚ 4. SQL ç¯‡4.1 èŠä¸€èŠä½ å¯¹SQLä¸­çš„ä¼˜åŒ–ä¸»è¦åˆ†ä¸ºè¯­å¥ä¼˜åŒ–å’Œç´¢å¼•ä¼˜åŒ– è¯­å¥ä¼˜åŒ–æ¯”å¦‚é¿å…ä½¿ç”¨orï¼Œå¯èƒ½å¯¼è‡´å…¨ç›˜éåŽ†ï¼Œæˆ‘æ˜¯è¯´äº†joinè¿žæŽ¥å’Œå­æŸ¥è¯¢ï¼Œå‰ä¸€ä¸ªåªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡ï¼ŒåŽä¸€ä¸ªä¼šå¤šæ¬¡éåŽ†å…¨è¡¨ï¼Œå¦‚æžœæ•°æ®é‡å¤§çš„è¡¨å°†å¾ˆä¸¥é‡ã€‚ ç´¢å¼•ä¼˜åŒ–çš„è¯ï¼Œé¢è¯•å®˜å¾ˆè€å¿ƒç»™æˆ‘è®²äº†ç»„åˆç´¢å¼•ã€å¤±æ•ˆçš„é—®é¢˜ 4.2 SQL ä¸­çš„å‡½æ•°çš„å¤„ç†SQLä¸­çš„å‡½æ•°æ¯”å¦‚æ—¶é—´çš„yyyy-MM-dd hh-mm-ss,é€šè¿‡è¿™ç§è®¾ç½®å¯ä»¥æ¥å¤„ç†ç›¸åº”çš„æ—¶é—´ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šhttps://blog.csdn.net/chentaocba/article/details/7539409 å¯ä»¥è¿™æ ·è‡ªå®šä¹‰åŽ»å¤„ç†æ‹¼æŽ¥æ—¶é—´ 5. Redis ç¯‡5.1 èŠä¸€èŠå“¨å…µæ¨¡å¼å“¨å…µæ¨¡å¼çš„åº”ç”¨å…¶å®žæ˜¯Redisé›†ç¾¤ä¸­æ•…éšœæ¢å¤å’Œé«˜å¯ç”¨çš„åº”ç”¨ï¼Œåœ¨Redisè¯»å†™åˆ†ç¦»ä¹Ÿå°±æ˜¯ä¸»ä»Žå¤åˆ¶ä¸­ï¼Œå“¨å…µèŠ‚ç‚¹ä½œä¸ºç‹¬ç«‹èŠ‚ç‚¹ï¼Œä¸å‚ä¸Žé€‰ä¸¾ã€‚ åœ¨ä¸»èŠ‚ç‚¹ä¹Ÿå°±æ˜¯masterèŠ‚ç‚¹å®•æœºåŽï¼Œå¤šä¸ªå“¨å…µèŠ‚ç‚¹ä¸€è‡´å‘çŽ°ä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Œé€šè¿‡æŠ•ç¥¨é€‰ä¸¾å“ªä¸€ä¸ªä»ŽèŠ‚ç‚¹é€‰ä¸¾ä¸ºä¸»èŠ‚ç‚¹ã€‚ å…¶å®žå°±æ˜¯ä¸€ç§ç›‘æŽ§ä¸»èŠ‚ç‚¹æ˜¯å¦æ•…éšœçš„è¡Œä¸ºã€‚ 5. åˆ†å¸ƒå¼3.1 è¯´ä¸€è¯´æœåŠ¡é™çº§åœ¨è¯·æ±‚è¶…æ—¶ã€èµ„æºä¸è¶³ã€CPUã€æ•°æ®åº“IOè¾¾åˆ°ç“¶é¢ˆæ—¶ï¼Œé‡‡å–çš„ä¸€ç§è¡¥æ•‘æŽªæ–½ã€‚ æœåŠ¡é™çº§ä¸»è¦æœ‰Dubbboçš„Mockå’ŒSpring Cloudçš„Hystrixï¼Œå±è”½å¯¹è¿œç¨‹çš„è°ƒç”¨ï¼Œä¸€èˆ¬ä½¿ç”¨SpringBootæ¯”è¾ƒæŽ¨èæ•´åˆHystrixæ¥å®žçŽ°æœåŠ¡é™çº§å®¹é”™ã€‚ 3.2 èŠä¸€èŠä½ çš„é¡¹ç›®åˆ†å¸ƒå¼ä¸­æ€Žä¹ˆè§£å†³å‡ºçŽ°çš„é—®é¢˜æˆ‘åšçš„æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åšå®¢ç®¡ç†é¡¹ç›®ï¼Œåœ¨æ­å»ºå¹¶éƒ¨ç½²åˆ†å¸ƒå¼é¡¹ç›®æ—¶ï¼Œè°ƒç”¨è¿œç¨‹æœåŠ¡çš„æ—¶å€™ï¼Œæ³¨å†Œä¸­å¿ƒNacoså¾ˆå®¹æ˜“å‡ºçŽ°å®•æœºï¼Œå½“æ—¶æŽ’æŸ¥çš„åŽŸå› æ˜¯å†…å­˜ä¸å¤Ÿï¼Œå½“æ—¶ä½¿ç”¨äº†é˜¿é‡Œçš„ä¸¤å°æœåŠ¡å™¨ã€ä¸€å°è…¾è®¯äº‘æœåŠ¡å™¨æ¥æ­å»ºåˆ†å¸ƒå¼é¡¹ç›®ï¼Œé˜¿é‡Œä¸€å°ä½œä¸ºå‰ç«¯å’ŒNginxåšåå‘ä»£ç†ï¼Œä¸€å°è¿è¡Œç€åšå®¢çš„æ–‡ç« ã€è¯„è®ºã€åˆ†ç±»æ ‡ç­¾å’Œç”¨æˆ·çš„äº”ä¸ªæœåŠ¡ï¼Œä¸€å°ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œå¤„ç†å‰ç«¯çš„è¯·æ±‚ã€è¿œç¨‹è°ƒç”¨è…¾è®¯äº‘æœåŠ¡å™¨çš„æœåŠ¡ï¼Œä½†æˆ‘æŠŠæ³¨å†Œä¸­å¿ƒæ”¾åˆ°äº†è…¾è®¯äº‘ä¸Šï¼Œå› ä¸ºè…¾è®¯äº‘ä¸Šçš„æœåŠ¡éœ€è¦è¿›è¡ŒæœåŠ¡æ³¨å†Œï¼Œè€Œä¸”æ³¨å†Œä¸­å¿ƒNacoså¯åŠ¨æ˜¯å¸¦æœ‰WebåŽå°ç®¡ç†é¡µé¢çš„ï¼Œæ‰€ä»¥å°±ä½œä¸ºä¸€ä¸ªå†…éƒ¨çš„æœåŠ¡å™¨ä½¿ç”¨ã€‚ äºŽæ˜¯è§£å†³æ–¹æ¡ˆå°±æ˜¯å°†å¤šä¸ªæœåŠ¡è¿›è¡Œæ¨ªå‘æ‹†åˆ†ï¼Œå°†æ–‡ç« å’Œç”¨æˆ·çš„æœåŠ¡æ”¾åˆ°ä»£ç†æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œè§£å†³äº†åœ¨è¿œç¨‹è°ƒç”¨æœåŠ¡çš„æ—¶å€™å› ä¸ºè¯·æ±‚è¶…æ—¶æˆ–èµ„æºä¸è¶³å¯¼è‡´Nacosæ³¨å†Œä¸­å¿ƒå‡ºçŽ°å®•æœºçš„æƒ…å†µã€‚ 6. ç½‘ç»œç¼–ç¨‹6.1 Tomcat ä¸Ž Netty æœ‰ä»€ä¹ˆåŒºåˆ«Tomcatæ˜¯ä¸€ç§ä½¿ç”¨httpåè®®çš„webå®¹å™¨ï¼Œæ˜¯ç”¨æ¥å¯åŠ¨webåº”ç”¨çš„ï¼Œè€ŒNettyæ˜¯ä¸€ç§è‡ªå®šä¹‰å¤„ç†å„ç§å­—èŠ‚æµæ•°æ®åšç›¸åº”çš„ç¼–è§£ç ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è‡ªå®šä¹‰é€šä¿¡åè®®ï¼ŒNettyæ˜¯ä¸€æ¬¾åŸºäºŽNIOçš„ç½‘ç»œé€šä¿¡æ¡†æž¶ï¼Œè€Œä¸”Tomcatçš„è¯å…¶å®žä¹Ÿæ”¯æŒNIOæ¨¡å¼ã€‚","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"}],"author":null},{"title":"åŽèµ„é¢ç»","slug":"åŽèµ„é¢ç»","date":"2022-09-25T10:28:30.000Z","updated":"2022-09-25T10:30:09.032Z","comments":true,"path":"2022/09/25/åŽèµ„é¢ç»/","link":"","permalink":"http://fyupeng.github.io/2022/09/25/%E5%8D%8E%E8%B5%84%E9%9D%A2%E7%BB%8F/","excerpt":"","text":"åŽèµ„ä¸€é¢â€”â€” äººåŠ›é¢ï¼ˆæŒ‚ï¼‰ 1. Spring1.1 Spring çš„ç”Ÿå‘½å‘¨æœŸ æŽ¨èå­¦ä¹ é“¾æŽ¥ï¼šhttps://blog.csdn.net/shijinjins/article/details/124071095 Spring ç”Ÿå‘½å‘¨æœŸä¼šç»åŽ†è¿‡å››ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯å®žä¾‹åŒ–ã€å±žæ€§èµ‹å€¼ã€åˆå§‹åŒ–ã€é”€æ¯ å…¶ä»–çš„ä¸€äº›é˜¶æ®µå°±æ˜¯é€šè¿‡AOPé¢å‘åˆ‡é¢æ‰©å±•æ¥çš„ï¼Œèƒ½å¤Ÿè®©ä½ åœ¨å®žä¾‹åŒ–ã€åˆå§‹åŒ–å’Œé”€æ¯å‰åŽåšä¸€äº›é€»è¾‘ã€‚ åˆå§‹åŒ–é˜¶æ®µï¼Œæœ‰ä¸€ä¸ªç‰¹åˆ«é‡è¦çš„æŽ¥å£BeanPostProcessor postProcessorBeforeInitialization(); // åˆå§‹åŒ–å‰è°ƒç”¨ postProcessorAfterInitialization(); // åˆå§‹åŒ–åŽè°ƒç”¨ åˆå§‹åŒ–æ–¹å¼æœ‰ä¸‰ä¸ª InitializingBeanç±»çš„afterPropertiesSetæ–¹æ³• @PostConstructæ³¨è§£æ ‡æ³¨çš„æ–¹æ³• // Springæ”¯æŒjavaxåŒ…ä¸­çš„@PostConstructï¼Œä¼šåœ¨å±žæ€§å€¼æ³¨å…¥æˆåŠŸåŽæ‰§è¡Œ Springé…ç½®æ–‡ä»¶applicationContext.xmlçš„æ ‡ç­¾å±žæ€§init-method=&quot;initMethod&quot; è¿™é‡Œæé†’ï¼Œ@PostConstructæ˜¯é€šè¿‡Springçš„BeanPostProcessor#postProcessBeforeInitialization(Object, String)æ¥å®Œæˆè°ƒç”¨çš„ å¦‚æžœæ˜¯ä½¿ç”¨åˆ°äº†Springè‡ªåŠ¨æ³¨å…¥æ¥ä½¿ç”¨åˆ›å»ºçš„Beanï¼Œé‚£ä¹ˆå¦‚æžœä½¿ç”¨åå°„çš„æ–¹å¼åˆ›å»ºå¯¹è±¡æ‰§è¡Œæž„é€ æ–¹æ³•ï¼Œå…ˆåŽé¡ºåºæ˜¯è¿™æ ·çš„ï¼š 12345flowchart LRA[æœåŠ¡å™¨åŠ è½½Servlet]--&gt; B[Servletæž„é€ å‡½æ•°]B --&gt; C[&quot;@Autowire&quot;]C --&gt; D[&quot;@PostConstruct&quot;] åå°„çš„æ–¹å¼ä¼šåœ¨æ‰§è¡Œæž„é€ å™¨åŽè¿”å›žï¼Œæ‰€ä»¥ä½ è¦é€šè¿‡åå°„ä½¿ç”¨Beanï¼Œå¯åœ¨@PostConstructæ³¨è§£çš„æ–¹æ³•ä¿å­˜è¯¥Beanï¼Œå†åŽ»è°ƒç”¨ä½¿ç”¨ã€‚ é”€æ¯æ–¹å¼æœ‰ä¸‰ä¸ª @PreDestroyæ³¨è§£æ ‡æ³¨çš„æ–¹æ³• // // Springæ”¯æŒjavaxåŒ…ä¸­çš„@preDestroyï¼Œä¼šåœ¨é”€æ¯å‰æ‰§è¡Œ DisposableBeanæŽ¥å£çš„destroyæ–¹æ³• Springé…ç½®æ–‡ä»¶applicationContext.xmlçš„æ ‡ç­¾å±žæ€§destroy-method=;&quot;destroyMethod&quot; è¿™é‡Œæé†’ï¼Œ@preDestroyæ‰§è¡Œæ˜¯é€šè¿‡Springçš„DestructionAwareBeanPostProcessor#postProcessBeforeDestruction(Object, String)æ¥å®Œæˆè°ƒç”¨çš„ ç®€è¦æ­¥éª¤ 1.å½“ç¨‹åºåŠ è½½è¿è¡Œæ—¶ä¼šæ ¹æ®springä¸­é…ç½®æ–‡ä»¶æ‰¾åˆ°beané…ç½®çš„å±žæ€§å’Œæ–¹æ³•ï¼Œå¹¶é€šè¿‡javaåå°„æœºåˆ¶åˆ›å»ºå®žä¾‹åŒ–beanå¯¹è±¡ã€‚ Beanå®žçŽ°äº†BeanNameAwareæŽ¥å£ï¼Œæ‰§è¡Œäº†setBeanNameæ–¹æ³•ï¼Œå®žçŽ°æ³¨å…¥å¯¹è±¡ã€‚ 2.å®žçŽ°äº†BeanFactoryAwareå·¥åŽ‚æŽ¥å£ï¼Œæ‰§è¡Œäº†setBeanFactoryæ–¹æ³•ã€‚ 3.å®žçŽ°äº†ApplicationContextæŽ¥å£ç±»ï¼Œæ‰§è¡Œäº†setsetApplicationContestæ–¹æ³•ã€‚ 4.å®žçŽ°äº†BeanPostProcessoræŽ¥å£ç±»ï¼Œæ‰§è¡ŒpostProcessBeforeInitializationæ–¹æ³• 5.å®žçŽ°äº†InitiliazingBean æ‰§è¡ŒafterPropertiesSetæ–¹æ³•ï¼Œå¹¶åŠ è½½é…ç½®æ–‡ä»¶å®šä¹‰äº†init-method åˆ™æ‰§è¡Œå¯¹åº”åˆå§‹åŒ–æ–¹æ³•BeanPostProcessor æ‰§è¡ŒpostProcessorfterInitilizationæ–¹æ³•ï¼Œå®Œæˆ Beançš„åˆå§‹åŒ–ï¼Œä½¿å¾—beanå¯ä»¥ä½¿ç”¨ã€‚ 6.å®žçŽ°äº†DisposabileBeanæŽ¥å£æ‰§è¡Œdestroyæ–¹æ³•ï¼ŒåŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„destroy-methodæ–¹æ³•é”€æ¯beanå¯¹è±¡å®žä¾‹ã€‚ 1.2 Spring ä½œç”¨åŸŸå•ä¾‹ï¼ˆé»˜è®¤Singleï¼‰å’Œå¤šä¾‹ï¼ˆPrototypeï¼‰ å•ä¾‹åœ¨ä¸€ä¸ªå®¹å™¨é‡Œé¢åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå¤šä¾‹çš„Beanç”Ÿå‘½å‘¨æœŸåœ¨å®¹å™¨äº§ç”Ÿæ—¶å¹¶ä¸åˆ›å»ºï¼Œå¯¹è±¡ä½¿ç”¨æ—¶æ‰åˆ›å»ºï¼Œæœ€åŽç”±JVMåžƒåœ¾å›žæ”¶æœŸå›žæ”¶ ç”Ÿå‘½å‘¨æœŸå‡ºç”Ÿå’Œé”€æ¯è¿˜å¯ä»¥è‡ªå·±æŒ‡å®šï¼Œæ¯”å¦‚ init-method å¯¹è±¡å‡ºç”Ÿä¹‹åŽç«‹åˆ»æ‰§è¡Œä»€ä¹ˆæ–¹æ³• destroy-methodå¯¹è±¡é”€æ¯ä¹‹å‰æ‰§è¡Œä»€ä¹ˆæ–¹æ³• 1.3 Spring ä¾èµ–æ³¨å…¥æ–¹å¼æœ‰ä¸‰ç§ï¼šå±žæ€§æ³¨å…¥ã€æž„é€ å‡½æ•°æ³¨å…¥ã€å·¥åŽ‚æ–¹æ³•ï¼ˆé€šè¿‡æ ‡ç­¾å±žæ€§é…ç½®é™æ€æˆ–å®žä¾‹å·¥åŽ‚ï¼‰æ³¨å…¥ è€ŒåŸºäºŽè¿™ä¸‰ç§æ–¹å¼æœ‰å¤šç§å®žçŽ°ï¼šé…ç½®æ–‡ä»¶å®žçŽ°ã€æ³¨è§£å®žçŽ°ã€ 2. é›†åˆé›†åˆçš„æ€§è´¨: å”¯ä¸€æ€§ã€æ— åºæ€§ã€ç¡®å®šæ€§ å”¯ä¸€æ€§æŒ‡çš„æ˜¯é›†åˆå…ƒç´ æ˜¯ä¸é‡å¤çš„ã€æ— åºæ€§æŒ‡çš„æ˜¯é›†åˆæ’å…¥å…ƒç´ çš„é¡ºåºæ€§ã€ç¡®å®šæ€§æ˜¯æŒ‡é›†åˆä¸­å…ƒç´ æ˜¯ç¡®å®šçš„ï¼Œä¸æ˜¯ç›¸å¯¹æ€§çš„ã€‚ é›†åˆç±»åž‹æŒ‰ç±»åž‹åˆ’åˆ†å¯ä»¥åˆ’åˆ†ä¸ºå¯é‡å¤é›†åˆä¸å¯é‡å¤é›† å¯é‡å¤é›†åˆï¼šListå®žçŽ°ç±» ä¸å¯é‡å¤é›†åˆï¼šSetå®žçŽ°ç±»ã€Mapå®žçŽ°ç±»ï¼ˆkeyï¼‰ æŒ‰ç…§æœ‰åºæ€§ï¼ˆæ·»åŠ å’Œè®¿é—®ï¼‰åˆ’åˆ†å¯ä»¥åˆ’åˆ†ä¸ºæœ‰åºé›†å’Œæ— åºé›† æœ‰åºé›†ï¼šListå®žçŽ°ç±»ã€TreeSetã€LinkedHashSetã€LinkedHashMapã€TreeMap æ— åºé›†ï¼šHashSetã€HashMapã€ æŒ‰ç…§ç»“æž„åˆ’åˆ†å¯ä»¥åˆ’åˆ†ä¸ºåˆ—è¡¨Listã€Setã€Mapï¼ˆStack å’Œ Queueï¼‰ Listï¼šArrayListã€LinkedList Setï¼šHashSetã€LinkedHashSetã€TreeSet Mapï¼šHashMapã€HashTableã€TreeMapã€LinkedHashMapã€CurrentHashMapã€ æŒ‰ç…§å­˜å‚¨è¿žç»­æ€§åˆ’åˆ†å¯ä»¥åˆ’åˆ†ä¸ºè¿žç»­é›†å’Œæ•£åˆ—é›† è¿žç»­é›†ï¼šArrayList æ•£åˆ—é›†ï¼šLinkedListã€Mapå®žçŽ°ç±»ã€Setå®žçŽ°ç±» 3. çº¿ç¨‹å®‰å…¨3.1 çº¿ç¨‹å®‰å…¨çš„é›†åˆæœ‰å“ªäº›ï¼ŸHashTableã€CurrentHashMapã€CurrentLinkedQueueã€ArrayBlockingQueueã€LinkedBlockingQueue HashTableï¼šå®ƒçš„æ–¹æ³•éƒ½ä½¿ç”¨äº†é‡é‡çº§é”synchronizedä¿®é¥°æ¥ä¿è¯æ–¹æ³•æ‰§è¡Œçš„çº¿ç¨‹å®‰å…¨ã€‚ CurrentHashMapï¼šæœ‰JDKè¿­ä»£ç‰ˆæœ¬ï¼› 7ä½¿ç”¨äº†åˆ†æ®µé”Segmentï¼ˆç»§æ‰¿å¯é‡å…¥é”ReentrantLockï¼‰å®žçŽ°çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯çœŸæ­£æ„ä¹‰ä¸Šå®žçŽ°äº†å¹¶å‘ 8ä½¿ç”¨äº†synchronized + CASï¼Œå› ä¸ºåœ¨1.6ç‰ˆæœ¬ä¹‹åŽï¼Œsynchronizedä¸€æ­¥æ­¥å¾—åˆ°ä¼˜åŒ– åŒ…å«äº†åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é” å¤„äºŽåå‘é”çš„å¯¹è±¡ï¼Œæ˜¯æŒ‡å¯ä»¥åœ¨èŽ·å¾—è¯¥åå‘é”çš„åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå¤šæ¬¡æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶ç›¸å½“äºŽæ— é” è€Œå¦‚æžœå¤„äºŽåå‘é”çš„å¯¹è±¡è¢«å…¶ä»–çº¿ç¨‹èŽ·å–äº†ï¼Œåå‘é”å°†ä¸å†åå‘ï¼Œå°±å‡çº§ä¸ºè½»é‡çº§é” å‡çº§ä¸ºè½»é‡çº§é”è¿˜æ˜¯æœ‰æœºä¼šç»§ç»­åå‘é”çš„ï¼Œæ˜¯æ€Žä¹ˆä¸ªåŽŸç†ï¼Ÿ åœ¨å¯¹è±¡å¤´å‰8ä¸ªå­—èŠ‚ä¸­ï¼Œå­˜å‚¨äº†åå‘çº¿ç¨‹idï¼Œå‰æå¾—æ˜¯è¯¥çº¿ç¨‹æœªèŽ·å–é”å¯¹è±¡ï¼ŒèŽ·å–é”å¯¹è±¡åŽè®¾ç½®çš„æ˜¯å½“å‰çº¿ç¨‹id æ‰€ä»¥æƒ³è®©å¯¹è±¡å¤´ä¸Šçš„åå‘çº¿ç¨‹idé‡æ–°åå‘ä¸ºå½“å‰çº¿ç¨‹idï¼Œå¾—è®©è¯¥çº¿ç¨‹é‡å¤èŽ·å–é”å¯¹è±¡è¾¾åˆ°é˜ˆå€¼20æ¬¡æ‰ä¼šåå‘ï¼Œä¸è¿‡åªèƒ½åå‘ä¸€æ¬¡ è¿™å°±æ˜¯é”é™çº§ï¼Œå¦‚æžœæœ‰ç¬¬ä¸‰ä¸ªçº¿ç¨‹å‚ä¸Žäº†ï¼ŒåŒæ ·æ‰§è¡Œç¬¬äºŒä¸ªçº¿ç¨‹çš„æ“ä½œï¼Œå°†ä¸å†åå‘ï¼ˆå¯¹è±¡å¤´åå‘çº¿ç¨‹idé‡ç½®ä¸º0ï¼‰ è¿™æ˜¯ç”±å†æ¬¡å‡çº§ä¸ºè½»é‡çº§é”ï¼Œå‰é¢æ˜¯ä¸å‘ç”Ÿç«žäº‰ï¼Œå¦‚æžœå¤šä¸ªçº¿ç¨‹å‘ç”Ÿç«žäº‰ï¼Œç«žäº‰å¤±è´¥ä¼šè‡ªæ—‹CASå†æ¬¡å°è¯•èŽ·å–é”ï¼Œå¦‚æžœè¿˜æ˜¯å¤±è´¥ è¿™æ—¶å‡çº§ä¸ºé‡é‡çº§é”ï¼Œé‡é‡çº§é”å°†ä¸å†é€šè¿‡ä¹è§‚é”CASæ“ä½œï¼Œè€Œæ˜¯ä¼šå‘ç”Ÿé˜»å¡žï¼Œå¿…é¡»ç­‰èŽ·å¾—é”çš„çº¿ç¨‹é‡Šæ”¾é”æ‰èƒ½è®©ç»™ä¸‹ä¸€ä¸ªçº¿ç¨‹ CurrentLinkedQueueï¼šä½¿ç”¨äº†éžé˜»å¡žçš„æ–¹å¼å®žçŽ°äº†çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯ä¸€ä¸ªæ— é”åŒ–çš„å•å‘é˜Ÿåˆ—ï¼Œä½¿ç”¨åˆ°äº†CAS + for(;;)ï¼Œè€Œä¸”è¿™ç§å•å‘é˜Ÿåˆ—å·§å¦™åˆ©ç”¨èŠ‚ç‚¹çš„ä¸å¯é‡ç”¨ + CAS + next æŒ‡å‘æœ¬èº« + GCåžƒåœ¾å›žæ”¶ï¼Œè§„é¿æŽ‰äº†ABAé—®é¢˜ å› ä¸ºèŠ‚ç‚¹å‡ºé˜Ÿåˆ—å¹¶ä¸ä¼šé©¬ä¸Šå‡ºé˜Ÿåˆ—ï¼Œè€Œæ˜¯é€šè¿‡nextæŒ‡å‘è‡ªå·±è®©GCåžƒåœ¾å›žæ”¶æŽ‰ï¼Œè¿™æ ·æœ‰çº¿ç¨‹åˆ»æ„åŽ»ABAæ“ä½œæ—¶ï¼Œå‘çŽ°è¿˜æœ‰æ—§å€¼ï¼Œæ²¡æ³•åšä¿®æ”¹è¾¾åˆ°ABAçš„ç›®çš„ï¼Œè¿™è¯´ä¸“ä¸šç‚¹å°±æ˜¯å»¶è¿Ÿå‡ºé˜Ÿã€‚ LinkedBlockingQueueï¼šä¸ŽCurrentLinkedQueueéžå¸¸åƒï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼Œè¿™æ ·å¦‚æžœå…¥é˜Ÿå¿«äºŽå‡ºé˜Ÿçš„æƒ…å†µå®¹æ˜“å‡ºçŽ°æ ˆæº¢å‡º ArrayBlockingQueueï¼šæ˜¯æœ‰ç•Œé˜Ÿåˆ— 4. è°ˆè°ˆè‡ªå·±çš„é¡¹ç›®ç•¥","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"}],"author":null},{"title":"ç¬¬ä¸€åœºé¢è¯•","slug":"ç¬¬ä¸€åœºé¢è¯•","date":"2022-09-25T10:26:54.000Z","updated":"2022-09-25T10:28:18.019Z","comments":true,"path":"2022/09/25/ç¬¬ä¸€åœºé¢è¯•/","link":"","permalink":"http://fyupeng.github.io/2022/09/25/%E7%AC%AC%E4%B8%80%E5%9C%BA%E9%9D%A2%E8%AF%95/","excerpt":"","text":"ç®€å•ä¸‰åˆ†é’Ÿè‡ªæˆ‘ä»‹ç»è‡ªæˆ‘ä»‹ç»è¿™é‡Œä¸€ç¬”å¸¦è¿‡ï¼Œç»™å¯¹é¢ä»‹ç»è‡ªå·±å†…åœ¨ + å¤–åœ¨ + æ ¡å›­ç»åŽ† + æ ¡å›­é¡¹ç›® + æ„å‘å²—ä½ æŠ€æœ¯é¢1. Spring åŽŸç†ç¯‡1.1 æœ‰ä½¿ç”¨è¿‡Springå—ï¼Œè¯´ä¸€è¯´å®ƒçš„ SpringMVC åŽŸç†ä¸»è¦æœ‰5ä¸ªç»„ä»¶ï¼Œå‰ç«¯æŽ§åˆ¶å™¨ã€æ˜ å°„å™¨ã€å¤„ç†å™¨ã€å¤„ç†å™¨é€‚é…å™¨ã€è§†å›¾è§£æžå™¨ å‰ç«¯æŽ§åˆ¶å™¨ä¹Ÿå°±æ˜¯ä¸­å¤®å¤„ç†å™¨ï¼Œå®ƒä¸»è¦è´Ÿè´£å‰ç«¯ç”¨æˆ·çš„è¯·æ±‚å’Œå¯¹å…¶ä»–ç»„ä»¶çš„è½¬å‘è°ƒç”¨ï¼› å‰ç«¯æŽ§åˆ¶å™¨æŽ¥æ”¶åˆ°è¯·æ±‚åŽï¼Œä¼šæŠŠè¯·æ±‚è½¬å‘ç»™å¤„ç†å™¨æ˜ å°„å™¨ï¼Œå¤„ç†å™¨ä¼šæ ¹æ®é…ç½®æˆ–æ³¨è§£ï¼ˆ@Controllerï¼‰æ‰¾åˆ°æœ€ç»ˆè¦æ‰§è¡Œçš„Handlerï¼› ç„¶åŽå°†Handlerï¼ˆè‡ªå·±çš„ä¸šåŠ¡å¤„ç†ï¼‰å¯¹è±¡ä»¥åŠå…¶å¯¹åº”çš„æ‹¦æˆªå™¨ï¼Œå°è£…åˆ°HandlerExecutionChainå¯¹è±¡ä¸­å¹¶ä»¥å®ƒçš„å½¢å¼æ”¾å›žï¼› å‰ç«¯æŽ§åˆ¶å™¨æ ¹æ®èŽ·å–åˆ°çš„Handlerï¼ˆControllerï¼‰ï¼ŒåŽ»é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„HandlerAdapterï¼ˆå®ƒè¿˜æ”¯æŒServletã€HttpRequestHandlerã€ThrowawayControllerï¼‰ï¼ŒæˆåŠŸèŽ·å–åˆ°ä¼šå…ˆåŽ»æ‰§è¡Œæ‹¦æˆªå™¨ï¼› è¿™æ—¶å°†å¼€å§‹å¯¹æå–Requestä¸­çš„æ¨¡åž‹æ•°æ®ï¼Œå¹¶ä¸”å°†Handlerçš„å…¥å‚è¿›è¡Œæ•°æ®å¡«å……ï¼Œä»¥è‡³äºŽæˆ‘ä»¬å†™æŽ§åˆ¶å±‚æ–¹æ³•æ—¶ï¼Œå…¥å‚æ˜¯å‰ç«¯ä¼ æ¥çš„å€¼ï¼Œåœ¨å¡«å……è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®è‡ªå·±çš„é…ç½®ï¼ŒSpringè¿˜å¯ä»¥å¸®ä½ åšä¸€äº›é¢å¤–æ“ä½œï¼š Json/Xml æ•°æ®è½¬æ¢æˆå¯¹è±¡ æ ¼å¼åŒ–è¯·æ±‚æ•°æ® æ ¡éªŒ Handleræ‰§è¡Œå®ŒæˆåŽï¼Œè¿”å›žä¸€ä¸ªModelAndViewï¼ˆè§†å›¾å’Œè§†å›¾éœ€è¦å¡«å……çš„æ¨¡åž‹æ•°æ®ï¼‰ å‰ç«¯æŽ§åˆ¶å™¨æ ¹æ®è¿”å›žçš„ModelAndViewï¼Œé€‰æ‹©åˆé€‚çš„ViewResolver ViewResolver ç»“åˆModelå’ŒViewï¼Œæ¥æ¸²æŸ“è§†å›¾ æœ€ç»ˆå‰ç«¯æŽ§åˆ¶å™¨å°†æ¸²æŸ“ç»“æžœè¿”å›žç»™å®¢æˆ·ç«¯ 1.2 springboot æœ‰ä»€ä¹ˆä¼˜ç‚¹springboot å®ƒå¯ä»¥å¸®æˆ‘å¿«é€Ÿã€ä½¿ç”¨æœ€ä½Žä»£ç æœ€å°‘æ—¶é—´å¼€å‘å‡ºä¸€ä¸ªé¡¹ç›®ï¼Œä¸æƒ³ SpringMVCï¼Œéœ€è¦ç¹çå†™å¾ˆå¤šé…ç½®ä¿¡æ¯ï¼Œæˆ‘ä»¬åªå…³æ³¨å†™ä¸šåŠ¡ä»£ç å³å¯ã€‚ é€šè¿‡é…ç½®æ–‡ä»¶è§£è€¦ä»£ç ï¼Œåœ¨ä¸€äº›å¯èƒ½æ”¹åŠ¨çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥ä¸é€šè¿‡ä¿®æ”¹ä»£ç å†æ‰“åŒ…éƒ¨ç½²ï¼Œè€Œæ˜¯è®©ä»£ç åŽ»å¤–éƒ¨è¯»å–è¯¥é…ç½®æ–‡ä»¶ï¼Œå†åŽ»è¿è¡Œã€‚ è¿˜æœ‰SpringBootæ˜¯ä½¿ç”¨äº†maven å¯ä»¥æ–¹ä¾¿å¯¹ç‰ˆæœ¬çš„ç®¡ç†ï¼Œèƒ½å¤Ÿè®©è‡ªå·±ä¸éœ€è¦è€ƒè™‘ç‰ˆæœ¬ä¾èµ–é—®é¢˜å’Œå…¼å®¹ç‰ˆæœ¬çš„é—®é¢˜ã€‚ Redis ç¯‡æœ‰ä½¿ç”¨è¿‡ Rediså—æœ‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªç¼“å­˜æ•°æ®åº“ï¼Œä¸»è¦å­˜å‚¨çš„æ˜¯k-vç±»åž‹çš„æ•°æ®ã€‚ é‚£è¯´è¯´å®ƒçš„ä¸€ä¸ªç¼“å­˜é›ªå´©ï¼Ÿå—¯ï¼Ÿç¼“å­˜é›ªå´©çš„è¯ï¼Œå°±æ˜¯keyé›†ä¸­å¤±æ•ˆï¼Œå¯¼è‡´ Redis ç›¸å½“äºŽå®•æœºï¼Œå¤§é‡è¯·æ±‚ä¾æ—§æ‰“åˆ°mysqlæ•°æ®åº“ä¸Šäº†ã€‚ è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®žé›ªå´©RedisæœåŠ¡åŸºæœ¬ä¸å¯ç”¨äº†ï¼Œå­˜å‚¨å±‚çš„è°ƒç”¨é‡ä¼šæš´å¢žï¼Œé€ æˆå­˜å‚¨å±‚ä¹Ÿä¼šæŒ‚æŽ‰çš„æƒ…å†µï¼Œè€Œä¸”é›ªå´©ä¼šå‡ºçŽ°å‘¨æœŸæ€§çš„å³°å€¼ï¼Œå› ä¸ºå°±ç®—ç¼“å­˜å¤±æ•ˆäº†ï¼Œè¯·æ±‚åˆ°äº†å­˜å‚¨å±‚ï¼ŒèŽ·å–åˆ°æ•°æ®åŽï¼Œæ˜¯ä¼šå†åšä¸€æ¬¡ç¼“å­˜çš„ï¼Œæ‰€ä»¥ä¼šå‡ºçŽ°å‘¨æœŸæ€§å³°å€¼ã€‚ è‡´å‘½çš„åŽŸå› æ˜¯å­˜å‚¨å±‚åœ¨æš´å¢žçš„æƒ…å†µä¸‹æ‰›ä¸ä½è°ƒç”¨åŽï¼Œå¯¼è‡´æ•°æ®åº“ç›´æŽ¥æŒ‚æŽ‰äº†ã€‚ æœ‰ä»€ä¹ˆè§£å†³æŽªæ–½ï¼Ÿå—¯ï¼Ÿæˆ‘ä»¬å¯ä»¥å¯¹é‚£ä¸ª key çš„ç¼“å­˜æ—¶é—´è®¾ç½®æ›´é•¿ä¸€äº›ï¼Œç¼“å­˜é›ªå´©å¯¼è‡´çš„åŽŸå› æ˜¯å› ä¸ºå¤ªè¿‡äºŽé›†ä¸­å¤±æ•ˆï¼Œå¯¼è‡´æš´å¢žï¼Œé‚£ä¹ˆå¦‚æžœæˆ‘ä»¬å‡æ‘Šä¸€ä¸‹æ—¶é—´ï¼Œå°±èƒ½é¿å…å‡ºçŽ°è¯¥æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹ç¼“å­˜æ—¶æ•ˆè®¾ç½®çš„æ›´éšæœºæ€§ä¸€äº›ï¼Œä¸”å¯¹ä¸€äº›çƒ­ç‚¹æ•°æ®ç¼“å­˜æ—¶é—´è®¾ç½®æ°¸ä¹…æ€§ã€‚","categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"}],"author":null},{"title":"ConCurrentHashMapåº•å±‚åŽŸç†é€æž","slug":"ConCurrentHashMapåº•å±‚åŽŸç†é€æž","date":"2022-08-06T05:56:54.000Z","updated":"2022-08-06T05:58:47.505Z","comments":true,"path":"2022/08/06/ConCurrentHashMapåº•å±‚åŽŸç†é€æž/","link":"","permalink":"http://fyupeng.github.io/2022/08/06/ConCurrentHashMap%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E9%80%8F%E6%9E%90/","excerpt":"","text":"åˆ›ä½œå®—æ—¨ï¼šåŒ–ç¹ä¸ºç®€ï¼Œç»ä¸å†—ä½™ï¼Œç‚¹åˆ°ä¸ºæ­¢ ConcurrentHashMap&lt;K,V&gt; ç»§æ‰¿äº†AbstractMap&lt;K,V&gt;ï¼Œå®žçŽ°äº†ConcurrentMap&lt;K,V&gt;å’ŒSerializableã€‚è¯´æ˜Žï¼šAbstractMap&lt;K,V&gt;å®žçŽ°äº†åŸºæœ¬çš„Mapæ“ä½œConcurrentMap&lt;K,V&gt;è§„èŒƒäº†å¯¹k-vçš„å¹¶å‘æ“ä½œçš„æ–¹æ³• ä¸€ã€ä»‹ç» ConCurrentHashMapæ˜¯å¦‚ä½•åšåˆ°çº¿ç¨‹å®‰å…¨çš„ï¼Ÿé€šä¿—æ¥è®²ï¼ŒConcurrentHashMap&lt;K,V&gt;å·²ç»è¿­ä»£äº†å‡ ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬å…ˆä»ŽJDK7è¯´èµ·,èµ·åˆä¸ºäº†å®žçŽ°äº†å¯¹HashMapçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘ï¼Œåœ¨ConcurrentHashMap&lt;K,V&gt;å¼•å…¥äº†ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Segment(æ®µ)ï¼Œè€Œä¸”ConcurrentHashMap&lt;K,V&gt;ä¹Ÿèšåˆäº†ä¸€ä¸ªSegmentçš„æˆå‘˜å˜é‡æ•°ç»„æ¥ç»´æŠ¤ï¼Œæ¯ä¸€ä¸ªSegmentæ•°ç»„çš„ä¸‹æ ‡å…ƒç´ ç›¸å½“äºŽä¸€ä¸ªHashMapï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªHashEntryæ•°ç»„ + æ¯ä½ä¸‹æ ‡å…ƒç´ æž„æˆä¸€ä¸ªHashEntryé“¾çš„å¤´ç»“ç‚¹ï¼ˆä¾æ—§ä¿å­˜å€¼ï¼‰ï¼Œæ¯æ¬¡å­˜åœ¨çº¿ç¨‹å®‰å…¨çš„æ“ä½œéƒ½ä¼šåŽ»ä½¿ç”¨è¯¥æ•°ç»„çš„å…¶ä¸­ä¸€ä¸ªä¸‹æ ‡ï¼Œå¹¶é”ä½è¯¥ä¸‹æ ‡ï¼ˆå…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®ï¼‰ï¼Œè€Œä¸åŒ[ä¸‹æ ‡ä¹‹é—´çš„æ“ä½œæ˜¯ä¸ä¼šç›¸äº’å½±å“çš„ï¼Œä¹Ÿå°±ä¸å­˜åœ¨å†²çªçš„æƒ…å†µã€‚Segmentç»§æ‰¿äº†ReentrantLockï¼ˆå¯é‡å…¥é”ï¼‰ï¼Œç”¨æ³•å…¶å®žç”¨åˆ°åŠ é”å’Œè§£é”ï¼Œä¿è¯æ¯ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å‰åŠ é”ï¼Œä½¿ç”¨å®ŒæˆåŽé‡Šæ”¾é”ã€‚ConcurrentHashMapä¸­Segmentä¸ŽEntriesçš„ç¤ºæ„å›¾æ›´ä¸“ä¸šæ¥è®²ï¼ŒConcurrentHashMapä½¿ç”¨äº†åˆ†æ®µé”Segmentæ¥è§£å†³çº¿ç¨‹å®‰å…¨ã€‚2. JDK7 çš„ get å’Œ put ä»¥åŠæ‰©å®¹ getget æ“ä½œæ²¡æœ‰ä»»ä½•åŠ é”ï¼Œæ‰€ä»¥åœ¨ConCurrentæ˜¯éžå¸¸é«˜æ•ˆçš„ã€‚123456static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next;&#125; å°±ç®—èŽ·å–keyä¹‹å‰valueè¢«æ”¹å˜äº†ï¼Œç”±äºŽvolatileä¿®é¥°äº†valueå˜é‡ï¼Œæ‰€ä»¥å¯¹å†…å®¹æ˜¯åŠæ—¶æ›´æ–°çš„ï¼Œæ–°å¢žå’Œåˆ é™¤æ“ä½œäº¦æ˜¯å¦‚æ­¤ã€‚1234567891011121314151617181920212223public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; int h = hash(key); long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; // Concurrent åˆå§‹åŒ–æ—¶ä¼šåˆå§‹ Segmentæ•°ç»„å’Œ ç¬¬ 0 ä½ä¸‹æ ‡å³Segment[0]ï¼ˆåŒ…æ‹¬ HashEntryæ•°ç»„ çš„åˆå§‹åŒ–ï¼‰ // å¦‚æžœ segment å¯¹åº”çš„ HashEntry æ•°ç»„ä¸ä¸ºç©ºï¼Œåˆ™å¾€ä¸‹éåŽ† if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; // éåŽ† HashEntry æ•°ç»„ å“ˆå¸Œå‘½ä¸­çš„ä¸‹æ ‡å…ƒç´ ï¼ˆé“¾è¡¨ï¼‰ for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; // å¦‚æžœæ‰¾åˆ°äº† keyå°±è¿”å›žå¯¹åº”çš„valueï¼Œå¦åˆ™å¾€ä¸‹ç»§ç»­éåŽ†é“¾è¡¨ // è¿™é‡Œå‰é¢åŒ¹é…çš„æ˜¯ åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œ //å¦‚æžœæ˜¯ å¤æ‚å¯¹è±¡ï¼Œåˆ™ä½¿ç”¨çš„æ˜¯å…ˆ hashç­›é€‰æ¡¶ä¸‹æ ‡ï¼Œç›¸ç­‰å†åŽ» æ¯”è¾ƒ â€œå€¼â€ if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null;&#125; putåœ¨ConcurrentHashMapä¸­postæ“ä½œæ˜¯ä¸å…è®¸è®¾ç½®valueä¸ºnullã€‚Concurrentåˆå§‹åŒ–æ—¶ä¼šåˆå§‹Segmentæ•°ç»„å’Œ ç¬¬0ä½ä¸‹æ ‡å³Segment[0]ï¼ˆå…¶ä¸­åŒ…æ‹¬HashEntryæ•°ç»„çš„åˆå§‹åŒ–ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œä¼šå‡ºçŽ°å‘½ä¸­åˆ°å¦å¤–15ä¸ªæœªåˆå§‹åŒ–çš„Segmenté”æ®µï¼Œå³å½“å‰Segmentä¸ºnullçš„æƒ…å†µ1234567891011121314public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; // ä¸å…è®¸å¯¹ value è®¾ç½®ä¸º null if (value == null) throw new NullPointerException(); int hash = hash(key); int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; // æ²¡æœ‰æ‰¾åˆ°ï¼Œå³è¯´æ˜Žæœªåˆå§‹åŒ– if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject // nonvolatile; recheck (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) // in ensureSegment // åˆå§‹åŒ–å½“å‰ Segment å¯¹åº”çš„ HashEntry æ•°ç»„ s = ensureSegment(j); return s.put(key, hash, value, false);&#125; putç»†èŠ‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; // å°è¯•åŠ é” HashEntry&lt;K,V&gt; node = tryLock() ? null : // å¦‚æžœä¸æˆåŠŸ, è¿›å…¥ scanAndLockForPut æµç¨‹ // å¦‚æžœæ˜¯å¤šæ ¸ cpu æœ€å¤š tryLock 64 æ¬¡, è¿›å…¥ lock æµç¨‹ // åœ¨å°è¯•æœŸé—´, è¿˜å¯ä»¥é¡ºä¾¿çœ‹è¯¥èŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­æœ‰æ²¡æœ‰, å¦‚æžœæ²¡æœ‰é¡ºä¾¿åˆ›å»ºå‡ºæ¥ scanAndLockForPut(key, hash, value); // æ‰§è¡Œåˆ°è¿™é‡Œ segment å·²ç»è¢«æˆåŠŸåŠ é”, å¯ä»¥å®‰å…¨æ‰§è¡Œ V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; // æ›´æ–° K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123; // æ–°å¢ž // 1) ä¹‹å‰ç­‰å¾…é”æ—¶, node å·²ç»è¢«åˆ›å»º, next æŒ‡å‘é“¾è¡¨å¤´ if (node != null) node.setNext(first); else // 2) åˆ›å»ºæ–° node node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; // 3) æ‰©å®¹ // å¿…é¡» æ˜¯ è¾¾åˆ°é˜ˆå€¼ å¹¶ä¸” HashEntry æ•°ç»„è¿˜æ²¡è¢«æ‰©å®¹ï¼Œä¹Ÿå°±æ˜¯é•¿åº¦ä¾æ—§æ˜¯æ—§å€¼ if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else // tabå·²æ›´æ–°ï¼Œå³æ‰©å®¹å·²ç»å®Œæ¯•ï¼Œå°† node ä½œä¸ºé“¾è¡¨å¤´ setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; æ‰©å®¹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162private void rehash(HashEntry&lt;K,V&gt; node) &#123; // æ¯ä¸ª Segment å¯¹åº”çš„ä¸€ä¸ª HashEntry&lt;K,V&gt;æ•°ç»„ HashEntry&lt;K,V&gt;[] oldTable = table; // æ‰©å®¹å‰ HashEntry&lt;K,V&gt;æ•°ç»„çš„é•¿åº¦ int oldCapacity = oldTable.length; // æ‰©å®¹åŽ HashEntry&lt;K,V&gt;æ•°ç»„çš„é•¿åº¦ = æ‰©å®¹å‰ HashEntry&lt;K,V&gt;æ•°ç»„çš„é•¿åº¦ * 2 int newCapacity = oldCapacity &lt;&lt; 1; // æ‰©å®¹é˜ˆå€¼çš„å…ƒç´ æ•°é‡ï¼ŒHashEntry&lt;K,V&gt;æ•°ç»„ ä¸­å…ƒç´ çš„ä¸ªæ•°åˆ° æŸä¸ªæ•°é‡ï¼ˆä½ŽäºŽæœ€å¤§æ•°ï¼‰æ—¶çš„æ•°é‡ threshold = (int)(newCapacity * loadFactor); // åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ HashEntry æ•°ç»„ï¼Œæ¯ä¸ªä¸‹æ ‡è¡¨ç¤ºçš„ HashEntry éƒ½ä¸º nullï¼ŒåŽé¢ä¼šç”¨åˆ°è¿™ä¸ª null åšå¤´æ’æ³• put å…ƒç´  HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; // hash å‘½ä¸­ &amp; æ“ä½œè¦ç”¨çš„æŽ©ç ï¼ˆè®¡ç®—hashç»“æžœçš„é•¿åº¦ï¼‰ int sizeMask = newCapacity - 1; // éåŽ† æ‰©å®¹å‰ HashEntry&lt;K,V&gt;æ•°ç»„ for (int i = 0; i &lt; oldCapacity ; i++) &#123; HashEntry&lt;K,V&gt; e = oldTable[i]; if (e != null) &#123; HashEntry&lt;K,V&gt; next = e.next; int idx = e.hash &amp; sizeMask; // å½“å‰ HashEntry&lt;K,V&gt;æ•°ç»„ ä¸‹æ ‡åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™ç›´æŽ¥èµ‹å€¼ç»™ æ–°æ•°ç»„å¯¹åº”ä¸‹æ ‡ // è¿™é‡Œå¯¹åº”çš„æ–°çš„ä¸‹æ ‡è·Ÿ åŽŸä¸‹æ ‡å·²ç»ä¸ä¸€æ ·äº†ï¼Œå› ä¸ºæ˜¯æŒ‰ç…§ æ‰©å®¹åŽ çš„é•¿åº¦æ¥è®¡ç®—å¾—åˆ°çš„ if (next == null) // Single node on list newTable[idx] = e; // å¦‚æžœé“¾è¡¨é•¿åº¦ å¤§äºŽç­‰äºŽä¸¤ä¸ªå…ƒç´ ä»¥ä¸Š else &#123; // Reuse consecutive sequence at same slot HashEntry&lt;K,V&gt; lastRun = e; int lastIdx = idx; // é‡ç”¨ é“¾è¡¨æœ€åŽé¢ æ–°å‘½ä¸­å€¼ ç›¸åŒçš„ for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) &#123; int k = last.hash &amp; sizeMask; if (k != lastIdx) &#123; lastIdx = k; lastRun = last; &#125; &#125; // å°†é‡ç”¨çš„é“¾è¡¨å¤´ç»“ç‚¹ è½¬ç§»åˆ° æ–°çš„ æ•°ç»„ä¸­ newTable[lastIdx] = lastRun; // Clone remaining nodes // é“¾è¡¨å‰©ä¸‹çš„ éƒ¨åˆ†ï¼ŒæŒ¨ä¸ªæŒ‰ç…§å¤´æ’æ³• å‘½ä¸­åˆ° æ–°çš„æ•°ç»„ä¸­ for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123; V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V&gt; n = newTable[k]; newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); &#125; &#125; &#125; &#125; // æœ€åŽå† æŠŠè¦ put çš„å€¼ å¤´æ’æ³• åŠ å…¥åˆ° æ–°çš„æ•°ç»„ä¸­ int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; // è¿™é‡Œé€šè¿‡ æš‚æ—¶ æ•°ç»„æ“ä½œå®Œæ¯•å† èµ‹å€¼ï¼Œèƒ½å¤Ÿé¿å…æ“ä½œä¸­é€” è¢«å…¶ä»– çº¿ç¨‹å†æ¬¡é‡å¤æ“ä½œ // åœ¨è¿™ä¹‹å‰ å…¶ä»– çº¿ç¨‹æ— æ³•è¿›å…¥ // ä¸€èµ‹å€¼ å…¶ä»–çº¿ç¨‹ å°±ç®—åˆ¤æ–­ è¾¾åˆ°é˜ˆå€¼ï¼Œä½†newTable çš„å¤§å°æ”¹å˜ // tab.length &lt; MAXIMUM_CAPACITY ä¹Ÿä¼šè®© å…¶ä»–çº¿ç¨‹ç›´æŽ¥åŽ» æ–°çš„æ•°ç»„ put æ“ä½œ table = newTable;&#125; JDK8æŠ›å¼ƒäº†Segmentåˆ†æ®µé”ï¼Œè½¬è€Œä½¿ç”¨CAS+synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚å¹¶ä¸”ï¼Œä¸å†å•çº¯ä½¿ç”¨é“¾è¡¨ï¼ŒJDK8åœ¨HashEntryæ•°ç»„ä¸­çš„é“¾è¡¨é•¿åº¦å¤§äºŽ8çš„æ—¶å€™ä¼šåŽ»è½¬åŒ–ä¸ºçº¢é»‘æ ‘ç»“æž„ã€‚åœ¨è¿™é‡Œï¼Œé“¾è¡¨é•¿åº¦å¤§äºŽ8æ—¶ï¼Œæ‰ä¼šåŽ»è¿›ä¸€æ­¥åˆ¤æ–­é˜ˆå€¼æ˜¯å¦è¾¾åˆ°ã€‚ä¸ŽJDK7æ‰©å®¹çš„åŒºåˆ«åœ¨ä¸Šä¸€ç¯‡ æ·±å…¥æµ…å‡º~HashMapçš„åº•å±‚åŽŸç†é€æž è¯¦ç»†è®²è¿‡äº†ï¼Œå…¶å®žä¸ŽConCurrentHashMapå¤§åŒå°å¼‚ï¼Œä¹Ÿå°±æ˜¯å¤šåšäº†CASçš„æ“ä½œã€é“¾è¡¨è½¬åŒ–çº¢é»‘æ ‘å’Œç­‰å¾…çš„putä¼šå¸®å¿™æ‰©å®¹ã€‚ è¡¥å……ï¼šå¸®å¿™æ‰©å®¹æ—¶JDK8é‡Œé¢å¾ˆå·§å¦™çš„ä¸€ç‚¹ï¼Œå°±æ˜¯putæ“ä½œæ˜¯åœ¨å…¶ä»–çº¿ç¨‹åœ¨åšæ‰©å®¹å°±ä¼šåŽ»å¸®å¿™æ‰©å®¹ï¼ŒJDK7åˆ™ç›´æŽ¥é”ä½ï¼Œç­‰æ‰©å®¹å®Œæ¯•åŽæ‰å¯ä»¥æ“ä½œï¼Œè€Œgetæ“ä½œåœ¨æ‰©å®¹å°±è¦ä¿è¯å¯è§æ€§ï¼ŒJDK7ç”¨UnSafeåšäº†å¯è§æ€§ï¼Œè‡³äºŽä¸ºä½•ç”¨UnSafeï¼Œå®˜æ–¹ç»™çš„æ˜¯â€œJavaæ•°ç»„åœ¨å…ƒç´ å±‚é¢çš„å…ƒæ•°æ®è®¾è®¡ä¸Šçš„ç¼ºå¤±ï¼Œæ— æ³•è¡¨è¾¾å…ƒç´ æ˜¯finalã€volatileç­‰è¯­ä¹‰â€ï¼Œä¹Ÿå°±æ˜¯å³ä½¿æœ‰@volatileçš„tableä¹Ÿä¸èƒ½ä¿è¯tableä¸­å…ƒç´ çš„å¯è§æ€§ï¼ŒJDK8çš„getæ“ä½œå¦‚æžœæ˜¯åœ¨æ‰©å®¹ä¸­ï¼Œå°±ä¼šæ‹¿åˆ°ForwardingNode ç›´æŽ¥åŽ»æ–°tableèŽ·å–ã€‚","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"JavaåŽŸç†","slug":"JavaåŽŸç†","permalink":"http://fyupeng.github.io/tags/Java%E5%8E%9F%E7%90%86/"}],"author":"fyupeng"},{"title":"è´ªå¿ƒç®—æ³•","slug":"è´ªå¿ƒç®—æ³•","date":"2022-08-06T03:57:51.000Z","updated":"2022-08-06T04:00:08.680Z","comments":true,"path":"2022/08/06/è´ªå¿ƒç®—æ³•/","link":"","permalink":"http://fyupeng.github.io/2022/08/06/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/","excerpt":"","text":"è´ªå¿ƒç®—æ³•1. 455. åˆ†å‘é¥¼å¹²é—®é¢˜å‡è®¾ä½ æ˜¯ä¸€ä½å¾ˆæ£’çš„å®¶é•¿ï¼Œæƒ³è¦ç»™ä½ çš„å­©å­ä»¬ä¸€äº›å°é¥¼å¹²ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå­©å­æœ€å¤šåªèƒ½ç»™ä¸€å—é¥¼å¹²ã€‚ å¯¹æ¯ä¸ªå­©å­ iï¼Œéƒ½æœ‰ä¸€ä¸ªèƒƒå£å€¼ g[i]ï¼Œè¿™æ˜¯èƒ½è®©å­©å­ä»¬æ»¡è¶³èƒƒå£çš„é¥¼å¹²çš„æœ€å°å°ºå¯¸ï¼›å¹¶ä¸”æ¯å—é¥¼å¹² jï¼Œéƒ½æœ‰ä¸€ä¸ªå°ºå¯¸ s[j] ã€‚å¦‚æžœ s[j] &gt;= g[i]ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé¥¼å¹² j åˆ†é…ç»™å­©å­ i ï¼Œè¿™ä¸ªå­©å­ä¼šå¾—åˆ°æ»¡è¶³ã€‚ä½ çš„ç›®æ ‡æ˜¯å°½å¯èƒ½æ»¡è¶³è¶Šå¤šæ•°é‡çš„å­©å­ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªæœ€å¤§æ•°å€¼ã€‚ ç¤ºä¾‹ 1: 123456è¾“å…¥: g = [1,2,3], s = [1,1]è¾“å‡º: 1è§£é‡Š: ä½ æœ‰ä¸‰ä¸ªå­©å­å’Œä¸¤å—å°é¥¼å¹²ï¼Œ3ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯ï¼š1,2,3ã€‚è™½ç„¶ä½ æœ‰ä¸¤å—å°é¥¼å¹²ï¼Œç”±äºŽä»–ä»¬çš„å°ºå¯¸éƒ½æ˜¯1ï¼Œä½ åªèƒ½è®©èƒƒå£å€¼æ˜¯1çš„å­©å­æ»¡è¶³ã€‚æ‰€ä»¥ä½ åº”è¯¥è¾“å‡º1ã€‚ ç¤ºä¾‹ 2: 123456è¾“å…¥: g = [1,2], s = [1,2,3]è¾“å‡º: 2è§£é‡Š: ä½ æœ‰ä¸¤ä¸ªå­©å­å’Œä¸‰å—å°é¥¼å¹²ï¼Œ2ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯1,2ã€‚ä½ æ‹¥æœ‰çš„é¥¼å¹²æ•°é‡å’Œå°ºå¯¸éƒ½è¶³ä»¥è®©æ‰€æœ‰å­©å­æ»¡è¶³ã€‚æ‰€ä»¥ä½ åº”è¯¥è¾“å‡º2. æç¤ºï¼š 1 &lt;= g.length &lt;= 3 * 104 0 &lt;= s.length &lt;= 3 * 104 1 &lt;= g[i], s[j] &lt;= 231 - 1 ä»£ç 123456789101112131415161718class Solution &#123; public int findContentChildren(int[] g, int[] s) &#123; Arrays.sort(g); Arrays.sort(s); int index = 0; int result = 0; for(int i = 0; i &lt; g.length &amp;&amp; index &lt; s.length; i++)&#123; if(g[i] &lt;= s[index]) &#123; // åƒæŽ‰ result++; &#125; else &#123; i--; &#125; index++; &#125; return result; &#125;&#125; 2. 376. æ‘†åŠ¨åºåˆ—é—®é¢˜å¦‚æžœè¿žç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸º æ‘†åŠ¨åºåˆ— ã€‚ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æžœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚ä»…æœ‰ä¸€ä¸ªå…ƒç´ æˆ–è€…å«ä¸¤ä¸ªä¸ç­‰å…ƒç´ çš„åºåˆ—ä¹Ÿè§†ä½œæ‘†åŠ¨åºåˆ—ã€‚ ä¾‹å¦‚ï¼Œ [1, 7, 4, 9, 2, 5] æ˜¯ä¸€ä¸ª æ‘†åŠ¨åºåˆ— ï¼Œå› ä¸ºå·®å€¼ (6, -3, 5, -7, 3) æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºçŽ°çš„ã€‚ ç›¸åï¼Œ[1, 4, 7, 2, 5] å’Œ [1, 7, 4, 5, 5] ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åŽä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚å­åºåˆ— å¯ä»¥é€šè¿‡ä»ŽåŽŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥èŽ·å¾—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŽŸå§‹é¡ºåºã€‚ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¿”å›ž nums ä¸­ä½œä¸º æ‘†åŠ¨åºåˆ— çš„ æœ€é•¿å­åºåˆ—çš„é•¿åº¦ ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šnums = [1,7,4,9,2,5]è¾“å‡ºï¼š6è§£é‡Šï¼šæ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (6, -3, 5, -7, 3) ã€‚ ç¤ºä¾‹ 2ï¼š 1234è¾“å…¥ï¼šnums = [1,17,5,10,13,15,10,5,16,8]è¾“å‡ºï¼š7è§£é‡Šï¼šè¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º 7 æ‘†åŠ¨åºåˆ—ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ [1, 17, 10, 13, 10, 16, 8] ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (16, -7, 3, -3, 6, -8) ã€‚ ç¤ºä¾‹ 3ï¼š 12è¾“å…¥ï¼šnums = [1,2,3,4,5,6,7,8,9]è¾“å‡ºï¼š2 æç¤ºï¼š 1 &lt;= nums.length &lt;= 1000 0 &lt;= nums[i] &lt;= 1000 ä»£ç  è´ªå¿ƒæ³• 12345678910111213141516class Solution &#123; public int wiggleMaxLength(int[] nums) &#123; int curDiff = 0; int preDiff = 0; int result = 1; // è€ƒè™‘ å³ è¾¹ç•Œå€¼ ç‰¹æ®Šæƒ…å†µ for(int i = 0; i &lt; nums.length - 1; i++) &#123; // è€ƒè™‘äº† å·¦è¾¹ç•Œå€¼ ç‰¹æ®Šæƒ…å†µ curDiff = nums[i] - nums[i + 1]; if(curDiff &lt; 0 &amp;&amp; preDiff &gt;= 0 || curDiff &gt; 0 &amp;&amp; preDiff &lt;= 0) &#123; result++; preDiff = curDiff; &#125; &#125; return result; &#125;&#125; åŠ¨æ€è§„åˆ’ 1234567891011121314151617class Solution &#123; public int wiggleMaxLength(int[] nums) &#123; int n = nums.length; if(n &lt; 2) return n; int up = 1; int down = 1; for(int i = 1; i &lt; n; i++) &#123; if(nums[i] &lt; nums[i - 1]) &#123; down = up + 1; &#125; if(nums[i] &gt; nums[i - 1]) &#123; up = down + 1; &#125; &#125; return Math.max(up, down); &#125;&#125; 3. 53. æœ€å¤§å­æ•°ç»„å’Œé—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿žç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›žå…¶æœ€å¤§å’Œã€‚ å­æ•°ç»„ æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿žç»­éƒ¨åˆ†ã€‚ ç¤ºä¾‹ 1ï¼š 1234è¾“å…¥ï¼šnums = [-2,1,-3,4,-1,2,1,-5,4]è¾“å‡ºï¼š6è§£é‡Šï¼šè¿žç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6 ã€‚ ç¤ºä¾‹ 2ï¼š 12è¾“å…¥ï¼šnums = [1]è¾“å‡ºï¼š1 ç¤ºä¾‹ 3ï¼š 12è¾“å…¥ï¼šnums = [5,4,-1,7,8]è¾“å‡ºï¼š23 æç¤ºï¼š 1 &lt;= nums.length &lt;= 105 -104 &lt;= nums[i] &lt;= 104 ä»£ç 12345678910111213141516class Solution &#123; public int maxSubArray(int[] nums) &#123; int res = - 10000; int sum = 0; for(int i = 0; i &lt; nums.length; i++) &#123; sum += nums[i]; if(sum &gt; res) &#123; res = sum; &#125; if(sum &lt; 0) &#123; sum = 0; &#125; &#125; return res; &#125;&#125; 4. 122. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IIé—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ prices ï¼Œå…¶ä¸­ prices[i] è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ i å¤©çš„ä»·æ ¼ã€‚ åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ/æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ æœ€å¤š åªèƒ½æŒæœ‰ ä¸€è‚¡ è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶åŽåœ¨ åŒä¸€å¤© å‡ºå”®ã€‚ è¿”å›ž ä½ èƒ½èŽ·å¾—çš„ æœ€å¤§ åˆ©æ¶¦ ã€‚ ç¤ºä¾‹ 1ï¼š 12345è¾“å…¥ï¼šprices = [7,1,5,3,6,4]è¾“å‡ºï¼š7è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½èŽ·å¾—åˆ©æ¶¦ = 5 - 1 = 4 ã€‚ éšåŽï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½èŽ·å¾—åˆ©æ¶¦ = 6 - 3 = 3 ã€‚ æ€»åˆ©æ¶¦ä¸º 4 + 3 = 7 ã€‚ ç¤ºä¾‹ 2ï¼š 1234è¾“å…¥ï¼šprices = [1,2,3,4,5]è¾“å‡ºï¼š4è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ = 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½èŽ·å¾—åˆ©æ¶¦ = 5 - 1 = 4 ã€‚ æ€»åˆ©æ¶¦ä¸º 4 ã€‚ ç¤ºä¾‹ 3ï¼š 123è¾“å…¥ï¼šprices = [7,6,4,3,1]è¾“å‡ºï¼š0è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, äº¤æ˜“æ— æ³•èŽ·å¾—æ­£åˆ©æ¶¦ï¼Œæ‰€ä»¥ä¸å‚ä¸Žäº¤æ˜“å¯ä»¥èŽ·å¾—æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º 0 ã€‚ æç¤ºï¼š 1 &lt;= prices.length &lt;= 3 * 104 0 &lt;= prices[i] &lt;= 104 ä»£ç  ç›´æŽ¥å†™æ³• 123456789101112131415class Solution &#123; public int maxProfit(int[] prices) &#123; if(prices.length &lt; 2) &#123; return 0; &#125; int res = 0; for(int i = 0; i &lt; prices.length - 1; i++) &#123; int pricesDiff = prices[i + 1] - prices[i]; if(pricesDiff &gt; 0) &#123; res += pricesDiff; &#125; &#125; return res; &#125;&#125; è´ªå¿ƒå†™æ³• 123456789101112class Solution &#123; public int maxProfit(int[] prices) &#123; if(prices.length &lt; 2) &#123; return 0; &#125; int res = 0; for(int i = 0; i &lt; prices.length - 1; i++) &#123; res += Math.max(prices[i + 1] - prices[i], 0); &#125; return res; &#125;&#125; åŠ¨æ€è§„åˆ’ 12345678910111213141516171819class Solution &#123; public int maxProfit(int[] prices) &#123; int n = prices.length; if(n &lt; 2) &#123; return 0; &#125; int[][] dp = new int[n][2]; // è¡¨ç¤º ä¹°è¿›ç¬¬ 0 å¤©çš„è‚¡ dp[0][0] -= prices[0]; //é»˜è®¤åˆå§‹ï¼šdp[0][1] = 0; è¡¨ç¤ºåˆå§‹æ”¶ç›Šä¸º 0 for(int i = 1; i &lt; n; i++) &#123; // è‚¡ç¥¨ä¸‹è·Œï¼Œä¹°è¿› dp[i][0] = Math.max(dp[i - 1][0], dp[i - 1][1] - prices[i]); // è‚¡ç¥¨ä¸Šæ¶¨ï¼Œå–å‡º dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] + prices[i]); &#125; return Math.max(dp[n - 1][0], dp[n - 1][1]); &#125;&#125; 5. 55. è·³è·ƒæ¸¸æˆé—®é¢˜ç»™å®šä¸€ä¸ªéžè´Ÿæ•´æ•°æ•°ç»„ nums ï¼Œä½ æœ€åˆä½äºŽæ•°ç»„çš„ ç¬¬ä¸€ä¸ªä¸‹æ ‡ ã€‚ æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ åˆ¤æ–­ä½ æ˜¯å¦èƒ½å¤Ÿåˆ°è¾¾æœ€åŽä¸€ä¸ªä¸‹æ ‡ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šnums = [2,3,1,1,4]è¾“å‡ºï¼štrueè§£é‡Šï¼šå¯ä»¥å…ˆè·³ 1 æ­¥ï¼Œä»Žä¸‹æ ‡ 0 åˆ°è¾¾ä¸‹æ ‡ 1, ç„¶åŽå†ä»Žä¸‹æ ‡ 1 è·³ 3 æ­¥åˆ°è¾¾æœ€åŽä¸€ä¸ªä¸‹æ ‡ã€‚ ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼šnums = [3,2,1,0,4]è¾“å‡ºï¼šfalseè§£é‡Šï¼šæ— è®ºæ€Žæ ·ï¼Œæ€»ä¼šåˆ°è¾¾ä¸‹æ ‡ä¸º 3 çš„ä½ç½®ã€‚ä½†è¯¥ä¸‹æ ‡çš„æœ€å¤§è·³è·ƒé•¿åº¦æ˜¯ 0 ï¼Œ æ‰€ä»¥æ°¸è¿œä¸å¯èƒ½åˆ°è¾¾æœ€åŽä¸€ä¸ªä¸‹æ ‡ã€‚ æç¤ºï¼š 1 &lt;= nums.length &lt;= 3 * 104 0 &lt;= nums[i] &lt;= 105 ä»£ç 123456789101112class Solution &#123; public boolean canJump(int[] nums) &#123; if(nums.length == 1) return true; // å¯åˆ°è¾¾çš„ æœ€é•¿ä¸‹æ ‡ int cover = 0; for(int i = 0; i &lt;= cover; i++) &#123; cover = Math.max(cover, i + nums[i]); if(cover &gt;= nums.length - 1) return true; &#125; return false; &#125;&#125; 6. 45. è·³è·ƒæ¸¸æˆ IIé—®é¢˜ç»™ä½ ä¸€ä¸ªéžè´Ÿæ•´æ•°æ•°ç»„ nums ï¼Œä½ æœ€åˆä½äºŽæ•°ç»„çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚ æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä»£è¡¨ä½ åœ¨è¯¥ä½ç½®å¯ä»¥è·³è·ƒçš„æœ€å¤§é•¿åº¦ã€‚ ä½ çš„ç›®æ ‡æ˜¯ä½¿ç”¨æœ€å°‘çš„è·³è·ƒæ¬¡æ•°åˆ°è¾¾æ•°ç»„çš„æœ€åŽä¸€ä¸ªä½ç½®ã€‚ å‡è®¾ä½ æ€»æ˜¯å¯ä»¥åˆ°è¾¾æ•°ç»„çš„æœ€åŽä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹ 1: 1234è¾“å…¥: nums = [2,3,1,1,4]è¾“å‡º: 2è§£é‡Š: è·³åˆ°æœ€åŽä¸€ä¸ªä½ç½®çš„æœ€å°è·³è·ƒæ•°æ˜¯ 2ã€‚ ä»Žä¸‹æ ‡ä¸º 0 è·³åˆ°ä¸‹æ ‡ä¸º 1 çš„ä½ç½®ï¼Œè·³ 1 æ­¥ï¼Œç„¶åŽè·³ 3 æ­¥åˆ°è¾¾æ•°ç»„çš„æœ€åŽä¸€ä¸ªä½ç½®ã€‚ ç¤ºä¾‹ 2: 12è¾“å…¥: nums = [2,3,0,1,4]è¾“å‡º: 2 æç¤º: 1 &lt;= nums.length &lt;= 104 0 &lt;= nums[i] &lt;= 1000 ä»£ç  ç‰ˆæœ¬ä¸€ 1234567891011121314151617181920212223242526class Solution &#123; public int jump(int[] nums) &#123; if(nums.length == 1) &#123; return 0; &#125; int curDistance = nums[0]; int nextDistance = 0; int ans = 0;; int n = nums.length; for(int i = 0; i &lt; n; i++) &#123; nextDistance = Math.max(nextDistance, nums[i] + i); // å¦‚æžœå½“å‰ æœ€è¿œæ­¥é•¿ å·²ç»è¾¾åˆ°ç»ˆç‚¹ä¸‹æ ‡äº†ï¼Œ if(curDistance &gt;= n - 1) &#123; ans++; break; &#125; //å¦åˆ™ çœ‹æ˜¯å¦å·²ç» æ»¡è¶³ å½“å‰ä¸‹æ ‡æ˜¯ æœ€è¿œæ­¥é•¿ // ä¸»è¦æ˜¯ä¸ºäº†æ›´æ–° nextDistance ä¸º åœ¨å½“å‰ä¸‹æ ‡åˆ° æœ€è¿œæ­¥é•¿ä¸­ æ‰¾åˆ° ä¸‹ä¸€ä¸ªæœ€è¿œæ­¥é•¿ä¸‹æ ‡æœ€è¿œçš„ if(i == curDistance) &#123; ans++; curDistance = nextDistance; &#125; &#125; return ans; &#125;&#125; ç‰ˆæœ¬äºŒ 123456789101112131415161718192021class Solution &#123; public int jump(int[] nums) &#123; if(nums.length == 1) &#123; return 0; &#125; int curDistance = 0; int nextDistance = 0; int ans = 0;; int n = nums.length; for(int i = 0; i &lt; n - 1; i++) &#123; nextDistance = Math.max(nextDistance, nums[i] + i); //å¦åˆ™ çœ‹æ˜¯å¦å·²ç» æ»¡è¶³ å½“å‰ä¸‹æ ‡æ˜¯ æœ€è¿œæ­¥é•¿ // ä¸»è¦æ˜¯ä¸ºäº†æ›´æ–° nextDistance ä¸º åœ¨å½“å‰ä¸‹æ ‡åˆ° æœ€è¿œæ­¥é•¿ä¸­ æ‰¾åˆ° ä¸‹ä¸€ä¸ªæœ€è¿œæ­¥é•¿ä¸‹æ ‡æœ€è¿œçš„ if(i == curDistance) &#123; ans++; curDistance = nextDistance; &#125; &#125; return ans; &#125;&#125; 7. 1005. K æ¬¡å–ååŽæœ€å¤§åŒ–çš„æ•°ç»„å’Œé—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼ŒæŒ‰ä»¥ä¸‹æ–¹æ³•ä¿®æ”¹è¯¥æ•°ç»„ï¼š é€‰æ‹©æŸä¸ªä¸‹æ ‡ i å¹¶å°† nums[i] æ›¿æ¢ä¸º -nums[i] ã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹æ°å¥½ k æ¬¡ã€‚å¯ä»¥å¤šæ¬¡é€‰æ‹©åŒä¸€ä¸ªä¸‹æ ‡ i ã€‚ ä»¥è¿™ç§æ–¹å¼ä¿®æ”¹æ•°ç»„åŽï¼Œè¿”å›žæ•°ç»„ å¯èƒ½çš„æœ€å¤§å’Œ ã€‚ ç¤ºä¾‹ 1ï¼š 1234è¾“å…¥ï¼šnums = [4,2,3], k = 1è¾“å‡ºï¼š5è§£é‡Šï¼šé€‰æ‹©ä¸‹æ ‡ 1 ï¼Œnums å˜ä¸º [4,-2,3] ã€‚ ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼šnums = [3,-1,0,2], k = 3è¾“å‡ºï¼š6è§£é‡Šï¼šé€‰æ‹©ä¸‹æ ‡ (1, 2, 2) ï¼Œnums å˜ä¸º [3,1,0,2] ã€‚ ç¤ºä¾‹ 3ï¼š 123è¾“å…¥ï¼šnums = [2,-3,-1,5,-4], k = 2è¾“å‡ºï¼š13è§£é‡Šï¼šé€‰æ‹©ä¸‹æ ‡ (1, 4) ï¼Œnums å˜ä¸º [2,3,-1,5,4] ã€‚ æç¤ºï¼š 1 &lt;= nums.length &lt;= 104 -100 &lt;= nums[i] &lt;= 100 1 &lt;= k &lt;= 104 ä»£ç  ç»å¯¹å€¼æŽ’åº 123456789101112131415class Solution &#123; public int largestSumAfterKNegations(int[] nums, int k) &#123; nums = IntStream.of(nums).boxed().sorted((t1, t2) -&gt; Math.abs(t2) - Math.abs(t1)).mapToInt(Integer::intValue).toArray(); for(int i = 0; i &lt; nums.length; i++) &#123; if(nums[i] &lt; 0 &amp;&amp; k &gt; 0) &#123; nums[i] = - nums[i]; k--; &#125; &#125; if(k % 2 == 1) &#123; nums[nums.length - 1] = - nums[nums.length - 1]; &#125; return Arrays.stream(nums).sum(); &#125;&#125; ä»Žå°åˆ°å¤§æŽ’åº 12345678910111213141516171819202122class Solution &#123; public int largestSumAfterKNegations(int[] nums, int k) &#123; int n = nums.length; if(n == 1) return k % 2 == 0 ? nums[0] : -nums[0]; int sum = 0; int index = 0; Arrays.sort(nums); for(int i = 0; i &lt; k; i++) &#123; if(i &lt; nums.length - 1 &amp;&amp; nums[i] &lt; 0) &#123; nums[i] = -nums[i]; if(nums[i] &gt;= Math.abs(nums[i + 1])) index++; continue; &#125; nums[index] = -nums[index]; &#125; for(int i = 0; i &lt; nums.length; i++) &#123; sum += nums[i]; &#125; return sum; &#125;&#125; 8. 134. åŠ æ²¹ç«™é—®é¢˜åœ¨ä¸€æ¡çŽ¯è·¯ä¸Šæœ‰ n ä¸ªåŠ æ²¹ç«™ï¼Œå…¶ä¸­ç¬¬ i ä¸ªåŠ æ²¹ç«™æœ‰æ±½æ²¹ gas[i] å‡ã€‚ ä½ æœ‰ä¸€è¾†æ²¹ç®±å®¹é‡æ— é™çš„çš„æ±½è½¦ï¼Œä»Žç¬¬ i ä¸ªåŠ æ²¹ç«™å¼€å¾€ç¬¬ i+1 ä¸ªåŠ æ²¹ç«™éœ€è¦æ¶ˆè€—æ±½æ²¹ cost[i] å‡ã€‚ä½ ä»Žå…¶ä¸­çš„ä¸€ä¸ªåŠ æ²¹ç«™å‡ºå‘ï¼Œå¼€å§‹æ—¶æ²¹ç®±ä¸ºç©ºã€‚ ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ gas å’Œ cost ï¼Œå¦‚æžœä½ å¯ä»¥ç»•çŽ¯è·¯è¡Œé©¶ä¸€å‘¨ï¼Œåˆ™è¿”å›žå‡ºå‘æ—¶åŠ æ²¹ç«™çš„ç¼–å·ï¼Œå¦åˆ™è¿”å›ž -1 ã€‚å¦‚æžœå­˜åœ¨è§£ï¼Œåˆ™ ä¿è¯ å®ƒæ˜¯ å”¯ä¸€ çš„ã€‚ ç¤ºä¾‹ 1: 12345678910è¾“å…¥: gas = [1,2,3,4,5], cost = [3,4,5,1,2]è¾“å‡º: 3è§£é‡Š:ä»Ž 3 å·åŠ æ²¹ç«™(ç´¢å¼•ä¸º 3 å¤„)å‡ºå‘ï¼Œå¯èŽ·å¾— 4 å‡æ±½æ²¹ã€‚æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹å¼€å¾€ 4 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 1 + 5 = 8 å‡æ±½æ²¹å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 8 - 2 + 1 = 7 å‡æ±½æ²¹å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 7 - 3 + 2 = 6 å‡æ±½æ²¹å¼€å¾€ 2 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 6 - 4 + 3 = 5 å‡æ±½æ²¹å¼€å¾€ 3 å·åŠ æ²¹ç«™ï¼Œä½ éœ€è¦æ¶ˆè€— 5 å‡æ±½æ²¹ï¼Œæ­£å¥½è¶³å¤Ÿä½ è¿”å›žåˆ° 3 å·åŠ æ²¹ç«™ã€‚å› æ­¤ï¼Œ3 å¯ä¸ºèµ·å§‹ç´¢å¼•ã€‚ ç¤ºä¾‹ 2: 123456789è¾“å…¥: gas = [2,3,4], cost = [3,4,3]è¾“å‡º: -1è§£é‡Š:ä½ ä¸èƒ½ä»Ž 0 å·æˆ– 1 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„æ±½æ²¹å¯ä»¥è®©ä½ è¡Œé©¶åˆ°ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ã€‚æˆ‘ä»¬ä»Ž 2 å·åŠ æ²¹ç«™å‡ºå‘ï¼Œå¯ä»¥èŽ·å¾— 4 å‡æ±½æ²¹ã€‚ æ­¤æ—¶æ²¹ç®±æœ‰ = 0 + 4 = 4 å‡æ±½æ²¹å¼€å¾€ 0 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 4 - 3 + 2 = 3 å‡æ±½æ²¹å¼€å¾€ 1 å·åŠ æ²¹ç«™ï¼Œæ­¤æ—¶æ²¹ç®±æœ‰ 3 - 3 + 3 = 3 å‡æ±½æ²¹ä½ æ— æ³•è¿”å›ž 2 å·åŠ æ²¹ç«™ï¼Œå› ä¸ºè¿”ç¨‹éœ€è¦æ¶ˆè€— 4 å‡æ±½æ²¹ï¼Œä½†æ˜¯ä½ çš„æ²¹ç®±åªæœ‰ 3 å‡æ±½æ²¹ã€‚å› æ­¤ï¼Œæ— è®ºæ€Žæ ·ï¼Œä½ éƒ½ä¸å¯èƒ½ç»•çŽ¯è·¯è¡Œé©¶ä¸€å‘¨ã€‚ æç¤º: gas.length == n cost.length == n 1 &lt;= n &lt;= 105 0 &lt;= gas[i], cost[i] &lt;= 104 ä»£ç  æš´åŠ›æ³• 1234567891011121314151617class Solution &#123; public int canCompleteCircuit(int[] gas, int[] cost) &#123; int curGas = 0; for(int i = 0; i &lt; gas.length; i++) &#123; curGas = gas[i] - cost[i]; int index = (i + 1) % gas.length; while(curGas &gt;= 0 &amp;&amp; index != i) &#123; curGas += gas[index] - cost[index]; index = (index + 1) % gas.length; &#125; if(curGas &gt;= 0) &#123; return i; &#125; &#125; return -1; &#125;&#125; è´ªå¿ƒç®—æ³•1 123456789101112131415161718192021class Solution &#123; public int canCompleteCircuit(int[] gas, int[] cost) &#123; int curSum = 0; int min = Integer.MAX_VALUE; for(int i = 0; i &lt; gas.length; i++) &#123; int res = gas[i] - cost[i]; curSum += res; if(curSum &lt; min) &#123; min = curSum; &#125; &#125; if(curSum &lt; 0) return -1; if(min &gt;= 0) return 0; for(int i = gas.length - 1; i &gt;= 0; i--) &#123; int res = gas[i] - cost[i]; min += res; if(min &gt;= 0) return i; &#125; return -1; &#125;&#125; è´ªå¿ƒç®—æ³•2 12345678910111213141516171819class Solution &#123; public int canCompleteCircuit(int[] gas, int[] cost) &#123; int curSum = 0; int totalSum = 0; int startIndex = 0; for(int i = 0; i &lt; gas.length; i++) &#123; int res = gas[i] - cost[i]; curSum += res; totalSum += res; if(curSum &lt; 0) &#123; startIndex = i + 1; curSum = 0; &#125; &#125; if(totalSum &lt; 0) return -1; return startIndex; &#125;&#125; 9. 135. åˆ†å‘ç³–æžœé—®é¢˜n ä¸ªå­©å­ç«™æˆä¸€æŽ’ã€‚ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ ratings è¡¨ç¤ºæ¯ä¸ªå­©å­çš„è¯„åˆ†ã€‚ ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹è¦æ±‚ï¼Œç»™è¿™äº›å­©å­åˆ†å‘ç³–æžœï¼š æ¯ä¸ªå­©å­è‡³å°‘åˆ†é…åˆ° 1 ä¸ªç³–æžœã€‚ç›¸é‚»ä¸¤ä¸ªå­©å­è¯„åˆ†æ›´é«˜çš„å­©å­ä¼šèŽ·å¾—æ›´å¤šçš„ç³–æžœã€‚è¯·ä½ ç»™æ¯ä¸ªå­©å­åˆ†å‘ç³–æžœï¼Œè®¡ç®—å¹¶è¿”å›žéœ€è¦å‡†å¤‡çš„ æœ€å°‘ç³–æžœæ•°ç›® ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼šratings = [1,0,2]è¾“å‡ºï¼š5è§£é‡Šï¼šä½ å¯ä»¥åˆ†åˆ«ç»™ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªå­©å­åˆ†å‘ 2ã€1ã€2 é¢—ç³–æžœã€‚ ç¤ºä¾‹ 2ï¼š 1234è¾“å…¥ï¼šratings = [1,2,2]è¾“å‡ºï¼š4è§£é‡Šï¼šä½ å¯ä»¥åˆ†åˆ«ç»™ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªã€ç¬¬ä¸‰ä¸ªå­©å­åˆ†å‘ 1ã€2ã€1 é¢—ç³–æžœã€‚ç¬¬ä¸‰ä¸ªå­©å­åªå¾—åˆ° 1 é¢—ç³–æžœï¼Œè¿™æ»¡è¶³é¢˜é¢ä¸­çš„ä¸¤ä¸ªæ¡ä»¶ã€‚ æç¤ºï¼š n == ratings.length 1 &lt;= n &lt;= 2 * 104 0 &lt;= ratings[i] &lt;= 2 * 104 ä»£ç 1234567891011121314151617181920212223class Solution &#123; public int candy(int[] ratings) &#123; if(ratings.length == 1) &#123; return 1; &#125; int n = ratings.length; int[] candyArg = new int[n]; for(int i = 0; i &lt; n; i++) &#123; candyArg[i] = 1; &#125; for(int i = 0; i &lt; n - 1; i++) &#123; if(ratings[i + 1] &gt; ratings[i]) candyArg[i + 1] = candyArg[i] + 1; &#125; for(int i = n - 2; i &gt;= 0; i--) &#123; if(ratings[i] &gt; ratings[i + 1]) candyArg[i] = Math.max(candyArg[i], candyArg[i + 1] + 1); &#125; int sum = 0; for(int i = 0; i &lt; n; i++) &#123; sum += candyArg[i]; &#125; return sum; &#125;&#125; 10. 860. æŸ æª¬æ°´æ‰¾é›¶é—®é¢˜åœ¨æŸ æª¬æ°´æ‘Šä¸Šï¼Œæ¯ä¸€æ¯æŸ æª¬æ°´çš„å”®ä»·ä¸º 5 ç¾Žå…ƒã€‚é¡¾å®¢æŽ’é˜Ÿè´­ä¹°ä½ çš„äº§å“ï¼Œï¼ˆæŒ‰è´¦å• bills æ”¯ä»˜çš„é¡ºåºï¼‰ä¸€æ¬¡è´­ä¹°ä¸€æ¯ã€‚ æ¯ä½é¡¾å®¢åªä¹°ä¸€æ¯æŸ æª¬æ°´ï¼Œç„¶åŽå‘ä½ ä»˜ 5 ç¾Žå…ƒã€10 ç¾Žå…ƒæˆ– 20 ç¾Žå…ƒã€‚ä½ å¿…é¡»ç»™æ¯ä¸ªé¡¾å®¢æ­£ç¡®æ‰¾é›¶ï¼Œä¹Ÿå°±æ˜¯è¯´å‡€äº¤æ˜“æ˜¯æ¯ä½é¡¾å®¢å‘ä½ æ”¯ä»˜ 5 ç¾Žå…ƒã€‚ æ³¨æ„ï¼Œä¸€å¼€å§‹ä½ æ‰‹å¤´æ²¡æœ‰ä»»ä½•é›¶é’±ã€‚ ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ bills ï¼Œå…¶ä¸­ bills[i] æ˜¯ç¬¬ i ä½é¡¾å®¢ä»˜çš„è´¦ã€‚å¦‚æžœä½ èƒ½ç»™æ¯ä½é¡¾å®¢æ­£ç¡®æ‰¾é›¶ï¼Œè¿”å›ž true ï¼Œå¦åˆ™è¿”å›ž false ã€‚ ç¤ºä¾‹1ï¼š 1234567è¾“å…¥ï¼šbills = [5,5,5,10,20]è¾“å‡ºï¼štrueè§£é‡Šï¼šå‰ 3 ä½é¡¾å®¢é‚£é‡Œï¼Œæˆ‘ä»¬æŒ‰é¡ºåºæ”¶å– 3 å¼  5 ç¾Žå…ƒçš„é’žç¥¨ã€‚ç¬¬ 4 ä½é¡¾å®¢é‚£é‡Œï¼Œæˆ‘ä»¬æ”¶å–ä¸€å¼  10 ç¾Žå…ƒçš„é’žç¥¨ï¼Œå¹¶è¿”è¿˜ 5 ç¾Žå…ƒã€‚ç¬¬ 5 ä½é¡¾å®¢é‚£é‡Œï¼Œæˆ‘ä»¬æ‰¾è¿˜ä¸€å¼  10 ç¾Žå…ƒçš„é’žç¥¨å’Œä¸€å¼  5 ç¾Žå…ƒçš„é’žç¥¨ã€‚ç”±äºŽæ‰€æœ‰å®¢æˆ·éƒ½å¾—åˆ°äº†æ­£ç¡®çš„æ‰¾é›¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å‡º trueã€‚ ç¤ºä¾‹2ï¼š 1234567è¾“å…¥ï¼šbills = [5,5,10,10,20]è¾“å‡ºï¼šfalseè§£é‡Šï¼šå‰ 2 ä½é¡¾å®¢é‚£é‡Œï¼Œæˆ‘ä»¬æŒ‰é¡ºåºæ”¶å– 2 å¼  5 ç¾Žå…ƒçš„é’žç¥¨ã€‚å¯¹äºŽæŽ¥ä¸‹æ¥çš„ 2 ä½é¡¾å®¢ï¼Œæˆ‘ä»¬æ”¶å–ä¸€å¼  10 ç¾Žå…ƒçš„é’žç¥¨ï¼Œç„¶åŽè¿”è¿˜ 5 ç¾Žå…ƒã€‚å¯¹äºŽæœ€åŽä¸€ä½é¡¾å®¢ï¼Œæˆ‘ä»¬æ— æ³•é€€å›ž 15 ç¾Žå…ƒï¼Œå› ä¸ºæˆ‘ä»¬çŽ°åœ¨åªæœ‰ä¸¤å¼  10 ç¾Žå…ƒçš„é’žç¥¨ã€‚ç”±äºŽä¸æ˜¯æ¯ä½é¡¾å®¢éƒ½å¾—åˆ°äº†æ­£ç¡®çš„æ‰¾é›¶ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ falseã€‚ æç¤ºï¼š 1 &lt;= bills.length &lt;= 105 bills[i] ä¸æ˜¯ 5 å°±æ˜¯ 10 æˆ–æ˜¯ 20 ä»£ç 12345678910111213141516171819202122232425262728class Solution &#123; public boolean lemonadeChange(int[] bills) &#123; int five = 0, ten = 0, twenty = 0; for(int i = 0; i &lt; bills.length; i++) &#123; if(bills[i] == 5) &#123; five++; &#125; if(bills[i] == 10) &#123; if(five &lt;= 0) return false; ten++; five--; &#125; if(bills[i] == 20) &#123; if(five &gt; 0 &amp;&amp; ten &gt; 0) &#123; five--; ten--; twenty++; &#125; else if(five &gt;= 3) &#123; five -= 3; twenty++; &#125; else &#123; return false; &#125; &#125; &#125; return true; &#125;&#125; 11. 406. æ ¹æ®èº«é«˜é‡å»ºé˜Ÿåˆ—é—®é¢˜å‡è®¾æœ‰æ‰“ä¹±é¡ºåºçš„ä¸€ç¾¤äººç«™æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ•°ç»„ people è¡¨ç¤ºé˜Ÿåˆ—ä¸­ä¸€äº›äººçš„å±žæ€§ï¼ˆä¸ä¸€å®šæŒ‰é¡ºåºï¼‰ã€‚æ¯ä¸ª people[i] = [hi, ki] è¡¨ç¤ºç¬¬ i ä¸ªäººçš„èº«é«˜ä¸º hi ï¼Œå‰é¢ æ­£å¥½ æœ‰ ki ä¸ªèº«é«˜å¤§äºŽæˆ–ç­‰äºŽ hi çš„äººã€‚ è¯·ä½ é‡æ–°æž„é€ å¹¶è¿”å›žè¾“å…¥æ•°ç»„ people æ‰€è¡¨ç¤ºçš„é˜Ÿåˆ—ã€‚è¿”å›žçš„é˜Ÿåˆ—åº”è¯¥æ ¼å¼åŒ–ä¸ºæ•°ç»„ queue ï¼Œå…¶ä¸­ queue[j] = [hj, kj] æ˜¯é˜Ÿåˆ—ä¸­ç¬¬ j ä¸ªäººçš„å±žæ€§ï¼ˆqueue[0] æ˜¯æŽ’åœ¨é˜Ÿåˆ—å‰é¢çš„äººï¼‰ã€‚ ç¤ºä¾‹ 1ï¼š 12345678910è¾“å…¥ï¼špeople = [[7,0],[4,4],[7,1],[5,0],[6,1],[5,2]]è¾“å‡ºï¼š[[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]]è§£é‡Šï¼šç¼–å·ä¸º 0 çš„äººèº«é«˜ä¸º 5 ï¼Œæ²¡æœ‰èº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæŽ’åœ¨ä»–å‰é¢ã€‚ç¼–å·ä¸º 1 çš„äººèº«é«˜ä¸º 7 ï¼Œæ²¡æœ‰èº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæŽ’åœ¨ä»–å‰é¢ã€‚ç¼–å·ä¸º 2 çš„äººèº«é«˜ä¸º 5 ï¼Œæœ‰ 2 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæŽ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 0 å’Œ 1 çš„äººã€‚ç¼–å·ä¸º 3 çš„äººèº«é«˜ä¸º 6 ï¼Œæœ‰ 1 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæŽ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 1 çš„äººã€‚ç¼–å·ä¸º 4 çš„äººèº«é«˜ä¸º 4 ï¼Œæœ‰ 4 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæŽ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 0ã€1ã€2ã€3 çš„äººã€‚ç¼–å·ä¸º 5 çš„äººèº«é«˜ä¸º 7 ï¼Œæœ‰ 1 ä¸ªèº«é«˜æ›´é«˜æˆ–è€…ç›¸åŒçš„äººæŽ’åœ¨ä»–å‰é¢ï¼Œå³ç¼–å·ä¸º 1 çš„äººã€‚å› æ­¤ [[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]] æ˜¯é‡æ–°æž„é€ åŽçš„é˜Ÿåˆ—ã€‚ ç¤ºä¾‹ 2ï¼š 12è¾“å…¥ï¼špeople = [[6,0],[5,0],[4,0],[3,2],[2,2],[1,4]]è¾“å‡ºï¼š[[4,0],[5,0],[2,2],[3,2],[1,4],[6,0]] æç¤ºï¼š 1 &lt;= people.length &lt;= 2000 0 &lt;= hi &lt;= 106 0 &lt;= ki &lt; people.length é¢˜ç›®æ•°æ®ç¡®ä¿é˜Ÿåˆ—å¯ä»¥è¢«é‡å»º ä»£ç 12345678910111213141516171819202122232425262728293031323334class Solution &#123; public int[][] reconstructQueue(int[][] people) &#123; int length = people.length; Arrays.sort(people, new Comparator&lt;int[]&gt;()&#123; public int compare(int[] people1, int[] people2) &#123; // ä»Žå¤§åˆ°å° æŽ’åº if(people2[0] == people1[0]) &#123; return people1[1] - people2[1]; &#125;else &#123; return people2[0] - people1[0]; &#125; &#125; &#125;); for(int i = 0; i &lt; length; i++) &#123; inset(people, i, people[i][1]); &#125; return people; &#125; private void inset(int[][] people, int sourceIndex, int destIndex) &#123; int[] temp = people[sourceIndex]; if(sourceIndex &lt;= destIndex) &#123; for(int i = sourceIndex; i &lt; destIndex; i++) &#123; people[i] = people[i + 1]; &#125; people[destIndex] = temp; &#125; else &#123; for(int i = sourceIndex; i &gt; destIndex; i--) &#123; people[i] = people[i - 1]; &#125; people[destIndex] = temp; &#125; &#125;&#125; 12. 452. ç”¨æœ€å°‘æ•°é‡çš„ç®­å¼•çˆ†æ°”çƒé—®é¢˜æœ‰ä¸€äº›çƒå½¢æ°”çƒè´´åœ¨ä¸€å µç”¨ XY å¹³é¢è¡¨ç¤ºçš„å¢™é¢ä¸Šã€‚å¢™é¢ä¸Šçš„æ°”çƒè®°å½•åœ¨æ•´æ•°æ•°ç»„ points ï¼Œå…¶ä¸­points[i] = [xstart, xend] è¡¨ç¤ºæ°´å¹³ç›´å¾„åœ¨ xstart å’Œ xendä¹‹é—´çš„æ°”çƒã€‚ä½ ä¸çŸ¥é“æ°”çƒçš„ç¡®åˆ‡ y åæ ‡ã€‚ ä¸€æ”¯å¼“ç®­å¯ä»¥æ²¿ç€ x è½´ä»Žä¸åŒç‚¹ å®Œå…¨åž‚ç›´ åœ°å°„å‡ºã€‚åœ¨åæ ‡ x å¤„å°„å‡ºä¸€æ”¯ç®­ï¼Œè‹¥æœ‰ä¸€ä¸ªæ°”çƒçš„ç›´å¾„çš„å¼€å§‹å’Œç»“æŸåæ ‡ä¸º xstartï¼Œxendï¼Œ ä¸”æ»¡è¶³ xstart â‰¤ x â‰¤ xendï¼Œåˆ™è¯¥æ°”çƒä¼šè¢« å¼•çˆ† ã€‚å¯ä»¥å°„å‡ºçš„å¼“ç®­çš„æ•°é‡ æ²¡æœ‰é™åˆ¶ ã€‚ å¼“ç®­ä¸€æ—¦è¢«å°„å‡ºä¹‹åŽï¼Œå¯ä»¥æ— é™åœ°å‰è¿›ã€‚ ç»™ä½ ä¸€ä¸ªæ•°ç»„ points ï¼Œè¿”å›žå¼•çˆ†æ‰€æœ‰æ°”çƒæ‰€å¿…é¡»å°„å‡ºçš„ æœ€å° å¼“ç®­æ•° ã€‚ ç¤ºä¾‹ 1ï¼š 12345è¾“å…¥ï¼špoints = [[10,16],[2,8],[1,6],[7,12]]è¾“å‡ºï¼š2è§£é‡Šï¼šæ°”çƒå¯ä»¥ç”¨2æ”¯ç®­æ¥çˆ†ç ´:-åœ¨x = 6å¤„å°„å‡ºç®­ï¼Œå‡»ç ´æ°”çƒ[2,8]å’Œ[1,6]ã€‚-åœ¨x = 11å¤„å‘å°„ç®­ï¼Œå‡»ç ´æ°”çƒ[10,16]å’Œ[7,12]ã€‚ ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼špoints = [[1,2],[3,4],[5,6],[7,8]]è¾“å‡ºï¼š4è§£é‡Šï¼šæ¯ä¸ªæ°”çƒéœ€è¦å°„å‡ºä¸€æ”¯ç®­ï¼Œæ€»å…±éœ€è¦4æ”¯ç®­ã€‚ ç¤ºä¾‹ 3ï¼š 12345è¾“å…¥ï¼špoints = [[1,2],[2,3],[3,4],[4,5]]è¾“å‡ºï¼š2è§£é‡Šï¼šæ°”çƒå¯ä»¥ç”¨2æ”¯ç®­æ¥çˆ†ç ´:- åœ¨x = 2å¤„å‘å°„ç®­ï¼Œå‡»ç ´æ°”çƒ[1,2]å’Œ[2,3]ã€‚- åœ¨x = 4å¤„å°„å‡ºç®­ï¼Œå‡»ç ´æ°”çƒ[3,4]å’Œ[4,5]ã€‚ æç¤º: 1 &lt;= points.length &lt;= 105 points[i].length == 2 -231 &lt;= xstart &lt; xend &lt;= 231 - 1 ä»£ç 12345678910111213141516171819class Solution &#123; public int findMinArrowShots(int[][] points) &#123; Arrays.sort(points, (a,b) -&gt; &#123; if(a[0] != b[0]) &#123; return (long)a[0] - (long)b[0] &gt; 0 ? 1 : -1; &#125; return (long)a[0] - (long)b[0] &gt; 0 ? 1 : -1; &#125;); int count = 0; for(int i = 1; i &lt; points.length; i++) &#123; if(points[i][0] &gt; points[i - 1][1]) &#123; count++; &#125; else &#123; points[i][1] = Math.min(points[i][1], points[i - 1][1]); &#125; &#125; return count + 1; &#125;&#125; å…ˆæŽ’åºï¼ˆæŒ‰å…ƒç´ 0å·ä¸‹æ ‡å‡åºï¼‰åŽè´ªå·¦è¾¹ï¼Œå› ä¸ºæŽ’å®ŒåŽï¼Œå‰é¢çš„è‚¯å®šåŒ…å«åŽé¢çš„å…ƒç´ ï¼Œå†åŽ»è´ªå³è¾¹è¾¹ç•Œï¼Œè´ªæœ€å°è¾¹ç•Œã€‚ 13. 435. æ— é‡å åŒºé—´é—®é¢˜ç»™å®šä¸€ä¸ªåŒºé—´çš„é›†åˆ intervals ï¼Œå…¶ä¸­ intervals[i] = [starti, endi] ã€‚è¿”å›ž éœ€è¦ç§»é™¤åŒºé—´çš„æœ€å°æ•°é‡ï¼Œä½¿å‰©ä½™åŒºé—´äº’ä¸é‡å  ã€‚ ç¤ºä¾‹ 1: 123è¾“å…¥: intervals = [[1,2],[2,3],[3,4],[1,3]]è¾“å‡º: 1è§£é‡Š: ç§»é™¤ [1,3] åŽï¼Œå‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚ ç¤ºä¾‹ 2: 123è¾“å…¥: intervals = [ [1,2], [1,2], [1,2] ]è¾“å‡º: 2è§£é‡Š: ä½ éœ€è¦ç§»é™¤ä¸¤ä¸ª [1,2] æ¥ä½¿å‰©ä¸‹çš„åŒºé—´æ²¡æœ‰é‡å ã€‚ ç¤ºä¾‹ 3: 123è¾“å…¥: intervals = [ [1,2], [2,3] ]è¾“å‡º: 0è§£é‡Š: ä½ ä¸éœ€è¦ç§»é™¤ä»»ä½•åŒºé—´ï¼Œå› ä¸ºå®ƒä»¬å·²ç»æ˜¯æ— é‡å çš„äº†ã€‚ æç¤º: 1 &lt;= intervals.length &lt;= 105 intervals[i].length == 2 -5 * 104 &lt;= starti &lt; endi &lt;= 5 * 104 ä»£ç 12345678910111213141516171819class Solution &#123; public int eraseOverlapIntervals(int[][] intervals) &#123; // å¯¹å³åŒºé—´å‡åºï¼Œ Arrays.sort(intervals, (a,b) -&gt; &#123; return a[1] - b[1]; &#125;); int removeCount = 0; for(int i = 1; i &lt; intervals.length; i++) &#123; if(intervals[i][0] &lt; intervals[i - 1][1]) &#123; removeCount++; // æ›´æ–°å½“å‰çŠ¶æ€ä¸‹ä¸é‡å å³åŒºé—´ä¸Šé™ // ä¸ç”¨ç†ä¼šä¸¤ä¸ªåŒºé—´ä¸­é—´å¯èƒ½ç•™ä¸‹çš„ç©ºç™½åŒºåŸŸï¼Œå› ä¸ºå·²ç»æŽ’åº // æ‰€ä»¥åŽé¢çš„åŒºé—´ä¸ä¼šé‡å ä¸­é—´é‚£å—ç©ºç™½åŒºåŸŸ intervals[i][1] = intervals[i - 1][1]; &#125; &#125; return removeCount; &#125;&#125; 14. 714. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœºå«æ‰‹ç»­è´¹é—®é¢˜ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ pricesï¼Œå…¶ä¸­ prices[i]è¡¨ç¤ºç¬¬ i å¤©çš„è‚¡ç¥¨ä»·æ ¼ ï¼›æ•´æ•° fee ä»£è¡¨äº†äº¤æ˜“è‚¡ç¥¨çš„æ‰‹ç»­è´¹ç”¨ã€‚ ä½ å¯ä»¥æ— é™æ¬¡åœ°å®Œæˆäº¤æ˜“ï¼Œä½†æ˜¯ä½ æ¯ç¬”äº¤æ˜“éƒ½éœ€è¦ä»˜æ‰‹ç»­è´¹ã€‚å¦‚æžœä½ å·²ç»è´­ä¹°äº†ä¸€ä¸ªè‚¡ç¥¨ï¼Œåœ¨å–å‡ºå®ƒä¹‹å‰ä½ å°±ä¸èƒ½å†ç»§ç»­è´­ä¹°è‚¡ç¥¨äº†ã€‚ è¿”å›žèŽ·å¾—åˆ©æ¶¦çš„æœ€å¤§å€¼ã€‚ æ³¨æ„ï¼šè¿™é‡Œçš„ä¸€ç¬”äº¤æ˜“æŒ‡ä¹°å…¥æŒæœ‰å¹¶å–å‡ºè‚¡ç¥¨çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œæ¯ç¬”äº¤æ˜“ä½ åªéœ€è¦ä¸ºæ”¯ä»˜ä¸€æ¬¡æ‰‹ç»­è´¹ã€‚ ç¤ºä¾‹ 1ï¼š 12345678è¾“å…¥ï¼šprices = [1, 3, 2, 8, 4, 9], fee = 2è¾“å‡ºï¼š8è§£é‡Šï¼šèƒ½å¤Ÿè¾¾åˆ°çš„æœ€å¤§åˆ©æ¶¦: åœ¨æ­¤å¤„ä¹°å…¥ prices[0] = 1åœ¨æ­¤å¤„å–å‡º prices[3] = 8åœ¨æ­¤å¤„ä¹°å…¥ prices[4] = 4åœ¨æ­¤å¤„å–å‡º prices[5] = 9æ€»åˆ©æ¶¦: ((8 - 1) - 2) + ((9 - 4) - 2) = 8 ç¤ºä¾‹ 2ï¼š 12è¾“å…¥ï¼šprices = [1,3,7,5,10,3], fee = 3è¾“å‡ºï¼š6 æç¤ºï¼š 1 &lt;= prices.length &lt;= 5 * 104 1 &lt;= prices[i] &lt; 5 * 104 0 &lt;= fee &lt; 5 * 104 ä»£ç 123456789101112131415161718192021class Solution &#123; public int maxProfit(int[] prices, int fee) &#123; // ä¹°å…¥æ˜¯å…ˆ ç®—æ‰‹ç»­è´¹ï¼Œbuy æ˜¯ä¹°å…¥+æ‰‹ç»­è´¹ int buy = prices[0] + fee; int result = 0; for(int i = 1; i &lt; prices.length; i++) &#123; // buy å·²ç»æ›´æ–°ä¸ºèƒ½å¦ç»§ç»­æ”¶ç›Šçš„æ›´é«˜æ°´å‡† // å¦‚æžœä¸èƒ½ç»§ç»­æ”¶ç›Šäº†ï¼Œä¹Ÿå°±æ˜¯è·Œè‚¡äº†ï¼Œé‚£å°±å–æŽ‰ä¸Šä¸€è‚¡ï¼Œé‡æ–°ä¹°å…¥æ–°è‚¡ // å› ä¸ºç›¸æ¯” åŒä¸€è‚¡ ä¼šæœ‰æ›´å¤§çš„æ”¶ç›Š if(prices[i] + fee &lt; buy) &#123; buy = prices[i] + fee; &#125; if(prices[i] &gt; buy) &#123; result += prices[i] - buy; // è¿žç»­æ¶¨è‚¡å°±æŒè‚¡ buy = prices[i]; &#125; &#125; return result; &#125;&#125; 15. 968. ç›‘æŽ§äºŒå‰æ ‘é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæˆ‘ä»¬åœ¨æ ‘çš„èŠ‚ç‚¹ä¸Šå®‰è£…æ‘„åƒå¤´ã€‚ èŠ‚ç‚¹ä¸Šçš„æ¯ä¸ªæ‘„å½±å¤´éƒ½å¯ä»¥ç›‘è§†å…¶çˆ¶å¯¹è±¡ã€è‡ªèº«åŠå…¶ç›´æŽ¥å­å¯¹è±¡ã€‚ è®¡ç®—ç›‘æŽ§æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ‘„åƒå¤´æ•°é‡ã€‚ ç¤ºä¾‹ 1ï¼š 123è¾“å…¥ï¼š[0,0,null,0,0]è¾“å‡ºï¼š1è§£é‡Šï¼šå¦‚å›¾æ‰€ç¤ºï¼Œä¸€å°æ‘„åƒå¤´è¶³ä»¥ç›‘æŽ§æ‰€æœ‰èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ 2ï¼š 123è¾“å…¥ï¼š[0,0,null,0,null,0,null,null,0]è¾“å‡ºï¼š2è§£é‡Šï¼šéœ€è¦è‡³å°‘ä¸¤ä¸ªæ‘„åƒå¤´æ¥ç›‘è§†æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚ ä¸Šå›¾æ˜¾ç¤ºäº†æ‘„åƒå¤´æ”¾ç½®çš„æœ‰æ•ˆä½ç½®ä¹‹ä¸€ã€‚ æç¤ºï¼š ç»™å®šæ ‘çš„èŠ‚ç‚¹æ•°çš„èŒƒå›´æ˜¯ [1, 1000]ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½æ˜¯ 0ã€‚ ä»£ç 12345678910111213141516171819202122232425262728293031class Solution &#123; int res = 0; public int minCameraCover(TreeNode root) &#123; if(traversal(root) == 0) return ++res; return res; &#125; // 0 - æ— è¦†ç›– 1 - æœ‰æ‘„åƒå¤´ 2 - æœ‰è¦†ç›– private int traversal(TreeNode node) &#123; // ç»ˆæ­¢æ¡ä»¶ if(node == null) return 2; // åŽåºé€’å½’éåŽ† int left = traversal(node.left); int right = traversal(node.right); // è®¾ç½®å¶å­èŠ‚ç‚¹ä¸º æœªè¦†ç›–ï¼Œæˆ–è€…æ˜¯ ä¸¤ä¸ªå­èŠ‚ç‚¹å‡å·²è¦†ç›–ã€‚é‚£ä¹ˆè®¾ç½®è¯¥èŠ‚ç‚¹ä¸ºæœªè¦†ç›– if(left == 2 &amp;&amp; right == 2) &#123; return 0; &#125; // å­˜åœ¨å­èŠ‚ç‚¹è¿˜æœªè¦†ç›–ï¼Œè¯¥èŠ‚ç‚¹è®¾ç½®æ‘„åƒå¤´ if(left == 0 || right == 0) &#123; res++; return 1; &#125; // å­èŠ‚ç‚¹æœ‰æ‘„åƒå¤´ï¼Œè¯¥èŠ‚ç‚¹è®¾ç½®ä¸ºè¦†ç›– if(left == 1 || right == 1) &#123; return 2; &#125; // å› ä¸ºé€»è¾‘è¿”å›žéœ€è¦ï¼Œè™½ç„¶ä¸ä¼šåˆ°è¿™ä¸€æ­¥ä½†è¿˜æ˜¯è¦å†™ return -1; &#125;&#125;","categories":[{"name":"leetCodeç®—æ³•","slug":"leetCodeç®—æ³•","permalink":"http://fyupeng.github.io/categories/leetCode%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"è´ªå¿ƒç®—æ³•","slug":"è´ªå¿ƒç®—æ³•","permalink":"http://fyupeng.github.io/tags/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/"}],"author":"fyupeng"},{"title":"HashMapåº•å±‚åŽŸç†é€æž","slug":"HashMapåº•å±‚åŽŸç†é€æž","date":"2022-07-31T05:50:18.000Z","updated":"2022-08-06T05:55:51.137Z","comments":true,"path":"2022/07/31/HashMapåº•å±‚åŽŸç†é€æž/","link":"","permalink":"http://fyupeng.github.io/2022/07/31/HashMap%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E9%80%8F%E6%9E%90/","excerpt":"","text":"åˆ›ä½œå®—æ—¨ï¼šåŒ–ç¹ä¸ºç®€ï¼Œç»ä¸å†—ä½™ï¼Œç‚¹åˆ°ä¸ºæ­¢ ç›´æŽ¥å¼€é—¨è§å±±ï¼Œå°±äº‹è®ºäº‹ï¼ ä»€ä¹ˆæ˜¯ HashMap? HashMapç±»ç»§æ‰¿äº†çˆ¶ç±»AbstractMap&lt;K,V&gt;ï¼Œå®žçŽ°äº†æŽ¥å£Map&lt;K,V&gt;, Cloneable, Serializable,AbstractMap&lt;K,V&gt;å®žçŽ°äº†å¯¹Mapçš„åŸºæœ¬æ“ä½œï¼ŒSerializableæ˜¯åºåˆ—åŒ–æŽ¥å£ï¼Œå¯å®žçŽ°åºåˆ—åŒ–ï¼ŒMap&lt;K,V&gt;æŽ¥å£è§„èŒƒäº†k-vå¯¹æ“ä½œçš„æŠ½è±¡æ–¹æ³•ï¼ŒCloneableè§„èŒƒäº†ç»§æ‰¿äº†ObjectåŽåŽ»ä½¿ç”¨clone()æ–¹æ³•å‰å¿…é¡»å¾—å®žçŽ°CloneableæŽ¥å£ï¼Œå¦åˆ™æŠ›å‡ºCloneNotSupportedExceptioné”™è¯¯ã€‚ ä¸€ã€ä»‹ç»1. HashMap çš„çº¿ç¨‹ä¸å®‰å…¨çš„åœºæ™¯ æ­»é” æ‰©å®¹äº§ç”Ÿæ­»é”çš„åŽŸå› å…³é”®æœ‰ä¸¤ç‚¹ï¼šç¬¬ä¸€ç‚¹ï¼šé“¾è¡¨çš„å¤´æ’æ³•è½¬ç§»ç»“ç‚¹ï¼ŒJDK8ç‰ˆæœ¬å°±æ”¹æˆäº†å°¾æ’æ³•ï¼›ç¬¬äºŒç‚¹ï¼šå¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼ŒCPUçš„è®©å‡ºä½¿å¾—å¤´ç»“ç‚¹çš„æŒ‡é’ˆæŒ‡å‘å‘ç”Ÿå˜åŒ–ï¼Œä½†åŽŸçº¿ç¨‹é‡æ–°å æœ‰CPUæ—¶ä»ç„¶é‡‡å–åŽŸå…ˆçš„åšæ³•ï¼›è§£è¯»ï¼šJDK8ä¸‹ä½¿ç”¨å°¾æ’æ³•ï¼Œå°±ç®—å¤´ç»“ç‚¹å·²ç»è½¬ç§»äº†ï¼Œä½†è¿˜æ˜¯åœ¨å¤´ç»“ç‚¹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è½¬ç§»å‰åŽé“¾è¡¨é¡ºåºä¸æ”¹å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ¬¡é‡å¤çš„æ“ä½œï¼Œç»“æžœä¸å½±å“ã€‚æˆ‘ä¸ä¼šç”¨ç¯‡å¹…å¾ˆé•¿è€Œåšè¿™ä¹ˆç‚¹äº‹æƒ…ï¼Œæ²¡å¿…è¦ï¼Œå¾ˆç®€å•çš„äº‹ 5 å¹…å›¾å°±å¯ä»¥å•¦ã€‚ç”±äºŽHashMapæ˜¯æ•°ç»„+é“¾è¡¨çš„æ•°æ®ç»“æž„ï¼Œæ—§æ¡¶æ˜¯æŒ‡æ•°ç»„ä¸‹æ ‡æ‰€åœ¨ä½ç½®ã€‚çº¿ç¨‹ 1 æ‰©å®¹æ“ä½œ çº¿ç¨‹ 1 è½¬ç§»ç»“ç‚¹Açº¿ç¨‹1ç»“ç‚¹è½¬ç§»å®Œæ¯•çº¿ç¨‹2å¼€å§‹è½¬ç§»ç»“ç‚¹Aå› ä¸ºæ˜¯çº¿ç¨‹2é¦–å…ˆè¦æ‰©å®¹çš„ï¼ˆå·²ç»è¿›å…¥æ‰©å®¹æ–¹æ³•ï¼‰ï¼Œä¸è¿‡CPUæ—¶é—´å´è®©ç»™äº†çº¿ç¨‹1,çº¿ç¨‹1å‘è§‰éœ€è¦æ‰©å®¹ï¼ˆçº¿ç¨‹2è¦æ‰©å®¹æ—¶æ—¶é—´ç‰‡ç»™äº†åˆ«äººï¼Œtableçš„lengthå¹¶æœªæ”¹å˜ï¼‰ï¼Œç­‰æ‰©å®¹å®Œæ¯•åŽå†æŠŠCPUè¿˜ç»™çº¿ç¨‹2,è¿™æ—¶çº¿ç¨‹2è™½ç„¶ä¸èƒ½å†æ‰©å®¹ï¼Œä½†æ˜¯å®ƒåœ¨æ‰©å®¹æ–¹æ³•å†…ï¼Œæ‰€ä»¥ä¸€ä¸ªéžçº¿ç¨‹å®‰å…¨çš„HashMapæ˜¯å¾ˆè‡´å‘½çš„ï¼ŒåŽé¢çš„ConcurrentHashMapä¼šè®²å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ çº¿ç¨‹2è½¬ç§»ç»“ç‚¹Aç»“æŸï¼ŒçŽ¯å½¢é“¾äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯äº§ç”Ÿæ­»é”ã€‚ æ‰€ä»¥åŽŸå› çš„å¤´æ’æ³•å¾—ä»¥ä½è¯ï¼ŒCPUçš„è½®è¯¢åˆ‡æ¢ä¹Ÿæ¼”ç»Žçš„å¾ˆåˆ°ä½ã€‚çº¿ç¨‹ä¸å®‰å…¨è®²å®Œï¼Œä¸‹é¢å°±è®²åŽŸç†ï¼ŒåŽ»æ½œç§»é»˜åŒ–å®ƒã€‚ 2. HashMap å®žçŽ°å“ˆå¸Œå‘½ä¸­å‡åŒ€å“ˆå¸Œä¹Ÿå°±æ˜¯kçš„hashcodeè®¡ç®—åŽå¾—åˆ°çš„ä¸‹æ ‡ï¼Œè€Œhashcodeæ˜¯ä¸€ä¸ª32ä½çš„intç±»åž‹ï¼Œè¦è®©åˆ†å¸ƒå‡åŒ€ï¼Œå³è®©ä¸åŒçš„kä¸èƒ½å‡ºçŽ°æœ‰ç›¸åŒçš„æ•ˆæžœï¼Œä¹Ÿå°±æ˜¯å¾—æœ‰å”¯ä¸€æ€§ï¼Œå°±è¦å®Œå…¨åŽ»åˆ©ç”¨é«˜16ä½å’Œä½Ž16ä½ï¼Œè€Œå¦‚æžœç›´æŽ¥ç”¨32ä½åŽ»å–æ¨¡è¿ç®—ï¼Œé«˜16å°±å¯èƒ½ä¼šç”¨ä¸åˆ°ï¼Œå¯¼è‡´hashcodeé«˜16ä½ä¸åŒçš„kä¾æ—§å‘½ä¸­åŒä¸€ä¸ªæ¡¶ä½ã€‚æ‰€ä»¥JDK8é‡‡å–çš„åšæ³•æ˜¯å¯¹é«˜16ä½ä¸Žä½Ž16ä½è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œè¿™æ ·å°±å˜ç›¸ä¿ç•™äº†é«˜ä½å’Œä½Žä½çš„æ‰€æœ‰ç‰¹å¾äº†ã€‚å“ˆå¸Œå‡åŒ€ï¼ŒJDK8ä¹‹åŽ 1return (key == null) ? h = key.hashCode() ^ (h &gt;&gt;&gt; 16); å–æ¨¡è¿ç®—ï¼ŒJDK7ä¹‹å‰ 1h &amp; (length - 1) 3. HashMap å‚æ•°ä»¥åŠæ‰©å®¹æœºåˆ¶åˆå§‹å®¹é‡16ï¼Œè¾¾åˆ°é˜ˆå€¼æ‰©å®¹ï¼Œé˜ˆå€¼ç­‰äºŽæœ€å¤§å®¹é‡ * è´Ÿè½½å› å­ï¼Œæ‰©å®¹æ¯æ¬¡2å€ï¼Œæ€»æ˜¯2çš„næ¬¡æ–¹ã€‚ æ‰©å®¹æœºåˆ¶ä½¿ç”¨ä¸€ä¸ªå®¹é‡æ›´å¤§çš„æ•°ç»„æ¥ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œtransfer()æ–¹æ³•å°†åŽŸæœ‰Entryæ•°ç»„å…ƒç´ æ‹·è´åˆ°æ–°çš„Entryæ•°ç»„é‡Œï¼ŒJava1.7é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚è€ŒJava1.8å®ƒä¸éœ€è¦é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ ï¼Œå®ƒä¼šå…ˆæ¯”è¾ƒå…ƒç´ çš„hashcode &amp; åŽŸæ¥æ•°ç»„çš„å¤§å°çš„ç»“æžœï¼Œå¦‚æžœä¸º0ï¼Œå°±ä»¥å…ƒç´ çš„åŽŸä¸‹æ ‡åŠ å…¥åˆ°æ–°æ•°ç»„ä¸­ï¼Œå¦‚æžœä¸º1ï¼Œå°±åœ¨åŽŸä¸‹æ ‡åŠ ä¸ŠåŽŸæ•°ç»„çš„å¤§å°åŠ å…¥åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™æ ·è¿™ä¸¤ç§æƒ…å†µå°±å‘½ä¸­åˆ°æ–°æ•°ç»„çš„å‰ä¸€åŠå’ŒåŽä¸€åŠäº†ï¼Œä¹Ÿå°±æ˜¯å°†åŽŸæœ¬å…¨åœ¨åŽŸæ•°ç»„å¤§å°çš„æ‰€æœ‰å…ƒç´ åˆå‡åŒ€åˆ†å¸ƒä¸€äº›å…ƒç´ åˆ°æ‰©å®¹æœªä½¿ç”¨çš„ä¸‹æ ‡ä¸­ã€‚é‚£ä¹ˆå°±è§£é‡Šä¸€ä¸‹ï¼Œå‡è®¾åŠ å…¥çš„å…ƒç´ æ˜¯éšæœºçš„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰æƒ…å†µçš„hashå€¼æ˜¯å‡ç­‰å‡ºçŽ°çš„ï¼Œè€Œ&amp;åŽŸæ•°ç»„å¤§å°å¯ä»¥è¿™æ ·æ¯”å¦‚ï¼Œæœ‰64ä¸ªå…ƒç´ å‡ç­‰çš„ä»Ž0åˆ°63ï¼Œé‚£ä¹ˆ0åˆ°15åˆ†é…ç»™äº†æ‰©å®¹åŽæ•°ç»„å¤§å°ä¸º32çš„å·¦åŠéƒ¨åˆ†ï¼Œ16-31åˆ†é…ç»™äº†å³åŠéƒ¨åˆ†ï¼Œ32-48åˆ†é…ç»™äº†å·¦åŠéƒ¨åˆ†ï¼Œ48-63åˆ†é…ç»™äº†å³åŠéƒ¨åˆ†ï¼Œå°±æ¯”è¾ƒå‡åŒ€åˆ†æ•£åœ¨äº†ä¸¤ä¾§ï¼Œè€Œä¸”æœºä¼šå‡ç­‰ï¼Œå¾ˆå·§å¦™ï¼12345678910111213141516171819// åˆ†å¸ƒåˆ°å·¦ä¾§if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e;&#125;// åˆ†å¸ƒåˆ°å³ä¾§else &#123; if (hiTail == null) // åˆå§‹åŒ– hiHead = e; else // å°¾æ’æ³• hiTail.next = e; // è‡ªå¢žï¼Œä¸‹æ¬¡å°¾æ’æ³•å¿…è¦çš„å˜é‡ hiTail = e;&#125; 4. HashMap çš„ get å’Œ put æ“ä½œ get è®©æˆ‘ä»¬è§è¯†ä¸‹æ­¤æ—¶æ— å›¾èƒœæœ‰å›¾çš„æ•ˆæžœå§ï¼ getç”±æºç è§£è¯»æ˜¯å…ˆèŽ·å–keyçš„hashCodeï¼Œç„¶åŽå®šä½åˆ°å¯¹åº”çš„æ•°ç»„ä½ç½®ï¼Œå†åŽ»éåŽ†è¯¥å…ƒç´ å¤„çš„é“¾è¡¨åœ¨è¿™é‡Œæ‰è®²equalsæˆ‘è§‰å¾—æ˜¯æœ€åˆé€‚çš„ï¼Œå¯ä»¥åŒºåˆ†å®ƒä¸ŽhashCodeçš„åŒºåˆ«ï¼Œå¦‚æžœhashCodeç›¸åŒçš„ä¸¤ä¸ªå…ƒç´ åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸‹æ ‡ï¼Œequalså°±å¼€å§‹å‘æŒ¥ä½œç”¨äº†ï¼Œä¸å¾—ä¸è¯´ï¼Œå½“ç„¶åˆ«è¯´æˆ‘æ˜¯è¯ç—¨ï¼Œæˆ‘è§‰å¾—HashMapåŠ å…¥è¿™ä¸¤ä¸ªçš„åˆè¡·æ˜¯å¦‚æžœåœ¨ä¸€ä¸ªåºžå¤§çš„Mapä¸­ï¼Œè¦åŽ»getæŸä¸€ä¸ªkeyçš„valueï¼Œæœ‰ä¸€ç§æœ€ç›´æŽ¥çš„åšæ³•ï¼Œå°±æ˜¯ç›´æŽ¥æ•´ä¸ªMapåŽ»equalsæ¯”è¾ƒï¼Œè¿™æ²¡é”™ï¼Œè€Œä¸”è¿˜æ˜¯æœ‰ç”¨çš„ï¼Œä½†åŠ å…¥hashCodeä¹‹åŽï¼ŒhashCodeèƒ½å¤Ÿç»™equalså…ˆç­›é€‰ä¸€ç•ªï¼Œå› ä¸ºä¸åŒçš„keyï¼Œå®ƒçš„hashå€¼ä¸€èˆ¬æ˜¯ä¸åŒçš„ï¼Œç†è§£è¿™é‡Œçš„ä¸€èˆ¬ï¼Œæ‰€ä»¥hashå€¼ä¸åŒçš„equalsè‚¯å®šå°±ä¸åŒï¼Œå°±æ²¡å¿…è¦å†åŽ»å¯¹ä¸åŒä¸‹æ ‡å…ƒç´ æ¥equalsæ¯”è¾ƒäº†ï¼Œå¥½ç†è§£å§ï¼ç”±äºŽHashMapä¸­æ–°åŠ å…¥äº†çº¢é»‘æ ‘ï¼Œå°±å¤šäº†ä¸€ç§getåˆ°keyçš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç§äºŒåˆ†æ³•ï¼Œå¯¹äºŽå¤§é‡æ•°æ®çš„é“¾è¡¨æ˜¯ä¸æŽ¨èçš„ï¼Œæ‰€ä»¥é‡‡ç”¨çº¢é»‘æ ‘ï¼ˆæ€»æ˜¯å¹³è¡¡çš„äºŒå‰æ ‘ï¼‰æ›´åŠ åœ°é«˜æ•ˆï¼ put putçš„å®žçŽ°ä¸»è¦é’ˆå¯¹ä¸¤ç§keyï¼Œä¸€ç§æ˜¯ä¸å­˜åœ¨çš„keyï¼Œä¸€ç§æ˜¯å·²å­˜åœ¨çš„keyå±€éƒ¨æºç  1234public V put(K key, V value) &#123; //é‡‡ç”¨hash(key)æ¥è®¡ç®—keyçš„hashCodeå€¼ã€‚ return putVal(hash(key), key, value, false, true);&#125; 12345static final int hash(Object key) &#123; int h; //å½“keyç­‰äºŽnullçš„æ—¶å€™ï¼Œä¸èµ°hashCode()æ–¹æ³• return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);&#125; å¦‚æžœä¸ºå‰è€…ï¼Œè€Œä¸”keyå€¼ä¸ºnullï¼Œå°±åœ¨æ•°ç»„ä¸‹æ ‡ä¸º0çš„é“¾è¡¨ä¸­åŽ»å¯»æ‰¾keyä¸ºnullçš„å€¼ï¼Œå½“ç„¶æ‰¾ä¸åˆ°ï¼Œå°±åˆ›å»ºkeyä¸ºnullçš„ç»“ç‚¹ã€‚å¦‚æžœä¸ºå‰è€…ï¼Œè€Œä¸”keyå€¼ä¸ä¸ºnullï¼Œå°±è°ƒç”¨è¯¥å…ƒç´ hashè®¡ç®—å…·ä½“çš„ä¸‹æ ‡ï¼Œåœ¨è¯¥ä¸‹æ ‡çš„é“¾è¡¨ä¸­å¯»æ‰¾ï¼Œå½“ç„¶ä¹Ÿå¯»æ‰¾ä¸åˆ°ï¼Œå°±å°¾æ’æ³•åŠ å…¥è¯¥k-vç»“ç‚¹ã€‚å¦‚æžœä¸ºåŽè€…ï¼Œå³æ‰¾åˆ°äº†ï¼Œç›´æŽ¥èµ‹å€¼å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦è€ƒè™‘æ˜¯å¦ä¸ºnullã€‚ è¿™é‡Œè¦åˆ†å¼€æ¥putæ˜¯å› ä¸ºï¼Œåœ¨HashTableä¸Šï¼Œæ˜¯ä¸å…è®¸æœ‰keyä¸ºnullçš„æƒ…å†µå‡ºçŽ°ï¼Œå› ä¸ºå½“keyä¸ºnullæ—¶ï¼Œkey.hashCode()ä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚æ‰€ä»¥åœ¨HashMapåšäº†ç‰¹åˆ«çš„å¤„ç†ï¼Œå¯¹keyä¸ºnullåšäº†å•ç‹¬å¤„ç†ï¼Œè¿™æ ·å°±è§£å†³äº†keyä¸ºnullçš„æƒ…å†µã€‚è¿˜æœ‰ä¸€ç‚¹ï¼ŒHashMapçš„valueå¦‚æžœè®¾ç½®ä¸ºnullï¼Œè™½ç„¶ä½ putäº†ï¼Œä½†å†åŽ»å–keyçš„æ—¶å€™ï¼Œä¾æ—§æ˜¯ä¸å­˜åœ¨ï¼","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"JavaåŽŸç†","slug":"JavaåŽŸç†","permalink":"http://fyupeng.github.io/tags/Java%E5%8E%9F%E7%90%86/"}],"author":"fyupeng"},{"title":"SpringMVC","slug":"SpringMVC","date":"2022-07-11T06:36:59.000Z","updated":"2022-07-22T01:27:21.891Z","comments":true,"path":"2022/07/11/SpringMVC/","link":"","permalink":"http://fyupeng.github.io/2022/07/11/SpringMVC/","excerpt":"","text":"1. å£°æ˜Žå’Œé…ç½®1.1 è‡ªå®šä¹‰å®¹å™¨é…ç½®æ–‡ä»¶ åœ¨web.xmlé…ç½®æ–‡ä»¶çš„çš„web-appä¸‹ 12345678910111213141516&lt;!-- å£°æ˜Žï¼Œæ³¨å†Œspringmvcçš„æ ¸å¿ƒå¯¹è±¡DispatcherServlet --&gt;&lt;servlet&gt; &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- è‡ªå®šä¹‰springmvcé…ç½®æ–‡ä»¶è¯»å–çš„ä½ç½® --&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;init-param&gt; &lt;!-- springmvcé…ç½®æ–‡ä»¶ä½ç½®çš„å±žæ€§ --&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;!-- æŒ‡å®šè‡ªå®šä¹‰æ–‡ä»¶çš„ä½ç½® --&gt; &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt; &lt;/init-param&gt;&lt;/servlet&gt; springmvcé»˜è®¤ä½ç½®ï¼š 12&lt;!--å¦‚æžœä¸å†™è‡ªå®šä¹‰è·¯å¾„--&gt;&lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt; åˆ™ä¼šæ‰¾é»˜è®¤è·¯å¾„ï¼šWebContent/WEB-INF/lib/ è¦æ±‚ï¼š å£°æ˜Žç±»org.springframework.web.servlet.DispatcherServletçš„servlet-nameæ—¶ï¼Œå…¶å¯¹åº”çš„é…ç½®æ–‡ä»¶åç§°ä¹Ÿåº”ä¸ºservlet-nameçš„å€¼ + &quot;-servlet&quot;.xml pom.xmlä¸­åŠ å…¥ä¸¤ä¸ªä¾èµ–åŒ…ï¼š 1234567891011121314&lt;!-- servletä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;!-- springmvcä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;&lt;/dependency&gt; æ­¥éª¤ï¼š ç”±äºŽtomcatæœåŠ¡å™¨æ¯æ¬¡å¯åŠ¨ä¼šé‡æ–°åŠ è½½web.xmlé…ç½®æ–‡ä»¶ï¼Œä»Žè€Œåœ¨é‡Œé¢é…ç½®å¯åŠ¨springmvc.xmlï¼Œä½¿å®ƒè‡ªåŠ¨åˆå§‹åŒ– ç”±index.jspé€šè¿‡é“¾æŽ¥å‘èµ·ï¼Œå†ç”¨MyControllerå¤„ç†è½¬å‘ç»™show.jsp æ³¨æ„ï¼š â€‹ MyControlleré€šè¿‡æ³¨è§£å®žçŽ°æŽ§åˆ¶å™¨ï¼Œéœ€è¦åœ¨springmvc.xmlé…ç½®æ–‡ä»¶ä¸­é…ç½®æ‰«æå™¨ srpingmvc.xml 123456789&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt; &lt;context:component-scan base-package=&quot;org.zhkucst.controller&quot;/&gt;&lt;/beans&gt; 1.2 è¿‡æ»¤å™¨ç¼–ç æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–è¿‡æ»¤å™¨åœ¨web.xmlä¸­åŠ å…¥ 123456789101112131415161718192021222324&lt;filter&gt; &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt; &lt;init-param&gt; &lt;param-name&gt;encoding&lt;/param-name&gt; &lt;param-value&gt;utf-8&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;forceRequestEncoding&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;forceResponseEncoding&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;characterEncodingFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; 1.3 DispatcherServletæ‰§è¡Œæºç springmvcæ‰§è¡Œè¿‡ç¨‹æºä»£ç åˆ†æž tomcatå¯åŠ¨ï¼Œåˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ â€‹ é€šè¿‡load-on-startæ ‡ç­¾æŒ‡å®šçš„1ï¼Œåˆ›å»ºDispatcherServletå¯¹è±¡ï¼Œ â€‹ DispatcherServletçš„çˆ¶ç±»æ˜¯ç»§æ‰¿HttpServletçš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªservletï¼Œåœ¨è¢«åˆ›å»ºæ˜¯ï¼Œä¼šæ‰§è¡Œinit()æ–¹æ³• â€‹ åœ¨init()æ–¹æ³•ä¸­ 1234//åˆ›å»ºå®¹å™¨ï¼Œè¯»å–é…ç½®æ–‡ä»¶getServletContext().getAttribute(key, ctx);//æŠŠå®¹å™¨å¯¹è±¡æ”¾å…¥åˆ°ServletContext()getServletContext().setAttribute(key, ctx); ä¸Šé¢åˆ›å»ºå®¹å™¨ä½œç”¨ï¼šåˆ›å»º@controlleræ³¨è§£æ‰€åœ¨çš„ç±»çš„å¯¹è±¡ï¼Œåˆ›å»ºMyControllerå¯¹è±¡ï¼Œ è¿™ä¸ªå¯¹è±¡æ”¾å…¥åˆ°springmvcçš„å®¹å™¨ï¼Œå®¹å™¨æ—¶mapï¼Œç±»ä¼¼map.put(&quot;myController&quot;, MyControllerå¯¹è±¡) è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹ æ‰§è¡Œservletçš„service() 12345protected void service(HttpServletRequest request, HttpServletResponse response) protected void doService(HttpServletRequest request, HttpServletResponse response) DispatcherServlet.doDispatch(request, response)&#123; //è°ƒç”¨MyControllerçš„.doSome()æ–¹æ³•&#125; 2. æ³¨è§£å¼å¼€å‘2.1 æ–‡ä»¶ä¸Šä¼ å’ŒServletæ–¹å¼çš„æœ¬è´¨ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡å¯¼å…¥ä¸¤ä¸ªjaråŒ…ï¼ˆcommons-io.jarå’Œcommons-fileupload.jarï¼‰ å…·ä½“æ­¥éª¤ï¼šï¼ˆç›´æŽ¥ä½¿ç”¨CommonsMultipartResolverå®žçŽ°ä¸Šä¼ ï¼‰ jaråŒ… commons-fileupload.jarã€commons-io.jar é…ç½®CommonsMultipartResolver å°†å…¶åŠ å…¥SpringMVCå®¹å™¨ä¸­ 1234567&lt;!-- springMVCå®¹å™¨åˆå§‹åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨å¯»æ‰¾ä¸€ä¸ªId=&quot;multipartResolver&quot;çš„beanï¼Œå¹¶å°†å…¶åŠ å…¥MVCå®¹å™¨ --&gt;&lt;bean id=&quot;multipartResolver&quot; class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt; &lt;!-- é»˜è®¤ç¼–ç  --&gt; &lt;property name=&quot;defaultEncoding&quot; value=&quot;utf-8&quot;&gt;&lt;/property&gt; &lt;!-- ä¸Šä¼ å•ä¸ªæ–‡ä»¶æœ€å¤§å€¼ --&gt; &lt;property name=&quot;maxUploadSize&quot; value=&quot;102400&quot;&gt;&lt;/property&gt;&lt;/bean&gt; æŽ§åˆ¶å™¨ï¼š 12345678910111213141516171819202122232425262728@RequestMapping(value = &quot;testUpload&quot;)public String testUpload(String desc, MultipartFile file) &#123; System.out.println(&quot;æ–‡ä»¶æè¿°ä¿¡æ¯ï¼š&quot; + desc); try &#123; InputStream input = file.getInputStream(); String fileName = file.getOriginalFilename(); OutputStream out = new FileOutputStream(&quot;d:\\\\&quot; + fileName); byte[] bs = new byte[1024]; int len = -1; // å¾ªçŽ¯ä»Ž è¾“å…¥æµ input ä¸­è¯»å–1024ä¸ªå­—èŠ‚ç»™ bs while((len = input.read(bs)) != -1)&#123; // æ¯æ¬¡è¯»å–åˆ°çš„æ•°æ® bs å†™å…¥åˆ°è¾“å…¥æµ out.write(bs, 0, len); &#125; out.close(); input.close(); &#125; catch (IOException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; //å°†fileä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­çš„æŸä¸€ä¸ªç¡¬ç›˜ä¸­ System.out.println(&quot;ä¸Šä¼ æˆåŠŸ&quot;); return &quot;success&quot;;&#125; è¡¨å•ï¼š 12345&lt;form action=&quot;handler/testUpload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt; &lt;input type=&quot;file&quot; name=&quot;file&quot;/&gt;&lt;br/&gt; &lt;input name=&quot;desc&quot; type=&quot;text&quot; /&gt;&lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;ä¸Šä¼ &quot; /&gt;&lt;br/&gt;&lt;/form&gt; 2.2 é…ç½®è§†å›¾è§£æžå™¨åœ¨springmvc.xmlä¸­å¢žåŠ beanæ¥å®žä¾‹å¹¶è‡ªåŠ¨é…ç½®jspæ–‡ä»¶çš„å‰ç¼€å’ŒåŽç¼€ æ¡†æž¶ä¼šä½¿ç”¨è§†å›¾è§£æžå™¨çš„å‰ç¼€ + é€»è¾‘åç§°ï¼ˆæ–‡ä»¶åï¼‰ + åŽç¼€ ç»„æˆå®Œæˆè·¯å¾„ è§†å›¾è·¯å¾„é…ç½® 123456&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt; &lt;!--å‰ç¼€ è§†å›¾æ–‡ä»¶çš„è·¯å¾„--&gt; &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/view/&quot;&gt;&lt;/property&gt; &lt;!-- åŽç¼€ è§†å›¾æ–‡ä»¶çš„æ‰©å±•å --&gt; &lt;property name=&quot;Suffix&quot; value=&quot;.jsp&quot;&gt;&lt;/property&gt;&lt;/bean&gt; æŽ§åˆ¶å™¨å®žçŽ°è½¬å‘è§†å›¾ 1234567891011@RequestMapping(value = &quot;/some.do&quot;)public ModelAndView doSome()&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;æ¬¢è¿Žä½¿ç”¨springmvcåšwebå¼€å‘&quot;); mv.addObject(&quot;fun&quot;, &quot;æ‰§è¡Œçš„æ˜¯doSomeæ–¹æ³•&quot;); mv.setViewName(&quot;show&quot;); return mv;&#125; æŽ§åˆ¶å™¨ä¸å˜ï¼Œè·Ÿä¹‹å‰çš„å†™æ³•ä¸€æ · æŽ§åˆ¶å™¨å¯ä»¥å®žçŽ°å¤šæ–¹æ³•ï¼Œå¤šè¯·æ±‚ 1234567891011121314151617181920212223@RequestMapping(value = &#123;&quot;/some.do&quot;, &quot;first.do&quot;&#125;)public ModelAndView doSome()&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;æ¬¢è¿Žä½¿ç”¨springmvcåšwebå¼€å‘&quot;); mv.addObject(&quot;fun&quot;, &quot;æ‰§è¡Œçš„æ˜¯doSomeæ–¹æ³•&quot;); mv.setViewName(&quot;show&quot;); return mv;&#125;@RequestMapping(value = &#123;&quot;/other.do&quot;, &quot;second.do&quot;&#125;)public ModelAndView doOther()&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;æ¬¢è¿Žä½¿ç”¨springmvcåšwebå¼€å‘&quot;); mv.addObject(&quot;fun&quot;, &quot;æ‰§è¡Œçš„æ˜¯doOtheræ–¹æ³•&quot;); mv.setViewName(&quot;other&quot;); return mv;&#125; ç±»ä¹Ÿå¯ä»¥æ³¨è§£å…¬å…±è·¯å¾„ 123@Controller@RequestMapping(&quot;/test&quot;)public class MyController &#123; å¸¸è§è§†å›¾è§£æžå™¨ InternalResourceViewã€InternalResourceViewResolver 123//springMVCè§£æžjspæ—¶ï¼Œä¼šé»˜è®¤ä½¿ç”¨InternalResourceView, å¦‚æžœå‘çŽ°JSPä¸­åŒ…å«äº†jstlè¯­è¨€ï¼Œåˆ™è‡ªåŠ¨è½¬ä¸ºJstlViewpublic class JstlView exteds InternalResourceView &#123;&#125; JstlViw å¯ä»¥è§£æžjstl ä»Žè€Œå®žçŽ°å›½é™…åŒ–æ“ä½œ 2.3 å›½é™…åŒ–å›½é™…åŒ–ï¼šé’ˆå¯¹ä¸åŒåœ°åŒºã€ä¸åŒå›½å®¶ï¼Œè¿›è¡Œä¸åŒçš„æ˜¾ç¤º ä¸­å›½ï¼šï¼ˆå¤§é™†ã€é¦™æ¸¯ï¼‰ æ¬¢è¿Ž ç¾Žå›½ï¼šwelcome å…·ä½“å®žçŽ°å›½é™…åŒ–çš„æ­¥éª¤ï¼š åˆ›å»ºèµ„æºæ–‡ä»¶ åŸºå_è¯­è¨€_åœ°åŒº.properties åŸºå_è¯­è¨€.properties é…ç½®springmvc.xmlæ–‡ä»¶ 123&lt;bean id=&quot;messageSource&quot; class=&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;&gt; &lt;property name=&quot;basename&quot; value=&quot;i18n&quot;&gt;&lt;/property&gt;&lt;/bean&gt; é€šè¿‡jstlä½¿ç”¨å›½é™…åŒ– éœ€è¦ä¸¤ä¸ªä¾èµ–åŒ…ï¼šjstl.jarå’Œ standar.jar 1&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; prefix=&quot;fmt&quot; %&gt; index.jsp 1&lt;a href=&quot;handler/testI18n&quot;&gt;test i18n&lt;/a&gt; success.jsp 12&lt;fmt:message key=&quot;resource.welcome&quot;&gt;&lt;/fmt:message&gt;&lt;fmt:message key=&quot;resource.exist&quot;&gt;&lt;/fmt:message&gt; å¤„ç†å™¨ï¼š 1234@RequestMapping(value = &quot;testI18n&quot;)public String testModelAttribute() &#123; return &quot;success&quot;;&#125; ä¸èƒ½ç›´æŽ¥è®¿é—®successæ¥å›½é™…åŒ–ï¼Œå¿…é¡»é€šè¿‡æœåŠ¡å™¨å“åº”æ‰èƒ½å®žçŽ° i18n_en_US.propeities 12resource.welcome=WELCOMEresource.exist=EXIST i18n_zh_CN.properties 12resource.welcome=\\u4F60\\u597Dresource.exist=\\u9000\\u51FA i18n.properties ä¸€èˆ¬ä¸Šé¢çš„æ‰¾ä¸åˆ°ä¼šè‡ªåŠ¨æ‰¾çˆ¶ç±» 2.4 å¤„ç†å™¨æŽ¥æ”¶å‚æ•° å¯¹è±¡æŽ¥æ”¶å‚æ•° 1234567891011121314@RequestMapping(value = &quot;receiveobject.do&quot;)public ModelAndView receiveParam(Student myStudent)&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;myname&quot;, myStudent.getName()); mv.addObject(&quot;myage&quot;, myStudent.getAge()); mv.addObject(&quot;mystudent&quot;, myStudent); System.out.println(myStudent); mv.setViewName(&quot;show&quot;); return mv;&#125; å½¢å‚è¯·æ±‚ è¯·æ±‚ä¸­æ‰€æºå¸¦çš„è¯·æ±‚å‚æ•° getæ–¹å¼â€“é€šè¿‡urlæ‹¼æŽ¥ï¼Œæ¯”å¦‚localhost:8080/MyProject?name=zs æˆ–è€…é€šè¿‡formæ ‡ç­¾è¾“å…¥inputç„¶åŽä¼ å›ž æ³¨æ„ï¼š è¯·æ±‚å‚æ•°å¿…é¡»è¦ä¸Žå¤„ç†å™¨ä¸­çš„å½¢å‚ä¸€è‡´ 12345&lt;form action=&quot;receiveparam.do&quot;&gt; å§“åï¼š&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt; &lt;br/&gt; å¹´é¾„ï¼š&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;otherçš„postè¯·æ±‚&quot;&gt;&lt;/form&gt; 123@RequestMapping(value = &quot;receiveparam.do&quot;)public ModelAndView doSome(String name, int age)&#123;&#125; é¢å¤–ï¼š getæ–¹æ³•çš„ç¼–ç é»˜è®¤æ˜¯utf-8ï¼Œå¦‚ç”¨getå‡ºçŽ°ä¸­æ–‡ä¹±ç ï¼Œåˆ™ä½¿ç”¨çš„tomcatå¯èƒ½æ˜¯tomcat7ï¼Œä½¿ç”¨8å³ä»¥ä¸Šï¼Œé»˜è®¤æ˜¯utf-8ï¼Œä¹Ÿå¯ä»¥åˆ°apache-tomcat-8.5.63\\confä¸­çš„server.xmlçš„ 12&lt;Connector URIEncoding=&quot;UTF-8&quot; connectionTimeout=&quot;20000&quot; port=&quot;8888&quot; protocol=&quot;HTTP/1.1&quot; redirectPort=&quot;8443&quot;/&gt;å¢žåŠ å±žæ€§ï¼šURIEncoding=&quot;UTF-8&quot; 2.5 é™æ€å¤„ç†2.5.1 ç¬¬ä¸€ç§é™æ€å¤„ç†äº¤ç”± tomcat æœ¬èº«çš„é»˜è®¤å¤„ç† åœ¨è·¯å¾„ä¸‹ï¼šapache-tomcat-9.0.43\\conf 1234&lt;!-- The default servlet for all web applications, that serves static --&gt; &lt;!-- resources. It processes all requests that are not mapped to other --&gt; &lt;!-- servlets with servlet mappings (defined either here or in your own --&gt; &lt;!-- web.xml file).--&gt; 1.è®¿é—®é™æ€èµ„æº 2.è®¿é—®æ²¡æœ‰è¢«è¯·æ±‚æ˜ å°„çš„servlet æ»¡è¶³ä»¥ä¸Šä»»æ„ä¸€ç‚¹çš„ï¼Œè®¿é—®ä¼šé»˜è®¤äº¤ç”±defaultçš„servletå¤„ç† 12345678910111213&lt;servlet&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;debug&lt;/param-name&gt; &lt;param-value&gt;0&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;listings&lt;/param-name&gt; &lt;param-value&gt;false&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt; æŽ¥ç€åœ¨web.xmlä½¿ç”¨servlet-nameæ¥æŒ‡å®šé»˜è®¤çš„å¤„ç†å™¨å’Œå¯¹è¦é»˜è®¤å¤„ç†çš„è·¯å¾„ 1234&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; 2.5.2 ç¬¬äºŒç§é™æ€å¤„ç†å¦‚æžœå°†æ‰€æœ‰é¡µé¢äº¤ç”±ä¸­å¤®è°ƒåº¦å™¨å¤„ç†ï¼Œå³ï¼Œweb.xmlä¸­åŠ å…¥ 1234567891011121314151617181920&lt;servlet&gt; &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;!-- springmvcé…ç½®æ–‡ä»¶ä½ç½®çš„å±žæ€§ --&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;!-- æŒ‡å®šè‡ªå®šä¹‰æ–‡ä»¶çš„ä½ç½® --&gt; &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;!-- è‡ªå®šä¹‰springmvcé…ç½®æ–‡ä»¶è¯»å–çš„ä½ç½® --&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;!--è¡¨ç¤ºé»˜è®¤èµ„æºå…¨ç»™DispatcherServletå¤„ç†äº†ï¼Œè€ŒDispatcherServletæœ¬èº«æ˜¯æ²¡æœ‰å¯¹é™æ€èµ„æºçš„å¤„ç†èƒ½åŠ›--&gt; ä¼šç”±äºŽä¸­å¤®è°ƒåº¦å™¨æ²¡æœ‰å¯¹é™æ€é¡µé¢çš„é»˜è®¤å¤„ç†å™¨ springMvcå¯ä»¥å¤„ç†æ²¡æœ‰è¢«è¯·æ±‚æ˜ å°„çš„å¤„ç†å™¨ å¯¼è‡´é¡µé¢è½¬å‘å¼‚å¸¸ï¼Œå‡ºçŽ°404ï¼Œèµ„æºè®¿é—®ä¸äº†æˆ–ä¸å­˜åœ¨ éœ€è¦åœ¨springmvc.xmlï¼ˆdispatcherServlet.xmlï¼‰ä¸­æ·»åŠ ä»¥ä¸‹é…ç½® 1&lt;mvc:default-servlet-handler/&gt; ç­‰åŒäºŽåœ¨web.xmlä¸­é…ç½®ï¼š 1234567891011121314&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jpg&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.js&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;default&lt;/servlet-name&gt; &lt;url-pattern&gt;*.html&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; æ³¨æ„ï¼š å¯¹äºŽweb.xmlã€spring.xmlé…ç½®æ–‡ä»¶çš„ä¿®æ”¹ï¼Œéœ€è¦å¯¹æœåŠ¡å™¨è¿›è¡Œçƒ­éƒ¨ç½²ï¼Œå³redeloyæˆ–è€…restart è¿™ç§æ–¹å¼ä¼šå¯¼è‡´åªèƒ½å¤„ç†é™æ€èµ„æºï¼Œè€Œä¸­å¤®è°ƒåº¦å™¨æœ¬èº«æ˜¯æ²¡æœ‰å¤„ç†é™æ€èµ„æºçš„èƒ½åŠ›ï¼Œä¸Šé¢å…¶å®žæ˜¯è½¬å‘ç»™äº†tomcatå¤„ç†çš„ï¼Œæ‰€ä»¥ç¬¬ä¸‰ç§å¤„ç†é™æ€èµ„æºå‡ºçŽ°äº† 2.5.3 ç¬¬ä¸‰ç§é™æ€å¤„ç†1&lt;mvc:default-servlet-handler/&gt; å¦‚æžœæ²¡æœ‰åŠ ä¸Š 1&lt;mvc:annotation-driven/&gt; å°±åªèƒ½å¤„ç†é™æ€èµ„æºï¼Œå…¶ä»–åŠ¨æ€èµ„æºæ— æ³•è®¿é—®äº†ï¼Œä¸ºäº†åè°ƒä¸¤è€…éœ€è¦åŠ å…¥ä»¥ä¸Šä¸¤ä¸ªæ³¨è§£ ä¸Šé¢ç¬¬äºŒç§æ˜¯è½¬å‘ç»™tomcatå¤„ç†çš„ï¼Œå¤„ç†çš„è¿˜æ˜¯tomcatï¼Œä¸‹é¢ç¬¬äºŒç§å¤„ç†é™æ€èµ„æºæ˜¯ springä¸“é—¨ç”¨äºŽå¤„ç†é™æ€èµ„æºè®¿é—®è¯·æ±‚çš„å¤„ç†å™¨ResourceHttpRequestHandler å¥½å¤„æ˜¯ä¸ç”¨å†äº¤ç»™tomcatå¤„ç†äº†ï¼Œå®Œå…¨äº¤ç»™spring éœ€è¦spring3.0ä»¥ä¸Š æ”¹å†™æˆ 12345678&lt;mvc:resources mapping=&quot;/img/**&quot; location=&quot;/img/&quot;/&gt;&lt;mvc:resources mapping=&quot;/js/**&quot; location=&quot;/js/&quot;/&gt;&lt;mvc:resources mapping=&quot;/html/**&quot; location=&quot;/html/&quot;/&gt;&lt;!-- location è¡¨ç¤ºé™æ€èµ„æºæ‰€åœ¨çš„ç›®å½•, ç›®å½•ä¸è¦ä½¿ç”¨/WEB-INF/åŠå…¶å­ç›®å½• mapping è¡¨ç¤ºå¯¹è¯¥èµ„æºçš„è¯·æ±‚ ï¼ˆmapping=&quot;/images/**&quot;è¡¨ç¤ºå¯¹ ä»¥/img/å¼€å§‹çš„è¯·æ±‚ï¼Œå¦‚/img/beauty.jpgã€/img/car.pngï¼‰--&gt; å†æ”¹è¿›ï¼š 1&lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/static/&quot;/&gt; 2.6 ç±»åž‹è½¬æ¢å™¨ Springè‡ªå¸¦ä¸€äº›å¸¸è§çš„ç±»åž‹è½¬æ¢å™¨ public String testDelete(@PathVariable(&quot;id&quot;) String id) ,å³å¯ä»¥æŽ¥å—int ç±»åž‹æ•°æ®idä¹Ÿå¯ä»¥æŽ¥å—String ç±»åž‹æ•°æ®id è‡ªå®šä¹‰ç±»åž‹è½¬æ¢å™¨ ç¼–å†™ è‡ªå®šä¹‰ç±»åž‹è½¬æ¢å™¨çš„ç±»ï¼ˆå®žçŽ°Converterï¼‰ 1234567891011public class MyConverter implements Converter&lt;String, Object&gt;&#123; @Override public Object convert(String source) &#123;//source:2-zs String[] studentStrArr = source.split(&quot;-&quot;); Student student = new Student(); student.setId(Integer.parseInt(studentStrArr[0])); student.setName(studentStrArr[1]); return student; &#125;&#125; æŽ§åˆ¶å™¨ï¼š 123456@RequestMapping(value = &quot;testConverter&quot;)public String testConverter(@RequestParam(value = &quot;studentInfo&quot;) Student student) &#123; System.out.println(student.getId() + &quot;,&quot; + student.getName()); return &quot;success&quot;;&#125; å…¶ä¸­@RequestParam(value = &quot;studentInfo&quot;) æ˜¯è§¦å‘è½¬æ¢å™¨çš„æ¡¥æ¢ @RequestParam(value = &quot;studentInfo&quot;)æŽ¥æ”¶çš„æ•°æ® æ˜¯å‰ç«¯ä¼ è¿‡æ¥çš„ï¼š2-zs,ä½†æ˜¯éœ€è¦å°†è¯¥æ•°æ®å¤åˆ¶ç»™ ä¿®é¥°çš„ ç›®çš„å¯¹è±¡Student å› æ­¤SpringMVCå¯ä»¥å‘çŽ°æŽ¥æ”¶çš„æ•°æ®å’Œ ç›®æ ‡æ•°æ®çš„ä¸ä¸€è‡´ï¼Œå¹¶ä¸”è¿™ä¸¤ç§æ•°æ®åˆ†åˆ«æ˜¯String,Student,æ­£å¥½ç¬¦åˆè½¬åŒ–å™¨ 1public Student convert(String source) &#123;//source:2-zs ä»Žè€Œè§¦å‘ é…ç½®ï¼šå°†MyConverteråŠ å…¥åˆ°springmvcä¸­ 123456789101112131415&lt;!-- è‡ªå®šä¹‰è½¬æ¢å™¨ çº³å…¥SpringIOCå®¹å™¨ --&gt;&lt;bean id=&quot;myConverter&quot; class=&quot;org.zhkucst.converty.MyConverter&quot;&gt;&lt;/bean&gt;&lt;!-- å°†myConverterå†çº³å…¥SpringMVCæä¾›çš„è½¬æ¢å™¨Bean --&gt;&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;&gt; &lt;property name=&quot;converters&quot;&gt; &lt;set&gt; &lt;ref bean=&quot;myConverter&quot;/&gt; &lt;/set&gt; &lt;/property&gt;&lt;/bean&gt;&lt;!-- å°†conversionService æ³¨å†Œåˆ°annotation-drivenä¸­ --&gt;&lt;!-- æ­¤é…ç½®æ˜¯SpringMVCçš„åŸºç¡€é…ç½®ï¼Œå¾ˆå¤šåŠŸèƒ½éƒ½éœ€è¦é€šè¿‡è¯¥æ³¨è§£æ¥åè°ƒ --&gt;&lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;/&gt; 2.7 æ•°æ®æ ¼å¼åŒ–1SimpleDateFormat sdf = new SimpleDateFormat (&quot;yyyy-MM hh:mm:ss&quot;); SpringMVCæä¾›äº†å¾ˆå¤šæ³¨è§£ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ•°æ®æ ¼å¼åŒ– å®žçŽ°æ­¥éª¤ï¼š é…ç½® 1234&lt;mvc:annotation-driven conversion-service=&quot;conversionService&quot;/&gt;&lt;!-- é…ç½®æ•°æ®æ ¼å¼åŒ–æ‰€ä¾èµ–çš„bean --&gt;&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt; &lt;/bean&gt; é€šè¿‡æ³¨è§£ä½¿ç”¨ 1234567public class Student &#123; @NumberFormat(pattern = &quot;###,#&quot;)//æ ¼å¼åŒ–æ•°å­— private int id; private String name; @DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)//æ ¼å¼åŒ–æ—¥æœŸ private Date birthday; å¤„ç†å™¨ï¼š 12345678910111213@RequestMapping(value = &quot;testDateFormat&quot;)public String testDateFormat(Student student, BindingResult result) &#123; System.out.println(student.getId() + &quot;,&quot; + student.getName() + &quot;,&quot; + student.getBirthday()); if(result.getErrorCount() &gt; 0) &#123; for(FieldError error : result.getFieldErrors()) &#123; System.out.println(error.getDefaultMessage()); &#125; &#125; return &quot;success&quot;;&#125; BindingResult resultä¼ çš„å‚æ•°ç›¸å½“äºŽæ•èŽ·å¼‚å¸¸ï¼Œtry&#123;&#125; catch()&#123;&#125;,å› æ­¤ä¸ä¼šæŠ›å¼‚å¸¸äº† åŒ…ä¸­ï¼Œæ•°æ®æ ¼å¼åŒ–çš„beanç±»FormattingConversionServiceFactoryBeanåŒ…å«äº†è½¬æ¢å™¨çš„beanç±»ConversionServiceFactoryBean 123&lt;!--æ—¢å¯ä»¥å®žçŽ°è½¬æ¢ã€ä¹Ÿå¯ä»¥å®žçŽ°æ•°æ®æ ¼å¼--&gt;&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;&gt; 123&lt;!--åªèƒ½å®žçŽ°è½¬æ¢--&gt;&lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;&gt;&lt;/bean&gt; 2.7.1 é”™è¯¯ä¿¡æ¯1public String testDateTimeFormatï¼ˆStudent student, BindingResult result, Map&lt;String,Object&gt; mapï¼‰ éœ€è¦éªŒè¯çš„æ•°æ®æ˜¯ Studentä¸­çš„birthday, SpringMVCè¦æ±‚ å¦‚æžœæ ¡éªŒå¤±è´¥ åˆ™å°†é”™è¯¯ä¿¡æ¯ è‡ªåŠ¨æ”¾å…¥ è¯¥å¯¹è±¡ä¹‹åŽ çš„å‚æ•°ä¸­ï¼Œ å³Student student, BindingResult resultä¹‹é—´ ä¸èƒ½æœ‰å…¶ä»–å‚æ•° å¦‚æžœè¦å°†æŽ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ä¼ åˆ°jspä¸­æ˜¾ç¤ºï¼Œåˆ™å¯ä»¥å°† é”™è¯¯ä¿¡æ¯å¯¹è±¡æ”¾å…¥requeståŸŸä¸­ç„¶åŽåœ¨jspä¸­ ä»Ž requestå–å‡º 2.7.2æ•°æ®æ ¡éªŒJSR-303 æ˜¯JAVA EE6 ä¸­çš„ä¸€é¡¹å­è§„èŒƒï¼Œå«åšBean Validationï¼ŒHibernate Validator æ˜¯ Bean Validation çš„å‚è€ƒå®žçŽ°ï¼Œæä¾›äº† JSR 303 è§„èŒƒä¸­æ‰€æœ‰å†…ç½® constraint çš„å®žçŽ°ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›é™„åŠ çš„ constraintã€‚ æ•°æ®æ ¡éªŒ â€‹ 1.JSR303 â€‹ 2.Hibernate Validator ä½¿ç”¨Hibernate Validatoræ­¥éª¤ï¼š å¯¼åŒ… classmate-1.5.1.jar hibernate-validator-5.4.1.Final.jar hibernate-validator-annotation-processor-5.4.1.Final.jar jboss-logging-3.3.0.Final.jar validation-api-1.1.0.Final.jar é…ç½® æ­¤æ—¶mvc:annotation-drivençš„ä½œç”¨ï¼Œè¦å®žçŽ°Hibernate Validator/JSR303æ ¡éªŒ(æˆ–è€…å…¶ä»–å„ç§æ ¡éªŒ) å¿…é¡»å®žçŽ°SpringMVCæä¾›çš„ä¸€ä¸ªæŽ¥å£ï¼š ValidatorFactory LocalValidatorFactoryBeanæ˜¯ValidatorFactoryçš„ä¸€ä¸ªå®žçŽ°ç±» &lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;ä¼šåœ¨springmvcå®¹å™¨ä¸­ è‡ªåŠ¨åŠ è½½ä¸€ä¸ªLocalValidatorFactoryBean æ‰€ä»¥é…ç½®åªéœ€è¦é…ç½® 1&lt;mvc:annotation-driven/&gt; ç›´æŽ¥ä½¿ç”¨æ³¨è§£ 1234567891011public class Student &#123; @NumberFormat(pattern = &quot;###,#&quot;) private int id; private String name; @Past @DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;) private Date birthday; @Email private String email; è¦æ±‚ï¼šåœ¨å±žæ€§ä¸Šä½¿ç”¨æ³¨è§£åŽï¼Œéœ€è¦åœ¨æŽ§åˆ¶å™¨ä¸­çš„å‚æ•°Studentå‰ä½¿ç”¨æ³¨è§£@Validï¼Œæ ‡æ˜Žä¸Šæ˜¯è¦æœ‰åˆæ³•æ€§çš„å‚æ•° 12@RequestMapping(value = &quot;testDateFormat&quot;)public String testDateFormat(@Valid Student student, BindingResult result) &#123; 2.8 è·¯å¾„2.8.1 ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„jspè¯·æ±‚è·¯å¾„ï¼š 12345&lt;form action=&quot;some.do&quot; method=&quot;post&quot;&gt; å§“åï¼š&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt; &lt;br/&gt; å¹´é¾„ï¼š&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;otherçš„postè¯·æ±‚&quot;&gt;&lt;/form&gt; ä¸ä»¥ â€œ/â€œ å¼€å¤´ å‚è€ƒçš„åœ°å€ä¸º http://localhost:8888/ch06-path/ å³ http://localhost:8888/ch06-path/ + some.do éšæ‚£ï¼š ç”±äºŽå¤šæ¬¡è¯·æ±‚å¯¼è‡´è·¯å¾„å‘ç”Ÿå˜åŒ–ï¼Œä»Žè€Œè¯·æ±‚ä¸åˆ°èµ„æºï¼ŒåŽŸå› ï¼šä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„ å¸¸è§ä¾‹å­ï¼š index.jspè®¿é—® user/some.do http://localhost:8080/project/user/some.do ä¸­è¿”å›žåˆ°index.jsp http://localhost:8080/project/user/some.do (æ˜¯å› ä¸ºæ˜¯ç”±å¤„ç†å™¨å‘èµ·äº†è½¬å‘ï¼Œå› è€Œåœ°å€æ²¡æœ‰æ”¹å˜) å†æ¬¡è®¿é—®some.doå°±ä¼šå‡ºçŽ° http://localhost:8080/project/user/user/some.do è§£å†³æ–¹æ³•ï¼š ä½¿ç”¨baseæ ‡ç­¾ 1&lt;base href=&quot;http://localhost:8888/$&#123;pageContext.request.ContextPath&#125;/&quot;&gt; åˆ™formè¡¨å•æˆ–aæ ‡ç­¾æ¯æ¬¡è¯·æ±‚çš„åŸºåœ°å€éƒ½æ˜¯ä»¥http://localhost:8888/$&#123;pageContext.request.ContextPath&#125;/å¼€å¤´ + some.do æ›´åŠ åŠ¨æ€ã€çµæ´»çš„æ–¹å¼ 1234567&lt;%String basePath = request.getScheme() + &quot;://&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + request.getContextPath() + &quot;/&quot;;%&gt;&lt;base href=&quot;&lt;%=basePath%&gt;&quot;&gt; ä»¥ â€œ/â€å¼€å¤´ å‚è€ƒçš„åœ°å€ä¸º http://localhost:8888/ å³ http://localhost:8888/ + some.do å¤„ç†æ–¹æ³•ï¼š 12345&lt;form action=&quot;/ch06-path/some.do&quot; method=&quot;post&quot;&gt; å§“åï¼š&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt; &lt;br/&gt; å¹´é¾„ï¼š&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;otherçš„postè¯·æ±‚&quot;&gt;&lt;/form&gt; ä¸å¤Ÿçµæ´»ï¼š è§£å†³æ–¹æ³•ï¼š åŠ ä¸Š$&#123;pageContext.request.ContextPath&#125; $&#123;pageContext.request.ContextPath&#125;è¡¨ç¤ºé¡¹ç›®æ ¹ å³http://localhost:8888/ + ch06_path å³ 12345&lt;form action=&quot;$&#123;pageContext.request.ContextPath&#125;/some.do&quot; method=&quot;post&quot;&gt; å§“åï¼š&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt; &lt;br/&gt; å¹´é¾„ï¼š&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt; &lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;otherçš„postè¯·æ±‚&quot;&gt;&lt;/form&gt; æ‰©å±•ï¼š anté£Žæ ¼çš„è¯·æ±‚è·¯å¾„ï¼š ï¼Ÿï¼šå•å­—ç¬¦ * ï¼šä»»æ„å­—ç¬¦ï¼ˆ0æˆ–å¤šä¸ªï¼‰ **ï¼šä»»æ„ç›®å½• 2.8.2 è·¯å¾„è®¿é—®é—®é¢˜webé¡¹ç›®ä¸­ï¼ŒWEB-INFæ˜¯å—ä¿æŠ¤çš„ï¼Œé€šè¿‡urlè·¯å¾„è®¿é—®ä¼šå‡ºçŽ°404,ä¸å…è®¸è®¿é—® WEB-INFç›®å½•ä¸­çš„æ–‡ä»¶åªèƒ½é€šè¿‡è½¬å‘æ¥å®žçŽ° 2.9 RequestMapping2.9.1 @RequestParamæ³¨è§£å¦‚æžœè¡¨å•çš„ä¼ å€¼å’ŒæŽ§åˆ¶å™¨ä¸­çš„å½¢å‚å˜é‡ä¸ä¸€è‡´ï¼Œåˆ™éœ€è¦é€šè¿‡åœ¨å˜é‡åå‰åŠ ä¸Šæ³¨RequestParam è¡¨å•æäº¤ï¼š 12345&lt;form action=&quot;receiveparam.do&quot; method=&quot;post&quot;&gt; å§“åï¼š&lt;input type=&quot;text&quot; name=&quot;rname&quot;&gt; &lt;br/&gt; å¹´é¾„ï¼š&lt;input type=&quot;text&quot; name=&quot;rage&quot;&gt; &lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;otherçš„postè¯·æ±‚&quot;&gt;&lt;/form&gt; æŽ§åˆ¶å™¨ï¼š æ·»åŠ æ³¨è§£ï¼š@RequestParam(value = &quot;rname&quot;) â€‹ @RequestParam(value = &quot;rage&quot;) è¡¨ç¤ºè¯·æ±‚ä¸­çš„å‚æ•°ï¼Œä¾‹å¦‚urlï¼šlocalhost:8080/MyProject?rname=&amp;rage= valueå€¼ä¸Žè¡¨å•çš„ä¼ å€¼ä¸€è‡´ 1234567891011@RequestMapping(value = &quot;receiveparam.do&quot;)public ModelAndView receiveParam(@RequestParam(value = &quot;rname&quot;) String name, @RequestParam(value = &quot;rage&quot;) Integer age)&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;myname&quot;, name); mv.addObject(&quot;myage&quot;, age); mv.setViewName(&quot;show&quot;); return mv;&#125; æ³¨æ„ï¼š ä¸èƒ½ç›´æŽ¥è®¿é—®servletåœ°å€ï¼Œå¿…é¡»å…ˆé€šè¿‡è¡¨å•ä¼ å‚æˆ–åœ°å€æ ä¼ å‚ å‡ºé”™400 æ‰€ä»¥ï¼Œéœ€è¦åœ¨æ–¹æ³•å‰å†åŠ å¦å¤–ä¸€ä¸ªæ³¨è§£è¡¨æ˜Žæ˜¯å¦è¡¨ç¤ºè¯·æ±‚ä¸­å¿…é¡»åŒ…å«æ­¤å‚æ•° 12@RequestParam(value = &quot;rname&quot;, required = false) String name,@RequestParam(value = &quot;rage&quot;, required = false) Integer age) é»˜è®¤requireä¸ºtrueï¼Œå³åŒ…å«çš„å‚æ•°æ˜¯å¿…é¡»çš„ localhost:8080/MyProject?rname=&amp;rage= falseåˆ™éžå¿…é¡»ï¼Œå¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰ 2.9.2 @RequestMappingå±žæ€§ ä¼ å‚æ•° 12@RequestMapping(value=&quot;welcome&quot;,method=&quot;RequestMethod.Post&quot;, params=&#123;&quot;name=zs&quot;,&quot;age!=23&quot;,&quot;!height&quot;&#125;) è¯´æ˜Žï¼š ageå¯ä»¥ä¸ºç©ºï¼Œä¸ä¼ å€¼ heightä¸èƒ½ä¼ å€¼ è¯·æ±‚å¤´ä¿¡æ¯ è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯ï¼š 12@RequestMapping(value=&quot;welcome&quot;,method=&quot;RequestMethod.Post&quot;, headers =&#123;&quot;Accept=text/html,application/xhtml....&quot;,&quot;....&quot;&#125; èŽ·å–è¯·æ±‚å¤´ä¿¡æ¯ï¼š 1234@RequestMapping(value = &quot;testRest/&#123;id&#125;&quot;, method = RequestMethod.GET)public String welcome4(@PathVariable(&quot;id&quot;) Integer id, @RequestHeader(&quot;Accept-Language&quot;) String al) &#123;&#125; è¯´æ˜Žï¼šéœ€è¦æ”¯æŒæˆ–å…¼å®¹è¯¥è¯·æ±‚å¤´çš„æµè§ˆå™¨ è·¯å¾„è¯·æ±‚å‚æ•° è¡¨å•ï¼š 1&lt;a href=&quot;&quot;handler/welcome/zs&quot;&gt;è·¯å¾„ä¼ å‚&lt;/a&gt; åŽå°æŽ¥æ”¶ï¼š 123@RequestMapping(value=&quot;welcome/&#123;name&#125;&quot;,method=&quot;RequestMethod.Post&quot;, public String welcome(@PathVariable(&quot;name&quot;) String name) &#123; &#125; Cookieä¿¡æ¯ é€šè¿‡mvcèŽ·å–cookieå€¼ï¼ˆJESSIONIDï¼‰ @CookieValue (å‰ç½®çŸ¥è¯†ï¼šæœåŠ¡ç«¯åœ¨æŽ¥å—å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œä¼šç»™å®¢æˆ·ç«¯åˆ†é…ä¸€ä¸ªsession(è¯¥sessionåŒ…å«ä¸€ä¸ªsessionId)) å°ç»“ï¼š SpringMVCå¤„ç†å„ç§å‚æ•°çš„æµç¨‹ã€é€»è¾‘ï¼š è¯·æ±‚ï¼šå‰ç«¯å‘è¯·æ±‚a-&gt;@RequestMapping(&quot;a&quot;); å¤„ç†è¯·æ±‚ä¸­çš„å‚æ•°ï¼š â€‹ @RequestMapping(&quot;a&quot;) â€‹ public String aa(&quot;@Xxxæ³¨è§£(xyz)&quot; xyz) 2.9.3 æŒ‡å®šè¯·æ±‚æ–¹å¼Methodå±žæ€§åœ¨æ–¹æ³•åä¸Šæ ‡æ˜Žæ³¨è§£ 123@RequestMapping(value = &#123;&quot;/some.do&quot;, &quot;/first.do&quot;&#125;, method = RequestMethod.GET)public ModelAndView doSome()&#123;//å¦‚æžœä¸æŒ‡å®šè¯·æ±‚æ–¹å¼ï¼Œåˆ™æ²¡æœ‰é™åˆ¶ formæ ‡ç­¾æŒ‡å®šgetæ–¹æ³•ï¼ŒæŽ§åˆ¶å™¨ä¸èƒ½æŒ‡å®špostæ–¹æ³• å¦åˆ™ä¼šå‡ºçŽ°405é”™è¯¯ 123&lt;form action=&quot;test/some.do&quot; method=&quot;post&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;otherçš„postè¯·æ±‚&quot;&gt;&lt;/form&gt; 2.10 å¤„ç†æ¨¡åž‹æ•°æ® æ•°æ®æ¨¡åž‹ï¼šModelAndViewã€Modelã€ModelMapã€Map 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051@RequestMapping(value = &quot;testMap&quot;)public String testMap(Map&lt;String,Object&gt; map) &#123; Student student = new Student(); student.setId(3); student.setName(&quot;zs&quot;); map.put(&quot;student&quot;, student); return &quot;success&quot;;&#125;@RequestMapping(value = &quot;testModelMap&quot;)public String testModelMap(ModelMap modelMap) &#123; Student student = new Student(); student.setId(3); student.setName(&quot;zs&quot;); modelMap.put(&quot;student&quot;, student); return &quot;success&quot;;&#125;@RequestMapping(value = &quot;testModel&quot;)public String testModel(Model model) &#123; Student student = new Student(); student.setId(3); student.setName(&quot;zs&quot;); model.addAttribute(&quot;student&quot;, student); return &quot;success&quot;;&#125;@RequestMapping(value = &quot;testModelAndView&quot;)public ModelAndView testModelAndView() &#123; ModelAndView modelAndView = new ModelAndView(); Student student = new Student(); student.setId(3); student.setName(&quot;zs&quot;); modelAndView.addObject(&quot;student&quot;, student); modelAndView.setViewName(&quot;success&quot;); return modelAndView;&#125; å°†æ•°æ®æ”¾å…¥requeståŽï¼Œä¹Ÿæ”¾å…¥session ç±»åä¸Šæ·»åŠ  @SessionAttributes(&quot;student4&quot;) : é™æ€å†™æ³• å‚æ•°åä¸ŽrequesståŸŸçš„keyå€¼ç›¸åŒï¼Œè¡¨ç¤ºæŒ‡å®šå“ªä¸€ä¸ªk-vå¯¹ @SessionAttributes(types = Student.class) ï¼š åŠ¨æ€ä»£ç†å†™æ³• å…·ä½“æ˜¯ä»¥è°ƒç”¨å“ªä¸ªæ–¹æ³•ä¸­çš„studentæ¥åŠ¨æ€åŒæ­¥åˆ°session @ModelAttribute æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•åœ¨ä¼šåœ¨æ¯æ¬¡è¯·æ±‚å‰å…ˆæ‰§è¡Œ å¹¶ä¸”è¯¥æ–¹æ³•çš„å‚æ•°map.put()å¯ä»¥å°†å¯¹è±¡ æ”¾å…¥å³å°†æŸ¥è¯¢çš„å‚æ•°ä¸­ å¿…é¡»æ»¡è¶³çš„çº¦å®šï¼š map.put(k,v)å…¶ä¸­çš„kå¿…é¡»æ˜¯å³å°†æŸ¥è¯¢æ–¹æ³•å‚æ•°çš„ é¦–å­—æ¯å°å†™testModelAtribute(Student xxx) , å³student; å¦‚æžœä¸ä¸€è‡´,éœ€è¦é€šè¿‡@ModelAttributeå£°æ˜Žã€‚ â€‹ map.put(&quot;stu&quot;,student) testModelAtribute( @ModelAttribute(&quot;stu&quot;ï¼‰ Student student ) ç¤ºä¾‹ï¼š 1234&lt;form action=&quot;handler/testModelAttribute&quot;&gt; name:&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;br/&gt; &lt;input type=&quot;submit&quot; value=&quot;testModelAttribute&quot;&gt;&lt;/form&gt; 12345678910111213141516171819202122232425262728293031323334353637383940/*å…ˆæ‰§è¡Œè¯¥æ–¹æ³•*/ @ModelAttributepublic void queryStudents(Map&lt;String, Object&gt; map) &#123; Student student = new Student(); student.setId(5); student.setName(&quot;ww&quot;); System.out.println(student.getId()+&quot;,&quot; + student.getName()); map.put(&quot;student&quot;, student);&#125;/*æ‰§è¡Œå®ŒåŽï¼Œè¯¥æ³¨è§£ä¼šè¢«æ ‡è®°ä¸ºé€šçŸ¥ï¼Œä¼šæ‰§è¡Œæ¡†æž¶ä¸­çš„å¦å¤–çš„æ–¹æ³•ï¼ˆmethod,map,student,handlerï¼‰ ç›®çš„ï¼šæŠŠmapä¸­åŒ…å«çš„studentä¼ ç»™è¯·æ±‚çš„æ–¹æ³•ä½“å‚æ•°ä¸­,å¹¶é€šè¿‡å‰ç«¯çš„ä¼ å€¼ï¼Œè¦†ç›–student åŽŸç†ï¼šé¢å‘åˆ‡é¢ï¼Œå³AOP method: public String testModelAttribute(Student student) map: map.put(&quot;student&quot;, student); student: Student student = new Student(); student.setId(5); student.setName(&quot;ww&quot;); handler: @Controller@RequestMapping(value = &quot;handler&quot;)public class SpringMVCHandler &#123; *//*å‰ç«¯è¯·æ±‚å¤„ç†çš„æ–¹æ³•ï¼Œå…ˆè°ƒç”¨æœ‰æ³¨è§£@ModelAttributeçš„æ–¹æ³•*/@RequestMapping(value = &quot;testModelAttribute&quot;)public String testModelAttribute(Student student) &#123; System.out.println(student.getId()+&quot;,&quot; + student.getName()); return &quot;success&quot;;&#125; 2.11 è¿”å›žå€¼2.11.1 è¿”å›ž ModelAndViewã€String ModeAndView å‰é¢å·²ç»æ¼”ç¤ºè¿‡ï¼šè¿”å›žæ•°æ® + è§†å›¾ Stringï¼Œè¿”å›žStringï¼ˆè§†å›¾ï¼‰ å¯åˆ†ä¸ºé€»è¾‘è§†å›¾å’Œå®Œæ•´è§†å›¾ â€‹ ï¼ˆ1ï¼‰é€»è¾‘è§†å›¾éœ€è¦é…ç½®è§†å›¾è§£æžå™¨ 1234567@RequestMapping(value = &quot;returnString-view.do&quot;)public String doReturnView(HttpServletRequest request, String name, int age)&#123; request.setAttribute(&quot;myname&quot;, name); request.setAttribute(&quot;myage&quot;, age); return &quot;show&quot;;&#125; â€‹ ï¼ˆ2ï¼‰å®Œæ•´è§†å›¾ä¸èƒ½é…ç½®è§†å›¾è§£æžå™¨ï¼Œæ ¹ç›®å½•æ˜¯WebContentæˆ–è€…webapp 12345678//å¤„ç†å™¨æ–¹æ³•è¿”å›žString, è¡¨ç¤ºå®Œæ•´è·¯å¾„ï¼Œä¸èƒ½é…ç½®è§†å›¾è§£æžå™¨@RequestMapping(value = &quot;returnString-view2.do&quot;)public String doReturnView2(HttpServletRequest request, String name, int age)&#123; request.setAttribute(&quot;myname&quot;, name); request.setAttribute(&quot;myage&quot;, age); return &quot;/WEB-INF/view/show.jsp&quot;;&#125; 2.11.2 è¿”å›ž voidã€Object void ç”¨äºŽå¤„ç†ajax éœ€è¦ä½¿ç”¨ajaxï¼Œå¯¼å…¥jquery-3.5.1.js ä»¥åŠ pomä¸­åŠ å…¥ä¾èµ–åŒ…ï¼ˆjackson-databind å’Œjackson-coreï¼‰ 1234567891011&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt; å‰ç«¯ï¼š 12345678910111213141516171819&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.5.1.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt; function button_data()&#123; $.ajax(&#123; url:&quot;returnVoidAjax.do&quot;, data:&#123; name:&quot;å¼ ä¸‰&quot;, age:&quot;21&quot; &#125;, type:&quot;post&quot;, dataType:&quot;json&quot;, success:function(msg)&#123; alert(msg.name + &quot;,&quot; + msg.age); &#125; &#125;);&#125;;&lt;/script&gt; 1dataType:&quot;json&quot;,//æ˜¯æŒ‡å®šæŽ§åˆ¶è¿”å›žçš„ç±»åž‹ï¼Œå¦‚æžœæ²¡æœ‰å®ƒï¼Œjqueryé»˜è®¤ä¹Ÿæ˜¯å½“æˆjsonå¤„ç† ä½†å¤„ç†å™¨ä¸­responseæ²¡æœ‰è®¾ç½®å“åº”å¤´ï¼Œåˆ™æ•°æ®æ— æ³•ä¼ åˆ°å‰ç«¯ 1&lt;button id=&quot;btn&quot; onclick=&quot;button_data()&quot;&gt;å‘èµ·ajaxè¯·æ±‚&lt;/button&gt; æŽ§åˆ¶å™¨ï¼š 123456789101112131415161718@RequestMapping(value = &quot;returnVoidAjax.do&quot;)public void returnVoidAjax(HttpServletResponse response, String name, Integer age) throws IOException &#123; Student student = new Student(); student.setName(name); student.setAge(age); String json = &quot;&quot;; ObjectMapper om = new ObjectMapper(); json = om.writeValueAsString(student); //è®¾ç½®å“åº”å¤´ï¼Œè®¾å¤‡å“åº”ç¼–ç ï¼Œä¸è®¾ç½®ä¼šä¹±ç  response.setContentType(&quot;application/json;charset=utf-8&quot;); PrintWriter pw = response.getWriter(); pw.print(json); pw.close();&#125; å“åº”å¤´ï¼šå¢žåŠ  12//è®¾ç½®å“åº”å¤´ï¼Œè®¾å¤‡å“åº”ç¼–ç ï¼Œä¸è®¾ç½®ä¼šä¹±ç response.setContentType(&quot;application/json;charset=utf-8&quot;); åŽæ˜¾ç¤ºï¼š jsonæ ¼å¼å­—ç¬¦ä¸²è½¬æˆjsonå¯¹è±¡ æ²¡æœ‰å¢žåŠ æ˜¾ç¤ºï¼š å¯¼è‡´çš„ä¹±ç ï¼š è™½ç„¶å‰ç«¯æ˜¾ç¤ºå‡ºçš„æ•°æ®æ­£å¸¸ï¼Œä½†F12æŽ§åˆ¶å°ä¸­responseçš„jsonæ ¼å¼çš„å­—ç¬¦ä¸²å’Œpreviewçš„jsonå¯¹è±¡ responseä»ŽæœåŠ¡å™¨è¿”å›žçš„æ˜¯jsonæ ¼å¼çš„å­—ç¬¦ä¸²{name:â€å¼ ä¸‰â€, age: 21} å› ä¸ºjqueryå¯ä»¥æŠŠjsonæ ¼å¼å­—ç¬¦ä¸²è½¬æ¢æˆjsonå¯¹è±¡,å¹¶èµ‹å€¼ç»™successä¸­çš„å½¢å‚msg ä½†æ˜¯requestçš„è¯·æ±‚å¤´æ˜¯é»˜è®¤æœ‰çš„ï¼š Object ä¾‹å¦‚String, Integer, Map, List, Studentç­‰ç­‰éƒ½æ˜¯å¯¹è±¡ å¯¹è±¡æœ‰å±žæ€§ï¼Œ å±žæ€§å°±æ˜¯æ•°æ®ï¼Œæ‰€ä»¥è¿”å›žObjectè¡¨ç¤ºæ•°æ®ï¼Œå’Œè§†å›¾æ— å…³ å¯ä»¥ä½¿ç”¨å¯¹è±¡è¡¨ç¤ºçš„æ•°æ®ï¼Œå“åº”ajaxè¯·æ±‚ã€‚ 12&lt;!--åŠ å…¥&lt;mvc:annotation-driven&gt; æ³¨è§£é©±åŠ¨--&gt;&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt; 123456789@RequestMapping(value = &quot;returnObjectAjax.do&quot;)@ResponseBodypublic Student returnStudentAjax(String name, Integer age)&#123; Student student = new Student(); student.setName(name); student.setAge(age); return student;&#125; 1234567891011121314function button_data()&#123; $.ajax(&#123; url:&quot;returnObjectAjax.do&quot;, data:&#123; name:&quot;å¼ ä¸‰åŒå­¦&quot;, age:&quot;21&quot; &#125;, type:&quot;post&quot;, dataType:&quot;json&quot;, success:function(resp)&#123; alert(msg.name + &quot;,&quot; + msg.age); &#125; &#125;);&#125;; 2.11.3 è¿”å›ž List&lt;Object&gt;ä¸ŽObjectç±»ä¼¼ æŽ§åˆ¶å™¨ï¼š 12345678910111213141516171819202122@RequestMapping(value = &quot;returnObjectArrayAjax.do&quot;)@ResponseBodypublic List&lt;Student&gt; returnStudentArrayAjax(String name, Integer age)&#123; List&lt;Student&gt; list = new ArrayList&lt;&gt;(); Student student = new Student(); student.setName(&quot;å¼ ä¸‰&quot;); student.setAge(21); list.add(student); student = new Student(); student.setName(&quot;æŽå››&quot;); student.setAge(24); list.add(student); return list;&#125; å‰ç«¯ï¼š 123456789101112131415161718function button_data()&#123; $.ajax(&#123; url:&quot;returnObjectArrayAjax.do&quot;, data:&#123; name:&quot;å¼ ä¸‰åŒå­¦&quot;, age:&quot;21&quot; &#125;, type:&quot;post&quot;, dataType:&quot;json&quot;, success:function(resp)&#123; $.each(resp,function (i, n)&#123; alert(n.name + &quot; , &quot; + n.age + &quot;/&quot; ) &#125;) &#125; &#125;);&#125;; 2.11.4 è¿”å›ž String æ–‡æœ¬æ•°æ®123public String returnString(HttpServletResponse response)&#123; return &quot;è¿”å›žStringç±»åž‹&quot;;&#125; 1234567891011121314151617181920$.ajax(&#123; //url:&quot;returnVoidAjax.do&quot;, // url:&quot;returnObjectAjax.do&quot;, //url:&quot;returnObjectArrayAjax.do&quot;, url:&quot;returnString.do&quot;, data:&#123; name:&quot;å¼ ä¸‰åŒå­¦&quot;, age:&quot;21&quot; &#125;, type:&quot;post&quot;, /** * è¿™é‡Œä¸èƒ½ç”¨ä¸Šjsonäº†ï¼Œå› ä¸ºæ–‡æœ¬æ•°æ®è½¬æ¢ä¸äº†jsonå¯¹è±¡ * å¦‚æžœæ–‡æœ¬æ•°æ®æ˜¯ &quot;&#123;name:&quot;zs&quot;,age:&quot;21&quot;&#125;&quot; * åˆ™å¯ä»¥è½¬æ¢ */ dataType:&quot;text&quot;, success:function(resp)&#123; alert(resp); &#125;&#125;); 2.11.5 json æ•°æ®æ‰‹åŠ¨å¤„ç†éœ€è¦jackson-coreçš„ä¸¤ä¸ªåŒ… 1234567891011&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt; 12345678910111213141516@RequestMapping(value = &quot;returnVoidAjax.do&quot;)public void returnVoidAjax(HttpServletResponse response, String name, Integer age) throws IOException &#123; Student student = new Student(); student.setName(name); student.setAge(age); String json = &quot;&quot;; ObjectMapper om = new ObjectMapper(); json = om.writeValueAsString(student); response.setContentType(&quot;application/json;charset=utf-8&quot;); PrintWriter pw = response.getWriter(); pw.print(json); pw.close();&#125; 2.11.6 @ResponseBodyçš„ json æ•°æ®å¤„ç†åŽŸç† å®žçŽ°æ­¥éª¤ åŠ å…¥å¤„ç†jsonçš„å·¥å…·åº“çš„ä¾èµ– springmvcé»˜è®¤ä½¿ç”¨çš„jackson åœ¨springmvcé…ç½®æ–‡ä»¶ä¹‹é—´åŠ å…¥&lt;mvc:annotation-driven&gt; æ³¨è§£é©±åŠ¨ 1json = om.writeValueAsString(student); åœ¨å¤„ç†å™¨çš„æ–¹æ³•çš„ä¸Šé¢åŠ å…¥@ResponseBodyæ³¨è§£ 123response.setContexType(&quot;application/json;charset=utf-8&quot;);PrintWriter pw = response.getWriter();pw.println(json); springmvcå¤„ç†å™¨æ–¹æ³•çš„è¿”å›žObject,å¯ä»¥è½¬ä¸ºjsonè¾“å‡ºåˆ°æµè§ˆå™¨ï¼Œå“åº”ajaxçš„å†…éƒ¨åŽŸç† 1.&lt;mvc:annotation-driven&gt;æ³¨è§£é©±åŠ¨ æ³¨è§£é©±åŠ¨å®žçŽ°çš„åŠŸèƒ½æ˜¯å®Œæˆjavaå¯¹è±¡åˆ°jsonã€xmlã€textã€äºŒè¿›åˆ¶ç­‰æ•°æ®æ ¼å¼çš„è½¬æ¢çš„7ä¸ªå®žçŽ°ç±»å¯¹è±¡ï¼ŒåŒ…æ‹¬MappingJackson2HttpMessageConvertor(ä½¿ç”¨jacksonå·¥å…·åº“ä¸­çš„ObjectMapperå®žçŽ°javaå¯¹è±¡è½¬ä¸ºjsonå¯¹è±¡ ) HttpMessageConveteræŽ¥å£ï¼šæ¶ˆæ¯è½¬æ¢å™¨ åŠŸèƒ½ï¼šå®šä¹‰äº†javaè½¬ä¸ºjsonï¼Œxmlç­‰æ•°æ®æ ¼å¼çš„æ–¹æ³•ã€‚è¿™ä¸ªæŽ¥å£æœ‰å¾ˆå¤šå®žçŽ°ç±»ã€‚ è¿™äº›å®žçŽ°ç±»å®Œæˆjavaå¯¹è±¡åˆ°jsonã€javaå¯¹è±¡åˆ°xmlã€javaå¯¹è±¡åˆ°äºŒè¿›åˆ¶æ•°æ®çš„è½¬æ¢ ä¸‹é¢æœ‰ä¸¤ä¸ªæ–¹æ³•æ˜¯æŽ§åˆ¶å™¨ç±»æŠŠç»“æžœè¾“å‡ºç»™æµè§ˆå™¨æ—¶ä½¿ç”¨çš„ï¼š 12boolean canWrite(Class&lt;?&gt; var1, @Nullable MediaType var2);void write(T var1, @Nullable MediaType var2, HttpOutputMessage var3) 123456789//ä¾‹å¦‚å¤„ç†å™¨æ–¹æ³•@RequestMapping(value = &quot;returnObject.do&quot;)public Student returnVoidAjax(HttpServletResponse response, String name, Integer age) throws IOException &#123; Student student = new Student(); student.setName(name); student.setAge(age); return student;&#125; 123451)canWrite:ä½œç”¨æ£€æŸ¥å¤„ç†å™¨æ–¹æ³•çš„è¿”å›žå€¼ï¼Œèƒ½ä¸èƒ½è½¬ä¸ºvar2è¡¨ç¤ºçš„æ•°æ®æ ¼å¼ã€‚æ£€æŸ¥student(name, age)èƒ½ä¸èƒ½è½¬ä¸ºvar2è¡¨ç¤ºçš„æ•°æ®æ ¼å¼ï¼Œå¦‚æžœæ£€æŸ¥èƒ½è½¬æˆjsonï¼Œè¿”å›žtrueMediaTypeï¼šè¡¨ç¤ºæ•°æ®æ ¼å¼çš„ï¼Œä¾‹å¦‚jsonã€xmlç­‰ç­‰StringHttpMessageConverterMappingJackson2HttpMessageConverter 122)write: æŠŠå¤„ç†å™¨æ–¹æ³•çš„è¿”å›žå€¼å¯¹è±¡ï¼Œè°ƒç”¨jacksonä¸­çš„ObjectMapperè½¬ä¸ºjsonå­—ç¬¦ä¸²json = om.writeValueAsString(student); æœªåŠ å…¥æ³¨è§£é©±åŠ¨æ—¶çš„çŠ¶æ€ï¼š 12&lt;!--åŠ å…¥&lt;mvc:annotation-driven&gt; æ³¨è§£é©±åŠ¨--&gt;&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt; è‡ªåŠ¨å®žä¾‹åŒ–MessageConverter4ä¸ªå®žçŽ°ç±» 12org.springframework.http.converter.ByteArrayHttpMessageConverter, org.springframework.http.converter.StringHttpMessageConverter, org.springframework.http.converter.xml.SourceHttpMessageConverter, org.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter åŠ å…¥æ³¨è§£é©±åŠ¨æ—¶çš„çŠ¶æ€ï¼š è‡ªåŠ¨å®žä¾‹åŒ–MessageConverter7ä¸ªå®žçŽ°ç±» 123org.springframework.http.converter.ByteArrayHttpMessageConverter, org.springframework.http.converter.StringHttpMessageConverter, **org.springframework.http.converter.ResourceHttpMessageConverter,** **org.springframework.http.converter.ResourceRegionHttpMessageConverter,** org.springframework.http.converter.xml.SourceHttpMessageConverter, org.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter, **org.springframework.http.converter.json.MappingJackson2HttpMessageConverter** 2.11.7 ä¹±ç é—®é¢˜é€šè¿‡è¯·æ±‚è¿‡æ¥mappingè®¾ç½®å“åº”å¤´ 1@RequestMapping(value = &quot;returnString.do&quot;, produces = &quot;text/plain;charset=utf-8&quot;) è®¾ç½®å‰ï¼ˆé»˜è®¤ï¼‰ è®¾ç½®åŽï¼š 2.12 RESTFul é£Žæ ¼RESTé£Žæ ¼ï¼šè½¯ä»¶ç¼–ç¨‹é£Žæ ¼ Springmvc: GET : æŸ¥ POST: å¢ž DELETE : åˆ  PUT : æ”¹ æ™®é€šæµè§ˆå™¨ åªæ”¯æŒget / post æ–¹å¼è¯·æ±‚ï¼Œ å…¶ä»–è¯·æ±‚æ–¹å¼ å¦‚ delete / put éœ€å€ŸåŠ©è¿‡æ»¤å™¨ è¿‡æ»¤å™¨çš„çº¦å®šï¼š è¿‡æ»¤çš„æ˜¯inputæ ‡ç­¾ï¼› æ ‡ç­¾ä¸­ç±»åž‹ä¸ºéšè—åŸŸï¼Œè€Œä¸”nameå¿…é¡»ä¸ºâ€_methodâ€œ è¯·æ±‚æ–¹å¼ä¸ºpost æ ¹æ®å…¶valueçš„å€¼æ¥åˆ¤æ–­ å¦‚æžœvalueä¸ºdelete åˆ™å°†è¯·æ±‚æ”¹ä¸ºdeleteï¼Œå¦‚æžœä¸ºputï¼Œæ”¹ä¸ºput ä¸æŒ‡å®šæ–¹æ³•è¯·æ±‚æ–¹å¼ï¼Œé»˜è®¤ä¸ºget ä½¿ç”¨restfulé£Žæ ¼æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨å…¶ä»–æ–¹å¼ä¼ å‚ï¼Œæ¯”å¦‚â€?id=1â€œï¼Œä¸å»ºè®®æ··åˆä½¿ç”¨restfulå’Œä¸€èˆ¬æ–¹å¼ï¼Œå³ä½¿å¯ä»¥ä½¿ç”¨ anté£Žæ ¼çš„è¯·æ±‚è·¯å¾„ï¼š ï¼Ÿï¼šå•å­—ç¬¦ *ï¼š ä»»æ„å­—ç¬¦ï¼ˆ0æˆ–å¤šä¸ªï¼‰ **ï¼š ä»»æ„ç›®å½• 2.12.1 Get123&lt;form action=&quot;handler/testRest/1234&quot; method=&quot;get&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;get&quot;&gt;&lt;/form&gt; 123456@RequestMapping(value = &quot;testRest/&#123;id&#125;&quot;, method = RequestMethod.GET)public String welcome4(@PathVariable(&quot;id&quot;) Integer id) &#123; System.out.println(&quot;get: æ”¹&quot; + id); return &quot;success&quot;;&#125; 2.12.2 Post1234&lt;form action=&quot;handler/testPost/1234&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;POST&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;post&quot;&gt;&lt;/form&gt; 123456@RequestMapping(value = &quot;testRest/&#123;id&#125;&quot;, method = RequestMethod.POST)public String welcome1(@PathVariable(&quot;id&quot;) Integer id) &#123; System.out.println(&quot;post: å¢ž&quot; + id); return &quot;success&quot;;&#125; 2.12.3 Delete1234&lt;form action=&quot;handler/testDelete/1234&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;DELETE&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;post&quot;&gt;&lt;/form&gt; 123456@RequestMapping(value = &quot;testRest/&#123;id&#125;&quot;, method = RequestMethod.DELETE)public String welcome2(@PathVariable(&quot;id&quot;) Integer id) &#123; System.out.println(&quot;delete: åˆ &quot; + id); return &quot;success&quot;;&#125; 2.12.4 Put1234&lt;form action=&quot;handler/testPut/1234&quot;&gt; &lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;post&quot;&gt;&lt;/form&gt; 123456@RequestMapping(value = &quot;testRest/&#123;id&#125;&quot;, method = RequestMethod.PUT)public String welcome3(@PathVariable(&quot;id&quot;) Integer id) &#123; System.out.println(&quot;put: æ”¹&quot; + id); return &quot;success&quot;;&#125; 2.12.5 å£°æ˜Žéšè—åŸŸè¿‡æ»¤å™¨12345678&lt;filter&gt; &lt;filter-name&gt;hiddenHttpMethodFilter&lt;/filter-name&gt; &lt;filter-class&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;hiddenHttpMethodFilter&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt; ç‰ˆæœ¬ï¼š 1.tomcat7ç‰ˆæœ¬åŠä»¥ä¸‹ï¼Œtomcaté»˜è®¤ä¸æ”¯æŒRESTfulé£Žæ ¼çš„DELETEå’ŒPUT, é…ç½®è¿‡æ»¤å™¨åŽtomcatå°±å¯ä»¥è®¿é—®äº† 2.tomcat8ç‰ˆæœ¬å³ä»¥ä¸Šï¼Œé…ç½®è¿‡æ»¤å™¨åŽï¼Œæ‰§è¡Œè¡¨å•åŽä¼šè·³è½¬åˆ°405é¡µé¢ï¼Œè¯´æ˜Žé«˜ç‰ˆæœ¬çš„tomcatæ˜¯ä¸æ”¯æŒRESTfulé£Žæ ¼ æ–¹æ³•ï¼šåœ¨è·³è½¬æˆåŠŸçš„jspé¡µé¢ï¼Œæ·»åŠ é”™è¯¯é¡µé¢å‚æ•°isErrorPage=â€œtrueâ€ ä¸é…ç½®è¿‡æ»¤å™¨é»˜è®¤æ˜¯æ”¯æŒRESTfulé£Žæ ¼ï¼Œä¹Ÿå°±æ˜¯ä¸ç”¨è‡ªå·±é…ç½®è¿‡æ»¤å™¨ 3. SSM æ•´åˆå¼€å‘3.1 Spring å®¹å™¨å’ŒSpringMVC å®¹å™¨ä¾èµ–åŒ…ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&lt;dependency&gt; &lt;groupId&gt;javax.servlet&lt;/groupId&gt; &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt; &lt;artifactId&gt;jsp-api&lt;/artifactId&gt; &lt;version&gt;2.2.1-b03&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt; &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-tx&lt;/artifactId&gt; &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt; &lt;version&gt;5.2.5.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-core&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt; &lt;version&gt;1.3.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.9&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid&lt;/artifactId&gt; &lt;version&gt;1.1.12&lt;/version&gt;&lt;/dependency&gt; å¦åŠ ï¼šç”¨äºŽæ³¨è§£@Resource 12345&lt;dependency&gt; &lt;groupId&gt;javax.annotation&lt;/groupId&gt; &lt;artifactId&gt;jsr250-api&lt;/artifactId&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;/dependency&gt; 123456789101112&lt;!--buildä¸­æ·»åŠ ä»¥ä¸‹ï¼ŒæŠŠjavaä¸‹çš„xmlæ–‡ä»¶é…ç½®ä¸€èµ·æ‰“åŒ…åˆ°targetä¸­--&gt;&lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;/resource&gt; &lt;/resources&gt;&lt;/build&gt; å¦‚æžœxmlæ–‡ä»¶å†™åœ¨ä¸ŽdaoåŒåŒ…åä¸‹çš„javaèµ„æºä¸­ï¼Œåˆ™éœ€è¦ä»¥ä¸ŠbuildæŒ‡å®šxmlåˆ°æ‰“åŒ…åˆ°targetï¼Œå¦åˆ™å°†æŠ¥é”™--Request processing failed; nested exception is org.apache.ibatis.binding.BindingException:mybatiså’Œmapperç»‘å®šå¤±è´¥ å¦‚æžœxmlæ–‡ä»¶å†™åœ¨resourcesä¸­ï¼Œåˆ™åªéœ€æ–°å»ºåŒåŒ…åçš„xmlå³å¯ 3.2 æ•´åˆå†…ç½® tomcatä¸ºä»€ä¹ˆè¦æ•´åˆå†…ç½®tomcat? å†…ç½®tomcatå¯ä»¥åœ¨åˆ«äººéƒ¨ç½²é¡¹ç›®æ—¶ä¸ç”¨çº ç»“åˆ°ä½¿ç”¨tomcatç‰ˆæœ¬çš„é—®é¢˜ å³å¯ä»¥åœ¨æ²¡æœ‰tomcatçŽ¯å¢ƒä¸‹ä½¿ç”¨ æ­¥éª¤ï¼š 1.å¯¼å…¥ä¾èµ– 123456789101112131415&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt; &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;port&gt;8080&lt;/port&gt; &lt;server&gt;tomcat7&lt;/server&gt; &lt;path&gt;/&lt;/path&gt; &lt;useBodyEncodingForURI&gt;true&lt;/useBodyEncodingForURI&gt; &lt;uriEncoding&gt;UTF-8&lt;/uriEncoding&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; æ‰‹åŠ¨é…ç½®mavenå¯åŠ¨å†…ç½®tomcat æœ€åŽç›´æŽ¥è¿è¡Œå³å¯ 3.3 xml é…ç½®1.dispatcherServlet.xml : ä¸­å¤®è°ƒåº¦å™¨ ï¼ˆ1ï¼‰å£°æ˜Žæ³¨è§£@controlleræ‰€åœ¨åŒ…çš„æ‰«æå™¨ï¼› ï¼ˆ2ï¼‰å†…éƒ¨èµ„æºè§†å›¾è§£æžå™¨ï¼› ï¼ˆ3ï¼‰å£°æ˜Žmvcæ³¨è§£é©±åŠ¨ï¼› 2.applicationContext.xml : springIOCå®¹å™¨ ï¼ˆ1ï¼‰å£°æ˜Ždb.propertiesæ‰€åœ¨ä½ç½®ï¼› ï¼ˆ2ï¼‰å£°æ˜Žæ•°æ®æºï¼› ï¼ˆ3ï¼‰å£°æ˜ŽSqlSessionFactoryBean,åˆ›å»ºSqlSessionFactoryï¼› ï¼ˆ4ï¼‰å£°æ˜Žmapperæ‰€åœ¨åŒ…æ‰«æå™¨ï¼Œè‡ªåŠ¨åˆ›å»ºdaoå¯¹è±¡ï¼› ï¼ˆ5ï¼‰å£°æ˜Žæ³¨è§£@Serviceæ‰€åœ¨åŒ…çš„æ‰«æå™¨ 3.mybatiis.xml : mybatiså®¹å™¨ ï¼ˆ1ï¼‰å£°æ˜Žåˆ«å ï¼ˆ2ï¼‰æŒ‚è½½æ‰€æœ‰mapperé…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶çš„è·¯å¾„é»˜è®¤åœ¨resourcesä¸‹ï¼ˆpomæ²¡æœ‰å£°æ˜Žjavaä¸­å¯¹xmlæ–‡ä»¶çš„æ‰“åŒ…ï¼‰ 4.mapper.xml : mapperå®¹å™¨ ï¼ˆ1ï¼‰é…ç½®namespace,ç”¨äºŽç»‘å®šDaoæŽ¥å£çš„ï¼Œå³é¢å‘æŽ¥å£ç¼–ç¨‹ ï¼ˆ2ï¼‰å¢žåˆ æŸ¥æ”¹æ ‡ç­¾ 3.4 Ajax è¯·æ±‚123456789101112131415161718192021222324252627282930313233343536&lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.5.1.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt; $(function()&#123; loadStudentData(); $(&quot;#btnLoader&quot;).click(function ()&#123; loadStudentData(); &#125;)&#125;)function loadStudentData()&#123; $.ajax(&#123; url:&quot;student/queryStudents.do&quot;, type:&quot;post&quot;, dataType:&quot;json&quot;, success:function (data)&#123; $(&quot;#info&quot;).html(&quot;&quot;); $.each(data, function(i,n)&#123; $(&quot;#info&quot;).append(&quot;&lt;tr&gt;&quot;) .append(&quot;&lt;td&gt;&quot; + n.id + &quot;&lt;/td&gt;&quot;) .append(&quot;&lt;td&gt;&quot; + n.name + &quot;&lt;/td&gt;&quot;) .append(&quot;&lt;td&gt;&quot; + n.age + &quot;&lt;/td&gt;&quot;) .append(&quot;&lt;/tr&gt;&quot;) &#125;); &#125; &#125;);&#125;&lt;/script&gt; 3.5 ä¸‰å±‚æ•´åˆ3.5.1 Controller12345678910111213141516171819202122232425262728293031323334353637@Controller@RequestMapping(value = &quot;/student&quot;)public class StudentController &#123; @Resource private IStudentService studentService; //æ³¨å†Œå­¦ç”Ÿ @RequestMapping(value = &quot;/addStudent.do&quot;) public ModelAndView addStudent(Student student)&#123; ModelAndView mv = new ModelAndView(); String tips = &quot;æ³¨å†Œå¤±è´¥&quot;; int nums = studentService.addStudent(student); if(nums &gt; 0)&#123; //æ³¨å†ŒæˆåŠŸ tips = &quot;å­¦ç”Ÿã€&quot; + student.getName() + &quot;ã€‘æ³¨å†ŒæˆåŠŸ&quot;; &#125; //æ·»åŠ æ•°æ® mv.addObject(&quot;tips&quot;, tips); //æŒ‡å®šç»“æžœé¡µé¢ mv.setViewName(&quot;result&quot;); return mv; &#125; @RequestMapping(value = &quot;/queryStudents.do&quot;) @ResponseBody public List&lt;Student&gt; queryStudents()&#123; List&lt;Student&gt; students = studentService.findStudents(); System.out.println(students); return students; &#125;&#125; 3.5.2 Service12345678910111213141516171819202122232425262728293031323334353637@Controller@RequestMapping(value = &quot;/student&quot;)public class StudentController &#123; @Resource private IStudentService studentService; //æ³¨å†Œå­¦ç”Ÿ @RequestMapping(value = &quot;/addStudent.do&quot;) public ModelAndView addStudent(Student student)&#123; ModelAndView mv = new ModelAndView(); String tips = &quot;æ³¨å†Œå¤±è´¥&quot;; int nums = studentService.addStudent(student); if(nums &gt; 0)&#123; //æ³¨å†ŒæˆåŠŸ tips = &quot;å­¦ç”Ÿã€&quot; + student.getName() + &quot;ã€‘æ³¨å†ŒæˆåŠŸ&quot;; &#125; //æ·»åŠ æ•°æ® mv.addObject(&quot;tips&quot;, tips); //æŒ‡å®šç»“æžœé¡µé¢ mv.setViewName(&quot;result&quot;); return mv; &#125; @RequestMapping(value = &quot;/queryStudents.do&quot;) @ResponseBody public List&lt;Student&gt; queryStudents()&#123; List&lt;Student&gt; students = studentService.findStudents(); System.out.println(students); return students; &#125;&#125; 3.5.3 Dao1234567public interface StudentDao &#123; int insertStudent(Student student); List&lt;Student&gt; selectStudents();&#125; 3.5.4 xml12345678910111213141516171819202122&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;&lt;!-- namespace :è¯¥mapper.xmlçš„ å”¯ä¸€æ ‡è¯†ç”¨äºŽç»‘å®šDaoæŽ¥å£çš„ï¼Œå³é¢å‘æŽ¥å£ç¼–ç¨‹--&gt;&lt;mapper namespace=&quot;org.zhkucst.dao.StudentDao&quot;&gt; &lt;!-- åŽç»­é€šè¿‡ namespace.id --&gt; &lt;!-- parameterType:è¾“å…¥å‚æ•°çš„ç±»åž‹ resultType:æŸ¥è¯¢è¿”å›žå€¼çš„ç±»åž‹ï¼Œè¿”å›žç±»åž‹ --&gt; &lt;select id=&quot;selectStudents&quot; resultType=&quot;student&quot;&gt; select id, name, age from student &lt;/select&gt; &lt;insert id=&quot;insertStudent&quot; parameterType=&quot;student&quot;&gt; insert into student(name,age) values(#&#123;name&#125;,#&#123;age&#125;) &lt;/insert&gt;&lt;/mapper&gt; 3.5.5å‰ç«¯index.jsp 1234567891011121314151617181920212223242526272829303132&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;%String basePath = request.getScheme() + &quot;://&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + request.getContextPath() + &quot;/&quot;;%&gt;&lt;html&gt; &lt;head&gt; &lt;base href=&quot;&lt;%=basePath%&gt;/&quot;&gt; &lt;title&gt;åŠŸèƒ½å…¥å£&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align=&quot;center&quot;&gt; &lt;p&gt;SSMæ•´åˆ&lt;/p&gt; &lt;img src=&quot;imges/ssm.jpg&quot;/&gt; &lt;table&gt; &lt;tr&gt; &lt;td&gt;&lt;a href=&quot;addStudent.jsp&quot;&gt;æ³¨å†Œå­¦ç”Ÿ&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&lt;a href=&quot;listStudent.jsp&quot;&gt;æµè§ˆå­¦ç”Ÿ&lt;/a&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt; addStudent.jsp 123456789101112131415161718192021222324252627282930313233&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;%String basePath = request.getScheme() + &quot;://&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + request.getContextPath() + &quot;/&quot;;%&gt;&lt;html&gt; &lt;head&gt; &lt;base href=&quot;&lt;%=basePath%&gt;/&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align=&quot;center&quot;&gt; &lt;form action=&quot;student/addStudent.do&quot; method=&quot;post&quot;&gt; &lt;table&gt; &lt;tr&gt; &lt;td&gt;å§“å&lt;/td&gt; &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;å¹´é¾„&lt;/td&gt; &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;age&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/td&gt; &lt;td&gt;&lt;input type=&quot;submit&quot; value=&quot;æ³¨å†Œ&quot;&gt;&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/form&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt; listStudent.jsp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;%String basePath = request.getScheme() + &quot;://&quot; + request.getServerName() + &quot;:&quot; + request.getServerPort() + request.getContextPath() + &quot;/&quot;;%&gt;&lt;html&gt; &lt;head&gt; &lt;base href=&quot;&lt;%=basePath%&gt;/&quot;&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;js/jquery-3.5.1.js&quot;&gt;&lt;/script&gt; &lt;script type=&quot;text/javascript&quot;&gt; $(function()&#123; loadStudentData(); $(&quot;#btnLoader&quot;).click(function ()&#123; loadStudentData(); &#125;) &#125;) function loadStudentData()&#123; $.ajax(&#123; url:&quot;student/queryStudents.do&quot;, type:&quot;post&quot;, dataType:&quot;json&quot;, success:function (data)&#123; $(&quot;#info&quot;).html(&quot;&quot;); $.each(data, function(i,n)&#123; $(&quot;#info&quot;).append(&quot;&lt;tr&gt;&quot;) .append(&quot;&lt;td&gt;&quot; + n.id + &quot;&lt;/td&gt;&quot;) .append(&quot;&lt;td&gt;&quot; + n.name + &quot;&lt;/td&gt;&quot;) .append(&quot;&lt;td&gt;&quot; + n.age + &quot;&lt;/td&gt;&quot;) .append(&quot;&lt;/tr&gt;&quot;) &#125;); &#125; &#125;); &#125; &lt;/script&gt; &lt;title&gt;Title&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div align=&quot;center&quot;&gt; &lt;table style=&quot;border:1px solid&quot;&gt; &lt;thead style=&quot;border:1px solid&quot;&gt; &lt;tr&gt; &lt;td&gt;å­¦å·&lt;/td&gt; &lt;td&gt;å§“å&lt;/td&gt; &lt;td&gt;å¹´é¾„&lt;/td&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody id=&quot;info&quot; style=&quot;border:1px solid&quot;&gt; &lt;/tbody&gt; &lt;/table&gt; &lt;input id=&quot;btnLoader&quot; type=&quot;button&quot; value=&quot;æŸ¥è¯¢æ•°æ®&quot;&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt; result.jsp 12345678910111213&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt; result.jps ç»“æžœé¡µé¢ æ³¨å†Œç»“æžœï¼š$&#123;tips&#125;&lt;/body&gt;&lt;/html&gt; 4. è½¬å‘å’Œé‡å®šå‘4.1 è½¬å‘è½¬å‘å’Œé‡å®šå‘æ˜¯ä¸å—è§†å›¾è§£æžå™¨å½±å“çš„ï¼Œå°±å½“æ²¡æœ‰è§†å›¾è§£æžå™¨ controller 1234567891011@RequestMapping(value = &quot;doForward.do&quot;)public ModelAndView doForward()&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;æ¬¢è¿Žä½¿ç”¨springmvcwebå¼€å‘&quot;); mv.addObject(&quot;fun&quot;, &quot;æ‰§è¡Œçš„æ˜¯dodoForwardæ–¹æ³•&quot;); mv.setViewName(&quot;forward:/WEB-INF/view/show.jsp&quot;); return mv;&#125; æ€»ç»“ï¼š 1.è½¬å‘å¯ä»¥è®¿é—®/WEB-INF/ç›®å½•ä¸‹çš„è§†å›¾ä»¥åŠå…¶ä»–æ–‡ä»¶ 2.è½¬å‘å¦‚æžœæºå¸¦äº†æ•°æ®ï¼ˆè¯·æ±‚æ˜¯å®žä¾‹åŒ–åœ¨æœåŠ¡å™¨ä¸­ï¼Œæ•°æ®ä¿å­˜åœ¨è¯¥requestä¸­ï¼‰ å¯ä»¥åœ¨å…¶ä»–è§†å›¾ä¸­è§†å›¾ELè¡¨è¾¾å¼$&#123;requestScope.name&#125;èŽ·å–å±žæ€§å€¼ä¸ºâ€œnameâ€çš„å€¼ 3.ä¹Ÿå¯ä»¥é€šè¿‡request.getAttribute(&quot;name&quot;)èŽ·å–ï¼Œä¸¤è€…ç­‰ä»· 4.2 é‡å®šå‘controller 1234567891011@RequestMapping(value = &quot;doRedirect.do&quot;)public ModelAndView doRedirect(String name, Integer age)&#123; ModelAndView mv = new ModelAndView(); mv.addObject(&quot;myname&quot;, name); mv.addObject(&quot;myage&quot;, age); mv.setViewName(&quot;redirect:/hello.jsp&quot;); return mv;&#125; 2.è§†å›¾ï¼š 123456&lt;body&gt; &lt;h3&gt;hello.jsp&lt;/h3&gt; &lt;h3&gt;mynameæ•°æ®1ï¼š$&#123;param.myname&#125;&lt;/h3&gt; &lt;h3&gt;myageæ•°æ®2ï¼š$&#123;param.myage&#125;&lt;/h3&gt; &lt;h3&gt;myageæ•°æ®2ï¼š&lt;%=request.getParameter(&quot;myname&quot;)%&gt;&lt;/h3&gt;&lt;/body&gt; æ€»ç»“ï¼š 1.é‡å®šå‘æ˜¯ç¬¬äºŒæ¬¡è¯·æ±‚è½¬å‘ï¼Œè¯·æ±‚çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œä¸ä¼šä¿ç•™åœ¨æœåŠ¡å™¨çš„requestä¸­ï¼Œæ˜¯æ‹¿äº†ä¸€ä¸ªæ–°çš„è¯·æ±‚ 2.é‡å®šå‘å¦‚æžœæºå¸¦äº†æ•°æ®ï¼Œæºå¸¦çš„æ•°æ®ä¸æ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œè€Œæ˜¯åœ¨æ–°çš„è¯·æ±‚çš„å½¢å‚ä¸­ï¼Œä¾‹å¦‚ï¼šhttp://locahost:8080/MyProject?name=zs 3.é‡å®šå‘åˆ°æ–°çš„è§†å›¾ä¸­ï¼Œå¯ä»¥é€šè¿‡$&#123;param.name&#125;èŽ·å–å½¢å‚ä¸­çš„å˜é‡å€¼ï¼Œæ³¨æ„ï¼Œåªèƒ½èŽ·å–4ä¸ªåŸºæœ¬ç±»åž‹+Stringï¼Œ å…¶ä»–ç±»åž‹ä¼šä»¥åœ°å€@***æ˜¾ç¤º 4.ä¹Ÿå¯ä»¥é€šè¿‡request.getParameter(â€œnameâ€)èŽ·å–å±žæ€§å€¼ä¸ºâ€œnameâ€çš„å€¼ 5.æ³¨æ„ï¼Œé€šè¿‡è§†å›¾ä¼ åˆ°æŽ§åˆ¶å™¨ï¼Œå†é‡å®šå‘çš„ï¼Œè§†å›¾ä¸­çš„å‚æ•°å€¼æ˜¯èŽ·å–ä¸åˆ°çš„ï¼Œä¸¤ä¸ªè¯·æ±‚ä¸ä¸€æ ·ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚ ç»“æŸåŽå·²ç»è‡ªåŠ¨é”€æ¯ 4.3 eé¢å¤–çŸ¥è¯†1234$&#123;param.name&#125; == request.getParameter(&quot;name&quot;)$&#123;requestScope.name&#125; == request.getAttribute(&quot;name&quot;)$&#123;sessionScope.name&#125; == session.getAttribute(&quot;name&quot;)$&#123;applicationScope.name&#125; == application.getAttribute(&quot;name&quot;) sessionå’Œapplicatonå¦‚æžœè¦åœ¨åŒä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œå¯ä»¥é€šè¿‡request.getSession()å’Œ request.getSession().getServletContext()èŽ·å–å¾—åˆ° å¦‚æžœåœ¨åŒä¸€è§†å›¾ï¼Œç›´æŽ¥appliction.setAttribute()ã€session.setAttribute()å°±å¯ä»¥äº† 5. é›†ä¸­ç»Ÿä¸€å¤„ç†å¼‚å¸¸5.1 ç†è®ºå¼‚å¸¸å¤„ç†ï¼š é€šè¿‡æ³¨è§£å®žçŽ°å¼‚å¸¸ç»Ÿä¸€å¤„ç†ï¼š@ExceptionHandler springmvcæ¡†æž¶é‡‡ç”¨çš„æ˜¯ç»Ÿä¸€ã€å…¨å±€çš„å¼‚å¸¸å¤„ç†ã€‚ æŠŠcontrollerä¸­çš„æ‰€æœ‰å¼‚å¸¸å¤„ç†éƒ½é›†ä¸­åˆ°ä¸€ä¸ªåœ°æ–¹ã€‚é‡‡ç”¨çš„æ˜¯aopçš„æ€æƒ³ï¼ŒæŠŠä¸šåŠ¡é€»è¾‘å’Œå¼‚å¸¸å¤„ç†ä»£ç åˆ†å¼€ï¼Œè§£è€¦åˆã€‚ ä½¿ç”¨ä¸¤ä¸ªæ³¨è§£ @ExceptionHandler @ControllerAdvice 123456789101112å¼‚å¸¸å¤„ç†æ­¥éª¤ï¼š1.æ–°å»ºmaven webé¡¹ç›®2.åŠ å…¥ä¾èµ–3.æ–°å»ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ç±» MyUserException , å†å®šä¹‰å®ƒçš„å­ç±»NameException, AgeException4.åœ¨controlleræŠ›å‡ºNameException , AgeException5.åˆ›å»ºä¸€ä¸ªæ™®é€šç±»ï¼Œä½œç”¨å…¨å±€å¼‚å¸¸å¤„ç†ç±» 1)åœ¨ç±»çš„ä¸Šé¢åŠ å…¥@controllerAdvice 2)åœ¨ç±»ä¸­å®šä¹‰æ–¹æ³•ï¼Œæ–¹æ³•çš„ä¸Šé¢åŠ å…¥@ExceptionHandle6.åˆ›å»ºspringmvcçš„é…ç½®æ–‡ä»¶ 1)ç»„ä»¶æ‰«æå™¨ï¼Œæ‰«æ@Controlleræ³¨è§£ 2)ç»„ä»¶æ‰«æå™¨ï¼Œæ‰«æ@ControllerAdviceæ‰€åœ¨çš„åŒ…å 3)å£°æ˜Žæ³¨è§£é©±åŠ¨ ç»“æžœå›¾ï¼š åŽŸç†ï¼š è‡ªå®šä¹‰æ™®é€šç±»ï¼Œé€šè¿‡ç»§æ‰¿Exceptionä½¿å®ƒæˆä¸ºå¼‚å¸¸ç±»ï¼Œç„¶åŽå†ç”¨æ³¨è§£è®©springmvcå¯¹å®ƒç®¡ç†ï¼š å‘ç”Ÿå¼‚å¸¸ï¼Œæœ‰springmvcæ¥æŠ›å¼‚å¸¸ï¼Œä¸äº¤ç»™jvmè™šæ‹Ÿæœº æ€»ç»“ï¼š å¦‚æžœæœ‰æ–¹æ³•æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¯¹è¯¥å¼‚å¸¸çš„å¤„ç†æœ‰ä¸¤ç§æ–¹æ³•ï¼Œåˆ™ä¼˜å…ˆçº§ï¼šæœ€çŸ­ä¼˜å…ˆ å¦‚æžœä¸€ä¸ªæ–¹æ³•ç”¨äºŽå¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”åªå¤„ç†å½“å‰ç±»ä¸­çš„å¼‚å¸¸ï¼š@ExceptionHandler å¦‚æžœä¸€ä¸ªæ–¹æ³•ç”¨äºŽå¤„ç†å¼‚å¸¸ï¼Œå¹¶ä¸”å¤„ç†æ‰€æœ‰ç±»ä¸­çš„å¼‚å¸¸ï¼Œç±»å‰åŠ @ControllerAdvice, å¤„ç†å¼‚å¸¸çš„æ–¹æ³•å‰åŠ @ExceptionHandler ä¼˜å…ˆçº§ï¼š ä½¿ç”¨@ExceptionHandlerå¤„ç†æœ¬Controllerå†…éƒ¨å¼‚å¸¸ä¼˜å…ˆçº§æœ€é«˜ï¼› ä½¿ç”¨@ExceptionHandler+@ControllerAdviceå¤„ç†å¤–éƒ¨Controllerå¼‚å¸¸ä¼˜å…ˆçº§ç¬¬äºŒï¼› è‡ªå®šä¹‰å®žçŽ°HandlerExceptionResolveræŽ¥å£çš„ç±»ä¼˜å…ˆçº§ç¬¬ä¸‰ï¼› spring-context.xmlä¸­é…ç½®SimpleMappingExceptionResolverä¼˜å…ˆçº§ç¬¬å››ï¼› web.xmlé…ç½®error-pageä¼˜å…ˆçº§ç¬¬äº”ï¼› ä¸åšä»»ä½•å¤„ç†ï¼Œä¼šè·³è½¬åˆ°tomcaté»˜è®¤çš„å¼‚å¸¸é¡µé¢ï¼› è‡ªå®šä¹‰å¼‚å¸¸æ˜¾ç¤ºé¡µé¢ï¼š@ResponseStatus ResponseStatusExceptionResolver:è‡ªå®šä¹‰å¼‚å¸¸æ˜¾ç¤ºé¡µé¢ @ResponseStatus è‡ªå®šä¹‰å¼‚å¸¸æ˜¾ç¤ºé¡µé¢ï¼š@ResponseStatus(value=HttpStatus.FORBIDDEN, reason=&quot;æ•°ç»„è¶Šç•Œ222&quot;) 123@public class MyArrayIndexOutofBoundsException extends Exception&#123;//è‡ªå®šä¹‰å¼‚å¸¸ç±»&#125; @ResponseStatusä¹Ÿå¯ä»¥æ ‡æ³¨åœ¨æ–¹æ³•å‰ï¼š è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼š 1234@ResponseStatus(value = HttpStatus.FORBIDDEN, reason = &quot;æ•°ç»„è¶Šç•Œ222&quot;)public class MyArrayIndexOutofBoundException extends Exception&#123; &#125; å¼‚å¸¸å¤„ç†çš„å®žçŽ°ç±»ï¼šDefaultHandleExceptionResolver DefaultHandleExceptionResolver:SpringMVCä¸€äº›å¸¸è§å¼‚å¸¸çš„åŸºç¡€ä¸Šï¼ˆ300,500,405ï¼‰ï¼Œæ–°å¢žä¸€äº›å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼š 1234567891011121314* @since 3.0* @see org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler* @see #handleNoSuchRequestHandlingMethod* @see #handleHttpRequestMethodNotSupported ï¼š å¦‚æžœè¯·æ±‚é™åˆ¶ä¸ºpostï¼Œå®žé™…è¯·æ±‚ä¸ºgetï¼Œåˆ™ä¼šè§¦å‘æ­¤å¼‚å¸¸* @see #handleHttpMediaTypeNotSupported* @see #handleMissingServletRequestParameter* @see #handleServletRequestBindingException* @see #handleTypeMismatch* @see #handleHttpMessageNotReadable* @see #handleHttpMessageNotWritable* @see #handleMethodArgumentNotValidException* @see #handleMissingServletRequestParameter* @see #handleMissingServletRequestPartException* @see #handleBindException è¿™äº›å®žçŽ°äº†æ¡†æž¶å·²ç»å®žçŽ°äº†ï¼Œåªè¦å‡ºçŽ°è¯¥å¼‚å¸¸å°±ä¼šè§¦å‘ é€šè¿‡é…ç½®å®žçŽ°å¼‚å¸¸å¤„ç†ï¼šSimpleMappingExceptionResolver é…ç½®ï¼š 1234567891011&lt;!-- SimpleMappingExceptionResolver:ä»¥é…ç½®çš„æ–¹å¼å¤„ç†å¼‚å¸¸ --&gt;&lt;bean class=&quot;org.springframework.web.servlet.handler.SimpleMappingExceptionResolver&quot;&gt; &lt;!-- å¯ä»¥çœç•¥ï¼Œé»˜è®¤å€¼ä¸ºexception --&gt; &lt;property name=&quot;exceptionAttribute&quot; value=&quot;ex&quot;&gt;&lt;/property&gt; &lt;property name=&quot;exceptionMappings&quot;&gt; &lt;props&gt; &lt;!-- ç›¸å½“äºŽcatch(ArithmeticException ex)&#123;è·³è½¬:error&#125; --&gt; &lt;prop key=&quot;java.lang.ArithmeticException&quot;&gt;error&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt;&lt;/bean&gt; æŽ§åˆ¶å™¨ï¼š 12345@RequestMapping(value = &quot;testSimpleMappingException&quot;)public String testSimpleMappingException() &#123; System.out.println(1/0);//ArithmeticException return &quot;success&quot;;&#125; ä¸¤ç§æ–¹å¼å¼‚å¸¸æ€»ç»“ï¼š 1.é€šè¿‡ç»§æ‰¿+æ³¨è§£@ExceptionHandlerç»Ÿä¸€å¤„ç†å¼‚å¸¸ 2.é€šè¿‡é…ç½®å®žçŽ°å¼‚å¸¸å¤„ç†ï¼Œä¸Ž1æ— å¼‚ 3.1å’Œ2åŒæ—¶å®žçŽ°ï¼ŒåŒç§å¼‚å¸¸åªç”±1æ•èŽ·ï¼Œå³1ä¼˜å…ˆçº§é«˜äºŽ2 5.2 å…¨å±€å¼‚å¸¸å¤„ç†ç±»å…¨å±€å¼‚å¸¸å¤„ç†ç±»ç›¸å½“äºŽä¸€ä¸ªæŽ§åˆ¶å™¨ï¼Œåªæ˜¯ä¹‹å‰çš„æŽ§åˆ¶å™¨æ˜¯æŽ§åˆ¶ç”¨æˆ·è¾“å…¥æ•°æ®å¤„ç†ï¼Œ è€Œå…¨å±€å¼‚å¸¸å¤„ç†ç±»æ˜¯æŽ§åˆ¶ç”¨æˆ·æ“ä½œå‡ºé”™å¤„ç†çš„æŽ§åˆ¶å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package org.zhkucst.handle;import org.springframework.web.bind.annotation.ControllerAdvice;import org.springframework.web.bind.annotation.ExceptionHandler;import org.springframework.web.servlet.ModelAndView;import org.zhkucst.exception.AgeException;import org.zhkucst.exception.NameException;/** * ControllerAdvice:æŽ§åˆ¶å™¨å¢žå¼ºï¼ˆç»™æŽ§åˆ¶å™¨è¯¶å¢žå¼ºåŠŸèƒ½ï¼Œå¼‚å¸¸å¤„ç†åŠŸèƒ½ï¼‰ * å®šä¹‰ï¼šåœ¨ç±»çš„ä¸Šé¢ * ç‰¹ç‚¹ï¼šå¿…é¡»è®©æ¡†æž¶æŒ‡å®šè¿™ä¸ªæ³¨è§£æ‰€åœ¨çš„åŒ…åï¼Œéœ€è¦åœ¨springmvcé…ç½®æ–‡ä»¶å£°æ˜Žç»„ä»¶æ‰«æå™¨ * æŒ‡å®š@ControllerAdviceæ‰€åœ¨çš„åŒ…å * */@ControllerAdvicepublic class GlobalExceptionHandler &#123; @ExceptionHandler(value = NameException.class) public ModelAndView doNameException(Exception exception)&#123; //å¤„ç†NameExceptionå¼‚å¸¸ ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;å§“åå¿…é¡»æ˜¯zsï¼Œå…¶ä»–ç”¨æˆ·ä¸èƒ½è®¿é—®&quot;); mv.addObject(&quot;ex&quot;,exception); mv.setViewName(&quot;nameError&quot;); return mv; &#125; @ExceptionHandler(value = AgeException.class) public ModelAndView doAgeException(Exception exception)&#123; //å¤„ç†NameExceptionå¼‚å¸¸ ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;ä½ çš„å¹´é¾„ä¸èƒ½å¤§é›¨80&quot;); mv.addObject(&quot;ex&quot;,exception); mv.setViewName(&quot;ageError&quot;); return mv; &#125; @ExceptionHandler public ModelAndView doOtherException(Exception exception)&#123; //å¤„ç†NameExceptionå¼‚å¸¸ ModelAndView mv = new ModelAndView(); mv.addObject(&quot;msg&quot;, &quot;å…¶ä»–é”™è¯¯!!&quot;); mv.addObject(&quot;ex&quot;,exception); mv.setViewName(&quot;defaultError&quot;); return mv; &#125;&#125; 5.3 è‡ªå®šä¹‰å…·ä½“å¤„ç†ç±»æ­¥éª¤ï¼š å†™ä¸€ä¸ªè‡ªå®šä¹‰çˆ¶ç±»ï¼Œç»§æ‰¿Exception å†åˆ†åˆ«å†™å…·ä½“çš„å¼‚å¸¸ç±» 1.MyUserException 123456789package org.zhkucst.exception;public class MyUserExcepton extends Exception&#123; public MyUserExcepton()&#123; super(); &#125; public MyUserExcepton(String message)&#123; super(message); &#125;&#125; 2.NameException 123456789package org.zhkucst.exception;public class NameException extends MyUserExcepton&#123; public NameException()&#123; super(); &#125; public NameException(String message)&#123; super(message); &#125;&#125; 3.AgeException 12345678package org.zhkucst.exception;public class AgeException extends MyUserExcepton&#123; public AgeException()&#123; &#125; public AgeException(String message)&#123; super(message); &#125;&#125; 5.4 å‰ç«¯1.nameError 12345&lt;body&gt; &lt;h3&gt;nameError.jsp&lt;/h3&gt; &lt;h3&gt;msgæ•°æ®ï¼š$&#123;msg&#125;&lt;/h3&gt; &lt;h3&gt;messageæ•°æ®ï¼š$&#123;ex.message&#125;&lt;/h3&gt;&lt;/body&gt; 2.ageError 12345&lt;body&gt; &lt;h3&gt;ageError.jsp&lt;/h3&gt; &lt;h3&gt;msgæ•°æ®ï¼š$&#123;msg&#125;&lt;/h3&gt; &lt;h3&gt;messageæ•°æ®ï¼š$&#123;ex.message&#125;&lt;/h3&gt;&lt;/body&gt; 3.defaultError 123456&lt;/head&gt;&lt;body&gt; &lt;h3&gt;defaultError.jsp&lt;/h3&gt; &lt;h3&gt;msgæ•°æ®ï¼š$&#123;msg&#125;&lt;/h3&gt; &lt;h3&gt;messageæ•°æ®ï¼š$&#123;ex.message&#125;&lt;/h3&gt;&lt;/body&gt; 5.5 å¤„ç†å™¨12345678910111213141516171819@RequestMapping(value = &quot;some.do&quot;)public ModelAndView doSome(String name, Integer age) throws MyUserExcepton &#123; ModelAndView mv = new ModelAndView(); if(!&quot;zs&quot;.equals(name))&#123; throw new NameException(&quot;å§“åä¸æ­£ç¡®ï¼ï¼&quot;); &#125; if(age == null || age &gt; 80)&#123; throw new AgeException(&quot;å¹´é¾„æ¯”è¾ƒå¤§ï¼ï¼&quot;); &#125; mv.addObject(&quot;myname&quot;, name); mv.addObject(&quot;myage&quot;, age); mv.setViewName(&quot;show&quot;); return mv;&#125; 6. æ‹¦æˆªå™¨6.1 *.do å’Œ *.action çš„è¯·æ±‚è°ƒåº¦è§„åˆ™ä¸ä»…ä»…åªæœ‰*.doå’Œ*.actionï¼Œè‡ªå®šä¹‰ä¹Ÿå¯ä»¥ 12345678910111213141516&lt;!-- springmvcçš„å‰ç«¯æŽ§åˆ¶å™¨ --&gt;&lt;servlet&gt; &lt;servlet-name&gt;tony-video-admin-mng&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt; &lt;!-- contextConfigLocationä¸æ˜¯å¿…é¡»çš„ï¼Œ å¦‚æžœä¸é…ç½®contextConfigLocationï¼Œ springmvcçš„é…ç½®æ–‡ä»¶é»˜è®¤åœ¨ï¼šWEB-INF/servletçš„name+&quot;-servlet.xml&quot; --&gt; &lt;init-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:spring/springmvc.xml&lt;/param-value&gt; &lt;/init-param&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;tony-video-admin-mng&lt;/servlet-name&gt; &lt;url-pattern&gt;*.action&lt;/url-pattern&gt;&lt;/servlet-mapping&gt; è¯·æ±‚æ–¹å¯ä»¥æ˜¯è§†å›¾ä¹Ÿå¯ä»¥æ˜¯æŽ§åˆ¶å™¨ 1.è¯·æ±‚æ–¹ä¸ºè§†å›¾ï¼š 2.è¯·æ±‚æ–¹ä¸ºæŽ§åˆ¶å™¨ï¼š é€šè¿‡&lt;jsp:forward page=&quot;$&#123;base&#125;/center.action&quot;&gt;&lt;/jsp:forward&gt; æˆ–é€šè¿‡formè¡¨å•è¯·æ±‚ï¼Œè¯·æ±‚çš„è¡¨å•actionå¯ä»¥ä¸å†™.actionï¼Œä½†æµè§ˆå™¨ç›´æŽ¥è¯·æ±‚éœ€è¦å†™åŽç¼€.actionï¼Œbaseå–å½“å‰é¡µé¢æ‰€åœ¨çš„è·¯å¾„ï¼Œç»è¿‡ä¸­å¤®è°ƒåº¦å™¨å¤„ç†åŽï¼Œå³ä¸Šé¢åœ¨web.xmlé…ç½®*.actionçš„æ‰€æœ‰è¯·æ±‚ç»™ä¸­å¤®è°ƒåº¦å™¨ï¼Œè§£æžå®ŒåŽå¦‚æžœæŽ§åˆ¶å™¨ä¸Šæœ‰é…ç½®requestMappingä¼šæ•æ‰ç»™æŽ§åˆ¶å™¨ï¼ŒæŽ§åˆ¶å™¨ä¸Šçš„requestMappingçš„valueå±žæ€§å¯ä»¥ä¸å†™.actionåŽç¼€ï¼Œè¿™æ˜¯ä¸­å¤®è°ƒåº¦å™¨çš„è§£æžåè®®ã€‚æ²¡æœ‰å°±ä¼šè½¬ç»™è§†å›¾ï¼Œæœ€åŽæ‰ä¼šæŠ¥404 6.2 æ‹¦æˆªå™¨çš„ä»‹ç» æ‹¦æˆªå™¨æ˜¯springmvcä¸­çš„ä¸€ç§ï¼Œéœ€è¦å®žçŽ°HandlerInterceptoræŽ¥å£ æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨ç±»ä¼¼ï¼ŒåŠŸèƒ½æ–¹å‘ä¾§é‡ç‚¹ä¸åŒ è¿‡æ»¤å™¨æ˜¯ç”¨æ¥è¿‡æ»¤è¯·æ±‚è¶…æ—¶ï¼Œè®¾ç½®ç¼–ç å­—ç¬¦é›†ç­‰å·¥ä½œï¼› æ‹¦æˆªå™¨æ˜¯æ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚ï¼Œå¯¹è¯·æ±‚åšåˆ¤æ–­å¤„ç†çš„ã€‚ æ‹¦æˆªå™¨æ˜¯å…¨å±€çš„ï¼Œå¯ä»¥å¯¹å¤šä¸ªControlleråšæ‹¦æˆª ä¸€ä¸ªé¡¹ç›®ä¸­å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªæ‹¦æˆªå™¨ï¼Œä»–ä»¬åœ¨ä¸€èµ·æ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚; æ‹¦æˆªå™¨å¸¸ç”¨åœ¨ï¼šç”¨æˆ·ç™»å½•å¤„ç†ï¼Œæƒé™æ£€æŸ¥ï¼Œè®°å½•æ—¥å¿—ã€‚ æ‹¦æˆªå™¨çš„ä½¿ç”¨æ­¥éª¤ å®šä¹‰ç±»å®žçŽ°HandlerInterceptoræŽ¥å£ åœ¨springmvcé…ç½®æ–‡ä»¶ä¸­ï¼Œå£°æ˜Žæ‹¦æˆªå™¨ï¼Œè®©æ¡†æž¶æŒ‡å®šæ‹¦æˆªå™¨çš„å­˜åœ¨ æ‹¦æˆªå™¨çš„æ‰§è¡Œæ—¶é—´ åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯controllerç±»ä¸­çš„æ–¹æ³•æ‰§è¡Œä¹‹å‰å…ˆè¢«æ‹¦æˆªï¼› åœ¨æŽ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œä¹‹åŽä¹Ÿä¼šæ‰§è¡Œæ‹¦æˆªå™¨ åœ¨è¯·æ±‚å¤„ç†å®Œæˆä¹‹åŽä¹Ÿä¼šæ‰§è¡Œæ‹¦æˆªå™¨ æ‹¦æˆªå™¨ï¼šçœ‹åšæ˜¯å¤šä¸ªControllerä¸­å…¬ç”¨çš„åŠŸèƒ½ï¼Œé›†ä¸­åˆ°æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†ï¼Œä½¿ç”¨çš„æ˜¯aopçš„æ€æƒ³ 6.3 æ‹¦æˆªå™¨ä¸‰ä¸ªæ–¹æ³•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081package org.zhkucst.handle;import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.ModelAndView;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.util.Date;public class MyInterceptor implements HandlerInterceptor &#123; private long btime; /** * preHandleå«åšé¢„å¤„ç†æ–¹æ³• * å‚æ•°ï¼š * Object handleï¼šè¢«æ‹¦æˆªçš„æŽ§åˆ¶å¯¹è±¡ * è¿”å›žå€¼boolean * true: * false: * * ç‰¹ç‚¹ï¼š * 1.æ–¹æ³•åœ¨æŽ§åˆ¶æ–¹æ³•ï¼ˆMyControllerçš„doSomeï¼‰ä¹‹å‰å…ˆæ‰§è¡Œçš„ * ç”¨æˆ·çš„è¯·æ±‚é¦–å…ˆåˆ°è¾¾æ­¤æ–¹æ³• * 2.åœ¨è¿™ä¸ª æ–¹æ³•ä¸­å¯ä»¥èŽ·å–è¯·æ±‚çš„ä¿¡æ¯ï¼ŒéªŒè¯è¯·æ±‚æ˜¯å¦ç¬¦åˆè¦æ±‚ * å¯ä»¥éªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®æŸä¸ªè¿žæŽ¥åœ°å€ï¼ˆurlï¼‰ * å¦‚æžœéªŒè¯å¤±è´¥ï¼Œå¯ä»¥æˆ³æ–­è¯·æ±‚ï¼Œè¯·æ±‚ä¸èƒ½è¢«å¤„ç† * å¦‚æžœéªŒè¯æˆåŠŸï¼Œå¯ä»¥æ”¾è¡Œè¯·æ±‚ï¼Œæ­¤æ—¶æŽ§åˆ¶å™¨æ–¹æ³•æ‰èƒ½æ‰§è¡Œã€‚ * */ @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; btime = System.currentTimeMillis(); System.out.println(&quot;æ‹¦æˆªå™¨çš„MyInterceptorçš„preHandle()&quot;); return true; &#125; /** * postHandle:åŽå¤„ç†å™¨æ–¹æ³• * å‚æ•°ï¼š * Object handler:è¢«æ‹¦æˆªçš„å¤„ç†å™¨å¯¹è±¡MyController * ModeAndView mv:å¤„ç†å™¨æ–¹æ³•çš„è¿”å›žå€¼ * * ç‰¹ç‚¹ï¼š * 1.åœ¨å¤„ç†å™¨æ–¹æ³•ä¹‹åŽæ‰§è¡Œçš„ï¼ˆMyController.doSome()ï¼‰ * 2.èƒ½å¤ŸèŽ·å–å¤„ç†å™¨æ–¹æ³•çš„è¿”å›žå€¼ModeAndView,å¯ä»¥ä¿®æ”¹ModeAndViewä¸­çš„ * æ•°æ®å’Œè§†å›¾ï¼Œå¯ä»¥å½±å“åˆ°æœ€åŽçš„æ‰§è¡Œç»“æžœ * 3.ä¸»è¦æ˜¯å¯¹åŽŸæ¥çš„æ‰§è¡Œç»“æžœåšç¬¬äºŒæ¬¡ä¿®æ­£ */ @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; System.out.println(&quot;æ‹¦æˆªå™¨çš„MyInterceptorçš„postHandle()&quot;); if(modelAndView != null)&#123; System.out.println(11); modelAndView.addObject(&quot;mydata&quot;, new Date()); modelAndView.setViewName(&quot;other&quot;); &#125; &#125; /** * +afterCompletion:æœ€åŽæ‰§è¡Œçš„æ–¹æ³• * å‚+æ•°ï¼š * Ob+ject handle:è¢«æ‹¦æˆªçš„å¤„ç†å™¨å¯¹è±¡ * Exception exï¼šç¨‹åºä¸­å‘ç”Ÿçš„å¼‚å¸¸ * ç‰¹ç‚¹ï¼š * 1.åœ¨è¯·æ±‚å¤„ç†å®ŒæˆåŽæ‰§è¡Œçš„ï¼Œæ¡†æž¶ä¸­è§„å®šæ˜¯å½“ä½ çš„è§†å›¾å¤„ç†å®ŒæˆåŽï¼Œå¯¹è§†å›¾æ‰§è¡Œäº†forward,å°±è®¤ä¸ºè¯·æ±‚å¤„ç†å®Œæˆ * 2.ä¸€èˆ¬åšèµ„æºå›žæ”¶å·¥ä½œï¼Œç¨‹åºè¯·æ±‚è¿‡ç¨‹ä¸­åˆ›å»ºäº†ä¸€äº›å¯¹è±¡ï¼Œåœ¨è¿™é‡Œå¯ä»¥ */ @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; long etime = System.currentTimeMillis(); System.out.println(&quot;æ‹¦æˆªå™¨çš„MyInterceptorçš„afterCompletion()&quot;); System.out.println(&quot;è®¡ç®—æœºä»ŽpreHandleåˆ°è¯·æ±‚å¤„ç†å®Œæˆçš„æ—¶é—´:&quot; + (etime - btime)); &#125;&#125; 6. 4 æ‹¦æˆªå™¨çš„å£°æ˜Žweb.xml 123456789101112&lt;!--å£°æ˜Žæ‹¦æˆªå™¨ï¼šæ‹¦æˆªå™¨å¯ä»¥æœ‰0æˆ–å¤šä¸ª--&gt;&lt;mvc:interceptors&gt; &lt;!--å£°æ˜Žç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨--&gt; &lt;mvc:interceptor&gt; &lt;!--æŒ‡å®šæ‹¦æˆªçš„è·¯å¾„--&gt; &lt;mvc:mapping path=&quot;/**&quot;/&gt; &lt;!--æŒ‡å®šä¸æ‹¦æˆªçš„è·¯å¾„--&gt; &lt;mvc:execlude-mapping path=&quot;/handler/testUpload&quot;/&gt; &lt;!--å£°æ˜Žæ‹¦æˆªå™¨å¯¹è±¡--&gt; &lt;bean class=&quot;org.zhkucst.handle.MyInterceptor&quot;/&gt; &lt;/mvc:interceptor&gt;&lt;/mvc:interceptors&gt; 6.5 å¤„ç†æ­¥éª¤1234567891011æ‹¦æˆªå¤„ç†æ­¥éª¤ï¼š1.æ–°å»ºmaven webé¡¹ç›®2.åŠ å…¥ä¾èµ–3.åˆ›å»ºControllerç±»4.åˆ›å»ºä¸€ä¸ªæ™®é€šç±»ï¼Œä½œä¸ºæ‹¦æˆªå™¨ä½¿ç”¨ 1)å®žçŽ°HandlerInterceptoræŽ¥å£ 2)å®žçŽ°æŽ¥å£ä¸­çš„ä¸‰ä¸ªæ–¹æ³•5.åˆ›å»ºshow.jsp6.åˆ›å»ºspringmvcçš„é…ç½®æ–‡ä»¶ 1)ç»„ä»¶æ‰«æå™¨ï¼Œæ‰«æ@Controlleræ³¨è§£ 2)å£°æ˜Žæ‹¦æˆªå™¨ï¼Œå¹¶æŒ‡å®šæ‹¦æˆªçš„è¯·æ±‚uriåœ°å€ 6.6 å¤šæ‹¦æˆªå™¨å¤šæ‹¦æˆªå™¨çš„åˆå§‹åŒ–å’Œæ‰§è¡Œé¡ºåºæŒ‰ç…§å£°æ˜Žé¡ºåºï¼Œå£°æ˜Žåœ¨å‰çš„å…ˆåˆå§‹åŒ– æ‹¦æˆªå™¨çš„åˆå§‹åŒ–æ˜¯å­˜æ”¾åœ¨ä¸€ä¸ªArrayListæ•°ç»„ä¸­ï¼Œæ•°ç»„çš„é¡ºåºè·Ÿå…ˆåŽæ·»åŠ æ˜¯ä¸€è‡´çš„ å…ˆåˆå§‹åŒ–çš„æ‹¦æˆªå™¨å…ˆæ‹¦æˆªï¼ŒåŽåˆå§‹åŒ–çš„åŽæ‹¦æˆª ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨preHandleï¼štrue ï¼›ç¬¬äºŒä¸ªæ‹¦æˆªå™¨preHandleï¼šfalse æ‰§è¡Œç»“æžœï¼š 1æ‹¦æˆªå™¨çš„MyInterceptorçš„preHandle() 2æ‹¦æˆªå™¨çš„MyInterceptorçš„preHandle() 1æ‹¦æˆªå™¨çš„MyInterceptorçš„afterCompletion() åŽŸå› ï¼š1.ç¬¬äºŒä¸ªæ‹¦æˆªå™¨æ²¡æœ‰æ”¾è¡Œï¼Œè¢«æ‹¦æˆªä¸‹æ¥çš„å¤„ç†å™¨æ–¹æ³•æ²¡æœ‰æ‰§è¡Œï¼ŒpostHandle()ä¸ä¼šæ‰§è¡Œ â€‹ 2.ç¬¬ä¸€ä¸ªæ”¾è¡Œï¼Œæ•…è€Œä¼šæ‰§è¡ŒafterCompletion() ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨preHandleï¼štrue ï¼›ç¬¬äºŒä¸ªæ‹¦æˆªå™¨preHandleï¼štrue æ‰§è¡Œç»“æžœï¼š 1æ‹¦æˆªå™¨çš„MyInterceptorçš„preHandle() 2æ‹¦æˆªå™¨çš„MyInterceptorçš„preHandle() ===æ‰§è¡ŒdoSome=== 2æ‹¦æˆªå™¨çš„MyInterceptorçš„postHandle() 1æ‹¦æˆªå™¨çš„MyInterceptorçš„postHandle() 2æ‹¦æˆªå™¨çš„MyInterceptorçš„afterCompletion() 1æ‹¦æˆªå™¨çš„MyInterceptorçš„afterCompletion() ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨preHandleï¼šfalse ï¼›ç¬¬äºŒä¸ªæ‹¦æˆªå™¨preHandleï¼štrue | false æ‰§è¡Œç»“æžœï¼š 1æ‹¦æˆªå™¨çš„MyInterceptorçš„preHandle() åŽŸå› ï¼šç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸æ”¾è¡Œï¼Œè‡ªç„¶ç¬¬äºŒä¸ªæ‹¦æˆªå™¨ä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œå¤„ç†å™¨æ–¹æ³•ä¸ä¼šæ‰§è¡Œï¼ŒåŽé¢çš„postHandleã€afterCompletionéƒ½ä¸ä¼šæ‰§è¡Œ 6.7 æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨çš„åŒºåˆ«1.è¿‡æ»¤å™¨æ˜¯servletä¸­çš„å¯¹è±¡ï¼Œæ‹¦æˆªå™¨æ˜¯æ¡†æž¶ä¸­çš„å¯¹è±¡ 2.è¿‡æ»¤å™¨å®žçŽ°FilteræŽ¥å£çš„å¯¹è±¡ï¼Œæ‹¦æˆªå™¨æ˜¯å®žçŽ°HandleInterceptoræŽ¥å£ 3.è¿‡æ»¤å™¨æ˜¯ç”¨æ¥è®¾ç½®request,responseçš„å‚æ•°ï¼Œå±žæ€§çš„ï¼Œä¾§é‡å¯¹æ•°æ®è¿‡æ»¤çš„æ‹¦æˆªå™¨æ˜¯ç”¨æ¥éªŒè¯è¯·æ±‚çš„ï¼Œèƒ½æˆªæ–­è¯·æ±‚ 4.è¿‡æ»¤å™¨æ˜¯åœ¨æ‹¦æˆªå™¨ä¹‹å‰å…ˆæ‰§è¡Œçš„ 5.è¿‡æ»¤å™¨æ˜¯tomcatæœåŠ¡å™¨åˆ›å»ºçš„å¯¹è±¡ï¼Œæ‹¦æˆªå™¨æ˜¯springmvcå®¹å™¨ä¸­åˆ›å»ºçš„å¯¹è±¡ 6.è¿‡æ»¤å™¨æ˜¯ä¸€ä¸ªæ‰§è¡Œæ—¶é—´ç‚¹ï¼Œæ‹¦æˆªå™¨æœ‰ä¸‰ä¸ªæ‰§è¡Œæ—¶é—´ç‚¹ 7.è¿‡æ»¤å™¨å¯ä»¥å¤„ç†jsp,js,,htmlç­‰ç­‰ï¼Œæ‹¦æˆªå™¨æ˜¯ä¾§é‡æ‹¦æˆªå¯¹Controllerçš„å¯¹è±¡ï¼Œå¦‚æžœä½ çš„è¯·æ±‚ä¸èƒ½è¢«DispatcherServletæŽ¥æ”¶ï¼Œè¿™ä¸ªè¯·æ±‚ä¸ä¼šæ‰§è¡Œæ‹¦æˆªå™¨å†…å®¹ 8.æ‹¦æˆªå™¨æ‹¦æˆªæ™®é€šç±»æ–¹æ³•æ‰§è¡Œï¼Œè¿‡æ»¤å™¨è¿‡æ»¤servletè¯·æ±‚å“åº” 7. å…¶ä»–å¤„ç†å™¨12ApplicationContext ctx = new ClassPathXmlApplication(&quot;beans.xml&quot;);StudentService service = (StudentService) ctx.getBean(&quot;service&quot;); springmvcå†…éƒ¨è¯·æ±‚çš„å¤„ç†æµç¨‹ï¼šä¹Ÿå°±æ˜¯springmvcæŽ¥æ”¶è¯·æ±‚ï¼Œåˆ°å¤„ç†å®Œæˆçš„è¿‡ç¨‹ 1.ç”¨æˆ·å‘èµ·è¯·æ±‚some.do 2.DispatcherSerrvletæŽ¥æ”¶è¯·æ±‚some.do,æŠŠè¯·æ±‚è½¬å‘ç»™å¤„ç†å™¨æ˜ å°„ å¤„ç†å™¨æ˜ å°„å™¨ï¼šspringmvcæ¡†æž¶ä¸­çš„ä¸€ç§å¯¹è±¡ï¼Œæ¡†æž¶æŠŠå®žçŽ°äº†HandlerMappingæŽ¥å£çš„ç±»éƒ½å«åšæ˜ å°„å™¨ï¼ˆå¤šä¸ªï¼‰ å¤„ç†å™¨æ˜ å°„å™¨ä½œç”¨ï¼šæ ¹æ®è¯·æ±‚ï¼Œä»Žspringmvcå®¹å™¨å¯¹è±¡ä¸­èŽ·å–å¤„ç†å™¨å¯¹è±¡ 1MyController controller = ctx.getBean(&quot;some.do&quot;) æ¡†æž¶æŠŠæ‰¾åˆ°çš„å¤„ç†å™¨å¯¹è±¡æ”¾åˆ°ä¸€ä¸ªå«åšå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ˆHandleExecutionChainï¼‰çš„ç±»ä¸­ä¿å­˜ HandlerExecutionChainï¼šç±»ä¸­ä¿å­˜ç€ï¼š (1) å¤„ç†å™¨å¯¹è±¡ï¼ˆMyControllerï¼‰; (2) é¡¹ç›®ä¸­çš„æ‰€æœ‰çš„æ‹¦æˆªå™¨List&lt;HandlerInterceptor&gt; interceptorList 1HandlerExecutionChain mapperHandler = getHandler(processedRequest) 3.DispatcherServletæŠŠ2ä¸­çš„HandlerExecutionChainä¸­çš„å¤„ç†å™¨å¯¹è±¡äº¤ç»™äº†å¤„ç†å™¨é€‚é…å™¨å¯¹è±¡ï¼ˆå¤šä¸ªï¼‰ å¤„ç†å™¨é€‚é…å™¨ï¼šspringmvcæ¡†æž¶ä¸­çš„å¯¹è±¡ï¼Œéœ€è¦å®žçŽ°HandlerAdapteræŽ¥å£ å¤„ç†å™¨é€‚é…å™¨ä½œç”¨ï¼šæ‰§è¡Œå¤„ç†å™¨æ–¹æ³•ï¼ˆè°ƒç”¨MyController.doSome() å¾—åˆ°è¿”å›žå€¼ModeAndViewï¼‰ ä¸­å¤®è°ƒåº¦å™¨è°ƒç”¨é€‚é…å™¨ï¼š 1HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHndler()) æ‰§è¡Œå¤„ç†å™¨æ–¹æ³•ï¼š 1mv = ha.handle(processedRequest, response, mapperHadler.getHandler())* 4.DispatherServletæŠŠ3ä¸­èŽ·å–çš„ModeAndViewäº¤ç»™äº†è§†å›¾è§£æžå™¨å¯¹è±¡ â€‹ è§†å›¾è§£æžå™¨ï¼šspringmvcä¸­çš„å¯¹è±¡ï¼Œéœ€è¦å®žçŽ°ViewResolveræŽ¥å£ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼‰ â€‹ è§†å›¾è§£æžå™¨ä½œç”¨ï¼šç»„æˆè§†å›¾å®Œæ•´è·¯å¾„ï¼Œåœ¨æ¡†æž¶ä¸­jsp, htmlä¸æ˜¯stringè¡¨ç¤ºï¼Œè€Œæ˜¯ä½¿ç”¨Viewå’Œä»–çš„å®žçŽ°ç±»è¡¨ç¤ºè§†å›¾ â€‹ InternalResourceViewï¼šè§†å›¾ç±»ï¼Œ è¡¨ç¤ºjspæ–‡ä»¶ï¼Œè§†å›¾è§£æžå™¨ä¼šåˆ›å»ºInternalResourceViewç±»å¯¹è±¡ 5.DispatcherServletæŠŠ4æ­¥éª¤ä¸­åˆ›å»ºçš„Viewå¯¹è±¡èŽ·å–åˆ°ï¼Œè°ƒç”¨Viewç±»è‡ªå·±çš„æ–¹æ³•ï¼ŒæŠŠModelæ•°æ®æ”¾å…¥åˆ°requesstä½œç”¨åŸŸ å›¾è§£ï¼š â€‹ 8. è¡¨å•æ ‡ç­¾è¡¨å•æ ‡ç­¾ï¼š â€‹ è‡ªå®šä¹‰æ ‡ç­¾ï¼šelã€jstl â€‹ Spring ELï¼š 1.æ”¯æŒå„ç§ç±»åž‹çš„è¯·æ±‚æ–¹å¼ï¼ˆæŸ¥è¯¢doGet, å¢žåŠ doPost, åˆ é™¤doDeleteï¼Œä¿®æ”¹doPutï¼‰ ï¼ˆ1ï¼‰ç¼–å†™method=&quot;put|delete&quot; (2) è¿‡æ»¤å™¨ï¼šä¸ºäº†è®© æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒputå’Œdeleteè¯·æ±‚ get post put delete -&gt;è¿‡æ»¤å™¨ HiddenHttpMethodFilter HiddenHttpMethodFilterä¼šå°†å…¨éƒ¨è¯·æ±‚ åä¸º â€œ_methodâ€œ çš„éšè—åŸŸ è¿›è¡Œ put | delete å¤„ç† å¦‚æžœä½¿ç”¨çš„æ˜¯SpringMVCæ ‡ç­¾ï¼š method=&quot;put | delete&quot; å¦‚æžœä¸æ˜¯SpringMVCæ ‡ç­¾ï¼šæ˜¯ä¼ ç»Ÿçš„htmlæ ‡ç­¾ï¼š method=&quot;post&quot; 1&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;put | delete&quot;&gt; 123456789101112131415161718&lt;form:form action=&quot;controller/testMethod&quot; method=&quot;get&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;æŸ¥çœ‹&quot;&gt;&lt;/form:form&gt;&lt;form:form action=&quot;controller/testMethod&quot; method=&quot;post&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;å¢žåŠ &quot;&gt;&lt;/form:form&gt;&lt;form:form action=&quot;controller/testMethod&quot; method=&quot;delete&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;åˆ é™¤&quot;&gt;&lt;/form:form&gt;&lt;form:form action=&quot;controller/testMethod&quot; method=&quot;put&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;ä¿®æ”¹&quot;&gt;&lt;/form:form&gt; ä¼˜ç‚¹ï¼šçœç•¥æ­¥éª¤ï¼šéšè—åŸŸ å¯å‚è€ƒåŽŸç”Ÿæ€çš„RESTfulé£Žæ ¼ 2.å¯ä»¥å°†å¯¹è±¡å’Œ è¡¨å•ç»‘å®šèµ·æ¥ SpringMVCé¡¹ç›®ï¼š 1231. çŽ¯å¢ƒæ­å»ºï¼š2. å¼•å…¥æ ‡ç­¾åº“ï¼š&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot;%&gt;3. ä½¿ç”¨ inputï¼š 12345&lt;form:form&gt; å§“åï¼š&lt;form:input path=&quot;stuName&quot;/&gt;&lt;br/&gt; å¹´é¾„ï¼š&lt;form:input path=&quot;stuAge&quot;/&gt; &lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot;&gt;&lt;/form:form&gt; 1.é»˜è®¤å®žä¾‹åŒ–beanæ ‡ç­¾çš„idå€¼ä¸ºcommandï¼Œmap.putçš„kå€¼å¿…é¡»ä¸ºcommand 2.è‡ªå®šä¹‰ï¼ŒmodelAttribute=&quot;person&quot;ï¼Œé€šè¿‡formä¸­è¯¥å±žæ€§å¯ä»¥æŒ‡å®šmap.putçš„kå€¼ 3.pathï¼šç»‘å®šä¸­å¯¹è±¡çš„å±žæ€§å€¼ æŽ§åˆ¶å™¨ï¼š 123456789101112131415161718192021@Controller@RequestMapping(value = &quot;/controller&quot;)public class MyController &#123; @Resource(name = &quot;studentServiceImpl&quot;) IStudentService studentService; public IStudentService getStudentService() &#123; return studentService; &#125; @RequestMapping(value = &quot;/testFormTag&quot;) public String testFormTag(Map&lt;String, Object&gt; map)&#123; Student student = studentService.queryStudentByStuNo(1); map.put(&quot;command&quot;,student); return &quot;success&quot;; &#125;&#125; mapper: 123&lt;select id=&quot;selectStudents&quot; resultType=&quot;student&quot;&gt; select stuno,stuname,stuage from student&lt;/select&gt; entityï¼š 1234public class Student &#123; private Integer stuNo; private String stuName; private Integer stuAge; checkboxå’Œcheckboxesï¼š checkboxï¼š â€‹ è‡ªåŠ¨ç»‘å®šrequeståŸŸä¸­çš„å€¼ â€‹ a.é€šè¿‡booleanå€¼ç»‘å®š 1234&lt;form:form modelAttribute=&quot;stu&quot;&gt; &lt;form:checkbox path=&quot;stuSex&quot;/&gt; &lt;input type=&quot;submit&quot;&gt;&lt;/form:form&gt; 123456789@RequestMapping(value = &quot;testCheckBox&quot;)public String testCheckBox(Map&lt;String,Object&gt; map)&#123; Student student = new Student(); student.setStuSex(true); map.put(&quot;stu&quot;,student); return &quot;success&quot;;&#125; b.ç»‘å®š é›†åˆï¼ˆListã€Setï¼‰ã€æ•°ç»„çš„ä¸­æž¢ checkboxesï¼šå¤šä¸ªcheckboxçš„ç»„åˆ pathï¼šé€‰ä¸­çš„é€‰é¡¹ itemsï¼šæ‰€æœ‰çš„é€‰é¡¹ 123456&lt;form:form modelAttribute=&quot;stu&quot;&gt; &lt;form:checkbox path=&quot;hobbies&quot; value=&quot;basketball&quot;/&gt; &lt;form:checkbox path=&quot;hobbies&quot; value=&quot;football&quot;/&gt; &lt;form:checkbox path=&quot;hobbies&quot; value=&quot;pingpong&quot;/&gt; &lt;input type=&quot;submit&quot;&gt;&lt;/form:form&gt; 12345678910111213@RequestMapping(value = &quot;testCheckBoxes&quot;)public String testCheckBoxes(Map&lt;String, Object&gt; map)&#123; Student student = new Student(); List&lt;String&gt; hobbies = new ArrayList&lt;&gt;(); hobbies.add(&quot;football&quot;); hobbies.add(&quot;basketball&quot;); student.setHobbies(hobbies); map.put(&quot;stu&quot;,student); return &quot;success&quot;;&#125; ç­‰ä»·äºŽï¼š 1234&lt;form:form modelAttribute=&quot;stu&quot;&gt; &lt;form:checkboxes path=&quot;hobbies&quot; items=&quot;$&#123;allHobbies&#125;&quot;/&gt; &lt;input type=&quot;submit&quot;&gt;&lt;/form:form&gt; 12345678910111213141516171819202122232425262728@RequestMapping(value = &quot;testCheckBoxes&quot;)public String testCheckBoxes(Map&lt;String, Object&gt; map)&#123; Student student = new Student(); //é€‰ä¸­é€‰é¡¹ List&lt;String&gt; hobbies = new ArrayList&lt;&gt;(); hobbies.add(&quot;football&quot;); hobbies.add(&quot;basketball&quot;); hobbies.add(&quot;pingpong&quot;); //å…¨éƒ¨é€‰é¡¹ /* List&lt;String&gt; allHobbies = new ArrayList&lt;&gt;(); allHobbies.add(&quot;football&quot;); allHobbies.add(&quot;basketball&quot;); allHobbies.add(&quot;pingpong&quot;); allHobbies.add(&quot;d&quot;);*/ Map&lt;String, String&gt; allHobbies = new HashMap&lt;&gt;(); allHobbies.put(&quot;football&quot;,&quot;è¶³çƒ&quot;); allHobbies.put(&quot;basketball&quot;,&quot;ç¯®çƒ&quot;); allHobbies.put(&quot;pingpong&quot;,&quot;ä¹’ä¹“çƒ&quot;); allHobbies.put(&quot;d&quot;,&quot;å…¶ä»–&quot;); student.setHobbies(hobbies); map.put(&quot;stu&quot;,student); map.put(&quot;allHobbies&quot;,allHobbies); return &quot;success&quot;;&#125; radiobuttonsï¼š åŒç† select: æ–¹å¼ä¸€ï¼š 1&lt;form select path=&quot;é»˜è®¤çš„å€¼&quot; items=&quot;æ‰€æœ‰çš„å¯é€‰é¡¹&quot;&gt; æ–¹å¼äºŒï¼š 12345&lt;form:select path=&quot;é»˜è®¤çš„å€¼&quot;&gt; &lt;form:option value=&quot;football&quot; è¶³çƒ&gt;&lt;/form:option&gt; &lt;form:option value=&quot;basketball&quot;&gt;&lt;/form:option&gt; &lt;form:option value=&quot;pingpong&quot;&gt;&lt;/form:option&gt;&lt;/form:select&gt; æ–¹å¼ä¸‰ï¼š 123&lt;form:select path=&quot;é»˜è®¤çš„å€¼&quot;&gt; &lt;form:options items=&quot;$&#123;allBallMap&#125;&quot;&gt;&lt;/form:options&gt;&lt;/form:select&gt; æ€»ç»“ï¼š å¦‚æžœæ–¹å¼äºŒã€æ–¹å¼ä¸‰åŒæ—¶å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æ–¹å¼äºŒ å¦‚æžœæ–¹å¼ä¸€ã€æ–¹å¼äºŒåŒæ—¶å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æ–¹å¼ä¸€ åŽŸç”Ÿæ€ä¼˜å…ˆçº§é«˜äºŽæ¡†æž¶ï¼Œè€Œä¸”æœ€åŽŸç”Ÿæ€çš„&lt;option&gt;æ²¡æœ‰ç»‘å®šçš„åŠŸèƒ½ c.ï¼ˆäº†è§£ï¼‰åµŒå¥—å¯¹è±¡çš„toString()çš„è¿”å›žå€¼ 12345678public class Student &#123; private Integer stuNo; private String stuName; private Integer stuAge; private boolean stuSex; private Other other;&#125; 123456public class Other &#123; @Override public String toString()&#123; return &quot;pingpong&quot;; &#125;&#125; 123456&lt;form:form modelAttribute=&quot;stu&quot;&gt; &lt;%--&lt;form:checkbox path=&quot;other&quot; value=&quot;basketball&quot;/&gt; &lt;form:checkbox path=&quot;other&quot; value=&quot;football&quot;/&gt; &lt;form:checkbox path=&quot;other&quot; value=&quot;pingpong&quot;/&gt;--%&gt; &lt;input type=&quot;submit&quot;&gt;&lt;/form:form&gt; 12345678910@RequestMapping(value = &quot;testCheckBoxes&quot;)public String testCheckBoxes(Map&lt;String, Object&gt; map)&#123; Student student = new Student(); Other other = new Other(); student.setOther(other); map.put(&quot;stu&quot;,student); return &quot;success&quot;;&#125;","categories":[{"name":"Javaæ¡†æž¶","slug":"Javaæ¡†æž¶","permalink":"http://fyupeng.github.io/categories/Java%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://fyupeng.github.io/tags/Spring/"},{"name":"MVC","slug":"MVC","permalink":"http://fyupeng.github.io/tags/MVC/"}],"author":"fyupeng"},{"title":"Spring","slug":"Spring","date":"2022-07-01T12:13:06.000Z","updated":"2022-07-01T12:16:24.056Z","comments":true,"path":"2022/07/01/Spring/","link":"","permalink":"http://fyupeng.github.io/2022/07/01/Spring/","excerpt":"","text":"1. è§£è€¦åˆå‘å±•å²ã€æŽ§åˆ¶åè½¬ã€ä¾èµ–æ³¨å…¥1.1 å¼€å‘Springç¨‹åºï¼ˆIOCï¼‰123ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;) //æ‰§è¡Œä»ŽspringIOCå®¹å™¨ä¸­èŽ·å–ä¸€ä¸ª id ä¸ºstudentçš„å¯¹è±¡ Student student = ï¼ˆStudentï¼‰context.getBean(&quot;student&quot;); å¯ä»¥å‘çŽ°ï¼Œspringiocå®¹å™¨ å¸®æˆ‘ä»¬ new äº†å¯¹è±¡ï¼Œå¹¶ä¸”ç»™å¯¹è±¡èµ‹äº†å€¼ 1.2 SpringIOCå‘å±•å²1.2.1 newå¯¹è±¡12Student student = new Student();student.setXxx(); 1.2.2 ç®€å•å·¥åŽ‚12MyFactory myFactory = new MyFactory();myFactory.learn(String name); 123456789101112public class CourseFactory &#123; public static ICourse getCourse(String name) &#123; //èŽ·å–iocå®¹å™¨ ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); if(name.equals(&quot;java&quot;)) &#123; return (ICourse) context.getBean(&quot;javaCourse&quot;); &#125;else &#123; return (ICourse) context.getBean(&quot;HtmlCourse&quot;); &#125; &#125;&#125; 1.2.3 iocï¼ˆè¶…çº§å·¥åŽ‚ï¼‰ å…ˆé…ç½®applicationContext.xnlæ–‡ä»¶ä¸­çš„&lt;bean&gt;æ ‡ç­¾ä¸­çš„studentã€javaCourseã€`htmlCourse`` ``student`ç±»ä¸­æ·»åŠ æ–¹æ³•ï¼š 123456public void learn(String name) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); ICourse course = (ICourse) context.getBean(name); course.learn();&#125; testæµ‹è¯•ç±»ä¸­æ·»åŠ æ–¹æ³•åŽè°ƒç”¨ï¼š 12345678public static void learnCourseWithIoc() &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); Student student = (Student) context.getBean(&quot;student&quot;); student.learn(&quot;javaCourse&quot;);&#125;public static void main(String[] args) &#123; learnCourseWithIoc(); &#125; 1.3 IOCä¹Ÿå¯ä»¥ç§°ä¸ºDI(ä¾èµ–æ³¨å…¥)æŽ§åˆ¶åè½¬ï¼šå°† åˆ›å»ºå¯¹è±¡ã€å±žæ€§å€¼ çš„æ–¹å¼ è¿›è¡Œäº† ç¿»è½¬ï¼Œä»Žnewã€setXxx() ç¿»è½¬ä¸ºäº† ä»ŽspringIOCå®¹å™¨ getBean()ä¾èµ–æ³¨å…¥ï¼šå°†å±žæ€§å€¼æ³¨å…¥ç»™äº†å±žæ€§ï¼Œå°†å±žæ€§æ³¨å…¥ç»™äº†bean,å°†beanæ³¨å…¥ç»™äº†iocå®¹å™¨; æ€»ç»“ï¼šioc/di, æ— è®ºè¦ä»€ä¹ˆå¯¹è±¡ï¼Œ éƒ½å¯ä»¥åŽ»springiocå®¹å™¨ä¸­èŽ·å–ï¼Œ è€Œä¸éœ€è¦è‡ªå·±æ“ä½œï¼ˆnew/setXxx()ï¼‰ 2. ä¸‰ç§æ–¹å¼çš„ä¾èµ–æ³¨å…¥IOCå®¹å™¨èµ‹å€¼ï¼š ç®€å•ç±»åž‹ï¼š8ä¸ªåŸºæœ¬+String valueï¼šå¦‚æžœæ˜¯å¯¹è±¡ç±»åž‹ refï¼šâ€œéœ€è¦å¼•ç”¨çš„idå€¼â€ å› æ­¤å®žçŽ°äº† å¯¹è±¡ä¸Žå¯¹è±¡ä¹‹é—´çš„ ä¾èµ–å…³ç³» 1context.getBean(éœ€è¦èŽ·å–çš„beançš„idå€¼) 2.1.1 .setæ³¨å…¥ï¼šé€šè¿‡setXxx()èµ‹å€¼èµ‹å€¼ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯set()æ–¹æ³•ï¼› ä¾èµ–æ³¨å…¥åº•å±‚æ˜¯é€šè¿‡åå°„å®žçŽ°å¯¹çš„ã€‚ 2.2.2 æž„é€ å™¨æ³¨å…¥ï¼šé€šè¿‡æž„é€ æ–¹æ³•èµ‹å€¼1&lt;constructor-arg value=&quot;ls&quot; type=&quot;String&quot; name=&quot;name&quot; &gt;&lt;/constructor-arg&gt; éœ€è¦æ³¨æ„ï¼šå¦‚æžœ&lt;constructor-arg&gt; çš„é¡ºåº ä¸Žæž„é€ æ–¹æ³•å‚æ•°çš„é¡ºåºä¸ä¸€è‡´ï¼Œåˆ™éœ€è¦é€šè¿‡typeæˆ–è€…indexæˆ–nameæŒ‡å®š 2.2.3 på‘½åç©ºé—´çš„æ³¨å…¥å¼•å…¥å‘½åç©ºé—´ 123&lt;beans xmlns:p=&quot;http://www.springframework.org/schema/p&quot;&gt;&lt;/beans&gt; ç®€å•ç±»åž‹ï¼šp:å±žæ€§å=â€œå±žæ€§å€¼â€ å¼•ç”¨ç±»åž‹ï¼ˆé™¤äº†Stringå¤–)ï¼špï¼šå±žæ€§å-ref=â€å¼•ç”¨çš„idâ€ æ³¨æ„å¤šä¸ª p èµ‹å€¼çš„æ—¶å€™ è¦æœ‰ç©ºæ ¼ã€‚ æ³¨æ„ï¼šæ— è®ºæ˜¯Stringè¿˜æ˜¯in/short/long, åœ¨èµ‹å€¼æ—¶éƒ½æ˜¯ value=&quot;å€¼&quot; å› æ­¤å»ºè®®æ­¤ç§æƒ…å†µ éœ€è¦é…åˆname\\typeè¿›è¡ŒåŒºåˆ† 3. é›†åˆå’Œç‰¹æ®Šç±»åž‹æ³¨å…¥3.1 é›†åˆç±»åž‹æ³¨å…¥ç¤ºä¾‹ï¼š â€‹ æ³¨å…¥å„ç§æ•°æ®ç±»åž‹ï¼šListã€Setã€mapã€properties 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;bean id=&quot;collectionDemo&quot; class=&quot;org.student.entity.AllCollectionType&quot;&gt; &lt;property name=&quot;list&quot;&gt; &lt;list&gt; &lt;value&gt;è¶³çƒ&lt;/value&gt; &lt;value&gt;ç¯®çƒ&lt;/value&gt; &lt;value&gt;ä¹’ä¹“çƒ&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;property name=&quot;array&quot;&gt; &lt;!-- &lt;array&gt; &lt;value&gt;è¶³çƒ1&lt;/value&gt; &lt;value&gt;ç¯®çƒ1&lt;/value&gt; &lt;value&gt;ä¹’ä¹“çƒ1&lt;/value&gt; &lt;/array&gt; --&gt; &lt;list&gt; &lt;value&gt;è¶³çƒ1&lt;/value&gt; &lt;value&gt;ç¯®çƒ1&lt;/value&gt; &lt;value&gt;ä¹’ä¹“çƒ1&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;property name=&quot;set&quot;&gt; &lt;!-- &lt;set&gt; &lt;value&gt;è¶³çƒ2&lt;/value&gt; &lt;value&gt;ç¯®çƒ2&lt;/value&gt; &lt;value&gt;ä¹’ä¹“çƒ2&lt;/value&gt; &lt;/set&gt; --&gt; &lt;list&gt; &lt;value&gt;è¶³çƒ2&lt;/value&gt; &lt;value&gt;ç¯®çƒ2&lt;/value&gt; &lt;value&gt;ä¹’ä¹“çƒ2&lt;/value&gt; &lt;/list&gt; &lt;/property&gt; &lt;property name=&quot;map&quot;&gt; &lt;map&gt; &lt;entry&gt; &lt;key&gt; &lt;value&gt;foot3&lt;/value&gt; &lt;/key&gt; &lt;value&gt;è¶³çƒ3&lt;/value&gt; &lt;/entry&gt; &lt;entry&gt; &lt;key&gt; &lt;value&gt;basket3&lt;/value&gt; &lt;/key&gt; &lt;value&gt;ç¯®çƒ3&lt;/value&gt; &lt;/entry&gt; &lt;entry&gt; &lt;key&gt; &lt;value&gt;pp3&lt;/value&gt; &lt;/key&gt; &lt;value&gt;ä¹’ä¹“çƒ3&lt;/value&gt; &lt;/entry&gt; &lt;/map&gt; &lt;/property&gt; &lt;property name=&quot;props&quot;&gt; &lt;props&gt; &lt;prop key=&quot;foot4&quot;&gt;è¶³çƒ4&lt;/prop&gt; &lt;prop key=&quot;basket4&quot;&gt;ç¯®çƒ4&lt;/prop&gt; &lt;prop key=&quot;pp4&quot;&gt;ä¹’ä¹“çƒ4&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt;&lt;/bean&gt; è¢«æ³¨å…¥çš„å¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package org.student.entity;import java.util.List;import java.util.Map;import java.util.Properties;import java.util.Set;public class AllCollectionType &#123; private List&lt;String&gt; list; private String[] array; private Set&lt;String&gt; set; private Map&lt;String, String&gt; map; private Properties props; public List&lt;String&gt; getList() &#123; return list; &#125; public void setList(List&lt;String&gt; list) &#123; this.list = list; &#125; public String[] getArray() &#123; return array; &#125; public void setArray(String[] array) &#123; this.array = array; &#125; public Set&lt;String&gt; getSet() &#123; return set; &#125; public void setSet(Set&lt;String&gt; set) &#123; this.set = set; &#125; public Map&lt;String, String&gt; getMap() &#123; return map; &#125; public void setMap(Map&lt;String, String&gt; map) &#123; this.map = map; &#125; public Properties getProps() &#123; return props; &#125; public void setProps(Properties props) &#123; this.props = props; &#125; @Override public String toString() &#123; String strContent = &quot;&quot;; for(String str : array) &#123; strContent += str + &quot;,&quot;; &#125; return &quot;list:&quot; + this.list + &quot;set:&quot; + this.set + &quot;map:&quot; + this.map + &quot;pros:&quot; + this.props + &quot;array:&quot; + strContent; &#125;&#125; 3.2 ç‰¹æ®Šå€¼çš„æ³¨å…¥ ç»™å¯¹è±¡ç±»åž‹èµ‹å€¼ null 123&lt;property name=&quot;name&quot;&gt; &lt;null/&gt; &lt;!-- æ³¨æ„æ²¡æœ‰&lt;value&gt; --&gt;&lt;/property&gt; èµ‹ç©ºå€¼ â€œâ€ 123&lt;property name=&quot;name&quot;&gt; &lt;value&gt;&lt;/value&gt;&lt;/property&gt; æ³¨æ„ï¼š åœ¨iocä¸­å®šä¹‰beançš„å‰æï¼šè¯¥beançš„ ç±» å¿…é¡»æä¾›äº† æ— å‚æž„é€  4. è‡ªåŠ¨è£…é…åªé€‚ç”¨äºŽ refç±»åž‹ï¼Œçº¦å®šç”±äºŽé…ç½® è‡ªåŠ¨é…ç½®ï¼š 123456789101112131415&lt;bean id=&quot;course&quot; class=&quot;org.student.entity.Course&quot; autowire=&quot;constructor&quot;&gt; &lt;!-- &lt;bean id=&quot;course&quot; class=&quot;org.student.entity.Course&quot; p:courseName=&quot;hadoop&quot; p:courseHour=&quot;300&quot; p:teacher-ref=&quot;teacher&quot;&gt; --&gt; &lt;!-- é€šè¿‡setæ–¹å¼èµ‹å€¼ --&gt; &lt;property name=&quot;courseName&quot; value=&quot;java&quot;&gt;&lt;/property&gt; &lt;property name=&quot;courseHour&quot; value=&quot;200&quot;&gt;&lt;/property&gt; &lt;!-- &lt;property name=&quot;teacher&quot; ref=&quot;teacher&quot;&gt;&lt;/property&gt; --&gt;&lt;/bean&gt;&lt;bean id=&quot;teacher&quot; class=&quot;org.student.entity.Teacher&quot;&gt; &lt;!-- é€šè¿‡setæ–¹å¼èµ‹å€¼ --&gt; &lt;property name=&quot;name&quot; value=&quot;zs&quot;&gt;&lt;/property&gt; &lt;property name=&quot;age&quot; value=&quot;21&quot;&gt;&lt;/property&gt;&lt;/bean&gt; byNameï¼šè‡ªåŠ¨å¯»æ‰¾å…¶ä»–beançš„idå€¼ = è¯¥Courseç±»çš„å±žæ€§å byNameæœ¬è´¨æ˜¯byId 1&lt;bean class=&quot;org.student.entity.Course&quot; autowire=&quot;byName&quot;&gt;&lt;/bean&gt; byTypeï¼šå…¶ä»–beançš„ç±»åž‹classæ˜¯å¦ä¸Žè¯¥Courseç±»çš„refå±žæ€§ç±»åž‹ä¸€è‡´ æ³¨æ„ï¼šæ­¤ç§æ–¹æ³•å¿…é¡»æ»¡è¶³å½“å‰IOCå®¹å™¨ä¸­ï¼Œ åªèƒ½æœ‰ä¸€ä¸ªbeanæ»¡è¶³æ¡ä»¶ constructorï¼šå…¶ä»–benaçš„ç±»åž‹ï¼ˆclassï¼‰æ˜¯å¦ä¸Ž è¯¥courseç±»çš„æž„é€ æ–¹æ³•å‚æ•°çš„ç±»åž‹ä¸€è‡´ï¼Œæ­¤ç§æ–¹å¼çš„æœ¬è´¨å°±æ˜¯byType å¯ä»¥åœ¨å¤´æ–‡ä»¶ä¸­ä¸€æ¬¡æ€§å°†iocå®¹å™¨ä¸­çš„æ‰€æœ‰beanç»Ÿä¸€è®¾ç½®æˆè‡ªåŠ¨è£…é…ï¼š 123&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; default-autowire=&quot;default&quot; &gt;&lt;/beans&gt; è‡ªåŠ¨è£…é…è™½ç„¶å¯ä»¥å‡å°‘ä»£ç é‡ï¼Œä½†æ˜¯ä¼šé™ä½Žç¨‹åºçš„å¯è¯»æ€§ï¼Œä½¿ç”¨æ—¶éœ€è¦è°¨æ…Žã€‚ 5. ä½¿ç”¨æ³¨è§£å£°æ˜Žå¼äº‹åŠ¡ä½¿ç”¨æ³¨è§£å®šä¹‰beanï¼šé€šè¿‡æ³¨è§£çš„å½¢å¼å°†beanä»¥åŠç›¸åº”çš„å±žæ€§å€¼æ”¾å…¥iocå®¹å™¨ 12&lt;context:component-scan base-package=&quot;org.student.dao&quot;&gt;&lt;/context:component-scan&gt; springåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæ ¹æ®base-packageåœ¨ è¯¥åŒ…ä¸­æ‰«ææ‰€æœ‰ç±»ï¼ŒæŸ¥æ‰¾è¿™äº›ç±»æ˜¯å¦æœ‰æ ‡æ˜Žæ³¨è§£ï¼Œæœ‰æ³¨è§£å°±å°†å®ƒæ³¨å…¥iocå®¹å™¨ä¸­ å¤´æ–‡ä»¶ï¼š 123&lt;beans xmlns:context=&quot;http://www.springframework.org/schema/context&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd&quot;&gt; @Componmentç»†åŒ–ï¼š daoå±‚æ³¨è§£ï¼š@Respository serviceå±‚æ³¨è§£ï¼š@Service æŽ§åˆ¶å™¨å±‚æ³¨è§£ï¼š@Controller ä½¿ç”¨æ³¨è§£å®žçŽ°äº‹åŠ¡ï¼ˆå£°æ˜Žæ˜¯äº‹åŠ¡ï¼‰ ç›®æ ‡ï¼šé€šè¿‡äº‹åŠ¡ä½¿ä»¥ä¸‹æ–¹æ³• è¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ 12345public void addStudent() &#123; //å¢žåŠ ç­çº§ //å¢žåŠ å­¦ //crud&#125; 5.1 jaråŒ…123456spring-tx-4.3.9.RELEASE.jarojdbc.jarcommons-dbcp.jar # è¿žæŽ¥æ± ä½¿ç”¨çš„æ•°æ®æºcommons-pool.jar # è¿žæŽ¥æ± spring-jdbc-4.3.9.RELEASE.jaraopalliance.jar 5.2 é…ç½®jdbc\\mybatis\\spring å¢žåŠ äº‹åŠ¡å‘½åç©ºé—´ 123&lt;beans xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.3.xsd&quot;&gt; å¢žåŠ å¯¹äº‹åŠ¡çš„æ”¯æŒï¼šä¾èµ–&lt;bean id=&quot;txManager&quot;/&gt; 12&lt;!-- å¢žåŠ å¯¹äº‹åŠ¡çš„æ”¯æŒ --&gt;&lt;tx:annotation-driven transaction-manager=&quot;txManager&quot;/&gt; é…ç½®äº‹åŠ¡ç®¡ç†å™¨txManagerä¾èµ–çš„jaråŒ…ï¼šspring-jdbc-4.3.9.RELEASE.jar ä¾èµ–&lt;bean id=&quot;dataSource&quot;/&gt; 1234&lt;!-- é…ç½®äº‹åŠ¡ç®¡ç†å™¨txManager --&gt;&lt;bean id=&quot;txManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;&lt;/bean&gt; é…ç½®æ•°æ®åº“ç›¸å…³äº‹åŠ¡ï¼šä¾èµ–jaråŒ…ï¼ˆcommons-dbcp.jar è¿žæŽ¥æ± ä½¿ç”¨çš„æ•°æ®æºï¼‰ 123456789&lt;!-- é…ç½®æ•°æ®åº“ç›¸å…³äº‹åŠ¡ --&gt;&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt; &lt;property name=&quot;driverClassName&quot; value=&quot;oracle.jdbc.OracleDriver&quot;&gt;&lt;/property&gt; &lt;property name=&quot;url&quot; value=&quot;jdbc:oracle:thin@127.0.0.1:1521:ORCL&quot;&gt;&lt;/property&gt; &lt;property name=&quot;username&quot; value=&quot;scott&quot;&gt;&lt;/property&gt; &lt;property name=&quot;password&quot; value=&quot;tiger&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxActive&quot; value=&quot;10&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxIdle&quot; value=&quot;6&quot;&gt;&lt;/property&gt;&lt;/bean&gt; 5.3 ä½¿ç”¨å°†éœ€è¦æˆä¸ºäº‹åŠ¡çš„æ–¹æ³•å‰å¢žåŠ æ³¨è§£ 1@Transactional(readOnly = false, propagation = Propagation.REQUIRED) 6. AOP é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸€ä¸ªæ™®é€šçš„ç±» -&gt; æœ‰ç‰¹å®šåŠŸèƒ½çš„ç±» ç»§æ‰¿ å®žçŽ° æ³¨è§£ é…ç½® 12public class MyFilter extends/implements Xx &#123;&#125; 6.1 å‰ç½®é€šçŸ¥éœ€è¦å¤´æ–‡ä»¶ 123&lt;beans xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;xsi:schemaLocation=&quot;http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-4.3.xsd&quot;&gt; jar åŒ… 12aopaliance.jaraspectjweaver.jar é…ç½® é…ç½®addStudent()æ–¹æ³•å’Œå‰ç½®é€šçŸ¥ç±»çš„bean 123456789&lt;!-- addStudent()æ‰€åœ¨æ–¹æ³• --&gt;&lt;bean id=&quot;studentService&quot; class=&quot;org.student.service.impl.StudentServiceImpl&quot;&gt; &lt;property name=&quot;studentDao&quot; ref=&quot;studentDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt;&lt;!-- â€œå‰ç½®é€šçŸ¥â€ç±» --&gt;&lt;!-- ========è¿žæŽ¥çº¿çš„ä¸€æ–¹======== --&gt;&lt;bean id=&quot;logBefore&quot; class=&quot;org.student.aop.LogBefore&quot;&gt;&lt;/bean&gt; å°†addStudent()æ–¹æ³•å’Œå‰ç½®é€šçŸ¥ç±»å…³è” 1234567&lt;!-- å°†addStudent()å’Œ é€šçŸ¥è¿›è¡Œå…³è” --&gt;&lt;aop:config&gt; &lt;!-- é…ç½®åˆ‡å…¥ç‚¹ ï¼ˆåœ¨å“ªé‡Œæ‰§è¡Œé€šçŸ¥ï¼‰ --&gt; &lt;!-- ========è¿žæŽ¥çº¿çš„å¦ä¸€æ–¹======== --&gt; &lt;aop:pointcut expression=&quot;execution(public void org.student.service.impl.StudentServiceImpl.deleteStudent(int)) or execution(public void org.student.service.impl.StudentServiceImpl.addStudent(org.student.entity.Student))&quot; id=&quot;pointcut&quot;/&gt; &lt;aop:advisor advice-ref=&quot;logBefore&quot; pointcut-ref=&quot;pointcut&quot;/&gt;&lt;/aop:config&gt; ç¼–å†™ aopï¼šæ¯å½“æ‰§è¡Œadd()ä¹‹å‰è‡ªåŠ¨æ‰§è¡Œä¸€ä¸ªæ–¹æ³•log() add()ï¼šä¸šåŠ¡æ–¹æ³• log()ï¼šè‡ªåŠ¨æ‰§è¡Œçš„é€šçŸ¥ï¼Œå³aopå‰ç½®é€šçŸ¥ 12345public class Xxx&#123; //@Test //a()&#123;&#125;&#125; å¦‚æžœå‡ºçŽ°å¼‚å¸¸ï¼šç±»ä¼¼java.lang.NoClassDefFoundErrorï¼šorg/apach....åˆ™è¯´æ˜Žç¼ºå°‘jarç±» 6.2 åŽç½®é€šçŸ¥ é€šçŸ¥ç±»ï¼šæ™®é€šå®žçŽ°æŽ¥å£ ä¸šåŠ¡ç±»ã€ä¸šåŠ¡æ–¹æ³•ï¼šStudentServiceImplä¸­çš„addStudent() é…ç½®ï¼š å°†ä¸šåŠ¡ç±»ã€é€šçŸ¥ çº³å…¥springIOCå®¹å™¨ å®šä¹‰åˆ‡å…¥ç‚¹ï¼ˆä¸€ç«¯ï¼‰ã€å®šä¹‰é€šçŸ¥ç±»ï¼ˆå¦ä¸€ç«¯ï¼‰ï¼Œé€šè¿‡pointcut-refå°†ä¸¤ç«¯è¿žæŽ¥èµ·æ¥ é…ç½®addStudent()æ–¹æ³•å’Œ åŽç½®é€šçŸ¥ç±»çš„bean 1234567&lt;!-- addStudent()æ‰€åœ¨æ–¹æ³• --&gt;&lt;bean id=&quot;studentService&quot; class=&quot;org.student.service.impl.StudentServiceImpl&quot;&gt; &lt;property name=&quot;studentDao&quot; ref=&quot;studentDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt;&lt;bean id=&quot;logAfter&quot; class=&quot;org.student.aop.LogAfter&quot;&gt;&lt;/bean&gt; å°†addStudentï¼ˆï¼‰æ–¹æ³•å’Œ å‰ç½®é€šçŸ¥ç±»å…³è” 1234567&lt;!-- å°†addStudent()å’Œ é€šçŸ¥è¿›è¡Œå…³è” --&gt;&lt;aop:config&gt; &lt;!-- åˆ‡å…¥ç‚¹ï¼ˆè¿žæŽ¥çº¿çš„ä¸€ç«¯ï¼‰ï¼šä¸šåŠ¡ç±»çš„å…·ä½“æ–¹æ³• --&gt; &lt;aop:pointcut expression=&quot;execution(public * org.student.service.impl.StudentServiceImpl.addStudent(..))&quot; id=&quot;pointcut2&quot;/&gt; &lt;aop:advisor advice-ref=&quot;logAfter&quot; pointcut-ref=&quot;pointcut2&quot;/&gt;&lt;/aop:config&gt; 6.3 å¼‚å¸¸é€šçŸ¥æ ¹æ®å¼‚å¸¸é€šçŸ¥æŽ¥å£çš„å®šä¹‰å¯ä»¥å‘çŽ°ï¼Œå¼‚å¸¸é€šçŸ¥çš„å®žçŽ°ç±»å¿…é¡»ç¼–å†™ä»¥ä¸‹æ–¹æ³•ï¼š 12void afterThrowing(Mehthod, args, target, ThrowableSubclass)void afterThrowing(ThrowableSubclass) é…ç½®addStudent()æ–¹æ³•å’ŒåŽç½®é€šçŸ¥ç±»çš„bean 123456&lt;!-- addStudent()æ‰€åœ¨æ–¹æ³• --&gt;&lt;bean id=&quot;studentService&quot; class=&quot;org.student.service.impl.StudentServiceImpl&quot;&gt; &lt;property name=&quot;studentDao&quot; ref=&quot;studentDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt;&lt;bean id=&quot;logException&quot; class=&quot;org.student.aop.LogException&quot;&gt;&lt;/bean&gt; å°†addStudent()æ–¹æ³•å’ŒåŽç½®é€šçŸ¥ç±»å…³è” 123456&lt;!-- å°†addStudent()å’Œ é€šçŸ¥è¿›è¡Œå…³è” --&gt;&lt;aop:config&gt; &lt;!-- åˆ‡å…¥ç‚¹ï¼ˆè¿žæŽ¥çº¿çš„ä¸€ç«¯ï¼‰ï¼šä¸šåŠ¡ç±»çš„å…·ä½“æ–¹æ³• --&gt; &lt;aop:pointcut expression=&quot;execution(public * org.student.service.impl.StudentServiceImpl.addStudent(..))&quot; id=&quot;pointcut3&quot;/&gt; &lt;aop:advisor advice-ref=&quot;logException&quot; pointcut-ref=&quot;pointcut3&quot;/&gt;&lt;/aop:config&gt; 6.4 çŽ¯ç»•é€šçŸ¥åœ¨ç›®æ ‡æ–¹æ³•çš„å‰åŽã€å¼‚å¸¸å‘ç”Ÿæ—¶ã€æœ€ç»ˆç­‰å„ä¸ªåœ°æ–¹éƒ½å¯ä»¥è¿›è¡Œçš„é€šçŸ¥ï¼Œæœ€å¼ºå¤§çš„ä¸€ä¸ªé€šçŸ¥ï¼› å¯ä»¥èŽ·å–ç›®æ ‡æ–¹æ³•çš„å…¨éƒ¨æŽ§åˆ¶æƒï¼ˆç›®æ ‡æ–¹æ³•æ˜¯å¦æ‰§è¡Œã€æ‰§è¡Œä¹‹å‰ã€æ‰§è¡Œä¹‹åŽã€å‚æ•°ã€è¿”å›žå€¼ç­‰ï¼‰ åœ¨ä½¿ç”¨çŽ¯ç»•é€šçŸ¥æ—¶ï¼Œç›®æ ‡æ–¹æ³•çš„ä¸€åˆ‡ä¿¡æ¯éƒ½å¯ä»¥é€šè¿‡invocationå‚æ•°èŽ·å–çš„ é…ç½®addStudent()æ–¹æ³•å’ŒåŽç½®é€šçŸ¥ç±»çš„bean 123456&lt;!-- addStudent()æ‰€åœ¨æ–¹æ³• --&gt;&lt;bean id=&quot;studentService&quot; class=&quot;org.student.service.impl.StudentServiceImpl&quot;&gt; &lt;property name=&quot;studentDao&quot; ref=&quot;studentDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt;&lt;bean id=&quot;logAround&quot; class=&quot;org.student.aop.LogAround&quot;&gt;&lt;/bean&gt; å°†2.å°†addStudent()æ–¹æ³•å’Œå‰ç½®é€šçŸ¥ç±»å…³è” 123456&lt;!-- å°†addStudent()å’Œ é€šçŸ¥è¿›è¡Œå…³è” --&gt;&lt;aop:config&gt; &lt;!-- åˆ‡å…¥ç‚¹ï¼ˆè¿žæŽ¥çº¿çš„ä¸€ç«¯ï¼‰ï¼šä¸šåŠ¡ç±»çš„å…·ä½“æ–¹æ³• --&gt; &lt;aop:pointcut expression=&quot;execution(public * org.student.service.impl.StudentServiceImpl.addStudent(..))&quot; id=&quot;pointcut4&quot;/&gt; &lt;aop:advisor advice-ref=&quot;logAround&quot; pointcut-ref=&quot;pointcut4&quot;/&gt;&lt;/aop:config&gt; 7. åŸºäºŽæ³¨è§£å½¢å¼çš„AOPå®žçŽ°ä½¿ç”¨æ³¨è§£å®žçŽ°é€šçŸ¥aop jaråŒ… ä¸Žå®žçŽ°æŽ¥å£ çš„æ–¹å¼ç›¸åŒ é…ç½® å°†ä¸šåŠ¡ç±»ã€é€šçŸ¥çº³å…¥springIOCå®¹å™¨ å¼€å¯æ³¨è§£AOPçš„æ”¯æŒ 1&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt; ä¸šåŠ¡ç±»addStudent â€“ é€šçŸ¥ ç¼–å†™ 123@Aspect //å£°æ˜Žè¯¥ç±» æ˜¯ä¸€ä¸ª é€šçŸ¥public class LogBeforeAnnotation &#123;&#125; æ³¨æ„ï¼šé€šè¿‡æ³¨è§£å½¢å¼å°†å¯¹è±¡å¢žåŠ åˆ°iocå®¹å™¨æ—¶ï¼Œéœ€è¦è®¾ç½®æ‰«æå™¨ 1&lt;context:component-scan base-package=&quot;org.student.aop&quot;&gt;&lt;/context:component-scan&gt; æ‰«æå™¨ä¼šå°†æŒ‡å®šçš„åŒ…ä¸­çš„@Componetã€@Serviceã€@Responsitoryã€@Controllerä¿®é¥°çš„ç±»äº§ç”Ÿçš„å¯¹è±¡å¢žåŠ åˆ° ioc å®¹å™¨ä¸­ @Aspect ä¸éœ€è¦åŠ å…¥æ‰«æå™¨ï¼Œåªéœ€è¦å¼€å¯å³å¯ï¼š 1&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt; é€šè¿‡æ³¨è§£å½¢å¼ å®žçŽ°çš„aopï¼Œå¦‚æžœæƒ³èŽ·å–ç›®æ ‡å¯¹è±¡çš„ä¸€äº›å‚æ•°ï¼Œåˆ™éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ï¼šJoinPoint å£°æ˜Žè¿”å›žå€¼çš„å‚æ•°åï¼šå‚æ•°åå˜é‡ä¸èƒ½éšä¾¿å†™ï¼Œè¦å†™æˆ returningValue æ³¨è§£å½¢å¼å®žçŽ°aopæ—¶ï¼Œé€šçŸ¥çš„æ–¹æ³•çš„å‚æ•°ä¸èƒ½å¤šã€å°‘ 7.1 å‰ç½®é€šçŸ¥12345//å‰ç½®é€šçŸ¥@Before(&quot;execution(public * addStudent(..))&quot;)public void myBefore(JoinPoint jp) &#123; System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šå‰ç½®é€šçŸ¥ã€‹:ç›®æ ‡å¯¹è±¡ï¼š&quot; + jp.getTarget() + &quot;,æ–¹æ³•åï¼š&quot; + jp.getSignature() + &quot;,å‚æ•°åˆ—è¡¨ï¼š&quot; + Arrays.toString(jp.getArgs()));&#125; 7.2 åŽç½®é€šçŸ¥12345//åŽç½®é€šçŸ¥@AfterReturning( pointcut = &quot;execution(public * addStudent(..))&quot;, returning = &quot;returningValue&quot; )public void myAfter(JoinPoint jp, Object returningValue) &#123; System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šåŽç½®é€šçŸ¥ã€‹:ç›®æ ‡å¯¹è±¡ï¼š&quot; + jp.getTarget() + &quot;,æ–¹æ³•åï¼š&quot; + jp.getSignature() + &quot;,å‚æ•°åˆ—è¡¨ï¼š&quot; + Arrays.toString(jp.getArgs()) + &quot;,è¿”å›žå€¼:&quot; + returningValue);&#125; 7.3 çŽ¯ç»•é€šçŸ¥123456789101112131415161718//çŽ¯ç»•é€šçŸ¥@Around(&quot;execution(public * addStudent(..))&quot;)public void myAround(ProceedingJoinPoint jp) &#123; //æ–¹æ³•æ‰§è¡Œä¹‹å‰ System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œä¹‹å‰ã€‹&quot;); try &#123; //æ–¹æ³•æ‰§è¡Œæ—¶ System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œæ—¶ã€‹&quot;); jp.proceed(); //æ–¹æ³•æ‰§è¡Œä¹‹åŽ System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ï¼šæ–¹æ³•æ‰§è¡Œä¹‹åŽã€‹&quot;); &#125;catch(Throwable e) &#123; //å‘ç”Ÿå¼‚å¸¸æ—¶ System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ï¼šå‘ç”Ÿå¼‚å¸¸æ—¶ã€‹&quot;); &#125;finally &#123; //æœ€ç»ˆé€šçŸ¥ &#125;&#125; 7.4 å¼‚å¸¸é€šçŸ¥12345//å¼‚å¸¸é€šçŸ¥:å¦‚æžœåªæ•èŽ·ç‰¹å®šç±»åž‹çš„å¼‚å¸¸@AfterThrowing( pointcut = &quot;execution(public * addStudent(..))&quot;, throwing = &quot;e&quot; )public void myException(NullPointerException e) &#123; System.out.println(&quot;&amp;&amp;&amp;&amp;&amp;ã€Šæ³¨è§£å½¢å¼ï¼šå¼‚å¸¸é€šçŸ¥ï¼šã€‹å¼‚å¸¸ä¿¡æ¯ï¼š&quot; + e.getMessage());&#125; 7.5 æœ€ç»ˆé€šçŸ¥12345//æœ€ç»ˆé€šçŸ¥@After(&quot;execution(public * addStudent(..))&quot;)public void myAfter(JoinPoint jp) &#123; System.out.println(&quot;ã€Šæ³¨è§£å½¢å¼ï¼šæœ€ç»ˆé€šçŸ¥ï¼šã€‹&quot;);&#125; 8. åŸºäºŽ Schema å½¢å¼çš„ AOPé€šè¿‡é…ç½®å°† ç±» â†’ é€šçŸ¥ åŸºäºŽSchemaé…ç½®ç±»ä¼¼äºŽå®žçŽ°æŽ¥å£çš„æ–¹å¼ æŽ¥å£æ–¹å¼é€šçŸ¥ï¼špublic class LogAfter implements AfterReturningAdvice Schemaæ–¹å¼é€šçŸ¥ï¼š ç¼–å†™ä¸€ä¸ªæ™®é€šç±»public class LogAfter&#123;&#125; å°†è¯¥ç±»é€šè¿‡é…ç½®ï¼Œè½¬ä¸ºä¸€ä¸ªâ€é€šçŸ¥â€œ å¦‚æžœè¦èŽ·å–ç›®æ ‡å¯¹è±¡ä¿¡æ¯ï¼š æ³¨è§£ã€schemaï¼šJoinPoint æŽ¥å£ï¼šMethod method, Object[] args, Object target 8.1 å‰ç½®é€šçŸ¥schemaå½¢å¼å’Œæ³¨è§£å½¢å¼ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„ï¼šæ³¨è§£å½¢å¼ä½¿ç”¨äº†æ³¨å†Œ@Afterï¼Œ schemalå½¢å¼è¿›è¡Œäº†å¤šä½™é…ç½® 123public void before(JoinPoint jp) &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šå‰ç½®é€šçŸ¥ã€‹:ç›®æ ‡å¯¹è±¡ï¼š&quot; + jp.getTarget() + &quot;,æ–¹æ³•åï¼š&quot; + jp.getSignature() + &quot;,å‚æ•°ä¸ªæ•°ï¼š&quot; + jp.getArgs().length);&#125; 8.2 åŽç½®é€šçŸ¥123public void afterReturning(JoinPoint jp, Object returnValue) throws Throwable &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šåŽç½®é€šçŸ¥ã€‹:ç›®æ ‡å¯¹è±¡ï¼š&quot; + jp.getTarget() + &quot;,æ–¹æ³•åï¼š&quot; + jp.getSignature() + &quot;,å‚æ•°ä¸ªæ•°ï¼š&quot; + jp.getArgs().length + &quot;,è¿”å›žå€¼ï¼š&quot; + returnValue);&#125; 8.3 çŽ¯ç»•é€šçŸ¥1234567891011121314public Object around(ProceedingJoinPoint jp) &#123; Object result = null; try &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ã€‹ï¼šå‰ç½®é€šçŸ¥&quot;); result = jp.proceed(); System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ã€‹ï¼šåŽç½®é€šçŸ¥&quot;); &#125;catch(Throwable e) &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ã€‹ï¼šå¼‚å¸¸é€šçŸ¥&quot;); &#125;finally &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šçŽ¯ç»•é€šçŸ¥ã€‹ï¼šæœ€ç»ˆé€šçŸ¥&quot;); &#125; return result;&#125; 8.4 å¼‚å¸¸é€šçŸ¥123public void whenException(JoinPoint jp, NullPointerException e) &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šå¼‚å¸¸é€šçŸ¥ã€‹:ç›®æ ‡å¯¹è±¡ï¼š&quot; + jp.getTarget() + &quot;,æ–¹æ³•åï¼š&quot; + jp.getSignature() + &quot;,å‚æ•°ä¸ªæ•°ï¼š&quot; + jp.getArgs().length +&quot;,å¼‚å¸¸ä¿¡æ¯ï¼š&quot; + e.getMessage());&#125; 8.5 æœ€ç»ˆé€šçŸ¥123public void after(JoinPoint jp) &#123; System.out.println(&quot;ã€ŠSechemaå½¢å¼ï¼šæœ€ç»ˆé€šçŸ¥ã€‹:ç›®æ ‡å¯¹è±¡ï¼š&quot; + jp.getTarget() + &quot;,æ–¹æ³•åï¼š&quot; + jp.getSignature() + &quot;,å‚æ•°ä¸ªæ•°ï¼š&quot; + jp.getArgs().length);&#125; 8.6 é…ç½®å¯¹ 5 ç§é€šçŸ¥çš„ç»Ÿä¸€é…ç½® 1234567891011&lt;bean id=&quot;logSchema&quot; class=&quot;org.student.aop.LogSchema&quot;&gt;&lt;/bean&gt;&lt;aop:config&gt; &lt;aop:pointcut expression=&quot;execution(public * org.student.service.impl.StudentServiceImpl.addStudent(..))&quot; id=&quot;pcSchema&quot;/&gt; &lt;aop:aspect ref=&quot;logSchema&quot;&gt; &lt;aop:before method=&quot;before&quot; pointcut-ref=&quot;pcSchema&quot;/&gt; &lt;aop:after-returning method=&quot;afterReturning&quot; returning=&quot;returnValue&quot; pointcut-ref=&quot;pcSchema&quot;/&gt; &lt;aop:after-throwing method=&quot;whenException&quot; pointcut-ref=&quot;pcSchema&quot; throwing=&quot;e&quot;/&gt; &lt;aop:around method=&quot;around&quot; pointcut-ref=&quot;pcSchema&quot;/&gt; &lt;/aop:aspect&gt; &lt;/aop:config&gt; 9. Spring å¼€å‘ Web é¡¹ç›®Springå¼€å‘Webé¡¹ç›®åŠæ‹†åˆ†Springé…ç½®æ–‡ä»¶ Webé¡¹ç›®å¦‚ä½•åˆå§‹åŒ–SpringIOCå®¹å™¨ï¼šæ€è·¯ï¼šå½“æœåŠ¡å¯åŠ¨æ—¶ï¼ˆtomcatï¼‰ï¼Œé€šè¿‡ç›‘å¬å™¨å°†SpringIOCå®¹å™¨åˆå§‹åŒ–ä¸€æ¬¡ å› æ­¤ç”¨springå¼€å‘webé¡¹ç›® è‡³å°‘éœ€è¦7ä¸ªjarï¼šspring-javaçš„6ä¸ªjar + spring-web.jarï¼Œ æ³¨æ„ï¼š webé¡¹ç›®çš„jaråŒ… æ˜¯å­˜åœ¨WEB-INF/libä¸­ é…ç½® web.xml æ–‡ä»¶ æ ¸å¿ƒä»£ç ï¼š 12345678910111213&lt;!-- å®¹å™¨é»˜è®¤çº¦æŸæ—¶ï¼Œä¸ç”¨é…ç½®ä½ç½®--&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;&lt;/context-param&gt;&lt;listener&gt; &lt;!-- é…ç½®spring-web.jaræä¾›çš„ç›‘å¬å™¨ï¼Œæ­¤ç›‘å¬å™¨ å¯ä»¥åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ åˆå§‹åŒ–IOCå®¹å™¨ï¼Œ åˆå§‹åŒ–IOCå®¹å™¨ï¼ˆapplicationContext.xmlï¼‰,å¿…é¡»å‘Šè¯‰ç›‘å¬å™¨ æ­¤å®¹å™¨çš„ä½ç½®ã€‚é€šè¿‡context-param é»˜è®¤çº¦æŸçš„ä½ç½®ï¼šWEB-INF/applicationContext.xml --&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;&lt;/listener&gt; å®Œæ•´ web.xml 123456789101112131415161718192021222324&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;3.0&quot;&gt; &lt;display-name&gt;SpringWebProject&lt;/display-name&gt; &lt;welcome-file-list&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt; &lt;welcome-file&gt;default.html&lt;/welcome-file&gt; &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt; &lt;/welcome-file-list&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;!-- é…ç½®spring-web.jaræä¾›çš„ç›‘å¬å™¨ï¼Œæ­¤ç›‘å¬å™¨ å¯ä»¥åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ åˆå§‹åŒ–IOCå®¹å™¨ï¼Œåˆå§‹åŒ–IOCå®¹å™¨ï¼ˆapplicationContext.xmlï¼‰,å¿…é¡»å‘Šè¯‰ç›‘å¬å™¨ æ­¤å®¹å™¨çš„ä½ç½®ã€‚é€šè¿‡context-param--&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt;&lt;/web-app&gt; 10. æ‹†åˆ†Spring é…ç½®æ–‡ä»¶10.1 javaé¡¹ç›® applicationContext1.xml applicationContext2.xml applicationContext3.xml 1ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); 10.2 Webé¡¹ç›®æ ¹æ®ä»€ä¹ˆæ‹†åˆ†ï¼Ÿ i.ä¸‰å±‚ç»“æž„ UI(html/css/jspã€Servlet) applicationController.xml Serviceï¼šapplicationService.xml Daoï¼šapplicationDao.xml å…¬å…± æ•°æ®åº“ï¼šapplicationDB.xml ii.åŠŸèƒ½ç»“æž„ å­¦ç”Ÿç›¸å…³é…ç½®ï¼šapplicationContextStudent.xml &lt;bean id=&quot;&quot; class=&quot;&quot;&gt;&lt;/bean&gt; ç­çº§ç›¸å…³é…ç½®ï¼šapplicationContextClass.xml åˆå¹¶ï¼šå¦‚ä½•å°†å¤šä¸ªé…ç½®æ–‡ä»¶åŠ è½½ åœ¨webä¸­é…ç½® ä¸‰ç§æ–¹æ³•ï¼š 12345678910&lt;!--ç¬¬ä¸€ç§ï¼š--&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt; classpath:applicationContext.xml, classpath:applicationContext-Dao.xml, classpath:applicationContext-Service.xml, classpath:applicationContext-Controller.xml &lt;/param-value&gt;&lt;/context-param&gt; 12345678&lt;!--ç¬¬äºŒç§ï¼š--&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt; classpath:applicationContext.xml, classpath:applicationContext-*.xml &lt;/param-value&gt;&lt;/context-param&gt; 1234567&lt;!--ç¬¬ä¸‰ç§ï¼š--&gt;&lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt; classpath:applicationContext.xml &lt;/param-value&gt;&lt;/context-param&gt; 123456&lt;!--åœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­é…ç½®--&gt;&lt;beans&gt; &lt;import resource=&quot;applicationContext-Dao.xml&quot;/&gt; &lt;import resource=&quot;applicationContext-Service.xml&quot;/&gt; &lt;import resource=&quot;applicationContext-Controller.xml&quot;/&gt;&lt;/beans&gt; 10.3 ç»“æž„ 11. Servlet å®¹å™¨ä¸Ž IOC å®¹å™¨æ ¸å¿ƒä»£ç ï¼š 1234/*é€šè¿‡servletèŽ·å–iocå®¹å™¨*/ApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(this.getServletContext()); /*èŽ·å–studentServiceçš„bean*/studentService = (IStudentService) context.getBean(&quot;studentService&quot;); servletçš„init()å‡½æ•°åœ¨è§¦å‘é“¾æŽ¥æˆ–è®¿é—®servletæ—¶æ‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ‰æ‰§è¡Œmethodå‡½æ•°ï¼ˆdoGetæˆ–doPostï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package org.student.servlet;import java.io.IOException;import javax.servlet.ServletException;import javax.servlet.annotation.WebServlet;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.support.WebApplicationContextUtils;import org.student.service.IStudentService;import org.student.service.impl.StudentServiceImpl;/** * Servlet implementation class queryStudentByIdServlet */@WebServlet(&quot;/queryStudentByIdServlet&quot;)public class queryStudentByIdServlet extends HttpServlet &#123; IStudentService studentService; public void setStudentService(IStudentService studentService) &#123; this.studentService = studentService; &#125; @Override public void init() throws ServletException &#123; //ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext-Service.xml&quot;); ApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(this.getServletContext()); studentService = (IStudentService) context.getBean(&quot;studentService&quot;); &#125; protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; String name = studentService.queryStudentById(); // ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); request.setAttribute(&quot;name&quot;, name); request.getRequestDispatcher(&quot;result.jsp&quot;).forward(request, response); &#125; protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doGet(request, response); &#125;&#125; 12. æ³¨è§£å½¢å¼çš„ä¾èµ–æ³¨å…¥12.1 service123456//&lt;bean id=&quot;studentService&quot; class=&quot;org.student.service.impl.StudentServiceImpl&quot;&gt;@Service(&quot;studentService&quot;)public class StudentServiceImpl implements IStudentService &#123; @Autowired //è‡ªåŠ¨è£…é…ï¼ŒbyType @Qualifier(&quot;stuDao&quot;) //byName(æ ¹æ®åå­—ï¼Œä¸¤ä¸ªéƒ½åŠ ) private IStudentDao studentDao; 12345678910@Service(&quot;studentService&quot;)public class StudentServiceImpl implements IStudentService &#123; &lt;!--ä½¿ç”¨resourceèƒ½å¯¹åå­—å’Œç±»åž‹è¿›è¡ŒåŒ¹é… è¦æ±‚ï¼š 1.å¿…é¡»æœ‰tomcatçš„æ”¯æŒï¼ˆä¸€èˆ¬webæ‰ä½¿ç”¨ï¼‰, æˆ–è€…ä½¿ç”¨pomå¯¼å…¥ä¾èµ–javax.annotation 2.ä¸éœ€è¦å†™setæ–¹æ³•æ¥åå°„ï¼ˆxmlé…ç½®çš„éœ€è¦ï¼‰ --&gt; @Resource(name = &quot;stuDao&quot;) private IStudentDao studentDao; 12.2 dao123//&lt;bean id=&quot;studentDao&quot; class=&quot;org.student.dao.impl.StudentDaoImpl&quot;/&gt;@Repository(&quot;studentDao&quot;)public class StudentDaoImpl implements IStudentDao&#123; 12.3 servlet1234//&lt;bean id=&quot;studentServlet&quot; class=&quot;org.student.servlet.queryStudentByIdServlet&quot;/&gt;@Controller(&quot;studentServlet&quot;)@WebServlet(&quot;/queryStudentByIdServlet&quot;)public class queryStudentByIdServlet extends HttpServlet &#123; 13. Spring æ•´åˆ MyBatis ä»¥åŠ SqlSessionDaoSupport æ•´åˆæ–¹å¼Spring - MyBatis 13.1 æ€è·¯SqlSessionFactory â†’ SqlSession â†’ StudentMapper â†’ CRUD å¯ä»¥å‘çŽ°ï¼Œ MyBatis æœ€ç»ˆæ˜¯é€šè¿‡SqlSessionFactoryæ¥æ“ä½œæ•°æ®åº“ï¼Œ Springæ•´åˆMyBatiså…¶å®žå°±æ˜¯ å°† MyBatisçš„SqlSessionFactoryäº¤ç»™Spring SMæ•´åˆæ­¥éª¤ï¼š jaråŒ… mybatis-spring.jar spring-tx.jar spring-jdbc.jar spring-expression.jar spring-context-support.jar spring-core.jar spring-context.jar spring-beanss.jar spring-aop.jar spring-web.jar commons-logging.jar commons.dbcp.jar ojdbc.jar mybatis.jar log4.jar commons-pool.jar ç±»-è¡¨ MyBatisé…ç½®æ–‡ä»¶conf.xml é€šè¿‡mapper.xmlå°† ç±»ã€è¡¨å»ºç«‹æ˜ å°„å…³ç³» ä¹‹å‰ä½¿ç”¨MyBatis.xml â†’ SqlSessionFactory çŽ°åœ¨æ•´åˆçš„æ—¶å€™ï¼Œéœ€è¦é€šè¿‡Springç®¡ç†SqlSessionFactoryï¼Œå› æ­¤ äº§ç”ŸSqlSessionFactoryæ‰€éœ€è¦çš„çš„æ•°æ®åº“ ä¿¡æ¯ä¸å†æ”¾å…¥conf.xmlï¼Œè€Œéœ€è¦æ”¾å…¥springé…ç½®æ–‡ä»¶ä¸­ é…ç½®springé…ç½®æ–‡ä»¶ï¼ˆapplicationContext.xmlï¼‰ ä½¿ç”¨Spring-MyBatisæ•´åˆäº§ç‰©å¼€å‘ç¨‹åº 13.2 ç›®æ ‡é€šè¿‡springäº§ç”Ÿmybatisæœ€ç»ˆæ“ä½œéœ€è¦çš„ åŠ¨æ€mapperå¯¹è±¡ï¼ˆStudentï¼‰ éœ€è¦å…ˆé…ç½®applicationContextä¾èµ–æ³¨å…¥bean daoä¸éœ€è¦sessionçš„commitå’Œcloseæ“ä½œï¼Œè‡ªåŠ¨æäº¤ 123456@Overridepublic void addStudent(Student student) &#123; SqlSession session = super.getSqlSession(); StudentMapper studentMapper = session.getMapper(StudentMapper.class); studentMapper.addStudent(student);&#125; service1234@Overridepublic void addStudent(Student student) &#123; studentMapper.addStudent(student);&#125; test1234567891011public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;); IStudentService studentService = (IStudentService) context.getBean(&quot;studentService&quot;); Student student = new Student(); student.setStuNo(3); student.setStuName(&quot;zds&quot;); student.setStuAge(33); studentService.addStudent(student);&#125; 13.3 å›¾è§£ 13.4 spring é…ç½®æ–‡ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt; &lt;bean id=&quot;config&quot; class=&quot;org.springframework.beans.factory.config.PreferencesPlaceholderConfigurer&quot;&gt; &lt;property name=&quot;locations&quot;&gt; &lt;array&gt; &lt;value&gt;classpath:db.properties&lt;/value&gt; &lt;/array&gt; &lt;/property&gt; &lt;/bean&gt; &lt;!-- ä¸Šè¿°æ–¹æ³•çŽ°åœ¨æå€¡ä½¿ç”¨ä¸‹é¢çš„å†™æ³• 1.è¦æ±‚ï¼šmapperæ–‡ä»¶åå’Œ daoæŽ¥å£åå¿…é¡»å®Œå…¨ä¸€æ ·ï¼ŒåŒ…æ‹¬å¤§å°å†™ 2.mapperå’ŒæŽ¥å£å¿…é¡»åœ¨åŒä¸€ç›®å½• --&gt; &lt;bean id=&quot;studentService&quot; class=&quot;org.student.service.impl.StudentServiceImpl&quot;&gt; &lt;property name=&quot;studentMapper&quot; ref=&quot;studentMapper&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;studentMapper&quot; class=&quot;org.student.dao.impl.StudentDaoImpl&quot;&gt; &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt; &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;driver&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxActive&quot; value=&quot;$&#123;maxActive&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxIdle&quot; value=&quot;$&#123;maxIdle&#125;&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt; &lt;!-- åŠ è½½mybatisé…ç½®æ–‡ä»¶ --&gt; &lt;property name=&quot;configLocation&quot; value=&quot;classpath:conf.xml&quot;&gt;&lt;/property&gt; &lt;!-- åŠ è½½mapper.xmlè·¯å¾„ --&gt; &lt;property name=&quot;mapperLocations&quot; value=&quot;org/student/mapper/*.xml&quot;&gt;&lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; 13.5 Springäº§ç”Ÿ åŠ¨æ€mapperå¯¹è±¡ æœ‰3ç§æ–¹æ³•ç¬¬ä¸€ç§æ–¹æ³• - SqlSessionDaoSupportDaoå±‚å®žçŽ°ç±» ç»§æ‰¿ SqlSessionDaoSupportç±» sqlSessionDaoSupportç±»æä¾›äº†ä¸€ä¸ªå±žæ€§ SqlSession 1234&lt;!-- ç¬¬ä¸€ç§æ–¹å¼ç”Ÿæˆmapperå¯¹è±¡ --&gt;&lt;bean id=&quot;studentMapper&quot; class=&quot;org.student.dao.impl.StudentDaoImpl&quot;&gt; &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot;&gt;&lt;/property&gt;&lt;/bean&gt; sqlSessionå·¥åŽ‚bean 12345&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt; &lt;!-- åŠ è½½mybatisé…ç½®æ–‡ä»¶ --&gt; &lt;property name=&quot;configLocation&quot; value=&quot;classpath:conf.xml&quot;&gt;&lt;/property&gt;&lt;/bean&gt; æ•°æ®æºbean 12345678&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt; &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;driver&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxActive&quot; value=&quot;$&#123;maxActive&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxIdle&quot; value=&quot;$&#123;maxIdle&#125;&quot;&gt;&lt;/property&gt;&lt;/bean&gt; ç¬¬äºŒç§æ–¹å¼ - MapperFactoryBeançœç•¥æŽ‰ ç¬¬ä¸€ç§æ–¹å¼çš„ å®žçŽ°ç±» ç›´æŽ¥ä½¿ç”¨MyBatisæä¾›çš„ Mapperå®žçŽ°ç±»ï¼šorg.mybatis.spring.mapper.MapperFactoryBean ç¼ºç‚¹ï¼šæ¯ä¸€ä¸ªmapperéƒ½éœ€è¦ä¸€ä¸ª 12345&lt;!-- ç¬¬äºŒç§æ–¹å¼ç”Ÿæˆmapperå¯¹è±¡ --&gt;&lt;bean id=&quot;studentMapper&quot; class=&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;&gt; &lt;property name=&quot;mapperInterface&quot; value=&quot;org.student.mapper.StudentMapper&quot;&gt;&lt;/property&gt; &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot;&gt;&lt;/property&gt;&lt;/bean&gt; sqlSessionå·¥åŽ‚bean 123456&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt; &lt;!-- åŠ è½½mybatisé…ç½®æ–‡ä»¶ --&gt; &lt;property name=&quot;configLocation&quot; value=&quot;classpath:conf.xml&quot;&gt;&lt;/property&gt;&lt;/bean&gt; æ•°æ®æºbean 12345678&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt; &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;driver&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxActive&quot; value=&quot;$&#123;maxActive&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxIdle&quot; value=&quot;$&#123;maxIdle&#125;&quot;&gt;&lt;/property&gt;&lt;/bean&gt; ç¬¬ä¸‰ç§æ–¹å¼ - MapperScannerConfiguredæ‰¹é‡é…ç½®å®žçŽ°ç±» 12345&lt;!-- ç¬¬ä¸‰ç§æ–¹å¼ç”Ÿæˆmapperå¯¹è±¡ --&gt;&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt; &lt;property name=&quot;basePackage&quot; value=&quot;org.student.mapper&quot;&gt;&lt;/property&gt; &lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot;&gt;&lt;/property&gt;&lt;/bean&gt; sqlSessionå·¥åŽ‚bean 123456&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt; &lt;!-- åŠ è½½mybatisé…ç½®æ–‡ä»¶ --&gt; &lt;property name=&quot;configLocation&quot; value=&quot;classpath:conf.xml&quot;&gt;&lt;/property&gt;&lt;/bean&gt; æ•°æ®æºbean 12345678&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot;&gt; &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;driver&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxActive&quot; value=&quot;$&#123;maxActive&#125;&quot;&gt;&lt;/property&gt; &lt;property name=&quot;maxIdle&quot; value=&quot;$&#123;maxIdle&#125;&quot;&gt;&lt;/property&gt;&lt;/bean&gt; æ³¨æ„ï¼š ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æ–¹å¼ä¸­ï¼š ç¬¬äºŒç§çš„sqlSessionå·¥åŽ‚sqlSessionFactoryä¸ºå¯¹è±¡ç±»åž‹ï¼Œå±žæ€§å€¼ç”¨å¼•ç”¨ref ç¬¬ä¸‰ç§çš„sqlSessionå·¥åŽ‚sqlSessionFactoryBeanNameæ˜¯Stringç±»åž‹ï¼Œå±žæ€§å€¼ç”¨value web é…ç½®æ–‡ä»¶1234567891011121314151617181920212223242526272829303132&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;3.0&quot;&gt; &lt;display-name&gt;SpringWebProject&lt;/display-name&gt; &lt;welcome-file-list&gt; &lt;welcome-file&gt;index.html&lt;/welcome-file&gt; &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt; &lt;welcome-file&gt;default.html&lt;/welcome-file&gt; &lt;welcome-file&gt;default.htm&lt;/welcome-file&gt; &lt;welcome-file&gt;default.jsp&lt;/welcome-file&gt; &lt;/welcome-file-list&gt; &lt;context-param&gt; &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt; &lt;param-value&gt; &lt;!-- classpath:applicationContext.xml,--&gt; classpath:applicationContext-*.xml &lt;!-- classpath:applicationContext-Dao.xml, classpath:applicationContext-Service.xml, classpath:applicationContext-Controller.xml--&gt; &lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;!-- é…ç½®spring-web.jaræä¾›çš„ç›‘å¬å™¨ï¼Œæ­¤ç›‘å¬å™¨ å¯ä»¥åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶ åˆå§‹åŒ–IOCå®¹å™¨ï¼Œ åˆå§‹åŒ–IOCå®¹å™¨ï¼ˆapplicationContext.xmlï¼‰,å¿…é¡»å‘Šè¯‰ç›‘å¬å™¨ æ­¤å®¹å™¨çš„ä½ç½®ã€‚é€šè¿‡context-param --&gt; &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt; &lt;/listener&gt;&lt;/web-app&gt; â€‹ â€‹","categories":[{"name":"Javaæ¡†æž¶","slug":"Javaæ¡†æž¶","permalink":"http://fyupeng.github.io/categories/Java%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"http://fyupeng.github.io/tags/Spring/"}],"author":"fyupeng"},{"title":"MongoDB","slug":"MongoDB","date":"2022-06-25T07:50:51.000Z","updated":"2022-06-25T07:54:19.810Z","comments":true,"path":"2022/06/25/MongoDB/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/MongoDB/","excerpt":"","text":"ä¸€ã€ç®€ä»‹ç®€ä»‹ï¼šMongoDBæ˜¯ä¸€ç§NOSQLï¼ˆNot Only Sqlï¼‰æ•°æ®åº“ æ•°æ®è¡¨ -&gt;JDBCè¯»å–-&gt;POJOï¼ˆVOã€POï¼‰-&gt;æŽ§åˆ¶å±‚è½¬åŒ–ä¸ºJSONæ•°æ®-&gt;å®¢æˆ·ç«¯ No å…³ç³»åž‹æ•°æ®åº“ éžå…³ç³»åž‹æ•°æ®åº“ 1 æ•°æ®åº“ æ•°æ®åº“ï¼ˆç±»ä¼¼äºŽMySQLï¼‰ 2 è¡¨ é›†åˆ 3 è¡Œ æ–‡æ¡£ 4 åˆ— æˆå‘˜ 5 ä¸»é”® Object IDï¼ˆè‡ªåŠ¨ç»´æŠ¤ï¼‰ åœ¨æ•´ä¸ªè¡Œä¸šä¹‹ä¸­ï¼ŒMongoDBæ•°æ®åº“æ˜¯å‘å±•æœ€å¥½çš„ä¸€ä¸ªNoSQLæ•°æ®åº“ï¼Œå› ä¸ºå®ƒä¸ŽNode.JSæ†ç»‘åœ¨ä¸€èµ·äº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æžœä½ è¦ä»Žäº‹Node.JSå¼€å‘ï¼Œé‚£ä¹ˆä¸€å®šè¦ä½¿ç”¨MongDBï¼Œè€ŒNode.JSï¼ˆåŸºäºŽjavaScriptï¼‰åœ¨å›½å†…æœ€æˆåŠŸçš„åº”ç”¨ â€“taobao MongoDBä¹‹æ‰€ä»¥èƒ½å¤Ÿæ›´å¥½çš„å‘å±•ä¹Ÿå–å†³äºŽï¼šé¢å‘é›†åˆçš„å­˜å‚¨è¿‡ç¨‹ã€æ¨¡å¼è‡ªç”±ï¼ˆæ— æ¨¡å¼ï¼‰ã€æ–¹ä¾¿çš„è¿›è¡Œæ•°æ®çš„å­˜å‚¨æ‰©å……ã€ æ”¯æŒç´¢å¼•ã€æ”¯æŒçŸ­æš‚æ•°æ®ä¿ç•™ã€å…·æœ‰å®Œæ•´çš„æ•°æ®çŠ¶æ€ç›‘æŽ§ã€åŸºäºŽBSONåº”ç”¨ ä¸šåŠ¡åº”ç”¨åœºæ™¯ï¼šHigh performace - å¯¹æ•°æ®åº“å¹¶å‘è¯»å†™çš„éœ€æ±‚ Huge Storage - å¯¹æµ·é‡æ•°æ®çš„é«˜æ•ˆçŽ‡å­˜å‚¨å’Œè®¿é—®çš„éœ€æ±‚ High Scalablity &amp;&amp; High Avaliablity - å¯¹æ•°æ®åº“çš„é«˜æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§çš„éœ€æ±‚ äºŒã€å®‰è£…ä¸Žé…ç½®ä¸‹è½½ windowsè¿›å…¥binç›®å½•æ‰“å¼€cmdé…ç½®dbï¼š å…ˆåˆ›å»ºdata/dbç›®å½•å­˜æ”¾æ•°æ®ï¼Œå†æ‰‹åŠ¨å‘½ä»¤è¡Œé…ç½®ï¼š 1monogd --dbpath ..\\data\\db æˆ– bç¼–å†™/config/mongod.conf 12#The directoy where the mongod instance stores its data.Default Value is &quot;\\data\\db&quot; on windows.dbpath=D:\\study\\software\\MongoDB\\MongoDB-4.2.15\\data\\db ç¬¬ä¸€ç§ï¼š 1mongod -f ../config/mongd.conf ç¬¬äºŒç§ï¼š 1mongod --config ../config/mongod.conf Linuxåˆ›å»ºdataå’Œlogç›®å½•ï¼Œé…ç½®æŒ‡å®šè¯¥dbç›®å½•å’Œlogæ—¥å¿—æ–‡ä»¶è·¯å¾„ é…ç½®/usr/local/mongodb/single/mongod.conf 12345678910111213141516171819systemLog: destination: file path: &quot;/usr/local/mongodb-4.2.15/single/log/mongod.log&quot; logAppend: truestorage: dbPath: &quot;/usr/local/mongodb-4.2.15/single/data/db&quot; journal: enabled: trueprocessManagement: fork: truenet: bindIp: localhost,172.30.77.41 port: 27017 é…ç½®å®ŒæˆåŽå¯åŠ¨ï¼š 1mongodb-4.2.15]# bin/mongod -f ./single/mongod.conf æç¤ºï¼š 12forked process: 208809child process started successfully, parent exiting ç™»å½•æ•°æ®åº“ 1/bin/mongo ä¸‰ã€æ•°æ®åº“çš„åˆ›å»ºä¸Žåˆ é™¤åˆ›å»ºï¼š 1use articledb åˆ é™¤ï¼š 1db.dropDatabase() æŸ¥çœ‹å½“å‰æ•°æ®åº“ 1db å››ã€é›†åˆæ“ä½œæŸ¥çœ‹é›†åˆ 1show collections äº”ã€æ–‡æ¡£æ“ä½œæ’å…¥ï¼šæ’å…¥å•ä¸ªæ–‡æ¡£ 1db.comment.insert(&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1001&quot;,&quot;status&quot;:null&#125;) æ’å…¥å¤šæ¡æ–‡æ¡£ 1234567db.comment.insertMany([&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1001&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1002&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1003&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1005&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1005&quot;,&quot;status&quot;:null&#125;,]) è¿˜å¯ä»¥ä½¿ç”¨ 1234567891011try&#123;db.comment.insertMany([&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1001&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1002&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1003&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1005&quot;,&quot;status&quot;:null&#125;,&#123;&quot;article&quot;:&quot;10000&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;,&quot;userid&quot;:&quot;1005&quot;,&quot;status&quot;:null&#125;,]);&#125;catch(e)&#123; print(e);&#125; æŸ¥è¯¢ï¼š1db.comment.find() ä»£å‚æŸ¥è¯¢æ»¡è¶³æ¡ä»¶ï¼Œå¯èƒ½ä¸æ­¢ä¸€æ¡ å¸¦ä¸€ä¸ªå‚æ•° 1db.comment.find(&#123;userid:&quot;1003&quot;&#125;) å¸¦å¤šä¸ªå‚æ•° 1db.comment.find(&#123;article:&quot;10000&quot;&#125;,&#123;userid:&quot;1003&quot;&#125;) æŸ¥è¯¢ä¸€æ¡ 1db.comment.findOne(&#123;userid:&quot;1002&quot;&#125;) æ›´æ–°ï¼šè¦†ç›–æ›´æ–°ï¼Œjsonå¯¹è±¡ä¼šæ›´æ–°è¦†ç›–ï¼ˆä¼šå¤±åŽ»æ²¡æœ‰ä¿®æ”¹è¿‡çš„jsonå¯¹è±¡ï¼‰ 1db.comment.update(&#123;_id:ObjectId(&quot;61221f645f7003e989379e40&quot;)&#125;, &#123;status:&quot;1&quot;&#125;) æ¯”å¦‚ï¼š 1&#123; &quot;_id&quot; : ObjectId(&quot;61221f645f7003e989379e40&quot;), &quot;article&quot; : &quot;10000&quot;, &quot;content&quot; : &quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;, &quot;userid&quot; : &quot;1001&quot;, &quot;status&quot; : null &#125; ç»“æžœï¼š 1&#123; &quot;_id&quot; : ObjectId(&quot;61221f645f7003e989379e40&quot;), &quot;status&quot; : &quot;1&quot; &#125; éžè¦†ç›–æ›´æ–°ï¼ˆåŽŸjsonå¯¹è±¡ä¿æŒä¸å˜ï¼‰ 1db.comment.update(&#123;_id:ObjectId(&quot;61221f645f7003e989379e41&quot;)&#125;, &#123;$set:&#123;status:&quot;1&quot;&#125;&#125;) æ¯”å¦‚ï¼š 1&#123; &quot;_id&quot; : ObjectId(&quot;61221f645f7003e989379e41&quot;), &quot;article&quot; : &quot;10000&quot;, &quot;content&quot; : &quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;, &quot;userid&quot; : &quot;1002&quot;, &quot;status&quot; : null &#125; ç»“æžœï¼š 1&#123; &quot;_id&quot; : ObjectId(&quot;61221f645f7003e989379e41&quot;), &quot;article&quot; : &quot;10000&quot;, &quot;content&quot; : &quot;ä»Šå¤©å¤©æ°”çœŸå¥½&quot;, &quot;userid&quot; : &quot;1002&quot;, &quot;status&quot; : &quot;1&quot; &#125; å¦‚æžœæŸ¥è¯¢ç»“æžœæœ‰å¤šä¸ªï¼Œæƒ³æŠŠå®ƒä»¬éƒ½ä¿®æ”¹äº†ï¼Œå‚æ•°åŽé¢è·Ÿä¸Šä¸€ä¸ªjsonå¯¹è±¡ {multi: true} ï¼Œè¡¨æ˜Žå…¨éƒ¨ä¿®æ”¹ï¼Œé»˜è®¤åªä¿®æ”¹ç¬¬ä¸€æ¡ æ ¹æ®idè‡ªå¢žå­—æ®µ 1db.comment.update(&#123;_id:&quot;612376cde9acd86e0584f8cd&quot;&#125;,&#123;$inc:&#123;likenum:NumberInt(1)&#125;&#125;) åˆ é™¤ï¼šæŸ¥è¯¢åˆ°æ»¡è¶³æ¡ä»¶çš„éƒ½åˆ é™¤ 1db.comment.remove(&#123;userid:&quot;1002&quot;&#125;) å…­ã€æ–‡æ¡£åˆ†é¡µæŸ¥è¯¢ç»Ÿè®¡æŸ¥è¯¢ï¼šè¿”å›žæŸ¥è¯¢çš„æ¡æ•° 1db.comment.count() åˆ†é¡µåˆ—è¡¨æŸ¥è¯¢ï¼šè¿”å›žæŸ¥è¯¢çš„å‰ä¸‰æ¡æ•°æ® 1db.comment.find().limit(3) è·³è¿‡å‰ä¸¤æ¡æ•°æ®ï¼Œè¿”å›žæŸ¥è¯¢çš„ä¸‰æ¡æ•°æ® 1db.comment.find().limit(3).skip(2) æŽ’åºæŸ¥è¯¢ï¼šå¯¹æŸä¸€æˆå‘˜è¿›è¡ŒæŽ’åº 1.å‡åºï¼š{userid:1} 2.é™åºï¼š{userid:-1} å•ä¸ªæŽ’åº 1db.comment.find().sort(&#123;userid:1&#125;) å¤šä¸ªæŽ’åº 1db.comment.find().sort(&#123;userid:1&#125;,status:&quot;-1&quot;) ä¸ƒã€æ–‡æ¡£çš„æ›´å¤šæŸ¥è¯¢æ¨¡ç³ŠæŸ¥è¯¢/æ­£åˆ™è¡¨è¾¾å¼å¤æ‚æŸ¥è¯¢ï¼šdb,collection.find(field:/æ­£åˆ™è¡¨è¾¾å¼/) 1db.comment.find(&#123;content:/å¤©æ°”/&#125;) æ¯”è¾ƒæŸ¥è¯¢ï¼šdb.é›†åˆåç§°.find({â€œfieldâ€:{$gt: value }}) //å¤§äºŽ db.é›†åˆåç§°.find({â€œfieldâ€:{$lt: value }}) //å¤§äºŽ db.é›†åˆåç§°.find({â€œfieldâ€:{$gte: value }}) //å¤§äºŽç­‰äºŽ db.é›†åˆåç§°.find({â€œfieldâ€:{$lte: value }}) //å°äºŽç­‰äºŽ db.é›†åˆåç§°.find({â€œfieldâ€:{$ne: value }}) //ä¸ç­‰äºŽ åŒ…å«ï¼š db.é›†åˆåç§°.find({userid:{$in:[â€œ1003â€,â€1004â€]}}) ä¸åŒ…å« db.é›†åˆåç§°.find({userid:{$nin:[â€œ1003â€,â€1004â€]}}) æ¡ä»¶æŸ¥è¯¢ï¼šandï¼šå’Œ 12345db.é›†åˆåç§°.find(&#123;$and: [ &#123;likenum:&#123;$lt:NumberInt(700)&#125;&#125;,&#123;likenum:&#123;$lt:NumberInt(2000)&#125;&#125; ] &#125;) orï¼šæˆ– 12345db.é›†åˆåç§°.find(&#123;$or: [ &#123;likenum:&#123;$lt:NumberInt(700)&#125;&#125;,&#123;likenum:&#123;$gt:NumberInt(2000)&#125;&#125; ] &#125;) å…«ã€ç´¢å¼•ç®¡ç†æ“ä½œåˆ›å»ºç´¢å¼•:å•å­—æ®µï¼š 1db.comment.createIndex(&#123;userid:1&#125;) å¤šå­—æ®µç´¢å¼•ï¼š 1db.comment.createIndex(&#123;userid:1,content:-1&#125;) èŽ·å–ç´¢å¼•ï¼š1db.comment.getIndexes() ç§»é™¤ç´¢å¼•ï¼šæŒ‰ç…§è§„åˆ™ï¼š 1db.comment.dropIndex(&#123;userid:1&#125;) æŒ‰ç…§name: 1db.comment.dropIndex(&quot;userid_1_content_-1&quot;) ç§»é™¤æ‰€æœ‰ç´¢å¼•ï¼Œé™¤äº†é»˜è®¤ç´¢å¼• 1db.comment.dropIndexes() ä¹ã€ç´¢å¼•çš„ä½¿ç”¨æ‰§è¡Œè®¡åˆ’ï¼š1db.comment.find(&#123;userid:&quot;1003&quot;&#125;).explain() æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼šé›†åˆæ‰«æ 12&quot;winningPlan&quot; : &#123; &quot;stage&quot; : &quot;COLLSCAN&quot;, ä½¿ç”¨ç´¢å¼•ï¼šç´¢å¼•æ‰«æã€å†ä»Žé›†åˆæŠ“å– 1234&quot;winningPlan&quot; : &#123; &quot;stage&quot; : &quot;FETCH&quot;, &quot;inputStage&quot; : &#123; &quot;stage&quot; : &quot;IXSCAN&quot;, æ¶µç›–çš„æŸ¥è¯¢ï¼šä¸åŽ»é›†åˆæŸ¥è¯¢ï¼Œè€Œç›´æŽ¥æŸ¥è¯¢ç´¢å¼•è¿”å›žï¼Œæ•°æ®ä»Žç´¢å¼•æ‹¿åˆ° 1db.comment.find(&#123;userid:&quot;1003&quot;&#125;,&#123;userid:1,_id:0&#125;) åã€findByå±žæ€§å­—æ®µåˆ†é¡µæŸ¥è¯¢ç»§æ‰¿æŽ¥å£findByå±žæ€§æ–¹æ³•ï¼Œä»Žè€Œè°ƒç”¨æ¡†æž¶æ–¹æ³•æŸ¥è¯¢åˆ†é¡µ daoæŽ¥å£ï¼š123public interface CommentRepository extends MongoRepository&lt;Comment, String&gt; &#123; Page&lt;Comment&gt; findByParentid(String parentid, Pageable pageable);&#125; serviceå®žçŽ°ï¼š1234@Override public Page&lt;Comment&gt; findCommentByParentid(String parentid, int page, int size) &#123; return commentRepository.findByParentid(parentid, PageRequest.of(page, size)); &#125; pageçš„ç´¢å¼•ä»Ž0å¼€å§‹ï¼Œsizeæ˜¯é¡µé¢å¤§å°123456@Testpublic void testFindCommentByParentid()&#123; Page&lt;Comment&gt; page = commentService.findCommentByParentid(&quot;3&quot;, 0, 3); System.out.println(page.getTotalElements()); System.out.println(page.getContent());&#125; åä¸€ã€mongoTemplateå®žçŽ°ç‚¹èµž123456789101112131415@Overridepublic void updateCommentLikenum(String id) &#123; //æŸ¥è¯¢æ¡ä»¶ Query query = Query.query(Criteria.where(&quot;_id&quot;).is(id)); System.out.println(query); //æ›´æ–°æ¡ä»¶ Update update = new Update(); update.inc(&quot;likenum&quot;); UpdateResult updateResult = mongoTemplate.updateFirst(query, update, Comment.class); System.out.println(updateResult);&#125; 1234@Testpublic void testUbpdateCommentLikenum()&#123; commentService.updateCommentLikenum(&quot;612376cde9acd86e0584f8cd&quot;);&#125; åäºŒã€å‰¯æœ¬é›†å‰¯æœ¬é›†ä¸‰ä¸ªè§’è‰²ï¼šä¸»è¦æˆå‘˜ï¼ˆPrimaryï¼‰ï¼šä¸»è¦æŽ¥æ”¶æ‰€æœ‰å†™æ“ä½œï¼Œå°±æ˜¯ä¸»èŠ‚ç‚¹ã€‚ å‰¯æœ¬æˆå‘˜ï¼ˆReplicateï¼‰ï¼šä»Žä¸»èŠ‚ç‚¹é€šè¿‡å¤åˆ¶æ“ä½œä»¥ç»´æŠ¤ç›¸åŒçš„æ•°æ®é›†ï¼Œå³å¤‡ä»½æ•°æ®ï¼Œä¸å¯å†™æ“ä½œï¼Œä½†å¯ä»¥è¯»æ“ä½œï¼ˆéœ€è¦é…ç½®ï¼‰ï¼Œæ˜¯é»˜è®¤çš„ä¸€ç§ä»ŽèŠ‚ç‚¹ç±»åž‹ã€‚ ä»²è£è€…ï¼ˆArbiterï¼‰ï¼šä¸ä¿ç•™ä»»ä½•æ•°æ®çš„å‰¯æœ¬ï¼Œåªå…·æœ‰æŠ•ç¥¨é€‰ä¸¾ä½œç”¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†ä»²è£æœåŠ¡å™¨ç»´æŠ¤ä¸ºå‰¯æœ¬é›†çš„ä¸€éƒ¨åˆ†ï¼Œå³å‰¯æœ¬æˆå‘˜åŒæ—¶ä¹Ÿå¯ä»¥æ˜¯ä»²è£è€…ï¼Œä¹Ÿæ˜¯ä¸€ç§ä»ŽèŠ‚ç‚¹ç±»åž‹ã€‚ å‰¯æœ¬é›†çš„åˆ›å»ºï¼šå‰¯æœ¬é›†æž¶æž„ç›®æ ‡ï¼šä¸€ä¸»ä¸€å‰¯æœ¬ä¸€ä»²è£ ï¼ˆ1ï¼‰é¦–å…ˆå…ˆåšå®‰å…¨è®¤è¯ 12345openssl rand -base64 90 -out /etc/mongodb/mongodb-keyfilegroupadd mongodbuseradd -g mongodb monngodb chown -R mongodb.mongodb /etc/mongodb/mongodb-keyfile #ç¦æ­¢è®¿é—®å®‰å…¨è¯ä¹¦chmod 600 /etc/mongodb/mongodb-keyfile #åªå…è®¸rootç”¨æˆ·è¯»å†™ï¼Œæœ¬åœ°å’Œå…¶ä»–ç”¨æˆ·æ— æƒé™ ä¸»èŠ‚ç‚¹ï¼š12mkdir -p /usr/local/mongodb-4.2.15/replica_sets/myrs_27017/log \\ &amp;mkdir -p /usr/local/mongodb-4.2.15/replica_sets/myrs_27017/data/db 27017ï¼ˆmongod.confï¼‰: 123456789101112131415161718192021222324252627282930313233343536373839404142434445#SystemLog OptionssystemLog:#MongoDBå‘é€æ‰€æœ‰æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡æŒ‡å®šä¸ºæ–‡ä»¶ destination: file #mongodæˆ–mongosåº”å‘å…¶å‘é€æ‰€æœ‰è¯Šæ–­æ—¥å¿—è®°å½•ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ path: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27017/log/mongod.log&quot; #å½“mongosæˆ–mongodå®žä¾‹é‡æ–°å¯åŠ¨æ—¶ï¼Œmongosæˆ–mongodä¼šå°†æ–°æ¡ç›®é™„åŠ åˆ°çŽ°æœ‰æ—¥å¿—æ–‡ä»¶çš„æœ«å°¾ logAppend: true#storage Optionsstorage: #mongodå®žä¾‹å­˜å‚¨å…¶æ•°æ®çš„ç›®å½•ã€‚storage.dbPathè®¾ç½®ä»…é€‚ç”¨äºŽmongodã€‚ dbPath: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27017/data/db&quot; journal: #å¯ç”¨æˆ–ç¦ç”¨æŒä¹…æ€§æ—¥å¿—ä»¥ç¡®ä¿æ•°æ®æ–‡ä»¶ä¿æŒæœ‰æ•ˆå’Œå¯æ¢å¤ã€‚ enabled: true#processManagement OptionsprocessManagement: #å¯ç”¨åœ¨åŽå°è¿è¡Œmongosæˆ–mongodè¿›ç¨‹çš„å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚ fork: true #æŒ‡å®šç”¨äºŽä¿å­˜mongosæˆ–mongodè¿›ç¨‹çš„è¿›ç¨‹IDçš„æ–‡ä»¶ä½ç½®ï¼Œå…¶ä¸­mongosæˆ–mongodå°†å†™å…¥å…¶PID pidFilePath: &quot;/mongodb/replica_sets/myrs_27017/log/mongod.pid&quot;#net Optionsnet: #æœåŠ¡å®žä¾‹ç»‘å®šæ‰€æœ‰IPï¼Œæœ‰å‰¯ä½œç”¨ï¼Œå‰¯æœ¬é›†åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹åå­—ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºæœ¬åœ°åŸŸåï¼Œè€Œä¸æ˜¯ip #bindIpAll: true #æœåŠ¡å®žä¾‹ç»‘å®šçš„IP bindIp: localhost,172.30.77.41 #bindIp #ç»‘å®šçš„ç«¯å£ port: 27017#å®‰å…¨è®¤è¯security: authorization: enabled keyFile: &quot;/etc/mongodb/mongodb-keyfile&quot;#replication Optionsreplication: #å‰¯æœ¬é›†çš„åç§° replSetName: myrs å¯åŠ¨ï¼š 1/usr/local/mongodb-4.2.15/bin/mongod -f /usr/local/mongodb-4.2.15/replica_sets/myrs_27017/mongod.conf å‰¯æœ¬èŠ‚ç‚¹ï¼š12mkdir -p /usr/local/mongodb-4.2.15/replica_sets/myrs_27018/log \\ &amp;mkdir -p /usr/local/mongodb-4.2.15/replica_sets/myrs_27018/data/db 27018ï¼ˆmongod.confï¼‰: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#SystemLog OptionssystemLog:#MongoDBå‘é€æ‰€æœ‰æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡æŒ‡å®šä¸ºæ–‡ä»¶ destination: file #mongodæˆ–mongosåº”å‘å…¶å‘é€æ‰€æœ‰è¯Šæ–­æ—¥å¿—è®°å½•ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ path: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27018/log/mongod.log&quot; #å½“mongosæˆ–mongodå®žä¾‹é‡æ–°å¯åŠ¨æ—¶ï¼Œmongosæˆ–mongodä¼šå°†æ–°æ¡ç›®é™„åŠ åˆ°çŽ°æœ‰æ—¥å¿—æ–‡ä»¶çš„æœ«å°¾ logAppend: true#storage Optionsstorage: #mongodå®žä¾‹å­˜å‚¨å…¶æ•°æ®çš„ç›®å½•ã€‚storage.dbPathè®¾ç½®ä»…é€‚ç”¨äºŽmongodã€‚ dbPath: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27018/data/db&quot; journal: #å¯ç”¨æˆ–ç¦ç”¨æŒä¹…æ€§æ—¥å¿—ä»¥ç¡®ä¿æ•°æ®æ–‡ä»¶ä¿æŒæœ‰æ•ˆå’Œå¯æ¢å¤ã€‚ enabled: true#processManagement OptionsprocessManagement: #å¯ç”¨åœ¨åŽå°è¿è¡Œmongosæˆ–mongodè¿›ç¨‹çš„å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚ fork: true #æŒ‡å®šç”¨äºŽä¿å­˜mongosæˆ–mongodè¿›ç¨‹çš„è¿›ç¨‹IDçš„æ–‡ä»¶ä½ç½®ï¼Œå…¶ä¸­mongosæˆ–mongodå°†å†™å…¥å…¶PID pidFilePath: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27018/log/mongod.pid&quot;#net Optionsnet: #æœåŠ¡å®žä¾‹ç»‘å®šæ‰€æœ‰IPï¼Œæœ‰å‰¯ä½œç”¨ï¼Œå‰¯æœ¬é›†åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹åå­—ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºæœ¬åœ°åŸŸåï¼Œè€Œä¸æ˜¯ip #bindIpAll: true #æœåŠ¡å®žä¾‹ç»‘å®šçš„IP bindIp: localhost,172.30.77.41 #bindIp #ç»‘å®šçš„ç«¯å£ port: 27018#å®‰å…¨è®¤è¯security: authorization: enabled keyFile: &quot;/etc/mongodb/mongodb-keyfile&quot;#replication Optionsreplication: #å‰¯æœ¬é›†çš„åç§° replSetName: myrs å¯åŠ¨ï¼š 1/usr/local/mongob-4.2.15/bin/mongod -f /usr/local/mongodb-4.2.15/replica_sets/myrs_27018/mongod.conf ä»²è£èŠ‚ç‚¹ï¼š12mkdir -p /usr/local/mongodb-4.2.15/replica_sets/myrs_27019/log \\ &amp;mkdir -p /usr/local/mongodb-4.2.15/replica_sets/myrs_27019/data/db 27019ï¼ˆmongod.confï¼‰: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253#SystemLog OptionssystemLog:#MongoDBå‘é€æ‰€æœ‰æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡æŒ‡å®šä¸ºæ–‡ä»¶ destination: file #mongodæˆ–mongosåº”å‘å…¶å‘é€æ‰€æœ‰è¯Šæ–­æ—¥å¿—è®°å½•ä¿¡æ¯çš„æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ path: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27019/log/mongod.log&quot; #å½“mongosæˆ–mongodå®žä¾‹é‡æ–°å¯åŠ¨æ—¶ï¼Œmongosæˆ–mongodä¼šå°†æ–°æ¡ç›®é™„åŠ åˆ°çŽ°æœ‰æ—¥å¿—æ–‡ä»¶çš„æœ«å°¾ logAppend: true#storage Optionsstorage: #mongodå®žä¾‹å­˜å‚¨å…¶æ•°æ®çš„ç›®å½•ã€‚storage.dbPathè®¾ç½®ä»…é€‚ç”¨äºŽmongodã€‚ dbPath: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27019/data/db&quot; journal: #å¯ç”¨æˆ–ç¦ç”¨æŒä¹…æ€§æ—¥å¿—ä»¥ç¡®ä¿æ•°æ®æ–‡ä»¶ä¿æŒæœ‰æ•ˆå’Œå¯æ¢å¤ã€‚ enabled: true#processManagement OptionsprocessManagement: #å¯ç”¨åœ¨åŽå°è¿è¡Œmongosæˆ–mongodè¿›ç¨‹çš„å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚ fork: true #æŒ‡å®šç”¨äºŽä¿å­˜mongosæˆ–mongodè¿›ç¨‹çš„è¿›ç¨‹IDçš„æ–‡ä»¶ä½ç½®ï¼Œå…¶ä¸­mongosæˆ–mongodå°†å†™å…¥å…¶PID pidFilePath: &quot;/usr/local/mongodb-4.2.15/replica_sets/myrs_27019/log/mongod.pid&quot;#net Optionsnet: #æœåŠ¡å®žä¾‹ç»‘å®šæ‰€æœ‰IPï¼Œæœ‰å‰¯ä½œç”¨ï¼Œå‰¯æœ¬é›†åˆå§‹åŒ–çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹åå­—ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºæœ¬åœ°åŸŸåï¼Œè€Œä¸æ˜¯ip #bindIpAll: true #æœåŠ¡å®žä¾‹ç»‘å®šçš„IP bindIp: localhost,172.30.77.41 #bindIp #ç»‘å®šçš„ç«¯å£ port: 27019#å®‰å…¨è®¤è¯security: authorization: enabled keyFile: &quot;/etc/mongodb/mongodb-keyfile&quot;#replication Optionsreplication: #å‰¯æœ¬é›†çš„åç§° replSetName: myrs å¯åŠ¨ï¼š 1/usr/local/mongodb-4.2.15/bin/mongod -f /usr/local/mongodb-4.2.15/replica_sets/myrs_27019/mongod.conf åˆå§‹åŒ–å‰¯æœ¬é›†ï¼šå®¢æˆ·ç«¯ç™»å½•ï¼š 1./mongo --host=172.30.77.41 --port=27017 1&gt; rs.initiate() åˆ‡è®°ï¼Œå…¶ä»–èŠ‚ç‚¹ä¸è¦åˆå§‹åŒ–ï¼Œæˆ–è€… 12345678910config=&#123; _id:&#x27;mongo_rep&#x27;,members:[ &#123;_id:0, host:&#x27;192.168.163.125:27017&#x27;&#125;, &#123;_id:1, host:&#x27;192.168.163.126:27017&#x27;&#125;, &#123;_id:2, host:&#x27;192.168.163.127:27017&#x27;&#125;, &#123;_id:3, host:&#x27;192.168.163.128:27017&#x27;&#125; ]&#125;rs.initiate(config) 1rs.conf() å»ºç«‹è§’è‰²å’Œè´¦å·, ç”¨äºŽç®¡ç†å‰¯æœ¬é›† 12345678use admindb.createUser( &#123; user:&quot;root&quot;, pwd:&quot;root&quot;, roles:[&#123;role:&quot;root&quot;,db:&quot;admin&quot;&#125;] &#125;) 1db.auth(&quot;root&quot;,&quot;root&quot;) #éªŒè¯èº«ä»½æ‰èƒ½ä½¿ç”¨å‘½ä»¤ 1db.getUsers() è¯´æ˜Žï¼š â€œ_idâ€ï¼šâ€œmyrsâ€ï¼šå‰¯æœ¬é›†çš„é…ç½®æ•°æ®å­˜å‚¨çš„ä¸»é”®å€¼ï¼Œé»˜è®¤å°±æ˜¯å‰¯æœ¬é›†çš„åå­— â€œmembersâ€ï¼šå‰¯æœ¬é›†æˆå‘˜æ•°ç»„ï¼Œæ­¤æ—¶åªæœ‰ä¸€ä¸ªâ€œhostâ€ï¼šâ€œ172.30.77.41â€ï¼Œè¯¥æˆå‘˜ä¸æ˜¯ä»²è£èŠ‚ç‚¹ï¼šâ€œarbiterOnlyâ€ï¼šfalseï¼Œä¼˜å…ˆçº§ï¼ˆæƒé‡å€¼ï¼‰ï¼šâ€priorityâ€ï¼š1 â€œsettingâ€ï¼šå‰¯æœ¬é›†çš„å‚æ•°é…ç½® 1rs.status() æŸ¥çœ‹èŠ‚ç‚¹çš„çŠ¶æ€ æ·»åŠ å‰¯æœ¬ä»ŽèŠ‚ç‚¹ï¼šæ³¨æ„æ·»åŠ å…¶ä»–èŠ‚ç‚¹æ—¶ï¼Œè¦è¢«æ·»åŠ çš„èŠ‚ç‚¹å¿…é¡»æœªåˆå§‹åŒ–ï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™Received heartbeat from member with the sameï¼Œidå€¼ä¸€æ ·ï¼Œå‰¯æœ¬é›†ä¸­èŠ‚ç‚¹ä¹‹é—´çš„idå€¼ä¸èƒ½ç›¸åŒï¼Œå…·æœ‰å”¯ä¸€æ€§ï¼Œå¦åˆ™å¯¼è‡´æ··ä¹±ï¼Œæ‰€æœ‰æŠ¥é”™ï¼Œåˆå§‹åŒ–ä¼šé»˜è®¤ä¸º0ï¼Œæ•…ä¸èƒ½åˆå§‹åŒ– 1rs.add(&quot;172.30.77.41:27018&quot;) æ·»åŠ ä»²è£èŠ‚ç‚¹ï¼š1rs.addArb(&quot;172.30.77.41:27019&quot;) è¯»å†™æ“ä½œï¼šä¸»èŠ‚ç‚¹å¯ä»¥è¯»å†™æ“ä½œï¼š 1db.comment.insert(&#123;&quot;articleid&quot;:&quot;1001&quot;,&quot;content&quot;:&quot;ä»Šå¤©å¤©æ°”çœŸå¥½é˜³å…‰æ˜Žåªš&quot;,&quot;userid&quot;:&quot;1001&quot;,&quot;nickname&quot;:&quot;Rose&quot;,&quot;createdatetime&quot;:&quot;new Date()&quot;&#125;) 1db.comment.find() ä»ŽèŠ‚ç‚¹åªèƒ½è¯»æ“ä½œï¼š å…ˆæ‰¿è®¤æ˜¯å‰¯æœ¬é›†ä¸­çš„ä»ŽèŠ‚ç‚¹ 1rs.slaveOk() 1show dbs çŽ°åœ¨å°±å®žçŽ°äº†è¯»å†™åˆ†ç¦»ï¼Œä¸»èŠ‚ç‚¹è¯»å†™æ“ä½œï¼Œä»ŽèŠ‚ç‚¹è¯»æ“ä½œ å¦‚æžœéœ€è¦å–æ¶ˆä½œä¸ºä»ŽèŠ‚ç‚¹çš„è¯»æ“ä½œï¼š 12//ç¼ºçœé»˜è®¤ä¸ºtruers.slaveOk(false) ä»²è£èŠ‚ç‚¹ä¸ä¼šåŒæ­¥æ•°æ®ï¼Œä¸èƒ½è¯»å†™æ“ä½œï¼Œåªèƒ½é€‰ä¸¾ ä¸»èŠ‚ç‚¹é€‰ä¸¾åŽŸåˆ™ï¼š ä¸»èŠ‚ç‚¹æ•…éšœ ä¸»èŠ‚ç‚¹ç½‘ç»œä¸å¯è¾¾ï¼ˆé»˜è®¤å¿ƒè·³10ç§’ï¼‰ äººå·¥å¹²é¢„ï¼ˆrs.stepDown(600)ï¼‰ é€‰ä¸¾è§„åˆ™ï¼š ç¥¨æ•°å¤§å¤šæ•°ï¼Œç¥¨æ•°ç›¸åŒæ—¶æ•°æ®æ–°çš„é€‰ä¸¾ä¸ºä¸»èŠ‚ç‚¹ èŠ‚ç‚¹ä¼˜å…ˆçº§ï¼ˆæƒé‡ï¼‰ åä¸‰ã€ç”¨æˆ·è§’è‰²æƒé™","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"MongoDB","slug":"MongoDB","permalink":"http://fyupeng.github.io/tags/MongoDB/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://fyupeng.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"fyupeng"},{"title":"JDBC","slug":"JDBC","date":"2022-06-25T07:50:42.000Z","updated":"2022-06-25T07:51:55.452Z","comments":true,"path":"2022/06/25/JDBC/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/JDBC/","excerpt":"","text":"ä¸€ã€åŽŸç†ç¯‡1.JDBCï¼šJava DataBase Connectivityå¯ä»¥ä¸ºå¤šç§å…³ç³»åž‹æ•°æ®åº“DBMS æä¾›ç»Ÿä¸€çš„è®¿é—®å½¢å¼ï¼Œç”¨Javaæ¥æ“ä½œæ•°æ®åº“ 2.JDBC API ä¸»è¦åŠŸèƒ½ï¼šä¸‰ä»¶äº‹ï¼Œå…·ä½“æ—¶é€šè¿‡ä»¥ä¸‹ç±»/æŽ¥å£å®žçŽ°ï¼šDriverManagerï¼šç®¡ç†jdbcé©±åŠ¨Connectionï¼šè¿žæŽ¥ï¼ˆé€šè¿‡DriverManageräº§ç”Ÿï¼‰Statement(PreparedStatement)ï¼šå¢žåˆ æŸ¥æ”¹ ï¼ˆé€šè¿‡Connectionäº§ç”Ÿï¼‰CallableStatementï¼šè°ƒç”¨æ•°æ®åº“ä¸­çš„ å­˜å‚¨è¿‡ç¨‹/å­˜å‚¨å‡½æ•°Resultï¼šè¿”å›žçš„ç»“æžœé›†ï¼ˆä¸Šé¢çš„Statementç­‰äº§ç”Ÿï¼‰ Connectionäº§ç”Ÿæ“ä½œæ•°æ®åº“çš„å¯¹è±¡ï¼šConnectionäº§ç”ŸStatementå¯¹è±¡ï¼šcreateStatementï¼ˆï¼‰Connectionäº§ç”ŸPreparedStatementå¯¹è±¡ï¼šPrepareStatementï¼ˆï¼‰Connectionäº§ç”ŸCallableStatementå¯¹è±¡ï¼šprepareCallï¼ˆï¼‰ Statementæ“ä½œæ•°æ®åº“ï¼šå¢žåˆ æ”¹ï¼šexecuteUpdateï¼ˆï¼‰æŸ¥è¯¢ï¼šexecuteQueryï¼ˆï¼‰ ResultSetï¼šä¿å­˜ç»“æžœé›† select * from xxxnextï¼ˆï¼‰ï¼šå…‰æ ‡ä¸‹ç§»ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸‹ä¸€æ¡æ•°æ®ï¼›true/falsepreviousï¼ˆï¼‰ï¼štrue/false PrepareStatementæ“ä½œæ•°æ®åº“ï¼špublic interface PreparedStatement extends Statementå› æ­¤å¢žåˆ æ”¹ï¼šexecuteUpdateï¼ˆï¼‰æŸ¥è¯¢ï¼šexecuteQueryï¼ˆï¼‰èµ‹å€¼æ“ä½œï¼šsetXxxï¼ˆï¼‰ PrepareStatementä¸ŽStatementåœ¨ä½¿ç”¨æ—¶çš„åŒºåˆ«ï¼š1.Statementï¼š 12sqlexecuteUpdateï¼ˆsqlï¼‰ 2.preparedStatementï¼š 1234sqlï¼ˆå¯èƒ½å­˜åœ¨å ä½ç¬¦ï¼Ÿï¼‰//åœ¨åˆ›å»ºPreparedStatement å¯¹è±¡æ—¶ï¼Œå°†sqlé¢„ç¼–è¯‘ prepareStatment(sql)executeUpdate()setXxx()æ›¿æ¢å ä½ç¬¦ï¼Ÿ æŽ¨èä½¿ç”¨PreparedStatementï¼šåŽŸå› å¦‚ä¸‹ï¼šï¼ˆ1ï¼‰ç¼–ç æ›´åŠ ç®€ä¾¿ 12String name = &quot;zs&quot;; int age = 23; stmtï¼š 12String sql = &quot;insert into student(stuno, stuname) values(&#x27;&quot; + name + &quot;&#x27;, &quot; + age +&quot;) &quot; ;stmt.executeUpdate(sql); pstmtï¼š 12345String sql = &quot;insert into student(stuno, stuname) values(?, ?)&quot;;pstmt = connection.prepareStatement(sql);//é¢„ç¼–è¯‘pstmt.setString(1, name);pstmt.setInt(2, age);pstmt.excuteUpdate(); ï¼ˆ2ï¼‰æé«˜æ€§èƒ½ï¼ˆå› ä¸ºæœ‰ é¢„ç¼–è¯‘æ“ä½œï¼Œ é¢„ç¼–è¯‘åªéœ€æ‰§è¡Œä¸€æ¬¡ï¼‰éœ€è¦é‡å¤å¢žåŠ 100æ¡æ•°stmtï¼š 123String sql = &quot;insert into student(stuno, stuname) values(&#x27;&quot; + name + &quot;&#x27;, &quot; + age +&quot;) &quot; ;for(int i = 1; i &lt;= 100; i++)stmt.executeUpdate(sql); pstmtï¼š 123456String sql = &quot;insert into student(stuno, stuname) values(?, ?)&quot;;pstmt = connection.prepareStatement(sql);//é¢„ç¼–è¯‘pstmt.setString(1, name);pstmt.setInt(2, age);for(int i = 1; i &lt;= 100; i++)pstmt.excuteUpdate(); ï¼ˆ3ï¼‰å®‰å…¨ï¼ˆå¯ä»¥æœ‰æ•ˆé˜²æ­¢sqlæ³¨å…¥ï¼‰sqlæ³¨å…¥ï¼šå°†å®¢æˆ·ç«¯è¾“å…¥çš„å†…å®¹ å’Œ å¼€å‘äººå‘˜ çš„ SQLè¯­å¥ æ··ä¸ºä¸€ä½“stmtï¼šå­˜åœ¨è¢«sqlæ³¨å…¥çš„é£Žé™©ï¼›ï¼ˆä¾‹å¦‚è¾“å…¥ ç”¨æˆ·åï¼šä»»æ„å€¼ â€˜ or 1=1 â€“å¯†ç ï¼šä»»æ„å€¼ï¼‰åˆ†æžï¼š 12select count(*) from login where uanme = &#x27;ä»»æ„å€¼&#x27; or 1=1 --&#x27; and upwd = &#x27;ä»»æ„å€¼&#x27;ï¼›select count(*) from login where uname = &#x27;&quot;+name+&quot;&#x27; and upwd = &#x27;&quot;+pwd+&quot;&#x27; pstmtæœ‰æ•ˆé˜²æ­¢sqlæ³¨å…¥ 3.jdbcè®¿é—®æ•°æ®åº“çš„å…·ä½“æ­¥éª¤ï¼ša.å¯¼å…¥é©±åŠ¨ï¼ŒåŠ è½½å…·ä½“çš„é©±åŠ¨ç±»b.ä¸Žæ•°æ®åº“å»ºç«‹è¿žæŽ¥c.å‘é€sqlï¼Œæ‰§è¡Œd.å¤„ç†ç»“æžœé›†(æŸ¥è¯¢) 4.æ•°æ®åº“é©±åŠ¨æ•°æ®åº“å é©±åŠ¨jar å…·ä½“é©±åŠ¨ç±» è¿žæŽ¥å­—ç¬¦ä¸² Oracle ojdbc-x.jar oracle.jdbc.OracleDriver jdbc:oracle:this:@localhost:1521:ORCL MySQL Mysql-connector-java-x.jar com.mysql.jdbc.Driver jdbc:mysql://localhost:3306/æ•°æ®åº“å®žä¾‹å SqlServer sqljdbc-x.jar com.microsoft.sqlserver.jdbc.SQLServerDriver jdbc:sqlserver://localhost:1433;DatabaseName=mydatabase äºŒã€æ“ä½œç¯‡1.ä½¿ç”¨JDBCè¿žæŽ¥Oracle123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package exp1;import java.sql.Connection;import java.sql.DriverManager;import java.sql.SQLException;import java.sql.Statement;public class JDBCDemo &#123; private static final String URL = &quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;; private static final String USERNAME = &quot;system&quot;; private static final String PWD = &quot;FYp0103&quot;; public static void update() &#123; Connection connection = null; Statement stmt = null; try &#123; //a.å¯¼å…¥é©±åŠ¨ï¼ŒåŠ è½½å…·ä½“çš„é©±åŠ¨ç±» Class.forName(&quot;oracle.jdbc.OracleDriver&quot;); //b.ä¸Žæ•°æ®åº“å»ºç«‹è¿žæŽ¥ connection = DriverManager.getConnection(URL, USERNAME, PWD); //c.å‘é€sqlï¼Œæ‰§è¡Œï¼ˆå¢žåˆ æŸ¥æ”¹ï¼‰ stmt = connection.createStatement(); String sql = &quot;insert into student values(1, &#x27;zs&#x27;, 23, &#x27;s1&#x27;)&quot;; int count = stmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125; &#125;catch(ClassNotFoundException e)&#123; e.printStackTrace(); &#125;catch(SQLException e) &#123; e.printStackTrace(); &#125;catch(Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if(stmt !=null) stmt.close(); if(connection !=null) connection.close(); &#125;catch(Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; update(); &#125; &#125; 2.Statementå¢žåˆ æ”¹ã€æŸ¥æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596//JDBC For Statementpackage exp1;import java.sql.Connection;import java.sql.DriverManager;import java.sql.ResultSet;import java.sql.SQLException;import java.sql.Statement;public class JDBCDemo_Statement &#123;// private static final String URL = &quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;; private static final String URL = &quot;jdbc:mysql://localhost:3306/MyDataBase&quot;; //æ–°ç‰ˆçš„ private static final String URL = &quot;jdbc:sqlserver://localhost:1433;DatabaseName=mydatabase&quot;;//æ—§ç‰ˆçš„ private static final String URL = &quot;jdbc:microsoft:sqlserver:localhost:1433;database=MyDataBase&quot;; private static final String USERNAME = &quot;root&quot;; private static final String PWD = &quot;&quot;; public static void update() &#123; Connection connection = null; Statement stmt = null; ResultSet rs = null; try &#123; //a.å¯¼å…¥é©±åŠ¨ï¼ŒåŠ è½½å…·ä½“çš„é©±åŠ¨ç±»// Class.forName(&quot;oracle.jdbc.OracleDriver&quot;); Class.forName(&quot;com.mysql.jdbc.Driver&quot;);// Class.forName(&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;); //b.ä¸Žæ•°æ®åº“å»ºç«‹è¿žæŽ¥ connection = DriverManager.getConnection(URL, USERNAME, PWD); //c.å‘é€sqlï¼Œæ‰§è¡Œï¼ˆå¢žåˆ æ”¹, æŸ¥ï¼‰/* //å¢ž * stmt = connection.createStatement(); String sql = &quot;insert into student values(1, 23, &#x27;zs&#x27;, &#x27;s1&#x27;)&quot;; int count = stmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //åˆ  stmt = connection.createStatement(); String sql = &quot;delete from student where stuno = 1&quot;; int count = stmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //æ”¹ stmt = connection.createStatement(); String sql = &quot;update student set stuname = zs5 where stuno = 1&quot;; int count = stmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //æŸ¥ stmt = connection.createStatement(); String sql = &quot;select * from student&quot;; rs = stmt.executeQuery(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® while(rs.next()) &#123; int Sno = rs.getInt(&quot;stuno&quot;); int Sage = rs.getInt(&quot;stuage&quot;); String Sname = rs.getString(&quot;stuname&quot;); String Sclass = rs.getString(&quot;stuclass&quot;); System.out.println(Sno + &quot;--&quot; + Sage + &quot;--&quot; + Sname + &quot;--&quot; + Sclass); &#125; */ &#125;catch(ClassNotFoundException e)&#123; e.printStackTrace(); &#125;catch(SQLException e) &#123; e.printStackTrace(); &#125;catch(Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if(stmt !=null) stmt.close(); if(connection !=null) connection.close(); &#125;catch(Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; update(); &#125; &#125; 3.preparedStatementå¢žåˆ æ”¹ã€æŸ¥æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135package exp2;import java.sql.Connection;import java.sql.DriverManager;import java.sql.ResultSet;import java.sql.SQLException;import java.sql.Statement;import java.sql.CallableStatement;import java.sql.PreparedStatement;public class JDBCDemo_prepareStatement &#123;// private static final String URL = &quot;jdbc:oracle:thin:@localhost:1521:ORCL&quot;; private static final String URL = &quot;jdbc:mysql://localhost:3306/MyDataBase&quot;;// private static final String URL = &quot;jdbc:microsofi:sqlserver:localhost:1433;database=MyDataBase&quot;; private static final String USERNAME = &quot;root&quot;; private static final String PWD = &quot;&quot;; public static void update() &#123; Connection connection = null; PreparedStatement pstmt = null; ResultSet rs = null; try &#123; //a.å¯¼å…¥é©±åŠ¨ï¼ŒåŠ è½½å…·ä½“çš„é©±åŠ¨ç±»// Class.forName(&quot;oracle.jdbc.OracleDriver&quot;); Class.forName(&quot;com.mysql.jdbc.Driver&quot;);// Class.forName(&quot;com.microsoft.sqlserver.jdbc.SQLServerDriver&quot;); //b.ä¸Žæ•°æ®åº“å»ºç«‹è¿žæŽ¥ connection = DriverManager.getConnection(URL, USERNAME, PWD); //c.å‘é€sqlï¼Œæ‰§è¡Œï¼ˆå¢žåˆ æŸ¥æ”¹ï¼‰// String sql = &quot;insert into student values(?, ?, ?, ?)&quot;; //å¢ž /* pstmt = connection.createStatement(); String sql = &quot;insert into student values(1, 23, &#x27;zs&#x27;, &#x27;s1&#x27;)&quot;; int count = pstmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //åˆ  pstmt = connection.createStatement(); String sql = &quot;delete from student where stuno = 1&quot;; int count = pstmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //æ”¹ pstmt = connection.createStatement(); String sql = &quot;update student set stuname = zs5 where stuno = 1&quot;; int count = pstmt.executeUpdate(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*//* //æŸ¥ pstmt = connection.createStatement(); String sql = &quot;select * from student&quot;; rs = pstmt.executeQuery(sql);//è¿”å›žå€¼è¡¨ç¤ºå¢žåˆ æ”¹å‡ æ¡æ•°æ® while(rs.next()) &#123; int Sno = rs.getInt(&quot;stuno&quot;); int Sage = rs.getInt(&quot;stuage&quot;); String Sname = rs.getString(&quot;stuname&quot;); String Sclass = rs.getString(&quot;stuclass&quot;); System.out.println(Sno + &quot;--&quot; + Sage + &quot;--&quot; + Sname + &quot;--&quot; + Sclass); &#125;*/ /* //å¢ž String sql = &quot;insert into student values(1, 23, &#x27;zs&#x27;, ?)&quot;; pstmt = connection.prepareStatement(sql); pstmt.setString(1, &quot;zs&quot;); int count = pstmt.executeUpdate(); if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //åˆ  String sql = &quot;delete from student where stuno = ?&quot;; pstmt = connection.prepareStatement(sql); pstmt.setString(1, &quot;1&quot;); int count = pstmt.executeUpdate(); if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125;*/ /* //æ”¹ String sql = &quot;update student set stuname = zs5 where stuno = ?&quot;; pstmt = connection.prepareStatement(sql); pstmt.setString(1, &quot;1&quot;); int count = pstmt.executeUpdate(); if(count &gt; 0) &#123; System.out.println(&quot;æ“ä½œæˆåŠŸï¼&quot;); &#125; *//* //æ”¹ String sql = &quot;select * from student where stuno = ?&quot;; pstmt = connection.prepareStatement(sql); pstmt.setString(1, &quot;1&quot;); rs = pstmt.executeQuery(); while(rs.next()) &#123; int sno = rs.getInt(&quot;stuno&quot;); int sage = rs.getInt(&quot;stuage&quot;); String sname = rs.getString(&quot;stuname&quot;); String sclass = rs.getString(&quot;stuclass&quot;); System.out.println(sno + &quot;--&quot; + sage + &quot;--&quot; + sname + &quot;--&quot; + sclass); &#125;*/ &#125;catch(ClassNotFoundException e)&#123; e.printStackTrace(); &#125;catch(SQLException e) &#123; e.printStackTrace(); &#125;catch(Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if(pstmt !=null) pstmt.close(); if(connection !=null) connection.close(); &#125;catch(Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; public static void main(String[] args) &#123; update(); &#125; &#125; 4.æ€»ç»“æ¨¡æ¿ã€å…«è‚¡æ–‡ï¼š a.å¯¼å…¥é©±åŠ¨åŒ…ã€åŠ è½½å…·ä½“é©±åŠ¨ç±»Class.forName(â€œå…·ä½“é©±åŠ¨ç±»â€)ï¼› b.ä¸Žæ•°æ®åº“å»ºç«‹è¿žæŽ¥connection = DriverManager.getConnection(â€¦); c.é€šè¿‡connection, èŽ·å–æ“ä½œæ•°æ®åº“çš„å¯¹è±¡ï¼ˆStatement/preparedStatement/callablestatementï¼‰ stmt = connection.createStatement(); d.(æŸ¥è¯¢)å¤„ç†ç»“æžœé›† 123456789101112131415161718rs = pstmt.excuteQuery();while(rs.next())&#123; rs.getXxx(..);&#125;catch(ClassNotFoundExceptione)&#123;...&#125;catch(SQLException e)&#123;...&#125;catch(Exception e)&#123;...&#125;finally&#123; //æ‰“å¼€é¡ºåºï¼Œä¸Žå…³é—­é¡ºåºç›¸å if(rs != null)rs.close(); if(stmt != null)stmt.close(); if(connection != null)connection.close();&#125;--jdbcä¸­ï¼Œ é™¤äº†Class.forName()æŠ›å‡ºClassNotFoundException, å…¶ä½™æ–¹æ³•å…¨éƒ¨æŠ›å‡ºSQLEeception 5.JDBCè°ƒç”¨å­˜å‚¨è¿‡ç¨‹å’Œå­˜å‚¨å‡½æ•°1.CallableStatementï¼šè°ƒç”¨ å­˜å‚¨è¿‡ç¨‹ã€å­˜å‚¨å‡½æ•° connection.prepareCall(å‚æ•°ï¼šå­˜å‚¨è¿‡ç¨‹èƒ¡å“¦å­˜å‚¨å‡½æ•°å) å‚æ•°æ ¼å¼ï¼š å­˜å‚¨è¿‡ç¨‹ï¼ˆæ— è¿”å›žå€¼return, ç”¨Outå‚æ•°æ›¿ä»£ï¼‰: â€‹ {call å­˜å‚¨è¿‡ç¨‹åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰} å­˜å‚¨å‡½æ•°ï¼ˆæœ‰è¿”å›žå€¼returnï¼‰: â€‹ {? = call å­˜å‚¨å‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰} 12345create or replace procedure addTwoNum(num1 in number, num2 in number, result out number)asbegin result := num1 + num2;end; å¦‚æžœé€šè¿‡sql plus è®¿é—®æ•°æ®åº“ï¼Œåªéœ€è¦å¼€å¯ï¼šOracleServiceSID é€šè¿‡å…¶ä»–ç¨‹åºè®¿é—®æ•°æ®ï¼ˆsqldevelopã€navicateã€JDBCï¼‰,éœ€è¦å¼€å¯OracleServiceSIDã€XxxListener JDBCè°ƒç”¨å­˜å‚¨è¿‡ç¨‹çš„æ­¥éª¤ï¼š a.äº§ç”Ÿ è°ƒç”¨å­˜å‚¨è¿‡ç¨‹çš„å¯¹è±¡ï¼ˆCallableStatementï¼‰ cstmt = connection.prepareCallï¼ˆâ€œâ€¦.â€ï¼‰; b.é€šè¿‡setXxxï¼ˆï¼‰å¤„ç† è¾“å‡ºå‚æ•°å€¼ cstmt.setIntï¼ˆ1ï¼Œ30ï¼‰ï¼› c.é€šè¿‡ registerOutParameter(â€¦)å¤„ç†è¾“å‡ºå‚æ•°ç±»åž‹ d.cstmt.executeï¼ˆï¼‰æ‰§è¡Œ e.æŽ¥å— è¾“å‡ºå€¼ ï¼ˆè¿”å›žå€¼ï¼‰getXxx() è°ƒç”¨å­˜å‚¨å‡½æ•°ï¼š 12345678create or replace function addTwoNumfunction(num1 in number, num2 in number) return number as result number; begin result := num1 + num2; return result; end; JDBCè°ƒç”¨å­˜å‚¨å‡½æ•°ï¼šä¸Žå­˜å‚¨è¿‡ç¨‹çš„åŒºåˆ«ï¼š åœ¨è°ƒç”¨æ—¶ï¼Œæ³¨æ„å‚æ•°ï¼šâ€œ{ï¼Ÿ = call addTwoNumfunction(?, ?)}â€ 3.å¤„ç†CLOB/BLOBç±»åž‹ å¤„ç†ç¨å¤§åž‹æ•°æ®ï¼š a.å­˜å‚¨è·¯å¾„ E:/A.txt â€‹ é€šè¿‡JDBCå­˜å‚¨æ–‡ä»¶è·¯å¾„ï¼Œç„¶åŽæ ¹æ®IOæ“ä½œå¤„ç† â€‹ ä¾‹å¦‚ï¼šJDBCå°†E:/A.txt æ–‡ä»¶ ä»¥å­—ç¬¦ä¸²å½¢å¼ â€œEï¼š/A.txtâ€å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ â€‹ èŽ·å–ï¼š1.èŽ·å–è¯¥è·¯å¾„â€œEï¼š/A.txtâ€2.IO b. â€‹ CLOBï¼šå¤§æ–‡æœ¬æ•°æ®ï¼ˆå°è¯´â†’ æ•°æ®ï¼‰ â€‹ BLOBï¼šäºŒè¿›åˆ¶ clobï¼š å­˜ï¼š 1.å…ˆé€šè¿‡pstmtçš„ ï¼Ÿ ä»£æ›¿å°è¯´å†…å®¹ ï¼ˆå ä½ç¬¦ï¼‰ 2.å†é€šè¿‡pstmt.setCharacterStream(2, reader, (int)file.length()); å°†ä¸Šä¸€æ­¥çš„ ï¼Ÿ æ›¿æ¢ä¸ºå°è¯´æµï¼Œæ³¨æ„ç¬¬ä¸‰ä¸ªå‚æ•°éœ€è¦æ˜¯Intç±»åž‹ å–ï¼š 1.é€šè¿‡Reader reader = rs.getCharacterStream(â€œNOVELâ€); å°†clobç±»åž‹çš„æ•°æ® ä¿å­˜åˆ° Reader å¯¹è±¡ä¸­ 2.å°†Readeré€šè¿‡Writerè¾“å‡ºå³å¯ã€‚ blobï¼šäºŒè¿›åˆ¶ å­—èŠ‚æµ InputStream OutputStream ä¸ŽCLOBæ­¥éª¤åŸºæœ¬ä¸€è‡´ï¼ŒåŒºåˆ«ï¼šsetBinaryStream(â€¦) getBinaryStream(â€¦)","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"JDBC","slug":"JDBC","permalink":"http://fyupeng.github.io/tags/JDBC/"}],"author":"fyupeng"},{"title":"Oracle","slug":"Oracle","date":"2022-06-25T07:34:03.000Z","updated":"2022-06-25T07:50:08.047Z","comments":true,"path":"2022/06/25/Oracle/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/Oracle/","excerpt":"","text":"ä¸€ã€æ•°æ®åº“å¯åŠ¨çŠ¶æ€1 çŠ¶æ€æŸ¥è¯¢ å¯åŠ¨çŠ¶æ€ SQLè¯­å¥ ç»“æžœ nomount select status from v$instance; STARTED select open_mode from v$database; ERROR at line 1:ORA-01507: database not mounted mount select status from v$instance; MOUNTED select open_mode from v$database; MOUNTED open select status from v$instance; OPEN select open_mode from v$database; READ WRITE æˆ–è€… READ ONLY äºŒã€ è¡¨ç©ºé—´oracleåˆ é™¤è¡¨ç©ºé—´è¯­å¥12345678910 --åˆ é™¤ç©ºçš„è¡¨ç©ºé—´ï¼Œä½†æ˜¯ä¸åŒ…å«ç‰©ç†æ–‡ä»¶drop tablespace tablespace_name;--åˆ é™¤éžç©ºè¡¨ç©ºé—´ï¼Œä½†æ˜¯ä¸åŒ…å«ç‰©ç†æ–‡ä»¶drop tablespace tablespace_name including contents;--åˆ é™¤ç©ºè¡¨ç©ºé—´ï¼ŒåŒ…å«ç‰©ç†æ–‡ä»¶drop tablespace tablespace_name including datafiles;--åˆ é™¤éžç©ºè¡¨ç©ºé—´ï¼ŒåŒ…å«ç‰©ç†æ–‡ä»¶drop tablespace tablespace_name including contents and datafiles;--å¦‚æžœå…¶ä»–è¡¨ç©ºé—´ä¸­çš„è¡¨æœ‰å¤–é”®ç­‰çº¦æŸå…³è”åˆ°äº†æœ¬è¡¨ç©ºé—´ä¸­çš„è¡¨çš„å­—æ®µï¼Œå°±è¦åŠ ä¸ŠCASCADE CONSTRAINTSdrop tablespace tablespace_name including contents and datafiles CASCADE CONSTRAINTS;","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://fyupeng.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"Oracle","slug":"Oracle","permalink":"http://fyupeng.github.io/tags/Oracle/"}],"author":"fyupeng"},{"title":"MySQLé…ç½®","slug":"MySQLé…ç½®","date":"2022-06-25T07:31:13.000Z","updated":"2022-06-25T07:48:58.062Z","comments":true,"path":"2022/06/25/MySQLé…ç½®/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/MySQL%E9%85%8D%E7%BD%AE/","excerpt":"","text":"ä¸€ã€é…ç½®ç¯‡1.é“¾æŽ¥ä¿¡æ¯é…ç½® 5.6ç‰ˆæœ¬ä»¥ä¸‹ jdbc.properties 1234driver=com.mysql.jdbc.Driver url=jdbc:mysql://192.168.10.102:3306/springboot?useUnicode=true&amp;characterEncoding=utf8 username=root password=root springboot: 1234spring.datasource.driver-class-name=com.mysql.jdbc.Driver spring.datasource.url=jdbc:mysql://192.168.10.102:3306/springboot?useUnicode=true&amp;characterEncoding=utf8 spring.datasource.username=root spring.datasource.password=root æ³¨æ„ï¼š 1.ä½Žç‰ˆæœ¬çš„mysqlå¯¹åº”mybatisé€†å‘å·¥ç¨‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE generatorConfiguration PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;&lt;generatorConfiguration&gt; &lt;!--æŒ‡å®šè¿žæŽ¥æ•°æ®åº“çš„JDBCé©±åŠ¨åŒ…æ‰€åœ¨çš„ä½ç½®ï¼ŒæŒ‡å®šåˆ°ä½ æœ¬æœºçš„å®Œæ•´è·¯å¾„--&gt; &lt;classPathEntry location=&quot;D:\\study\\software\\java\\jdbc\\mysql-connector-java-5.1.35.jar&quot;/&gt; &lt;!--é…ç½®tableè¡¨ä¿¡æ¯å†…å®¹ä½“ï¼ŒtargerRuntimeæŒ‡å®šé‡‡ç”¨MyBatis3çš„ç‰ˆæœ¬--&gt; &lt;context id=&quot;tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt; &lt;commentGenerator&gt; &lt;!-- æ˜¯å¦åŽ»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueï¼šæ˜¯ ï¼š false:å¦ --&gt; &lt;!-- true:è‡ªåŠ¨ç”Ÿæˆå®žä½“ç±»ã€SQLæ˜ å°„æ–‡ä»¶æ—¶æ²¡æœ‰æ³¨é‡Š --&gt; &lt;!-- false:è‡ªåŠ¨ç”Ÿæˆå®žä½“ç±»ã€SQLæ˜ å°„å¼•è¿›ï¼Œå¹¶é™„æœ‰æ³¨é‡Š --&gt; &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot; /&gt; &lt;/commentGenerator&gt; &lt;!--æ•°æ®åº“è¿žæŽ¥çš„ä¿¡æ¯ï¼šé©±åŠ¨ç±»ã€è¿žæŽ¥åœ°å€ã€ç”¨æˆ·åã€å¯†ç  --&gt; &lt;jdbcConnection driverClass=&quot;com.mysql.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://192.168.10.102:3306/springboot&quot; userId=&quot;root&quot; password=&quot;root&quot;&gt; &lt;!-- è‹¥ä¸º 8.0 ç‰ˆæœ¬ä»¥ä¸Šçš„ mysql-connector-java é©±åŠ¨ï¼Œéœ€è¦è®¾ç½® nullCatalogMeansCurrent = true --&gt; &lt;!--&lt;property name=&quot;nullCatalogMeansCurrent&quot; value=&quot;true&quot;/&gt;--&gt; &lt;/jdbcConnection&gt; &lt;!--&lt;jdbcConnection driverClass=&quot;oracle.jdbc.OracleDriver&quot; connectionURL=&quot;jdbc:oracle:thin:@127.0.0.1:1521:ORCL&quot; userId=&quot;scott&quot; password=&quot;tiger&quot;&gt; &lt;/jdbcConnection&gt;--&gt; &lt;!-- é»˜è®¤falseï¼ŒæŠŠJDBC DECIMAL å’Œ NUMERIC ç±»åž‹è§£æžä¸º Integerï¼Œä¸º trueæ—¶æŠŠJDBC DECIMAL å’Œ NUMERIC ç±»åž‹è§£æžä¸ºjava.math.BigDecimal --&gt; &lt;javaTypeResolver&gt; &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot; /&gt; &lt;/javaTypeResolver&gt; &lt;!-- targetProject:ç”ŸæˆPOç±»çš„ä½ç½® --&gt; &lt;javaModelGenerator targetPackage=&quot;com.zhkucst.springboot.model&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åŽç¼€ --&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot; /&gt; &lt;!-- ä»Žæ•°æ®åº“è¿”å›žçš„å€¼è¢«æ¸…ç†å‰åŽçš„ç©ºæ ¼ --&gt; &lt;!-- true:å¯¹æ•°æ®åº“çš„æŸ¥è¯¢ç»“æžœè¿›è¡Œtrimæ“ä½œ --&gt; &lt;!-- false(é»˜è®¤)ï¼šä¸è¿›è¡Œtrimæ“ä½œ --&gt; &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot; /&gt; &lt;/javaModelGenerator&gt; &lt;!-- targetProject:mapperæ˜ å°„æ–‡ä»¶ç”Ÿæˆçš„ä½ç½® --&gt; &lt;sqlMapGenerator targetPackage=&quot;com.zhkucst.springboot.mapper&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åŽç¼€ --&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot; /&gt; &lt;/sqlMapGenerator&gt; &lt;!-- targetPackageï¼šmapperæŽ¥å£ç”Ÿæˆçš„ä½ç½® --&gt; &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.zhkucst.springboot.mapper&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åŽç¼€ --&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot; /&gt; &lt;/javaClientGenerator&gt; &lt;!-- æŒ‡å®šæ•°æ®åº“è¡¨åŠå¯¹åº”çš„Javaæ¨¡åž‹ç±»å --&gt; &lt;table tableName=&quot;t_student&quot; domainObjectName=&quot;Student&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot; selectByExampleQueryId=&quot;false&quot;/&gt; &lt;!-- æœ‰äº›è¡¨çš„å­—æ®µéœ€è¦æŒ‡å®šjavaç±»åž‹ &lt;table schema=&quot;&quot; tableName=&quot;&quot;&gt; &lt;columnOverride column=&quot;&quot; javaType=&quot;&quot; /&gt; &lt;/table&gt; --&gt; &lt;/context&gt;&lt;/generatorConfiguration&gt; 8.0ç‰ˆæœ¬ä»¥ä¸Š jdbc.properties 1234 driver=com.mysql.cj.jdbc.Driverurl=jdbc:mysql://192.168.10.102:3306/springboot?useUnicode=true&amp;characterEncoding=utf8&amp;useJDBCComplliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTCusername=rootpassword=root springboot: 1234spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driverspring.datasource.url=jdbc:mysql://192.168.10.102:3306/springboot?useUnicode=true&amp;characterEncoding=utf8&amp;useJDBCComplliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTCspring.datasource.username=rootspring.datasource.password=root æ³¨æ„ï¼š 1.é«˜ç‰ˆæœ¬çš„mysqlå¯¹åº”mybatisé€†å‘å·¥ç¨‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE generatorConfiguration PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;&lt;generatorConfiguration&gt; &lt;!--æŒ‡å®šè¿žæŽ¥æ•°æ®åº“çš„JDBCé©±åŠ¨åŒ…æ‰€åœ¨çš„ä½ç½®ï¼ŒæŒ‡å®šåˆ°ä½ æœ¬æœºçš„å®Œæ•´è·¯å¾„--&gt; &lt;classPathEntry location=&quot;D:\\study\\software\\java\\jdbc\\mysql-connector-java-8.0.25.jar&quot;/&gt; &lt;!--é…ç½®tableè¡¨ä¿¡æ¯å†…å®¹ä½“ï¼ŒtargerRuntimeæŒ‡å®šé‡‡ç”¨MyBatis3çš„ç‰ˆæœ¬--&gt; &lt;context id=&quot;tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt; &lt;commentGenerator&gt; &lt;!-- æ˜¯å¦åŽ»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueï¼šæ˜¯ ï¼š false:å¦ --&gt; &lt;!-- true:è‡ªåŠ¨ç”Ÿæˆå®žä½“ç±»ã€SQLæ˜ å°„æ–‡ä»¶æ—¶æ²¡æœ‰æ³¨é‡Š --&gt; &lt;!-- false:è‡ªåŠ¨ç”Ÿæˆå®žä½“ç±»ã€SQLæ˜ å°„å¼•è¿›ï¼Œå¹¶é™„æœ‰æ³¨é‡Š --&gt; &lt;property name=&quot;suppressAllComments&quot; value=&quot;true&quot; /&gt; &lt;/commentGenerator&gt; &lt;!--æ•°æ®åº“è¿žæŽ¥çš„ä¿¡æ¯ï¼šé©±åŠ¨ç±»ã€è¿žæŽ¥åœ°å€ã€ç”¨æˆ·åã€å¯†ç  --&gt; &lt;jdbcConnection driverClass=&quot;com.mysql.cj.jdbc.Driver&quot; connectionURL=&quot;jdbc:mysql://192.168.10.102:3306/springboot?useUnicode=true&amp;characterEncoding=utf8&amp;useJDBCComplliantTimezoneShift=true&amp;useLegacyDatetimeCode=false&amp;serverTimezone=UTC&quot; userId=&quot;root&quot; password=&quot;root&quot;&gt; &lt;!-- è‹¥ä¸º 8.0 ç‰ˆæœ¬ä»¥ä¸Šçš„ mysql-connector-java é©±åŠ¨ï¼Œéœ€è¦è®¾ç½® nullCatalogMeansCurrent = true --&gt; &lt;property name=&quot;nullCatalogMeansCurrent&quot; value=&quot;true&quot;/&gt; &lt;/jdbcConnection&gt; &lt;!--&lt;jdbcConnection driverClass=&quot;oracle.jdbc.OracleDriver&quot; connectionURL=&quot;jdbc:oracle:thin:@127.0.0.1:1521:ORCL&quot; userId=&quot;scott&quot; password=&quot;tiger&quot;&gt; &lt;/jdbcConnection&gt;--&gt; &lt;!-- é»˜è®¤falseï¼ŒæŠŠJDBC DECIMAL å’Œ NUMERIC ç±»åž‹è§£æžä¸º Integerï¼Œä¸º trueæ—¶æŠŠJDBC DECIMAL å’Œ NUMERIC ç±»åž‹è§£æžä¸ºjava.math.BigDecimal --&gt; &lt;javaTypeResolver&gt; &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot; /&gt; &lt;/javaTypeResolver&gt; &lt;!-- targetProject:ç”ŸæˆPOç±»çš„ä½ç½® --&gt; &lt;javaModelGenerator targetPackage=&quot;com.zhkucst.springboot.model&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åŽç¼€ --&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot; /&gt; &lt;!-- ä»Žæ•°æ®åº“è¿”å›žçš„å€¼è¢«æ¸…ç†å‰åŽçš„ç©ºæ ¼ --&gt; &lt;!-- true:å¯¹æ•°æ®åº“çš„æŸ¥è¯¢ç»“æžœè¿›è¡Œtrimæ“ä½œ --&gt; &lt;!-- false(é»˜è®¤)ï¼šä¸è¿›è¡Œtrimæ“ä½œ --&gt; &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot; /&gt; &lt;/javaModelGenerator&gt; &lt;!-- targetProject:mapperæ˜ å°„æ–‡ä»¶ç”Ÿæˆçš„ä½ç½® --&gt; &lt;sqlMapGenerator targetPackage=&quot;com.zhkucst.springboot.mapper&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åŽç¼€ --&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot; /&gt; &lt;/sqlMapGenerator&gt; &lt;!-- targetPackageï¼šmapperæŽ¥å£ç”Ÿæˆçš„ä½ç½® --&gt; &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;com.zhkucst.springboot.mapper&quot; targetProject=&quot;src/main/java&quot;&gt; &lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åŽç¼€ --&gt; &lt;property name=&quot;enableSubPackages&quot; value=&quot;false&quot; /&gt; &lt;/javaClientGenerator&gt; &lt;!-- æŒ‡å®šæ•°æ®åº“è¡¨åŠå¯¹åº”çš„Javaæ¨¡åž‹ç±»å --&gt; &lt;table tableName=&quot;t_student&quot; domainObjectName=&quot;Student&quot; enableCountByExample=&quot;false&quot; enableUpdateByExample=&quot;false&quot; enableDeleteByExample=&quot;false&quot; enableSelectByExample=&quot;false&quot; selectByExampleQueryId=&quot;false&quot;/&gt; &lt;!-- æœ‰äº›è¡¨çš„å­—æ®µéœ€è¦æŒ‡å®šjavaç±»åž‹ &lt;table schema=&quot;&quot; tableName=&quot;&quot;&gt; &lt;columnOverride column=&quot;&quot; javaType=&quot;&quot; /&gt; &lt;/table&gt; --&gt; &lt;/context&gt;&lt;/generatorConfiguration&gt; äºŒã€é”™è¯¯è§£å†³ç¯‡1.æ•°æ®åº“æœ¬èº«æ•°æ®ä¹±ç mysqlæ•°æ®åº“å­—ç¬¦é›†é»˜é›†latin éœ€è¦æ‰‹åŠ¨è®¾ç½®æˆutf-8 2.è°ƒç”¨æ•°æ®åº“æ•°æ®ä¹±ç åœ¨db.pripertiesä¸­åœ¨urlæœ«å°¾æ·»åŠ  1?useUnicode=true&amp;characterEncoding=utf8 ä¸‰ã€å®‰è£…é…ç½®ç¯‡ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ è½¯ä»¶åŒ…åˆ°linuxæ“ä½œç³»ç»Ÿç¬¬äºŒæ­¥ï¼šå¯¹mysqlåŽ‹ç¼©åŒ…è¿›è¡Œè§£åŽ‹æ“ä½œï¼štar.gz 1tar â€“zxf mysql-5.6.44-linux-glibc2.12-x86_64.tar.gz ç¬¬ä¸‰æ­¥ï¼šç§»åŠ¨mysqlæ–‡ä»¶å¤¹åˆ°/usr/localç›®å½•ä¸‹å¹¶æ›´åä¸ºmysql 1mv mysql-5.6.44-linux-glibc2.12-x86_64.tar /usr/local/mysql ç¬¬å››æ­¥ï¼šåˆ›å»ºä¸€ä¸ªmysqlç”¨æˆ·å¹¶æ›´æ”¹/usr/local/mysqlç›®å½•æƒé™ï¼ˆç”¨æˆ·å’Œç»„ï¼‰ 1useradd â€“r â€“s /sbin/nologin mysql ç¬¬äº”æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“ 1[root@localhost /usr/local/mysql/] # scripts/mysql_install_db --user=mysql åˆå§‹åŒ–ä¹‹å‰éœ€è¦å®‰è£…autoconfåº“ã€å‘½ä»¤ï¼šyum-y install autoconfã€‘ç¬¬å…­æ­¥ï¼šç§»é™¤mariadb-libsåº“æ–‡ä»¶ 1[root@localhost /usr/local/mysql/] # yum remove mariadb-libs ç¬¬ä¸ƒæ­¥ï¼šç§»åŠ¨support-filesç›®å½•ä¸‹çš„mysql.serverè„šæœ¬åˆ°/etc/init.dç›®å½•ä¸€ä»½=&gt;service 1[root@localhost /usr/local/mysql/] # cp support-files/mysql.server /etc/init.d/mysql ç¬¬å…«æ­¥ï¼šå¯åŠ¨mysqlè„šæœ¬ 1service mysql start ç¬¬ä¹æ­¥ï¼šè®¾ç½®å¯†ç å¹¶æµ‹è¯•mysqlæ•°æ®åº“ 123bin/mysqladmin -u root password &#x27;root&#x27;;bin/mysql -uroot -pEnter Password:root ç¬¬åä¸€æ­¥ï¼šmysqlè¿œç¨‹è¿žæŽ¥NavicateæŽˆäºˆå…¶ä»–ç”¨æˆ·è®¿é—®æƒé™ï¼š 12mysql&gt; grant all privileges on . to root@&quot;%&quot; identified by &quot;root&quot;;mysql&gt; flush privileges; ç¬¬åäºŒæ­¥ï¼šMy.confé…ç½®ï¼š 1cp /usr/local/mysql/support-files/my-default.cnf /etc/my.cnf æ³¨é‡Šä¸å¸¦ç»¿è‰²ï¼ŒæŽˆäºˆmy.cnfå…·æœ‰644æƒé™ 1chmod 644 /etc/my.cnf é™„ï¼šæ‹’ç»è¿œç¨‹è¿žæŽ¥ï¼šå›žæ”¶æƒé™ï¼š 1Mysql&gt;revoke all privileges,grant option from &#x27;root&#x27;@â€%â€;","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://fyupeng.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"MySQL","slug":"MySQL","permalink":"http://fyupeng.github.io/tags/MySQL/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"http://fyupeng.github.io/tags/%E9%85%8D%E7%BD%AE/"}],"author":"fyupeng"},{"title":"Redis","slug":"Redis","date":"2022-06-25T07:26:18.000Z","updated":"2022-06-25T07:30:01.625Z","comments":true,"path":"2022/06/25/Redis/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/Redis/","excerpt":"","text":"ä¸€ã€NOSQLNOSQL: no only sql(ä¸ä»…ä»…SQL) æ³›æŒ‡éžå…³ç³»åž‹æ•°æ®åº“ NoSQLç‰¹ç‚¹ï¼š 1.æ–¹ä¾¿æ‰©å±•ï¼ˆæ•°æ®ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œå¾ˆå¥½æ‰©å±•ï¼‰ 2.å¤§æ•°æ®é‡é«˜æ€§èƒ½ï¼ˆRedisä¸€ç§’å†™8ä¸‡æ¬¡ï¼Œè¯»å–1ä¸‡ï¼ŒNoSQLçš„ç¼“å­˜è®°å½•çº§ï¼Œæ—¶ä¸€ç§ç»†ç²’åº¦çš„çš„ç¼“å­˜ï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒé«˜ï¼‰ 3.æ•°æ®ç±»åž‹æ—¶å¤šæ ·åž‹çš„ï¼ˆä¸éœ€è¦äº‹å…ˆè®¾è®¡æ•°æ®åº“ï¼Œéšå–éšç”¨ï¼Œå¦‚æžœæ—¶æ•°æ®é‡ååˆ†å¤§çš„è¡¨ï¼Œå¾ˆå¤šäººå°±æ— æ³•è®¾è®¡äº†ï¼‰ 4.ä¼ ç»ŸRDBMS å’Œ NoSQL RDBMS ç»“æž„åŒ–ç»„ç»‡ SQL æ•°æ®å’Œå…³ç³»éƒ½å­˜åœ¨å•ç‹¬çš„è¡¨ä¸­ æ•°æ®æ“ä½œï¼Œæ•°æ®å®šä¹‰è¯­è¨€ ä¸¥æ ¼çš„ä¸€è‡´æ€§ åŸºç¡€çš„äº‹åŠ¡ NoSQL ä¸ä»…ä»…æ˜¯æ•°æ® æ²¡æœ‰å›ºå®šçš„æŸ¥è¯¢è¯­è¨€ é”®å€¼å¯¹å­˜å‚¨ï¼Œåˆ—å­˜å‚¨ï¼Œæ–‡æ¡£å­˜å‚¨ï¼Œå›¾å½¢æ•°æ®åº“ï¼ˆç¤¾äº¤å…³ç³»ï¼‰ æœ€ç»ˆä¸€è‡´æ€§ CAPå®šç†å’ŒBASEï¼ˆå¼‚åœ°å¤šæ´»ï¼‰åˆçº§æž¶æž„å¸ˆ é«˜æ€§èƒ½ï¼Œé«˜å¯ç”¨ï¼Œé«˜å¯æ‰© äº†è§£ 3V + 3é«˜ 3V 1.æµ·é‡Volume 2.å¤šæ ·Variety 3å®žæ—¶Velocity 3é«˜ 1.é«˜å¯ç”¨ 2.é«˜å¯æ‰© 3.é«˜æ€§èƒ½ äºŒã€é˜¿é‡Œå·´å·´å®žè·µåˆ†æžç†è§£æ•°æ®æž¶æž„æ¼”è¿›1.å•†å“çš„åŸºæœ¬ä¿¡æ¯ï¼š åç§°ã€ä»·æ ¼ã€å•†å®¶ä¿¡æ¯ï¼š å…³ç³»åž‹æ•°æ®åº“å°±å¯ä»¥è§£å†³ï¼šMYSQL / Oracle ï¼ˆæ·˜å®æ—©å¹´å°±åŽ»IOEäº†â€“çŽ‹åš â€“é˜¿é‡Œäº‘è¿™ç¾¤ç–¯å­ï¼‰ â€‹ ï¼ˆIOE: IBMå°åž‹æœº â€“Oracleæ•°æ®åº“ â€“EMCå­˜å‚¨è®¾å¤‡ï¼‰ 2.å•†å“çš„æè¿°ã€è¯„è®ºï¼ˆæ–‡å­—æ¯”è¾ƒå¤šï¼‰ æ–‡æ¡£åž‹æ•°æ®åº“ä¸­ï¼ŒMongDB 3.å›¾ç‰‡ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ FastDFS æ·˜å®è‡ªå·±çš„ TFS Googleçš„ GFS hadoop HDFS é˜¿é‡Œäº‘çš„ oss 4.å•†å“çš„å…³é”®å­— ï¼ˆæœç´¢ï¼‰ æœç´ å¼•æ“Ž solr elasticsearch ISearchï¼šå¤šéš† ä¸‰ã€NoSQLå››å¤§åˆ†ç±»KVé”®å€¼å¯¹ï¼š \\æ–°æµªï¼šRedis ç¾Žå›¢ï¼šRedis + Tair é˜¿é‡Œã€ç™¾åº¦ï¼šRedis+memcache æ–‡æ¡£åž‹æ•°æ®åº“ï¼šï¼ˆbsonæ ¼å¼å’Œjsonä¸€æ ·ï¼‰ MongoDB(ä¸€èˆ¬å¿…é¡»æŽŒæ¡) â€‹ 1.MongDBæ˜¯ä¸€ä¸ªåŸºäºŽåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼ŒC++ç¼–å†™ï¼Œä¸»è¦ç”¨äºŽå¤„ç†å¤§é‡æ–‡æ¡£ â€‹ 2.MongDBæ˜¯ä¸€ä¸ªä»‹äºŽå…³ç³»åž‹æ•°æ®åº“å’Œéžå…³ç³»åž‹æ•°æ®åº“ä¸­ä¸­é—´çš„äº§å“ï¼ŒMongoDBæ˜¯éžå…³ç³»åž‹æ•°æ®åº“ä¸­åŠŸèƒ½æœ€ä¸°å¯Œï¼Œæœ€åƒå…³ç³»åž‹æ•°æ®åº“ â€‹ 3.ConthDB åˆ—å­˜å‚¨æ•°æ®åº“ï¼š HBase åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ å›¾å…³ç³»æ•°æ®åº“ï¼š ä»–ä¸æ˜¯å­˜å›¾å½¢ï¼Œæ”¾çš„æ˜¯å…³ç³»ï¼Œæ¯”å¦‚ï¼šæœ‹å‹åœˆç¤¾äº¤ç½‘ç»œã€ç½‘ç»œæŽ¨è Neo4J, InfoGrid å››ã€Redisçš„æ¦‚è¿°Redisçš„æ¦‚è¿°ï¼ˆRemote Dictionary Serverï¼‰å³è¿œç¨‹å­—å…¸æœåŠ¡ æ˜¯å•çº¿ç¨‹çš„å¤šè·¯IOå¤ç”¨ æ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºŽå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—åž‹ã€key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„API 1.å‘¨æœŸæ€§æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ 2.å®žçŽ°master-slaverï¼ˆä¸»ä»Žï¼‰åŒæ­¥ 3.å…è´¹å’Œå¼€æºï¼Œæ˜¯å½“ä¸‹æœ€çƒ­é—¨çš„NoSQLæŠ€æœ¯ä¹‹ä¸€ 4.ç»“æž„åŒ–æ•°æ®åº“ Redisèƒ½å¹²å˜›ï¼Ÿ 1.å†…å­˜å­˜å‚¨ï¼ŒæŒä¹…åŒ–ï¼ˆrdb,aofï¼‰ 2.æ•ˆçŽ‡é«˜ï¼Œå¯ä»¥ç”¨äºŽé«˜é€Ÿç¼“å­˜ 3.å‘å¸ƒè®¢é˜…ç³»ç»Ÿ 4.åœ°å›¾ä¿¡æ¯åˆ†æž 5.è®¡æ—¶å™¨ã€è®¡æ•°å™¨ï¼ˆæµè§ˆé‡ï¼‰ ç‰¹å¾ï¼š 1.å¤šæ ·çš„æ•°æ®ç±»åž‹ 2.æŒä¹…åŒ– 3.é›†ç¾¤ 4.äº‹åŠ¡ RedisæŽ¨èéƒ½æ˜¯åŸºäºŽLinuxæ­å»º äº”ã€Windowç‰ˆæœ¬Redisç‰ˆæœ¬ï¼š3.2.100 é»˜è®¤ç«¯å£ï¼š6379 å®˜æ–¹æ–‡æ¡£ï¼šhttp://redis.cn/topics/introduction å…­ã€Linuxå®‰è£…Redis Linuxå®‰è£…Redis 1.åŸºæœ¬çš„çŽ¯å¢ƒé…ç½®ï¼š ï¼ˆ1ï¼‰ 1yum install gcc-c++ ï¼ˆ2ï¼‰ # make ï¼ˆ3ï¼‰ make install 2.redisé»˜è®¤å®‰è£…è·¯å¾„ï¼š/usr/local/bin 3.redisé…ç½®æ–‡ä»¶: ï¼ˆ1ï¼‰åœ¨/usr/local/bin/ ä¸‹æ–°å»ºæ–‡ä»¶å¤¹kconfig ï¼ˆ2ï¼‰å°†redisé…ç½®æ–‡ä»¶redis.confï¼Œå¤åˆ¶åˆ°/usr/local/bin/kconfig ï¼ˆ3ï¼‰redisé»˜è®¤ä¸æ˜¯åŽå°å¯åŠ¨ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ”¹ä¸ºåŽå°å¯åŠ¨ 4.å¯åŠ¨redisæœåŠ¡ï¼š ï¼ˆ1ï¼‰å¯åŠ¨redisæœåŠ¡ç«¯ 1redis-server kconfig/redis.conf ï¼ˆ2ï¼‰ä½¿ç”¨å®¢æˆ·ç«¯è¿žæŽ¥ç«¯å£å·6379 1redis-cli -p 6379 5.æŸ¥çœ‹è¿›ç¨‹ï¼š 1ps -ef |grep redis[æœåŠ¡å] 6.å…³é—­redisæœåŠ¡: 12345shutdownnot connected&gt; exit# ä¸ƒã€redisæ€§èƒ½æµ‹è¯•æµ‹è¯•ï¼š100ä¸ªå¹¶å‘è¿žæŽ¥ 10 0000è¯·æ±‚ 1$ redis-benchmark -h localhost -p 6379 -c 100 -n 100000 å…«ã€åŸºç¡€çŸ¥è¯†1.redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“,é»˜è®¤ä½¿ç”¨çš„æ˜¯ç¬¬0ä¸ª ï¼ˆ1ï¼‰åˆ‡æ¢æ•°æ®åº“ï¼š 1127.0.0.1:6379&gt; select 3 ï¼ˆ2ï¼‰æ•°æ®åº“å¤§å°ï¼š 1127.0.0.1:6379&gt; DBSIZE ï¼ˆ3ï¼‰æŸ¥çœ‹æ‰€æœ‰key: 1127.0.0.1:6379&gt; keys * ï¼ˆ4ï¼‰æ¸…é™¤å½“å‰æ•°æ®åº“ 1127.0.0.1:6379&gt; flushdb ï¼ˆ5ï¼‰æ¸…é™¤å…¨éƒ¨æ•°æ®å†…å®¹ 1127.0.0.1:6379&gt; flushall ï¼ˆ6ï¼‰åˆ é™¤æŒ‡å®škeyæ•°æ® 1127.0.0.1:6379&gt; del key (7)æ ¹æ®valueé€‰æ‹©éžé˜»å¡žåˆ é™¤ 1127.0.0.1:6379&gt; unline key (8)ä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ 12# 10ç§’é’Ÿ127.0.0.1:6379&gt; expire key 10 2.Redisæ˜¯å•çº¿ç¨‹ Redisä¸ºä»€ä¹ˆå•çº¿ç¨‹è¿™ä¹ˆå¿«ï¼Ÿ 1.è¯¯åŒº1ï¼šé«˜æ€§èƒ½çš„æœåŠ¡å™¨ä¸€å®šæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿ 2.è¯¯åŒº2ï¼šå¤šçº¿ç¨‹ï¼ˆCPUä¸Šä¸‹æ–‡ä¼šåˆ‡æ¢ï¼‰ä¸€å®šæ¯”å•çº¿ç¨‹æ•ˆçŽ‡é«˜ æ ¸å¿ƒï¼šredisæ˜¯æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥è¯´ä½¿ç”¨å•çº¿ç¨‹åŽ»æ“ä½œæ•ˆçŽ‡æ˜¯æœ€é«˜çš„ï¼Œå¤šçº¿ç¨‹ä¼šåˆ‡æ¢CPUä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯¹äºŽå†…å­˜ç³»ç»Ÿæ¥è¯´ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æ•ˆçŽ‡æœ€é«˜çš„ï¼Œå¤šæ¬¡è¯»å†™éƒ½æ˜¯åœ¨å•ä¸ªCPUä¸Šæ“ä½œçš„ ä¹ã€åŸºæœ¬å‘½ä»¤è®¾ç½®keyè¿‡æœŸæ—¶é—´ï¼š 1127.0.0.16379&gt; EXPIRE name 10 æŸ¥çœ‹keyçš„å‰©ä½™æ—¶é—´ï¼š 1127.0.0.16379&gt; ttl name[key] æŸ¥çœ‹keyçš„ç±»åž‹ 1127.0.0.16379&gt; type name Rediså‘½ä»¤å¸®åŠ©æ–‡æ¡£ï¼šhttps://redis.io/commands åã€äº”å¤§æ•°æ®ç±»åž‹StringStringäºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ„å‘³ç€Redisä¸­çš„Stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œæ¯”å¦‚jpgæˆ–åºåˆ—åŒ–å¯¹è±¡ï¼Œå­—ç¬¦ä¸²valueæœ€å¤§å¯ä»¥æ˜¯512M åˆ¤æ–­å­˜åœ¨ï¼š 1127.0.0.1:6379&gt; exist key è¿½åŠ ï¼šï¼ˆkeyå€¼ä¸å­˜åœ¨ï¼Œç›¸å½“äºŽsetï¼‰ 1127.0.0.1:6379&gt; append key1 &quot;hello&quot; èŽ·å–é•¿åº¦ï¼š 1127.0.0.1:6379&gt; strlen key1 è‡ªå¢ž1ï¼š 12127.0.0.1:6379&gt; incr key è‡ªå‡1ï¼š127.0.0.1:6379&gt; dect key æŒ‡å®šå¢žé‡ï¼š 1127.0.0.1:6379&gt; incrby key 10 æŒ‡å®šå‡é‡ï¼š 1127.0.0.1:6379&gt; decrby key 10 èŽ·å–å­—ç¬¦ä¸²æŒ‡å®šèŒƒå›´ï¼š 1127.0.0.1:6379&gt; GETRANGE key 0 3 #[0,3] æ›¿æ¢æŒ‡å®šä½ç½®å¼€å§‹çš„å­—ç¬¦ä¸²ï¼š 1127.0.0.1:6379&gt; SETRANGE key 1 xx è®¾ç½®è¿‡æœŸæ—¶é—´ï¼š â€‹ #setex(set with expire) # è®¾ç½®è¿‡æœŸæ—¶é—´ 1127.0.0.1:6379&gt; setex key 30 &quot;hello&quot; â€‹ #setnx(set if not exist) # ä¸å­˜åœ¨è®¾ç½®ï¼ˆåˆ†å¸ƒå¼é”ä¸­å¸¸å¸¸ä½¿ç”¨ï¼‰ 1127.0.0.1:6379&gt; setnx key &quot;redis&quot; æ‰¹é‡setã€get #mset 1127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3 #msetnx 1127.0.0.1:6379&gt; msetnx k1 v1 k4 v4 #åŽŸå­æ€§,è¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ #å¯¹è±¡ 12127.0.0.1:6379&gt; set user:1&#123;name:zhangsan,zge:3&#125;#user:&#123;id&#125;:&#123;filer&#125; getset #å…ˆgetç„¶åŽå†set 123127.0.0.1:6379&gt; getset db redis 1.#å¦‚æžœä¸å­˜åœ¨å€¼ï¼Œåˆ™è¿”å›žnil2.#å¦‚æžœå­˜åœ¨å€¼ï¼Œåˆ™è¿”å›žåŽŸæ¥çš„å€¼ ListListçš„æ•°æ®ç»“æž„ä¸ºå¿«é€Ÿé“¾è¡¨quickList é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µè¯·ä¸‹ä¼šä½¿ç”¨ä¸€å—è¿žç»­çš„å†…å­˜å‚¨å­˜ï¼Œè¿™ä¸ªç»“æž„æ˜¯ziplist,å³æ˜¯åŽ‹ç¼©åˆ—è¡¨ å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å‚¨å­˜ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿žç»­çš„å†…å­˜ å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆquickList å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ï¼Œæ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„æ˜¯intç±»åž‹çš„æ•°æ®ï¼Œç»“æž„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆprevå’Œnext åœ¨redisé‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠlistå½“æˆæ˜¯å¯¹æ ˆã€é˜Ÿåˆ—ã€é˜»å¡žé˜Ÿåˆ—çš„æ“ä½œ æ‰€æœ‰listå‘½ä»¤éƒ½æ˜¯ç”¨lå¼€å¤´çš„ 1# LPUSH 123456127.0.0.1:6379&gt; LPUSH list one # å°†ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼ï¼Œæ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ï¼ˆå·¦ï¼‰(integer) 1127.0.0.1:6379&gt; LPUSH list two(integer) 2127.0.0.1:6379&gt; LPUSH list three(integer) 3 12############################################################# LRANGE 1234567891011127.0.0.1:6379&gt; LRANGE list 0 -1 # èŽ·å–listä¸­æ‰€æœ‰å€¼1) &quot;three&quot;2) &quot;two&quot;3) &quot;one&quot;127.0.0.1:6379&gt; LRANGE list 0 1 # é€šè¿‡åŒºé—´èŽ·å–å…·ä½“çš„å€¼1) &quot;three&quot;2) &quot;two&quot;127.0.0.1:6379&gt; LRANGE list 0 21) &quot;three&quot;2) &quot;two&quot;3) &quot;one&quot; 12############################################################# RPUSHã€LPOPã€RPOP 123456789101112131415127.0.0.1:6379&gt; RPUSH list right # å°†ä¸€ä¸ªå€¼æˆ–å¤šä¸ªå€¼ï¼Œæ’å…¥åˆ°åˆ—è¡¨å°¾éƒ¨ï¼ˆå³ï¼‰(integer) 4127.0.0.1:6379&gt; LRANGE list 0 -11) &quot;three&quot;2) &quot;two&quot;3) &quot;one&quot;4) &quot;right&quot;127.0.0.1:6379&gt; LPOP list # ç§»é™¤listçš„ç¬¬ä¸€ä¸ªå…ƒç´ &quot;three&quot;127.0.0.1:6379&gt; RPOP list&quot;right&quot;127.0.0.1:6379&gt; LRANGE list 0 -1 # ç§»é™¤listçš„æœ€åŽä¸€ä¸ªå…ƒç´ 1) &quot;two&quot;2) &quot;one&quot;127.0.0.1:6379&gt; 12############################################################# LINDEXã€LPUSHã€LLEN 123456789101112131415161718192021222324127.0.0.1:6379&gt; lindex list 1 # é€šè¿‡ä¸‹æ ‡èŽ·å¾—list ä¸­çš„æŸä¸€ä¸ªå€¼&quot;one&quot;127.0.0.1:6379&gt; lindex list 0&quot;two&quot;127.0.0.1:6379&gt; 127.0.0.1:6379&gt; Lpush list one(integer) 1127.0.0.1:6379&gt; Lpush list two(integer) 2127.0.0.1:6379&gt; Lpush list three(integer) 3127.0.0.1:6379&gt; Llen list # èŽ·å–listé•¿åº¦(integer) 3127.0.0.1:6379&gt; Lpush list thre(integer) 4127.0.0.1:6379&gt; LRANGE list 1 -11) &quot;three&quot;2) &quot;two&quot;3) &quot;one&quot;127.0.0.1:6379&gt; LRANGE list 0 -11) &quot;thre&quot;2) &quot;three&quot;3) &quot;two&quot;4) &quot;one&quot; 12############################################################# LREM 1234567891011121314127.0.0.1:6379&gt; Lrem list 1 thre # ç§»é™¤åˆ—è¡¨åˆ—è¡¨ä¸­ä¸€ä¸ªå…ƒç´ ä¸ºthre(integer) 1127.0.0.1:6379&gt; Lpush list three(integer) 4127.0.0.1:6379&gt; LRANGE list 0 -11) &quot;three&quot;2) &quot;three&quot;3) &quot;two&quot;4) &quot;one&quot;127.0.0.1:6379&gt; Lrem list 2 three(integer) 2127.0.0.1:6379&gt; LRANGE list 0 -11) &quot;two&quot;2) &quot;one&quot; trim ä¿®å‰ªï¼›listæˆªæ–­ 12345678910111213141516# LTRIM127.0.0.1:6379&gt; keys *(empty array)127.0.0.1:6379&gt; Rpush mylist &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; Rpush mylist &quot;hello1&quot;(integer) 2127.0.0.1:6379&gt; Rpush mylist &quot;hello2&quot;(integer) 3127.0.0.1:6379&gt; Rpush mylist &quot;hello3&quot;(integer) 4127.0.0.1:6379&gt; ltrim mylist 1 2 # æˆªå–ä¸‹æ ‡æŒ‡å®šçš„é•¿åº¦ï¼Œå…¶ä»–è¢«æˆªæ–­OK127.0.0.1:6379&gt; LRANGE mylist 0 -11) &quot;hello1&quot;2) &quot;hello2&quot; 12############################################################RPOPLPUSH 12345678910111213127.0.0.1:6379&gt; rpush mylist &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; rpush mylist &quot;hello1&quot;(integer) 2127.0.0.1:6379&gt; rpush mylist &quot;hello2&quot;(integer) 3127.0.0.1:6379&gt; rpoplpush mylist myotherlist # ç§»é™¤æœ€åŽä¸€ä¸ªå…ƒç´ å¹¶å°†å®ƒç§»å…¥æ–°çš„åˆ—è¡¨ä¸­&quot;hello2&quot;127.0.0.1:6379&gt; LRANGE mylist 0 -11) &quot;hello&quot;2) &quot;hello1&quot;127.0.0.1:6379&gt; LRANGE myotherlist 0 -11) &quot;hello2&quot; 12############################################################# LSET 12345678910111213141516127.0.0.1:6379&gt; exists list(integer) 0127.0.0.1:6379&gt; lset list 0 item # å¦‚æžœä¸å­˜åœ¨åˆ—è¡¨æˆ‘ä»¬åŽ»æ›´æ–°å°±ä¼šæŠ¥é”™(error) ERR no such key127.0.0.1:6379&gt; LPUSH list value1(integer) 1127.0.0.1:6379&gt; LRANGE list 0 01) &quot;value1&quot;127.0.0.1:6379&gt; LRANGE list 0 11) &quot;value1&quot;127.0.0.1:6379&gt; LSET list 0 item # å¦‚æžœå­˜åœ¨ï¼Œæ›´æ–°å½“å‰ä¸‹æ ‡çš„å€¼OK127.0.0.1:6379&gt; LRANGE list 0 01) &quot;item&quot;127.0.0.1:6379&gt; LSET list 1 other # å¦‚æžœä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™(error) ERR index out of range 12############################################################# LINSERT 123456789101112131415161718Linsert # å°†æŸä¸ªå…·ä½“çš„valueæ’å…¥åˆ°åˆ—è¡¨ä¸­æŸä¸ªå…ƒç´ çš„å‰é¢æˆ–è€…åŽé¢ï¼127.0.0.1:6379&gt; RPUSH mylist &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; RPUSH mylist &quot;world&quot;(integer) 2127.0.0.1:6379&gt; LINSERT mylist before &quot;world&quot; &quot;other&quot;(integer) 3127.0.0.1:6379&gt; LRANGE mylist 0 -11) &quot;hello&quot;2) &quot;other&quot;3) &quot;world&quot;127.0.0.1:6379&gt; LINSERT mylist after &quot;world&quot; &quot;new&quot;(integer) 4127.0.0.1:6379&gt; LRANGE mylist 0 -11) &quot;hello&quot;2) &quot;other&quot;3) &quot;world&quot;4) &quot;new&quot; æ€»ç»“ï¼š listå®žé™…æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œbefore Node after , left , rightéƒ½å¯ä»¥æ’å…¥å€¼ å¦‚æžœkeyä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„é“¾è¡¨ å¦‚æžœkeyå­˜åœ¨ï¼Œæ–°å¢žå†…å®¹ å¦‚æžœç§»é™¤äº†æ‰€æœ‰å€¼ï¼Œç©ºé“¾è¡¨ï¼Œä¹Ÿä»£è¡¨ä¸å­˜åœ¨ åœ¨ä¸¤è¾¹æ’å…¥æˆ–è€…æ”¹åŠ¨å€¼ï¼Œæ•ˆçŽ‡æœ€é«˜ï¼Œä¸­é—´å…ƒç´ ï¼Œç›¸å¯¹æ¥è¯´æ•ˆçŽ‡ä¼šä½Žä¸€ç‚¹ æ¶ˆæ¯é˜Ÿåˆ— | LpushRpop ï¼Œ æ ˆ | LpushLpop SetSetæ•°æ®ç»“æž„æ˜¯dictå­—å…¸ï¼Œå­—å…¸ä½¿ç”¨å“ˆå¸Œè¡¨å®žçŽ°çš„ Javaä¸­HashSetçš„å†…éƒ¨å®žçŽ°ä½¿ç”¨çš„æ˜¯HashMap,åªä¸è¿‡æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ Redisçš„setç»“æž„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨äº†hashç»“æž„ï¼Œæ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ 1# SADDã€SMEMBERSã€SISMEMBERã€SCARD 1234567891011121314151617127.0.0.1:6379&gt; sadd myset &quot;hello&quot; # seté›†åˆæ·»åŠ å…ƒç´ (integer) 1127.0.0.1:6379&gt; sadd myset &quot;kuangshen&quot;(integer) 1127.0.0.1:6379&gt; sadd myset &quot;world&quot;(integer) 1127.0.0.1:6379&gt; SMEMBERS myset # æŸ¥çœ‹æŒ‡å®šsetæ‰€æœ‰å€¼1) &quot;world&quot;2) &quot;kuangshen&quot;3) &quot;hello&quot;127.0.0.1:6379&gt; SISMEMBER myset &quot;hello&quot; # åˆ¤æ–­æŸä¸€ä¸ªå€¼æ˜¯ä¸æ˜¯åœ¨é›†åˆsetä¸­(integer) 1127.0.0.1:6379&gt; SISMEMBER myset &quot;happy&quot;(integer) 0127.0.0.1:6379&gt; scard myset # èŽ·å–é›†åˆsetä¸­å…ƒç´ çš„ä¸ªæ•°(integer) 3127.0.0.1:6379&gt; 12############################################################# SRANDMEMBER 123456789101112131415161718127.0.0.1:6379&gt; SMEMBERS myset1) &quot;world&quot;2) &quot;kuangshen&quot;3) &quot;hello&quot;127.0.0.1:6379&gt; SRANDMEMBER myset # éšæœºæŠ½é€‰å‡ºä¸€ä¸ªå…ƒç´ &quot;hello&quot;127.0.0.1:6379&gt; SRANDMEMBER myset&quot;hello&quot;127.0.0.1:6379&gt; SRANDMEMBER myset&quot;world&quot;127.0.0.1:6379&gt; SRANDMEMBER myset&quot;kuangshen&quot;127.0.0.1:6379&gt; SRANDMEMBER myset 2 éšæœºæŠ½é€‰å‡ºæŒ‡å®šä¸ªæ•°çš„å…ƒç´ 1) &quot;kuangshen&quot;2) &quot;world&quot;127.0.0.1:6379&gt; SRANDMEMBER myset 21) &quot;kuangshen&quot;2) &quot;hello&quot; 12############################################################# SPOP 12345678910127.0.0.1:6379&gt; SMEMBERS myset1) &quot;world&quot;2) &quot;kuangshen&quot;3) &quot;hello&quot;127.0.0.1:6379&gt; spop myset # éšæœºåˆ é™¤ä¸€äº›seté›†åˆä¸­çš„å…ƒç´ &quot;world&quot;127.0.0.1:6379&gt; spop myset&quot;kuangshen&quot;127.0.0.1:6379&gt; SMEMBERS myset1) &quot;hello&quot; 12############################################################# SMOVE 123456789101112131415161718192021222324å°†ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œç§»åŠ¨åˆ°å¦ä¸€ä¸ªseté›†åˆ127.0.0.1:6379&gt; clear127.0.0.1:6379&gt; sadd myset &quot;hello&quot;(integer) 1127.0.0.1:6379&gt; sadd myset &quot;world&quot;(integer) 1127.0.0.1:6379&gt; sadd myset &quot;kuangshen&quot;(integer) 1127.0.0.1:6379&gt; sadd myset2 &quot;kuangshen&quot;(integer) 1127.0.0.1:6379&gt; SMEMBERS myset1) &quot;kuangshen&quot;2) &quot;world&quot;3) &quot;hello&quot;127.0.0.1:6379&gt; SMEMBERS myset21) &quot;kuangshen&quot;127.0.0.1:6379&gt; SMOVE myset myset2 &quot;hello&quot; # å°†ä¸€ä¸ªæŒ‡å®šçš„å€¼ï¼Œç§»åŠ¨åˆ°å¦ä¸€ä¸ªseté›†åˆ(integer) 1127.0.0.1:6379&gt; SMEMBERS myset1) &quot;kuangshen&quot;2) &quot;world&quot;127.0.0.1:6379&gt; SMEMBERS myset21) &quot;kuangshen&quot;2) &quot;hello&quot; 12############################################################# SDIFFã€SINTERã€SUNION 123456789101112131415161718192021222324252627Bç«™ã€å¾®åšå…±åŒå…³æ³¨ï¼ˆå¹¶é›†ï¼‰127.0.0.1:6379&gt; sadd key1 a(integer) 1127.0.0.1:6379&gt; sadd key1 b(integer) 1127.0.0.1:6379&gt; sadd key1 c(integer) 1127.0.0.1:6379&gt; sadd key2 a(integer) 1127.0.0.1:6379&gt; sadd key2 d(integer) 1127.0.0.1:6379&gt; sadd key2 e(integer) 1127.0.0.1:6379&gt; SDIFF key1 key2 # å·®é›† å·¦ - å³1) &quot;c&quot;2) &quot;b&quot;127.0.0.1:6379&gt; SDIFF key2 key11) &quot;e&quot;2) &quot;d&quot;127.0.0.1:6379&gt; SINTER key1 key2 # äº¤é›†1) &quot;a&quot;127.0.0.1:6379&gt; SUNION key1 key2 # å¹¶é›†1) &quot;a&quot;2) &quot;c&quot;3) &quot;b&quot;4) &quot;e&quot;5) &quot;d&quot; HashMapé›†åˆï¼Œkey-map è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªMapï¼Œæœ¬è´¨å’ŒSringæ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œè¿˜æ˜¯ä¸€ä¸ªç®€å•çš„key-value Hashç±»åž‹å¯¹åº”çš„æ•°æ®ç»“æž„æœ‰ä¸¤ç§ï¼šziplistï¼ˆåŽ‹ç¼©åˆ—è¡¨ï¼‰ã€hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰,å½“field-valueé•¿åº¦äº¤çŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtable set myhash field kuangshen 1# HSETã€HGETã€HMSETã€HMGETã€HGETALL 1234567891011121314127.0.0.1:6379&gt; hset myhash field1 kuangshen # set ä¸€ä¸ªå…·ä½“key-value(integer) 1127.0.0.1:6379&gt; hget myhash field1 # èŽ·å–ä¸€ä¸ªå­—æ®µå€¼&quot;kuangshen&quot;127.0.0.1:6379&gt; hmset myhash field1 hello field2 world # set å¤šä¸ªkey-valueOK127.0.0.1:6379&gt; hmget myhash field1 field2 # èŽ·å–å¤šä¸ªå­—æ®µå€¼1) &quot;hello&quot;2) &quot;world&quot;127.0.0.1:6379&gt; hgetall myhash # èŽ·å–å…¨éƒ¨çš„æ•°æ®1) &quot;field1&quot;2) &quot;hello&quot;3) &quot;field2&quot;4) &quot;world&quot; 12############################################################# HDEL 1234567891011121314127.0.0.1:6379&gt; hset myhash field1 hello(integer) 1127.0.0.1:6379&gt; hset myhash field2 world(integer) 1127.0.0.1:6379&gt; hgetall myhash1) &quot;field1&quot;2) &quot;hello&quot;3) &quot;field2&quot;4) &quot;world&quot;127.0.0.1:6379&gt; hdel myhash field1 # åˆ é™¤hashæŒ‡å®šleyå­—æ®µï¼Œå¯¹åº”çš„valueä¹Ÿå°±æ¶ˆå¤±äº†(integer) 1127.0.0.1:6379&gt; hgetall myhash1) &quot;field2&quot;2) &quot;world&quot; 12############################################################# hlen 12345678127.0.0.1:6379&gt; hlen myhash # èŽ·å–hashè¡¨çš„å­—æ®µæ•°é‡(integer) 1############################################################# HEXISTS127.0.0.1:6379&gt; HEXISTS myhash field1 #åˆ¤æ–­hash ä¸­æŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨(integer) 0127.0.0.1:6379&gt; HEXISTS myhash field2(integer) 1 12############################################################# HKEYS ã€HVALS 12345åªèŽ·å¾—æ‰€æœ‰fieldï¼ŒåªèŽ·å¾—æ‰€æœ‰value127.0.0.1:6379&gt; hkeys myhash # åªèŽ·å¾—æ‰€æœ‰field1) &quot;field2&quot;127.0.0.1:6379&gt; hvals myhash # åªèŽ·å¾—æ‰€æœ‰value1) &quot;world&quot; 12############################################################# HINCRBYã€HSETNX 12345678910127.0.0.1:6379&gt; hset myhash field3 5(integer) 1127.0.0.1:6379&gt; HINCRBY myhash field3 1 # æŒ‡å®šå¢žé‡(integer) 6127.0.0.1:6379&gt; HINCRBY myhash field3 -1(integer) 5127.0.0.1:6379&gt; HSETNX myhash field4 hello # å¦‚æžœvalueä¸å­˜åœ¨åˆ™å¯ä»¥è®¾ç½®(integer) 1127.0.0.1:6379&gt; HSETNX myhash field4 world # å¦‚æžœvalueå­˜åœ¨åˆ™ä¸å…è®¸è®¾ç½®(integer) 0 hashå˜æ›´çš„æ•°æ®user name ageï¼Œå°¤å…¶æ˜¯ç”¨æˆ·ä¿¡æ¯ä¹‹ç±»çš„ï¼Œç»å¸¸å˜åŠ¨çš„ä¿¡æ¯ï¼Œhashæ›´é€‚åˆäºŽå¯¹è±¡çš„å­˜å‚¨ï¼ŒStringæ›´é€‚åˆå­—ç¬¦ä¸²å­˜å‚¨ ZsetSortedSetï¼ˆzsetï¼‰æ˜¯Redisæä¾›çš„ä¸€ä¸ªéžå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æž„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äºŽJavaæ•°æ®ç»“æž„Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ èµ‹äºˆæƒé‡scoreï¼Œå¦ä¸€æ–¹é¢å®ƒæœ‰ç±»ä¼¼äºŽTreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šå®‰è£…scoreæƒé‡è¿›è¡ŒæŽ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥èŽ·å–å…ƒç´ çš„åˆ—è¡¨ã€‚ æŸ¥æ‰¾ä½¿ç”¨çš„æ˜¯è·³è·ƒé“¾è¡¨ åœ¨setçš„åŸºç¡€ä¸Šï¼Œå¢žåŠ äº†ä¸€ä¸ªå€¼ï¼Œå¢žåŠ äº†ä¸€ä¸ªå€¼ï¼Œset k1 v1 , zset k1 score1 v1 123456789# ZADDã€ZRANGE127.0.0.1:6379&gt; zadd myset 1 one # æ·»åŠ ä¸€ä¸ªå€¼(integer) 1127.0.0.1:6379&gt; zadd myset 2 two 3 three # æ·»åŠ å¤šä¸ªå€¼(integer) 2127.0.0.1:6379&gt; ZRANGE myset 0 -11) &quot;one&quot;2) &quot;two&quot;3) &quot;three&quot; 12############################################################# ZRANGEBYSCORE 1234567891011121314151617181920212223242526127.0.0.1:6379&gt; zadd salary 2500 xiaohong(integer) 1127.0.0.1:6379&gt; zadd salary 5000 zhagsan(integer) 1127.0.0.1:6379&gt; zadd salary 500 kuangshen(integer) 1127.0.0.1:6379&gt; ZRANGE salary 0 -1 # æ˜¾ç¤ºå…¨éƒ¨ç”¨æˆ·ï¼Œä»Žå°åˆ°å¤§1) &quot;zhangsan&quot;2) &quot;xiaohong&quot;3) &quot;xiaoming&quot;127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf # æ˜¾ç¤ºå…¨éƒ¨ç”¨æˆ· ä»Žå°åˆ°å¤§1) &quot;kuangshen&quot;2) &quot;xiaohong&quot;3) &quot;zhagsan&quot;127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf +inf withscores # ä»Žå°åˆ°å¤§æ˜¾ç¤ºå…¨éƒ¨ç”¨æˆ·å¹¶ä¸”é™„å¸¦æˆç»©1) &quot;kuangshen&quot;2) &quot;500&quot;3) &quot;xiaohong&quot;4) &quot;2500&quot;5) &quot;zhagsan&quot;6) &quot;5000&quot;127.0.0.1:6379&gt; ZRANGEBYSCORE salary -inf 2500 withscores1) &quot;kuangshen&quot;2) &quot;500&quot;3) &quot;xiaohong&quot;4) &quot;2500&quot; 12############################################################# ZREVRANGEã€ZREVRANGEBYSCORE 123456789101112131415161718192021127.0.0.1:6379&gt; zadd salary 2500 xiaoming (integer) 1127.0.0.1:6379&gt; zadd salary 1800 xiaohong(integer) 1127.0.0.1:6379&gt; zadd salary 1500 zhangsan(integer) 1127.0.0.1:6379&gt; ZREVRANGE salary 0 -1 # æ˜¾ç¤ºå…¨éƒ¨ç”¨æˆ·ï¼Œä»Žå¤§åˆ°å°1) &quot;xiaoming&quot;2) &quot;xiaohong&quot;3) &quot;zhangsan&quot;127.0.0.1:6379&gt; ZREVRANGEBYSCORE salary +inf -inf # ä»Žå¤§åˆ°å°æ˜¾ç¤º1) &quot;xiaoming&quot;2) &quot;xiaohong&quot;3) &quot;zhangsan&quot;127.0.0.1:6379&gt; ZREVRANGEBYSCORE salary +inf -inf withscores # ä»Žå¤§åˆ°å°æ˜¾ç¤ºå…¨éƒ¨ç”¨æˆ·å¹¶ä¸”é™„å¸¦æˆç»©1) &quot;xiaoming&quot;2) &quot;2500&quot;3) &quot;xiaohong&quot;4) &quot;1800&quot;5) &quot;zhangsan&quot;6) &quot;1500&quot; 12############################################################# ZCOUNT 12127.0.0.1:6379&gt; zcount salary 1500 3000 # è¯»å–æŒ‡å®šåŒºé—´çš„ç”¨æˆ·æ•°é‡(integer) 3 æ€»ç»“ï¼š ZRANGE åŽé¢åªèƒ½è·Ÿ 0 -1 ZRANGEBYSCOREåŽé¢åªèƒ½è·Ÿ èŒƒå›´ï¼Œä¾‹å¦‚ï¼š -inf +inf åä¸€ã€ä¸‰å¤§ç‰¹æ®Šæ•°æ®ç±»åž‹Geospatialåœ°ç†ä½ç½®å…«å‘½ä»¤ï¼š 123# geoadd æ·»åŠ åœ°ç†ä½ç½®#è§„åˆ™ ä¸¤çº§æ— æ³•ç›´æŽ¥æ·»åŠ ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸‹è½½åŸŽå¸‚æ•°æ®ï¼Œç›´æŽ¥é€šè¿‡javaç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥#å‚æ•° key å€¼ï¼ˆç»åº¦ çº¬åº¦ åç§°ï¼‰ 123456789127.0.0.1:6379&gt; geoadd china:city 116.40 39.90 beijing(integer) 1127.0.0.1:6379&gt; geoadd china:city 121.47 31.23 shanghai(integer) 1127.0.0.1:6379&gt; geoadd china:city 106.50 29.53 chongqing 114.05 22.52 shengzhen(integer) 2127.0.0.1:6379&gt; geoadd china:city 120.16 30.24 hangzhou(integer) 1127.0.0.1:6379&gt; 12#############################################################geopos 123456127.0.0.1:6379&gt; GEOPOS china:city beijing # èŽ·å–åœ°ç†ä½ç½®åæ ‡1) 1) &quot;116.39999896287918091&quot; 2) &quot;39.90000009167092543&quot;127.0.0.1:6379&gt; GEOPOS china:city shanghai1) 1) &quot;121.47000163793563843&quot; 2) &quot;31.22999903975783553&quot; 12# GEODISTä¸¤äººä¹‹é—´çš„è·ç¦» å•ä½ï¼š mè¡¨ç¤ºå•ä½ä¸ºç±³ kmè¡¨ç¤ºå•ä½ä¸ºåƒç±³ miè¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œ ftè¡¨ç¤ºå•ä½ä¸ºè‹±å°º 1# GEODIST 123456127.0.0.1:6379&gt; GEODIST china:city beijing shanghai # åŒ—äº¬åˆ°ä¸Šæµ·çš„ç›´å¾„è·ç¦»&quot;1067378.7564&quot;127.0.0.1:6379&gt; GEODIST china:city beijing shanghai km&quot;1067.3788&quot;127.0.0.1:6379&gt; GEODIST china:city beijing chongqing km&quot;1464.0708&quot; 1# GEORADIUS [WITHCOORD] [WITHDIST] 12345678910111213141516171819202122232425262728293031323334127.0.0.1:6379&gt; GEORADIUS china:city 110 30 1000 km # èŽ·å–å¤„åœ¨æŸä¸ªå…·ä½“åæ ‡æŒ‡å®šåŠå¾„å†…çš„åœ°ç†ä½ç½®1) &quot;chongqing&quot;2) &quot;xian&quot;3) &quot;shengzhen&quot;4) &quot;hangzhou&quot;127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km1) &quot;chongqing&quot;2) &quot;xian&quot;127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withdist1) 1) &quot;chongqing&quot; 2) &quot;341.9374&quot;2) 1) &quot;xian&quot; 2) &quot;483.8340&quot;127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withcoord1) 1) &quot;chongqing&quot; 2) 1) &quot;106.49999767541885376&quot; 2) &quot;29.52999957900659211&quot;2) 1) &quot;xian&quot; 2) 1) &quot;108.96000176668167114&quot; 2) &quot;34.25999964418929977&quot;127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withdist withcoord count 11) 1) &quot;chongqing&quot; 2) &quot;341.9374&quot; 3) 1) &quot;106.49999767541885376&quot; 2) &quot;29.52999957900659211&quot;127.0.0.1:6379&gt; GEORADIUS china:city 110 30 500 km withdist withcoord count 21) 1) &quot;chongqing&quot; 2) &quot;341.9374&quot; 3) 1) &quot;106.49999767541885376&quot; 2) &quot;29.52999957900659211&quot;2) 1) &quot;xian&quot; 2) &quot;483.8340&quot; 3) 1) &quot;108.96000176668167114&quot; 2) &quot;34.25999964418929977&quot; 12# GEOHASHè¯¥å‘½ä»¤è¿”å›ž11ä¸ªå­—ç¬¦çš„Geohashå­—ç¬¦ä¸² 1234# å°†äºŒç»´çš„ç»çº¬åº¦è½¬æ¢ä¸ºä¸€ç»´çš„å­—ç¬¦ä¸²ï¼Œå¦‚æžœä¸¤ä¸ªå­—ç¬¦ä¸²è¶ŠæŽ¥è¿‘ï¼Œnameåˆ™è·ç¦»è¶Šè¿‘127.0.0.1:6379&gt; GEOHASH china:city beijing chongqing1) &quot;wx4fbxxfke0&quot;2) &quot;wm5xzrybty0&quot; 1GEO åº•å±‚çš„å®žçŽ°åŽŸç†å…¶å®žå°±æ˜¯Zset,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Zsetå‘½ä»¤æ¥æ“ä½œgeo 123456789101112131415127.0.0.1:6379&gt; ZRANGE china:city 0 -11) &quot;chongqing&quot;2) &quot;xian&quot;3) &quot;shengzhen&quot;4) &quot;hangzhou&quot;5) &quot;shanghai&quot;6) &quot;beijing&quot;127.0.0.1:6379&gt; ZREM china:city beijing(integer) 1127.0.0.1:6379&gt; ZRANGE china:city 0 -11) &quot;chongqing&quot;2) &quot;xian&quot;3) &quot;shengzhen&quot;4) &quot;hangzhou&quot;5) &quot;shanghai&quot; HyperloglogåŸºæ•°ç»Ÿè®¡Redis2.8.9ç‰ˆæœ¬å°±æ›´æ–°äº†Hyperloglogæ•°æ®ç»“æž„ Redis HyperloglogåŸºæ•°ç»Ÿè®¡çš„ç®—æ³• ä¼˜ç‚¹ï¼šå ç”¨çš„å†…å­˜æ˜¯å›ºå®šï¼Œè®¡ç®—2^64ä¸åŒçš„å…ƒç´ çš„æŠ€æœ¯ï¼Œåªéœ€è¦è´¹12KBå†…å­˜ï¼Œå¦‚æžœè¦ä»Žå†…å­˜è§’åº¦æ¥æ¯”è¾ƒï¼ŒHyperloglogé¦–é€‰ ç½‘é¡µçš„UV ä¼ ç»Ÿæ–¹å¼ï¼šsetä¿å­˜ç”¨æˆ·çš„id,ç„¶åŽç»Ÿè®¡setä¸­çš„å…ƒç´ æ•°é‡ä½œä¸ºæ ‡å‡†åˆ¤æ–­ 0.81%é”™è¯¯çŽ‡ï¼Œç»Ÿè®¡UVä»»åŠ¡ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ 12# PFADDã€PFCOUNTã€PFMERGEæµ‹è¯• 12345678910127.0.0.1:6379&gt; pfadd mykey a b c d e f g h i # åˆ›å»ºç¬¬ä¸€ç»„å…ƒç´  key(integer) 1127.0.0.1:6379&gt; pfadd mykey2 i j z x c v b n m (integer) 1127.0.0.1:6379&gt; pfcount mykey2 # ç»Ÿè®¡mykey2å…ƒç´ çš„åŸºæ•°æ•°é‡(integer) 9127.0.0.1:6379&gt; pfmerge mykey3 mykey mykey2 # åˆå¹¶ä¸¤ç»„ mykey mykey2 =&gt; mykey3 å¹¶é›†OK127.0.0.1:6379&gt; pfcount mykey3 # ç»Ÿè®¡å¹¶é›†ä¸­çš„å…ƒç´ æ•°é‡(integer) 15 è¦ä½¿ç”¨Hyperloglogï¼Œå‰ææ˜¯å…è®¸å®¹é”™ï¼ Bitmapsä½å›¾åœºæ™¯1ä½å­˜å‚¨ ç»Ÿè®¡ç”¨æˆ·ä¿¡æ¯ï¼Œæ´»è·ƒï¼Œæœªæ´»è·ƒï¼Œç™»å½•ï¼Œæœªç™»å½•ï¼Œæ‰“å¡ï¼Œ365æ‰“å¡ï¼Œä¸¤ä¸ªçŠ¶æ€çš„ï¼Œéƒ½å¯ä»¥ä½¿ç”¨Bitmapesï¼ Bitmapsä½å›¾ï¼Œæ•°æ®ç»“æž„ï¼éƒ½æ˜¯æ“ä½œäºŒè¿›åˆ¶ä½æ¥è¿›è¡Œè®°å½•ï¼Œå°±åªæœ‰0å’Œ1ä¸¤ä¸ªçŠ¶æ€ åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨çŽ‡å’Œå¼€å‘æ•ˆçŽ‡ ï¼ˆ1ï¼‰Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»åž‹ï¼Œå®žé™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼ˆkey-valueï¼‰ï¼Œä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œ ï¼ˆ2ï¼‰Bitmapså•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨Redisä¸­ä½¿ç”¨Bitmapså’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚å¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨1å’Œ0ï¼Œæ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapsä¸­å«åšåç§»é‡ 365å¤©=365bit 1å­—èŠ‚=8bit 46ä¸ªå­—èŠ‚å·¦å³ 1æµ‹è¯• 1# SETBITã€GETBIT 1234567891011121314127.0.0.1:6379&gt; setbit sign 0 1 # è®¾ç½®ç¬¬ä¸€å¤©æ‰“å¡(integer) 0127.0.0.1:6379&gt; setbit sign 1 0(integer) 0127.0.0.1:6379&gt; setbit sign 2 1(integer) 0127.0.0.1:6379&gt; setbit sign 3 0(integer) 0127.0.0.1:6379&gt; setbit sign 3 1(integer) 0127.0.0.1:6379&gt; setbit sign 4 1(integer) 0127.0.0.1:6379&gt; getbit sign 3 # æŸ¥çœ‹ç¬¬ä¸‰å¤©æ˜¯å¦æœ‰æ‰“å¡(integer) 1 1# bitop ï¼ˆ1ï¼‰æ ¼å¼ 1bitop and(or/not/xor) &lt;destkey&gt; [key....] bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œå®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„andï¼ˆäº¤é›†ï¼‰ã€orï¼ˆå¹¶é›†ï¼‰ã€notï¼ˆéžï¼‰ã€‚ xorï¼ˆå¼‚æˆ–ï¼‰æ“ä½œå¹¶å°†ç»“æžœä¿å­˜åœ¨destkeyä¸­ æ³¨ï¼š å¾ˆå¤šç”¨æˆ·çš„idä»¥ä¸€ä¸ªæŒ‡å®šçš„idå¼€å¤´ï¼Œç›´æŽ¥å°†ç”¨æˆ·çš„idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œé€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åšsetbitæ“ä½œæ—¶å°†ç”¨æˆ·idå‡åŽ»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚ åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œå‡å¦‚åç§»é‡éžå¸¸å¤§ï¼Œé‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œå¯èƒ½ä¼šé€ æˆRedisé˜»å¡žã€‚ åäºŒã€Rediså®žçŽ°ä¹è§‚é”ç›‘æŽ§ Watchï¼ˆé¢è¯•å¸¸é—®ï¼ï¼‰ æ‚²è§‚é”ï¼š å¾ˆæ‚²è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ï¼Œæ— è®ºåšä»€ä¹ˆéƒ½ä¼šåŠ é” ä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°è¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ã€è¡¨é”ç­‰ï¼Œè¯»é”ã€å†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé” å®žçŽ°æ–¹æ³•ï¼šåœ¨sqlåŽé¢åŠ ä¸Š for updateæˆ–è€…for update nowait ä¹è§‚é”ï¼š å¾ˆä¹è§‚ï¼Œè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¸ä¼šå‡ºçŽ°é—®é¢˜ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œæ›´æ–°æ•°æ®çš„æ—¶å€™åŽ»åˆ¤æ–­ä¸€ä¸‹ï¼Œåœ¨æ­¤æœŸé—´æ˜¯å¦æœ‰äººä¿®æ”¹è¿‡è¿™ä¸ªæ•°æ®ï¼Œ èŽ·å–version æ›´æ–°çš„æ—¶å€™æ¯”è¾ƒæ•°æ®åº“çš„version ä¹è§‚é”äºŽå¤šè¯»çš„åº”ç”¨ç±»åž‹ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ï¼ŒRediså°±æ˜¯åˆ©ç”¨è¿™ç§check-and-setæœºåˆ¶å®žçŽ°äº‹åŠ¡çš„ã€‚ 1Redisç›‘è§†æµ‹è¯• ä¸¤ç§ä¹‹é—´çš„å·®åˆ«å°±æ˜¯ï¼Œåœ¨å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‚²è§‚é”ä¼šé˜»å¡žï¼Œè€Œä¹è§‚é”ä¼šä¸æ‰§è¡Œ æ‰§è¡ŒæˆåŠŸï¼š 123456789101112131415127.0.0.1:6379&gt; set money 100OK127.0.0.1:6379&gt; set out 0OK127.0.0.1:6379&gt; watch money # ç›‘è§† money å¯¹è±¡OK127.0.0.1:6379&gt; multi # äº‹åŠ¡æ­£å¸¸ç»“æŸï¼Œæ•°æ®æœŸé—´æ²¡æœ‰å‘ç”Ÿå˜åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™å°±æ­£å¸¸æ‰§è¡ŒæˆåŠŸOK127.0.0.1:6379(TX)&gt; DECRBY money 20QUEUED127.0.0.1:6379(TX)&gt; INCRBY out 20QUEUED127.0.0.1:6379(TX)&gt; exec1) (integer) 802) (integer) 20 æ‰§è¡Œå¤±è´¥ï¼š å®¢æˆ·ç«¯1ï¼š 12345678910111213127.0.0.1:6379&gt; watch money # ç›‘è§†moneyOK127.0.0.1:6379&gt; multiOK127.0.0.1:6379(TX)&gt; DECRBY money 10QUEUED127.0.0.1:6379(TX)&gt; INCRBY out 10QUEUED127.0.0.1:6379(TX)&gt; exec # æ‰§è¡Œä¹‹å‰ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹ï¼Œä¿®æ”¹äº†æˆ‘ä»¬çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±ä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œå¤±è´¥(nil)127.0.0.1:6379&gt; get money&quot;1000&quot;127.0.0.1:6379&gt; å®¢æˆ·ç«¯2ï¼š 12345[fangyupeng@hadoop102 ~]$ redis-cli -p 6379127.0.0.1:6379&gt; get money&quot;80&quot;127.0.0.1:6379&gt; set money 1000OK åŽŸå› ï¼šwatchåˆ°è„æ•°æ®ï¼Œéœ€è¦unwatchåŽå†watch æ³¨æ„ï¼šå®žçŽ°ä¹è§‚é”å¼€å¯ç›‘è§†å¿…é¡»åœ¨å¼€å¯äº‹åŠ¡ä¹‹å‰ï¼ åä¸‰ã€RedisåŸºæœ¬äº‹åŠ¡æ“ä½œRedisäº‹åŠ¡æœ¬è´¨ï¼šä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œ ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æŽ’ä»–æ€§ï¼Œæ‰§è¡Œä¸€äº›åˆ—çš„å‘½ä»¤ Redisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨ä¸²è”å¤šä¸ªå‘½ä»¤ï¼Œé˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿ å•ç‹¬çš„éš”ç¦»æ“ä½œï¼Œäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šè¢«å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ Redisäº‹åŠ¡æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ æ‰€æœ‰çš„å‘½ä»¤åœ¨äº‹åŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æŽ¥è¢«æ‰§è¡Œï¼Œåªæœ‰å‘èµ·æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œï¼Œexec Rediså•æŒ‘å‘½ä»¤æ˜¯ä¿è¯åŽŸå­æ€§çš„ï¼Œä½†æ˜¯äº‹åŠ¡ä¸ä¿è¯åŽŸå­æ€§ redisäº‹åŠ¡ï¼š å¼€å¯äº‹åŠ¡ï¼ˆMultiï¼‰ å‘½ä»¤å…¥é˜Ÿï¼ˆâ€¦.ï¼‰ æ‰§è¡Œäº‹åŠ¡ï¼ˆexecï¼‰ 1æ­£å¸¸æ‰§è¡Œäº‹åŠ¡ 123456789101112131415127.0.0.1:6379&gt; multi # å¼€å¯äº‹åŠ¡OK127.0.0.1:6379(TX)&gt; set k1 v1QUEUED127.0.0.1:6379(TX)&gt; set k2 v2QUEUED127.0.0.1:6379(TX)&gt; get k2QUEUED127.0.0.1:6379(TX)&gt; set k3 v3QUEUED127.0.0.1:6379(TX)&gt; exec # æ‰§è¡Œäº‹åŠ¡1) OK2) OK3) &quot;v2&quot;4) OK 1æ”¾å¼ƒäº‹åŠ¡ 12345678910127.0.0.1:6379(TX)&gt; set k1 v1QUEUED127.0.0.1:6379(TX)&gt; set k2 v2QUEUED127.0.0.1:6379(TX)&gt; set k4 v4QUEUED127.0.0.1:6379(TX)&gt; DISCARDOK127.0.0.1:6379&gt; get k4(nil) 1ç¼–è¯‘åž‹å¼‚å¸¸ï¼ˆä»£ç æœ‰é—®é¢˜ï¼Œå‘½ä»¤æœ‰é”™ï¼‰ï¼Œäº‹åŠ¡ä¸­æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œ 123456789101112131415161718127.0.0.1:6379&gt; multiOK127.0.0.1:6379(TX)&gt; set k1 v1QUEUED127.0.0.1:6379(TX)&gt; set k2 v2QUEUED127.0.0.1:6379(TX)&gt; set k3 v3QUEUED127.0.0.1:6379(TX)&gt; getset k3 # é”™è¯¯çš„å‘½ä»¤(error) ERR wrong number of arguments for &#x27;getset&#x27; command127.0.0.1:6379(TX)&gt; set k4 v4QUEUED127.0.0.1:6379(TX)&gt; set k5 v5QUEUED127.0.0.1:6379(TX)&gt; exec # æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¸ä¼šæ‰§è¡Œ(error) EXECABORT Transaction discarded because of previous errors.127.0.0.1:6379&gt; get k5(nil) 1è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆ1/0ï¼‰ï¼Œå¦‚æžœäº‹åŠ¡é˜Ÿåˆ—ä¸­å­˜åœ¨è¯­æ³•æ€§ï¼Œé‚£ä¹ˆæ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ï¼Œå…¶ä»–å‘½ä»¤å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œé”™è¯¯å‘½ä»¤æŠ›å‡ºå¼‚å¸¸ 1234567891011121314151617181920212223127.0.0.1:6379&gt; set k1 &quot;v1&quot;OK127.0.0.1:6379&gt; multi # å¼€å¯äº‹åŠ¡OK127.0.0.1:6379(TX)&gt; incr k1 # å¤±è´¥QUEUED127.0.0.1:6379(TX)&gt; set k2 v2QUEUED127.0.0.1:6379(TX)&gt; set k3 v3QUEUED127.0.0.1:6379(TX)&gt; get k3QUEUED127.0.0.1:6379(TX)&gt; exec # äº‹åŠ¡å¯ä»¥æ‰§è¡Œ1) (error) ERR value is not an integer or out of range2) OK3) OK4) &quot;v3&quot;127.0.0.1:6379&gt; get k2&quot;v2&quot;127.0.0.1:6379&gt; get k3&quot;v3&quot;127.0.0.1:6379&gt; get k1&quot;v1&quot; å®žçŽ°ç§’æ€ ä½¿ç”¨ä¹è§‚é”ï¼ˆåº“å­˜é—ç•™é—®é¢˜ï¼‰ ä½¿ç”¨ luaï¼ˆè§£å†³åº“å­˜é—ç•™é—®é¢˜ï¼‰ åº“å­˜é—ç•™é—®é¢˜ï¼šç¬¬ä¸€ä¸ªç”¨æˆ·æˆåŠŸç§’æ€æ—¶ï¼Œå¹¶å‘æ—¶çš„å…¶ä»–ç”¨æˆ·éƒ½ç§’æ€å¤±è´¥ï¼Œå°±ç®—å­˜åœ¨åº“å­˜ï¼Œluaä½œä¸ºåµŒå…¥å¼è¯­è¨€ï¼Œå¯ä»¥ä½¿å¾—æ•´ä¸ªäº‹åŠ¡å…·æœ‰åŽŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œä¸å­˜åœ¨ç‰ˆæœ¬å·ä¸åŒé—®é¢˜ åå››ã€é€šè¿‡Jedisæ“ä½œRedisä¾èµ–ï¼š 12345678910111213141516171819&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;3.6.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.2.62&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt; &lt;version&gt;1.7.2&lt;/version&gt;&lt;/dependency&gt; testList 12345678910111213141516171819202122232425262728293031323334353637383940package com.zhkucst;import redis.clients.jedis.Jedis;public class TestList &#123; public static void main(String[] args) &#123; Jedis jedis = new Jedis(&quot;192.168.10.102&quot;,6379); jedis.flushDB(); System.out.println(&quot;======æ·»åŠ ä¸€ä¸ªList======&quot;); jedis.lpush(&quot;collections&quot;,&quot;ArrayList&quot;, &quot;Vector&quot;,&quot;Stack&quot;, &quot;HashMap&quot;,&quot;WeakHashMap&quot;,&quot;LinkedHashMap&quot;); jedis.lpush(&quot;collections&quot;,&quot;HashSet&quot;); jedis.lpush(&quot;collections&quot;,&quot;TreeSet&quot;); jedis.lpush(&quot;collections&quot;,&quot;TressMap&quot;); System.out.println(&quot;collectionçš„å†…å®¹ï¼š&quot; + jedis.lrange(&quot;collections&quot;,0, -1)); System.out.println(&quot;============================&quot;); System.out.println(&quot;åˆ é™¤æŒ‡å®šå…ƒç´ ä¸ªæ•°ï¼š&quot; + jedis.lrem(&quot;collections&quot;,2, &quot;HashMao&quot;)); System.out.println(&quot;åˆ é™¤ä¸‹è¡¨0-3åŒºé—´ä¹‹å¤–çš„å…ƒç´ ï¼š&quot; + jedis.ltrim(&quot;collections&quot;,0,3)); System.out.println(&quot;collectionsçš„å†…å®¹ï¼š&quot; + jedis.lrange(&quot;collections&quot;,0, -1)); System.out.println(&quot;collectionsåˆ—è¡¨å‡ºæ ˆï¼ˆå·¦ç«¯ï¼‰:&quot; + jedis.lpop(&quot;collections&quot;)); System.out.println(&quot;collectionsçš„å†…å®¹ï¼š&quot; + jedis.lrange(&quot;collections&quot;,0, -1)); System.out.println(&quot;collectionsåˆ—è¡¨å‡ºæ ˆï¼ˆå³ç«¯ ï¼‰ï¼š&quot; + jedis.rpop(&quot;collections&quot;)); System.out.println(&quot;collectionsçš„å†…å®¹ï¼š&quot; + jedis.lrange(&quot;collections&quot;,0, -1)); System.out.println(&quot;ä¿®æ”¹collectionsåˆ—è¡¨æŒ‡å®šä¸‹æ ‡1çš„å†…å®¹ï¼š&quot; + jedis.lset(&quot;collections&quot;,1,&quot;UpdateHashSet&quot;)); System.out.println(&quot;collectionsçš„å†…å®¹ï¼š&quot; + jedis.lrange(&quot;collections&quot;,0, -1)); System.out.println(&quot;============================&quot;); System.out.println(&quot;collectionsçš„é•¿åº¦ï¼š&quot; + jedis.llen(&quot;collections&quot;)); System.out.println(&quot;èŽ·å–collectionsä¸‹æ ‡ä¸º2çš„å…ƒç´ ï¼š&quot; + jedis.lindex(&quot;collections&quot;,2)); System.out.println(&quot;============================&quot;); jedis.lpush(&quot;sortedList&quot;, &quot;3&quot;,&quot;6&quot;,&quot;2&quot;,&quot;8&quot;,&quot;7&quot;,&quot;4&quot;); System.out.println(&quot;sortedListæŽ’åºå‰ï¼š&quot; + jedis.lrange(&quot;sortedList&quot;, 0, -1)); System.out.println(jedis.sort(&quot;sortedList&quot;)); System.out.println(&quot;sortedListæŽ’åºåŽï¼š&quot; + jedis.lrange(&quot;sortedList&quot;, 0, -1)); &#125;&#125; testSet 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.zhkucst;import redis.clients.jedis.Jedis;public class TestSet &#123; public static void main(String[] args) &#123; Jedis jedis = new Jedis(&quot;192.168.10.102&quot;, 6379); jedis.flushDB(); System.out.println(&quot;======å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼ˆä¸é‡å¤ï¼‰======&quot;); System.out.println(jedis.sadd(&quot;eleSet&quot;,&quot;e1&quot;,&quot;e2&quot;,&quot;e3&quot;,&quot;e4&quot;,&quot;e0&quot;,&quot;e8&quot;,&quot;e7&quot;,&quot;e5&quot;)); System.out.println(jedis.sadd(&quot;eleSet&quot;,&quot;e6&quot;)); System.out.println(jedis.sadd(&quot;eleSet&quot;,&quot;e6&quot;)); System.out.println(&quot;eleSetçš„æ‰€æœ‰å…ƒç´ ä¸ºï¼š&quot; + jedis.smembers(&quot;eleSet&quot;)); System.out.println(&quot;åˆ é™¤ä¸€ä¸ªå…ƒç´ e0ï¼š&quot; + jedis.srem(&quot;eleSet&quot;,&quot;e0&quot;)); System.out.println(&quot;eleSetçš„æ‰€æœ‰å…ƒç´ ä¸ºï¼š&quot; + jedis.smembers(&quot;eleSet&quot;)); System.out.println(&quot;åˆ é™¤ä¸¤ä¸ªå…ƒç´ e7,e6ï¼š&quot; + jedis.srem(&quot;eleSet&quot;,&quot;e7&quot;, &quot;e6&quot;)); System.out.println(&quot;eleSetçš„æ‰€æœ‰å…ƒç´ ä¸ºï¼š&quot; + jedis.smembers(&quot;eleSet&quot;)); System.out.println(&quot;éšæœºåœ°ç§»é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼š&quot; + jedis.spop(&quot;eleSet&quot;)); System.out.println(&quot;éšæœºåœ°ç§»é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼š&quot; + jedis.spop(&quot;eleSet&quot;)); System.out.println(&quot;eleSetçš„æ‰€æœ‰å…ƒç´ ä¸ºï¼š&quot; + jedis.smembers(&quot;eleSet&quot;)); System.out.println(&quot;eleSeté›†åˆä¸­åŒ…å«çš„å…ƒç´ ä¸ªæ•°ï¼š&quot; + jedis.scard(&quot;eleSet&quot;)); System.out.println(&quot;e3æ˜¯å¦åœ¨eleSeté›†åˆä¸­ï¼š&quot; + jedis.sismember(&quot;eleSet&quot;,&quot;e3&quot;)); System.out.println(&quot;e1æ˜¯å¦åœ¨eleSeté›†åˆä¸­ï¼š&quot; + jedis.sismember(&quot;eleSet&quot;,&quot;e1&quot;)); System.out.println(&quot;e5æ˜¯å¦åœ¨eleSeté›†åˆä¸­ï¼š&quot; + jedis.sismember(&quot;eleSet&quot;,&quot;e5&quot;)); System.out.println(&quot;============================&quot;); System.out.println(&quot;eleSet1:&quot; + jedis.sadd(&quot;eleSet1&quot;,&quot;e1&quot;,&quot;e2&quot;,&quot;e4&quot;,&quot;e3&quot;,&quot;e0&quot;,&quot;e8&quot;,&quot;e7&quot;,&quot;e5&quot;)); System.out.println(&quot;eleSet2:&quot; + jedis.sadd(&quot;eleSet2&quot;,&quot;e1&quot;,&quot;e2&quot;,&quot;e4&quot;,&quot;e3&quot;,&quot;e0&quot;,&quot;e8&quot;)); System.out.println(&quot;eleSet1çš„å…ƒç´ ï¼š&quot; + jedis.smembers(&quot;eleSet1&quot;)); System.out.println(&quot;eleSet2çš„å…ƒç´ ï¼š&quot; + jedis.smembers(&quot;eleSet2&quot;)); System.out.println(&quot;å°†eleSet1ä¸­åˆ é™¤e1å¹¶å­˜å…¥eleSet3ï¼š&quot; + jedis.smove(&quot;eleSet1&quot;,&quot;eleSet3&quot;,&quot;e1&quot;)); System.out.println(&quot;å°†eleSet1ä¸­åˆ é™¤e2å¹¶å­˜å…¥eleSet3ï¼š&quot; + jedis.smove(&quot;eleSet1&quot;,&quot;eleSet3&quot;,&quot;e2&quot;)); System.out.println(&quot;eleSet1çš„å…ƒç´ ï¼š&quot; + jedis.smembers(&quot;eleSet1&quot;)); System.out.println(&quot;eleSet3çš„å…ƒç´ ï¼š&quot; + jedis.smembers(&quot;eleSet3&quot;)); System.out.println(&quot;======é›†åˆè¿ç®—======&quot;); System.out.println(&quot;eleSet1çš„å…ƒç´ ï¼š&quot; + jedis.smembers(&quot;eleSet1&quot;)); System.out.println(&quot;eleSet2çš„å…ƒç´ ï¼š&quot; + jedis.smembers(&quot;eleSet2&quot;)); System.out.println(&quot;eleSet1ä¸ŽeleSet2çš„äº¤é›†ï¼š&quot; + jedis.sinter(&quot;eleSet1&quot;, &quot;eleSet2&quot;)); System.out.println(&quot;eleSet1ä¸ŽeleSet2çš„å¹¶é›†ï¼š&quot; + jedis.sunion(&quot;eleSet1&quot;,&quot;eleSet2&quot;)); System.out.println(&quot;eleSet1ä¸ŽeleSet2çš„å·®é›†ï¼š&quot; + jedis.sdiff(&quot;eleSet1&quot;,&quot;eleSet2&quot;)); &#125;&#125; testHash 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.zhkucst;import redis.clients.jedis.Jedis;import java.util.HashMap;import java.util.Map;public class TestHash &#123; public static void main(String[] args) &#123; Jedis jedis = new Jedis(&quot;192.168.10.102&quot;, 6379); jedis.flushDB(); Map&lt;String,String&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;,&quot;v1&quot;); map.put(&quot;k2&quot;,&quot;v2&quot;); map.put(&quot;k3&quot;,&quot;v3&quot;); map.put(&quot;k4&quot;,&quot;v4&quot;); jedis.hmset(&quot;hash&quot;,map); jedis.hset(&quot;hash&quot;,&quot;key5&quot;,&quot;value5&quot;); System.out.println(&quot;æ•£åˆ—hashçš„æ‰€æœ‰é”®å€¼å¯¹ä¸ºï¼š&quot; + jedis.hgetAll(&quot;hash&quot;)); System.out.println(&quot;æ•£åˆ—hashçš„æ‰€æœ‰é”®ï¼š&quot; + jedis.keys(&quot;hash&quot;)); System.out.println(&quot;æ•£åˆ—hashçš„æ‰€æœ‰å€¼ï¼š&quot; + jedis.hvals(&quot;hash&quot;)); System.out.println(&quot;å°†k6ä¿å­˜çš„å€¼åŠ ä¸Šä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æžœk6ä¸å­˜åœ¨åˆ™æ·»åŠ k6ï¼š&quot; + jedis.hincrBy(&quot;hash&quot;,&quot;key6&quot;,6)); System.out.println(&quot;æ•£åˆ—hashçš„æ‰€æœ‰é”®å€¼å¯¹ä¸ºï¼š&quot; + jedis.hgetAll(&quot;hash&quot;)); System.out.println(&quot;å°†k6ä¿å­˜çš„å€¼åŠ ä¸Šä¸€ä¸ªæ•´æ•°ï¼Œå¦‚æžœk6ä¸å­˜åœ¨åˆ™æ·»åŠ k6ï¼š&quot; + jedis.hincrBy(&quot;hash&quot;,&quot;key6&quot;,3)); System.out.println(&quot;æ•£åˆ—hashçš„æ‰€æœ‰é”®å€¼å¯¹ä¸ºï¼š&quot; + jedis.hgetAll(&quot;hash&quot;)); System.out.println(&quot;åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé”®å€¼å¯¹ï¼š&quot; + jedis.hdel(&quot;hash&quot;,&quot;k2&quot;)); System.out.println(&quot;æ•£åˆ—hashçš„æ‰€æœ‰é”®å€¼å¯¹ä¸ºï¼š&quot; + jedis.hgetAll(&quot;hash&quot;)); System.out.println(&quot;æ•£åˆ—è¡¨hashä¸­é”®å€¼å¯¹ä¸ªæ•°ï¼š&quot; + jedis.hlen(&quot;hash&quot;)); System.out.println(&quot;åˆ¤æ–­hashä¸­æ˜¯å¦å­˜åœ¨k2ï¼š&quot; + jedis.hexists(&quot;hash&quot;,&quot;k2&quot;)); System.out.println(&quot;åˆ¤æ–­hashä¸­æ˜¯å¦å­˜åœ¨k3ï¼š&quot; + jedis.hexists(&quot;hash&quot;,&quot;k3&quot;)); System.out.println(&quot;èŽ·å–hashä¸­k3çš„å€¼ï¼š&quot; + jedis.hmget(&quot;hash&quot;,&quot;k2&quot;)); System.out.println(&quot;èŽ·å–hashä¸­k2ã€k3çš„å€¼ï¼š&quot; + jedis.hmget(&quot;hash&quot;,&quot;k2&quot;,&quot;k3&quot;)); &#125;&#125; åäº”ã€é€šè¿‡Jedisæ“ä½œäº‹åŠ¡TestTX.jar 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.zhkucst;import com.alibaba.fastjson.JSONObject;import redis.clients.jedis.Jedis;import redis.clients.jedis.Transaction;public class TextTX &#123; public static void main(String[] args) &#123; Jedis jedis = new Jedis(&quot;192.168.10.102&quot;,6379); JSONObject jsonObject = new JSONObject(); jsonObject.put(&quot;hello&quot;,&quot;world&quot;); jsonObject.put(&quot;name&quot;,&quot;zhangsan&quot;); jedis.flushDB(); System.out.println(&quot;å¼€å¯äº‹åŠ¡...&quot;); Transaction multi = jedis.multi(); //jedis.watch();//å¼€å¯ç›‘è§† // ..... //jedis.unwatch();å…³é—­ç›‘è§† try &#123; String result = jsonObject.toJSONString(); multi.set(&quot;user1&quot;,result); multi.set(&quot;user2&quot;,result); int i = 1/0; multi.exec(); &#125; catch (Exception exception) &#123; multi.discard(); exception.printStackTrace();//æ”¾å¼ƒäº‹åŠ¡ &#125; finally &#123; System.out.println(jedis.get(&quot;user1&quot;)); System.out.println(jedis.get(&quot;user2&quot;)); jedis.close();//å…³é—­è¿žæŽ¥ &#125; &#125;&#125; åå…­ã€è‡ªå®šä¹‰RedisTemplateé€šè¿‡è‡ªåŠ¨é…ç½®ç±»æºç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576/* * Copyright 2012-2020 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * https://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.springframework.boot.autoconfigure.data.redis;import org.springframework.boot.autoconfigure.EnableAutoConfiguration;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.autoconfigure.condition.ConditionalOnSingleCandidate;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.Import;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisOperations;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.core.StringRedisTemplate;/** * &#123;@link EnableAutoConfiguration Auto-configuration&#125; for Spring Data&#x27;s Redis support. * * @author Dave Syer * @author Andy Wilkinson * @author Christian Dupuis * @author Christoph Strobl * @author Phillip Webb * @author EddÃº MelÃ©ndez * @author Stephane Nicoll * @author Marco Aust * @author Mark Paluch * @since 1.0.0 */@Configuration(proxyBeanMethods = false)@ConditionalOnClass(RedisOperations.class)@EnableConfigurationProperties(RedisProperties.class)@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)public class RedisAutoConfiguration &#123; @Bean @ConditionalOnMissingBean(name = &quot;redisTemplate&quot;) @ConditionalOnSingleCandidate(RedisConnectionFactory.class) public RedisTemplate&lt;Object, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123; RedisTemplate&lt;Object, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); return template; &#125; @Bean @ConditionalOnMissingBean @ConditionalOnSingleCandidate(RedisConnectionFactory.class) public StringRedisTemplate stringRedisTemplate(RedisConnectionFactory redisConnectionFactory) &#123; StringRedisTemplate template = new StringRedisTemplate(); template.setConnectionFactory(redisConnectionFactory); return template; &#125;&#125; å¯çŸ¥ï¼ŒRediså¯ä»¥è‡ªå®šä¹‰é…ç½®ç±»ï¼Œæ¥å®žçŽ°åºåˆ—åŒ– é€šè¿‡æŽ¥å£ public interface RedisSerializer çš„å®žçŽ°ç±»åˆ†æžï¼Œæœ‰å‡ ç§åºåˆ—åŒ–æ–¹å¼ pojoç±»å®žçŽ°æŽ¥å£Serializableä»¥å®žçŽ°èƒ½å¤Ÿåºåˆ—åŒ–å¯¹è±¡ è‡ªå®šä¹‰RedisTemplate 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.zhkucst.conf;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;@Configurationpublic class RedisConfig &#123; @Bean //æŠ‘åˆ¶æ‰€æœ‰è­¦å‘Š @SuppressWarnings(&quot;all&quot;) public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) &#123; //ä¸€èˆ¬ä½¿ç”¨&lt;String, Object&gt; RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); //jsonåºåˆ—åŒ–è®¾ç½® Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(om); //Stringåºåˆ—åŒ– StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); //keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setKeySerializer(stringRedisSerializer); //hashçš„keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setHashKeySerializer(stringRedisSerializer); //valueé‡‡ç”¨jsonçš„åºåˆ—åŒ–æ–¹å¼ template.setValueSerializer(jackson2JsonRedisSerializer); //hashçš„valueé‡‡ç”¨jsonåºåˆ—åŒ–æ–¹å¼ template.setHashValueSerializer(jackson2JsonRedisSerializer); //å…¶ä»–æœªè‡ªå®šä¹‰çš„å±žæ€§é€šè¿‡è¯¥æ–¹æ³•é…ç½®é»˜è®¤çš„PropertiesSet template.afterPropertiesSet(); return template; &#125;&#125; æµ‹è¯• 1234567891011121314 @Test public void test() throws JsonProcessingException &#123; User user = new User(&quot;å¼ ä¸‰&quot;,23); //String jsonUser = new ObjectMapper().writeValueAsString(user); redisTemplate.opsForValue().set(&quot;user&quot;, user); System.out.println(redisTemplate.opsForValue().get(&quot;user&quot;)); &#125;&#125; åä¸ƒã€Redisé…ç½®æ–‡ä»¶è¯¦è§£å•ä½ 1.é…ç½®æ–‡ä»¶unitå•ä½å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œåªæ”¯æŒbyteï¼Œä¸æ”¯æŒbit åŒ…å« å¥½æ¯”æˆ‘ä»¬å­¦ä¹ Springã€Importã€include ç½‘ç»œ123bind 127.0.0.1 # ç»‘å®šçš„idprotected-mode yes # ä¿æŠ¤æ¨¡å¼port 6379 # ç«¯å£è®¾ç½® é€šç”¨GENERAL 12345678910111213daemonize yes # ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿›è¡Œï¼Œé»˜è®¤æ˜¯no,æˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å¯ä¸ºyespidfile /var/run/redis_6379.pid #å¦‚æžœä»¥åŽå°çš„æ–¹å¼è¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸€ä¸ªpidæ–‡ä»¶# æ—¥å¿—# Specify the server verbosity level.# This can be one of:# debug (a lot of information, useful for development/testing)# verbose (many rarely useful info, but not a mess like the debug level)# notice (moderately verbose, what you want in production probably) ç”Ÿäº§æ¨¡å¼# warning (only very important / critical messages are logged)loglevel notice # æ—¥å¿—æ–‡ä»¶çš„é€šçŸ¥ç­‰çº§logfile &quot;/usr/local/bin/klog&quot; # æ—¥å¿—çš„æ–‡ä»¶ä½ç½®ådatabases 16 # æ•°æ®åº“çš„æ•°é‡ï¼Œ é»˜è®¤æ˜¯16ä¸ªæ•°æ®åº“always-show-logo no # æ˜¯å¦æ€»æ˜¾ç¤ºlogo å¿«ç…§æŒä¹…åŒ–ï¼Œåœ¨è§„å®šæ—¶é—´å†…ï¼Œæ‰§è¡Œäº†å¤šå°‘æ¬¡æ“ä½œï¼Œåˆ™ä¼šæŒä¹…åŒ–åˆ°æ–‡ä»¶ï¼Œrdb.aof redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¦‚æžœæ²¡æœ‰æŒä¹…åŒ–ï¼Œé‚£ä¹ˆæ•°æ®æ•°æ®æ–­ç”µåŠå¤± 1234567891011# å¦‚æžœ900så†…ï¼Œå¦‚æžœè‡³å°‘æœ‰1 keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œsave 900 1# å¦‚æžœ300så†…ï¼Œå¦‚æžœè‡³å°‘æœ‰10 keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œsave 300 10# å¦‚æžœ60så†…ï¼Œå¦‚æžœè‡³å°‘æœ‰10000 keyè¿›è¡Œäº†ä¿®æ”¹ï¼Œæˆ‘ä»¬åŠè¿›è¡ŒæŒä¹…åŒ–æ“ä½œsave 60 10000stop-writes-on-bgsave-error yes # æŒä¹…åŒ–å¦‚æžœå‡ºé”™ï¼Œæ˜¯å¦éœ€è¦ç»§ç»­å·¥ä½œrdbcompression yes # æ˜¯å¦åŽ‹ç¼©rdbæ–‡ä»¶ï¼Œéœ€è¦æ¶ˆè€—ä¸€äº›cpurdbchecksum yes # ä¿å­˜rdbæ–‡ä»¶çš„æ—¶å€™ï¼Œè¿›è¡Œé”™è¯¯çš„æ£€æŸ¥æ ¡éªŒ#dir ./ # rdb æ–‡ä»¶ä¿å­˜çš„ç›®å½•ï¼Œé»˜è®¤ä¸ºå¯åŠ¨æœåŠ¡æ—¶çš„å½“å‰è·¯å¾„ï¼Œæœ€å¥½æ”¹æˆç»å¯¹è·¯å¾„ dir /usr/local/bin/krdb REPLICATIONå¤åˆ¶ï¼Œä¸»ä»Žå¤åˆ¶è¯¦è§åä¹ç¯‡ï¼šRedisä¸»ä»Žå¤åˆ¶ SECURITY å®‰å…¨å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®redisçš„å¯†ç ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯†ç  1234567891011# root127.0.0.1:6379&gt; pingPONG127.0.0.1:6379&gt; config get requirepass # èŽ·å–redisçš„å¯†ç 1) &quot;requirepass&quot;2) &quot;&quot;127.0.0.1:6379&gt; config set requirepass &quot;123456&quot; # è®¾ç½®redisçš„å¯†ç OK127.0.0.1:6379&gt; config get requirepass1) &quot;requirepass&quot;2) &quot;123456&quot; 12345678910# localhost127.0.0.1:6379&gt; config get requirepass(error) NOAUTH Authentication required.127.0.0.1:6379&gt; ping(error) NOAUTH Authentication required.127.0.0.1:6379&gt; auth 123456 # ä½¿ç”¨å¯†ç è¿›è¡Œç™»å½•OK127.0.0.1:6379&gt; config get requirepass1) &quot;requirepass&quot;2) &quot;123456&quot; é™åˆ¶CLIENTS1maxclients 10000MEMORY MANAGEMENT å†…å­˜å¤„ç†ç­–ç•¥ 12345678910111213141516171819202122maxmemory &lt;bytes&gt; # redisé…ç½®æœ€å¤§å†…å­˜å®¹é‡maxmemory-policy noeviction # å†…å­˜åˆ°è¾¾ä¸Šé™åŽçš„å¤„ç†ç­–ç•¥1ã€volatile-lru -&gt; Evict using approximated LRU(Least Recently Used), only keys with an expire set. # åªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key è¿›è¡ŒLRUï¼ˆé»˜è®¤å€¼ï¼‰2ã€allkeys-lru -&gt; Evict any key using approximated LRU. # åˆ é™¤LRUç®—æ³•çš„key3ã€volatile-lfu -&gt; Evict using approximated LFU(Least Frequently Used), only keys with an expire set. # åªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key è¿›è¡ŒLFU4ã€allkeys-lfu -&gt; Evict any key using approximated LFU. # åˆ é™¤LFUç®—æ³•çš„key5ã€volatile-random -&gt; Remove a random key having an expire set. # éšæœºåˆ é™¤å³å°†è¿‡æœŸçš„key6ã€allkeys-random -&gt; Remove a random key, any key. # éšæœºåˆ é™¤7ã€volatile-ttl -&gt; Remove the key with the nearest expire time (minor TTL) # åˆ é™¤å³å°†è¿‡æœŸçš„8ã€noeviction -&gt; Don&#x27;t evict anything, just return an error on write operations. # æ°¸ä¸è¿‡æœŸï¼Œè¿”å›žé”™è¯¯# LRU means Least Recently Used# LFU means Least Frequently Used APPEND ONLY MODE aofæ¨¡å¼1234567appendonly no # é»˜è®¤æ˜¯ä¸å¼€å¯aofæ¨¡å¼ï¼Œé»˜è®¤æ˜¯æ˜¯rdbæ–¹å¼æŒä¹…åŒ–ï¼Œåœ¨å¤§éƒ¨åˆ†æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œrdbå¤Ÿç”¨appendfilename &quot;appendonly.aof&quot; # æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­—# appendfsync always # æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šsync,æ¶ˆè€—æ€§èƒ½appendfsync everysec # æ¯ç§’æ‰§è¡Œ syncï¼Œ å¯èƒ½ä¼šä¸¢å¤±1sçš„æ•°æ®# appendfsync no # ä¸æ‰§è¡Œ syncï¼Œ è¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æ›´å¿« åå…«ã€æŒä¹…åŒ–-RDBæ“ä½œä»€ä¹ˆæ˜¯RDBï¼Ÿ æŸ¥æ‰¾æ–‡ä»¶åï¼šroot@hadoop102 bin# find / -name dump.rdb æŸ¥æ‰¾é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œå‘½ä»¤ï¼šconfig get dir save å’Œ bgsave saveï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶ä»–ä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡žï¼Œæ‰‹åŠ¨ä¿å­˜ï¼Œä¸å»ºè®® bgsaveï¼šRedisä¼šåœ¨åŽå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œå¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ ç”ŸæˆRDBçš„æ–¹å¼ï¼š æ»¡è¶³saveè§„åˆ™ï¼Œä¼šè‡ªåŠ¨è§¦å‘rdbè§„åˆ™ FLUSHALLå‘½ä»¤ï¼Œè§¦å‘rdbè§„åˆ™ shutdownï¼Œé€€å‡ºredisï¼Œäº§ç”Ÿrdbæ–‡ä»¶ æ¢å¤RDBæ–‡ä»¶ æ­¥éª¤ åªéœ€å°†rdbæ–‡ä»¶æ”¾åœ¨rediså¯åŠ¨ç›®å½•ï¼Œå³é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„dirè·¯å¾„ï¼š 123127.0.0.1:6379&gt; config get dir1) &quot;dir&quot;2) &quot;/usr/local/bin&quot; # å¦‚æžœåœ¨è¯¥ç›®å½•ä¸‹å­˜åœ¨dump.rdbï¼Œå¯åŠ¨redisä¼šè‡ªåŠ¨æ¢å¤å…¶ä¸­çš„æ•°æ®ï¼Œæ”¾åˆ°å†…å­˜ä¸­ rediså¯åŠ¨åŽä¼šè‡ªåŠ¨æ£€æŸ¥demp.rdbæ¢å¤å…¶ä¸­çš„æ•°æ® ä¼˜ç‚¹ é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ å¯¹æ•°æ®çš„å®Œæ•´æ€§è¦æ±‚ä¸é«˜ èŠ‚çœç£ç›˜ç©ºé—´ æ¢å¤é€Ÿåº¦å¿« ç¼ºç‚¹ éœ€è¦ä¸€å®šçš„æ—¶é—´é—´éš”è¿›ç¨‹æ“ä½œï¼Œå¦‚æžœredisæ„å¤–æ­»æœºäº†ï¼Œè¿™ä¸ªæœ€åŽä¸€æ¬¡ä¿®æ”¹çš„æ•°æ®å°±æ²¡æœ‰äº†ã€‚ï¼ˆå› ä¸ºrdbæŒä¹…åŒ–æ“ä½œæ˜¯å…ˆä¿å­˜åœ¨äº†ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯å®•æœºé‚£ä¸´æ—¶æ–‡ä»¶ä¹Ÿå°±ä¸èƒ½æ›¿æ¢åŽŸæ¥çš„rdbæ–‡ä»¶ï¼Œå¯¼è‡´æœ€åŽä¸€æ¬¡æŒä¹…åŒ–æ“ä½œæ•°æ®ä¸¢å¤±ï¼‰ forkè¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šå ç”¨ä¸€å®šçš„å†…å®¹ç©ºé—´ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘ è™½ç„¶Redisåœ¨forkæ—¶ä½¿ç”¨äº†å†™æ—¶æ‹·è´æŠ€æœ¯ï¼Œä½†æ˜¯å¦‚æžœæ•°æ®åºžå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ å…¶ä»–é…ç½® stop-writes-on-bgsave-error å½“Redisæ— æ³•å†™å…¥ç£ç›˜çš„è¯ï¼Œç›´æŽ¥å…³æŽ‰Redisçš„å†™æ“ä½œï¼ŒæŽ¨èyes rdbcompressionåŽ‹ç¼©æ–‡ä»¶ å¯¹äºŽå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡ŒåŽ‹ç¼©å­˜å‚¨ï¼Œå¦‚æžœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨LZFç®—æ³•è¿›è¡ŒåŽ‹ç¼©ï¼Œé»˜è®¤æ˜¯yes rdbchecksumæ£€æŸ¥å®Œæ•´æ€§ åœ¨å­˜å‚¨å¿«ç…§åŽï¼Œè¿˜å¯ä»¥è®©redisä½¿ç”¨CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒ åä¹ã€æŒä¹…åŒ–-AOFæ“ä½œä»€ä¹ˆæ˜¯AOF?ï¼ˆAppend Only Fileï¼‰ aofä¿å­˜çš„æ˜¯ appendonly.aofæ–‡ä»¶ é»˜è®¤æ˜¯ä¸å¼€å¯çš„ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œæˆ‘ä»¬åªéœ€å°† appendonly æ”¹ä¸º yes å°±å¼€å¯äº† aof å¦‚æžœè¿™ä¸ªaofæ–‡ä»¶æœ‰é”™è¯¯ï¼Œè¿™æ—¶å€™redisæ˜¯å¯åŠ¨ä¸èµ·æ¥çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¿®å¤è¿™ä¸ªaofæ–‡ä»¶ redisç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå·¥å…· redis-check-aof 1234567appendonly no # é»˜è®¤æ˜¯ä¸å¼€å¯aofæ¨¡å¼ï¼Œé»˜è®¤ä½¿ç”¨rdbæ–¹å¼æŒä¹…åŒ–ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæœ‰rdbå°±å¤Ÿäº†appendfilename &quot;appendonly.aof&quot; # æŒä¹…åŒ–çš„æ–‡ä»¶åappendfsync always # æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šsync ,æ¶ˆè€—æ€§èƒ½appendfsync everysec # æ¯ç§’æ‰§è¡Œä¸€æ¬¡ syncï¼Œå¯èƒ½ä¼šä¸¢å¤±1sçš„æ•°æ®appendfsync no # ä¸æ‰§è¡Œsyncï¼Œè¿™ä¸ªæ—¶å€™æ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æ›´å¿« AOFå’ŒRDBåŒæ—¶å¼€å¯ï¼Œç³»ç»Ÿé»˜è®¤å–AOFçš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå­˜åœ¨ä¸¢å¤±ï¼‰ AOFå’ŒRDBæ‰€åœ¨çš„ç›®å½•åœ¨åŒä¸€ä¸ªä½ç½® å¼€å¯AOFè¿›è¡Œå¤‡ä»½æ—¶è¦å…ˆå…³é—­redisæˆ–å¼€å¯åŽé‡å¯redisï¼Œé…ç½®æ‰ä¼šç”Ÿæ•ˆ é‡å¯redisä¾¿ä¼šåŠ è½½aofæ–‡ä»¶è¿›è¡Œæ¢å¤ï¼Œæ–‡ä»¶æŸåä¼šå¯åŠ¨å¤±è´¥ ä¿®å¤AOFæ–‡ä»¶1redis-check-aof --fix krdb/appendonly.aof é‡å†™è§„åˆ™è¯´æ˜Žaofé»˜è®¤å°±æ˜¯æ–‡ä»¶çš„æ— é™è¿½åŠ ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ 12345no-appendfsync-on-rewrite noauto-aof-rewrite-percentage 100auto-aof-rewrite-min-size 64mb # å¦‚æžœaofæ–‡ä»¶å¤§äºŽ64mï¼Œå¤ªå¤§äº†ï¼Œforkä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥å°†æˆ‘ä»¬çš„æ–‡ä»¶è¿›è¡Œé‡å†™ ä¼˜ç‚¹å’Œç¼ºç‚¹ ä¼˜ç‚¹ æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½åŒæ­¥ï¼Œæ–‡ä»¶çš„å®Œæ•´æ€§ä¼šæ›´åŠ å¥½ æ¯ç§’åŒæ­¥ä¸€æ¬¡ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ® ä»Žä¸åŒæ­¥ï¼Œæ•ˆçŽ‡æœ€é«˜ ç¼ºç‚¹ ç›¸å¯¹äºŽæ•°æ®æ–‡ä»¶æ¥è¯´ï¼Œaofè¿œè¿œå¤§äºŽrdb,æ¢å¤çš„é€Ÿåº¦æ¯”rdbæ…¢ aofè¿è¡Œæ•ˆçŽ‡è¦æ¯”rdbæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬redisé»˜è®¤çš„é…ç½®å°±æ˜¯rdbæŒä¹…åŒ– äºŒåã€Redisä¸»ä»Žå¤åˆ¶æ¦‚å¿µä¸»ä»Žå¤åˆ¶ï¼Œæ˜¯æŒ‡å°†ä¸€å°redisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–RedisæœåŠ¡å™¨ï¼Œå‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹ï¼ˆmaster/leaderï¼‰,åŽè€…ç§°ä¸ºä»ŽèŠ‚ç‚¹ï¼ˆslaver/followerï¼‰ï¼Œæ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ä»Žä¸»èŠ‚ç‚¹åˆ°ä»ŽèŠ‚ç‚¹ï¼ŒMasterä»¥å†™ä¸ºä¸»ï¼ŒSlaverä»¥è¯»ä¸ºä¸»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å¥—RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¸”ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»ŽèŠ‚ç‚¹ï¼ˆæˆ–æ²¡æœ‰ä»ŽèŠ‚ç‚¹ï¼‰ï¼Œä½†ä¸€ä¸ªä»ŽèŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚ ä¸‰ç§å®žçŽ°æ–¹å¼ï¼š ä¸€ä¸»äºŒä»† è–ªç«ç›¸ä¼  åå®¢ä¸ºä¸» ä¸»ä»Žå¤åˆ¶çš„ä½œç”¨ä¸»è¦åŒ…æ‹¬ï¼š æ•°æ®å†—ä½™ï¼šä¸»ä»Žå¤åˆ¶å®žçŽ°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ï¼› æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºçŽ°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»ŽèŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®žçŽ°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›å®žé™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ï¼› è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»Žå¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œä»ŽèŠ‚ç‚¹æä¾›åº¦æœåŠ¡ï¼ˆå³å†™Redisæ•°æ®æ˜¯åº”ç”¨è¿žæŽ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»Redisæ•°æ®æ˜¯åº”ç”¨è¿žæŽ¥ä»ŽèŠ‚ç‚¹ï¼‰ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼›å°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»ŽèŠ‚ç‚¹åˆ†æ‹…è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜RedisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚ é«˜å¯ç”¨åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»Žå¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®žæ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»Žå¤åˆ¶æ˜¯Redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè¦å°†Redisè¿ç”¨äºŽå·¥ç¨‹é¡¹ç›®ä¸­ï¼Œåªä½¿ç”¨ä¸€å°Redisæ˜¯ä¸‡ä¸‡ä¸èƒ½çš„ï¼ŒåŽŸå› å¦‚ä¸‹ï¼š ä»Žç»“æž„ä¸Šï¼Œå•ä¸ªRedisæœåŠ¡å™¨ä¼šå‘ç”Ÿå•ç‚¹æ•…éšœï¼Œå¹¶ä¸”ä¸€å°æœåŠ¡å™¨éœ€è¦å¤„ç†æ‰€æœ‰çš„è¯·æ±‚è´Ÿè½½ï¼ŒåŽ‹åŠ›è¾ƒå¤§ï¼› ä»Žå®¹é‡ä¸Šï¼Œå•ä¸ªRedisæœåŠ¡å™¨å†…å­˜å®¹é‡æœ‰é™ï¼Œå°±ç®—ä¸€å°RedisæœåŠ¡å™¨å†…å­˜å®¹é‡ä¸º256G,ä¹Ÿä¸èƒ½å°†æ‰€æœ‰å†…å­˜ç”¨ä½œRediså­˜å‚¨å†…å­˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå•å°Redisæœ€å¤§ä½¿ç”¨å†…å­˜ä¸åº”è¯¥è¶…è¿‡20Gã€‚ ç”µå•†ç½‘ç«™ä¸Šçš„å•†å“ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€æ¬¡ä¸Šä¼ ï¼Œæ— æ•°æ¬¡æµè§ˆçš„ï¼Œè¯´ä¸“ä¸šç‚¹å°±ç®—â€œå¤šè¯»å°‘å†™â€ å¯¹äºŽè¿™ç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¿™ç§ç»“æž„ ä¸»ä»Žå¤åˆ¶ã€è¯»å†™åˆ†ç¦»ï¼ æŸ¥çœ‹ä¸»ä»Žå¤åˆ¶ä¸­ä¸»æœºçš„è§’è‰²1info replication è®¤å®šä¸»æœº æ˜¯éœ€è¦åœ¨éœ€è¦ä½œä¸ºä»Žæœºä¸Šå‘½ä»¤ï¼š 1127.0.0.1:6381&gt; SLAVEOF 127.0.0.1 6379 # è¿™ç§æ–¹å¼æ˜¯æš‚æ—¶æ€§çš„ æ°¸ä¹…é…ç½®åœ¨ä»Žæœºé…ç½®æ–‡ä»¶redis.confä¸­é…ç½®ï¼š 1replicaof 127.0.0.1 6379 # é…ç½®è®¤å®šä¸»æœºip åœ°å€å’Œ portç«¯å£å· å¤åˆ¶åŽŸç†Slaverå¯åŠ¨æˆåŠŸè¿žæŽ¥åˆ°masteråŽä¼šå‘é€ä¸€ä¸ªsyncåŒæ­¥å‘½ä»¤ masterè¡—é“å‘½ä»¤ï¼Œå¯åŠ¨åŽå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ‰‹æœºæ‰€æœ‰æŽ¥æ”¶åˆ°çš„ç”¨äºŽä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åŽå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åŽï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚ å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æŽ¥æ”¶åˆ°æ•°æ®åº“æ•°æ®æ–‡ä»¶åŽï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åœ¨å†…å­˜ä¸­ã€‚ å¢žé‡å¤åˆ¶ï¼šmasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slaveï¼Œå®Œæˆ1åŒæ­¥ ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿žæŽ¥masterï¼Œä¸€æ¬¡å®ŒæˆåŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰å°†è‡ªåŠ¨æ‰§è¡Œï¼Œæˆ‘ä»¬çš„æ•°æ®å¯ä»¥åœ¨ä»Žæœºä¸­çœ‹åˆ° äºŒåä¸€ã€Rediså‘å¸ƒè®¢é˜…Redsiå‘å¸ƒè®¢é˜…ï¼ˆpub/subï¼‰æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼Œå‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsubï¼‰æŽ¥æ”¶ä¿¡æ¯ï¼Œå¾®ä¿¡ã€å¾®åšã€å…³æ³¨ç³»ç»Ÿ Rediså®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ ç¬¬ä¸€ä¸ªï¼šæ¶ˆæ¯å‘é€è€…ï¼Œç¬¬äºŒä¸ªï¼šé¢‘é“ï¼Œç¬¬ä¸‰ä¸ªï¼šæ¶ˆæ¯è®¢é˜…è€… ä¸‹å›¾å±•ç¤ºäº†é¢‘é“channel1ï¼Œä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯â€“client2ã€client5ã€client1ä¹‹é—´çš„å…³ç³» å½“æœ‰æ–°æ¶ˆæ¯é€šè¿‡PUBLISHå‘½ä»¤å‘é€ç»™é¢‘é“channel1æ—¶ï¼Œè¿™ä¸ªæ¶ˆæ¯å°±ä¼šè¢«å‘é€ç»™è®¢é˜…å®ƒçš„ä¸‰ä¸ªå®¢æˆ·ç«¯ å‘½ä»¤è¿™äº›å‘½ä»¤å¹¿æ³›ç”¨äºŽæž„å»ºå³æ—¶é€šè®¯åº”ç”¨ï¼Œæ¯”å¦‚ç½‘ç»œèŠå¤©å®¤ï¼ˆchatroomï¼‰å’Œå®žæ—¶å¹¿æ’­ã€å®žæ—¶æé†’ç­‰ åºå· å‘½ä»¤åŠæè¿° 1 [PSUBSCRIBE pattern pattern â€¦] è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚ 2 [PUBSUB subcommand argument [argument â€¦]] æŸ¥çœ‹è®¢é˜…ä¸Žå‘å¸ƒç³»ç»ŸçŠ¶æ€ã€‚ 3 PUBLISH channel message å°†ä¿¡æ¯å‘é€åˆ°æŒ‡å®šçš„é¢‘é“ã€‚ 4 [PUNSUBSCRIBE pattern [pattern â€¦]] é€€è®¢æ‰€æœ‰ç»™å®šæ¨¡å¼çš„é¢‘é“ã€‚ 5 [SUBSCRIBE channel channel â€¦] è®¢é˜…ç»™å®šçš„ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“çš„ä¿¡æ¯ã€‚ 6 [UNSUBSCRIBE channel [channel â€¦]] æŒ‡é€€è®¢ç»™å®šçš„é¢‘é“ã€‚ æµ‹è¯•å‘é€ç«¯ï¼š 1234127.0.0.1:6379&gt; PUBLISH kuangshenshuo &quot;hello,kuangshen&quot; # å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°é¢‘é“(integer) 1127.0.0.1:6379&gt; PUBLISH kuangshenshuo &quot;hello,redis&quot; # å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°é¢‘é“(integer) 1 è®¢é˜…ç«¯ï¼š 123456789101112127.0.0.1:6379&gt; SUBSCRIBE kuangshenshuo # è®¢é˜…ä¸€ä¸ªé¢‘é“ kuangshenshuoReading messages... (press Ctrl-C to quit)1) &quot;subscribe&quot;2) &quot;kuangshenshuo&quot;3) (integer) 1# ç­‰å¾…è¯»å–æŽ¨é€çš„æ¶ˆæ¯1) &quot;message&quot; # æ¶ˆæ¯2) &quot;kuangshenshuo&quot; # å“ªä¸ªé¢‘é“çš„æ¶ˆæ¯3) &quot;hello,kuangshen&quot; # æ¶ˆæ¯çš„å…·ä½“å†…å®¹1) &quot;message&quot;2) &quot;kuangshenshuo&quot;3) &quot;hello,redis&quot; åŽŸç†Redisæ˜¯å®žéªŒCå®žçŽ°çš„ï¼Œé€šè¿‡åˆ†æžRedisæºç é‡Œçš„pubsub.cæ–‡ä»¶ï¼Œäº†è§£äº†å‘å¸ƒå’Œè®¢é˜…æœºåˆ¶çš„åº•å±‚å®žçŽ°ï¼Œå€Ÿæ­¤åŠ æ·±å¯¹Redisçš„ç†è§£ã€‚ Redisé€šè¿‡PUBLISHã€SUBSCRIBEå’ŒPSUBSCRIBEå®žçŽ°å‘å¸ƒå’Œè®¢é˜…åŠŸèƒ½ã€‚ å¾®ä¿¡ï¼š é€šè¿‡SUBSCRIBEå‘½ä»¤è®¢é˜…æŸé¢‘é“åŽï¼Œredis-serveré‡Œç»´æŠ¤äº†ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„é”®å°±æ˜¯ä¸€ä¸ªä¸ªé¢‘é“ï¼Œè€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰è®¢é˜…è¿™ä¸ªchannelçš„å®¢æˆ·ç«¯ã€‚SUBSCRIBEå‘½ä»¤çš„å…³é”®ï¼Œå°±æ˜¯å°†å®¢æˆ·ç«¯æ·»åŠ åˆ°ç»™å®šchannelçš„è®¢é˜…é“¾è¡¨ä¸­ã€‚ é€šè¿‡PUBLISHå‘½ä»¤å‘è®¢é˜…è€…å‘é€æ¶ˆæ¯ï¼Œredis-serverä¼šä½¿ç”¨ç»™å®šçš„é¢‘é“ä½œä¸ºé”®ï¼Œåœ¨å¥¹æ‰€ç»´æŠ¤çš„channelå­—å…¸ä¸­æŸ¥æ‰¾è®°å½•äº†è®¢é˜…è¿™ä¸ªé¢‘é“çš„æ‰€æœ‰å®¢æˆ·ç«¯çš„é“¾è¡¨ï¼ŒéåŽ†è¿™ä¸ªé“¾è¡¨ï¼Œå°†æ¶ˆæ¯å‘å¸ƒç»™æ‰€æœ‰è®¢é˜…è€…ã€‚ Pub/Subä»Žå­—é¢ä¸Šç†è§£å°±æ˜¯å‘å¸ƒï¼ˆPublishï¼‰ä¸Žè®¢é˜…ï¼ˆSubcribeï¼‰ï¼Œåœ¨Redisä¸­ï¼Œä½ å¯ä»¥è®¾å®šå¯¹æŸä¸€ä¸ªkeyå€¼è¿›è¡Œæ¶ˆæ¯å‘å¸ƒåŠæ¶ˆæ¯è®¢é˜…ï¼Œå½“ä¸€ä¸ªkeyå€¼ä¸Šè¿›è¡Œäº†æ¶ˆæ¯å‘å¸ƒåŽï¼Œæ‰€æœ‰è®¢é˜…å®ƒçš„å®¢æˆ·ç«¯ä¼šæ”¶åˆ°ç›¸åº”çš„æ¶ˆæ¯ï¼Œè¿™ä¸€åŠŸèƒ½æœ€æ˜Žæ˜¾çš„ç”¨æ³•å°±æ˜¯ç”¨ä½œå®žæ—¶æ¶ˆæ¯ç³»ç»Ÿï¼Œæ¯”å¦‚æ™®é€šçš„å³æ—¶èŠå¤©ï¼Œç¾¤èŠç­‰åŠŸèƒ½ã€‚ äºŒåäºŒã€é›†ç¾¤çŽ¯å¢ƒæ­å»ºçŽ¯å¢ƒé…ç½® åªé…ç½®ä»Žåº“ï¼Œä¸é…ç½®ä¸»åº“ å¤åˆ¶3ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åŽä¿®æ”¹å¯¹åº”çš„ä¿¡æ¯ include /usr/local/bin/kconfig/redis.conf #åŒ…å«é»˜è®¤é…ç½®ï¼Œä¸‹é¢çš„é…ç½®ä¼šè¦†ç›– ç«¯å£ pidå logæ–‡ä»¶å dump.rdbå cluster-enabled yes æ‰“å¼€é›†ç¾¤æ¨¡å¼ cluster-config-file nodes-6379.conf è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å cluster-node-timeout 15000 è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»Žåˆ‡æ¢ vimå…¨å±€æ›¿æ¢è„šæœ¬ 1:%s/6379/6380 ä»€ä¹ˆæ˜¯æ’æ§½ æ’æ§½æ˜¯Rediså¯¹Keyè¿›è¡Œåˆ†ç‰‡çš„å•å…ƒã€‚åœ¨Redisçš„é›†ç¾¤å®žçŽ°ä¸­ï¼Œå†…ç½®äº†æ•°æ®è‡ªåŠ¨åˆ†ç‰‡æœº åˆ¶ï¼Œé›†ç¾¤å†…éƒ¨ä¼šå°†æ‰€æœ‰çš„keyæ˜ å°„åˆ°16384ä¸ªæ’æ§½ä¸­ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªæ•°æ®åº“å®žä¾‹è´Ÿè´£å…¶ä¸­éƒ¨ åˆ†çš„æ’æ§½çš„è¯»å†™ã€‚ åˆä½“ï¼ˆåˆå§‹é›†ç¾¤ä¸»ä»ŽèŠ‚ç‚¹ï¼‰cd /opt/module/redis-6.2.4/src 1redis-cli --cluster create --cluster-replicas 1 192.168.10.102:6379 192.168.10.102:6380 192.168.10.102:6381 192.168.10.102:6389 192.168.10.102:6390 192.168.10.102:6391 æ­¤å¤„ä¸è¦ç”¨127.0.0.1ï¼Œè¯·ç”¨çœŸå®žipåœ°å€ â€“replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ ä¸€å°ä¸»æœºï¼Œä¸€å°ä»Žæœºï¼Œæ­£å¥½ä¸‰ç»„ ä¸€ä¸ªRedisé›†ç¾¤åŒ…å«16384ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œæ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®éƒ½å±žäºŽè¿™16384ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ª é›†ç¾¤ä½¿ç”¨å…¬å¼CRC16(key) % 16384 æ¥è®¡ç®—é”® key å±žäºŽå“ªä¸ªæ§½ï¼Œå…¶ä¸­CRC16(key) è¯­å¥ç”¨äºŽè®¡ç®—é”®keyçš„CRC16æ ¡éªŒå’Œ é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æžœä¸€ä¸ªé›†ç¾¤å¯ä»¥æœ‰ä¸»èŠ‚ç‚¹ï¼Œå…¶ä¸­ èŠ‚ç‚¹Aè´Ÿè´£å¤„ç†0-5460å·æ’æ§½ èŠ‚ç‚¹Bè´Ÿè´£å¤„ç†5461-10922å·æ’æ§½ èŠ‚ç‚¹Cè´Ÿè´£å¤„ç† 10923-16383å·æ’æ§½ æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š 1cluster nodes é›†ç¾¤å®¢æˆ·ç«¯è¿žæŽ¥åŠ ä¸Šå±žæ€§-cï¼Œè¡¨ç¤ºä»¥é›†ç¾¤ï¼ˆclusterï¼‰æ¨¡å¼è¿žæŽ¥ 1redis-cli -c -h yourhost -p yourpost è®¡ç®—keyçš„æ’æ§½å€¼ 1cluster keyslot k1 è®¡ç®—åœ¨æŸä¸ªæ’æ§½ä¸­keyçš„ä¸ªæ•°ï¼ˆåªèƒ½åœ¨æœ¬å®¢æˆ·ç«¯æ‰€åœ¨çš„æ’æ§½èŒƒå›´æŸ¥è¯¢åˆ°ï¼‰ 1cluster countkeysinslot 7629 å–å‡ºåœ¨å…·ä½“æ’æ§½å€¼çš„key 1cluster getkeysinslot 7629 1 å¦‚æžœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»Žéƒ½æŒ‚æŽ‰ï¼Œè€Œcluster-require-full-coverageä¸ºyesï¼Œé‚£ä¹ˆï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æŽ‰ï¼Œä¹Ÿå°±æ˜¯è¯¥é›†ç¾¤è¦æ±‚å®Œæ•´æ€§ å¦‚æžœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»Žéƒ½æŒ‚æŽ‰ï¼ŒäºŒcluster-require-full-converageä¸ºno,é‚£ä¹ˆï¼Œè¯¥æ’æ§½æ•°æ®å…¨éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨ï¼Œå…¶ä»–çš„æ’æ§½å¯ä»¥æ­£å¸¸ä½¿ç”¨ Redisé›†ç¾¤çš„ä¸è¶³å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„ å¤šé”®çš„Redisäº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ï¼Œluaè„šæœ¬ä¸è¢«æ”¯æŒ ç”±äºŽé›†ç¾¤æ–¹æ¡ˆå‡ºçŽ°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ äºŒåä¸‰ã€Redisçš„Jediså¼€å‘ä»£ç ï¼š1234567891011121314151617public class RedisClusterDemo &#123; public static void main(String[] args) &#123; //åˆ›å»ºå¯¹è±¡ HostAndPort hostAndPort = new HostAndPort(&quot;192.168.10.102&quot;, 6379); JedisCluster jedisCluster = new JedisCluster(hostAndPort); //è¿›è¡Œæ“ä½œ jedisCluster.set(&quot;b1&quot;, &quot;value1&quot;); String value = jedisCluster.get(&quot;b1&quot;); System.out.println(value); &#125;&#125; äºŒåå››ã€å®•æœºåŽæ‰‹åŠ¨é…ç½®ä¸»æœºå¦‚æžœå‡ºçŽ°masteræ–­å¼€äº†è¿žæŽ¥ï¼Œè¿™ä¸ªæ—¶å€™èƒ½ä¸èƒ½é€‰æ‹©ä¸€ä¸ªè€å¤§å¤„ç†å‘¢ï¼Ÿæ‰‹åŠ¨é…ç½®å¦‚æžœä¸»æœºæ–­å¼€è¿žæŽ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ slaveof no one æ¥è®©è‡ªå·±å˜æˆä¸»æœºï¼Œå…¶ä»–èŠ‚ç‚¹å°±å¯ä»¥æ‰‹åŠ¨è¿žæŽ¥åˆ°æœ€æ–°çš„è¿™ä¸ªä¸»èŠ‚ç‚¹Â· ä¸ç®¡ä¹‹å‰æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶è®¤ä¸»æˆ–è€…æ˜¯æ‰‹åŠ¨å‘½ä»¤è®¤ä¸»ï¼Œéƒ½æ˜¯å¯ä»¥çš„ ä¸»æœºå®•æœºåŽï¼Œåˆ‡æ¢ä¸»æœºæ­¥éª¤ï¼š æ‰¾ä¸€ä¸ªæƒ³æˆä¸ºä¸»æœºçš„ï¼Œå°†ä¹‹è®¾ç½®ä¸ºmasterï¼Œä½¿ç”¨ slaveof no one åœ¨å…¶ä»–ç«¯å£èŠ‚ç‚¹ä¸Š è®¤ä¸»slaveof idåœ°å€ ç«¯å£å· æ³¨æ„ï¼š åŽŸæ¥çš„ä¸»æœºæ¢å¤åŽï¼Œå°†æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„masterï¼Œä¸ä¼šå†ä¸Žå…¶ä»–èŠ‚ç‚¹è¿žæŽ¥ æ‰‹åŠ¨é…ç½®åŽï¼Œå†æ¬¡å¯åŠ¨Redisè¿˜ä¼šç”Ÿæ•ˆ äºŒåäº”ã€å“¨å…µæ¨¡å¼æ¦‚è¿°ï¼ˆè‡ªåŠ¨é€‰ä¸¾è€å¤§ï¼‰ä¸»ä»Žåˆ‡æ¢æŠ€æœ¯çš„æ–¹æ³•æ˜¯ï¼šå½“ä¸»æœåŠ¡å™¨å®•æœºåŽï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ï¼Œè¿™ä¸æ˜¯ä¸€ç§æŽ¨èæ–¹å¼ï¼Œæ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘å“¨å…µæ¨¡å¼ï¼ŒRedisä»Ž2..8å¼€å§‹æ­£å¼æä¾›äº†Senntinelï¼ˆå“¨å…µï¼‰æž¶æž„æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä¼˜å…ˆçº§åœ¨redis.confä¸­é»˜è®¤ï¼šreplica-priority 100 å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ å“¨å…µæ¨¡å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼ï¼Œé¦–å…ˆRedsiæä¾›äº†å“¨å…µçš„å‘½ä»¤ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œä»–ä¼šç‹¬ç«‹è¿è¡Œï¼Œå…¶åŽŸç†æ˜¯å“¨å…µé€šè¿‡å‘é€å‘½ä»¤ï¼Œç­‰å¾…RedisæœåŠ¡å™¨å“åº”ï¼Œä»Žè€Œç›‘æŽ§è¿è¡Œå¤šä¸ªRediså®žä¾‹ã€‚ å‡è®¾ä¸»æœåŠ¡å®•æœºï¼Œå“¨å…µ1å…ˆç›‘æµ‹åˆ°è¿™ä¸ªç»“æžœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œfailoverè¿‡ç¨‹ï¼Œä»…ä»…æ˜¯å“¨å…µ1ä¸»è§‚çš„è®¤ä¸ºæœåŠ¡ä¸å¯ç”¨ï¼Œè¿™ä¸ªçŽ°è±¡ç§°ä¸ºä¸»è§‚ä¸‹çº¿ï¼Œå½“åŽé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¹¶ä¸”æ•°é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œé‚£ä¹ˆå“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€æ¬¡æŠ•ç¥¨ï¼ŒæŠ•ç¥¨çš„ç»“æžœç”±ä¸€ä¸ªå“¨å…µå‘èµ·ï¼Œè¿›è¡Œfailoveræ•…éšœè½¬ç§»æ“ä½œï¼Œåˆ‡æ¢æˆåŠŸåŽï¼Œå°±ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å„ä¸ªå“¨å…µæŠŠè‡ªå·±ç›‘æŽ§çš„ä»ŽæœåŠ¡å™¨å®žçŽ°åˆ‡æ¢ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå®¢è§‚ä¸‹çº¿ã€‚ ä¼˜ç‚¹ èƒ½å¤ŸåŽå°ç›‘æŽ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æžœæ•…éšœæ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»Žåº“è½¬æ¢ä¸ºä¸»åº“ å“¨å…µé›†ç¾¤ï¼ŒåŸºäºŽä¸»ä»Žå¤åˆ¶æ¨¡å¼ï¼Œæ‰€æœ‰çš„ä¸»ä»Žé…ç½®ä¼˜ç‚¹ï¼Œå®ƒå…¨æœ‰ ä¸»ä»Žå¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§å°±ä¼šæ›´å¥½ å“¨å…µæ¨¡å¼å°±æ˜¯ä¸»ä»Žæ¨¡å¼çš„å‡çº§ï¼Œæ‰‹åŠ¨åˆ°è‡ªåŠ¨ï¼Œæ›´åŠ å¥å£® ç¼ºç‚¹ Redis ä¸å¥½åœ¨çº¿æ‰©å®¹çš„ï¼Œé›†ç¾¤å®¹é‡ä¸€æ—¦åˆ°è¾¾ä¸Šé™ï¼Œåœ¨çº¿æ‰©å®¹å°±ååˆ†éº»çƒ¦ å®žçŽ°å“¨å…µæ¨¡å¼çš„é…ç½®å…¶å®žæ˜¯å¾ˆéº»çƒ¦çš„ï¼Œé‡Œé¢æœ‰å¾ˆå¤šé€‰æ‹© å“¨å…µæ¨¡å¼çš„å…¨éƒ¨é…ç½®123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263# Example sentinel.conf # å“¨å…µsentinelå®žä¾‹è¿è¡Œçš„ç«¯å£ é»˜è®¤26379 port 26379 # å“¨å…µsentinelçš„å·¥ä½œç›®å½• dir /tmp # å“¨å…µsentinelç›‘æŽ§çš„redisä¸»èŠ‚ç‚¹çš„ ip port # master-name å¯ä»¥è‡ªå·±å‘½åçš„ä¸»èŠ‚ç‚¹åå­— åªèƒ½ç”±å­—æ¯A-zã€æ•°å­—0-9 ã€è¿™ä¸‰ä¸ªå­—ç¬¦&quot;.-_&quot;ç»„æˆã€‚ # quorum å½“è¿™äº›quorumä¸ªæ•°sentinelå“¨å…µè®¤ä¸ºmasterä¸»èŠ‚ç‚¹å¤±è” é‚£ä¹ˆè¿™æ—¶ å®¢è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹å¤±è”äº† # sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; sentinel monitor mymaster 127.0.0.1 6379 2 # å½“åœ¨Rediså®žä¾‹ä¸­å¼€å¯äº†requirepass foobared æŽˆæƒå¯†ç  è¿™æ ·æ‰€æœ‰è¿žæŽ¥Rediså®žä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾›å¯†ç  # è®¾ç½®å“¨å…µsentinel è¿žæŽ¥ä¸»ä»Žçš„å¯†ç  æ³¨æ„å¿…é¡»ä¸ºä¸»ä»Žè®¾ç½®ä¸€æ ·çš„éªŒè¯å¯†ç  # sentinel auth-pass &lt;master-name&gt; &lt;password&gt; sentinel auth-pass mymaster MySUPER--secret-0123passw0rd # æŒ‡å®šå¤šå°‘æ¯«ç§’ä¹‹åŽ ä¸»èŠ‚ç‚¹æ²¡æœ‰åº”ç­”å“¨å…µsentinel æ­¤æ—¶ å“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ é»˜è®¤30ç§’ # sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt; sentinel down-after-milliseconds mymaster 30000 # è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ªslaveåŒæ—¶å¯¹æ–°çš„masterè¿›è¡Œ åŒæ­¥ï¼Œè¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆfailoveræ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œ ä½†æ˜¯å¦‚æžœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Š å¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslave å¤„äºŽä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚ # sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt; sentinel parallel-syncs mymaster 1 # æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ failover-timeout å¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š #1. åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚ #2. å½“ä¸€ä¸ªslaveä»Žä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚ #3.å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚ #4.å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œslavesä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel-syncsæ‰€é…ç½®çš„è§„åˆ™æ¥äº† # é»˜è®¤ä¸‰åˆ†é’Ÿ # sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt; sentinel failover-timeout mymaster 180000 # SCRIPTS EXECUTION #é…ç½®å½“æŸä¸€äº‹ä»¶å‘ç”Ÿæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬æ¥é€šçŸ¥ç®¡ç†å‘˜ï¼Œä¾‹å¦‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ç›¸å…³äººå‘˜ã€‚ #å¯¹äºŽè„šæœ¬çš„è¿è¡Œç»“æžœæœ‰ä»¥ä¸‹è§„åˆ™ï¼š #è‹¥è„šæœ¬æ‰§è¡ŒåŽè¿”å›ž1ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ç¨åŽå°†ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œé‡å¤æ¬¡æ•°ç›®å‰é»˜è®¤ä¸º10 #è‹¥è„šæœ¬æ‰§è¡ŒåŽè¿”å›ž2ï¼Œæˆ–è€…æ¯”2æ›´é«˜çš„ä¸€ä¸ªè¿”å›žå€¼ï¼Œè„šæœ¬å°†ä¸ä¼šé‡å¤æ‰§è¡Œã€‚ #å¦‚æžœè„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºŽæ”¶åˆ°ç³»ç»Ÿä¸­æ–­ä¿¡å·è¢«ç»ˆæ­¢äº†ï¼Œåˆ™åŒè¿”å›žå€¼ä¸º1æ—¶çš„è¡Œä¸ºç›¸åŒã€‚ #ä¸€ä¸ªè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ä¸º60sï¼Œå¦‚æžœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè„šæœ¬å°†ä¼šè¢«ä¸€ä¸ªSIGKILLä¿¡å·ç»ˆæ­¢ï¼Œä¹‹åŽé‡æ–°æ‰§è¡Œã€‚ #é€šçŸ¥åž‹è„šæœ¬:å½“sentinelæœ‰ä»»ä½•è­¦å‘Šçº§åˆ«çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚è¯´rediså®žä¾‹çš„ä¸»è§‚å¤±æ•ˆå’Œå®¢è§‚å¤±æ•ˆç­‰ç­‰ï¼‰ï¼Œå°†ä¼šåŽ»è°ƒç”¨è¿™ä¸ªè„šæœ¬ï¼Œ è¿™æ—¶è¿™ä¸ªè„šæœ¬åº”è¯¥é€šè¿‡é‚®ä»¶ï¼ŒSMSç­‰æ–¹å¼åŽ»é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜å…³äºŽç³»ç»Ÿä¸æ­£å¸¸è¿è¡Œçš„ä¿¡æ¯ã€‚è°ƒç”¨è¯¥è„šæœ¬æ—¶ï¼Œå°†ä¼ ç»™è„šæœ¬ä¸¤ä¸ªå‚æ•°ï¼Œ ä¸€ä¸ªæ˜¯äº‹ä»¶çš„ç±»åž‹ï¼Œ ä¸€ä¸ªæ˜¯äº‹ä»¶çš„æè¿°ã€‚ å¦‚æžœsentinel.confé…ç½®æ–‡ä»¶ä¸­é…ç½®äº†è¿™ä¸ªè„šæœ¬è·¯å¾„ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯è¿™ä¸ªè„šæœ¬å­˜åœ¨äºŽè¿™ä¸ªè·¯å¾„ï¼Œå¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„ï¼Œå¦åˆ™sentinelæ— æ³•æ­£å¸¸å¯åŠ¨æˆåŠŸã€‚ #é€šçŸ¥è„šæœ¬ # sentinel notification-script &lt;master-name&gt; &lt;script-path&gt; sentinel notification-script mymaster /var/redis/notify.sh # å®¢æˆ·ç«¯é‡æ–°é…ç½®ä¸»èŠ‚ç‚¹å‚æ•°è„šæœ¬ # å½“ä¸€ä¸ªmasterç”±äºŽfailoverè€Œå‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å°†ä¼šè¢«è°ƒç”¨ï¼Œé€šçŸ¥ç›¸å…³çš„å®¢æˆ·ç«¯å…³äºŽmasteråœ°å€å·²ç»å‘ç”Ÿæ”¹å˜çš„ä¿¡æ¯ã€‚ # ä»¥ä¸‹å‚æ•°å°†ä¼šåœ¨è°ƒç”¨è„šæœ¬æ—¶ä¼ ç»™è„šæœ¬: # &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt; # ç›®å‰&lt;state&gt;æ€»æ˜¯â€œfailoverâ€, # &lt;role&gt;æ˜¯â€œleaderâ€æˆ–è€…â€œobserverâ€ä¸­çš„ä¸€ä¸ªã€‚ # å‚æ•° from-ip, from-port, to-ip, to-portæ˜¯ç”¨æ¥å’Œæ—§çš„masterå’Œæ–°çš„master(å³æ—§çš„slave)é€šä¿¡çš„ # è¿™ä¸ªè„šæœ¬åº”è¯¥æ˜¯é€šç”¨çš„ï¼Œèƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸æ˜¯é’ˆå¯¹æ€§çš„ã€‚ # sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt; sentinel client-reconfig-script mymaster /var/redis/reconfig.sh 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427# Example sentinel.conf# *** IMPORTANT ***## By default Sentinel will not be reachable from interfaces different than# localhost, either use the &#x27;bind&#x27; directive to bind to a list of network# interfaces, or disable protected mode with &quot;protected-mode no&quot; by# adding it to this configuration file.## Before doing that MAKE SURE the instance is protected from the outside# world via firewalling or other means.## For example you may use one of the following:## bind 127.0.0.1 192.168.1.1## protected-mode no# port &lt;sentinel-port&gt;# The port that this sentinel instance will run on# å“¨å…µ sentimel å®žä¾‹è¿è¡Œçš„ç«¯å£ é»˜è®¤ 26379port 26379# By default Redis Sentinel does not run as a daemon. Use &#x27;yes&#x27; if you need it.# Note that Redis will write a pid file in /var/run/redis-sentinel.pid when# daemonized.daemonize no# When running daemonized, Redis Sentinel writes a pid file in# /var/run/redis-sentinel.pid by default. You can specify a custom pid file# location here.pidfile /var/run/redis-sentinel.pid# Specify the log file name. Also the empty string can be used to force# Sentinel to log on the standard output. Note that if you use standard# output for logging but daemonize, logs will be sent to /dev/nulllogfile &quot;&quot;# sentinel announce-ip &lt;ip&gt;# sentinel announce-port &lt;port&gt;## The above two configuration directives are useful in environments where,# because of NAT, Sentinel is reachable from outside via a non-local address.## When announce-ip is provided, the Sentinel will claim the specified IP address# in HELLO messages used to gossip its presence, instead of auto-detecting the# local address as it usually does.## Similarly when announce-port is provided and is valid and non-zero, Sentinel# will announce the specified TCP port.## The two options don&#x27;t need to be used together, if only announce-ip is# provided, the Sentinel will announce the specified IP and the server port# as specified by the &quot;port&quot; option. If only announce-port is provided, the# Sentinel will announce the auto-detected local IP and the specified port.## Example:## sentinel announce-ip 1.2.3.4# dir &lt;working-directory&gt;# Every long running process should have a well-defined working directory.# For Redis Sentinel to chdir to /tmp at startup is the simplest thing# for the process to don&#x27;t interfere with administrative tasks such as# unmounting filesystems.# å“¨å…µ sentinelçš„å·¥ä½œç›®å½•dir /tmp# sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;## Tells Sentinel to monitor this master, and to consider it in O_DOWN# (Objectively Down) state only if at least &lt;quorum&gt; sentinels agree.## Note that whatever is the ODOWN quorum, a Sentinel will require to# be elected by the majority of the known Sentinels in order to# start a failover, so no failover can be performed in minority.## Replicas are auto-discovered, so you don&#x27;t need to specify replicas in# any way. Sentinel itself will rewrite this configuration file adding# the replicas using additional configuration options.# Also note that the configuration file is rewritten when a# replica is promoted to master.## Note: master name should not include special characters or spaces.# The valid charset is A-z 0-9 and the three characters &quot;.-_&quot;.sentinel monitor mymaster 127.0.0.1 6379 2# sentinel auth-pass &lt;master-name&gt; &lt;password&gt;## Set the password to use to authenticate with the master and replicas.# Useful if there is a password set in the Redis instances to monitor.## Note that the master password is also used for replicas, so it is not# possible to set a different password in masters and replicas instances# if you want to be able to monitor these instances with Sentinel.## However you can have Redis instances without the authentication enabled# mixed with Redis instances requiring the authentication (as long as the# password set is the same for all the instances requiring the password) as# the AUTH command will have no effect in Redis instances with authentication# switched off.## Example:## sentinel auth-pass mymaster MySUPER--secret-0123passw0rd# sentinel auth-user &lt;master-name&gt; &lt;username&gt;## This is useful in order to authenticate to instances having ACL capabilities,# that is, running Redis 6.0 or greater. When just auth-pass is provided the# Sentinel instance will authenticate to Redis using the old &quot;AUTH &lt;pass&gt;&quot;# method. When also an username is provided, it will use &quot;AUTH &lt;user&gt; &lt;pass&gt;&quot;.# In the Redis servers side, the ACL to provide just minimal access to# Sentinel instances, should be configured along the following lines:## user sentinel-user &gt;somepassword +client +subscribe +publish \\# +ping +info +multi +slaveof +config +client +exec on# sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;## Number of milliseconds the master (or any attached replica or sentinel) should# be unreachable (as in, not acceptable reply to PING, continuously, for the# specified period) in order to consider it in S_DOWN state (Subjectively# Down).## Default is 30 seconds.sentinel down-after-milliseconds mymaster 30000# IMPORTANT NOTE: starting with Redis 6.2 ACL capability is supported for# Sentinel mode, please refer to the Redis website https://redis.io/topics/acl# for more details.# Sentinel&#x27;s ACL users are defined in the following format:## user &lt;username&gt; ... acl rules ...## For example:## user worker +@admin +@connection ~* on &gt;ffa9203c493aa99## For more information about ACL configuration please refer to the Redis# website at https://redis.io/topics/acl and redis server configuration # template redis.conf.# ACL LOG## The ACL Log tracks failed commands and authentication events associated# with ACLs. The ACL Log is useful to troubleshoot failed commands blocked # by ACLs. The ACL Log is stored in memory. You can reclaim memory with # ACL LOG RESET. Define the maximum entry length of the ACL Log below.acllog-max-len 128# Using an external ACL file## Instead of configuring users here in this file, it is possible to use# a stand-alone file just listing users. The two methods cannot be mixed:# if you configure users here and at the same time you activate the external# ACL file, the server will refuse to start.## The format of the external ACL user file is exactly the same as the# format that is used inside redis.conf to describe users.## aclfile /etc/redis/sentinel-users.acl# requirepass &lt;password&gt;## You can configure Sentinel itself to require a password, however when doing# so Sentinel will try to authenticate with the same password to all the# other Sentinels. So you need to configure all your Sentinels in a given# group with the same &quot;requirepass&quot; password. Check the following documentation# for more info: https://redis.io/topics/sentinel## IMPORTANT NOTE: starting with Redis 6.2 &quot;requirepass&quot; is a compatibility# layer on top of the ACL system. The option effect will be just setting# the password for the default user. Clients will still authenticate using# AUTH &lt;password&gt; as usually, or more explicitly with AUTH default &lt;password&gt;# if they follow the new protocol: both will work.## New config files are advised to use separate authentication control for# incoming connections (via ACL), and for outgoing connections (via# sentinel-user and sentinel-pass) ## The requirepass is not compatable with aclfile option and the ACL LOAD# command, these will cause requirepass to be ignored.# sentinel sentinel-user &lt;username&gt;## You can configure Sentinel to authenticate with other Sentinels with specific# user name. # sentinel sentinel-pass &lt;password&gt;## The password for Sentinel to authenticate with other Sentinels. If sentinel-user# is not configured, Sentinel will use &#x27;default&#x27; user with sentinel-pass to authenticate.# sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;## How many replicas we can reconfigure to point to the new replica simultaneously# during the failover. Use a low number if you use the replicas to serve query# to avoid that all the replicas will be unreachable at about the same# time while performing the synchronization with the master.sentinel parallel-syncs mymaster 1# sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;## Specifies the failover timeout in milliseconds. It is used in many ways:## - The time needed to re-start a failover after a previous failover was# already tried against the same master by a given Sentinel, is two# times the failover timeout.## - The time needed for a replica replicating to a wrong master according# to a Sentinel current configuration, to be forced to replicate# with the right master, is exactly the failover timeout (counting since# the moment a Sentinel detected the misconfiguration).## - The time needed to cancel a failover that is already in progress but# did not produced any configuration change (SLAVEOF NO ONE yet not# acknowledged by the promoted replica).## - The maximum time a failover in progress waits for all the replicas to be# reconfigured as replicas of the new master. However even after this time# the replicas will be reconfigured by the Sentinels anyway, but not with# the exact parallel-syncs progression as specified.## Default is 3 minutes.sentinel failover-timeout mymaster 180000# SCRIPTS EXECUTION## sentinel notification-script and sentinel reconfig-script are used in order# to configure scripts that are called to notify the system administrator# or to reconfigure clients after a failover. The scripts are executed# with the following rules for error handling:## If script exits with &quot;1&quot; the execution is retried later (up to a maximum# number of times currently set to 10).## If script exits with &quot;2&quot; (or an higher value) the script execution is# not retried.## If script terminates because it receives a signal the behavior is the same# as exit code 1.## A script has a maximum running time of 60 seconds. After this limit is# reached the script is terminated with a SIGKILL and the execution retried.# NOTIFICATION SCRIPT## sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;# # Call the specified notification script for any sentinel event that is# generated in the WARNING level (for instance -sdown, -odown, and so forth).# This script should notify the system administrator via email, SMS, or any# other messaging system, that there is something wrong with the monitored# Redis systems.## The script is called with just two arguments: the first is the event type# and the second the event description.## The script must exist and be executable in order for sentinel to start if# this option is provided.## Example:## sentinel notification-script mymaster /var/redis/notify.sh# CLIENTS RECONFIGURATION SCRIPT## sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;## When the master changed because of a failover a script can be called in# order to perform application-specific tasks to notify the clients that the# configuration has changed and the master is at a different address.# # The following arguments are passed to the script:## &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;## &lt;state&gt; is currently always &quot;failover&quot;# &lt;role&gt; is either &quot;leader&quot; or &quot;observer&quot;# # The arguments from-ip, from-port, to-ip, to-port are used to communicate# the old address of the master and the new address of the elected replica# (now a master).## This script should be resistant to multiple invocations.## Example:## sentinel client-reconfig-script mymaster /var/redis/reconfig.sh# SECURITY## By default SENTINEL SET will not be able to change the notification-script# and client-reconfig-script at runtime. This avoids a trivial security issue# where clients can set the script to anything and trigger a failover in order# to get the program executed.sentinel deny-scripts-reconfig yes# REDIS COMMANDS RENAMING## Sometimes the Redis server has certain commands, that are needed for Sentinel# to work correctly, renamed to unguessable strings. This is often the case# of CONFIG and SLAVEOF in the context of providers that provide Redis as# a service, and don&#x27;t want the customers to reconfigure the instances outside# of the administration console.## In such case it is possible to tell Sentinel to use different command names# instead of the normal ones. For example if the master &quot;mymaster&quot;, and the# associated replicas, have &quot;CONFIG&quot; all renamed to &quot;GUESSME&quot;, I could use:## SENTINEL rename-command mymaster CONFIG GUESSME## After such configuration is set, every time Sentinel would use CONFIG it will# use GUESSME instead. Note that there is no actual need to respect the command# case, so writing &quot;config guessme&quot; is the same in the example above.## SENTINEL SET can also be used in order to perform this configuration at runtime.## In order to set a command back to its original name (undo the renaming), it# is possible to just rename a command to itself:## SENTINEL rename-command mymaster CONFIG CONFIG# HOSTNAMES SUPPORT## Normally Sentinel uses only IP addresses and requires SENTINEL MONITOR# to specify an IP address. Also, it requires the Redis replica-announce-ip# keyword to specify only IP addresses.## You may enable hostnames support by enabling resolve-hostnames. Note# that you must make sure your DNS is configured properly and that DNS# resolution does not introduce very long delays.#SENTINEL resolve-hostnames no# When resolve-hostnames is enabled, Sentinel still uses IP addresses# when exposing instances to users, configuration files, etc. If you want# to retain the hostnames when announced, enable announce-hostnames below.#SENTINEL announce-hostnames no æµ‹è¯•æˆ‘ä»¬ç›®å‰çŠ¶æ€æ˜¯ä¸€ä¸»äºŒä»Ž åœ¨/use/local/bin/kconf/ä¸­é…ç½®å“¨å…µé…ç½®æ–‡ä»¶ sentinel.conf 123# sentinel monitor è¢«ç›‘æŽ§çš„åç§° host port 1 sentinel monitor myredis 192.168.10.102 6379 1 # åŽé¢çš„æ•°å­—1ï¼Œä»£è¡¨ä¸»æœºæŒ‚äº†ï¼ŒslaveæŠ•ç¥¨çœ‹è®©è°æŽ¥æ›¿æˆä¸ºä¸»æœºï¼Œç¥¨æ•°æœ€å¤šçš„ï¼Œå°±ä¼šæˆä¸ºä¸»æœº å¯åŠ¨å“¨å…µ å¯åŠ¨æˆåŠŸå“¨å…µè¿›ç¨‹ç›‘å¬ï¼Œå®ƒä¼šç›‘å¬æ‰€æœ‰redisç«¯å£ 1redis-sentinel /usr/local/bin/kconfig/sentinel.conf ç›‘å¬ç«¯å£ï¼Œå‘çŽ°masterç«¯å£æŒ‚äº†ï¼Œè‡ªåŠ¨åˆ‡æ¢ä»Žæœºä¸ºä¸»æœº å°†åŽŸmasteræ¢å¤ï¼Œåˆ‡æ¢åŽŸmasterä¸ºæ–°masterçš„ä»Žæœº ä»Žæœºè‡ªåŠ¨é€‰ä¸¾æˆä¸ºä¸»æœºåŽï¼Œsentinel/confä¸­å¯¹ä¸»æœºçš„ç›‘å¬ç«¯å£ä¹Ÿä¼šä»ŽåŽŸä¸»æœºè½¬æˆæ–°ä¸»æœº äºŒåå…­ã€Redisç¼“å­˜ç©¿é€å’Œé›ªå´©Redisç¼“å­˜çš„ä½¿ç”¨ï¼Œæžå¤§çš„æé«˜äº†åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œæ•ˆçŽ‡ï¼Œç‰¹åˆ«æ˜¯æ•°æ®æŸ¥è¯¢æ–¹é¢ï¼Œä½†åŒæ—¶ï¼Œå®ƒä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼Œå…¶ä¸­ï¼Œæœ€è¦å®³çš„é—®é¢˜ï¼Œå°±æ˜¯æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œä»Žä¸¥æ ¼æ„ä¹‰ä¸Šä¸Šè®²ï¼Œè¿™ä¸ªé—®é¢˜æ— è§£ï¼Œå¦‚æžœå¯¹æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚å¾ˆé«˜ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨ç¼“å­˜ã€‚ å¦å¤–çš„ä¸€äº›å…¸åž‹é—®é¢˜å°±æ˜¯ï¼Œç¼“å­˜ç©¿é€ã€ç¼“å­˜é›ªå´©å’Œç¼“å­˜å‡»ç©¿ã€‚ç›®å‰ä¸šç•Œæœ‰éƒ½æœ‰æ¯”è¾ƒæµè¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ ç¼“å­˜ç©¿é€ï¼ˆç¼“å­˜ã€DBæ— æ•°æ®ï¼‰ æ¦‚å¿µ ç¼“å­˜ç©¿é€çš„æ¦‚å¿µå¾ˆç®€å•ï¼Œç”¨æˆ·æƒ³è¦æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼Œå‘çŽ°rediså†…å­˜æ•°æ®åº“æ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼ŒäºŽæ˜¯å‘æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ï¼Œå‘çŽ°ä¹Ÿæ²¡æœ‰ï¼ŒäºŽæ˜¯æœ¬æ¬¡æŸ¥è¯¢å¤±è´¥ï¼Œå½“ç”¨æˆ·å¾ˆå¤šçš„æ—¶å€™ï¼Œç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­ï¼ŒäºŽæ˜¯éƒ½åŽ»è¯·æ±‚äº†æŒä¹…å±‚æ•°æ®åº“ï¼Œè¿™ä¼šç»™æŒä¹…å±‚æ•°æ®åº“é€ æˆå¾ˆå¤§çš„åŽ‹åŠ›ï¼Œè¿™æ—¶å€™å°±ç›¸å½“äºŽå‡ºçŽ°äº†ç¼“å­˜ç©¿é€ã€‚ è§£å†³æ–¹æ¡ˆ å¸ƒéš†è¿‡æ»¤å™¨ å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æž„ï¼Œå¯¹æ‰€æœ‰å¯èƒ½æŸ¥è¯¢çš„å‚æ•°ä»¥hashå½¢å¼å­˜å‚¨ï¼Œåœ¨æŽ§åˆ¶å±‚å…ˆè¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆåˆ™ä¸¢å¼ƒï¼Œä»Žè€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢åŽ‹åŠ›ï¼› ç¼“å­˜ç©ºå¯¹è±¡ å½“å­˜å‚¨å±‚ä¸å‘½ä¸­åŽï¼Œå³ä½¿è¿”å›žçš„ç©ºå¯¹è±¡ä¹Ÿå°†å…¶ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹‹åŽå†è®¿é—®è¿™ä¸ªæ•°æ®å°†ä¼šä»Žç¼“å­˜ä¸­èŽ·å–ï¼Œä¿æŠ¤äº†åŽç«¯æ•°æ®æºï¼› ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ å¦‚æžœç©ºå€¼ èƒ½å¤Ÿè¢«ç¼“å­˜èµ·æ¥ï¼Œè¿™å°±æ„å‘³ç€ç¼“å­˜éœ€è¦æ›´å¤šçš„ç©ºé—´å­˜å‚¨æ›´å¤šçš„é”®ï¼Œå› ä¸ºè¿™å½“ä¸­å¯èƒ½ä¼šæœ‰å¾ˆå¤šç©ºå€¼çš„é”®ï¼› å³ä½¿å¯¹ç©ºå€¼è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´çª—å£çš„ä¸ä¸€è‡´ï¼Œè¿™å¯¹äºŽéœ€è¦ä¿æŒä¸€è‡´æ€§çš„ä¸šåŠ¡ä¼šæœ‰å½±å“ã€‚ è®¾ç½®å¯è®¿é—®åå•ï¼ˆç™½åå•ï¼‰ ä½¿ç”¨bitmapsç±»åž‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®é¢åå•ï¼Œåå•idä½œä¸ºbitmapsçš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œbitmapsé‡Œé¢çš„idè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœè®¿é—®idä¸åœ¨bitmapsé‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚ è¿›è¡Œå®žæ—¶ç›‘æŽ§ å½“å‘çŽ°Redisçš„å‘½ä¸­çŽ‡å¼€å§‹æ€¥é€Ÿé™ä½Žï¼Œéœ€è¦æŽ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®ç»™åå•é™åˆ¶æœåŠ¡ ç¼“å­˜å‡»ç©¿ï¼ˆé‡å¤ªå¤§ï¼Œç¼“å­˜è¿‡æœŸï¼‰ æ¦‚è¿° è¿™é‡Œéœ€è¦æ³¨æ„å’Œç¼“å­˜å‡»ç©¿çš„åŒºåˆ«ï¼Œç¼“å­˜å‡»ç©¿ï¼Œæ˜¯æŒ‡ä¸€ä¸ªkeyéžå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„çž¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿é€ç¼“å­˜ï¼Œç›´æŽ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±åƒåœ¨ä¸€ä¸ªå±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´žï¼› å½“æŸä¸ªkeyåœ¨è¿‡æœŸçš„çž¬é—´ï¼Œæœ‰å¤§é‡çš„è¯·æ±‚å¹¶å‘è®¿é—®ï¼Œè¿™ç±»æ•°æ®ä¸€èˆ¬æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œç”±äºŽç¼“å­˜è¿‡æœŸï¼Œä¼šåŒæ—¶è®¿é—®æ•°æ®åº“æ¥æŸ¥è¯¢æœ€æ–°æ•°æ®ï¼Œå¹¶ä¸”ä¼šå†™ç¼“å­˜ï¼Œä¼šå¯¼è‡´æ•°æ®åº“çž¬é—´åŽ‹åŠ›è¿‡å¤§ã€‚ è§£å†³æ–¹æ¡ˆ è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ ä»Žç¼“å­˜å±‚æ¥çœ‹ï¼Œæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€æœ‰ä¸ä¼šå‡ºçŽ°çƒ­ç‚¹keyè¿‡æœŸåŽäº§ç”Ÿçš„é—®é¢˜ã€‚ åŠ äº’æ–¥é” åˆ†å¸ƒå¼é”ï¼šä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œä¿è¯å¯¹äºŽæ¯ä¸ªkeyåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹åŽ»æŸ¥è¯¢åŽç«¯æœåŠ¡ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰èŽ·å¾—åˆ†å¸ƒå¼é”çš„æƒé™ï¼Œå› æ­¤åªéœ€è¦ç­‰å¾…å³å¯ï¼Œè¿™ç§æ–¹å¼å°†é«˜å¹¶å‘çš„åŽ‹åŠ›è½¬ç§»åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œå› æ­¤å¯¹åˆ†å¸ƒå¼é”çš„è€ƒéªŒå¾ˆå¤§ã€‚ ç¼“å­˜é›ªå´© æ¦‚å¿µ ç¼“å­˜é›ªå´©ï¼Œæ˜¯æŒ‡åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µï¼Œç¼“å­˜é›†ä¸­è¿‡æœŸå¤±æ•ˆ äº§ç”Ÿé›ªå´©çš„åŽŸå› ä¹‹ä¸€ï¼Œæ¯”å¦‚åœ¨å†™æ–‡æœ¬çš„æ—¶å€™ï¼Œé©¬ä¸Šå°±è¦åˆ°åŒåä¸€é›¶ç‚¹ï¼Œå¾ˆå¿«å°±ä¼šè¿Žæ¥ä¸€æ³¢æŠ¢è´­ï¼Œè¿™æ³¢å•†å“æ—¶é—´æ¯”è¾ƒé›†ä¸­çš„æ”¾å…¥äº†ç¼“å­˜ï¼Œå‡è®¾ç¼“å­˜ä¸€ä¸ªå°æ—¶ï¼Œåˆ°äº†å‡Œæ™¨ä¸€ç‚¹çš„æ—¶å€™ï¼Œè¿™æ‰¹å•†å“çš„ç¼“å­˜å°±è¦è¿‡æœŸäº†ï¼ŒäºŒé˜Ÿè¿™æ‰¹å•†å“çš„è®¿é—®æŸ¥è¯¢ï¼Œéƒ½è½åˆ°äº†æ•°æ®åº“ä¸Šï¼Œå¯¹äºŽæ•°æ®åº“è€Œè¨€ï¼Œå°±ä¼šäº§ç”Ÿå‘¨æœŸæ€§çš„åŽ‹åŠ›å³°å€¼ï¼ŒäºŽæ˜¯æ‰€æœ‰çš„è¯·æ±‚éƒ½å¥½åˆ°è¾¾å­˜å‚¨å±‚ï¼Œå­˜å‚¨å±‚çš„è°ƒç”¨é‡ä¼šæš´å¢žï¼Œé€ æˆå­˜å‚¨å±‚ä¹Ÿä¼šæŒ‚æŽ‰çš„æƒ…å†µã€‚ å…¶å®žé›†ä¸­è¿‡æœŸï¼Œå€’ä¸æ˜¯éžå¸¸è‡´å‘½çš„ï¼Œæ¯”è¾ƒè‡´å‘½çš„ç¼“å­˜é›ªå´©ï¼Œæ˜¯ç¼“å­˜æœåŠ¡å™¨æŸä¸ªèŠ‚ç‚¹å®•æœºæˆ–æ–­ç½‘ï¼Œå› è€Œè‡ªç„¶å½¢æˆçš„ç¼“å­˜é›ªå´©ï¼Œä¸€å®šæ˜¯åœ¨æŸä¸ªæ—¶é—´æ®µé›†ä¸­åˆ›å»ºç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ•°æ®åº“ä¹Ÿæ˜¯å¯ä»¥é¡¶ä½åŽ‹åŠ›çš„ï¼Œæ— éžå°±æ˜¯å¯¹æ•°æ®åº“äº§ç”Ÿå‘¨æœŸæ€§çš„åŽ‹åŠ›ï¼Œè€Œç¼“å­˜æœåŠ¡èŠ‚ç‚¹çš„å®•æœºï¼Œå¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆçš„åŽ‹åŠ›æ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œå¾ˆæœ‰å¯èƒ½çž¬é—´å°±æŠŠæ•°æ®åº“åŽ‹åž®ã€‚ è§£å†³æ–¹æ¡ˆ redisé«˜å¯ç”¨ è¿™ä¸ªæ€æƒ³çš„å«ä¹‰æ˜¯ï¼Œæ—¢ç„¶redisæœ‰å¯èƒ½æŒ‚æŽ‰ï¼Œé‚£æˆ‘å¤šå¢žè®¾å‡ å°redisï¼Œè¿™æ ·ä¸€å°æŒ‚æŽ‰ä¹‹åŽå…¶ä»–çš„è¿˜å¯ä»¥ç»§ç»­å·¥ä½œï¼Œå…¶å®žå°±æ˜¯æ­å»ºçš„é›†ç¾¤ã€‚ é™æµé™çº§ è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„æ€æƒ³æ˜¯ï¼Œåœ¨ç¼“å­˜å¤±æ•ˆåŽï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—æ¥æŽ§åˆ¶è¯»æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ã€‚æ¯”å¦‚å¯¹æŸä¸ªkeyåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚ æ•°æ®é¢„çƒ­ æ•°æ®åŠ çƒ­çš„å«ä¹‰å°±æ˜¯åœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œæˆ‘å…ˆæŠŠå¯èƒ½çš„æ•°æ®å…ˆé¢„å…ˆè®¿é—®ä¸€éï¼Œè¿™æ ·éƒ¨åˆ†å¯èƒ½å¤§é‡è®¿é—®çš„æ•°æ®å°±ä¼šåŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚åœ¨å³å°†å‘ç”Ÿå¤§å¹¶å‘è®¿é—®å‰æ‰‹åŠ¨è§¦å‘åŠ è½½ç¼“å­˜ä¸åŒçš„keyï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚ è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æžœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åŽå°åŽ»æ›´æ–°å®žé™…keyçš„ç¼“å­˜ å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŽŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢žåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤çŽ‡å°±ä¼šé™ä½Žï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ äºŒåä¸ƒã€åˆ†å¸ƒå¼é”ä½¿ç”¨setnxæ¥å®žçŽ°12setnx users 20 # ä¸Šé”expire users 10 # è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢ç”¨æˆ·æ²¡æœ‰é‡Šæ”¾é”å¯¼è‡´å‡ºçŽ°æ­»é” å¦‚æžœä¸Šé”ä¹‹åŽçªç„¶å‡ºçŽ°å¼‚å¸¸ï¼Œæ— æ³•è®¾ç½®è¿‡æœŸæ—¶é—´ è§£å†³ï¼šä¸Šé”åŒæ—¶è®¾ç½®è¿‡æœŸæ—¶é—´ 1set users 10 nx ex 12 æµ‹è¯• 1234567891011121314151617181920212223242526272829public String testLock()&#123; //èŽ·å–é” Boolean lock = redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;,&quot;111&quot;,3,TimeUnit.SECONDS); //èŽ·å–é”æˆåŠŸï¼ŒæŸ¥è¯¢numçš„å€¼ if(lock)&#123; Object value = redisTemplate.opsForValue().get(&quot;num&quot;); //åˆ¤æ–­numä¸ºç©ºreturn if(StringUtils.isEmpty(value))&#123; return null; &#125; //æœ‰é”®å€¼å°±è½¬æˆint int num = Integer.parseInt(value + &quot;&quot;); //æŠŠredisçš„numåŠ 1 redisTemplate.opsForValue().set(&quot;num&quot;, ++num); //é‡Šæ”¾é”ï¼Œdel redisTemplate.delete(&quot;lock&quot;); return num + &quot;&quot;; &#125;else&#123; try &#123; Thread.sleep(100); testLock(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; å…¶ä¸­ï¼š 1redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;,&quot;111&quot;,3,TimeUnit.SECONDS); å‚æ•°å€¼çš„è¿‡æœŸè®¾ç½®ä¸å®œè¿‡çŸ­ï¼Œè‡³å°‘è¦æ¯”æ‰‹åŠ¨é‡Šæ”¾é”æ‰€èŠ±è´¹çš„æ—¶é—´é•¿ï¼Œä¹Ÿä¸å®œè¿‡é•¿ï¼Œä¼šå¯¼è‡´é•¿æ—¶é—´é˜»å¡žï¼Œä¸¥é‡å½±å“æ€§èƒ½ ä½¿ç”¨å¹¶å‘æ€§èƒ½æµ‹è¯•å·¥å…·abå¹¶å‘è®¿é—® 1[root@localhost]# ab -n 1000 -c 100 http://192.168.56.1:8080/testLock è¿™ç§é”æœºåˆ¶å­˜åœ¨çš„é—®é¢˜ï¼ˆä¼˜åŒ–uuidé˜²è¯¯åˆ ï¼‰ æ¯”å¦‚aæ–¹å…ˆä¸Šé”ï¼Œbæ–¹ç­‰å¾…aæ–¹é‡Šæ”¾ï¼Œaä¸Šå®Œé”æœªé‡Šæ”¾æ—¶ï¼Œå‡ºçŽ°æœåŠ¡å™¨å¡é¡¿å¯¼è‡´é”è‡ªåŠ¨é‡Šæ”¾ï¼Œæ­¤æ—¶åœ¨ç­‰å¾…çš„bä¼šèŽ·å–åˆ°é”ï¼Œè€Œaä»£ç æœªæ‰§è¡Œå®Œï¼Œä¼šæ‰‹åŠ¨å†åŽ»é‡Šæ”¾bçš„é”ï¼Œå¯èƒ½å¯¼è‡´ä¸å¯é¢„æ–™çš„åŽæžœ è§£å†³æ–¹æ¡ˆ èŽ·å–é”çš„æ—¶å€™è®¾ç½®é”çš„valueå€¼ä¸ºuuidï¼Œæ¯æ¬¡é‡Šæ”¾é”ä¹‹å‰å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯è‡ªå·±çš„é”ï¼Œé¿å…å‡ºçŽ°é‡Šæ”¾åˆ«äººé”çš„æƒ…å†µ 1234567891011121314String uuid = UUID.randomUUID().toString();Boolean lock = redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;,uuid,3,TimeUnit.SECONDS);//.....//åˆ¤æ–­uuidå€¼æ˜¯å¦ä¸€æ ·Object lockUuid = redisTemplate.opsForValue().get(&quot;lock&quot;);if(lockUuid.equals(uuid))&#123; redisTemplate.delete(&quot;lock&quot;);&#125; è¯¥æ–¹æ¡ˆè¿˜æ˜¯ä¸èƒ½åšåˆ°åŽŸå­æ€§ï¼Œå³ä»ç„¶å­˜åœ¨éšæ‚£ï¼šå³å½“aé‡Šæ”¾é”çš„æ—¶å€™ï¼Œè¿™æ—¶åˆšå¥½é”è¿‡æœŸï¼Œè¿™æ—¶bèŽ·å–åˆ°äº†é”ï¼Œä½†aæ°å¥½ä¹ŸæŠŠbçš„é”ä¹Ÿé‡Šæ”¾äº†ï¼Œæ‰€ä»¥è¦å½»åº•è§£å†³äº‹ä»¶éš”ç¦»ï¼Œéœ€è¦å†…åµŒä½¿ç”¨lua æ¥é‡Šæ”¾é”ï¼Œå› ä¸ºlua å…·æœ‰åŽŸå­æ€§æ“ä½œ è§£å†³æ–¹æ¡ˆ 1234567891011121314151617181920212223String uuid = UUID.randomUUID().toString();String skuId = &quot;25&quot;;String locKey = &quot;lock&quot; + skuId;//èŽ·å–é”Boolean lock = redisTemplate.opsForValue().setIfAbsent(locKey,uuid,3,TimeUnit.SECONDS);//....//ä½¿ç”¨luaè„šæœ¬é‡Šæ”¾é”//å®šä¹‰luaè„šæœ¬String script = &quot;if redis.call(&#x27;get&#x27; , KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27; , KEYS[1]) else &quot; + &quot;return 0 end&quot;;//ä½¿ç”¨redisæ‰§è¡Œluaè„šæœ¬DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;&gt;();redisScript.setScriptText(script);//è®¾ç½®ä¸€ä¸‹è¿”å›žå€¼ç±»åž‹ ä¸º Long//å› ä¸ºåˆ é™¤åˆ¤æ–­çš„æ—¶å€™ï¼Œè¿”å›žçš„æ˜¯0ï¼Œç»™å…¶å°è£…ä¸ºæ•°æ®ç±»åž‹ï¼Œå¦‚æžœä¸å°è£…é‚£ä¹ˆé»˜è®¤è¿”å›žStringç±»åž‹ï¼Œ//é‚£ä¹ˆè¿”å›žå­—ç¬¦ä¸²ä¸Ž0 ä¼šæœ‰å‘ç”Ÿé”™è¯¯redisScript.setResultType(Long.class);//ç¬¬ä¸€ä¸ªè¦æ˜¯scriptè„šæœ¬ï¼Œç¬¬äºŒä¸ªéœ€è¦åˆ¤æ–­çš„keyï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯keyæ‰€å¯¹åº”çš„å€¼redisTemplate.execute(redisScript , Arrays.asList(locKey) , uuid); å®Œæ•´ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051public String testLuaLock()&#123; String uuid = UUID.randomUUID().toString(); String skuId = &quot;25&quot;; String locKey = &quot;lock&quot; + skuId; //èŽ·å–é” Boolean lock = redisTemplate.opsForValue().setIfAbsent(locKey,uuid,3,TimeUnit.SECONDS); //èŽ·å–é”æˆåŠŸï¼ŒæŸ¥è¯¢numçš„å€¼ if(lock)&#123; Object value = redisTemplate.opsForValue().get(&quot;num&quot;); //åˆ¤æ–­numä¸ºç©ºreturn if(StringUtils.isEmpty(value))&#123; return null; &#125; //æœ‰é”®å€¼å°±è½¬æˆint int num = Integer.parseInt(value + &quot;&quot;); //æŠŠredisçš„numåŠ 1 redisTemplate.opsForValue().set(&quot;num&quot;, ++num); //é‡Šæ”¾é”ï¼Œdel /* //åˆ¤æ–­uuidå€¼æ˜¯å¦ä¸€æ · Object lockUuid = redisTemplate.opsForValue().get(&quot;lock&quot;); if(lockUuid.equals(uuid))&#123; redisTemplate.delete(&quot;lock&quot;); &#125;*/ //ä½¿ç”¨luaè„šæœ¬é‡Šæ”¾é” //å®šä¹‰luaè„šæœ¬ String script = &quot;if redis.call(&#x27;get&#x27; , KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27; , KEYS[1]) else &quot; + &quot;return 0 end&quot;; //ä½¿ç”¨redisæ‰§è¡Œluaè„šæœ¬ DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;&gt;(); redisScript.setScriptText(script); //è®¾ç½®ä¸€ä¸‹è¿”å›žå€¼ç±»åž‹ ä¸º Long //å› ä¸ºåˆ é™¤åˆ¤æ–­çš„æ—¶å€™ï¼Œè¿”å›žçš„æ˜¯0ï¼Œç»™å…¶å°è£…ä¸ºæ•°æ®ç±»åž‹ï¼Œå¦‚æžœä¸å°è£…é‚£ä¹ˆé»˜è®¤è¿”å›žStringç±»åž‹ï¼Œ //é‚£ä¹ˆè¿”å›žå­—ç¬¦ä¸²ä¸Ž0 ä¼šæœ‰å‘ç”Ÿé”™è¯¯ redisScript.setResultType(Long.class); //ç¬¬ä¸€ä¸ªè¦æ˜¯scriptè„šæœ¬ï¼Œç¬¬äºŒä¸ªéœ€è¦åˆ¤æ–­çš„keyï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯keyæ‰€å¯¹åº”çš„å€¼ redisTemplate.execute(redisScript , Arrays.asList(locKey) , uuid); return num + &quot;&quot;; &#125;else&#123; try &#123; //å…¶ä»–çº¿ç¨‹ç­‰å¾… Thread.sleep(100); testLuaLock(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; äºŒåå…«ã€RedisUtilå·¥å…·ç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593package com.zhkucst.utils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.stereotype.Component;import org.springframework.util.CollectionUtils;import java.util.Collection;import java.util.List;import java.util.Map;import java.util.Set;import java.util.concurrent.TimeUnit;/** * Redis å·¥å…·ç±» * * @author FYP * * @data 2021å¹´6æœˆ13æ—¥ */@Componentpublic class RedisUtil &#123; @Autowired private RedisTemplate&lt;String, Object&gt; redisTemplate; //======================common============================ /** * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´ * @param key é”® * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return */ public boolean expire(String key, long time)&#123; try&#123; if(time &gt; 0)&#123; redisTemplate.expire(key, time, TimeUnit.SECONDS); &#125; return true; &#125;catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * æ ¹æ®key èŽ·å–è¿‡æœŸæ—¶é—´ * @param key é”® ä¸èƒ½ä¸ºnull * @return æ—¶é—´ï¼ˆç§’ï¼‰ è¿”å›ž0 ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ */ public long getExpire(String key)&#123; return redisTemplate.getExpire(key, TimeUnit.SECONDS); &#125; /** * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ * @param key é”® * @return true å­˜åœ¨ false ä¸å­˜åœ¨ */ public boolean hasKey(String key)&#123; try&#123; return redisTemplate.hasKey(key); &#125;catch(Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * åˆ é™¤ç¼“å­˜ * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª */ @SuppressWarnings(&quot;unchecked&quot;) public void del(String... key)&#123; if(key != null &amp;&amp; key.length &gt; 0)&#123; if(key.length == 1)&#123; redisTemplate.delete(key[0]); &#125;else&#123; redisTemplate.delete((Collection&lt;String&gt;) CollectionUtils.arrayToList(key)); &#125; &#125; &#125; //======================String============================ /** * æ™®é€šç¼“å­˜èŽ·å– * @param key é”® * @return å€¼ */ public Object get(String key)&#123; return key == null ? null : redisTemplate.opsForValue().get(key); &#125; /** *æ™®é€šç¼“å­˜æ”¾å…¥ * @param key é”® * @param value å€¼ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean set(String key, Object value)&#123; try &#123; redisTemplate.opsForValue().set(key, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ time è¦å¤§äºŽ ç­‰äºŽ 0,å°†è®¾ç½®æ— é™åˆ¶ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean set(String key, Object value, long time)&#123; try &#123; if(time &gt; 0)&#123; redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS); &#125;else&#123; set(key, value); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * é€’å¢ž * @param key é”® * @param delta â–³,å¢žé‡ï¼ˆå¤§äºŽ0ï¼‰ * @return å¢žé‡åŽçš„è¿”å›žå€¼ */ public long incr(String key, long delta)&#123; if(delta &lt; 0)&#123; throw new RuntimeException(&quot;é€’å¢žå› å­å¿…é¡»å¤§äºŽ0&quot;); &#125; return redisTemplate.opsForValue().increment(key, delta); &#125; /** * é€’å¢ž * @param key é”® * @param delta â–³,å‡é‡ï¼ˆå°äºŽ0ï¼‰ * @return å‡é‡åŽçš„è¿”å›žå€¼ */ public long decr(String key, long delta)&#123; if(delta &lt; 0)&#123; throw new RuntimeException(&quot;é€’å‡å› å­å¿…é¡»å¤§äºŽ0&quot;); &#125; return redisTemplate.opsForValue().increment(key, -delta); &#125; //======================Map============================ /** * HashGet * @param key é”® ä¸èƒ½èƒ½null * @param item å€¼ ä¸èƒ½èƒ½null * @return */ public Object hget(String key, String item)&#123; return redisTemplate.opsForHash().get(key, item); &#125; /** * èŽ·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼ * @param key é”® * @return å¯¹åº”çš„å¤šä¸ª k-vå¯¹ */ public Map&lt;Object, Object&gt; hmget(String key)&#123; return redisTemplate.opsForHash().entries(key); &#125; /** * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®ï¼Œå¦‚æžœä¸å­˜åœ¨å°†åˆ›å»º * @param key é”® * @param item é¡¹ * @param value å€¼ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean hset(String key, String item, Object value)&#123; try &#123; redisTemplate.opsForHash().put(key, item, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®ï¼Œå¦‚æžœä¸å­˜åœ¨å°†åˆ›å»º * @param key é”® * @param item é¡¹ * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰æ³¨æ„ï¼šå¦‚æžœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´ï¼Œè¿™é‡Œå°†ä¼šæ›¿æ¢åŽŸæœ‰çš„æ—¶é—´ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean hset(String key, String item, Object value, long time)&#123; try &#123; redisTemplate.opsForHash().put(key, item, value); if(time &gt; 0)&#123; expire(key, time); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * HashSet * @param key é”® * @param map å¯¹åº”å¤šä¸ªk-vå¯¹ * @return */ public boolean hmset(String key, Map&lt;String, Object&gt; map)&#123; try &#123; redisTemplate.opsForHash().putAll(key, map); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * HashSet å¹¶è®¾ç½®æ—¶é—´ * @param key é”® * @param map å¯¹åº”å¤šä¸ªk-vå¯¹ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean hmset(String key, Map&lt;String, Object&gt; map, long time )&#123; try &#123; redisTemplate.opsForHash().putAll(key, map); if(time &gt; 0)&#123; expire(key, time); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * åˆ é™¤hashè¡¨ä¸­çš„å€¼ * @param key é”® ä¸èƒ½ä¸ºnull * @param item é¡¹ å¯ä»¥æ˜¯å¤šä¸ª ä¸èƒ½ä¸º null */ public void hdel(String key, Object item)&#123; redisTemplate.opsForHash().delete(key, item); &#125; /** * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼ * @param key é”® ä¸èƒ½ä¸ºnull * @param item å€¼ ä¸èƒ½ä¸ºnull * @return true å­˜åœ¨ false ä¸å­˜åœ¨ */ public boolean hHasKey(String key, String item)&#123; return redisTemplate.opsForHash().hasKey(key, item); &#125; /** * hash é€’å¢ž å¦‚æžœä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢žåŽçš„å€¼è¿”å›ž * @param key é”® * @param item å€¼ * @param by è¦å¢žåŠ å‡ ï¼ˆå¤§äºŽ0ï¼‰ * @return */ public double hincr(String key, String item, double by)&#123; return redisTemplate.opsForHash().increment(key, item, by); &#125; /** * hash é€’å‡ å¦‚æžœä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢žåŽçš„å€¼è¿”å›ž * @param key é”® * @param item å€¼ * @param by è¦å‡å°‘å‡ ï¼ˆå¤§äºŽ0ï¼‰ * @return */ public double hdecr(String key, String item, double by)&#123; return redisTemplate.opsForHash().increment(key, item, -by); &#125; //======================Set============================ /** * æ ¹æ®key èŽ·å– Set ä¸­çš„æ‰€æœ‰å€¼ * @param key é”® * @return */ public Set&lt;Object&gt; sGet(String key) &#123; try &#123; return redisTemplate.opsForSet().members(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * æ ¹æ®valueä»Žä¸€ä¸ªsetä¸­æŸ¥è¯¢ã€‚æ˜¯å¦å­˜åœ¨ * @param key é”® * @param value å€¼ * @return true å­˜åœ¨ false ä¸å­˜åœ¨ */ public boolean sHasKey(String key, Object value)&#123; try &#123; return redisTemplate.opsForSet().isMember(key, value); &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * å°†æ•°æ®æ”¾å…¥setç¼“å­˜ * @param key é”® * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * @return æˆåŠŸä¸ªæ•° */ public long sSet(String key, Object... values)&#123; try &#123; return redisTemplate.opsForSet().add(key, values); &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * å°† set æ•°æ®æ”¾å…¥ç¼“å­˜ * @param key é”® * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * @return æˆåŠŸä¸ªæ•° */ public long sSetAndTime(String key, long time, Object... values)&#123; try &#123; Long count = redisTemplate.opsForSet().add(key, values); if(time &gt; 0)&#123; expire(key, time); &#125; return count; &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * èŽ·å–setç¼“å­˜çš„é•¿åº¦ * @param key é”® * @return */ public long sGetSetSize(String key)&#123; try &#123; return redisTemplate.opsForSet().size(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * ç§»é™¤å€¼ä¸º valueçš„ å…ƒç´  * @param key é”® * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * @return */ public long setRemove(String key, Object... values)&#123; try &#123; Long count = redisTemplate.opsForSet().remove(key, values); return count; &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; //======================List============================ /** * èŽ·å–llistç¼“å­˜çš„å†…å®¹ * @param key é”® * @param start å¼€å§‹ * @param end ç»“æŸï¼Œç»“æŸ 0 åˆ° -1 ä»£è¡¨æ‰€æœ‰å€¼ * @return */ public List&lt;Object&gt; lGet(String key, long start, long end)&#123; try &#123; return redisTemplate.opsForList().range(key, start, end); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * èŽ·å–listç¼“å­˜çš„é•¿åº¦ * @param key é”® * @return è¿”å›žé•¿åº¦ */ public long lGetListSize(String key)&#123; try &#123; return redisTemplate.opsForList().size(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * é€šè¿‡ç´¢å¼• èŽ·å–list ä¸­çš„å€¼ * @param key é”® * @param index ç´¢å¼• index &gt;= 0æ—¶ï¼Œ è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æŽ¨ index &lt; 0æ—¶ï¼Œ -1 è¡¨å°¾ï¼Œ -2 å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œ ä¾æ¬¡ç±»æŽ¨ * @return */ public Object lGetIndex(String key, long index)&#123; try &#123; return redisTemplate.opsForList().index(key, index); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ * @param key é”® * @param value å€¼ * @return */ public boolean lSet(String key, Object value)&#123; try &#123; redisTemplate.opsForList().rightPush(key, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ * @param key é”® * @param value å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return */ public boolean lSet(String key, Object value,long time)&#123; try &#123; redisTemplate.opsForList().rightPush(key, value); if(time &gt; 0)&#123; expire(key, time); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ * @param key é”® * @param values å€¼ * @return */ public boolean lSet(String key, List&lt;Object&gt; values)&#123; try &#123; redisTemplate.opsForList().rightPushAll(key, values); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ * @param key é”® * @param values å€¼ * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return */ public boolean lSet(String key, List&lt;Object&gt; values, long time)&#123; try &#123; redisTemplate.opsForList().rightPushAll(key, values); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ® * @param key é”® * @param index ç´¢å¼• * @param value å€¼ * @return */ public boolean lUpdateIndex(String key, long index, Object value)&#123; try &#123; redisTemplate.opsForList().set(key, index, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * ç§»é™¤Nä¸ªå€¼ä¸ºvalue * @param key é”® * @param count ç§»é™¤ä¸ªæ•° * @param value å€¼ * @return çœŸæ­£ç§»é™¤çš„ä¸ªæ•° */ public long lRemove(String key, long count, Object value)&#123; try &#123; Long remove = redisTemplate.opsForList().remove(key, count, value); return remove; &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125;&#125; äºŒåä¹ã€å­˜æ•°æ®è½¬ä¹‰ç¬¦é—®é¢˜Rediså®¢æˆ·ç«¯æ ¼å¼ï¼šä»Žå®¢æˆ·ç«¯å­˜æ”¾keyå€¼æ—¶ 12345# å­˜å€¼set k1 v1# å–å€¼get k1&quot;v1&quot; # éžå­—ç¬¦ä¸²æ ¼å¼ k1æ˜¯å­—ç¬¦ä¸²ç±»åž‹ï¼Œv1ï¼ˆéžå­—ç¬¦ä¸²ç±»åž‹ã€éžjsonæ ¼å¼ï¼‰ éœ€ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼Œæ‰å¯ä»¥ä¸Žjedisè¿žé€š 12345# å­˜å€¼set k1 &#x27;&quot;v1&quot;&#x27;# å–å€¼get k1&quot;\\&quot;v1\\&quot;&quot; #å­—ç¬¦ä¸²æ ¼å¼ redisConfigæ ‡å‡†é…ç½®jsonæ ¼å¼ï¼š ä¸‰åã€Redisæ–°åŠŸèƒ½æ–°åŠŸèƒ½æŽ¨å‡ºç”¨æˆ·æƒé™ï¼Œæ›´é«˜çš„å®‰å…¨æœºåˆ¶ 1acl list # æŸ¥çœ‹ç”¨æˆ·æ“ä½œæƒé™ 1hacl cat string # æŸ¥çœ‹æ·»åŠ æŒ‡ä»¤ç±»åˆ« 1acl setuser user1 # æ·»åŠ ç”¨æˆ· IOå¤šçº¿ç¨‹ Redisç»ˆäºŽæ”¯æŒå¤šçº¿ç¨‹äº†ï¼Œå‘Šåˆ«å•çº¿ç¨‹äº†å—ï¼Ÿ IOå¤šçº¿ç¨‹å…¶å®žæŒ‡å®¢æˆ·ç«¯äº¤äº’éƒ¨åˆ†çš„ç½‘ç»œ IO äº¤äº’å¤„ç†æ¨¡å—å¤šçº¿ç¨‹ï¼Œè€Œéžæ‰§è¡Œå‘½ä»¤å¤šçº¿ç¨‹ï¼ŒRedisæ‰§è¡Œå‘½ä»¤ä¾ç„¶æ˜¯å•çº¿ç¨‹ åŽŸç†æž¶æž„ Redos 6 åŠ å…¥å¤šçº¿ç¨‹ï¼Œä½†è·ŸMemcached è¿™ç§ä»Ž IO å¤„ç†åˆ°æ•°æ®è®¿é—®å¤šçº¿ç¨‹çš„å®žçŽ°æ¨¡å¼æœ‰äº›å·®å¼‚ã€‚Redisçš„å¤šçº¿ç¨‹éƒ¨åˆ†åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œè§£æžï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡æ˜¯ä¸æƒ³å› ä¸ºå¤šçº¿ç¨‹è€Œå˜å¾—å¤æ‚ï¼Œéœ€è¦åŽ»æŽ§åˆ¶keyã€luaã€äº‹åŠ¡ï¼ŒLPUSHã€LPOPç­‰ç­‰çš„å¹¶å‘é—®é¢˜ã€‚ 12io-threads-do-reads yes # é»˜è®¤å…³é—­io-threads 4\\ å·¥å…·æ”¯æŒcluster ä¹‹å‰çš„è€ç‰ˆæœ¬Rediséœ€è¦æ­å»ºé›†ç¾¤éœ€è¦å•ç‹¬å®‰è£…rubyçŽ¯å¢ƒï¼ŒRedis5å°†redis-trib.rbçš„åŠŸèƒ½é›†æˆåˆ°redis-cliã€‚å¦å¤–å®˜æ–¹redis-benchmarkå·¥å…·ä¹Ÿå¼€å§‹æ”¯æŒclusteræ¨¡å¼äº†ï¼Œé€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å¯¹å¤šä¸ªåˆ†ç‰‡è¿›è¡ŒåŽ‹æµ‹ ä¸‰åä¸€ã€springbootæ•´åˆRedisé›†ç¾¤å¼•å…¥ä¾èµ– 123456789101112131415161718&lt;!-- å¼•å…¥ redis ä¾èµ– --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.data&lt;/groupId&gt; &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt; &lt;version&gt;1.8.7.RELEASE&lt;/version&gt;&lt;/dependency&gt; redis.properties 1234567891011121314151617181920212223242526272829303132333435363738394041# å•æœº# Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰# redis.database=1# RedisæœåŠ¡å™¨åœ°å€# redis.host=localhost# RedisæœåŠ¡å™¨è¿žæŽ¥ç«¯å£# redis.port=6379#é›†ç¾¤# RedisæœåŠ¡å™¨é›†ç¾¤é…ç½®redis.nodes=localhost:6379,localhost:6380,localhost:6381,localhost:6389,localhost:6390,localhost:6391# RedisæœåŠ¡å™¨è¿žæŽ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰redis.password=redis#è¿žæŽ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿žæŽ¥æ•°ã€‚è®¾ä¸º0è¡¨ç¤ºæ— é™åˆ¶,å¦‚æžœæ˜¯jedis 2.4ä»¥åŽç”¨redis.maxTotal#redis.maxActive=600#æŽ§åˆ¶ä¸€ä¸ªpoolå¯åˆ†é…å¤šå°‘ä¸ªjediså®žä¾‹,ç”¨æ¥æ›¿æ¢ä¸Šé¢çš„redis.maxActive,å¦‚æžœæ˜¯jedis 2.4ä»¥åŽç”¨è¯¥å±žæ€§redis.maxTotal=2000# å‡ºçŽ°é…ç½®ä¸èƒ½åå°„Totalæ˜¯å› ä¸ºspringbootç‰ˆæœ¬# è¿žæŽ¥æ± æœ€å¤§é˜»å¡žç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰redis.maxWaitMillis=1000# è¿žæŽ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿žæŽ¥redis.maxIdle=100# è¿žæŽ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿žæŽ¥redis.minIdle=2# è¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰redis.timeout=0 redisé…ç½®ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137package com.tony.config;import com.fasterxml.jackson.annotation.JsonAutoDetect;import com.fasterxml.jackson.annotation.PropertyAccessor;import com.fasterxml.jackson.databind.ObjectMapper;import org.springframework.beans.factory.annotation.Qualifier;import org.springframework.beans.factory.annotation.Value;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.PropertySource;import org.springframework.data.redis.connection.RedisClusterConfiguration;import org.springframework.data.redis.connection.RedisConnectionFactory;import org.springframework.data.redis.connection.RedisNode;import org.springframework.data.redis.connection.jedis.JedisConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;import redis.clients.jedis.JedisPoolConfig;import java.util.HashSet;@Configuration@PropertySource(&quot;classpath:onf/redis.properties&quot;)public class RedisConfig &#123; @Value(&quot;$&#123;redis.password&#125;&quot;) private String password; @Value(&quot;$&#123;redis.maxTotal&#125;&quot;) private Integer maxTotal; @Value(&quot;$&#123;redis.maxWaitMillis&#125;&quot;) private Integer maxWaitMillis; @Value(&quot;redis.maxIdle&quot;) private Integer maxIdle; @Value(&quot;$&#123;redis.minIdle&#125;&quot;) private Integer minIdle; @Value(&quot;$&#123;redis.timeout&#125;&quot;) private Integer timeout; @Value(&quot;$&#123;redis.nodes&#125;&quot;) private String clusterNodes; @Bean public RedisClusterConfiguration redisClusterConfiguration()&#123; RedisClusterConfiguration redisClusterConfiguration = new RedisClusterConfiguration(); String[] cNodes = clusterNodes.split(&quot;,&quot;); HashSet&lt;RedisNode&gt; nodes = new HashSet&lt;&gt;(); //åˆ†é…é›†ç¾¤èŠ‚ç‚¹ for(String node : cNodes)&#123; String[] hp = node.split(&quot;:&quot;);//host:port nodes.add(new RedisNode(hp[0], Integer.parseInt(hp[1]))); &#125; redisClusterConfiguration.setClusterNodes(nodes); return redisClusterConfiguration; &#125; @Bean public JedisPoolConfig jedisPoolConfig()&#123; JedisPoolConfig jedisPoolConfig = new JedisPoolConfig(); jedisPoolConfig.setMaxTotal(maxTotal); jedisPoolConfig.setMaxWaitMillis(maxWaitMillis); jedisPoolConfig.setMaxIdle(maxIdle); jedisPoolConfig.setMinIdle(minIdle); jedisPoolConfig.setTestOnCreate(true); jedisPoolConfig.setTestOnBorrow(true); jedisPoolConfig.setTestOnReturn(true); jedisPoolConfig.setTestWhileIdle(true); //åˆ›å»ºé›†ç¾¤å¯¹è±¡ return jedisPoolConfig; &#125; @Bean(&quot;myJedisConnectionFactory&quot;) public JedisConnectionFactory jedisConnectionFactory(RedisClusterConfiguration redisClusterConfiguration, JedisPoolConfig jedisPoolConfig)&#123; JedisConnectionFactory jedisConnectionFactory = new JedisConnectionFactory((redisClusterConfiguration, jedisPoolConfig); jedisConnectionFactory.setTimeout(timeout); jedisConnectionFactory.setPassword(password); return jedisConnectionFactory; @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(@Qualifier(&quot;myJedisConnectionFactory&quot;) RedisConnectionFactory redisConnectionFactory) &#123; //ä¸€èˆ¬ä½¿ç”¨&lt;String, Object&gt; RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;(); template.setConnectionFactory(redisConnectionFactory); //jsonåºåˆ—åŒ–è®¾ç½® Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(om); //Stringåºåˆ—åŒ– StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); //keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setKeySerializer(stringRedisSerializer); //hashçš„keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setHashKeySerializer(stringRedisSerializer); //valueé‡‡ç”¨jsonçš„åºåˆ—åŒ–æ–¹å¼ template.setValueSerializer(jackson2JsonRedisSerializer); //hashçš„valueé‡‡ç”¨jsonåºåˆ—åŒ–æ–¹å¼ template.setHashValueSerializer(jackson2JsonRedisSerializer); //å…¶ä»–æœªè‡ªå®šä¹‰çš„å±žæ€§é€šè¿‡è¯¥æ–¹æ³•é…ç½®é»˜è®¤çš„PropertiesSet template.afterPropertiesSet(); return template; &#125;&#125;","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"æ•°æ®åº“ã€Redis","slug":"æ•°æ®åº“ã€Redis","permalink":"http://fyupeng.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81Redis/"}],"author":"fyupeng"},{"title":"MySQL ä¼˜åŒ–","slug":"MySQLä¼˜åŒ–","date":"2022-06-25T07:23:24.000Z","updated":"2022-06-25T07:30:26.774Z","comments":true,"path":"2022/06/25/MySQLä¼˜åŒ–/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/MySQL%E4%BC%98%E5%8C%96/","excerpt":"","text":"ä¸€ã€ ç´¢å¼•ä¼˜åŒ–å’Œè¯­å¥ä¼˜åŒ–1. ç´¢å¼•ä¼˜åŒ– ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®ç»“æž„ï¼Œèƒ½åŠ å¿«æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ ç´¢å¼•ç±»åž‹åŒ…æ‹¬ï¼šèšé›†ç´¢å¼•ã€è¦†ç›–ç´¢å¼•ã€ç»„åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼• é»˜è®¤ä½¿ç”¨ç´¢å¼•ï¼šB+æ ‘ï¼ˆå¤šè·¯æœç´¢æ ‘ï¼‰ç»“æž„ç´¢å¼• 1.1 æ‰§è¡Œè®¡åˆ’æ±‡ä¸­çš„ type system ä¸€ä¸ªè¡¨ä¸€æ¡è®°å½• const å¸¸é‡åŒ¹é…ï¼Œä»…åŒ¹é…ä¸€æ¡è®°å½• eq_ref å”¯ä¸€æ€§ç´¢å¼•æ‰«æ å¯¹äºŽæ¯ä¸ªç´¢å¼•é”®ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ä¸Žä¹‹åŒ¹é…ã€‚å¸¸è§äºŽä¸»é”® æˆ– å”¯ä¸€ç´¢å¼•æ‰«æã€‚ ref éžå”¯ä¸€æ€§ç´¢å¼•æ‰«æ è¿”å›žåŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„æ‰€æœ‰è¡Œã€‚æœ¬è´¨æ˜¯ä¹Ÿæ˜¯ä¸€ç§ç´¢å¼•è®¿é—®ï¼Œå®ƒè¿”å›žæ‰€æœ‰åŒ¹é…æŸä¸ªå•ç‹¬å€¼çš„è¡Œï¼Œç„¶è€Œä»–å¯èƒ½ä¼šæ‰¾åˆ°å¤šä¸ªç¬¦åˆæ¡ä»¶çš„è¡Œï¼Œæ‰€ä»¥å®ƒåº”è¯¥å±žäºŽæŸ¥æ‰¾å’Œæ‰«æçš„æ··åˆä½“ã€‚ range åªæ£€ç´¢ç»™å®šèŒƒå›´çš„è¡Œï¼Œä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ¥é€‰æ‹©è¡Œã€‚keyåˆ—æ˜¾ç¤ºä½¿ç”¨äº†é‚£ä¸ªç´¢å¼•ã€‚ä¸€èˆ¬å°±æ˜¯åœ¨whereè¯­å¥ä¸­å‡ºçŽ°äº†bettweenã€&lt;ã€&gt;ã€inç­‰çš„æŸ¥è¯¢ã€‚è¿™ç§ç´¢å¼•åˆ—ä¸Šçš„èŒƒå›´æ‰«ææ¯”å…¨ç´¢å¼•æ‰«æè¦å¥½ã€‚åªéœ€è¦å¼€å§‹äºŽæŸä¸ªç‚¹ï¼Œç»“æŸäºŽå¦ä¸€ä¸ªç‚¹ï¼Œä¸ç”¨æ‰«æå…¨éƒ¨ç´¢å¼•ã€‚ index å…¨ç´¢å¼•æ‰«æ all å…¨è¡¨æ‰«æ 2. è¯­å¥ä¼˜åŒ– æŸ¥è¯¢è¯­å¥ä¸ä½¿ç”¨ select * æŸ¥è¯¢å¼€é”€å¤§ å¢žåŠ  IO æ“ä½œ å¤±åŽ»â€œè¦†ç›–ç´¢å¼•â€ä¼˜åŒ–å™¨çš„å¯èƒ½æ€§ å¯è¯»æ€§å·® å°½é‡å‡å°‘å­æŸ¥è¯¢ï¼Œä½¿ç”¨å…³è”æŸ¥è¯¢ï¼ˆleft join,right join,inner joinï¼‰æ›¿ä»£ å­æŸ¥è¯¢è¦æŸ¥è¯¢ä¸¤æ¬¡ å…³è”æŸ¥è¯¢æ˜¯å…ˆå»ºç«‹ä¸´æ—¶è¡¨ï¼Œå°†å¤šä¸ªè¡¨å…³è”èµ·æ¥ï¼Œå†æŸ¥è¯¢ä¸€æ¬¡ï¼Œæ•ˆçŽ‡è¦æ¯”å­æŸ¥è¯¢é«˜ å‡å°‘ä½¿ç”¨IN æˆ–è€… NOT INï¼Œä½¿ç”¨ existï¼Œnot exist æˆ–è€…å…³è”æŸ¥è¯¢è¯­å¥ä»£æ›¿ IN æˆ– NOT IN é€‚åˆå­è¡¨æ•°æ®æ¯”è¾ƒå°ï¼Œexist å’Œ not exist é€‚åˆå­è¡¨æ•°æ®æ¯”è¾ƒå¤§ IN å’Œ NO INT æ˜¯å…ˆå¯¹ä¸¤ä¸ªè¡¨ç¼“å­˜æ•°æ®ï¼Œå†ç¬›å¡å°”ç§¯æŸ¥è¯¢ï¼Œå±žäºŽå†…å­˜æŸ¥è¯¢ exist å’Œ not exist æ˜¯æŸ¥è¯¢æ•°æ®åº“æ¶ˆè€—æ€§èƒ½æ›´é«˜ or çš„æŸ¥è¯¢å°½é‡ç”¨ union æˆ–è€… union allä»£æ›¿ï¼Œunion allæœ‰é‡å¤æƒ…å†µ,union ä¼šæ¶ˆé™¤é‡å¤æƒ…å†µ or æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢æ¡ä»¶å‡ºçŽ°éžç´¢å¼•åˆ—ï¼Œå­˜åœ¨ç´¢å¼•çš„æŸ¥è¯¢åˆ—ä¼šå¤±æ•ˆ ä½¿ç”¨ union æœ‰ç´¢å¼•åˆ—çš„ç”¨ç´¢å¼•æŸ¥è¯¢ï¼Œæ²¡æœ‰ç´¢å¼•åˆ—çš„ æ­£å¸¸æŸ¥è¯¢ å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ != æˆ– &lt;&gt; æ“ä½œç¬¦ï¼Œå¦åˆ™å°† å¼•æ“Žæ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æ å°½é‡é¿å…åœ¨where å­—å¥ä¸­å¯¹ å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´ å¼•æ“Žæ”¾å¼ƒç´¢å¼•è¿›è¡Œå…¨è¡¨æ‰«æ 2.1 å¤šè¡¨ä¼˜åŒ– å°è¡¨é©±åŠ¨å¤§è¡¨ï¼Œæ•ˆçŽ‡è¦æ¯”å¤§è¡¨é©±åŠ¨å°è¡¨é«˜ é¢‘ç¹æŸ¥è¯¢çš„å­—æ®µåŠ ä¸Šç´¢å¼• 2.2 é¿å…ç´¢å¼•å¤±æ•ˆ å¤åˆç´¢å¼•ï¼Œä¸è¦è·¨åˆ—æˆ–æ— åºä½¿ç”¨ å¤åˆç´¢å¼•ï¼Œå°½é‡ä½¿ç”¨å…¨ç´¢å¼•åŒ¹é… å¯¹ç´¢å¼•è¿›è¡Œå‡½æ•°ã€è®¡ç®—ã€ç±»åž‹è½¬æ¢ å¤åˆç´¢å¼•ä¸èƒ½ä½¿ç”¨ä¸ç­‰äºŽ (!= &lt;&gt;) æˆ– is null (is not null) ï¼Œå¦åˆ™è‡ªèº«ä»¥åŠå³ä¾§å…¨éƒ¨ç´¢å¼•å¤±æ•ˆ ä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥è¯¢æœ‰sqlä¼˜åŒ–å™¨å¹²é¢„ï¼Œç´¢å¼•æœ‰æ¦‚çŽ‡å¤±æ•ˆï¼Œå°½é‡ä½¿ç”¨ç´¢å¼•è¦†ç›– like å°½é‡ä»¥å¸¸é‡å¼€å¤´ä¸è¦ä»¥ â€˜%â€™å¼€å¤´ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ å°½é‡ä¸è¦ä½¿ç”¨or ï¼Œå¦åˆ™ç´¢å¼•å¤±æ•ˆ 3. å…¶ä»–ä¼˜åŒ–3.1 exist å’Œ in å¦‚æžœä¸»æŸ¥è¯¢çš„æ•°æ®é›†å¤§ï¼Œåˆ™ä½¿ç”¨In å¦‚æžœå­æŸ¥è¯¢çš„æ•°æ®é›†å¤§ï¼Œåˆ™ä½¿ç”¨exist exist è¯­æ³•ï¼šå°†ä¸»æŸ¥è¯¢æŸ¥è¯¢çš„ç»“æžœï¼Œæ”¾åˆ°å­æŸ¥è¯¢ç»“æžœä¸­è¿›è¡Œæ¡ä»¶æ ¡éªŒï¼Œçœ‹å­æŸ¥è¯¢ä¸­æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æžœæœ‰æ•°æ®ï¼Œåˆ™æ ¡éªŒæˆåŠŸ â€‹ å¦‚æžœç¬¦åˆæ ¡éªŒï¼Œåˆ™ä¿ç•™æ•°æ® in è¯­æ³•ï¼šå…ˆå­æŸ¥è¯¢ï¼Œç„¶åŽç»“æžœç»™ä¸»æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢ä¼šç¼“å­˜èµ·æ¥ 3.2 order byusing filesort æœ‰ä¸¤ç§ç®—æ³•ï¼šåŒè·¯æŽ’åºã€å•è·¯æŽ’åºï¼ˆæ ¹æ® IO æ¬¡æ•°) MySQL 4.1ä¹‹å‰ é»˜è®¤ä½¿ç”¨ åŒè·¯æŽ’åºï¼šåŒè·¯ï¼šæ‰«æ2æ¬¡ç£ç›˜ï¼ˆ1ï¼šä»Žç£ç›˜è¯»å–æŽ’åºå­—æ®µï¼Œå¯¹æŽ’åºè¿›è¡ŒæŽ’åº 2ï¼šæ‰«æå…¶ä»–å­—æ®µï¼‰ â€”â€” IO è¾ƒæ¶ˆè€—æ€§èƒ½ MySQL 4.1 ä¹‹åŽ é»˜è®¤ä½¿ç”¨ å•è·¯æŽ’åºï¼šåªè¯»å–ä¸€æ¬¡ï¼ˆå…¨éƒ¨å­—æ®µï¼‰ï¼Œåœ¨buffer ä¸­è¿›è¡ŒæŽ’åºã€‚ä½†æ­¤ç§å•è·¯æŽ’åºä¼šæœ‰ä¸€å®šéšæ‚£ï¼ˆä¸ä¸€å®šçœŸçš„æ˜¯â€œå•è·¯ | ä¸€æ¬¡IOâ€ï¼Œæœ‰å¯èƒ½å¯¹æ¬¡ï¼‰ æ³¨æ„ï¼šå•è·¯æŽ’åºæ¯”åŒè·¯æŽ’åºå ç”¨æ›´å¤šçš„buffer å•è·¯æŽ’åºåœ¨ä½¿ç”¨æ—¶ï¼Œå¦‚æžœæ•°æ®é‡å¤§ï¼Œå¯ä»¥è€ƒè™‘è°ƒå¤§ buffer çš„å®¹é‡å¤§å°ï¼šset max_length_for_sort_data = 1024 å¦‚æžœ max_length_for_sort_data å€¼å¤ªä½Žï¼Œåˆ™ mysql ä¼šè‡ªåŠ¨ä»Ž å•è·¯-&gt;åŒè·¯ (å¤ªä½Žï¼šéœ€è¦æŽ’åºçš„åˆ—çš„æ€»å¤§å°è¶…è¿‡äº† max_length_for_sort_data å®šä¹‰çš„å­—èŠ‚æ•°) åŽŸå› ï¼šå¦‚æžœæ•°æ®é‡ç‰¹åˆ«å¤§ï¼Œåˆ™æ— æ³• å°†æ‰€æœ‰å­—æ®µçš„æ•°æ® ä¸€æ¬¡æ€§è¯»å–å®Œæ¯•ï¼Œå› æ­¤ä¼šè¿›è¡Œ â€œåˆ†ç‰‡è¯»å–ã€å¤šæ¬¡è¯»å–â€ æé«˜ order by æŸ¥è¯¢çš„ç­–ç•¥ï¼š é€‰æ‹©ä½¿ç”¨å•è·¯ã€åŒè·¯ï¼Œè°ƒæ•´buffer çš„å®¹é‡å¤§å° é¿å…select * â€¦ å¤åˆç´¢å¼• ä¸è¦è·¨åˆ—ä½¿ç”¨ï¼Œå‡ºçŽ° using filesort äºŒã€é”å’Œæ­»é”1. é”ï¼šä¹è§‚é”ï¼šé€šè¿‡ç‰ˆæœ¬å·æŽ§åˆ¶ï¼ŒæŸ¥è¯¢æ—¶èŽ·å–ç‰ˆæœ¬å·ï¼Œæäº¤æ—¶æ¯”è¾ƒç‰ˆæœ¬å· æ‚²è§‚é”ï¼šåŸºäºŽæ•°æ®åº“çš„é”æœºåˆ¶ï¼ŒçœŸæ­£ä¿è¯æ•°æ®è®¿é—®çš„æŽ’ä»–æ€§ 1.1 é€ æˆæ­»é”çš„å¿…è¦æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ è¯·æ±‚ä¸Žä¿æŒ ä¸å‰¥å¤ºæ¡ä»¶ å¾ªçŽ¯ç­‰å¾… 1.2 é”å‡çº§é”å‡çº§ä¹Ÿæ˜¯è·Ÿç´¢å¼•æŒ‚é’©çš„ï¼ŒInnoDB æ˜¯ä½¿ç”¨çš„è¡Œé”ï¼Œä½†åœ¨æ“ä½œæ—¶å¾ˆå®¹æ˜“å‡çº§ä¸ºè¡¨é” InnoDB çš„è¡Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œæ“ä½œä¸èµ°é”å¼•ï¼Œä¹Ÿå°±æ˜¯ where æ¡ä»¶ä¸æ˜¯ç´¢å¼•åˆ—ï¼Œåˆ™ä¼šå‡çº§é” æœ‰ç´¢å¼•æŸ¥è¯¢ï¼Œè¯´æ˜Žè¦æ“ä½œçš„æ•°æ®åœ¨ç´¢å¼•ä¸Šå·²ç»ç¡®å®šäº†ï¼Œåªè¦é”ä½ ç´¢å¼•æ¡ä»¶çš„è®°å½•ï¼ŒåŠ è¡Œé” æ— ç´¢å¼•æŸ¥è¯¢ï¼Œè¯´æ˜Žæ˜¯è¦å…¨è¡¨æŸ¥è¯¢ï¼Œå¹¶ä¸èƒ½ä¿è¯è¦æŸ¥è¯¢çš„è®°å½•æœ‰å…¶ä»–äº‹åŠ¡è¦åŽ»æ“ä½œï¼Œæ‰€ä»¥å‡çº§ä¸ºè¡¨é” éžå”¯ä¸€ç´¢å¼•è®°å½•è¶…è¿‡ä¸€å®šæ•°é‡æ—¶ï¼ŒæŸ¥è¯¢è¯­å¥ä¼˜åŒ–æ—¶ä¼šé€‰æ‹©ä¸èµ°ç´¢å¼•ï¼Œä»Žè€Œé€ æˆç´¢å¼•å¤±æ•ˆï¼Œè¡Œé”ä¹Ÿä¼šå‡çº§ä¸ºè¡¨é” 1.3 è§£å†³æ­»é”ï¼š æŸ¥è¯¢æ—¶ä½¿ç”¨ç´¢å¼•æ¡ä»¶ï¼Œé¿å…å› æŸ¥è¯¢ä¼˜åŒ–å¯¼è‡´é”å¤±æ•ˆæˆ–ä¸ä½¿ç”¨ç´¢å¼•æ¡ä»¶æŸ¥è¯¢ï¼Œä»Žè€Œå‡ºçŽ°é”å‡çº§ä¸ºè¡¨é” åˆç†è®¾è®¡ç´¢å¼•ï¼Œè¡Œé”éƒ½æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„ï¼Œå°½é‡ç¼©å°é”çš„èŒƒå›´ å°½å¯èƒ½ä½¿ç”¨ä½Žçº§åˆ«çš„äº‹åŠ¡éš”ç¦»æœºåˆ¶ å°½é‡å‡å°‘æŸ¥è¯¢æ¡ä»¶çš„èŒƒå›´ï¼Œå°½é‡é¿å…é—´éš™é”æˆ–ç¼©å°é—´éš™é”çš„èŒƒå›´ è®¾ç½®æŒ‰ç…§åŒä¸€é¡ºåºè®¿é—®èµ„æºï¼Œç±»ä¼¼äºŽä¸²è¡Œæ‰§è¡Œ 2. è¡¨é”çš„æ“ä½œmysql è¦ä½¿ç”¨è¡¨é”ï¼Œmysql å¼•æ“Ž Myisam ä½¿ç”¨çš„å°±æ˜¯ è¡¨é”ï¼Œä½†ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ²¡æœ‰æäº¤è¿™è¯´æ³• 2.1 æŸ¥çœ‹åŠ é”çš„è¡¨1show open tables; 2.2 åŠ è¯»é” å½“å‰sessionå›žè¯ï¼š 123lock table tablelock read;select * from tablelock; -- è¯»ï¼ˆæŸ¥ï¼‰å…è®¸delete from tablelock where id = 1; -- å†™ï¼ˆå¢žåˆ æ”¹ï¼‰ä¸å…è®¸ 1ERROR 1099 (HY000): Table &#x27;tablelock&#x27; was locked with a READ lock and can&#x27;t be updated 12select count(1) emp; -- ä¸å…è®¸delete from emp where id = 1; -- ä¸å…è®¸ 1ERROR 1100 (HY000): Table &#x27;emp&#x27; was not locked with LOCK TABLES å…¶ä»–sessionä¼šè¯ï¼š 12select * from tablelock; -- è¯»ï¼ˆæŸ¥ï¼‰å…è®¸delete from tablelock where id = 1; -- å†™ï¼ˆå¢žåˆ æ”¹ï¼‰ç­‰å¾…ç›´åˆ°é”é‡Šæ”¾ 12select * from dept; -- è¯»å…è®¸delete from emp where eno = 1; -- å†™å…è®¸ æ€»ç»“ï¼š èŽ·å¾—è¯»é”çš„ä¼šè¯åªèƒ½å¯¹é”æœ¬èº«çš„è¡¨å¯ä»¥è¯»æ“ä½œï¼Œä¸å…è®¸å†™æ“ä½œ èŽ·å¾—é”çš„ä¼šè¯ä¸å…è®¸å¯¹å…¶ä»–è¡¨è¯»å†™æ“ä½œ å…¶ä»–ä¼šè¯å¯¹é”æœ¬èº«çš„è¡¨å¯ä»¥è¯»æ“ä½œï¼Œå†™ç­‰å¾… å…¶ä»–ä¼šè¯å¯¹å…¶ä»–è¡¨å¯ä»¥è¯»å†™æ“ä½œ 2,.3 åŠ å†™é”å½“å‰ä¼šè¯ï¼š 123lock table tablelock write;select * from tablelock; -- å…è®¸è¯»insert into tablelock(name) values(&#x27;a6&#x27;); -- å…è®¸å†™ 12select * from dept; -- è¯»ä¸å…è®¸delete from dept where dno = 1; -- å†™ä¸å…è®¸ 1ERROR 1100 (HY000): Table &#x27;dept&#x27; was not locked with LOCK TABLES å…¶ä»–ä¼šè¯ï¼š 12select * from tablelock; -- è¯»ç­‰å¾…delete from tablelock where id = 2; -- å†™ç­‰å¾… 12select * from dept; -- è¯»å…è®¸delete from emp where eno = 1; -- å†™å…è®¸ æ€»ç»“ï¼š èŽ·å¾—è¯»é”çš„ä¼šè¯åªèƒ½å¯¹é”æœ¬èº«çš„è¡¨è¯»å†™æ“ä½œ èŽ·å¾—é”çš„ä¼šè¯ä¸å…è®¸å¯¹å…¶ä»–è¡¨è¯»å†™æ“ä½œ å…¶ä»–ä¼šè¯å¯¹é”æœ¬èº«çš„è¡¨è¯»å†™ç­‰å¾… å…¶ä»–ä¼šè¯å¯¹å…¶ä»–è¡¨å¯ä»¥è¯»å†™æ“ä½œ 2.4 é‡Šæ”¾é”1unlock tables; 2.5 åˆ†æžè¡¨é”å®šåˆ†æžè¡¨é”å®šä¸¥é‡ç¨‹åº¦ï¼š 1show status like &#x27;table%&#x27;; 123456789+----------------------------+-------+| Variable_name | Value |+----------------------------+-------+| Table_locks_immediate | 5 | -- å¯ä»¥ç«‹å³èŽ·å–è¡¨é”è¯·æ±‚çš„æ¬¡æ•°| Table_locks_waited | 0 | -- ä¸èƒ½ç«‹å³èŽ·å–è¡¨é”è¯·æ±‚è€Œä¸”éœ€è¦ç­‰å¾…çš„æ¬¡æ•°ï¼Œæ•°å€¼è¶Šå¤§ï¼Œè¯´æ˜Žå­˜åœ¨è¶Šå¤§çš„ç«žäº‰ï¼Œä¼˜åŒ–è¯·æ±‚| Table_open_cache_hits | 0 || Table_open_cache_misses | 0 || Table_open_cache_overflows | 0 |+----------------------------+-------+ å®˜æ–¹æ–‡æ¡£ï¼šhttps://dev.mysql.com/doc/refman/8.0/en/server-status-variables.html ä¸€èˆ¬å»ºè®®ï¼šTable_locks_immediate / Table_locks_waited &gt; 5000ï¼Œå»ºè®®é‡‡ç”¨ InnoDB å¼•æ“Žï¼Œå¦åˆ™ MyISAM å¼•æ“Ž 3. è¡Œé”çš„æ“ä½œmysql é»˜è®¤ä½¿ç”¨ InnoDB å¼•æ“Žï¼Œè€ŒInnoDB ä½¿ç”¨çš„æ˜¯è¡Œé”ï¼Œäº‹åŠ¡é»˜è®¤ä¼šè‡ªåŠ¨æäº¤ï¼Œåˆ†æžè¡Œé”ï¼Œéœ€è¦å…³é—­è‡ªåŠ¨æäº¤ 1set autocommit=0; 3.1 è¯»æ“ä½œ1select * from linelock; ä¸€ä¸ªä¼šè¯å…³è”ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰“å¼€äº†ä¸€ä¸ªä¼šè¯çª—å£ï¼Œå°±æ˜¯å¼€å¯äº†ä¸€ä¸ªäº‹åŠ¡ å…¶ä»–äº‹åŠ¡åœ¨è¯¥äº‹åŠ¡æœŸé—´æäº¤çš„æ•°æ®éƒ½æ˜¯ä¸å¯è§çš„ï¼Œè¿™å°±æ˜¯äº‹åŠ¡é»˜è®¤çº§åˆ«çš„å¯é‡å¤è¯»ï¼Œå°±æ˜¯ä¼šè¯»åˆ°åŽ†å²è®°å½• 3.2 å†™æ“ä½œå½“å‰ä¼šè¯ï¼š 12insert into linelock(name) values(&#x27;7a&#x27;); -- å†™æ“ä½œrollback; -- ç­‰å…¶ä»–ä¼šè¯å†™æ“ä½œåŽ å…¶ä»–ä¼šè¯ï¼š 1select * from linelock; -- å…è®¸è¯»æ“ä½œ æ³¨æ„ï¼šè¯»å½“å‰ä¼šè¯åˆšæ’å…¥çš„æ•°æ®æ—¶å…¶ä»–ä¼šè¯æ˜¯ä¸å¯è§çš„ï¼Œå› ä¸ºæœªæäº¤ 12update linelock set name=&#x27;77&#x27; where id = 8; -- è¡Œä¸Šé”ï¼Œç­‰å¾…å†™æ“ä½œ,ç›´åˆ°å½“å‰ä¼šè¯commit/rollbackupdate linelock set name=&#x27;77&#x27; where id = 6; -- å…¶ä»–è¡Œå…è®¸å†™æ“ä½œ æ€»ç»“ï¼ˆé»˜è®¤å¯é‡å¤è¯»çº§åˆ«ï¼‰ï¼š å½“å‰ä¼šè¯è¯»æ“ä½œï¼Œä¸ä¼šå‡ºçŽ°è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œå¯èƒ½å¯¼è‡´è¯»å–åˆ°åŽ†å²è®°å½• å½“å‰ä¼šè¯å†™æ“ä½œï¼Œå…¶ä»–ä¼šè¯å†™ç­‰å¾…ï¼Œä¼šå‡ºçŽ°ä¸¢å¤±æ›´æ–°ï¼ˆå›žæ»š/è¦†ç›–ï¼‰ã€å¹»è¯» select å°±æ˜¯å¿«ç…§è¯»ï¼Œå¿«ç…§è¯»ä¸åŠ é”ï¼Œä¸ä¼šäº§ç”Ÿå¹»è¯»ï¼ŒMVCC æœºåˆ¶ select for updateã€insertã€updateã€delete éƒ½æ˜¯å½“å‰è¯»ï¼Œå½“å‰è¯»ä¼šäº§ç”Ÿå¹»è¯»ï¼Œæ•°æ®åº“è§’åº¦ä¸ä¼šäº§ç”Ÿä¸¢å¤±æ›´æ–°ï¼Œåº”ç”¨é€»è¾‘ä¼šäº§ç”Ÿä¸¢å¤±æ›´æ–° å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼Œä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡å…ˆæ›´æ–°å¹¶æäº¤ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ç”±äºŽæ˜¯å¿«ç…§è¯»ï¼Œä¼šè¯»åˆ°åŽ†å²æ•°æ®ï¼Œä½†æ›´æ–°æ˜¯å±žäºŽå½“å‰è¯»ï¼Œæ›´æ–°æ¡ä»¶æ˜¯å½“å‰æœ€æ–°æ•°æ®ï¼Œæ‰€ä»¥æ›´æ–°å¤±è´¥ å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼Œä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œä¸¤ä¸ªäº‹åŠ¡åŒæ—¶æ›´æ–°è¯¥æ•°æ®ï¼ŒåŽæ›´æ–°çš„æ•°æ®ä¼šé˜»å¡žï¼Œç›´åˆ°å…ˆæ›´æ–°çš„äº‹åŠ¡æäº¤ï¼ŒåŽä¸€ä¸ªäº‹åŠ¡æ‰ä¼šæ›´æ–°ï¼Œä½†åŽæäº¤çš„äº‹åŠ¡ç”±äºŽå‘ç”Ÿé˜»å¡žï¼Œåˆå› ä¸ºæ›´æ–°æ˜¯å½“å‰è¯»ï¼Œæ‰€ä»¥æ›´æ–°æ¡ä»¶æ˜¯å½“å‰æœ€æ–°æ•°æ®ï¼Œæ›´æ–°å¤±è´¥ 3.3 æŸ¥è¯¢è¡Œé”å°†è‡ªåŠ¨æäº¤å…³é—­ 123456-- ç¬¬ä¸€ç§ æ–¹æ³•set autocommit=0;-- ç¬¬äºŒç§ æ–¹æ³•start transaction;-- ç¬¬ä¸‰ç§ æ–¹æ³•begin; é€šè¿‡ for update ç»™æŸ¥è¯¢ åŠ è¡Œé” 1select * from linklock where id = 2 for update; æ€»ç»“ï¼š å¦‚æžœæŸ¥è¯¢çš„æ•°æ®æ—¶é€šè¿‡ idå¾ˆæ˜Žç¡®çš„ï¼Œåˆ™ä½¿ç”¨çš„æ˜¯ è¡Œé” å¦‚æžœæŸ¥è¯¢æ¡ä»¶ä¸åŒ…å«ä¸»é”®ä¹Ÿä¸æ˜Žç¡®ï¼Œè¿™ä¸ªæ—¶å€™ä¼šé”ä½æ•´ä¸ªè¡¨ï¼Œä½¿ç”¨çš„æ˜¯ next-lock (è¡Œé” + é—´éš™é”) å¦å¤–è¡¥å……: updateã€insertã€delete è¿™ç§æ“ä½œ ä¹Ÿæ˜¯ä½¿ç”¨äº† next-lock æœºåˆ¶ next-lock æœºåˆ¶ åªä¼š è®©å†™æ“ä½œ é”ä½æ•´ä¸ªè¡¨ï¼Œå¯¹äºŽ è¯»æ“ä½œä¸å½±å“ 3.4 åˆ†æžè¡Œé”è¡Œé”åˆ†æžï¼š 1show status like &#x27;%innodb_row_lock%&#x27;; 123456789+-------------------------------+--------+| Variable_name | Value |+-------------------------------+--------+| Innodb_row_lock_current_waits | 0 | -- å½“å‰æ­£åœ¨ç­‰å¾…é”çš„æ•°é‡| Innodb_row_lock_time | 177608 | -- ç­‰å¾…æ€»æ—¶é•¿ï¼Œä»Žç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨ ä¸€å…±ç­‰å¾…çš„æ—¶é—´| Innodb_row_lock_time_avg | 11840 | -- å¹³å‡ç­‰å¾…æ—¶é•¿ï¼Œä»Žç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨å¹³å‡ç­‰å¾…çš„æ—¶é—´| Innodb_row_lock_time_max | 51004 | -- æœ€å¤§ç­‰å¾…æ—¶é•¿ï¼Œä»Žç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨æœ€å¤§ä¸€æ¬¡ç­‰å¾…çš„æ—¶é—´| Innodb_row_lock_waits | 15 | -- ç­‰å¾…æ¬¡æ•°ï¼Œä»Žç³»ç»Ÿå¯åŠ¨åˆ°çŽ°åœ¨ä¸€å…±ç­‰å¾…çš„æ¬¡æ•°+-------------------------------+--------+ 4. å¯é‡å¤è¯»åŽŸç†ç”¨åˆ°çš„åŽŸç†å°±æ˜¯ MVCC (å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶æœºåˆ¶) å…³äºŽ readViewã€undo logã€redo log undo log åŒ…å«ä¸¤ä¸ªéšå«åŸŸï¼šäº‹åŠ¡idå’Œå›žæ»špointï¼ˆæŒ‡å‘undo logï¼‰ï¼Œæ˜¯ä¸€ç§é“¾è¡¨çš„æ•°æ®ç»“æž„ readView åŒ…å«ä¸€ä¸ªäº‹åŠ¡æ•°ç»„ã€æœ€å¤§äº‹åŠ¡idã€æœ€å°äº‹åŠ¡idã€å½“å‰äº‹åŠ¡id å¦‚æžœ trx_id &lt; min_trx_idï¼Œåˆ™è¯´æ˜Žè¯¥ç‰ˆæœ¬å¯¹äºŽå½“å‰äº‹åŠ¡(read view)æ¥è¯´ï¼Œæ˜¯å·²æäº¤äº‹åŠ¡ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå¯¹äºŽå½“å‰äº‹åŠ¡å¯è§ã€‚ å¦‚æžœtrx_id &gt;= max_trx_idï¼šåˆ™è¯´æ˜Žè¯¥ç‰ˆæœ¬å¯¹äºŽå½“å‰äº‹åŠ¡(read view)æ¥è¯´ï¼Œæ˜¯â€å°†æ¥â€çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå¯¹äºŽå½“å‰äº‹åŠ¡ä¸å¯è§ã€‚ å¦‚æžœmin_trx_id &lt;= trx_id &lt; max_trx_idï¼š å¦‚æžœtrx_idåœ¨read viewçš„æ´»è·ƒäº‹åŠ¡idåˆ—è¡¨ä¸­ï¼Œåˆ™è¯´æ˜Žè¯¥ç‰ˆæœ¬å¯¹äºŽå½“å‰äº‹åŠ¡(read view)æ¥è¯´ï¼Œæ˜¯å·²å¼€å§‹ä½†æœªæäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå¯¹äºŽå½“å‰äº‹åŠ¡ä¸å¯è§ã€‚ å¦‚æžœtrx_idä¸åœ¨read viewçš„æ´»è·ƒäº‹åŠ¡idåˆ—è¡¨ä¸­ï¼Œåˆ™è¯´æ˜Žè¯¥ç‰ˆæœ¬å¯¹äºŽå½“å‰äº‹åŠ¡(read view)æ¥è¯´ï¼Œæ˜¯å·²æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆå¯¹äºŽå½“å‰äº‹åŠ¡å¯è§ã€‚ ä¸‰ã€ æ…¢æŸ¥è¯¢æ—¥å¿—å’Œæµ·é‡æ•°æ®åˆ†æžMySQLæä¾›ä¸€ç§æ—¥å¿—è®°å½•ï¼Œç”¨äºŽè®°å½•MYSQL å“åº”æ—¶é—´è¶…è¿‡é˜ˆå€¼çš„SQL è¯­å¥ (slow_query_log) 1. æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šæ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤å…³é—­ï¼Œå»ºè®®ï¼šå¼€å‘è°ƒä¼˜æ—¶æ‰“å¼€ï¼Œæœ€ç»ˆéƒ¨ç½²æ—¶å…³é—­ 1.1 å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šæ£€æŸ¥æ˜¯å¦å¼€å¯äº† æ…¢æŸ¥è¯¢æ—¥å¿—ï¼šshow variables like â€˜slow_query_logâ€™ ä¸´æ—¶å¼€å¯ï¼šset global slow_query_log = 1 æ°¸ä¹…å¼€å¯ï¼š/etc/my.cnf ä¸­è¿½åŠ é…ç½®ï¼š 1234vim /etc/my.cnf[mysqld]slow_query_log=1slow_query_log_file=/var/lib/mysql/localhost-slow.log 1.2 è®¾ç½®æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼š ä¸´æ—¶è®¾ç½®é˜ˆå€¼ï¼šset global long_query_time=5 æ°¸ä¹…è®¾ç½®é˜ˆå€¼ï¼š/etc/my.cnf ä¸­è¿½åŠ é…ç½®ï¼š 123vim /etc/my.cnf[mysqld]long_query_time=3 1.3 æŸ¥è¯¢è¶…è¿‡é˜ˆå€¼sqlæŸ¥è¯¢è¶…è¿‡é˜ˆå€¼çš„SQLæ•°ï¼šshow global status like â€˜%slow_queries%â€™; æŸ¥è¯¢æ…¢æŸ¥è¯¢çš„sql: cat /var/lib/mysql/localhost-slow.log é€šè¿‡mysqldumpslowå·¥å…·æŸ¥è¯¢æ…¢sql sï¼šæŽ’åºæ–¹å¼ rï¼šé€†åº lï¼šé”å®šæ—¶é—´ gï¼šæ­£åˆ™åŒ¹é…æ¨¡å¼ 123456-- èŽ·å–è¿”å›žè®°å½•æœ€å¤šçš„ 3 ä¸ªsqlmysqldumslow -s r -t 3 /var/lib/myqsl/localhost-slow.log-- èŽ·å–è®¿é—®æ¬¡æ•°æœ€å¤šçš„ 3 ä¸ªsqlmysqldumslow -s c -t 3 /var/lib/myqsl/localhost-slow.log-- æŒ‰ç…§æ—¶é—´æŽ’åºï¼Œå‰10æ¡åŒ…å« left join æŸ¥è¯¢è¯­å¥çš„ SQLmysqldumslow -s t -t 10 -g &quot;left join&quot; /var/lib/myqsl/localhost-slow.log 2. æµ·é‡æ•°æ®åˆ†æž2.1 è§£å†³å¼€å¯è¿‡ç¨‹å‡½æ•°ä¸Žæ…¢æŸ¥è¯¢æ—¥å¿—å†²çªï¼š ä¸´æ—¶è§£å†³ï¼šset global log_bin_trust_function_creators=1 æ°¸ä¹…è§£å†³ï¼š/etc/my.cnf ä¸­è¿½åŠ é…ç½®ï¼š 123vim /etc/my.cnf[mysqld]log_bin_trust_function_creators=1 2.2 ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹æ’å…¥æµ·é‡å…ƒç´ ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061create table dept( dno int(5) primary key default 0, dname varchar(20) not null default &#x27;&#x27;, loc varchar(30) default &#x27;&#x27;) engine=innodb default charset=utf8;create table emp( eid int(5) primary key, ename varchar(20) not null default &#x27;&#x27;, job varchar(20) not null default &#x27;&#x27;, deptno int(5) not null default 0) engine=innodb default charset=utf8;delimiter $create function randstring(n int) returns varchar(255)begin declare all_str varchar(100) default &#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIZKLMNOPQRSTUVWXYZ&#x27;; declare return_str varchar(255) default &#x27;&#x27;; declare i int default 0; while i &lt; n do set return_str = concat(return_str, substring(all_str, floor(1+rand()*52), 1)); set i = i+1; end while; return return_str;end $create function rand_num() returns INT(5)begin declare i int default 0; set i = floor(rand()*100); return i;end $create procedure insert_emp(in eid_start int(10), in data_times int(10))begin declare i int default 0; set autocommit = 0; repeat insert into emp values(eid_start + i,randstring(5),&#x27;other&#x27;,ran_num()); set i = i+1; until i=data_times end repeat; commit;end $create procedure insert_dept(in dno_start int(10), in data_times int(10))begin declare i int default 0; set autocommit = 0; repeat insert into dept values(dno_start + i,randstring(6), randstring(8)); set i = i+1; until i=data_times end repeat; commit;end $call insert_emp(1000,800000);call insert_dept(10,30); 2.3 åˆ†æžæµ·é‡æ•°æ®ï¼šprofilesshow variables like â€˜%profiling%â€™; set profiling = on ï¼ˆ1ï¼‰profiles show profiles; â€“ è®°å½•æ‰€æœ‰ profiling æ‰“å¼€ä¹‹åŽçš„ï¼Œ å…¨éƒ¨SQL æŸ¥è¯¢è¯­å¥æ‰€èŠ±è´¹çš„æ—¶é—´ ï¼ˆ2ï¼‰ç²¾ç¡®åˆ†æžï¼šsqlè¯Šæ–­ 12show profile all for query [ä¸Šä¸€æ­¥æŸ¥è¯¢çš„ Query_id]show profile cpu,block io for query 2; ï¼ˆ3ï¼‰å…¨å±€æŸ¥è¯¢æ—¥å¿—ï¼šè®°å½•å¼€å¯ä¹‹åŽçš„ å…¨éƒ¨ Sql è¯­å¥ å…¨å±€çš„è®°å½•æ“ä½œ ï¼Œä»…ä»…åœ¨è°ƒä¼˜ã€å¼€å‘è¿‡ç¨‹ä¸­æ‰“å¼€ï¼Œéƒ¨ç½²ä¸€å®šå…³é—­ show variables like â€˜%general_log%â€™ å…¨å±€æ—¥å¿—ä¿å­˜åˆ°è¡¨ï¼š 12set global general_log = 1 -- å¼€å¯å…¨å±€æ—¥å¿—set global log_output=&#x27;table&#x27; å¼€å¯åŽï¼Œä¼šè¢«è®°å½•åˆ° mysql_general_log è¡¨ä¸­ å…¨å±€æ—¥å¿—ä¿å­˜ï¼š 123set global general_log = 1 -- å¼€å¯å…¨å±€æ—¥å¿—set global log_output=&#x27;file&#x27; set global general_log_file=&#x27;/tmp/general.log&#x27; å¼€å¯åŽï¼Œä¼šè¢«è®°å½•åˆ°æ–‡ä»¶/tmp/general.logä¸­","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"MySQLã€æ•°æ®åº“","slug":"MySQLã€æ•°æ®åº“","permalink":"http://fyupeng.github.io/tags/MySQL%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"fyupeng"},{"title":"jucåŽŸç†","slug":"JUCåŽŸç†","date":"2022-06-25T07:17:34.000Z","updated":"2022-06-25T07:22:42.638Z","comments":true,"path":"2022/06/25/JUCåŽŸç†/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/JUC%E5%8E%9F%E7%90%86/","excerpt":"","text":"ä¸€ã€Java çº¿ç¨‹1.åˆ›å»ºå’Œè¿è¡Œçº¿ç¨‹ ç›´æŽ¥ä½¿ç”¨Threadå¼€å¯çº¿ç¨‹ 123456// åˆ›å»ºçº¿ç¨‹å¯¹è±¡Thread t = new Thread() &#123; public void run() &#123; // è¦æ‰§è¡Œçš„ä»»åŠ¡ &#125;&#125;; ä¾‹å¦‚ï¼š 1234567891011// å¯åŠ¨çº¿ç¨‹t.start();// æž„é€ æ–¹æ³•çš„å‚æ•°æ˜¯ç»™çº¿ç¨‹æŒ‡å®šåå­—ï¼ŒæŽ¨èThread t1 = new Thread(&quot;t1&quot;) &#123; @Override // run æ–¹æ³•å†…å®žçŽ°äº†è¦æ‰§è¡Œçš„ä»»åŠ¡ public void run() &#123; log.debug(&quot;hello&quot;); &#125;&#125;;t1.start(); è¾“å‡ºï¼š 119:19:00 [t1] c.ThreadStarter - hello ä½¿ç”¨Runnableé…åˆThread 123456789Runnable runnable = new Runnable() &#123; public void run()&#123; // è¦æ‰§è¡Œçš„ä»»åŠ¡ &#125;&#125;;// åˆ›å»ºçº¿ç¨‹å¯¹è±¡Thread t = new Thread( runnable );// å¯åŠ¨çº¿ç¨‹t.start() ä¾‹å¦‚ï¼š 12345678910// åˆ›å»ºä»»åŠ¡å¯¹è±¡Runnable task2 = new Runnable() &#123; @Override public void run() &#123; log.debug(&quot;hello&quot;); &#125;&#125;;// å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼ŒæŽ¨èThread t2 = new Thread(task2, &quot;t2&quot;);t2.start(); è¾“å‡ºï¼š 119:19:00 [t2] c.ThreadStarter - hello Java 8 ä»¥åŽå¯ä»¥ä½¿ç”¨ lambda ç²¾ç®€ä»£ç  1234Runnable task2 = () -&gt; log.debug(&quot;hello&quot;);// å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼ŒæŽ¨èThread t2 = new Thread(task2, &quot;t2&quot;);t2.start(); Threadä¸ŽRunnableçš„å…³ç³»ï¼š ï¼ˆ1ï¼‰ç”¨Runableæ›´å®¹æ˜“ä¸Žçº¿ç¨‹æ± é«˜çº§APIé…åˆ ï¼ˆ2ï¼‰é…åˆRunnableè®©ä»»åŠ¡ç±»è„±ç¦»äº†Threadç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´» ä½¿ç”¨FutureTaské…åˆThread FutureTask èƒ½å¤ŸæŽ¥æ”¶ Callable ç±»åž‹çš„å‚æ•°ï¼Œç”¨æ¥å¤„ç†æœ‰è¿”å›žç»“æžœçš„æƒ…å†µ 12345678910// åˆ›å»ºä»»åŠ¡å¯¹è±¡FutureTask&lt;Integer&gt; task3 = new FutureTask&lt;&gt;(() -&gt; &#123; log.debug(&quot;hello&quot;); return 100;&#125;);// å‚æ•°1 æ˜¯ä»»åŠ¡å¯¹è±¡; å‚æ•°2 æ˜¯çº¿ç¨‹åå­—ï¼ŒæŽ¨ènew Thread(task3, &quot;t3&quot;).start();// ä¸»çº¿ç¨‹é˜»å¡žï¼ŒåŒæ­¥ç­‰å¾… task æ‰§è¡Œå®Œæ¯•çš„ç»“æžœInteger result = task3.get();log.debug(&quot;ç»“æžœæ˜¯:&#123;&#125;&quot;, result); è¾“å‡º 1219:22:27 [t3] c.ThreadStarter - hello19:22:27 [main] c.ThreadStarter - ç»“æžœæ˜¯:100 2.è§‚å¯Ÿå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œä¸»è¦æ˜¯ç†è§£ äº¤æ›¿æ‰§è¡Œ è°å…ˆè°åŽï¼Œä¸ç”±æˆ‘ä»¬æŽ§åˆ¶ 3.æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹çš„æ–¹æ³•windows ä»»åŠ¡ç®¡ç†å™¨å¯ä»¥æŸ¥çœ‹è¿›ç¨‹å’Œçº¿ç¨‹æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æ€æ­»è¿› tasklist æŸ¥çœ‹è¿›ç¨‹ taskkill æ€æ­»è¿›ç¨‹ linux ps -fe æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ ps -fT -p æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹ kill æ€æ­»è¿›ç¨‹ top æŒ‰å¤§å†™ H åˆ‡æ¢æ˜¯å¦æ˜¾ç¤ºçº¿ç¨‹ top -H -p æŸ¥çœ‹æŸä¸ªè¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹ Java jps å‘½ä»¤æŸ¥çœ‹æ‰€æœ‰ Java è¿›ç¨‹ jstack æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ï¼ˆPIDï¼‰çš„æ‰€æœ‰çº¿ç¨‹çŠ¶æ€ jconsole æ¥æŸ¥çœ‹æŸä¸ª Java è¿›ç¨‹ä¸­çº¿ç¨‹çš„è¿è¡Œæƒ…å†µï¼ˆå›¾å½¢ç•Œé¢ï¼‰jconsole è¿œç¨‹ç›‘æŽ§é…ç½® éœ€è¦ä»¥å¦‚ä¸‹æ–¹å¼è¿è¡Œä½ çš„ java ç±»1java -Djava.rmi.server.hostname=`ipåœ°å€` -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.port=`è¿žæŽ¥ç«¯å£` -Dcom.sun.management.jmxremote.ssl=æ˜¯å¦å®‰å…¨è¿žæŽ¥ -Dcom.sun.management.jmxremote.authenticate=æ˜¯å¦è®¤è¯ javaç±» ä¿®æ”¹ /etc/hosts æ–‡ä»¶å°† 127.0.0.1 æ˜ å°„è‡³ä¸»æœºå å¦‚æžœè¦è®¤è¯è®¿é—®ï¼Œè¿˜éœ€è¦åšå¦‚ä¸‹æ­¥éª¤ å¤åˆ¶ jmxremote.password æ–‡ä»¶ ä¿®æ”¹ jmxremote.password å’Œ jmxremote.access æ–‡ä»¶çš„æƒé™ä¸º 600 å³æ–‡ä»¶æ‰€æœ‰è€…å¯è¯»å†™ è¿žæŽ¥æ—¶å¡«å…¥ controlRoleï¼ˆç”¨æˆ·åï¼‰ï¼ŒR&amp;Dï¼ˆå¯†ç ï¼‰ 4.æ ˆä¸Žæ ˆå¸§Java Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰æˆ‘ä»¬éƒ½çŸ¥é“ JVM ä¸­ç”±å †ã€æ ˆã€æ–¹æ³•åŒºæ‰€ç»„æˆï¼Œå…¶ä¸­æ ˆå†…å­˜æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿå…¶å®žå°±æ˜¯çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åŽï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—æ ˆå†…å­˜ã€‚ æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜ æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³• 5.çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰å› ä¸ºä»¥ä¸‹ä¸€äº›åŽŸå› å¯¼è‡´ cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç  çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ åžƒåœ¾å›žæ”¶ æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³• å½“ Context Switch å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µ å°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„ çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›žåœ°å€ç­‰ Context Switch é¢‘ç¹å‘ç”Ÿä¼šå½±å“æ€§èƒ½ 6.å¸¸è§æ–¹æ³• æ–¹æ³•å static åŠŸèƒ½è¯´æ˜Ž æ³¨æ„ start() å¯åŠ¨ä¸€ä¸ªæ–°çº¿ ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹ è¿è¡Œ run æ–¹æ³• ä¸­çš„ä»£ç ï¼Œçº¿ç¨‹ä¹‹é—´å¹¶è¡Œ start æ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç ä¸ä¸€å®šç«‹åˆ» è¿è¡Œï¼ˆCPU çš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„ startæ–¹æ³•åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æžœè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºçŽ° IllegalThreadStateException run() æ–°çº¿ç¨‹å¯åŠ¨åŽä¼š è°ƒç”¨çš„æ–¹æ³•ï¼Œçº¿ç¨‹ä¹‹é—´ä¸²è¡Œ å¦‚æžœåœ¨æž„é€  Thread å¯¹è±¡æ—¶ä¼ é€’äº† Runnable å‚æ•°ï¼Œåˆ™ çº¿ç¨‹å¯åŠ¨åŽä¼šè°ƒç”¨ Runnable ä¸­çš„ run æ–¹æ³•ï¼Œå¦åˆ™é»˜ è®¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»º Thread çš„å­ç±»å¯¹è±¡ï¼Œ æ¥è¦†ç›–é»˜è®¤è¡Œä¸º join() ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ join(long n) ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“ æŸ,æœ€å¤šç­‰å¾… n æ¯«ç§’ getId() èŽ·å–çº¿ç¨‹é•¿æ•´åž‹ çš„ id id å”¯ä¸€ getName() èŽ·å–çº¿ç¨‹å setName(String) ä¿®æ”¹çº¿ç¨‹å getPriority() èŽ·å–çº¿ç¨‹ä¼˜å…ˆçº§ setPriority(int) ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§ javaä¸­è§„å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯1~10 çš„æ•´æ•°ï¼Œè¾ƒå¤§çš„ä¼˜å…ˆçº§ èƒ½æé«˜è¯¥çº¿ç¨‹è¢« CPU è°ƒåº¦çš„æœºçŽ‡ getState() èŽ·å–çº¿ç¨‹çŠ¶æ€ Java ä¸­çº¿ç¨‹çŠ¶æ€æ˜¯ç”¨ 6 ä¸ª enum è¡¨ç¤ºï¼Œåˆ†åˆ«ä¸ºï¼š NEW, RUNNABLE, BLOCKED, WAITING, TIMED_WAITING, TERMINATED isInterrupted() åˆ¤æ–­æ˜¯å¦è¢«æ‰“ æ–­ï¼Œ ä¸ä¼šæ¸…é™¤ æ‰“æ–­æ ‡è®° isAlive() çº¿ç¨‹æ˜¯å¦å­˜æ´» ï¼ˆè¿˜æ²¡æœ‰è¿è¡Œå®Œ æ¯•ï¼‰ interrupt() æ‰“æ–­çº¿ç¨‹ å¦‚æžœè¢«æ‰“æ–­çº¿ç¨‹æ­£åœ¨ sleepï¼Œwaitï¼Œjoin ä¼šå¯¼è‡´è¢«æ‰“æ–­ çš„çº¿ç¨‹æŠ›å‡º InterruptedExceptionï¼Œå¹¶æ¸…é™¤ ï¼›å¦‚æžœæ‰“æ–­çš„æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œä¸ä¼šæ¸…é™¤ ï¼›park çš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼šè®¾ç½® æ‰“æ–­æ ‡è®°ï¼Œä¸ä¼šæ¸…é™¤ interrupted() static åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯ å¦è¢«æ‰“æ–­ ä¼šæ¸…é™¤ æ‰“æ–­æ ‡è®° currentThread() static èŽ·å–å½“å‰æ­£åœ¨æ‰§ è¡Œçš„çº¿ç¨‹ sleep(long n) static è®©å½“å‰æ‰§è¡Œçš„çº¿ ç¨‹ä¼‘çœ næ¯«ç§’ï¼Œ ä¼‘çœ æ—¶è®©å‡º cpu çš„æ—¶é—´ç‰‡ç»™å…¶å®ƒ çº¿ç¨‹ yield() static æç¤ºçº¿ç¨‹è°ƒåº¦å™¨ è®©å‡ºå½“å‰çº¿ç¨‹å¯¹ CPUçš„ä½¿ç”¨ ä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•å’Œè°ƒè¯• 6.1 start ä¸Ž runè°ƒç”¨run1234567891011public static void main(String[] args) &#123; Thread t1 = new Thread(&quot;t1&quot;) &#123; @Override public void run() &#123; log.debug(Thread.currentThread().getName()); FileReader.read(Constants.MP4_FULL_PATH); &#125; &#125;; t1.run(); log.debug(&quot;do other things ...&quot;);&#125; è¾“å‡º 123419:39:14 [main] c.TestStart - main19:39:14 [main] c.FileReader - read [1.mp4] start ...19:39:18 [main] c.FileReader - read [1.mp4] end ... cost: 4227 ms19:39:18 [main] c.TestStart - do other things ... ç¨‹åºä»åœ¨ main çº¿ç¨‹è¿è¡Œï¼Œ FileReader.read()æ–¹æ³•è°ƒç”¨è¿˜æ˜¯åŒæ­¥çš„ è°ƒç”¨ startå°†ä¸Šè¿°ä»£ç çš„ t1.run() æ”¹ä¸º 1t1.start(); è¾“å‡º 1234519:39:14 [main] c.TestStart - main19:39:14 [main] c.FileReader - read [1.mp4] start ...19:39:18 [main] c.FileReader - read [1.mp4] end ... cost: 4227 ms19:39:18 [main] c.TestStart - do other things ...t1.start(); ç¨‹åºåœ¨ t1 çº¿ç¨‹è¿è¡Œï¼Œ FileReader.read() æ–¹æ³•è°ƒç”¨æ˜¯å¼‚æ­¥çš„ å°ç»“ ç›´æŽ¥è°ƒç”¨ run æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œäº† runï¼Œæ²¡æœ‰å¯åŠ¨æ–°çš„çº¿ç¨‹ ä½¿ç”¨ start æ˜¯å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œé€šè¿‡æ–°çš„çº¿ç¨‹é—´æŽ¥æ‰§è¡Œ run ä¸­çš„ä»£ç  6.2 sleep ä¸Ž yieldsleep è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä»Ž Running è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡žï¼‰ å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ interrupt æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException ç¡çœ ç»“æŸåŽçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ å»ºè®®ç”¨ TimeUnit çš„ sleep ä»£æ›¿ Thread çš„ sleep æ¥èŽ·å¾—æ›´å¥½çš„å¯è¯»æ€§ yield è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä»Ž Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€ï¼Œç„¶åŽè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹ å…·ä½“çš„å®žçŽ°ä¾èµ–äºŽæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨ çº¿ç¨‹ä¼˜å…ˆçº§ çº¿ç¨‹ä¼˜å…ˆçº§ä¼šæç¤ºï¼ˆhintï¼‰è°ƒåº¦å™¨ä¼˜å…ˆè°ƒåº¦è¯¥çº¿ç¨‹ï¼Œä½†å®ƒä»…ä»…æ˜¯ä¸€ä¸ªæç¤ºï¼Œè°ƒåº¦å™¨å¯ä»¥å¿½ç•¥å®ƒ å¦‚æžœ cpu æ¯”è¾ƒå¿™ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šèŽ·å¾—æ›´å¤šçš„æ—¶é—´ç‰‡ï¼Œä½† cpu é—²æ—¶ï¼Œä¼˜å…ˆçº§å‡ ä¹Žæ²¡ä½œç”¨ 12345678910111213141516171819Runnable task1 = () -&gt; &#123; int count = 0; for (;;) &#123; System.out.println(&quot;----&gt;1 &quot; + count++); &#125;&#125;;Runnable task2 = () -&gt; &#123; int count = 0; for (;;) &#123; // Thread.yield(); System.out.println(&quot; ----&gt;2 &quot; + count++); &#125;&#125;;Thread t1 = new Thread(task1, &quot;t1&quot;);Thread t2 = new Thread(task2, &quot;t2&quot;);// t1.setPriority(Thread.MIN_PRIORITY);// t2.setPriority(Thread.MAX_PRIORITY);t1.start();t2.start(); 6.3 joinæ–¹æ³•ä¸ºä»€ä¹ˆéœ€è¦ joinä¸‹é¢çš„ä»£ç æ‰§è¡Œï¼Œæ‰“å° r æ˜¯ä»€ä¹ˆï¼Ÿ 12345678910111213141516static int r = 0;public static void main(String[] args) throws InterruptedException &#123; test1();&#125;private static void test1() throws InterruptedException &#123; log.debug(&quot;å¼€å§‹&quot;); Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;å¼€å§‹&quot;); sleep(1); log.debug(&quot;ç»“æŸ&quot;); r = 10; &#125;); t1.start(); log.debug(&quot;ç»“æžœä¸º:&#123;&#125;&quot;, r); log.debug(&quot;ç»“æŸ&quot;);&#125; åˆ†æž å› ä¸ºä¸»çº¿ç¨‹å’Œçº¿ç¨‹ t1 æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œt1 çº¿ç¨‹éœ€è¦ 1 ç§’ä¹‹åŽæ‰èƒ½ç®—å‡º r=10 è€Œä¸»çº¿ç¨‹ä¸€å¼€å§‹å°±è¦æ‰“å° r çš„ç»“æžœï¼Œæ‰€ä»¥åªèƒ½æ‰“å°å‡º r=0 è§£å†³æ–¹æ³• ç”¨ sleep è¡Œä¸è¡Œï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ ç”¨ joinï¼ŒåŠ åœ¨ t1.start() ä¹‹åŽå³å¯ ç­‰å¾…å¤šä¸ªç»“æžœé—®ï¼Œä¸‹é¢ä»£ç  cost å¤§çº¦å¤šå°‘ç§’ï¼Ÿ 12345678910111213141516171819202122static int r1 = 0;static int r2 = 0;public static void main(String[] args) throws InterruptedException &#123;test2();&#125;private static void test2() throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; sleep(1); r1 = 10; &#125;); Thread t2 = new Thread(() -&gt; &#123; sleep(2); r2 = 20; &#125;); long start = System.currentTimeMillis(); t1.start(); t2.start(); t1.join(); t2.join(); long end = System.currentTimeMillis(); log.debug(&quot;r1: &#123;&#125; r2: &#123;&#125; cost: &#123;&#125;&quot;, r1, r2, end - start);&#125; åˆ†æžå¦‚ä¸‹ ç¬¬ä¸€ä¸ª joinï¼šç­‰ å¾… t1 æ—¶, t2 å¹¶æ²¡æœ‰åœæ­¢, è€Œåœ¨è¿è¡Œ ç¬¬äºŒä¸ª joinï¼š1s åŽ, æ‰§è¡Œåˆ°æ­¤, t2 ä¹Ÿè¿è¡Œäº† 1s, å› æ­¤ä¹Ÿåªéœ€å†ç­‰å¾… 1s å¦‚æžœé¢ å€’ä¸¤ä¸ª join å‘¢ï¼Ÿæœ€ç»ˆéƒ½æ˜¯è¾“å‡º 120:45:43.239 [main] c.TestJoin - r1: 10 r2: 20 cost: 2005 æœ‰æ—¶æ•ˆçš„ joinç­‰å¤Ÿæ—¶é—´ 1234567891011121314151617static int r1 = 0;static int r2 = 0;public static void main(String[] args) throws InterruptedException &#123; test3();&#125;public static void test3() throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; sleep(1); r1 = 10; &#125;); long start = System.currentTimeMillis(); t1.start(); // çº¿ç¨‹æ‰§è¡Œç»“æŸä¼šå¯¼è‡´ join ç»“æŸ t1.join(1500); long end = System.currentTimeMillis(); log.debug(&quot;r1: &#123;&#125; r2: &#123;&#125; cost: &#123;&#125;&quot;, r1, r2, end - start);&#125; è¾“å‡º 120:48:01.320 [main] c.TestJoin - r1: 10 r2: 0 cost: 1010 æ²¡ç­‰å¤Ÿæ—¶é—´ 1234567891011121314151617static int r1 = 0;static int r2 = 0;public static void main(String[] args) throws InterruptedException &#123; test3();&#125;public static void test3() throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; sleep(2); r1 = 10; &#125;); long start = System.currentTimeMillis(); t1.start(); // çº¿ç¨‹æ‰§è¡Œç»“æŸä¼šå¯¼è‡´ join ç»“æŸ t1.join(1500); long end = System.currentTimeMillis(); log.debug(&quot;r1: &#123;&#125; r2: &#123;&#125; cost: &#123;&#125;&quot;, r1, r2, end - start);&#125; è¾“å‡º 120:52:15.623 [main] c.TestJoin - r1: 0 r2: 0 cost: 1502 6.4 interrupt æ–¹æ³•æ‰“æ–­ sleepï¼Œwaitï¼Œjoin çš„çº¿ç¨‹è¿™å‡ ä¸ªæ–¹æ³•éƒ½ä¼šè®©çº¿ç¨‹è¿›å…¥é˜»å¡žçŠ¶æ€æ‰“æ–­ sleep çš„çº¿ç¨‹, ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ï¼Œä»¥ sleep ä¸ºä¾‹ 1234567891011121314151617181920Thread t1 = new Thread(()-&gt; &#123; //sleep(1); //try &#123; // Thread.currentThread().join(); //&#125; catch (InterruptedException e) &#123; // e.printStackTrace(); //&#125; try &#123; Thread.currentThread().wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;, &quot;t1&quot;);t1.start();sleep(0.5);t1.interrupt();log.debug(&quot; æ‰“æ–­çŠ¶æ€: &#123;&#125;&quot;, t1.isInterrupted()); è¾“å‡º sleepï¼š 12345678java.lang.InterruptedException: sleep interruptedat java.lang.Thread.sleep(Native Method)at java.lang.Thread.sleep(Thread.java:340)at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:386)at cn.itcast.n2.util.Sleeper.sleep(Sleeper.java:8)at cn.itcast.n4.TestInterrupt.lambda$test1$3(TestInterrupt.java:59)at java.lang.Thread.run(Thread.java:745)21:18:10.374 [main] c.TestInterrupt - æ‰“æ–­çŠ¶æ€: false waitï¼š 123456Exception in thread &quot;t1&quot; java.lang.IllegalMonitorStateException at java.lang.Object.wait(Native Method) at java.lang.Object.wait(Object.java:502) at cn.itcast.test.Test.lambda$main$0(Test.java:30) at java.lang.Thread.run(Thread.java:748)15:37:32.974 c.Test [main] - æ‰“æ–­çŠ¶æ€: false joinï¼š 1234567java.lang.InterruptedException at java.lang.Object.wait(Native Method) at java.lang.Thread.join(Thread.java:1252) at java.lang.Thread.join(Thread.java:1326) at cn.itcast.test.Test.lambda$main$0(Test.java:25) at java.lang.Thread.run(Thread.java:748)15:46:22.178 c.Test [main] - æ‰“æ–­çŠ¶æ€: false æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹, ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ 12345678910111213141516private static void test2() throws InterruptedException &#123; Thread t2 = new Thread(()-&gt;&#123; while(true) &#123; Thread current = Thread.currentThread(); boolean interrupted = current.isInterrupted(); if(interrupted) &#123; log.debug(&quot; æ‰“æ–­çŠ¶æ€: &#123;&#125;&quot;, interrupted); break; &#125; &#125; &#125;, &quot;t2&quot;); t2.start(); sleep(0.5); t2.interrupt();&#125; è¾“å‡º 120:57:37.964 [t2] c.TestInterrupt - æ‰“æ–­çŠ¶æ€: true æ‰“æ–­ park çº¿ç¨‹æ‰“æ–­ park çº¿ç¨‹, ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ 1234567891011private static void test3() throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;park...&quot;); LockSupport.park(); log.debug(&quot;unpark...&quot;); log.debug(&quot;æ‰“æ–­çŠ¶æ€ï¼š&#123;&#125;&quot;, Thread.currentThread().isInterrupted()); &#125;, &quot;t1&quot;); t1.start(); sleep(0.5); t1.interrupt();&#125; è¾“å‡º 12321:11:52.795 [t1] c.TestInterrupt - park...21:11:53.295 [t1] c.TestInterrupt - unpark...21:11:53.295 [t1] c.TestInterrupt - æ‰“æ–­çŠ¶æ€ï¼štrue å¦‚æžœæ‰“æ–­æ ‡è®°å·²ç»æ˜¯ true, åˆ™ park ä¼šå¤±æ•ˆ 123456789101112131415161718private static void test4() &#123; Thread t1 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 5; i++) &#123; log.debug(&quot;park...&quot;); LockSupport.park(); log.debug(&quot;æ‰“æ–­çŠ¶æ€ï¼š&#123;&#125;&quot;, Thread.currentThread().isInterrupted()); &#125; // æ¸…é™¤ æ‰“æ–­æ ‡è®°ï¼Œå³ è®¾ç½®ä¸º false Thread.interrupted(); log.debug(&quot;æ‰“æ–­çŠ¶æ€ï¼š&#123;&#125;&quot;, Thread.currentThread().isInterrupted()); log.debug(&quot;park...&quot;); LockSupport.park(); log.debug(&quot;æ‰“æ–­çŠ¶æ€ï¼š&#123;&#125;&quot;, Thread.currentThread().isInterrupted()); &#125;); t1.start(); sleep(1); t1.interrupt();&#125; è¾“å‡º 1234567891011121315:54:57.684 c.Test [Thread-0] - park...15:54:58.692 c.Test [Thread-0] - æ‰“æ–­çŠ¶æ€ï¼štrue15:54:58.696 c.Test [Thread-0] - park...15:54:58.696 c.Test [Thread-0] - æ‰“æ–­çŠ¶æ€ï¼štrue15:54:58.696 c.Test [Thread-0] - park...15:54:58.696 c.Test [Thread-0] - æ‰“æ–­çŠ¶æ€ï¼štrue15:54:58.696 c.Test [Thread-0] - park...15:54:58.696 c.Test [Thread-0] - æ‰“æ–­çŠ¶æ€ï¼štrue15:54:58.696 c.Test [Thread-0] - park...15:54:58.696 c.Test [Thread-0] - æ‰“æ–­çŠ¶æ€ï¼štrue15:54:58.696 c.Test [Thread-0] - æ‰“æ–­çŠ¶æ€ï¼šfalse15:54:58.696 c.Test [Thread-0] - park...# è¿˜æœ‰ ä¸‹ä¸€å¥æ‰“æ–­æ ‡è®°æ²¡æ‰“å°å‡ºæ¥ï¼Œæ­¤æ—¶å·²æ¢å¤ park åŠŸèƒ½ æç¤ºå¯ä»¥ä½¿ç”¨ Thread.interrupted() æ¸…é™¤æ‰“æ–­çŠ¶æ€ æ€»ç»“ï¼šå¤„äºŽsleepã€joinã€wait çŠ¶æ€çš„çº¿ç¨‹ ä½¿ç”¨ interrupt() ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®° Thread.currentThread().isInterrupted()) å¤„äºŽparkå’Œ run çš„çº¿ç¨‹ï¼Œä½¿ç”¨ interrupt()ä¸ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®° Thread.currentThread().isInterrupted()) parkçº¿ç¨‹ è°ƒç”¨ interrupt()åŽï¼Œè¯¥çº¿ç¨‹åŽé¢å†ä½¿ç”¨çš„ parkä¼šå¤±æ•ˆï¼Œéœ€è¦ä½¿ç”¨ Thread.interrupted() æ¢å¤park ä¸ºæœ‰æ•ˆ 6.5 ä¸æŽ¨èçš„æ–¹æ³•è¿˜æœ‰ä¸€äº›ä¸æŽ¨èä½¿ç”¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å·²è¿‡æ—¶ï¼Œå®¹æ˜“ç ´ååŒæ­¥ä»£ç å—ï¼Œé€ æˆçº¿ç¨‹æ­»é” æ–¹æ³•å static åŠŸèƒ½è¯´æ˜Ž stop() åœæ­¢çº¿ç¨‹è¿è¡Œ suspend() æŒ‚èµ·ï¼ˆæš‚åœï¼‰çº¿ç¨‹è¿è¡Œ resume() æ¢å¤çº¿ç¨‹è¿è¡Œ 7. ä¸»çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹é»˜è®¤æƒ…å†µä¸‹ï¼ŒJava è¿›ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œç»“æŸï¼Œæ‰ä¼šç»“æŸã€‚æœ‰ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹å«åšå®ˆæŠ¤çº¿ç¨‹ï¼Œåªè¦å…¶å®ƒéžå®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸäº†ï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¼šå¼ºåˆ¶ç»“æŸã€‚ä¾‹ï¼š 1234567891011log.debug(&quot;å¼€å§‹è¿è¡Œ...&quot;);Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;å¼€å§‹è¿è¡Œ...&quot;); sleep(2); log.debug(&quot;è¿è¡Œç»“æŸ...&quot;);&#125;, &quot;daemon&quot;);// è®¾ç½®è¯¥çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹t1.setDaemon(true);t1.start();sleep(1);log.debug(&quot;è¿è¡Œç»“æŸ...&quot;); è¾“å‡º 12308:26:38.123 [main] c.TestDaemon - å¼€å§‹è¿è¡Œ...08:26:38.213 [daemon] c.TestDaemon - å¼€å§‹è¿è¡Œ...08:26:39.215 [main] c.TestDaemon - è¿è¡Œç»“æŸ... æ³¨æ„ åžƒåœ¾å›žæ”¶å™¨çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹ Tomcat ä¸­çš„ Acceptor å’Œ Poller çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ Tomcat æŽ¥æ”¶åˆ° shutdown å‘½ä»¤åŽï¼Œä¸ä¼šç­‰å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚ 8. äº”ç§çŠ¶æ€è¿™æ˜¯ä»Ž æ“ä½œç³»ç»Ÿ å±‚é¢æ¥æè¿°çš„ ã€åˆå§‹çŠ¶æ€ã€‘ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸Žæ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è” ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸Žæ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”)ï¼Œä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡èŽ·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»Žã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ ã€é˜»å¡žçŠ¶æ€ã€‘ï¼ˆ1ï¼‰å¦‚æžœè°ƒç”¨äº†é˜»å¡ž APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®žé™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ ã€é˜»å¡žçŠ¶æ€ã€‘ï¼ˆ2ï¼‰ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡žçš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆ3ï¼‰ä¸Žã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡žçŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬ ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€ 9. å…­ç§çŠ¶æ€è¿™æ˜¯ä»Ž Java API å±‚é¢æ¥æè¿°çš„æ ¹æ® Thread.State æžšä¸¾ï¼Œåˆ†ä¸ºå…­ç§çŠ¶æ€ NEW çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³• RUNNABLE å½“è°ƒç”¨äº† start() æ–¹æ³•ä¹‹åŽï¼Œæ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº† æ“ä½œç³»ç»Ÿ å±‚é¢çš„ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡žçŠ¶æ€ã€‘ï¼ˆç”±äºŽ BIO å¯¼è‡´çš„çº¿ç¨‹é˜»å¡žï¼Œåœ¨ Java é‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸ºæ˜¯å¯è¿è¡Œï¼‰ BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING éƒ½æ˜¯ Java API å±‚é¢å¯¹ã€é˜»å¡žçŠ¶æ€ã€‘çš„ç»†åˆ†ï¼ŒåŽé¢ä¼šåœ¨çŠ¶æ€è½¬æ¢ä¸€èŠ‚è¯¦è¿° TERMINATED å½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸ äºŒã€å…±äº«æ¨¡åž‹ä¹‹ç®¡ç¨‹1. å…±äº«å¸¦æ¥çš„é—®é¢˜1.1 ä¸´ç•ŒåŒº Critical Section ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºï¼ˆ1ï¼‰å¤šä¸ªçº¿ç¨‹è¯»å…±äº«èµ„æºå…¶å®žä¹Ÿæ²¡æœ‰é—®é¢˜ï¼ˆ2ï¼‰åœ¨å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºçŽ°é—®é¢˜ ä¸€æ®µä»£ç å—å†…å¦‚æžœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º**ä¸´ç•ŒåŒº**ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„ä¸´ç•ŒåŒº 12345678910111213static int counter = 0;static void increment() // ä¸´ç•ŒåŒº&#123; counter++; &#125;static void decrement() // ä¸´ç•ŒåŒº&#123; counter--;&#125; 1.2 ç«žæ€æ¡ä»¶ Race Conditionå¤šä¸ªçº¿ç¨‹åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œç”±äºŽä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æžœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†ç«žæ€æ¡ä»¶ 2. synchronizedè§£å†³æ–¹æ¡ˆ2.1 è§£å†³æ–¹æ¡ˆä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«žæ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚ é˜»å¡žå¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock éžé˜»å¡žå¼çš„è§£å†³æ–¹æ¡ˆï¼šåŽŸå­å˜é‡ 2.2 synchronizedä½¿ç”¨çš„æ˜¯é˜»å¡žå¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼Œå³ä¿—ç§°çš„ã€å¯¹è±¡é”ã€‘ï¼Œå®ƒé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³èŽ·å–è¿™ä¸ªã€å¯¹è±¡é”ã€‘æ—¶å°±ä¼šé˜»å¡žä½ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é”çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ æ³¨æ„ è™½ç„¶ java ä¸­äº’æ–¥å’ŒåŒæ­¥éƒ½å¯ä»¥é‡‡ç”¨ synchronized å…³é”®å­—æ¥å®Œæˆï¼Œä½†å®ƒä»¬è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼š äº’æ–¥æ˜¯ä¿è¯ä¸´ç•ŒåŒºçš„ç«žæ€æ¡ä»¶å‘ç”Ÿï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç  åŒæ­¥æ˜¯ç”±äºŽçº¿ç¨‹æ‰§è¡Œçš„å…ˆåŽã€é¡ºåºä¸åŒã€éœ€è¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹ è¯­æ³• 1234synchronized(å¯¹è±¡) // çº¿ç¨‹1ï¼Œ çº¿ç¨‹2(blocked)&#123; ä¸´ç•ŒåŒº&#125; è§£å†³ 1234567891011121314151617181920212223static int counter = 0;static final Object room = new Object();public static void main(String[] args) throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 5000; i++) &#123; synchronized (room) &#123; counter++; &#125; &#125; &#125;, &quot;t1&quot;); Thread t2 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 5000; i++) &#123; synchronized (room) &#123; counter--; &#125; &#125; &#125;, &quot;t2&quot;); t1.start(); t2.start(); t1.join(); t2.join(); log.debug(&quot;&#123;&#125;&quot;,counter);&#125; ä½ å¯ä»¥åšè¿™æ ·çš„ç±»æ¯”ï¼š synchronized(å¯¹è±¡) ä¸­çš„å¯¹è±¡ï¼Œå¯ä»¥æƒ³è±¡ä¸ºä¸€ä¸ªæˆ¿é—´ï¼ˆroomï¼‰ï¼Œæœ‰å”¯ä¸€å…¥å£ï¼ˆé—¨ï¼‰æˆ¿é—´åªèƒ½ä¸€æ¬¡è¿›å…¥ä¸€äººè¿›è¡Œè®¡ç®—ï¼Œçº¿ç¨‹ t1ï¼Œt2 æƒ³è±¡æˆä¸¤ä¸ªäºº å½“çº¿ç¨‹ t1 æ‰§è¡Œåˆ° synchronized(room) æ—¶å°±å¥½æ¯” t1 è¿›å…¥äº†è¿™ä¸ªæˆ¿é—´ï¼Œå¹¶é”ä½äº†é—¨æ‹¿èµ°äº†é’¥åŒ™ï¼Œåœ¨é—¨å†…æ‰§è¡Œcount++ ä»£ç  è¿™æ—¶å€™å¦‚æžœ t2 ä¹Ÿè¿è¡Œåˆ°äº† synchronized(room) æ—¶ï¼Œå®ƒå‘çŽ°é—¨è¢«é”ä½äº†ï¼Œåªèƒ½åœ¨é—¨å¤–ç­‰å¾…ï¼Œå‘ç”Ÿäº†ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œé˜»å¡žä½äº† è¿™ä¸­é—´å³ä½¿ t1 çš„ cpu æ—¶é—´ç‰‡ä¸å¹¸ç”¨å®Œï¼Œè¢«è¸¢å‡ºäº†é—¨å¤–ï¼ˆä¸è¦é”™è¯¯ç†è§£ä¸ºé”ä½äº†å¯¹è±¡å°±èƒ½ä¸€ç›´æ‰§è¡Œä¸‹åŽ»å“¦ï¼‰ï¼Œè¿™æ—¶é—¨è¿˜æ˜¯é”ä½çš„ï¼Œt1 ä»æ‹¿ç€é’¥åŒ™ï¼Œt2 çº¿ç¨‹è¿˜åœ¨é˜»å¡žçŠ¶æ€è¿›ä¸æ¥ï¼Œåªæœ‰ä¸‹æ¬¡è½®åˆ° t1 è‡ªå·±å†æ¬¡èŽ·å¾—æ—¶é—´ç‰‡æ—¶æ‰èƒ½å¼€é—¨è¿›å…¥ å½“ t1 æ‰§è¡Œå®Œ synchronized&#123;&#125; å—å†…çš„ä»£ç ï¼Œè¿™æ—¶å€™æ‰ä¼šä»Ž obj æˆ¿é—´å‡ºæ¥å¹¶è§£å¼€é—¨ä¸Šçš„é”ï¼Œå”¤é†’ t2 çº¿ç¨‹æŠŠé’¥åŒ™ç»™ä»–ã€‚t2 çº¿ç¨‹è¿™æ—¶æ‰å¯ä»¥è¿›å…¥ obj æˆ¿é—´ï¼Œé”ä½äº†é—¨æ‹¿ä¸Šé’¥åŒ™ï¼Œæ‰§è¡Œå®ƒçš„ count-- ä»£ç  2.3 æ€è€ƒsynchronized å®žé™…æ˜¯ç”¨å¯¹è±¡é”ä¿è¯äº†ä¸´ç•ŒåŒºå†…ä»£ç çš„åŽŸå­æ€§ï¼Œä¸´ç•ŒåŒºå†…çš„ä»£ç å¯¹å¤–æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œä¸ä¼šè¢«çº¿ç¨‹åˆ‡æ¢æ‰€æ‰“æ–­ã€‚ä¸ºäº†åŠ æ·±ç†è§£ï¼Œè¯·æ€è€ƒä¸‹é¢çš„é—®é¢˜ å¦‚æžœæŠŠ synchronized(obj) æ”¾åœ¨ for å¾ªçŽ¯çš„å¤–é¢ï¼Œå¦‚ä½•ç†è§£ï¼Ÿâ€“ åŽŸå­æ€§ å¦‚æžœ t1 synchronized(obj1) è€Œ t2 synchronized(obj2) ä¼šæ€Žæ ·è¿ä½œï¼Ÿâ€“ é”å¯¹è±¡ å¦‚æžœ t1 synchronized(obj) è€Œ t2 æ²¡æœ‰åŠ ä¼šæ€Žä¹ˆæ ·ï¼Ÿå¦‚ä½•ç†è§£ï¼Ÿâ€“ é”å¯¹è±¡ 3. æ–¹æ³•ä¸Šçš„synchronizedæ³¨æ„é”çš„ä¸æ˜¯æ–¹æ³•ï¼Œè€Œæ˜¯å¯¹è±¡ 1234567891011class Test&#123; public synchronized void test() &#123; &#125;&#125;//ç­‰ä»·äºŽclass Test&#123; public void test() &#123; synchronized(this) &#123; &#125; &#125;&#125; 1234567891011class Test&#123; public synchronized static void test() &#123; &#125;&#125;//ç­‰ä»·äºŽclass Test&#123; public static void test() &#123; synchronized(Test.class) &#123; &#125; &#125;&#125; 3.1 ä¸åŠ  synchronized çš„æ–¹æ³•ä¸åŠ  synchronzied çš„æ–¹æ³•å°±å¥½æ¯”ä¸éµå®ˆè§„åˆ™çš„äººï¼Œä¸åŽ»è€å®žæŽ’é˜Ÿï¼ˆå¥½æ¯”ç¿»çª—æˆ·è¿›åŽ»çš„ï¼‰ 3.2 æ‰€è°“çš„â€œçº¿ç¨‹å…«é”â€å…¶å®žå°±æ˜¯è€ƒå¯Ÿ synchronized é”ä½çš„æ˜¯å“ªä¸ªå¯¹è±¡ çº¿ç¨‹å…«é”çš„é‡ç‚¹ï¼š éžé™æ€æ–¹æ³•çš„é»˜è®¤é”æ˜¯thisï¼Œé™æ€æ–¹æ³•çš„é»˜è®¤é”æ˜¯class æŸä¸€æ—¶åˆ»å†…ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æœ‰é”ï¼Œæ— è®ºå‡ ä¸ªæ–¹æ³• æƒ…å†µ1ï¼š12 æˆ– 21 123456789101112131415@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public synchronized void a() &#123; log.debug(&quot;1&quot;); &#125; public synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n1.b(); &#125;).start();&#125; æƒ…å†µ2ï¼š1såŽ12ï¼Œæˆ– 2 1såŽ 1 12345678910111213141516@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n1.b(); &#125;).start();&#125; æƒ…å†µ3ï¼š3 1s 12 æˆ– 23 1s 1 æˆ– 32 1s 1 1234567891011121314151617181920@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public synchronized void b() &#123; log.debug(&quot;2&quot;); &#125; public void c() &#123; log.debug(&quot;3&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n1.b(); &#125;).start(); new Thread(()-&gt;&#123; n1.c(); &#125;).start();&#125; æƒ…å†µ4ï¼š2 1s åŽ 1 1234567891011121314151617@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); Number n2 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n2.b(); &#125;).start();&#125; æƒ…å†µ5ï¼š2 1s åŽ 1 12345678910111213141516@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public static synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n1.b(); &#125;).start();&#125; æƒ…å†µ6ï¼š1s åŽ12ï¼Œ æˆ– 2 1såŽ 1 12345678910111213141516@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public static synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public static synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125; public static void main(String[] args) &#123; Number n1 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n1.b(); &#125;).start();&#125; æƒ…å†µ7ï¼š2 1s åŽ 1 1234567891011121314151617@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public static synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); Number n2 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n2.b(); &#125;).start();&#125; æƒ…å†µ8ï¼š1s åŽ12ï¼Œ æˆ– 2 1såŽ 1 1234567891011121314151617@Slf4j(topic = &quot;c.Number&quot;)class Number&#123; public static synchronized void a() &#123; sleep(1); log.debug(&quot;1&quot;); &#125; public static synchronized void b() &#123; log.debug(&quot;2&quot;); &#125;&#125;public static void main(String[] args) &#123; Number n1 = new Number(); Number n2 = new Number(); new Thread(()-&gt;&#123; n1.a(); &#125;).start(); new Thread(()-&gt;&#123; n2.b(); &#125;).start();&#125; 4. å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æž4.1 æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ å¦‚æžœå®ƒä»¬æ²¡æœ‰å…±äº«ï¼Œåˆ™çº¿ç¨‹å®‰å…¨ å¦‚æžœå®ƒä»¬è¢«å…±äº«äº†ï¼Œæ ¹æ®å®ƒä»¬çš„çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿæ”¹å˜ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µ å¦‚æžœåªæœ‰è¯»æ“ä½œï¼Œåˆ™çº¿ç¨‹å®‰å…¨ å¦‚æžœæœ‰è¯»å†™æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ 4.2 å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ ä½†å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡åˆ™æœªå¿… å¦‚æžœè¯¥å¯¹è±¡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨è®¿é—®ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æžœè¯¥å¯¹è±¡é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ 4.3 å±€éƒ¨å˜é‡çº¿ç¨‹å®‰å…¨åˆ†æž1234public static void test1() &#123;int i = 10;i++;&#125; æ¯ä¸ªçº¿ç¨‹è°ƒç”¨ test1() æ–¹æ³•æ—¶å±€éƒ¨å˜é‡ iï¼Œä¼šåœ¨æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§å†…å­˜ä¸­è¢«åˆ›å»ºå¤šä»½ï¼Œå› æ­¤ä¸å­˜åœ¨å…±äº« 12345678910111213141516public static void test1();descriptor: ()V flags: ACC_PUBLIC, ACC_STATICCode:stack=1, locals=1, args_size=00: bipush 102: istore_03: iinc 0, 16: returnLineNumberTable:line 10: 0line 11: 3line 12: 6LocalVariableTable:Start Length Slot Name Signature3 4 0 i I å¦‚å›¾ å±€éƒ¨å˜é‡çš„å¼•ç”¨ç¨æœ‰ä¸åŒ å…ˆçœ‹ä¸€ä¸ªæˆå‘˜å˜é‡çš„ä¾‹å­ 12345678910111213141516171819202122class ThreadUnsafe &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); public void method1(int loopNumber) &#123; for (int i = 0; i &lt; loopNumber; i++) &#123; // &#123; ä¸´ç•ŒåŒº, ä¼šäº§ç”Ÿç«žæ€æ¡ä»¶ method2(); method3(); // &#125; ä¸´ç•ŒåŒº &#125; &#125; private void method2() &#123; list.add(&quot;1&quot;); &#125; private void method3() &#123; list.remove(0); &#125; &#125; æ‰§è¡Œ 12345678910static final int THREAD_NUMBER = 2;static final int LOOP_NUMBER = 200;public static void main(String[] args) &#123; ThreadUnsafe test = new ThreadUnsafe(); for (int i = 0; i &lt; THREAD_NUMBER; i++) &#123; new Thread(() -&gt; &#123; test.method1(LOOP_NUMBER); &#125;, &quot;Thread&quot; + i).start(); &#125;&#125; å…¶ä¸­ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¦‚æžœçº¿ç¨‹2 è¿˜æœª addï¼Œçº¿ç¨‹1 remove å°±ä¼šæŠ¥é”™ï¼š 1234567Exception in thread &quot;Thread1&quot; java.lang.IndexOutOfBoundsException: Index: 0, Size: 0at java.util.ArrayList.rangeCheck(ArrayList.java:657)at java.util.ArrayList.remove(ArrayList.java:496)at cn.itcast.n6.ThreadUnsafe.method3(TestThreadSafe.java:35)at cn.itcast.n6.ThreadUnsafe.method1(TestThreadSafe.java:26)at cn.itcast.n6.TestThreadSafe.lambda$main$0(TestThreadSafe.java:14)at java.lang.Thread.run(Thread.java:748) åˆ†æžï¼š æ— è®ºå“ªä¸ªçº¿ç¨‹ä¸­çš„ method2 å¼•ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ä¸­çš„ list æˆå‘˜å˜é‡ method3 ä¸Ž method2 åˆ†æžç›¸åŒ å°† list ä¿®æ”¹ä¸ºå±€éƒ¨å˜é‡ 12345678910111213141516171819class ThreadSafe &#123; public final void method1(int loopNumber) &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; loopNumber; i++) &#123; method2(list); method3(list); &#125; &#125; private void method2(ArrayList&lt;String&gt; list) &#123; list.add(&quot;1&quot;); &#125; private void method3(ArrayList&lt;String&gt; list) &#123; list.remove(0); &#125; &#125; é‚£ä¹ˆå°±ä¸ä¼šæœ‰ä¸Šè¿°é—®é¢˜äº† åˆ†æžï¼š list æ˜¯å±€éƒ¨å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨æ—¶ä¼šåˆ›å»ºå…¶ä¸åŒå®žä¾‹ï¼Œæ²¡æœ‰å…±äº« è€Œ method2 çš„å‚æ•°æ˜¯ä»Ž method1 ä¸­ä¼ é€’è¿‡æ¥çš„ï¼Œä¸Ž method1 ä¸­å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ method3 çš„å‚æ•°åˆ†æžä¸Ž method2 ç›¸åŒ æ–¹æ³•è®¿é—®ä¿®é¥°ç¬¦å¸¦æ¥çš„æ€è€ƒï¼Œå¦‚æžœæŠŠ method2 å’Œ method3 çš„æ–¹æ³•ä¿®æ”¹ä¸º public ä¼šä¸ä¼šå¸¦æ¥çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ æƒ…å†µ1ï¼šæœ‰å…¶å®ƒçº¿ç¨‹è°ƒç”¨ method2 å’Œ method3 æƒ…å†µ2ï¼šåœ¨ æƒ…å†µ1 çš„åŸºç¡€ä¸Šï¼Œä¸º ThreadSafe ç±»æ·»åŠ å­ç±»ï¼Œå­ç±»è¦†ç›– method2 æˆ– method3 æ–¹æ³•ï¼Œå³ 1234567891011121314151617181920212223242526272829class ThreadSafe &#123; public final void method1(int loopNumber) &#123; ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; loopNumber; i++) &#123; method2(list); method3(list); &#125; &#125; private void method2(ArrayList&lt;String&gt; list) &#123; list.add(&quot;1&quot;); &#125; private void method3(ArrayList&lt;String&gt; list) &#123; list.remove(0); &#125; &#125;class ThreadSafeSubClass extends ThreadSafe&#123; @Override public void method3(ArrayList&lt;String&gt; list) &#123; new Thread(() -&gt; &#123; list.remove(0); &#125;).start(); &#125;&#125; 4.4 å¸¸è§çº¿ç¨‹å®‰å…¨ç±» String Integer StringBuffer Random Vector Hashtable java.util.concurrent åŒ…ä¸‹çš„ç±» è¿™é‡Œè¯´å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œå¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬åŒä¸€ä¸ªå®žä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸º 12345678Hashtable table = new Hashtable();new Thread(()-&gt;&#123; table.put(&quot;key&quot;, &quot;value1&quot;);&#125;).start();new Thread(()-&gt;&#123; table.put(&quot;key&quot;, &quot;value2&quot;);&#125;).start(); å®ƒä»¬çš„æ¯ä¸ªæ–¹æ³•æ˜¯åŽŸå­çš„ ä½†æ³¨æ„å®ƒä»¬å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŽŸå­çš„ï¼Œè§åŽé¢åˆ†æž çº¿ç¨‹å®‰å…¨ç±»æ–¹æ³•çš„ç»„åˆåˆ†æžä¸‹é¢ä»£ç æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ 12345Hashtable table = new Hashtable();// çº¿ç¨‹1ï¼Œçº¿ç¨‹2if( table.get(&quot;key&quot;) == null) &#123;table.put(&quot;key&quot;, value);&#125; ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§Stringã€Integer ç­‰éƒ½æ˜¯ä¸å¯å˜ç±»ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åŒå­¦æˆ–è®¸æœ‰ç–‘é—®ï¼ŒString æœ‰ replaceï¼Œsubstring ç­‰æ–¹æ³•ã€å¯ä»¥ã€‘æ”¹å˜å€¼å•Šï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ 12345678910111213public class Immutable&#123; private int value = 0; public Immutable(int value)&#123; this.value = value; &#125; public int getValue()&#123; return this.value; &#125; &#125; å¦‚æžœæƒ³å¢žåŠ ä¸€ä¸ªå¢žåŠ çš„æ–¹æ³•å‘¢ï¼Ÿ 12345678910111213141516public class Immutable&#123; private int value = 0; public Immutable(int value)&#123; this.value = value; &#125; public int getValue()&#123; return this.value; &#125; public Immutable add(int v)&#123; return new Immutable(this.value + v); &#125; &#125; å®žä¾‹åˆ†æžä¾‹1ï¼š 12345678910111213141516public class MyServlet extends HttpServlet &#123; // æ˜¯å¦å®‰å…¨ï¼Ÿ Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); // æ˜¯å¦å®‰å…¨ï¼Ÿ String S1 = &quot;...&quot;; // æ˜¯å¦å®‰å…¨ï¼Ÿ final String S2 = &quot;...&quot;; // æ˜¯å¦å®‰å…¨ï¼Ÿ Date D1 = new Date(); // æ˜¯å¦å®‰å…¨ï¼Ÿ final Date D2 = new Date(); public void doGet(HttpServletRequest request, HttpServletResponse response) &#123; // ä½¿ç”¨ä¸Šè¿°å˜é‡ &#125;&#125; ä¾‹2ï¼š 1234567891011121314151617public class MyServlet extends HttpServlet &#123; // æ˜¯å¦å®‰å…¨ï¼Ÿ private UserService userService = new UserServiceImpl(); public void doGet(HttpServletRequest request, HttpServletResponse response) &#123; userService.update(...); &#125;&#125;public class UserServiceImpl implements UserService &#123; // è®°å½•è°ƒç”¨æ¬¡æ•° private int count = 0; public void update() &#123; // ... count++; &#125;&#125; ä¾‹3ï¼š 123456789101112131415161718@Aspect@Componentpublic class MyAspect &#123; // æ˜¯å¦å®‰å…¨ï¼Ÿ private long start = 0L; @Before(&quot;execution(* *(..))&quot;) public void before() &#123; start = System.nanoTime(); &#125; @After(&quot;execution(* *(..))&quot;) public void after() &#123; long end = System.nanoTime(); System.out.println(&quot;cost time:&quot; + (end-start)); &#125;&#125; ä¾‹4ï¼š 12345678910111213141516171819202122232425262728public class MyServlet extends HttpServlet &#123; // æ˜¯å¦å®‰å…¨ private UserService userService = new UserServiceImpl(); public void doGet(HttpServletRequest request, HttpServletResponse response) &#123; userService.update(...); &#125;&#125;public class UserServiceImpl implements UserService &#123; // æ˜¯å¦å®‰å…¨ private UserDao userDao = new UserDaoImpl(); public void update() &#123; userDao.update(); &#125;&#125;public class UserDaoImpl implements UserDao &#123; public void update() &#123; String sql = &quot;update user set password = ? where username = ?&quot;; // æ˜¯å¦å®‰å…¨ try (Connection conn = DriverManager.getConnection(&quot;&quot;,&quot;&quot;,&quot;&quot;))&#123; // ... &#125; catch (Exception e) &#123; // ... &#125; &#125;&#125; ä¾‹5ï¼š 12345678910111213141516171819202122232425262728public class MyServlet extends HttpServlet &#123; // æ˜¯å¦å®‰å…¨ private UserService userService = new UserServiceImpl(); public void doGet(HttpServletRequest request, HttpServletResponse response) &#123; userService.update(...); &#125;&#125;public class UserServiceImpl implements UserService &#123; // æ˜¯å¦å®‰å…¨ private UserDao userDao = new UserDaoImpl(); public void update() &#123; userDao.update(); &#125;&#125;public class UserDaoImpl implements UserDao &#123; // æ˜¯å¦å®‰å…¨ private Connection conn = null; public void update() throws SQLException &#123; String sql = &quot;update user set password = ? where username = ?&quot;; conn = DriverManager.getConnection(&quot;&quot;,&quot;&quot;,&quot;&quot;); // ... conn.close(); &#125;&#125; ä¾‹6ï¼š 1234567891011121314151617181920212223242526public class MyServlet extends HttpServlet &#123; // æ˜¯å¦å®‰å…¨ private UserService userService = new UserServiceImpl(); public void doGet(HttpServletRequest request, HttpServletResponse response) &#123; userService.update(...); &#125;&#125;public class UserServiceImpl implements UserService &#123; public void update() &#123; UserDao userDao = new UserDaoImpl(); userDao.update(); &#125;&#125;public class UserDaoImpl implements UserDao &#123; // æ˜¯å¦å®‰å…¨ private Connection = null; public void update() throws SQLException &#123; String sql = &quot;update user set password = ? where username = ?&quot;; conn = DriverManager.getConnection(&quot;&quot;,&quot;&quot;,&quot;&quot;); // ... conn.close(); &#125;&#125; ä¾‹7ï¼š 12345678910111213public abstract class Test &#123; public void bar() &#123; // æ˜¯å¦å®‰å…¨ SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); foo(sdf); &#125; public abstract foo(SimpleDateFormat sdf); public static void main(String[] args) &#123; new Test().bar(); &#125;&#125; å…¶ä¸­ foo çš„è¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½å¯¼è‡´ä¸å®‰å…¨çš„å‘ç”Ÿï¼Œè¢«ç§°ä¹‹ä¸ºå¤–æ˜Ÿæ–¹æ³• 123456789101112131415public void foo(SimpleDateFormat sdf) &#123; String dateStr = &quot;1999-10-11 00:00:00&quot;; for (int i = 0; i &lt; 20; i++) &#123; new Thread(() -&gt; &#123; try &#123; sdf.parse(dateStr); &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; &#125;).start(); &#125;&#125; è¯·æ¯”è¾ƒ JDK ä¸­ String ç±»çš„å®žçŽ° ä¾‹8ï¼š 1234567891011121314151617181920212223242526private static Integer i = 0;public static void main(String[] args) throws InterruptedException &#123; List&lt;Thread&gt; list = new ArrayList&lt;&gt;(); for (int j = 0; j &lt; 2; j++) &#123; Thread thread = new Thread(() -&gt; &#123; for (int k = 0; k &lt; 5000; k++) &#123; synchronized (i) &#123; i++; &#125; &#125; &#125;, &quot;&quot; + j); list.add(thread); &#125; list.stream().forEach(t -&gt; t.start()); list.stream().forEach(t -&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); log.debug(&quot;&#123;&#125;&quot;, i);&#125; 5. ä¹ é¢˜5.1 å–ç¥¨ç»ƒä¹ æµ‹è¯•ä¸‹é¢ä»£ç æ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶å°è¯•æ”¹æ­£ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public class ExerciseSell &#123; public static void main(String[] args) &#123; TicketWindow ticketWindow = new TicketWindow(2000); List&lt;Thread&gt; list = new ArrayList&lt;&gt;(); // ç”¨æ¥å­˜å‚¨ä¹°å‡ºåŽ»å¤šå°‘å¼ ç¥¨ List&lt;Integer&gt; sellCount = new Vector&lt;&gt;(); for (int i = 0; i &lt; 2000; i++) &#123; Thread t = new Thread(() -&gt; &#123; // åˆ†æžè¿™é‡Œçš„ç«žæ€æ¡ä»¶ int count = ticketWindow.sell(randomAmount()); sellCount.add(count); &#125;); list.add(t); t.start(); &#125; list.forEach((t) -&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); // ä¹°å‡ºåŽ»çš„ç¥¨æ±‚å’Œ log.debug(&quot;selled count:&#123;&#125;&quot;,sellCount.stream().mapToInt(c -&gt; c).sum()); // å‰©ä½™ç¥¨æ•° log.debug(&quot;remainder count:&#123;&#125;&quot;, ticketWindow.getCount()); &#125; // Random ä¸ºçº¿ç¨‹å®‰å…¨ static Random random = new Random(); // éšæœº 1~5 public static int randomAmount() &#123; return random.nextInt(5) + 1; &#125;&#125;class TicketWindow &#123; private int count; public TicketWindow(int count) &#123; this.count = count; &#125; public int getCount() &#123; return count; &#125; public int sell(int amount) &#123; if (this.count &gt;= amount) &#123; this.count -= amount; return amount; &#125; else &#123; return 0; &#125; &#125;&#125; å¦å¤–ï¼Œç”¨ä¸‹é¢çš„ä»£ç è¡Œä¸è¡Œï¼Œä¸ºä»€ä¹ˆï¼Ÿ 1List&lt;Integer&gt; sellCount = new ArrayList&lt;&gt;(); æµ‹è¯•è„šæœ¬ 1for /L %n in (1,1,10) do java -cp &quot;.;D:\\Users\\Administrator\\.m2\\repository\\ch\\qos\\logback\\1.2.3\\logback-classic-1.2.3.jar;D:\\Users\\Administrator\\.m2\\repository\\ch\\qos\\logback\\logbackcore\\1.2.3\\logback-core-1.2.3.jar;D:\\Users\\Administrator\\.m2\\repository\\org\\slf4j\\slf4japi\\1.7.25\\slf4j-api-1.7.25.jar&quot; cn.itcast.n4.exercise.ExerciseSell 5.2 è½¬è´¦ç»ƒä¹ æµ‹è¯•ä¸‹é¢ä»£ç æ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¹¶å°è¯•æ”¹æ­£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class ExerciseTransfer &#123; public static void main(String[] args) throws InterruptedException &#123; Account a = new Account(1000); Account b = new Account(1000); Thread t1 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 1000; i++) &#123; a.transfer(b, randomAmount()); &#125; &#125;, &quot;t1&quot;); Thread t2 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 1000; i++) &#123; b.transfer(a, randomAmount()); &#125; &#125;, &quot;t2&quot;); t1.start(); t2.start(); t1.join(); t2.join();// æŸ¥çœ‹è½¬è´¦2000æ¬¡åŽçš„æ€»é‡‘é¢ log.debug(&quot;total:&#123;&#125;&quot;,(a.getMoney() + b.getMoney())); &#125; // Random ä¸ºçº¿ç¨‹å®‰å…¨ static Random random = new Random(); // éšæœº 1~100 public static int randomAmount() &#123; return random.nextInt(100) +1; &#125;&#125;class Account &#123; private int money; public Account(int money) &#123; this.money = money; &#125; public int getMoney() &#123; return money; &#125; public void setMoney(int money) &#123; this.money = money; &#125; public void transfer(Account target, int amount) &#123; if (this.money &gt; amount) &#123; this.setMoney(this.getMoney() - amount); target.setMoney(target.getMoney() + amount); &#125; &#125;&#125; è¿™æ ·æ”¹æ­£è¡Œä¸è¡Œï¼Œä¸ºä»€ä¹ˆï¼Ÿ 123456public synchronized void transfer(Account target, int amount) &#123; if (this.money &gt; amount) &#123; this.setMoney(this.getMoney() - amount); target.setMoney(target.getMoney() + amount); &#125;&#125; 6. Monitor æ¦‚å¿µ6.1 Java å¯¹è±¡å¤´ä»¥ 32 ä½è™šæ‹Ÿæœºä¸ºä¾‹ æ™®é€šå¯¹è±¡ 12345|--------------------------------------------------------------|| Object Header (64 bits) ||------------------------------------|-------------------------|| Mark Word (32 bits) | Klass Word (32 bits) ||------------------------------------|-------------------------| æ•°ç»„å¯¹è±¡ 12345|---------------------------------------------------------------------------------|| Object Header (96 bits) ||--------------------------------|-----------------------|------------------------|| Mark Word(32bits) | Klass Word(32bits) | array length(32bits) ||--------------------------------|-----------------------|------------------------| å…¶ä¸­ Mark Word ç»“æž„ä¸º 12345678910111213|-------------------------------------------------------|--------------------|| Mark Word (32 bits) | State ||-------------------------------------------------------|--------------------|| hashcode:25 | age:4 | biased_lock:0 | 01 | Normal ||-------------------------------------------------------|--------------------|| thread:23 | epoch:2 | age:4 | biased_lock:1 | 01 | Biased ||-------------------------------------------------------|--------------------|| ptr_to_lock_record:30 | 00 | Lightweight Locked ||-------------------------------------------------------|--------------------|| ptr_to_heavyweight_monitor:30 | 10 | Heavyweight Locked ||-------------------------------------------------------|--------------------|| | 11 | Marked for GC ||-------------------------------------------------------|--------------------| 64 ä½è™šæ‹Ÿæœº Mark Word 12345678910111213|--------------------------------------------------------------------|--------------------|| Mark Word (64 bits) | State ||--------------------------------------------------------------------|--------------------|| unused:25 | hashcode:31 | unused:1 | age:4 | biased_lock:0 | 01 | Normal ||--------------------------------------------------------------------|--------------------|| thread:54 | epoch:2 | unused:1 | age:4 | biased_lock:1 | 01 | Biased ||--------------------------------------------------------------------|--------------------|| ptr_to_lock_record:62 | 00 | Lightweight Locked ||--------------------------------------------------------------------|--------------------|| ptr_to_heavyweight_monitor:62 | 10 | Heavyweight Locked ||--------------------------------------------------------------------|--------------------|| | 11 | Marked for GC ||--------------------------------------------------------------------|--------------------| å‚è€ƒèµ„æ–™ https://stackoverflow.com/questions/26357186/what-is-in-java-object-header 6.2 åŽŸç†ä¹‹ Monitor(é”)Monitor è¢«ç¿»è¯‘ä¸ºç›‘è§†å™¨æˆ–ç®¡ç¨‹ æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitor å¯¹è±¡ï¼Œå¦‚æžœä½¿ç”¨ synchronized ç»™å¯¹è±¡ä¸Šé”ï¼ˆé‡é‡çº§ï¼‰ä¹‹åŽï¼Œè¯¥å¯¹è±¡å¤´çš„Mark Word ä¸­å°±è¢«è®¾ç½®æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆ Monitor ç»“æž„å¦‚ä¸‹ åˆšå¼€å§‹ Monitor ä¸­ Owner ä¸º null å½“ Thread-2 æ‰§è¡Œ synchronized(obj) å°±ä¼šå°† Monitor çš„æ‰€æœ‰è€… Owner ç½®ä¸º Thread-2ï¼ŒMonitorä¸­åªèƒ½æœ‰ä¸€ä¸ª Owner åœ¨ Thread-2 ä¸Šé”çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æžœ Thread-3ï¼ŒThread-4ï¼ŒThread-5 ä¹Ÿæ¥æ‰§è¡Œ synchronized(obj)ï¼Œå°±ä¼šè¿›å…¥EntryList BLOCKED Thread-2 æ‰§è¡Œå®ŒåŒæ­¥ä»£ç å—çš„å†…å®¹ï¼Œç„¶åŽå”¤é†’ EntryList ä¸­ç­‰å¾…çš„çº¿ç¨‹æ¥ç«žäº‰é”ï¼Œç«žäº‰çš„æ—¶æ˜¯éžå…¬å¹³çš„ å›¾ä¸­ WaitSet ä¸­çš„ Thread-0ï¼ŒThread-1 æ˜¯ä¹‹å‰èŽ·å¾—è¿‡é”ï¼Œä½†æ¡ä»¶ä¸æ»¡è¶³è¿›å…¥ WAITING çŠ¶æ€çš„çº¿ç¨‹ï¼ŒåŽé¢è®²wait-notify æ—¶ä¼šåˆ†æž æ³¨æ„ï¼š synchronized å¿…é¡»æ˜¯è¿›å…¥åŒä¸€ä¸ªå¯¹è±¡çš„ monitor æ‰æœ‰ä¸Šè¿°çš„æ•ˆæžœä¸åŠ  synchronized çš„å¯¹è±¡ä¸ä¼šå…³è”ç›‘è§†å™¨ï¼Œä¸éµä»Žä»¥ä¸Šè§„åˆ™ 6.3 åŽŸç†ä¹‹ synchronized1234567static final Object lock = new Object();static int counter = 0;public static void main(String[] args) &#123; synchronized (lock) &#123; counter++; &#125;&#125; å¯¹åº”çš„å­—èŠ‚ç ä¸º 1234567891011121314151617181920212223242526272829303132333435363738394041public static void main(java.lang.String[]);descriptor: ([Ljava/lang/String;)Vflags: ACC_PUBLIC, ACC_STATICCode:stack=2, locals=3, args_size=10: getstatic #2 // &lt;- lockå¼•ç”¨ ï¼ˆsynchronizedå¼€å§‹ï¼‰3: dup4: astore_1 // lockå¼•ç”¨ -&gt; slot 15: monitorenter // å°† lockå¯¹è±¡ MarkWord ç½®ä¸º Monitor æŒ‡é’ˆ6: getstatic #3 // &lt;- i9: iconst_1 // å‡†å¤‡å¸¸æ•° 110: iadd // +111: putstatic #3 // -&gt; i14: aload_1 // &lt;- lockå¼•ç”¨15: monitorexit // å°† lockå¯¹è±¡ MarkWord é‡ç½®, å”¤é†’ EntryList16: goto 2419: astore_2 // e -&gt; slot 220: aload_1 // &lt;- lockå¼•ç”¨21: monitorexit // å°† lockå¯¹è±¡ MarkWord é‡ç½®, å”¤é†’ EntryList22: aload_2 // &lt;- slot 2 (e)23: athrow // throw e24: returnException table:from to target type6 16 19 any19 22 19 anyLineNumberTable:line 8: 0line 9: 6line 10: 14line 11: 24LocalVariableTable:Start Length Slot Name Signature0 25 0 args [Ljava/lang/String;StackMapTable: number_of_entries = 2frame_type = 255 /* full_frame */offset_delta = 19locals = [ class &quot;[Ljava/lang/String;&quot;, class java/lang/Object ]stack = [ class java/lang/Throwable ]frame_type = 250 /* chop */offset_delta = 4 æ³¨æ„ æ–¹æ³•çº§åˆ«çš„ synchronized ä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“çŽ° 6.4 å°æ•…äº‹æ•…äº‹è§’è‰² è€çŽ‹ - JVM å°å— - çº¿ç¨‹ å°å¥³ - çº¿ç¨‹ æˆ¿é—´ - å¯¹è±¡ æˆ¿é—´é—¨ä¸Š - é˜²ç›—é” - Monitor æˆ¿é—´é—¨ä¸Š - å°å—ä¹¦åŒ… - è½»é‡çº§é” æˆ¿é—´é—¨ä¸Š - åˆ»ä¸Šå°å—å¤§å - åå‘é” æ‰¹é‡é‡åˆ»å - ä¸€ä¸ªç±»çš„åå‘é”æ’¤é”€åˆ°è¾¾ 20 é˜ˆå€¼ ä¸èƒ½åˆ»åå­— - æ‰¹é‡æ’¤é”€è¯¥ç±»å¯¹è±¡çš„åå‘é”ï¼Œè®¾ç½®è¯¥ç±»ä¸å¯åå‘ å°å—è¦ä½¿ç”¨æˆ¿é—´ä¿è¯è®¡ç®—ä¸è¢«å…¶å®ƒäººå¹²æ‰°ï¼ˆåŽŸå­æ€§ï¼‰ï¼Œæœ€åˆï¼Œä»–ç”¨çš„æ˜¯é˜²ç›—é”ï¼Œå½“ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œé”ä½é—¨ã€‚è¿™æ ·ï¼Œå³ä½¿ä»–ç¦»å¼€äº†ï¼Œåˆ«äººä¹Ÿè¿›ä¸äº†é—¨ï¼Œä»–çš„å·¥ä½œå°±æ˜¯å®‰å…¨çš„ã€‚ ä½†æ˜¯ï¼Œå¾ˆå¤šæƒ…å†µä¸‹æ²¡äººè·Ÿä»–æ¥ç«žäº‰æˆ¿é—´çš„ä½¿ç”¨æƒã€‚å°å¥³æ˜¯è¦ç”¨æˆ¿é—´ï¼Œä½†ä½¿ç”¨çš„æ—¶é—´ä¸Šæ˜¯é”™å¼€çš„ï¼Œå°å—ç™½å¤©ç”¨ï¼Œå°å¥³æ™šä¸Šç”¨ã€‚æ¯æ¬¡ä¸Šé”å¤ªéº»çƒ¦äº†ï¼Œæœ‰æ²¡æœ‰æ›´ç®€å•çš„åŠžæ³•å‘¢ï¼Ÿ å°å—å’Œå°å¥³å•†é‡äº†ä¸€ä¸‹ï¼Œçº¦å®šä¸é”é—¨äº†ï¼Œè€Œæ˜¯è°ç”¨æˆ¿é—´ï¼Œè°æŠŠè‡ªå·±çš„ä¹¦åŒ…æŒ‚åœ¨é—¨å£ï¼Œä½†ä»–ä»¬çš„ä¹¦åŒ…æ ·å¼éƒ½ä¸€æ ·ï¼Œå› æ­¤æ¯æ¬¡è¿›é—¨å‰å¾—ç¿»ç¿»ä¹¦åŒ…ï¼Œçœ‹è¯¾æœ¬æ˜¯è°çš„ï¼Œå¦‚æžœæ˜¯è‡ªå·±çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›é—¨ï¼Œè¿™æ ·çœçš„ä¸Šé”è§£é”äº†ã€‚ä¸‡ä¸€ä¹¦åŒ…ä¸æ˜¯è‡ªå·±çš„ï¼Œé‚£ä¹ˆå°±åœ¨é—¨å¤–ç­‰ï¼Œå¹¶é€šçŸ¥å¯¹æ–¹ä¸‹æ¬¡ç”¨é”é—¨çš„æ–¹å¼ã€‚ åŽæ¥ï¼Œå°å¥³å›žè€å®¶äº†ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´éƒ½ä¸ä¼šç”¨è¿™ä¸ªæˆ¿é—´ã€‚å°å—æ¯æ¬¡è¿˜æ˜¯æŒ‚ä¹¦åŒ…ï¼Œç¿»ä¹¦åŒ…ï¼Œè™½ç„¶æ¯”é”é—¨çœäº‹äº†ï¼Œä½†ä»ç„¶è§‰å¾—éº»çƒ¦ã€‚ äºŽæ˜¯ï¼Œå°å—å¹²è„†åœ¨é—¨ä¸Šåˆ»ä¸Šäº†è‡ªå·±çš„åå­—ï¼šã€å°å—ä¸“å±žæˆ¿é—´ï¼Œå…¶å®ƒäººå‹¿ç”¨ã€‘ï¼Œä¸‹æ¬¡æ¥ç”¨æˆ¿é—´æ—¶ï¼Œåªè¦åå­—è¿˜åœ¨ï¼Œé‚£ä¹ˆè¯´æ˜Žæ²¡äººæ‰“æ‰°ï¼Œè¿˜æ˜¯å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨æˆ¿é—´ã€‚å¦‚æžœè¿™æœŸé—´æœ‰å…¶å®ƒäººè¦ç”¨è¿™ä¸ªæˆ¿é—´ï¼Œé‚£ä¹ˆç”±ä½¿ç”¨è€…å°†å°å—åˆ»çš„åå­—æ“¦æŽ‰ï¼Œå‡çº§ä¸ºæŒ‚ä¹¦åŒ…çš„æ–¹å¼ã€‚ åŒå­¦ä»¬éƒ½æ”¾å‡å›žè€å®¶äº†ï¼Œå°å—å°±è†¨èƒ€äº†ï¼Œåœ¨ 20 ä¸ªæˆ¿é—´åˆ»ä¸Šäº†è‡ªå·±çš„åå­—ï¼Œæƒ³è¿›å“ªä¸ªè¿›å“ªä¸ªã€‚åŽæ¥ä»–è‡ªå·±æ”¾å‡å›žè€å®¶äº†ï¼Œè¿™æ—¶å°å¥³å›žæ¥äº†ï¼ˆå¥¹ä¹Ÿè¦ç”¨è¿™äº›æˆ¿é—´ï¼‰ï¼Œç»“æžœå°±æ˜¯å¾—ä¸€ä¸ªä¸ªåœ°æ“¦æŽ‰å°å—åˆ»çš„åå­—ï¼Œå‡çº§ä¸ºæŒ‚ä¹¦åŒ…çš„æ–¹å¼ã€‚è€çŽ‹è§‰å¾—è¿™æˆæœ¬æœ‰ç‚¹é«˜ï¼Œæå‡ºäº†ä¸€ç§æ‰¹é‡é‡åˆ»åçš„æ–¹æ³•ï¼Œä»–è®©å°å¥³ä¸ç”¨æŒ‚ä¹¦åŒ…äº†ï¼Œå¯ä»¥ç›´æŽ¥åœ¨é—¨ä¸Šåˆ»ä¸Šè‡ªå·±çš„åå­— åŽæ¥ï¼Œåˆ»åçš„çŽ°è±¡è¶Šæ¥è¶Šé¢‘ç¹ï¼Œè€çŽ‹å—ä¸äº†äº†ï¼šç®—äº†ï¼Œè¿™äº›æˆ¿é—´éƒ½ä¸èƒ½åˆ»åäº†ï¼Œåªèƒ½æŒ‚ä¹¦åŒ… 6.5 åŽŸç†ä¹‹ synchronized è¿›é˜¶è½»é‡çº§é”è½»é‡å³é”çš„ä½¿ç”¨åœºæ™¯ï¼Œå¦‚æžœä¸€ä¸ªå¯¹è±¡è™½ç„¶æœ‰å¤šçº¿ç¨‹è®¿é—®ï¼Œä½†å¤šçº¿ç¨‹è®¿é—®çš„æ—¶é—´æ˜¯é”™å¼€çš„ (ä¹Ÿå°±æ˜¯æ²¡æœ‰ç«žäº‰)ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚ è½»é‡çº§é”å¯¹ä½¿ç”¨è€…æ˜¯é€æ˜Žçš„ï¼Œå³è¯­æ³•ä¾ç„¶æ˜¯ synchronized å‡è®¾æœ‰ä¸¤ä¸ªæ–¹æ³•åŒæ­¥å—ï¼Œåˆ©ç”¨åŒä¸€ä¸ªå¯¹è±¡åŠ é” 123456789101112static final Object obj = new Object();public static void method1() &#123; synchronized( obj ) &#123; // åŒæ­¥å— A method2(); &#125;&#125;public static void method2() &#123; synchronized( obj ) &#123; // åŒæ­¥å— B &#125;&#125; åˆ›å»ºé”è®°å½• (Lock Record)ï¼Œå¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§éƒ½åŒ…å«ä¸€ä¸ªé”è®°å½•çš„ç»“æž„ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å¯¹è±¡çš„ Mark Word è®©é”è®°å½•ä¸­ Object reference æŒ‡å‘é”å¯¹è±¡ï¼Œå¹¶å°è¯•ç”¨ cas æ›¿æ¢ Object çš„ Mark Wordï¼Œå°† Mark Word çš„å€¼å­˜å…¥é”è®°å½• å¦‚æžœ cas æ›¿æ¢æˆåŠŸï¼Œå¯¹è±¡å¤´ä¸­å­˜å‚¨äº† é”è®°å½•åœ°å€å’ŒçŠ¶æ€ 00 ï¼Œè¡¨ç¤ºç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”ï¼Œè¿™æ—¶å›¾ç¤ºå¦‚ä¸‹ å¦‚æžœ cas å¤±è´¥ï¼Œæœ‰ä¸¤ç§æƒ…å†µ å¦‚æžœæ˜¯å…¶å®ƒçº¿ç¨‹å·²ç»æŒæœ‰äº†è¯¥ Object çš„è½»é‡çº§é”ï¼Œè¿™æ—¶è¡¨æ˜Žæœ‰ç«žäº‰ï¼Œè¿›å…¥é”è†¨èƒ€è¿‡ç¨‹ å¦‚æžœæ˜¯è‡ªå·±æ‰§è¡Œäº† synchronized é”é‡å…¥ï¼Œé‚£ä¹ˆå†æ·»åŠ ä¸€æ¡ Lock Record ä½œä¸ºé‡å…¥çš„è®¡æ•° å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰å¦‚æžœæœ‰å–å€¼ä¸º null çš„é”è®°å½•ï¼Œè¡¨ç¤ºæœ‰é‡å…¥ï¼Œè¿™æ—¶é‡ç½®é”è®°å½•ï¼Œè¡¨ç¤ºé‡å…¥è®¡æ•°å‡ä¸€ å½“é€€å‡º synchronized ä»£ç å—ï¼ˆè§£é”æ—¶ï¼‰é”è®°å½•çš„å€¼ä¸ä¸º nullï¼Œè¿™æ—¶ä½¿ç”¨ cas å°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´ æˆåŠŸï¼Œåˆ™è§£é”æˆåŠŸ å¤±è´¥ï¼Œè¯´æ˜Žè½»é‡çº§é”è¿›è¡Œäº†é”è†¨èƒ€æˆ–å·²ç»å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é‡é‡çº§é”è§£é”æµç¨‹ é”è†¨èƒ€å¦‚æžœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼ŒCAS æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒçº¿ç¨‹ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”ï¼ˆæœ‰ç«žäº‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é” 123456static Object obj = new Object(); public static void method1() &#123; synchronized( obj ) &#123; // åŒæ­¥å— &#125;&#125; å½“ Thread-1 è¿›è¡Œè½»é‡çº§åŠ é”æ—¶ï¼ŒThread-0 å·²ç»å¯¹è¯¥å¯¹è±¡åŠ äº†è½»é‡çº§é” è¿™æ—¶ Thread-1 åŠ è½»é‡çº§é”å¤±è´¥ï¼Œè¿›å…¥é”è†¨èƒ€æµç¨‹ å³ä¸º Object å¯¹è±¡ç”³è¯· Monitor é”ï¼Œè®© Object æŒ‡å‘é‡é‡çº§é”åœ°å€ ç„¶åŽè‡ªå·±è¿›å…¥ Monitor çš„ EntryList BLOCKED å½“ Thread-0 é€€å‡ºåŒæ­¥å—è§£é”æ—¶ï¼Œä½¿ç”¨ cas å°† Mark Word çš„å€¼æ¢å¤ç»™å¯¹è±¡å¤´ï¼Œå¤±è´¥ã€‚è¿™æ—¶ä¼šè¿›å…¥é‡é‡çº§è§£é”æµç¨‹ï¼Œå³æŒ‰ç…§ Monitor åœ°å€æ‰¾åˆ° Monitor å¯¹è±¡ï¼Œè®¾ç½® Owner ä¸º nullï¼Œå”¤é†’ EntryList ä¸­ BLOCKED çº¿ç¨‹ è‡ªæ—‹ä¼˜åŒ–é‡é‡çº§é”ç«žäº‰çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªæ—‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹è‡ªæ—‹æˆåŠŸï¼ˆå³è¿™æ—¶å€™æŒé”çº¿ç¨‹å·²ç»é€€å‡ºäº†åŒæ­¥å—ï¼Œé‡Šæ”¾äº†é”ï¼‰ï¼Œè¿™æ—¶å½“å‰çº¿ç¨‹å°±å¯ä»¥é¿å…é˜»å¡žã€‚ è‡ªæ—‹é‡è¯•æˆåŠŸçš„æƒ…å†µ çº¿ç¨‹ 1 ï¼ˆcore 1 ä¸Šï¼‰ å¯¹è±¡ Mark çº¿ç¨‹ 2 ï¼ˆcore 2 ä¸Šï¼‰ - 10ï¼ˆé‡é‡é”ï¼‰ - è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æˆåŠŸï¼ˆåŠ é”ï¼‰ 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡Œå®Œæ¯• 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æˆåŠŸï¼ˆè§£é”ï¼‰ 01ï¼ˆæ— é”ï¼‰ è‡ªæ—‹é‡è¯• - 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ æˆåŠŸï¼ˆåŠ é”ï¼‰ - 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ æ‰§è¡ŒåŒæ­¥å— - â€¦ â€¦ è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ çº¿ç¨‹ 1ï¼ˆcore 1 ä¸Šï¼‰ å¯¹è±¡ Mark çº¿ç¨‹ 2ï¼ˆcore 2 ä¸Šï¼‰ - 10ï¼ˆé‡é‡é”ï¼‰ - è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æˆåŠŸï¼ˆåŠ é”ï¼‰ 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ é˜»å¡ž - â€¦ â€¦ è‡ªæ—‹ä¼šå ç”¨ CPU æ—¶é—´ï¼Œå•æ ¸ CPU è‡ªæ—‹å°±æ˜¯æµªè´¹ï¼Œå¤šæ ¸ CPU è‡ªæ—‹æ‰èƒ½å‘æŒ¥ä¼˜åŠ¿ã€‚ åœ¨ Java 6 ä¹‹åŽè‡ªæ—‹é”æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚å¯¹è±¡åˆšåˆšçš„ä¸€æ¬¡è‡ªæ—‹æ“ä½œæˆåŠŸè¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹æˆåŠŸçš„å¯èƒ½æ€§ä¼šé«˜ï¼Œå°±å¤šè‡ªæ—‹å‡ æ¬¡ï¼›åä¹‹ï¼Œå°±å°‘è‡ªæ—‹ç”šè‡³ä¸è‡ªæ—‹ï¼Œæ€»ä¹‹ï¼Œæ¯”è¾ƒæ™ºèƒ½ã€‚ Java 7 ä¹‹åŽä¸èƒ½æŽ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹åŠŸèƒ½ åå‘é”è½»é‡çº§é”åœ¨æ²¡æœ‰ç«žäº‰æ—¶ï¼ˆå°±è‡ªå·±è¿™ä¸ªçº¿ç¨‹ï¼‰ï¼Œæ¯æ¬¡é‡å…¥ä»ç„¶éœ€è¦æ‰§è¡Œ CAS æ“ä½œã€‚ Java 6 ä¸­å¼•å…¥äº†åå‘é”æ¥åšè¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨ CAS å°†çº¿ç¨‹ ID è®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œä¹‹åŽå‘çŽ°è¿™ä¸ªçº¿ç¨‹ ID æ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«žäº‰ï¼Œä¸ç”¨é‡æ–° CASã€‚ä»¥åŽåªè¦ä¸å‘ç”Ÿç«žäº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ ä¾‹å¦‚ï¼š 1234567891011121314151617181920static final Object obj = new Object();public static void m1() &#123; synchronized( obj ) &#123; // åŒæ­¥å— A m2(); &#125;&#125;public static void m2() &#123; synchronized( obj ) &#123; // åŒæ­¥å— B m3(); &#125;&#125;public static void m3() &#123; synchronized( obj ) &#123; // åŒæ­¥å— C &#125;&#125; åå‘çŠ¶æ€å›žå¿†ä¸€ä¸‹å¯¹è±¡å¤´æ ¼å¼ 12345678910111213|--------------------------------------------------------------------|--------------------|| Mark Word (64 bits) | State | |--------------------------------------------------------------------|--------------------|| unused:25 | hashcode:31 | unused:1 | age:4 | biased_lock:0 | 01 | Normal ||--------------------------------------------------------------------|--------------------|| thread:54 | epoch:2 | unused:1 | age:4 | biased_lock:1 | 01 | Biased ||--------------------------------------------------------------------|--------------------|| ptr_to_lock_record:62 | 00 | Lightweight Locked ||--------------------------------------------------------------------|--------------------|| ptr_to_heavyweight_monitor:62 | 10 | Heavyweight Locked ||--------------------------------------------------------------------|--------------------|| | 11 | Marked for GC ||--------------------------------------------------------------------|--------------------| ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶ï¼š å¦‚æžœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œé‚£ä¹ˆå¯¹è±¡åˆ›å»ºåŽï¼Œmarkword å€¼ä¸º 0x05 å³æœ€åŽ 3 ä½ä¸º 101ï¼Œè¿™æ—¶å®ƒçš„threadã€epochã€age éƒ½ä¸º 0 åå‘é”æ˜¯é»˜è®¤æ˜¯å»¶è¿Ÿçš„ï¼Œä¸ä¼šåœ¨ç¨‹åºå¯åŠ¨æ—¶ç«‹å³ç”Ÿæ•ˆï¼Œå¦‚æžœæƒ³é¿å…å»¶è¿Ÿï¼Œå¯ä»¥åŠ  VM å‚æ•° -XX:BiasedLockingStartupDelay=0 æ¥ç¦ç”¨å»¶è¿Ÿ å¦‚æžœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œé‚£ä¹ˆå¯¹è±¡åˆ›å»ºåŽï¼Œmarkword å€¼ä¸º 0x01 å³æœ€åŽ 3 ä½ä¸º 001ï¼Œè¿™æ—¶å®ƒçš„ hashcodeã€age éƒ½ä¸º 0ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ° hashcode æ—¶æ‰ä¼šèµ‹å€¼ 1ï¼‰ æµ‹è¯•å»¶è¿Ÿç‰¹æ€§ 1234567891011// æ·»åŠ è™šæ‹Ÿæœºå‚æ•° -XX:BiasedLockingStartupDelay=0Dog d = new Dog();ClassLayout classLayout = ClassLayout.parseInstance(d);System.out.println(classLayout.toPrintable());// HotSpot è™šæ‹Ÿæœºåœ¨å¯åŠ¨åŽæœ‰ä¸ª 4s çš„å»¶è¿Ÿæ‰ä¼šå¯¹æ¯ä¸ªæ–°å»ºçš„å¯¹è±¡å¼€å¯åå‘é”æ¨¡å¼Thread.sleep(3000);System.out.println(ClassLayout.parseInstance(new Dog()).toPrintable()); ç”±äºŽåå‘é”æ˜¯æœ‰å»¶è¿Ÿçš„ï¼Œç›´æŽ¥ ç»™å¯¹è±¡åŠ é”æ˜¯ çœ‹ä¸åˆ° åå‘é” æ•ˆæžœçš„ï¼Œå¯ä»¥ä½¿ç”¨Thread.sleep(4000)ï¼Œæˆ–è€… å¼€å¯ç¦ç”¨ åå‘é”å»¶è¿Ÿ -XX:BiasedLockingStartupDelay=0 2ï¼‰ æµ‹è¯•åå‘é” 1class Dog &#123;&#125; åˆ©ç”¨ jol ç¬¬ä¸‰æ–¹å·¥å…·æ¥æŸ¥çœ‹å¯¹è±¡å¤´ä¿¡æ¯ï¼ˆæ³¨æ„è¿™é‡Œæˆ‘æ‰©å±•äº† jol è®©å®ƒè¾“å‡ºæ›´ä¸ºç®€æ´ï¼‰ 12345 &lt;dependency&gt; &lt;groupId&gt;org.openjdk.jol&lt;/groupId&gt; &lt;artifactId&gt;jol-core&lt;/artifactId&gt; &lt;version&gt;0.9&lt;/version&gt;&lt;/dependency&gt; 123456789101112131415161718192021// æ·»åŠ è™šæ‹Ÿæœºå‚æ•° -XX:BiasedLockingStartupDelay=0 //æ²¡æœ‰ å»¶è¿Ÿç­‰å¾…çš„è¯ã€‚å°±çœ‹ä¸åˆ° åå‘é”çš„æ•ˆæžœThread.sleep(4000);Dog d = new Dog();ClassLayout classLayout = ClassLayout.parseInstance(d);new Thread(() -&gt; &#123; log.debug(&quot;synchronized å‰&quot;); System.out.println(classLayout.toPrintable()); synchronized (d) &#123; log.debug(&quot;synchronized ä¸­&quot;); System.out.println(classLayout.toPrintable()); &#125; log.debug(&quot;synchronized åŽ&quot;); System.out.println(classLayout.toPrintable());&#125;, &quot;t1&quot;).start(); æœ‰äº†åå‘é”åŽ 123456789101112131415161718192021// æ·»åŠ è™šæ‹Ÿæœºå‚æ•° -XX:BiasedLockingStartupDelay=0 //æ²¡æœ‰ å»¶è¿Ÿç­‰å¾…çš„è¯ã€‚å°±çœ‹ä¸åˆ° åå‘é”çš„æ•ˆæžœThread.sleep(4000);Dog d = new Dog();ClassLayout classLayout = ClassLayout.parseInstance(d);new Thread(() -&gt; &#123; log.debug(&quot;synchronized å‰&quot;); System.out.println(classLayout.toPrintable()); synchronized (d) &#123; log.debug(&quot;synchronized ä¸­&quot;); System.out.println(classLayout.toPrintable()); &#125; log.debug(&quot;synchronized åŽ&quot;); System.out.println(classLayout.toPrintable());&#125;, &quot;t1&quot;).start(); è§‚å¯Ÿåå‘é”ä¸Žæ²¡æœ‰åå‘é”å¯¼è‡´é‡å…¥é”çš„å·®å¼‚ 12345678910111213//æ²¡æœ‰ å»¶è¿Ÿç­‰å¾…çš„è¯ã€‚å°±çœ‹ä¸åˆ° åå‘é”çš„æ•ˆæžœThread.sleep(4000);Dog d = new Dog();log.debug(ClassLayout.parseInstance(d).toPrintable());synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintable());&#125;synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintable());&#125; æ²¡æœ‰åå‘é”ï¼Œéœ€è¦é”é‡å…¥CAS 12345678910Dog d = new Dog();log.debug(ClassLayout.parseInstance(d).toPrintable());synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintable());&#125;synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintable());&#125; æ’¤é”€ - è°ƒç”¨å¯¹è±¡ hashCodeè°ƒç”¨äº†å¯¹è±¡çš„ hashCodeï¼Œä½†åå‘é”çš„å¯¹è±¡ MarkWord ä¸­å­˜å‚¨çš„æ˜¯çº¿ç¨‹ idï¼Œå¦‚æžœè°ƒç”¨ hashCode ä¼šå¯¼è‡´åå‘é”è¢«æ’¤é”€ è½»é‡çº§é”ä¼šåœ¨é”è®°å½•ä¸­è®°å½• hashCode é‡é‡çº§é”ä¼šåœ¨ Monitor ä¸­è®°å½• hashCode åœ¨è°ƒç”¨ hashCode åŽä½¿ç”¨åå‘é”ï¼Œè®°å¾—åŽ»æŽ‰ -XX:-UseBiasedLocking (ç¦ç”¨åå‘é”) 123456789101112Thread.sleep(4000);Dog d = new Dog();d.hashCode();log.debug(ClassLayout.parseInstance(d).toPrintable());synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintable());&#125;log.debug(ClassLayout.parseInstance(d).toPrintable()); è¾“å‡º 123456711:22:10.386 c.TestBiased [main] - è°ƒç”¨ hashCode:177853501511:22:10.391 c.TestBiased [t1] - synchronized å‰00000000 00000000 00000000 01101010 00000010 01001010 01100111 0000000111:22:10.393 c.TestBiased [t1] - synchronized ä¸­00000000 00000000 00000000 00000000 00100000 11000011 11110011 0110100011:22:10.393 c.TestBiased [t1] - synchronized åŽ00000000 00000000 00000000 01101010 00000010 01001010 01100111 00000001 æ’¤é”€ - å…¶ä»–çº¿ç¨‹ä½¿ç”¨å¯¹è±¡å½“æœ‰å…¶å®ƒçº¿ç¨‹ä½¿ç”¨åå‘é”å¯¹è±¡æ—¶ï¼Œä¼šå°†åå‘é”å‡çº§ä¸ºè½»é‡çº§é” 12345678910111213141516171819202122232425262728293031323334private static void test2() throws InterruptedException &#123; Dog d = new Dog(); Thread t1 = new Thread(() -&gt; &#123; synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; synchronized (TestBiased.class) &#123; TestBiased.class.notify(); &#125; // å¦‚æžœä¸ç”¨ wait/notify ä½¿ç”¨ join å¿…é¡»æ‰“å¼€ä¸‹é¢çš„æ³¨é‡Š // å› ä¸ºï¼št1 çº¿ç¨‹ä¸èƒ½ç»“æŸï¼Œå¦åˆ™åº•å±‚çº¿ç¨‹å¯èƒ½è¢« jvm é‡ç”¨ä½œä¸º t2 çº¿ç¨‹ï¼Œåº•å±‚çº¿ç¨‹ id æ˜¯ä¸€æ ·çš„ /*try &#123; System.in.read(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125;*/ &#125;, &quot;t1&quot;); t1.start(); Thread t2 = new Thread(() -&gt; &#123; synchronized (TestBiased.class) &#123; try &#123; TestBiased.class.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125;, &quot;t2&quot;); t2.start();&#125; è¾“å‡º 1234[t1] - 00000000 00000000 00000000 00000000 00011111 01000001 00010000 00000101[t2] - 00000000 00000000 00000000 00000000 00011111 01000001 00010000 00000101 [t2] - 00000000 00000000 00000000 00000000 00011111 10110101 11110000 01000000 ç”±äºŽæ˜¯åå‘é”ï¼Œæ’¤é”€é”å† CAS[t2] - 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001 ä¸å¯åå‘ æ’¤é”€ - è°ƒç”¨wait/notify123456789101112131415161718192021222324252627public static void main(String[] args) throws InterruptedException &#123; Dog d = new Dog(); Thread t1 = new Thread(() -&gt; &#123; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); synchronized (d) &#123; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); try &#123; d.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; log.debug(ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; &#125;, &quot;t1&quot;); t1.start(); new Thread(() -&gt; &#123; try &#123; Thread.sleep(6000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (d) &#123; log.debug(&quot;notify&quot;); d.notify(); &#125; &#125;, &quot;t2&quot;).start();&#125; 1234[t1] - 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000101[t1] - 00000000 00000000 00000000 00000000 00011111 10110011 11111000 00000101[t2] - notify[t1] - 00000000 00000000 00000000 00000000 00011100 11010100 00001101 11001010 æ‰¹é‡é‡åå‘å¦‚æžœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ²¡æœ‰ç«žäº‰ï¼Œè¿™æ—¶åå‘äº†çº¿ç¨‹ T1 çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘ T2ï¼Œé‡åå‘ä¼šé‡ç½®å¯¹è±¡çš„ Thread ID å½“æ’¤é”€åå‘é”é˜ˆå€¼è¶…è¿‡ 20 æ¬¡åŽï¼Œjvm ä¼šè¿™æ ·è§‰å¾—ï¼Œæˆ‘æ˜¯ä¸æ˜¯åå‘é”™äº†å‘¢ï¼ŒäºŽæ˜¯ä¼šåœ¨ç»™è¿™äº›å¯¹è±¡åŠ é”æ—¶é‡æ–°åå‘è‡³åŠ é”çº¿ç¨‹ åªä¼šåä¸€æ¬¡ï¼Œå¦‚æžœåˆæœ‰ä¸€ä¸ªçº¿ç¨‹ åŠ é”ï¼Œå®ƒä¸ä¼šåœ¨ é”é˜ˆå€¼ è¶…è¿‡20 æ¬¡ é‡åå‘ï¼Œä¸è¿‡åœ¨ 40 æ¬¡ä¹‹åŽä¼šæ’¤é”€ åå‘é”ï¼Œå‡çº§ä¸º è½»é‡é” CAS 12345678910111213141516171819202122232425262728293031323334353637private static void test3() throws InterruptedException &#123; Vector&lt;Dog&gt; list = new Vector&lt;&gt;(); Thread t1 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; 30; i++) &#123; Dog d = new Dog(); list.add(d); synchronized (d) &#123; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; &#125; synchronized (list) &#123; // list.notify(); &#125; &#125;, &quot;t1&quot;); t1.start(); Thread t2 = new Thread(() -&gt; &#123; synchronized (list) &#123; try &#123; list.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;===============&gt; &quot;); for (int i = 0; i &lt; 30; i++) &#123; Dog d = list.get(i); log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); synchronized (d) &#123; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; &#125;, &quot;t2&quot;); t2.start();&#125; è¾“å‡º 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121[t1] - 0 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 1 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 2 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 3 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 4 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 5 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 6 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 7 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 8 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 9 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 10 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 11 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 12 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 13 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 14 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 15 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 16 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 17 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 18 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 19 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 20 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 21 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 22 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 23 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 24 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 25 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 26 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 27 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 28 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t1] - 29 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - ===============&gt;[t2] - 0 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 0 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 0 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 1 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 1 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 1 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 2 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 2 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 2 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 3 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 3 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 3 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 4 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 4 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 4 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 5 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 5 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 5 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 6 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 6 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 6 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 7 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 7 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 7 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 8 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 8 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 8 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 9 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 9 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 9 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 10 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 10 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 10 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 11 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 11 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 11 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 12 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 12 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 12 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 13 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 13 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 13 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 14 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 14 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 14 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 15 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 15 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 15 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 16 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 16 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 16 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 17 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 17 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 17 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 18 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 18 00000000 00000000 00000000 00000000 00100000 01011000 11110111 00000000[t2] - 18 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000001[t2] - 19 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 19 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 19 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 20 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 20 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 20 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 21 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 21 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 21 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 22 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 22 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 22 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 23 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 23 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 23 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 24 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 24 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 24 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 25 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 25 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 25 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 26 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 26 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 26 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 27 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 27 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 27 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 28 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 28 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 28 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 29 00000000 00000000 00000000 00000000 00011111 11110011 11100000 00000101[t2] - 29 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101[t2] - 29 00000000 00000000 00000000 00000000 00011111 11110011 11110001 00000101 æ‰¹é‡æ’¤é”€å½“æ’¤é”€åå‘é”é˜ˆå€¼è¶…è¿‡ 40 æ¬¡åŽï¼Œjvm ä¼šè¿™æ ·è§‰å¾—ï¼Œè‡ªå·±ç¡®å®žåå‘é”™äº†ï¼Œæ ¹æœ¬å°±ä¸è¯¥åå‘ã€‚äºŽæ˜¯æ•´ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šå˜ä¸ºä¸å¯åå‘çš„ï¼Œæ–°å»ºçš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯åå‘çš„ 123456789101112131415161718192021222324252627282930313233343536373839404142434445static Thread t1,t2,t3;private static void test4() throws InterruptedException &#123; Vector&lt;Dog&gt; list = new Vector&lt;&gt;(); int loopNumber = 39; t1 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; loopNumber; i++) &#123; Dog d = new Dog(); list.add(d); synchronized (d) &#123; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; &#125; LockSupport.unpark(t2); &#125;, &quot;t1&quot;); t1.start(); t2 = new Thread(() -&gt; &#123; LockSupport.park(); log.debug(&quot;===============&gt; &quot;); for (int i = 0; i &lt; loopNumber; i++) &#123; Dog d = list.get(i); log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); synchronized (d) &#123; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; LockSupport.unpark(t3); &#125;, &quot;t2&quot;); t2.start(); t3 = new Thread(() -&gt; &#123; LockSupport.park(); log.debug(&quot;===============&gt; &quot;); for (int i = 0; i &lt; loopNumber; i++) &#123; Dog d = list.get(i); log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); synchronized (d) &#123; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; log.debug(i + &quot;\\t&quot; + ClassLayout.parseInstance(d).toPrintableSimple(true)); &#125; &#125;, &quot;t3&quot;); t3.start(); t3.join(); log.debug(ClassLayout.parseInstance(new Dog()).toPrintableSimple(true));&#125; å‚è€ƒèµ„æ–™https://github.com/farmerjohngit/myblog/issues/12https://www.cnblogs.com/LemonFive/p/11246086.htmlhttps://www.cnblogs.com/LemonFive/p/11248248.htmlåå‘é”è®ºæ–‡ é”æ¶ˆé™¤é”æ¶ˆé™¤ 12345678910111213141516171819@Fork(1)@BenchmarkMode(Mode.AverageTime)@Warmup(iterations=3)@Measurement(iterations=5)@OutputTimeUnit(TimeUnit.NANOSECONDS)public class MyBenchmark &#123; static int x = 0; @Benchmark public void a() throws Exception &#123; x++; &#125; @Benchmark public void b() throws Exception &#123; Object o = new Object(); synchronized (o) &#123; x++; &#125; &#125;&#125; java -jar benchmarks.jar 123Benchmark Mode Samples Score Score error Unitsc.i.MyBenchmark.a avgt 5 1.542 0.056 ns/opc.i.MyBenchmark.b avgt 5 1.518 0.091 ns/op java -XX:-EliminateLocks -jar benchmarks.jar 123Benchmark Mode Samples Score Score error Unitsc.i.MyBenchmark.a avgt 5 1.507 0.108 ns/opc.i.MyBenchmark.b avgt 5 16.976 1.572 ns/op é”ç²—åŒ– å¯¹ç›¸åŒå¯¹è±¡å¤šæ¬¡åŠ é”ï¼Œå¯¼è‡´çº¿ç¨‹å‘ç”Ÿå¤šæ¬¡é‡å…¥ï¼Œå¯ä»¥ä½¿ç”¨é”ç²—åŒ–æ–¹å¼æ¥ä¼˜åŒ–ï¼Œè¿™ä¸åŒäºŽä¹‹å‰è®²çš„ç»†åˆ†é”çš„ç²’åº¦ã€‚ 7. wait notify7.1 å°æ•…äº‹ - ä¸ºä»€ä¹ˆéœ€è¦ wait ç”±äºŽæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°å—ä¸èƒ½ç»§ç»­è¿›è¡Œè®¡ç®— ä½†å°å—å¦‚æžœä¸€ç›´å ç”¨ç€é”ï¼Œå…¶å®ƒäººå°±å¾—ä¸€ç›´é˜»å¡žï¼Œæ•ˆçŽ‡å¤ªä½Ž äºŽæ˜¯è€çŽ‹å•å¼€äº†ä¸€é—´ä¼‘æ¯å®¤ï¼ˆè°ƒç”¨ wait æ–¹æ³•ï¼‰ï¼Œè®©å°å—åˆ°ä¼‘æ¯å®¤ï¼ˆWaitSetï¼‰ç­‰ç€åŽ»äº†ï¼Œä½†è¿™æ—¶é”é‡Šæ”¾å¼€ï¼Œå…¶å®ƒäººå¯ä»¥ç”±è€çŽ‹éšæœºå®‰æŽ’è¿›å±‹ ç›´åˆ°å°Må°†çƒŸé€æ¥ï¼Œå¤§å«ä¸€å£° [ ä½ çš„çƒŸåˆ°äº† ] ï¼ˆè°ƒç”¨ notify æ–¹æ³•ï¼‰ å°å—äºŽæ˜¯å¯ä»¥ç¦»å¼€ä¼‘æ¯å®¤ï¼Œé‡æ–°è¿›å…¥ç«žäº‰é”çš„é˜Ÿåˆ— 7.2 åŽŸç†ä¹‹ wait / notify Owner çº¿ç¨‹å‘çŽ°æ¡ä»¶ä¸æ»¡è¶³ï¼Œè°ƒç”¨ wait æ–¹æ³•ï¼Œå³å¯è¿›å…¥ WaitSet å˜ä¸º WAITING çŠ¶æ€ BLOCKED å’Œ WAITING çš„çº¿ç¨‹éƒ½å¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œä¸å ç”¨ CPU æ—¶é—´ç‰‡ BLOCKED çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹é‡Šæ”¾é”æ—¶å”¤é†’ WAITING çº¿ç¨‹ä¼šåœ¨ Owner çº¿ç¨‹è°ƒç”¨ notify æˆ– notifyAll æ—¶å”¤é†’ï¼Œä½†å”¤é†’åŽå¹¶ä¸æ„å‘³è€…ç«‹åˆ»èŽ·å¾—é”ï¼Œä»éœ€è¿›å…¥EntryList é‡æ–°ç«žäº‰ 7.3 API ä»‹ç» obj.wait() è®©è¿›å…¥ object ç›‘è§†å™¨çš„çº¿ç¨‹åˆ° waitSet ç­‰å¾… obj.notify() åœ¨ object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹ä¸­æŒ‘ä¸€ä¸ªå”¤é†’ obj.notifyAll() è®© object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’ å®ƒä»¬éƒ½æ˜¯çº¿ç¨‹ä¹‹é—´è¿›è¡Œåä½œçš„æ‰‹æ®µï¼Œéƒ½å±žäºŽ Object å¯¹è±¡çš„æ–¹æ³•ã€‚å¿…é¡»èŽ·å¾—æ­¤å¯¹è±¡çš„é”ï¼Œæ‰èƒ½è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435final static Object obj = new Object();public static void main(String[] args) &#123; new Thread(() -&gt; &#123; synchronized (obj) &#123; log.debug(&quot;æ‰§è¡Œ....&quot;); try &#123; obj.wait(); // è®©çº¿ç¨‹åœ¨objä¸Šä¸€ç›´ç­‰å¾…ä¸‹åŽ» &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; log.debug(&quot;å…¶å®ƒä»£ç ....&quot;); &#125; &#125;).start(); new Thread(() -&gt; &#123; synchronized (obj) &#123; log.debug(&quot;æ‰§è¡Œ....&quot;); try &#123; obj.wait(); // è®©çº¿ç¨‹åœ¨objä¸Šä¸€ç›´ç­‰å¾…ä¸‹åŽ» &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; log.debug(&quot;å…¶å®ƒä»£ç ....&quot;); &#125; &#125;).start(); // ä¸»çº¿ç¨‹ä¸¤ç§’åŽæ‰§è¡Œ sleep(2); log.debug(&quot;å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹&quot;); synchronized (obj) &#123; obj.notify(); // å”¤é†’objä¸Šä¸€ä¸ªçº¿ç¨‹ // obj.notifyAll(); // å”¤é†’objä¸Šæ‰€æœ‰ç­‰å¾…çº¿ç¨‹ &#125;&#125; notify çš„ä¸€ç§ç»“æžœ 123420:00:53.096 [Thread-0] c.TestWaitNotify - æ‰§è¡Œ....20:00:53.099 [Thread-1] c.TestWaitNotify - æ‰§è¡Œ....20:00:55.096 [main] c.TestWaitNotify - å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹20:00:55.096 [Thread-0] c.TestWaitNotify - å…¶å®ƒä»£ç .... notifyAll çš„ç»“æžœ 1234519:58:15.457 [Thread-0] c.TestWaitNotify - æ‰§è¡Œ....19:58:15.460 [Thread-1] c.TestWaitNotify - æ‰§è¡Œ....19:58:17.456 [main] c.TestWaitNotify - å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹19:58:17.456 [Thread-1] c.TestWaitNotify - å…¶å®ƒä»£ç ....19:58:17.456 [Thread-0] c.TestWaitNotify - å…¶å®ƒä»£ç .... wait() æ–¹æ³•ä¼šé‡Šæ”¾å¯¹è±¡çš„é”ï¼Œè¿›å…¥ WaitSet ç­‰å¾…åŒºï¼Œä»Žè€Œè®©å…¶ä»–çº¿ç¨‹å°±æœºä¼šèŽ·å–å¯¹è±¡çš„é”ã€‚æ— é™åˆ¶ç­‰å¾…ï¼Œç›´åˆ°notify ä¸ºæ­¢ wait(long n) æœ‰æ—¶é™çš„ç­‰å¾…, åˆ° n æ¯«ç§’åŽç»“æŸç­‰å¾…ï¼Œæˆ–æ˜¯è¢« notify 8. wait notify æ­£ç¡®å§¿åŠ¿å¼€å§‹ä¹‹å‰å…ˆçœ‹çœ‹ 8.1 sleep(long n) å’Œ wait(long n) çš„åŒºåˆ« sleep æ˜¯ Thread æ–¹æ³•ï¼Œè€Œ wait æ˜¯ Object çš„æ–¹æ³• sleep ä¸éœ€è¦å¼ºåˆ¶å’Œ synchronized é…åˆä½¿ç”¨ï¼Œä½† wait éœ€è¦å’Œ synchronized ä¸€èµ·ç”¨ sleep åœ¨ç¡çœ çš„åŒæ—¶ï¼Œä¸ä¼šé‡Šæ”¾å¯¹è±¡é”çš„ï¼Œä½† wait åœ¨ç­‰å¾…çš„æ—¶å€™ä¼šé‡Šæ”¾å¯¹è±¡é” å®ƒä»¬çŠ¶æ€ TIMED_WAITING step1123static final Object room = new Object();static boolean hasCigarette = false;static boolean hasTakeout = false; æ€è€ƒä¸‹é¢çš„è§£å†³æ–¹æ¡ˆå¥½ä¸å¥½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ 1234567891011121314151617181920212223242526new Thread(() -&gt; &#123; synchronized (room) &#123; log.debug(&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasCigarette); if (!hasCigarette) &#123; log.debug(&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;); sleep(2); &#125; log.debug(&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasCigarette); if (hasCigarette) &#123; log.debug(&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;); &#125; &#125;&#125;, &quot;å°å—&quot;).start();for (int i = 0; i &lt; 5; i++) &#123; new Thread(() -&gt; &#123; synchronized (room) &#123; log.debug(&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;); &#125; &#125;, &quot;å…¶å®ƒäºº&quot;).start();&#125;sleep(1);new Thread(() -&gt; &#123; // è¿™é‡Œèƒ½ä¸èƒ½åŠ  synchronized (room)ï¼Ÿ hasCigarette = true; log.debug(&quot;çƒŸåˆ°äº†å™¢ï¼&quot;);&#125;, &quot;é€çƒŸçš„&quot;).start(); è¾“å‡º 1234567891020:49:49.883 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:49:49.887 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼20:49:50.882 [é€çƒŸçš„] c.TestCorrectPosture - çƒŸåˆ°äº†å™¢ï¼20:49:51.887 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[true]20:49:51.887 [å°å—] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:49:51.887 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:49:51.887 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:49:51.888 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:49:51.888 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:49:51.888 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº† å…¶å®ƒå¹²æ´»çš„çº¿ç¨‹ï¼Œéƒ½è¦ä¸€ç›´é˜»å¡žï¼Œæ•ˆçŽ‡å¤ªä½Ž å°å—çº¿ç¨‹å¿…é¡»ç¡è¶³ 2s åŽæ‰èƒ½é†’æ¥ï¼Œå°±ç®—çƒŸæå‰é€åˆ°ï¼Œä¹Ÿæ— æ³•ç«‹åˆ»é†’æ¥ åŠ äº† synchronized (room) åŽï¼Œå°±å¥½æ¯”å°å—åœ¨é‡Œé¢åé”äº†é—¨ç¡è§‰ï¼ŒçƒŸæ ¹æœ¬æ²¡æ³•é€è¿›é—¨ï¼Œmain æ²¡åŠ  synchronized å°±å¥½åƒ main çº¿ç¨‹æ˜¯ç¿»çª—æˆ·è¿›æ¥çš„ è§£å†³æ–¹æ³•ï¼Œä½¿ç”¨ wait - notify æœºåˆ¶ step2æ€è€ƒä¸‹é¢çš„å®žçŽ°è¡Œå—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ 12345678910111213141516171819202122232425262728293031323334new Thread(() -&gt; &#123; synchronized (room) &#123; log.debug(&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasCigarette); if (!hasCigarette) &#123; log.debug(&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;); try &#123; room.wait(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasCigarette); if (hasCigarette) &#123; log.debug(&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;); &#125; &#125;&#125;, &quot;å°å—&quot;).start() for (int i = 0; i &lt; 5; i++) &#123; new Thread(() -&gt; &#123; synchronized (room) &#123; log.debug(&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;); &#125; &#125;, &quot;å…¶å®ƒäºº&quot;).start();&#125;sleep(1);new Thread(() -&gt; &#123; synchronized (room) &#123; hasCigarette = true; log.debug(&quot;çƒŸåˆ°äº†å™¢ï¼&quot;); room.notify(); &#125;&#125;, &quot;é€çƒŸçš„&quot;).start(); è¾“å‡º 1234567891020:51:42.489 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:51:42.493 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼20:51:42.493 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:51:42.493 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:51:42.494 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:51:42.494 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:51:42.494 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:51:43.490 [é€çƒŸçš„] c.TestCorrectPosture - çƒŸåˆ°äº†å™¢ï¼20:51:43.490 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[true]20:51:43.490 [å°å—] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº† è§£å†³äº†å…¶å®ƒå¹²æ´»çš„çº¿ç¨‹é˜»å¡žçš„é—®é¢˜ ä½†å¦‚æžœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…æ¡ä»¶å‘¢ï¼Ÿ step312345678910111213141516171819202122232425262728293031323334353637383940414243444546474849new Thread(() -&gt; &#123; synchronized (room) &#123; log.debug(&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasCigarette); if (!hasCigarette) &#123; log.debug(&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;); try &#123; room.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasCigarette); if (hasCigarette) &#123; log.debug(&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;); &#125; else &#123; log.debug(&quot;æ²¡å¹²æˆæ´»...&quot;); &#125; &#125;&#125;, &quot;å°å—&quot;).start();new Thread(() -&gt; &#123; synchronized (room) &#123; Thread thread = Thread.currentThread(); log.debug(&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasTakeout); if (!hasTakeout) &#123; log.debug(&quot;æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼&quot;); try &#123; room.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[&#123;&#125;]&quot;, hasTakeout); if (hasTakeout) &#123; log.debug(&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;); &#125; else &#123; log.debug(&quot;æ²¡å¹²æˆæ´»...&quot;); &#125; &#125;&#125;, &quot;å°å¥³&quot;).start();sleep(1);new Thread(() -&gt; &#123; synchronized (room) &#123; hasTakeout = true; log.debug(&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;); room.notify(); &#125;&#125;, &quot;é€å¤–å–çš„&quot;).start(); è¾“å‡º 123456720:53:12.173 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:53:12.176 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼20:53:12.176 [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[false]20:53:12.176 [å°å¥³] c.TestCorrectPosture - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼20:53:13.174 [é€å¤–å–çš„] c.TestCorrectPosture - å¤–å–åˆ°äº†å™¢ï¼20:53:13.174 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:53:13.174 [å°å—] c.TestCorrectPosture - æ²¡å¹²æˆæ´»... notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ª WaitSet ä¸­çš„çº¿ç¨‹ï¼Œè¿™æ—¶å¦‚æžœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå°±å¯èƒ½å”¤é†’ä¸äº†æ­£ç¡®çš„çº¿ç¨‹ï¼Œç§°ä¹‹ä¸ºã€è™šå‡å”¤é†’ã€‘ è§£å†³æ–¹æ³•ï¼Œæ”¹ä¸º notifyAll step41234567new Thread(() -&gt; &#123;synchronized (room) &#123; hasTakeout = true; log.debug(&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;); room.notifyAll();&#125;&#125;, &quot;é€å¤–å–çš„&quot;).start(); è¾“å‡º 12345678920:55:23.978 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:55:23.982 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼20:55:23.982 [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[false]20:55:23.982 [å°å¥³] c.TestCorrectPosture - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼20:55:24.979 [é€å¤–å–çš„] c.TestCorrectPosture - å¤–å–åˆ°äº†å™¢ï¼20:55:24.979 [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[true]20:55:24.980 [å°å¥³] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:55:24.980 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:55:24.980 [å°å—] c.TestCorrectPosture - æ²¡å¹²æˆæ´»... ç”¨ notifyAll ä»…è§£å†³æŸä¸ªçº¿ç¨‹çš„å”¤é†’é—®é¢˜ï¼Œä½†ä½¿ç”¨ if + wait åˆ¤æ–­ä»…æœ‰ä¸€æ¬¡æœºä¼šï¼Œä¸€æ—¦æ¡ä»¶ä¸æˆç«‹ï¼Œå°±æ²¡æœ‰é‡æ–°åˆ¤æ–­çš„æœºä¼šäº† è§£å†³æ–¹æ³•ï¼Œç”¨ while + waitï¼Œå½“æ¡ä»¶ä¸æˆç«‹ï¼Œå†æ¬¡ wait step5å°† if æ”¹ä¸º while 12345678if (!hasCigarette) &#123; log.debug(&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;); try &#123; room.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125; æ”¹åŠ¨åŽ 12345678while (!hasCigarette) &#123; log.debug(&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;); try &#123; room.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125; è¾“å‡º 1234567820:58:34.322 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false]20:58:34.326 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼20:58:34.326 [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[false]20:58:34.326 [å°å¥³] c.TestCorrectPosture - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼20:58:35.323 [é€å¤–å–çš„] c.TestCorrectPosture - å¤–å–åˆ°äº†å™¢ï¼20:58:35.324 [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[true]20:58:35.324 [å°å¥³] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†20:58:35.324 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼ 1234567891011synchronized(lock) &#123; while(æ¡ä»¶ä¸æˆç«‹) &#123; lock.wait(); &#125;// å¹²æ´»&#125;//å¦ä¸€ä¸ªçº¿ç¨‹synchronized(lock) &#123; lock.notifyAll();&#125; åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœå®šä¹‰è¦ç‚¹ ä¸Žå‰é¢çš„ä¿æŠ¤æ€§æš‚åœä¸­çš„ GuardObject ä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æžœå’Œæ¶ˆè´¹ç»“æžœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº” æ¶ˆè´¹é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æº ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æžœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æžœæ•°æ® æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ® JDK ä¸­å„ç§é˜»å¡žé˜Ÿåˆ—ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼ å®žçŽ°123456789101112131415161718192021222324class GuardedObject &#123; private Object response; private final Object lock = new Object(); public Object get() &#123; synchronized (lock) &#123; // æ¡ä»¶ä¸æ»¡è¶³åˆ™ç­‰å¾… while (response == null) &#123; try &#123; lock.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; return response; &#125; &#125; public void complete(Object response) &#123; synchronized (lock) &#123; // æ¡ä»¶æ»¡è¶³ï¼Œé€šçŸ¥ç­‰å¾…çº¿ç¨‹ this.response = response; lock.notifyAll(); &#125; &#125;&#125; åº”ç”¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æžœ 123456789101112131415161718public static void main(String[] args) &#123; GuardedObject guardedObject = new GuardedObject(); new Thread(() -&gt; &#123; try &#123; // å­çº¿ç¨‹æ‰§è¡Œä¸‹è½½ List&lt;String&gt; response = download(); log.debug(&quot;download complete...&quot;); guardedObject.complete(response); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;).start(); log.debug(&quot;waiting...&quot;); // ä¸»çº¿ç¨‹é˜»å¡žç­‰å¾… Object response = guardedObject.get(); log.debug(&quot;get response: [&#123;&#125;] lines&quot;, ((List&lt;String&gt;) response).size());&#125; æ‰§è¡Œç»“æžœ 12308:42:18.568 [main] c.TestGuardedObject - waiting...08:42:23.312 [Thread-0] c.TestGuardedObject - download complete...08:42:23.312 [main] c.TestGuardedObject - get response: [3] lines å¸¦è¶…æ—¶ç‰ˆ GuarderObjectå¦‚æžœè¦æŽ§åˆ¶è¶…æ—¶æ—¶é—´å‘¢ 1234567891011121314151617181920212223242526272829303132333435363738394041class GuardedObjectV2 &#123; private Object response; private final Object lock = new Object(); public Object get(long millis) &#123; synchronized (lock) &#123; // 1) è®°å½•æœ€åˆæ—¶é—´ long begin = System.currentTimeMillis(); // 2) å·²ç»ç»åŽ†çš„æ—¶é—´ long timePassed = 0; while (response == null) &#123; // 4) å‡è®¾ millis æ˜¯ 1000ï¼Œç»“æžœåœ¨ 400 æ—¶å”¤é†’äº†ï¼Œé‚£ä¹ˆè¿˜æœ‰ 600 è¦ç­‰ long waitTime = millis - timePassed; log.debug(&quot;waitTime: &#123;&#125;&quot;, waitTime); if (waitTime &lt;= 0) &#123; log.debug(&quot;break...&quot;); break; &#125; try &#123; lock.wait(waitTime); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; // 3) å¦‚æžœæå‰è¢«å”¤é†’ï¼Œè¿™æ—¶å·²ç»ç»åŽ†çš„æ—¶é—´å‡è®¾ä¸º 400 timePassed = System.currentTimeMillis() - begin; log.debug(&quot;timePassed: &#123;&#125;, object is null &#123;&#125;&quot;, timePassed, response == null); &#125; return response; &#125; &#125; public void complete(Object response) &#123; synchronized (lock) &#123; // æ¡ä»¶æ»¡è¶³ï¼Œé€šçŸ¥ç­‰å¾…çº¿ç¨‹ this.response = response; log.debug(&quot;notify...&quot;); lock.notifyAll(); &#125; &#125; &#125; æµ‹è¯•ï¼Œæ²¡æœ‰è¶…æ—¶ 123456789101112131415public static void main(String[] args) &#123; GuardedObjectV2 v2 = new GuardedObjectV2(); new Thread(() -&gt; &#123; sleep(1); v2.complete(null); sleep(1); v2.complete(Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)); &#125;).start(); Object response = v2.get(2500); if (response != null) &#123; log.debug(&quot;get response: [&#123;&#125;] lines&quot;, ((List&lt;String&gt;) response).size()); &#125; else &#123; log.debug(&quot;can&#x27;t get response&quot;); &#125;&#125; è¾“å‡º 123456708:49:39.917 [main] c.GuardedObjectV2 - waitTime: 250008:49:40.917 [Thread-0] c.GuardedObjectV2 - notify...08:49:40.917 [main] c.GuardedObjectV2 - timePassed: 1003, object is null true08:49:40.917 [main] c.GuardedObjectV2 - waitTime: 149708:49:41.918 [Thread-0] c.GuardedObjectV2 - notify...08:49:41.918 [main] c.GuardedObjectV2 - timePassed: 2004, object is null false08:49:41.918 [main] c.TestGuardedObjectV2 - get response: [3] lines æµ‹è¯•ï¼Œè¶…æ—¶ 12// ç­‰å¾…æ—¶é—´ä¸è¶³List&lt;String&gt; lines = v2.get(1500); è¾“å‡º 12345678908:47:54.963 [main] c.GuardedObjectV2 - waitTime: 150008:47:55.963 [Thread-0] c.GuardedObjectV2 - notify...08:47:55.963 [main] c.GuardedObjectV2 - timePassed: 1002, object is null true08:47:55.963 [main] c.GuardedObjectV2 - waitTime: 49808:47:56.461 [main] c.GuardedObjectV2 - timePassed: 1500, object is null true08:47:56.461 [main] c.GuardedObjectV2 - waitTime: 008:47:56.461 [main] c.GuardedObjectV2 - break...08:47:56.461 [main] c.TestGuardedObjectV2 - can&#x27;t get response08:47:56.963 [Thread-0] c.GuardedObjectV2 - notify... åŽŸç†ä¹‹ joinæ˜¯è°ƒç”¨è€…è½®è¯¢æ£€æŸ¥çº¿ç¨‹ alive çŠ¶æ€ 1t1.join(); ç­‰ä»·äºŽä¸‹é¢çš„ä»£ç  123456synchronized (t1) &#123; // è°ƒç”¨è€…çº¿ç¨‹è¿›å…¥ t1 çš„ waitSet ç­‰å¾…, å³ è°ƒç”¨ join æ–¹æ³•çš„ çº¿ç¨‹, ç›´åˆ° t1 è¿è¡Œç»“æŸ while (t1.isAlive()) &#123; t1.wait(0);// è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œä¼šä¸€ç›´ç¡çœ  &#125;&#125; æ³¨æ„ join ä½“çŽ°çš„æ˜¯ã€ä¿æŠ¤æ€§æš‚åœã€‘æ¨¡å¼ï¼Œè¯·å‚è€ƒä¹‹ å¤šä»»åŠ¡ç‰ˆ GuarderObjectå›¾ä¸­ Futures å°±å¥½æ¯”å±…æ°‘æ¥¼ä¸€å±‚çš„ä¿¡ç®±ï¼ˆæ¯ä¸ªä¿¡ç®±æœ‰æˆ¿é—´ç¼–å·ï¼‰ï¼Œå·¦ä¾§çš„ t0ï¼Œt2ï¼Œt4 å°±å¥½æ¯”ç­‰å¾…é‚®ä»¶çš„å±…æ°‘ï¼Œå³ä¾§çš„ t1ï¼Œt3ï¼Œt5 å°±å¥½æ¯”é‚®é€’å‘˜ å¦‚æžœéœ€è¦åœ¨å¤šä¸ªç±»ä¹‹é—´ä½¿ç”¨ GuardedObject å¯¹è±¡ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå› æ­¤è®¾è®¡ä¸€ä¸ªç”¨æ¥è§£è€¦çš„ä¸­é—´ç±»ï¼Œè¿™æ ·ä¸ä»…èƒ½å¤Ÿè§£è€¦ã€ç»“æžœç­‰å¾…è€…ã€‘å’Œã€ç»“æžœç”Ÿäº§è€…ã€‘ï¼Œè¿˜èƒ½å¤ŸåŒæ—¶æ”¯æŒå¤šä¸ªä»»åŠ¡çš„ç®¡ç† æ–°å¢ž id ç”¨æ¥æ ‡è¯† Guarded Object 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051class GuardedObject &#123; // æ ‡è¯† Guarded Object private int id; public GuardedObject(int id) &#123; this.id = id; &#125; public int getId() &#123; return id; &#125; // ç»“æžœ private Object response; // èŽ·å–ç»“æžœ // timeout è¡¨ç¤ºè¦ç­‰å¾…å¤šä¹… 2000 public Object get(long timeout) &#123; synchronized (this) &#123; // å¼€å§‹æ—¶é—´ 15:00:00 long begin = System.currentTimeMillis(); // ç»åŽ†çš„æ—¶é—´ long passedTime = 0; while (response == null) &#123; // è¿™ä¸€è½®å¾ªçŽ¯åº”è¯¥ç­‰å¾…çš„æ—¶é—´ long waitTime = timeout - passedTime; // ç»åŽ†çš„æ—¶é—´è¶…è¿‡äº†æœ€å¤§ç­‰å¾…æ—¶é—´æ—¶ï¼Œé€€å‡ºå¾ªçŽ¯ if (timeout - passedTime &lt;= 0) &#123; break; &#125; try &#123; this.wait(waitTime); // è™šå‡å”¤é†’ 15:00:01 &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; // æ±‚å¾—ç»åŽ†æ—¶é—´ passedTime = System.currentTimeMillis() - begin; // 15:00:02 1s &#125; return response; &#125; &#125; // äº§ç”Ÿç»“æžœ public void complete(Object response) &#123; synchronized (this) &#123; // ç»™ç»“æžœæˆå‘˜å˜é‡èµ‹å€¼ this.response = response; this.notifyAll(); &#125; &#125; &#125; ä¸­é—´è§£è€¦ç±» 1234567891011121314151617181920212223class Mailboxes &#123; private static Map&lt;Integer, GuardedObject&gt; boxes = new Hashtable&lt;&gt;(); private static int id = 1; // äº§ç”Ÿå”¯ä¸€ id private static synchronized int generateId() &#123; return id++; &#125; public static GuardedObject getGuardedObject(int id) &#123; return boxes.remove(id); &#125; public static GuardedObject createGuardedObject() &#123; GuardedObject go = new GuardedObject(generateId()); boxes.put(go.getId(), go); return go; &#125; public static Set&lt;Integer&gt; getIds() &#123; return boxes.keySet(); &#125;&#125; ä¸šåŠ¡ç›¸å…³ç±» 12345678910class People extends Thread&#123; @Override public void run() &#123; // æ”¶ä¿¡ GuardedObject guardedObject = Mailboxes.createGuardedObject(); log.debug(&quot;å¼€å§‹æ”¶ä¿¡ id:&#123;&#125;&quot;, guardedObject.getId()); Object mail = guardedObject.get(5000); log.debug(&quot;æ”¶åˆ°ä¿¡ id:&#123;&#125;, å†…å®¹:&#123;&#125;&quot;, guardedObject.getId(), mail); &#125;&#125; 12345678910111213141516class Postman extends Thread &#123; private int id; private String mail; public Postman(int id, String mail) &#123; this.id = id; this.mail = mail; &#125; @Override public void run() &#123; GuardedObject guardedObject = Mailboxes.getGuardedObject(id); log.debug(&quot;é€ä¿¡ id:&#123;&#125;, å†…å®¹:&#123;&#125;&quot;, id, mail); guardedObject.complete(mail); &#125;&#125; æµ‹è¯• 12345678910public static void main(String[] args) throws InterruptedException &#123; for (int i = 0; i &lt; 3; i++) &#123; new People().start(); &#125; Sleeper.sleep(1); for (Integer id : Mailboxes.getIds()) &#123; new Postman(id, &quot;å†…å®¹&quot; + id).start(); &#125;&#125; æŸæ¬¡è¿è¡Œç»“æžœ 12345678910:35:05.689 c.People [Thread-1] - å¼€å§‹æ”¶ä¿¡ id:310:35:05.689 c.People [Thread-2] - å¼€å§‹æ”¶ä¿¡ id:110:35:05.689 c.People [Thread-0] - å¼€å§‹æ”¶ä¿¡ id:210:35:06.688 c.Postman [Thread-4] - é€ä¿¡ id:2, å†…å®¹:å†…å®¹210:35:06.688 c.Postman [Thread-5] - é€ä¿¡ id:1, å†…å®¹:å†…å®¹110:35:06.688 c.People [Thread-0] - æ”¶åˆ°ä¿¡ id:2, å†…å®¹:å†…å®¹210:35:06.688 c.People [Thread-2] - æ”¶åˆ°ä¿¡ id:1, å†…å®¹:å†…å®¹110:35:06.688 c.Postman [Thread-3] - é€ä¿¡ id:3, å†…å®¹:å†…å®¹310:35:06.689 c.People [Thread-1] - æ”¶åˆ°ä¿¡ id:3, å†…å®¹:å†…å®¹3 å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…/æ¶ˆè´¹è€…å®šä¹‰è¦ç‚¹ ä¸Žå‰é¢çš„ä¿æŠ¤æ€§æš‚åœä¸­çš„ GuardObject ä¸åŒï¼Œä¸éœ€è¦äº§ç”Ÿç»“æžœå’Œæ¶ˆè´¹ç»“æžœçš„çº¿ç¨‹ä¸€ä¸€å¯¹åº” æ¶ˆè´¹é˜Ÿåˆ—å¯ä»¥ç”¨æ¥å¹³è¡¡ç”Ÿäº§å’Œæ¶ˆè´¹çš„çº¿ç¨‹èµ„æº ç”Ÿäº§è€…ä»…è´Ÿè´£äº§ç”Ÿç»“æžœæ•°æ®ï¼Œä¸å…³å¿ƒæ•°æ®è¯¥å¦‚ä½•å¤„ç†ï¼Œè€Œæ¶ˆè´¹è€…ä¸“å¿ƒå¤„ç†ç»“æžœæ•°æ® æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æœ‰å®¹é‡é™åˆ¶çš„ï¼Œæ»¡æ—¶ä¸ä¼šå†åŠ å…¥æ•°æ®ï¼Œç©ºæ—¶ä¸ä¼šå†æ¶ˆè€—æ•°æ® JDK ä¸­å„ç§é˜»å¡žé˜Ÿåˆ—ï¼Œé‡‡ç”¨çš„å°±æ˜¯è¿™ç§æ¨¡å¼ å®žçŽ°1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859class Message &#123; private int id; private Object message; public Message(int id, Object message) &#123; this.id = id; this.message = message; &#125; public int getId() &#123; return id; &#125; public Object getMessage() &#123; return message; &#125;&#125;class MessageQueue &#123; private LinkedList&lt;Message&gt; queue; private int capacity; public MessageQueue(int capacity) &#123; this.capacity = capacity; queue = new LinkedList&lt;&gt;(); &#125; public Message take() &#123; synchronized (queue) &#123; while (queue.isEmpty()) &#123; log.debug(&quot;æ²¡è´§äº†, wait&quot;); try &#123; queue.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; Message message = queue.removeFirst(); queue.notifyAll(); return message; &#125; &#125; public void put(Message message) &#123; synchronized (queue) &#123; while (queue.size() == capacity) &#123; log.debug(&quot;åº“å­˜å·²è¾¾ä¸Šé™, wait&quot;); try &#123; queue.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; queue.addLast(message); queue.notifyAll(); &#125; &#125; &#125; åº”ç”¨12345678910111213141516171819202122232425MessageQueue messageQueue = new MessageQueue(2);// 4 ä¸ªç”Ÿäº§è€…çº¿ç¨‹, ä¸‹è½½ä»»åŠ¡for (int i = 0; i &lt; 4; i++) &#123; int id = i; new Thread(() -&gt; &#123; try &#123; log.debug(&quot;download...&quot;); List&lt;String&gt; response = Downloader.download(); log.debug(&quot;try put message(&#123;&#125;)&quot;, id); messageQueue.put(new Message(id, response)); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;, &quot;ç”Ÿäº§è€…&quot; + i).start();&#125;// 1 ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹, å¤„ç†ç»“æžœnew Thread(() -&gt; &#123; while (true) &#123; Message message = messageQueue.take(); List&lt;String&gt; response = (List&lt;String&gt;) message.getMessage(); log.debug(&quot;take message(&#123;&#125;): [&#123;&#125;] lines&quot;, message.getId(), response.size()); &#125;&#125;, &quot;æ¶ˆè´¹è€…&quot;).start(); æŸæ¬¡è¿è¡Œç»“æžœ 12345678910111213141516171810:48:38.070 [ç”Ÿäº§è€…3] c.TestProducerConsumer - download...10:48:38.070 [ç”Ÿäº§è€…0] c.TestProducerConsumer - download...10:48:38.070 [æ¶ˆè´¹è€…] c.MessageQueue - æ²¡è´§äº†, wait10:48:38.070 [ç”Ÿäº§è€…1] c.TestProducerConsumer - download...10:48:38.070 [ç”Ÿäº§è€…2] c.TestProducerConsumer - download...10:48:41.236 [ç”Ÿäº§è€…1] c.TestProducerConsumer - try put message(1)10:48:41.237 [ç”Ÿäº§è€…2] c.TestProducerConsumer - try put message(2)10:48:41.236 [ç”Ÿäº§è€…0] c.TestProducerConsumer - try put message(0)10:48:41.237 [ç”Ÿäº§è€…3] c.TestProducerConsumer - try put message(3)10:48:41.239 [ç”Ÿäº§è€…2] c.MessageQueue - åº“å­˜å·²è¾¾ä¸Šé™, wait10:48:41.240 [ç”Ÿäº§è€…1] c.MessageQueue - åº“å­˜å·²è¾¾ä¸Šé™, wait10:48:41.240 [æ¶ˆè´¹è€…] c.TestProducerConsumer - take message(0): [3] lines # è¿™é‡Œå…¶å®žä¸Šé¢ä¸¤ä¸ªç”Ÿäº§ä¸äº†çš„æœ‰ä¸€ä¸ªå·²ç»ç”Ÿäº§äº†ï¼Œåº“å­˜åˆæ»¡äº†10:48:41.240 [ç”Ÿäº§è€…2] c.MessageQueue - åº“å­˜å·²è¾¾ä¸Šé™, wait10:48:41.240 [æ¶ˆè´¹è€…] c.TestProducerConsumer - take message(3): [3] lines10:48:41.240 [æ¶ˆè´¹è€…] c.TestProducerConsumer - take message(1): [3] lines10:48:41.240 [æ¶ˆè´¹è€…] c.TestProducerConsumer - take message(2): [3] lines10:48:41.240 [æ¶ˆè´¹è€…] c.MessageQueue - æ²¡è´§äº†, wait 9. Park &amp; Unpark9.1 åŸºæœ¬ä½¿ç”¨å®ƒä»¬æ˜¯ LockSupport ç±»ä¸­çš„æ–¹æ³• 1234// æš‚åœå½“å‰çº¿ç¨‹LockSupport.park();// æ¢å¤æŸä¸ªçº¿ç¨‹çš„è¿è¡ŒLockSupport.unpark(æš‚åœçº¿ç¨‹å¯¹è±¡) å…ˆ park å† unpark 1234567891011Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;start...&quot;); sleep(1); log.debug(&quot;park...&quot;); LockSupport.park(); log.debug(&quot;resume...&quot;);&#125;,&quot;t1&quot;);t1.start();sleep(2);log.debug(&quot;unpark...&quot;);LockSupport.unpark(t1); è¾“å‡º 123418:42:52.585 c.TestParkUnpark [t1] - start...18:42:53.589 c.TestParkUnpark [t1] - park...18:42:54.583 c.TestParkUnpark [main] - unpark...18:42:54.583 c.TestParkUnpark [t1] - resume... å…ˆ unpark å† park 1234567891011Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;start...&quot;); sleep(2); log.debug(&quot;park...&quot;); LockSupport.park(); log.debug(&quot;resume...&quot;);&#125;, &quot;t1&quot;);t1.start();sleep(1);log.debug(&quot;unpark...&quot;);LockSupport.unpark(t1); è¾“å‡º 123418:43:50.765 c.TestParkUnpark [t1] - start...18:43:51.764 c.TestParkUnpark [main] - unpark...18:43:52.769 c.TestParkUnpark [t1] - park...18:43:52.769 c.TestParkUnpark [t1] - resume... 9.2 ç‰¹ç‚¹ä¸Ž Object çš„ wait &amp; notify ç›¸æ¯” waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ Object Monitor ä¸€èµ·ä½¿ç”¨ï¼Œè€Œ parkï¼Œunpark ä¸å¿… park &amp; unpark æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½æ¥ã€é˜»å¡žã€‘å’Œã€å”¤é†’ã€‘çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAllæ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆã€ç²¾ç¡®ã€‘ park &amp; unpark å¯ä»¥å…ˆ unparkï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify 9.3 åŽŸç†ä¹‹ park &amp; unparkæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€ä¸ª Parker å¯¹è±¡ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆ _counter ï¼Œ _cond å’Œ _mutex æ‰“ä¸ªæ¯”å–» çº¿ç¨‹å°±åƒä¸€ä¸ªæ—…äººï¼ŒParker å°±åƒä»–éšèº«æºå¸¦çš„èƒŒåŒ…ï¼Œæ¡ä»¶å˜é‡å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¸ç¯·ã€‚_counter å°±å¥½æ¯”èƒŒåŒ…ä¸­çš„å¤‡ç”¨å¹²ç²®ï¼ˆ0 ä¸ºè€—å°½ï¼Œ1 ä¸ºå……è¶³ï¼‰ è°ƒç”¨ park å°±æ˜¯è¦çœ‹éœ€ä¸éœ€è¦åœä¸‹æ¥æ­‡æ¯ å¦‚æžœå¤‡ç”¨å¹²ç²®è€—å°½ï¼Œé‚£ä¹ˆé’»è¿›å¸ç¯·æ­‡æ¯ï¼ˆparkä¹‹å‰æ²¡æœ‰unparkï¼‰ å¦‚æžœå¤‡ç”¨å¹²ç²®å……è¶³ï¼Œé‚£ä¹ˆä¸éœ€åœç•™ï¼Œç»§ç»­å‰è¿› ï¼ˆparkä¹‹å‰æœ‰unparkï¼‰ è°ƒç”¨ unparkï¼Œå°±å¥½æ¯”ä»¤å¹²ç²®å……è¶³ å¦‚æžœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨å¸ç¯·ï¼Œå°±å”¤é†’è®©ä»–ç»§ç»­å‰è¿› ï¼ˆparkä¹‹åŽæœ‰unparkï¼‰ å¦‚æžœè¿™æ—¶çº¿ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆä¸‹æ¬¡ä»–è°ƒç”¨ park æ—¶ï¼Œä»…æ˜¯æ¶ˆè€—æŽ‰å¤‡ç”¨å¹²ç²®ï¼Œä¸éœ€åœç•™ï¼Œç»§ç»­å‰è¿› å› ä¸ºèƒŒåŒ…ç©ºé—´æœ‰é™ï¼Œå¤šæ¬¡è°ƒç”¨ unpark ä»…ä¼šè¡¥å……ä¸€ä»½å¤‡ç”¨å¹²ç²® (parkä¹‹å‰æœ‰å¤šæ¬¡unparkï¼Œåªå¯¹é¦–ä¸ªparkèµ·ä½œç”¨) å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³• æ£€æŸ¥ _counter ï¼Œæœ¬æƒ…å†µä¸º 0ï¼Œè¿™æ—¶ï¼ŒèŽ·å¾— _mutex äº’æ–¥é” çº¿ç¨‹è¿›å…¥ _cond æ¡ä»¶å˜é‡é˜»å¡ž è®¾ç½® _counter = 0 è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® _counter ä¸º 1 å”¤é†’ _cond æ¡ä»¶å˜é‡ä¸­çš„ Thread_0 Thread_0 æ¢å¤è¿è¡Œ è®¾ç½® _counter ä¸º 0 è°ƒç”¨ Unsafe.unpark(Thread_0) æ–¹æ³•ï¼Œè®¾ç½® _counter ä¸º 1 å½“å‰çº¿ç¨‹è°ƒç”¨ Unsafe.park() æ–¹æ³• æ£€æŸ¥ _counter ï¼Œæœ¬æƒ…å†µä¸º 1ï¼Œè¿™æ—¶çº¿ç¨‹æ— éœ€é˜»å¡žï¼Œç»§ç»­è¿è¡Œ è®¾ç½® _counter ä¸º 0 10. é‡æ–°ç†è§£çº¿ç¨‹çŠ¶æ€è½¬æ¢ å‡è®¾æœ‰çº¿ç¨‹ Thread t æƒ…å†µ 1 NEW --&gt; RUNNABLE å½“è°ƒç”¨ t.start() æ–¹æ³•æ—¶ï¼Œç”± NEW --&gt; RUNNABLE æƒ…å†µ 2 RUNNABLE &lt;--&gt; WAITINGt çº¿ç¨‹ç”¨ synchronized(obj) èŽ·å–äº†å¯¹è±¡é”åŽ è°ƒç”¨ obj.wait() æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä»Ž RUNNABLE --&gt; WAITING è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶ ç«žäº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä»Ž WAITING --&gt; RUNNABLE ç«žäº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä»Ž WAITING --&gt; BLOCKED 1234567891011121314151617181920212223242526272829303132public class TestWaitNotify &#123; final static Object obj = new Object(); public static void main(String[] args) &#123; new Thread(() -&gt; &#123; synchronized (obj) &#123; log.debug(&quot;æ‰§è¡Œ....&quot;); try &#123; obj.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; log.debug(&quot;å…¶å®ƒä»£ç ....&quot;); // æ–­ç‚¹ &#125; &#125;,&quot;t1&quot;).start(); new Thread(() -&gt; &#123; synchronized (obj) &#123; log.debug(&quot;æ‰§è¡Œ....&quot;); try &#123; obj.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; log.debug(&quot;å…¶å®ƒä»£ç ....&quot;); // æ–­ç‚¹ &#125; &#125;,&quot;t2&quot;).start(); sleep(0.5); log.debug(&quot;å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹&quot;); synchronized (obj) &#123; obj.notifyAll(); // å”¤é†’objä¸Šæ‰€æœ‰ç­‰å¾…çº¿ç¨‹ æ–­ç‚¹ &#125; &#125;&#125; æƒ…å†µ 3 RUNNABLE &lt;--&gt; WAITING å½“å‰çº¿ç¨‹è°ƒç”¨ t.join() æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä»Ž RUNNABLE --&gt; WAITING æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾… t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä»Ž WAITING --&gt; RUNNABLE æƒ…å†µ 4 RUNNABLE &lt;--&gt; WAITING å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.park() æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ä»Ž RUNNABLE --&gt; WAITING è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä»Ž WAITING --&gt;RUNNABLE æƒ…å†µ 5 RUNNABLE &lt;--&gt; TIMED_WAITINGt çº¿ç¨‹ç”¨ synchronized(obj) èŽ·å–äº†å¯¹è±¡é”åŽ è°ƒç”¨ obj.wait(long n) æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä»Ž RUNNABLE --&gt; TIMED_WAITING t çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶ ç«žäº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä»Ž TIMED_WAITING --&gt; RUNNABLE ç«žäº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä»Ž TIMED_WAITING --&gt; BLOCKED æƒ…å†µ 6 RUNNABLE &lt;--&gt; TIMED_WAITING å½“å‰çº¿ç¨‹è°ƒç”¨ t.join(long n) æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä»Ž RUNNABLE --&gt; TIMED_WAITING æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾… å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä»ŽTIMED_WAITING --&gt; RUNNABLE æƒ…å†µ 7 RUNNABLE &lt;--&gt; TIMED_WAITING å½“å‰çº¿ç¨‹è°ƒç”¨ Thread.sleep(long n) ï¼Œå½“å‰çº¿ç¨‹ä»Ž RUNNABLE --&gt; TIMED_WAITING å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä»Ž TIMED_WAITING --&gt; RUNNABLE æƒ…å†µ 8 RUNNABLE &lt;--&gt; TIMED_WAITING å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.parkNanos(long nanos) æˆ– LockSupport.parkUntil(long millis) æ—¶ï¼Œå½“å‰çº¿ç¨‹ä»Ž RUNNABLE --&gt; TIMED_WAITING è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œæˆ–æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä»ŽTIMED_WAITING--&gt; RUNNABLE æƒ…å†µ 9 RUNNABLE &lt;--&gt; BLOCKED t çº¿ç¨‹ç”¨ synchronized(obj) èŽ·å–äº†å¯¹è±¡é”æ—¶å¦‚æžœç«žäº‰å¤±è´¥ï¼Œä»Ž RUNNABLE --&gt; BLOCKED æŒ obj é”çº¿ç¨‹çš„åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’è¯¥å¯¹è±¡ä¸Šæ‰€æœ‰ BLOCKED çš„çº¿ç¨‹é‡æ–°ç«žäº‰ï¼Œå¦‚æžœå…¶ä¸­ t çº¿ç¨‹ç«žäº‰æˆåŠŸï¼Œä»Ž BLOCKED --&gt; RUNNABLE ï¼Œå…¶å®ƒå¤±è´¥çš„çº¿ç¨‹ä»ç„¶ BLOCKED æƒ…å†µ 10 RUNNABLE &lt;â€“&gt; TERMINATEDå½“å‰çº¿ç¨‹æ‰€æœ‰ä»£ç è¿è¡Œå®Œæ¯•ï¼Œè¿›å…¥ TERMINATED 11. å¤šæŠŠé”11.1 å¤šæŠŠä¸ç›¸å¹²çš„é”ä¸€é—´å¤§å±‹å­æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼šç¡è§‰ã€å­¦ä¹ ï¼Œäº’ä¸ç›¸å¹²ã€‚ çŽ°åœ¨å°å—è¦å­¦ä¹ ï¼Œå°å¥³è¦ç¡è§‰ï¼Œä½†å¦‚æžœåªç”¨ä¸€é—´å±‹å­ï¼ˆä¸€ä¸ªå¯¹è±¡é”ï¼‰çš„è¯ï¼Œé‚£ä¹ˆå¹¶å‘åº¦å¾ˆä½Ž è§£å†³æ–¹æ³•æ˜¯å‡†å¤‡å¤šä¸ªæˆ¿é—´ï¼ˆå¤šä¸ªå¯¹è±¡é”ï¼‰ ä¾‹å¦‚ 1234567891011121314class BigRoom &#123; public void sleep() &#123; synchronized (this) &#123; log.debug(&quot;sleeping 2 å°æ—¶&quot;); Sleeper.sleep(2); &#125; &#125; public void study() &#123; synchronized (this) &#123; log.debug(&quot;study 1 å°æ—¶&quot;); Sleeper.sleep(1); &#125; &#125;&#125; æ‰§è¡Œ 1234567BigRoom bigRoom = new BigRoom();new Thread(() -&gt; &#123; bigRoom.compute();&#125;,&quot;å°å—&quot;).start();new Thread(() -&gt; &#123; bigRoom.sleep();&#125;,&quot;å°å¥³&quot;).start(); æŸæ¬¡ç»“æžœ 1212:13:54.471 [å°å—] c.BigRoom - study 1 å°æ—¶12:13:55.476 [å°å¥³] c.BigRoom - sleeping 2 å°æ—¶ æ”¹è¿› 12345678910111213141516171819class BigRoom &#123; private final Object studyRoom = new Object(); private final Object bedRoom = new Object(); public void sleep() &#123; synchronized (bedRoom) &#123; log.debug(&quot;sleeping 2 å°æ—¶&quot;); Sleeper.sleep(2); &#125; &#125; public void study() &#123; synchronized (studyRoom) &#123; log.debug(&quot;study 1 å°æ—¶&quot;); Sleeper.sleep(1); &#125; &#125; &#125; æŸæ¬¡æ‰§è¡Œç»“æžœ 1212:15:35.069 [å°å—] c.BigRoom - study 1 å°æ—¶12:15:35.069 [å°å¥³] c.BigRoom - sleeping 2 å°æ—¶ å°†é”çš„ç²’åº¦ç»†åˆ† å¥½å¤„ï¼Œæ˜¯å¯ä»¥å¢žå¼ºå¹¶å‘åº¦ åå¤„ï¼Œå¦‚æžœä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶èŽ·å¾—å¤šæŠŠé”ï¼Œå°±å®¹æ˜“å‘ç”Ÿæ­»é” 12. æ´»è·ƒæ€§12.1 æ­»é”æœ‰è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦åŒæ—¶èŽ·å–å¤šæŠŠé”ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é” t1 çº¿ç¨‹ èŽ·å¾— Aå¯¹è±¡ é”ï¼ŒæŽ¥ä¸‹æ¥æƒ³èŽ·å– Bå¯¹è±¡ çš„é” t2 çº¿ç¨‹ èŽ·å¾— Bå¯¹è±¡ é”ï¼ŒæŽ¥ä¸‹æ¥æƒ³èŽ·å– Aå¯¹è±¡ çš„é” ã€ ä¾‹ï¼š 123456789101112131415161718192021222324252627Object A = new Object();Object B = new Object();Thread t1 = new Thread(() -&gt; &#123; synchronized (A) &#123; log.debug(&quot;lock A&quot;); sleep(1); synchronized (B) &#123; log.debug(&quot;lock B&quot;); log.debug(&quot;æ“ä½œ...&quot;); &#125; &#125;&#125;, &quot;t1&quot;);Thread t2 = new Thread(() -&gt; &#123; synchronized (B) &#123; log.debug(&quot;lock B&quot;); sleep(0.5); synchronized (A) &#123; log.debug(&quot;lock A&quot;); log.debug(&quot;æ“ä½œ...&quot;); &#125; &#125;&#125;, &quot;t2&quot;);t1.start();t2.start(); ç»“æžœ 1212:22:06.962 [t2] c.TestDeadLock - lock B12:22:06.962 [t1] c.TestDeadLock - lock A 12.2 å®šä½æ­»é” æ£€æµ‹æ­»é”å¯ä»¥ä½¿ç”¨ jconsoleå·¥å…·ï¼Œæˆ–è€…ä½¿ç”¨ jps å®šä½è¿›ç¨‹ idï¼Œå†ç”¨ jstack å®šä½æ­»é”ï¼š 1234567cmd &gt; jpsPicked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-812320 Jps22816 KotlinCompileDaemon33200 TestDeadLock // JVM è¿›ç¨‹11508 Main28468 Launcher 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849cmd &gt; jstack 33200Picked up JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-82018-12-29 05:51:40Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.91-b14 mixed mode):&quot;DestroyJavaVM&quot; #13 prio=5 os_prio=0 tid=0x0000000003525000 nid=0x2f60 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;Thread-1&quot; #12 prio=5 os_prio=0 tid=0x000000001eb69000 nid=0xd40 waiting for monitor entry [0x000000001f54f000] java.lang.Thread.State: BLOCKED (on object monitor) at thread.TestDeadLock.lambda$main$1(TestDeadLock.java:28) - waiting to lock &lt;0x000000076b5bf1c0&gt; (a java.lang.Object) - locked &lt;0x000000076b5bf1d0&gt; (a java.lang.Object) at thread.TestDeadLock$$Lambda$2/883049899.run(Unknown Source) at java.lang.Thread.run(Thread.java:745) &quot;Thread-0&quot; #11 prio=5 os_prio=0 tid=0x000000001eb68800 nid=0x1b28 waiting for monitor entry [0x000000001f44f000] java.lang.Thread.State: BLOCKED (on object monitor) at thread.TestDeadLock.lambda$main$0(TestDeadLock.java:15) - waiting to lock &lt;0x000000076b5bf1d0&gt; (a java.lang.Object) - locked &lt;0x000000076b5bf1c0&gt; (a java.lang.Object) at thread.TestDeadLock$$Lambda$1/495053715.run(Unknown Source) at java.lang.Thread.run(Thread.java:745)// ç•¥åŽ»éƒ¨åˆ†è¾“å‡º Found one Java-level deadlock:============================= &quot;Thread-1&quot;:waiting to lock monitor 0x000000000361d378 (object 0x000000076b5bf1c0, a java.lang.Object),which is held by &quot;Thread-0&quot; &quot;Thread-0&quot;:waiting to lock monitor 0x000000000361e768 (object 0x000000076b5bf1d0, a java.lang.Object),which is held by &quot;Thread-1&quot; Java stack information for the threads listed above:=================================================== &quot;Thread-1&quot;:at thread.TestDeadLock.lambda$main$1(TestDeadLock.java:28) - waiting to lock &lt;0x000000076b5bf1c0&gt; (a java.lang.Object) - locked &lt;0x000000076b5bf1d0&gt; (a java.lang.Object) at thread.TestDeadLock$$Lambda$2/883049899.run(Unknown Source) at java.lang.Thread.run(Thread.java:745) &quot;Thread-0&quot;:at thread.TestDeadLock.lambda$main$0(TestDeadLock.java:15) - waiting to lock &lt;0x000000076b5bf1d0&gt; (a java.lang.Object) - locked &lt;0x000000076b5bf1c0&gt; (a java.lang.Object) at thread.TestDeadLock$$Lambda$1/495053715.run(Unknown Source) at java.lang.Thread.run(Thread.java:745) Found 1 deadlock. é¿å…æ­»é”è¦æ³¨æ„åŠ é”é¡ºåº å¦å¤–å¦‚æžœç”±äºŽæŸä¸ªçº¿ç¨‹è¿›å…¥äº†æ­»å¾ªçŽ¯ï¼Œå¯¼è‡´å…¶å®ƒçº¿ç¨‹ä¸€ç›´ç­‰å¾…ï¼Œå¯¹äºŽè¿™ç§æƒ…å†µ linux ä¸‹å¯ä»¥é€šè¿‡ top å…ˆå®šä½åˆ°CPU å ç”¨é«˜çš„ Java è¿›ç¨‹ï¼Œå†åˆ©ç”¨ top -Hp è¿›ç¨‹id æ¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹ï¼Œæœ€åŽå†ç”¨ jstack æŽ’æŸ¥ 12.3 å“²å­¦å®¶å°±é¤é—®é¢˜ æœ‰äº”ä½å“²å­¦å®¶ï¼Œå›´ååœ¨åœ†æ¡Œæ—ã€‚ ä»–ä»¬åªåšä¸¤ä»¶äº‹ï¼Œæ€è€ƒå’Œåƒé¥­ï¼Œæ€è€ƒä¸€ä¼šåƒå£é¥­ï¼Œåƒå®Œé¥­åŽæŽ¥ç€æ€è€ƒã€‚ åƒé¥­æ—¶è¦ç”¨ä¸¤æ ¹ç­·å­åƒï¼Œæ¡Œä¸Šå…±æœ‰ 5 æ ¹ç­·å­ï¼Œæ¯ä½å“²å­¦å®¶å·¦å³æ‰‹è¾¹å„æœ‰ä¸€æ ¹ç­·å­ã€‚ å¦‚æžœç­·å­è¢«èº«è¾¹çš„äººæ‹¿ç€ï¼Œè‡ªå·±å°±å¾—ç­‰å¾… ç­·å­ç±» 12345678910class Chopstick &#123; String name; public Chopstick(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return &quot;ç­·å­&#123;&quot; + name + &#x27;&#125;&#x27;; &#125;&#125; å“²å­¦å®¶ç±» 12345678910111213141516171819202122232425262728class Philosopher extends Thread &#123; Chopstick left; Chopstick right; public Philosopher(String name, Chopstick left, Chopstick right) &#123; super(name); this.left = left; this.right = right; &#125; private void eat() &#123; log.debug(&quot;eating...&quot;); Sleeper.sleep(1); &#125; @Override public void run() &#123; while (true) &#123; // èŽ·å¾—å·¦æ‰‹ç­·å­ synchronized (left) &#123; // èŽ·å¾—å³æ‰‹ç­·å­ synchronized (right) &#123; // åƒé¥­ eat(); &#125; // æ”¾ä¸‹å³æ‰‹ç­·å­ &#125; // æ”¾ä¸‹å·¦æ‰‹ç­·å­ &#125; &#125;&#125; å°±é¤ 12345678910Chopstick c1 = new Chopstick(&quot;1&quot;);Chopstick c2 = new Chopstick(&quot;2&quot;);Chopstick c3 = new Chopstick(&quot;3&quot;);Chopstick c4 = new Chopstick(&quot;4&quot;);Chopstick c5 = new Chopstick(&quot;5&quot;);new Philosopher(&quot;è‹æ ¼æ‹‰åº•&quot;, c1, c2).start();new Philosopher(&quot;æŸæ‹‰å›¾&quot;, c2, c3).start();new Philosopher(&quot;äºšé‡Œå£«å¤šå¾·&quot;, c3, c4).start();new Philosopher(&quot;èµ«æ‹‰å…‹åˆ©ç‰¹&quot;, c4, c5).start();new Philosopher(&quot;é˜¿åŸºç±³å¾·&quot;, c5, c1).start(); æ‰§è¡Œä¸å¤šä¼šï¼Œå°±æ‰§è¡Œä¸ä¸‹åŽ»äº† 1234512:33:15.575 [è‹æ ¼æ‹‰åº•] c.Philosopher - eating...12:33:15.575 [äºšé‡Œå£«å¤šå¾·] c.Philosopher - eating...12:33:16.580 [é˜¿åŸºç±³å¾·] c.Philosopher - eating...12:33:17.580 [é˜¿åŸºç±³å¾·] c.Philosopher - eating...// å¡åœ¨è¿™é‡Œ, ä¸å‘ä¸‹è¿è¡Œ ä½¿ç”¨ jconsole æ£€æµ‹æ­»é”ï¼Œå‘çŽ° 1234567891011121314151617181920212223242526272829303132333435-------------------------------------------------------------------------åç§°: é˜¿åŸºç±³å¾·çŠ¶æ€: cn.itcast.Chopstick@1540e19d (ç­·å­1) ä¸Šçš„BLOCKED, æ‹¥æœ‰è€…: è‹æ ¼æ‹‰åº•æ€»é˜»æ­¢æ•°: 2, æ€»ç­‰å¾…æ•°: 1å †æ ˆè·Ÿè¸ª:cn.itcast.Philosopher.run(TestDinner.java:48)- å·²é”å®š cn.itcast.Chopstick@6d6f6e28 (ç­·å­5)-------------------------------------------------------------------------åç§°: è‹æ ¼æ‹‰åº•çŠ¶æ€: cn.itcast.Chopstick@677327b6 (ç­·å­2) ä¸Šçš„BLOCKED, æ‹¥æœ‰è€…: æŸæ‹‰å›¾æ€»é˜»æ­¢æ•°: 2, æ€»ç­‰å¾…æ•°: 1å †æ ˆè·Ÿè¸ª:cn.itcast.Philosopher.run(TestDinner.java:48)- å·²é”å®š cn.itcast.Chopstick@1540e19d (ç­·å­1)-------------------------------------------------------------------------åç§°: æŸæ‹‰å›¾çŠ¶æ€: cn.itcast.Chopstick@14ae5a5 (ç­·å­3) ä¸Šçš„BLOCKED, æ‹¥æœ‰è€…: äºšé‡Œå£«å¤šå¾·æ€»é˜»æ­¢æ•°: 2, æ€»ç­‰å¾…æ•°: 0å †æ ˆè·Ÿè¸ª:cn.itcast.Philosopher.run(TestDinner.java:48)- å·²é”å®š cn.itcast.Chopstick@677327b6 (ç­·å­2)-------------------------------------------------------------------------åç§°: äºšé‡Œå£«å¤šå¾·çŠ¶æ€: cn.itcast.Chopstick@7f31245a (ç­·å­4) ä¸Šçš„BLOCKED, æ‹¥æœ‰è€…: èµ«æ‹‰å…‹åˆ©ç‰¹æ€»é˜»æ­¢æ•°: 1, æ€»ç­‰å¾…æ•°: 1å †æ ˆè·Ÿè¸ª:cn.itcast.Philosopher.run(TestDinner.java:48)- å·²é”å®š cn.itcast.Chopstick@14ae5a5 (ç­·å­3)-------------------------------------------------------------------------åç§°: èµ«æ‹‰å…‹åˆ©ç‰¹çŠ¶æ€: cn.itcast.Chopstick@6d6f6e28 (ç­·å­5) ä¸Šçš„BLOCKED, æ‹¥æœ‰è€…: é˜¿åŸºç±³å¾·æ€»é˜»æ­¢æ•°: 2, æ€»ç­‰å¾…æ•°: 0å †æ ˆè·Ÿè¸ª:cn.itcast.Philosopher.run(TestDinner.java:48)- å·²é”å®š cn.itcast.Chopstick@7f31245a (ç­·å­4) è¿™ç§çº¿ç¨‹æ²¡æœ‰æŒ‰é¢„æœŸç»“æŸï¼Œæ‰§è¡Œä¸ä¸‹åŽ»çš„æƒ…å†µï¼Œå½’ç±»ä¸ºã€æ´»è·ƒæ€§ã€‘é—®é¢˜ï¼Œé™¤äº†æ­»é”ä»¥å¤–ï¼Œè¿˜æœ‰æ´»é”å’Œé¥¥é¥¿è€…ä¸¤ç§æƒ…å†µ 12.4 æ´»é”æ´»é”å‡ºçŽ°åœ¨ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œæœ€åŽè°ä¹Ÿæ— æ³•ç»“æŸï¼Œä¾‹å¦‚ 12345678910111213141516171819202122232425public class TestLiveLock &#123; static volatile int count = 10; static final Object lock = new Object(); public static void main(String[] args) &#123; new Thread(() -&gt; &#123; // æœŸæœ›å‡åˆ° 0 é€€å‡ºå¾ªçŽ¯ while (count &gt; 0) &#123; sleep(0.2); count--; log.debug(&quot;count: &#123;&#125;&quot;, count); &#125; &#125;, &quot;t1&quot;).start(); new Thread(() -&gt; &#123; // æœŸæœ›è¶…è¿‡ 20 é€€å‡ºå¾ªçŽ¯ while (count &lt; 20) &#123; sleep(0.2); count++; log.debug(&quot;count: &#123;&#125;&quot;, count); &#125; &#125;, &quot;t2&quot;).start(); &#125;&#125; 12.5 é¥¥é¥¿å¾ˆå¤šæ•™ç¨‹ä¸­æŠŠé¥¥é¥¿å®šä¹‰ä¸ºï¼Œä¸€ä¸ªçº¿ç¨‹ç”±äºŽä¼˜å…ˆçº§å¤ªä½Žï¼Œå§‹ç»ˆå¾—ä¸åˆ° CPU è°ƒåº¦æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½å¤Ÿç»“æŸï¼Œé¥¥é¥¿çš„æƒ…å†µä¸æ˜“æ¼”ç¤ºï¼Œè®²è¯»å†™é”æ—¶ä¼šæ¶‰åŠé¥¥é¥¿é—®é¢˜ ä¸‹é¢æˆ‘è®²ä¸€ä¸‹æˆ‘é‡åˆ°çš„ä¸€ä¸ªçº¿ç¨‹é¥¥é¥¿çš„ä¾‹å­ï¼Œå…ˆæ¥çœ‹çœ‹ä½¿ç”¨é¡ºåºåŠ é”çš„æ–¹å¼è§£å†³ä¹‹å‰çš„æ­»é”é—®é¢˜ 13. ReentrantLockç›¸å¯¹äºŽ synchronized å®ƒå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ å¯ä¸­æ–­ å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é” æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ ä¸Ž synchronized ä¸€æ ·ï¼Œéƒ½æ”¯æŒå¯é‡å…¥ åŸºæœ¬è¯­æ³• 123456789// èŽ·å–é”reentrantLock.lock();try &#123; // ä¸´ç•ŒåŒº&#125; finally &#123; // é‡Šæ”¾é” reentrantLock.unlock();&#125; 13.1 å¯é‡å…¥å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æžœé¦–æ¬¡èŽ·å¾—äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå› ä¸ºå®ƒæ˜¯è¿™æŠŠé”çš„æ‹¥æœ‰è€…ï¼Œå› æ­¤æœ‰æƒåˆ©å†æ¬¡èŽ·å–è¿™æŠŠé”ï¼Œå¦‚æžœæ˜¯ä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡èŽ·å¾—é”æ—¶ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«é”æŒ¡ä½ 12345678910111213141516171819202122232425262728293031323334static ReentrantLock lock = new ReentrantLock();public static void main(String[] args) &#123; method1();&#125;public static void method1() &#123; lock.lock(); try &#123; log.debug(&quot;execute method1&quot;); method2(); &#125; finally &#123; lock.unlock(); &#125;&#125;public static void method2() &#123; lock.lock(); try &#123; log.debug(&quot;execute method2&quot;); method3(); &#125; finally &#123; lock.unlock(); &#125;&#125;public static void method3() &#123; lock.lock(); try &#123; log.debug(&quot;execute method3&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125; è¾“å‡º 12317:59:11.862 [main] c.TestReentrant - execute method117:59:11.865 [main] c.TestReentrant - execute method217:59:11.865 [main] c.TestReentrant - execute method3 13.2 å¯æ‰“æ–­ç¤ºä¾‹ 12345678910111213141516171819202122232425262728ReentrantLock lock = new ReentrantLock();Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;å¯åŠ¨...&quot;); try &#123; lock.lockInterruptibly(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); log.debug(&quot;ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­&quot;); return; &#125; try &#123; log.debug(&quot;èŽ·å¾—äº†é”&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125;, &quot;t1&quot;);lock.lock();log.debug(&quot;èŽ·å¾—äº†é”&quot;);t1.start();try &#123; sleep(1); t1.interrupt(); log.debug(&quot;æ‰§è¡Œæ‰“æ–­&quot;);&#125; finally &#123; lock.unlock();&#125; è¾“å‡º 123456789101112131418:02:40.520 [main] c.TestInterrupt - èŽ·å¾—äº†é”18:02:40.524 [t1] c.TestInterrupt - å¯åŠ¨...18:02:41.530 [main] c.TestInterrupt - æ‰§è¡Œæ‰“æ–­java.lang.InterruptedExceptionatjava.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchronizer.java:898)atjava.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchronizer.java:1222)at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:335)at cn.itcast.n4.reentrant.TestInterrupt.lambda$main$0(TestInterrupt.java:17)at java.lang.Thread.run(Thread.java:748)18:02:41.532 [t1] c.TestInterrupt - ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­ æ³¨æ„ å¦‚æžœæ˜¯ä¸å¯ä¸­æ–­æ¨¡å¼ï¼Œé‚£ä¹ˆå³ä½¿ä½¿ç”¨äº† interrupt ä¹Ÿä¸ä¼šè®©ç­‰å¾…ä¸­æ–­ å¯æ‰“æ–­åªèƒ½åœ¨é˜»å¡žæ—¶è¢«æ‰“æ–­ï¼ˆæ‰“æ–­åŽåªä¼šå†é‡æ–°æ‰§è¡Œå¾ªçŽ¯ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ‰“æ–­ï¼‰ï¼Œè€ŒèŽ·å–é”åŽæ˜¯ä¸å¯æ‰“æ–­çš„ 123456789101112131415161718192021222324ReentrantLock lock = new ReentrantLock();Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;å¯åŠ¨...&quot;); lock.lock(); try &#123; log.debug(&quot;èŽ·å¾—äº†é”&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125;, &quot;t1&quot;);lock.lock();log.debug(&quot;èŽ·å¾—äº†é”&quot;);t1.start();try &#123; sleep(1); t1.interrupt(); log.debug(&quot;æ‰§è¡Œæ‰“æ–­&quot;); sleep(1);&#125; finally &#123; log.debug(&quot;é‡Šæ”¾äº†é”&quot;); lock.unlock();&#125; è¾“å‡º 1234518:06:56.261 [main] c.TestInterrupt - èŽ·å¾—äº†é”18:06:56.265 [t1] c.TestInterrupt - å¯åŠ¨...18:06:57.266 [main] c.TestInterrupt - æ‰§è¡Œæ‰“æ–­ // è¿™æ—¶ t1 å¹¶æ²¡æœ‰è¢«çœŸæ­£æ‰“æ–­, è€Œæ˜¯ä»ç»§ç»­ç­‰å¾…é”18:06:58.267 [main] c.TestInterrupt - é‡Šæ”¾äº†é”18:06:58.267 [t1] c.TestInterrupt - èŽ·å¾—äº†é” 13.3 é”è¶…æ—¶ç«‹åˆ»å¤±è´¥ 12345678910111213141516171819202122ReentrantLock lock = new ReentrantLock();Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;å¯åŠ¨...&quot;); if (!lock.tryLock()) &#123; log.debug(&quot;èŽ·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›ž&quot;); return; &#125; try &#123; log.debug(&quot;èŽ·å¾—äº†é”&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125;, &quot;t1&quot;);lock.lock();log.debug(&quot;èŽ·å¾—äº†é”&quot;);t1.start();try &#123; sleep(2);&#125; finally &#123; lock.unlock();&#125; è¾“å‡º 12318:15:02.918 [main] c.TestTimeout - èŽ·å¾—äº†é”18:15:02.921 [t1] c.TestTimeout - å¯åŠ¨...18:15:02.921 [t1] c.TestTimeout - èŽ·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›ž è¶…æ—¶å¤±è´¥ 1234567891011121314151617181920212223242526ReentrantLock lock = new ReentrantLock();Thread t1 = new Thread(() -&gt; &#123; log.debug(&quot;å¯åŠ¨...&quot;); try &#123; if (!lock.tryLock(1, TimeUnit.SECONDS)) &#123; log.debug(&quot;èŽ·å–ç­‰å¾… 1s åŽå¤±è´¥ï¼Œè¿”å›ž&quot;); return; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; log.debug(&quot;èŽ·å¾—äº†é”&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125;, &quot;t1&quot;);lock.lock();log.debug(&quot;èŽ·å¾—äº†é”&quot;);t1.start();try &#123; sleep(2);&#125; finally &#123; lock.unlock();&#125; è¾“å‡º 12318:19:40.537 [main] c.TestTimeout - èŽ·å¾—äº†é”18:19:40.544 [t1] c.TestTimeout - å¯åŠ¨...18:19:41.547 [t1] c.TestTimeout - èŽ·å–ç­‰å¾… 1s åŽå¤±è´¥ï¼Œè¿”å›ž ä½¿ç”¨ tryLock è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜ 123456789101112class Chopstick extends ReentrantLock &#123; String name; public Chopstick(String name) &#123; this.name = name; &#125; @Override public String toString() &#123; return &quot;ç­·å­&#123;&quot; + name + &#x27;&#125;&#x27;; &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435class Philosopher extends Thread &#123; Chopstick left; Chopstick right; public Philosopher(String name, Chopstick left, Chopstick right) &#123; super(name); this.left = left; this.right = right; &#125; @Override public void run() &#123; while (true) &#123; // å°è¯•èŽ·å¾—å·¦æ‰‹ç­·å­ if (left.tryLock()) &#123; try &#123; // å°è¯•èŽ·å¾—å³æ‰‹ç­·å­ if (right.tryLock()) &#123; try &#123; eat(); &#125; finally &#123; right.unlock(); &#125; &#125; &#125; finally &#123; left.unlock(); &#125; &#125; &#125; &#125; private void eat() &#123; log.debug(&quot;eating...&quot;); Sleeper.sleep(1); &#125;&#125; 13.4 å…¬å¹³é”ReentrantLock é»˜è®¤æ˜¯ä¸å…¬å¹³çš„ 123456789101112131415161718192021222324ReentrantLock lock = new ReentrantLock(false);lock.lock();for (int i = 0; i &lt; 500; i++) &#123; new Thread(() -&gt; &#123; lock.lock(); try &#123; System.out.println(Thread.currentThread().getName() + &quot; running...&quot;); &#125; finally &#123; lock.unlock(); &#125; &#125;, &quot;t&quot; + i).start();&#125;// 1s ä¹‹åŽåŽ»äº‰æŠ¢é”Thread.sleep(1000);new Thread(() -&gt; &#123; System.out.println(Thread.currentThread().getName() + &quot; start...&quot;); lock.lock(); try &#123; System.out.println(Thread.currentThread().getName() + &quot; running...&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125;, &quot;å¼ºè¡Œæ’å…¥&quot;).start();lock.unlock(); å¼ºè¡Œæ’å…¥ï¼Œæœ‰æœºä¼šåœ¨ä¸­é—´è¾“å‡º æ³¨æ„ï¼šè¯¥å®žéªŒä¸ä¸€å®šæ€»èƒ½å¤çŽ° 123456789101112t39 running...t40 running...t41 running...t42 running...t43 running...å¼ºè¡Œæ’å…¥ start...å¼ºè¡Œæ’å…¥ running...t44 running...t45 running...t46 running...t47 running...t49 running... æ”¹ä¸ºå…¬å¹³é”åŽ 1ReentrantLock lock = new ReentrantLock(true); å¼ºè¡Œæ’å…¥ï¼Œæ€»æ˜¯åœ¨æœ€åŽè¾“å‡º 12345678910t465 running...t464 running...t477 running...t442 running...t468 running...t493 running...t482 running...t485 running...t481 running...å¼ºè¡Œæ’å…¥ running... å…¬å¹³é”ä¸€èˆ¬æ²¡æœ‰å¿…è¦ï¼Œä¼šé™ä½Žå¹¶å‘åº¦ï¼ŒåŽé¢åˆ†æžåŽŸç†æ—¶ä¼šè®²è§£ 13.5 æ¡ä»¶å˜é‡synchronized ä¸­ä¹Ÿæœ‰æ¡ä»¶å˜é‡ï¼Œå°±æ˜¯æˆ‘ä»¬è®²åŽŸç†æ—¶é‚£ä¸ª waitSet ä¼‘æ¯å®¤ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è¿›å…¥ waitSet ç­‰å¾…ReentrantLock çš„æ¡ä»¶å˜é‡æ¯” synchronized å¼ºå¤§ä¹‹å¤„åœ¨äºŽï¼Œå®ƒæ˜¯æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡çš„ï¼Œè¿™å°±å¥½æ¯” synchronized æ˜¯é‚£äº›ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹éƒ½åœ¨ä¸€é—´ä¼‘æ¯å®¤ç­‰æ¶ˆæ¯ è€Œ ReentrantLock æ”¯æŒå¤šé—´ä¼‘æ¯å®¤ï¼Œæœ‰ä¸“é—¨ç­‰çƒŸçš„ä¼‘æ¯å®¤ã€ä¸“é—¨ç­‰æ—©é¤çš„ä¼‘æ¯å®¤ã€å”¤é†’æ—¶ä¹Ÿæ˜¯æŒ‰ä¼‘æ¯å®¤æ¥å”¤é†’ ä½¿ç”¨è¦ç‚¹ï¼š await å‰éœ€è¦èŽ·å¾—é” await æ‰§è¡ŒåŽï¼Œä¼šé‡Šæ”¾é”ï¼ˆé€æ˜Žé‡Šæ”¾é”ï¼Œå…³é”®ï¼Œå¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å¤„äºŽwaingï¼‰ï¼Œè¿›å…¥ conditionObject ç­‰å¾… await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«žäº‰ lock é” ç«žäº‰ lock é”æˆåŠŸåŽï¼Œä»Ž await åŽç»§ç»­æ‰§è¡Œ ä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061static ReentrantLock lock = new ReentrantLock();static Condition waitCigaretteQueue = lock.newCondition();static Condition waitbreakfastQueue = lock.newCondition();static volatile boolean hasCigrette = false;static volatile boolean hasBreakfast = false;public static void main(String[] args) &#123; new Thread(() -&gt; &#123; try &#123; lock.lock(); while (!hasCigrette) &#123; try &#123; waitCigaretteQueue.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;ç­‰åˆ°äº†å®ƒçš„çƒŸ&quot;); &#125; finally &#123; lock.unlock(); &#125; &#125;).start(); new Thread(() -&gt; &#123; try &#123; lock.lock(); while (!hasBreakfast) &#123; try &#123; waitbreakfastQueue.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;ç­‰åˆ°äº†å®ƒçš„æ—©é¤&quot;); &#125; finally &#123; lock.unlock(); &#125; &#125;).start(); sleep(1); sendBreakfast(); sleep(1); sendCigarette();&#125;private static void sendCigarette() &#123; lock.lock(); try &#123; log.debug(&quot;é€çƒŸæ¥äº†&quot;); hasCigrette = true; waitCigaretteQueue.signal(); &#125; finally &#123; lock.unlock(); &#125;&#125;private static void sendBreakfast() &#123; lock.lock(); try &#123; log.debug(&quot;é€æ—©é¤æ¥äº†&quot;); hasBreakfast = true; waitbreakfastQueue.signal(); &#125; finally &#123; lock.unlock(); &#125;&#125; è¾“å‡º 123418:52:27.680 [main] c.TestCondition - é€æ—©é¤æ¥äº†18:52:27.682 [Thread-1] c.TestCondition - ç­‰åˆ°äº†å®ƒçš„æ—©é¤18:52:28.683 [main] c.TestCondition - é€çƒŸæ¥äº†18:52:28.683 [Thread-0] c.TestCondition - ç­‰åˆ°äº†å®ƒçš„çƒŸ 13.6 åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæŽ§åˆ¶å›ºå®šè¿è¡Œé¡ºåºæ¯”å¦‚ï¼Œå¿…é¡»å…ˆ 2 åŽ 1 æ‰“å° 1. wait notify ç‰ˆ12345678910111213141516171819202122232425262728293031// ç”¨æ¥åŒæ­¥çš„å¯¹è±¡static Object obj = new Object();// t2 è¿è¡Œæ ‡è®°ï¼Œ ä»£è¡¨ t2 æ˜¯å¦æ‰§è¡Œè¿‡static boolean t2runed = false;public static void main(String[] args) &#123; Thread t1 = new Thread(() -&gt; &#123; synchronized (obj) &#123; // å¦‚æžœ t2 æ²¡æœ‰æ‰§è¡Œè¿‡ while (!t2runed) &#123; try &#123; // t1 å…ˆç­‰ä¸€ä¼š obj.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; System.out.println(1); &#125;); Thread t2 = new Thread(() -&gt; &#123; System.out.println(2); synchronized (obj) &#123; // ä¿®æ”¹è¿è¡Œæ ‡è®° t2runed = true; // é€šçŸ¥ obj ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œå› æ­¤éœ€è¦ç”¨ notifyAllï¼‰ obj.notifyAll(); &#125; &#125;); t1.start(); t2.start();&#125; 2. Park Unpark ç‰ˆå¯ä»¥çœ‹åˆ°ï¼Œå®žçŽ°ä¸Šå¾ˆéº»çƒ¦ï¼š é¦–å…ˆï¼Œéœ€è¦ä¿è¯å…ˆ wait å† notifyï¼Œå¦åˆ™ wait çº¿ç¨‹æ°¸è¿œå¾—ä¸åˆ°å”¤é†’ã€‚å› æ­¤ä½¿ç”¨äº†ã€Žè¿è¡Œæ ‡è®°ã€æ¥åˆ¤æ–­è¯¥ä¸è¯¥wait ç¬¬äºŒï¼Œå¦‚æžœæœ‰äº›å¹²æ‰°çº¿ç¨‹é”™è¯¯åœ° notify äº† wait çº¿ç¨‹ï¼Œæ¡ä»¶ä¸æ»¡è¶³æ—¶è¿˜è¦é‡æ–°ç­‰å¾…ï¼Œä½¿ç”¨äº† while å¾ªçŽ¯æ¥è§£å†³æ­¤é—®é¢˜ æœ€åŽï¼Œå”¤é†’å¯¹è±¡ä¸Šçš„ wait çº¿ç¨‹éœ€è¦ä½¿ç”¨ notifyAllï¼Œå› ä¸ºã€ŽåŒæ­¥å¯¹è±¡ã€ä¸Šçš„ç­‰å¾…çº¿ç¨‹å¯èƒ½ä¸æ­¢ä¸€ä¸ª å¯ä»¥ä½¿ç”¨ LockSupport ç±»çš„ park å’Œ unpark æ¥ç®€åŒ–ä¸Šé¢çš„é¢˜ç›®ï¼š 12345678910111213Thread t1 = new Thread(() -&gt; &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125; // å½“æ²¡æœ‰ã€Žè®¸å¯ã€æ—¶ï¼Œå½“å‰çº¿ç¨‹æš‚åœè¿è¡Œï¼›æœ‰ã€Žè®¸å¯ã€æ—¶ï¼Œç”¨æŽ‰è¿™ä¸ªã€Žè®¸å¯ã€ï¼Œå½“å‰çº¿ç¨‹æ¢å¤è¿è¡Œ LockSupport.park(); System.out.println(&quot;1&quot;);&#125;);Thread t2 = new Thread(() -&gt; &#123; System.out.println(&quot;2&quot;); // ç»™çº¿ç¨‹ t1 å‘æ”¾ã€Žè®¸å¯ã€ï¼ˆå¤šæ¬¡è¿žç»­è°ƒç”¨ unpark åªä¼šå‘æ”¾ä¸€ä¸ªã€Žè®¸å¯ã€ï¼‰ LockSupport.unpark(t1);&#125;);t1.start();t2.start(); park å’Œ unpark æ–¹æ³•æ¯”è¾ƒçµæ´»ï¼Œä»–ä¿©è°å…ˆè°ƒç”¨ï¼Œè°åŽè°ƒç”¨æ— æ‰€è°“ã€‚å¹¶ä¸”æ˜¯ä»¥çº¿ç¨‹ä¸ºå•ä½è¿›è¡Œã€Žæš‚åœã€å’Œã€Žæ¢å¤ã€ï¼Œä¸éœ€è¦ã€ŽåŒæ­¥å¯¹è±¡ã€å’Œã€Žè¿è¡Œæ ‡è®°ã€ äº¤æ›¿è¾“å‡ºçº¿ç¨‹ 1 è¾“å‡º a 5 æ¬¡ï¼Œçº¿ç¨‹ 2 è¾“å‡º b 5 æ¬¡ï¼Œçº¿ç¨‹ 3 è¾“å‡º c 5 æ¬¡ã€‚çŽ°åœ¨è¦æ±‚è¾“å‡º abcabcabcabcabc æ€Žä¹ˆå®žçŽ° wait notify ç‰ˆ123456789101112131415161718192021222324class SyncWaitNotify &#123; private int flag; private int loopNumber; public SyncWaitNotify(int flag, int loopNumber) &#123; this.flag = flag; this.loopNumber = loopNumber; &#125; public void print(int waitFlag, int nextFlag, String str) &#123; for (int i = 0; i &lt; loopNumber; i++) &#123; synchronized (this) &#123; while (this.flag != waitFlag) &#123; try &#123; this.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; System.out.print(str); flag = nextFlag; this.notifyAll(); &#125; &#125; &#125;&#125; 12345678910SyncWaitNotify syncWaitNotify = new SyncWaitNotify(1, 5);new Thread(() -&gt; &#123;syncWaitNotify.print(1, 2, &quot;a&quot;);&#125;).start();new Thread(() -&gt; &#123;syncWaitNotify.print(2, 3, &quot;b&quot;);&#125;).start();new Thread(() -&gt; &#123;syncWaitNotify.print(3, 1, &quot;c&quot;);&#125;).start(); Lock æ¡ä»¶å˜é‡ç‰ˆ123456789101112131415161718192021222324252627282930class AwaitSignal extends ReentrantLock &#123; public void start(Condition first) &#123; this.lock(); try &#123; log.debug(&quot;start&quot;); first.signal(); &#125; finally &#123; this.unlock(); &#125; &#125; public void print(String str, Condition current, Condition next) &#123; for (int i = 0; i &lt; loopNumber; i++) &#123; this.lock(); try &#123; current.await(); log.debug(str); next.signal(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; this.unlock(); &#125; &#125; &#125; // å¾ªçŽ¯æ¬¡æ•° private int loopNumber; public AwaitSignal(int loopNumber) &#123; this.loopNumber = loopNumber; &#125;&#125; 12345678910111213141516171819AwaitSignal as = new AwaitSignal(5);Condition aWaitSet = as.newCondition();Condition bWaitSet = as.newCondition();Condition cWaitSet = as.newCondition();new Thread(() -&gt; &#123; as.print(&quot;a&quot;, aWaitSet, bWaitSet);&#125;).start();new Thread(() -&gt; &#123; as.print(&quot;b&quot;, bWaitSet, cWaitSet);&#125;).start();new Thread(() -&gt; &#123; as.print(&quot;c&quot;, cWaitSet, aWaitSet);&#125;).start();as.start(aWaitSet); æ³¨æ„ è¯¥å®žçŽ°æ²¡æœ‰è€ƒè™‘ aï¼Œbï¼Œc çº¿ç¨‹éƒ½å°±ç»ªå†å¼€å§‹ Park Unpark ç‰ˆ1234567891011121314151617181920212223242526272829303132333435363738394041424344class SyncPark &#123; private int loopNumber; private Thread[] threads; public SyncPark(int loopNumber) &#123; this.loopNumber = loopNumber; &#125; public void setThreads(Thread... threads) &#123; this.threads = threads; &#125; public void print(String str) &#123; for (int i = 0; i &lt; loopNumber; i++) &#123; LockSupport.park(); System.out.print(str); LockSupport.unpark(nextThread()); &#125; &#125; private Thread nextThread() &#123; Thread current = Thread.currentThread(); int index = 0; for (int i = 0; i &lt; threads.length; i++) &#123; if(threads[i] == current) &#123; index = i; break; &#125; &#125; if(index &lt; threads.length - 1) &#123; return threads[index+1]; &#125; else &#123; return threads[0]; &#125; &#125; public void start() &#123; for (Thread thread : threads) &#123; thread.start(); &#125; LockSupport.unpark(threads[0]); &#125; &#125; 123456789101112SyncPark syncPark = new SyncPark(5);Thread t1 = new Thread(() -&gt; &#123; syncPark.print(&quot;a&quot;);&#125;);Thread t2 = new Thread(() -&gt; &#123; syncPark.print(&quot;b&quot;);&#125;);Thread t3 = new Thread(() -&gt; &#123; syncPark.print(&quot;c\\n&quot;);&#125;);syncPark.setThreads(t1, t2, t3);syncPark.start(); 14. æœ¬ç« å°ç»“æœ¬ç« æˆ‘ä»¬éœ€è¦é‡ç‚¹æŽŒæ¡çš„æ˜¯ åˆ†æžå¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œå“ªäº›ä»£ç ç‰‡æ®µå±žäºŽä¸´ç•ŒåŒº ä½¿ç”¨ synchronized äº’æ–¥è§£å†³ä¸´ç•ŒåŒºçš„çº¿ç¨‹å®‰å…¨é—®é¢˜ æŽŒæ¡ synchronized é”å¯¹è±¡è¯­æ³• æŽŒæ¡ synchronzied åŠ è½½æˆå‘˜æ–¹æ³•å’Œé™æ€æ–¹æ³•è¯­æ³• æŽŒæ¡ wait/notify åŒæ­¥æ–¹æ³• ä½¿ç”¨ lock äº’æ–¥è§£å†³ä¸´ç•ŒåŒºçš„çº¿ç¨‹å®‰å…¨é—®é¢˜ æŽŒæ¡ lock çš„ä½¿ç”¨ç»†èŠ‚ï¼šå¯æ‰“æ–­ã€é”è¶…æ—¶ã€å…¬å¹³é”ã€æ¡ä»¶å˜é‡ å­¦ä¼šåˆ†æžå˜é‡çš„çº¿ç¨‹å®‰å…¨æ€§ã€æŽŒæ¡å¸¸è§çº¿ç¨‹å®‰å…¨ç±»çš„ä½¿ç”¨ äº†è§£çº¿ç¨‹æ´»è·ƒæ€§é—®é¢˜ï¼šæ­»é”ã€æ´»é”ã€é¥¥é¥¿ åº”ç”¨æ–¹é¢ äº’æ–¥ï¼šä½¿ç”¨ synchronized æˆ– Lock è¾¾åˆ°å…±äº«èµ„æºäº’æ–¥æ•ˆæžœ åŒæ­¥ï¼šä½¿ç”¨ wait/notify æˆ– Lock çš„æ¡ä»¶å˜é‡æ¥è¾¾åˆ°çº¿ç¨‹é—´é€šä¿¡æ•ˆæžœ åŽŸç†æ–¹é¢ monitorã€synchronized ã€wait/notify åŽŸç† synchronized è¿›é˜¶åŽŸç† park &amp; unpark åŽŸç† æ¨¡å¼æ–¹é¢ åŒæ­¥æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ å¼‚æ­¥æ¨¡å¼ä¹‹ç”Ÿäº§è€…æ¶ˆè´¹è€… åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæŽ§åˆ¶ ä¸‰ã€å…±äº«æ¨¡åž‹ä¹‹å†…å­˜1. æœ¬ç« å†…å®¹ä¸Šä¸€ç« è®²è§£çš„ Monitor ä¸»è¦å…³æ³¨çš„æ˜¯è®¿é—®å…±äº«å˜é‡æ—¶ï¼Œä¿è¯ä¸´ç•ŒåŒºä»£ç çš„åŽŸå­æ€§ è¿™ä¸€ç« æˆ‘ä»¬è¿›ä¸€æ­¥æ·±å…¥å­¦ä¹ å…±äº«å˜é‡åœ¨å¤šçº¿ç¨‹é—´çš„ã€å¯è§æ€§ã€‘é—®é¢˜ä¸Žå¤šæ¡æŒ‡ä»¤æ‰§è¡Œæ—¶çš„ã€æœ‰åºæ€§ã€‘é—®é¢˜ 2. Java å†…å­˜æ¨¡åž‹JMM å³ Java Memory Modelï¼Œå®ƒå®šä¹‰äº†ä¸»å­˜ã€å·¥ä½œå†…å­˜æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚ JMM ä½“çŽ°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ åŽŸå­æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“ å¯è§æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“ æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“ 3. å¯è§æ€§3.1 é€€ä¸å‡ºçš„å¾ªçŽ¯å…ˆæ¥çœ‹ä¸€ä¸ªçŽ°è±¡ï¼Œmain çº¿ç¨‹å¯¹ run å˜é‡çš„ä¿®æ”¹å¯¹äºŽ t çº¿ç¨‹ä¸å¯è§ï¼Œå¯¼è‡´äº† t çº¿ç¨‹æ— æ³•åœæ­¢ï¼š 1234567891011static boolean run = true;public static void main(String[] args) throws InterruptedException &#123;Thread t = new Thread(()-&gt;&#123;while(run)&#123;// ....&#125;&#125;);t.start();sleep(1);run = false; // çº¿ç¨‹tä¸ä¼šå¦‚é¢„æƒ³çš„åœä¸‹æ¥&#125; ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåˆ†æžä¸€ä¸‹ï¼š åˆå§‹çŠ¶æ€ï¼Œ t çº¿ç¨‹åˆšå¼€å§‹ä»Žä¸»å†…å­˜è¯»å–äº† run çš„å€¼åˆ°å·¥ä½œå†…å­˜ã€‚ å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»Žä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆçŽ‡ 1 ç§’ä¹‹åŽï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»Žè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œç»“æžœæ°¸è¿œæ˜¯æ—§å€¼ 3.2 è§£å†³æ–¹æ³•volatileï¼ˆæ˜“å˜å…³é”®å­—ï¼‰ å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»Žè‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­èŽ·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œvolatile å˜é‡éƒ½æ˜¯ç›´æŽ¥æ“ä½œä¸»å­˜ 3.3 å¯è§æ€§ vs åŽŸå­æ€§å‰é¢ä¾‹å­ä½“çŽ°çš„å®žé™…å°±æ˜¯å¯è§æ€§ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œ ä¸èƒ½ä¿è¯åŽŸå­æ€§ï¼Œä»…ç”¨åœ¨ä¸€ä¸ªå†™çº¿ç¨‹ï¼Œå¤šä¸ªè¯»çº¿ç¨‹çš„æƒ…å†µï¼š ä¸Šä¾‹ä»Žå­—èŠ‚ç ç†è§£æ˜¯è¿™æ ·çš„ï¼š 123456getstatic run // çº¿ç¨‹ t èŽ·å– run truegetstatic run // çº¿ç¨‹ t èŽ·å– run truegetstatic run // çº¿ç¨‹ t èŽ·å– run truegetstatic run // çº¿ç¨‹ t èŽ·å– run trueputstatic run // çº¿ç¨‹ main ä¿®æ”¹ run ä¸º falseï¼Œ ä»…æ­¤ä¸€æ¬¡getstatic run // çº¿ç¨‹ t èŽ·å– run false æ¯”è¾ƒä¸€ä¸‹ä¹‹å‰æˆ‘ä»¬å°†çº¿ç¨‹å®‰å…¨æ—¶ä¸¾çš„ä¾‹å­ï¼šä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ª i++ ä¸€ä¸ª iâ€“ ï¼Œåªèƒ½ä¿è¯çœ‹åˆ°æœ€æ–°å€¼ï¼Œä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™ 123456789// å‡è®¾içš„åˆå§‹å€¼ä¸º0getstatic i // çº¿ç¨‹2-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0getstatic i // çº¿ç¨‹1-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0iconst_1 // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1iadd // çº¿ç¨‹1-è‡ªå¢ž çº¿ç¨‹å†…i=1putstatic i // çº¿ç¨‹1-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1iconst_1 // çº¿ç¨‹2-å‡†å¤‡å¸¸é‡1isub // çº¿ç¨‹2-è‡ªå‡ çº¿ç¨‹å†…i=-1putstatic i // çº¿ç¨‹2-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=-1 æ³¨æ„ synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„åŽŸå­æ€§ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„å¯è§æ€§ã€‚ä½†ç¼ºç‚¹æ˜¯synchronized æ˜¯å±žäºŽé‡é‡çº§æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½Ž å¦‚æžœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªçŽ¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘çŽ°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ°å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ 3.4 æ¨¡å¼ä¹‹ä¸¤é˜¶æ®µç»ˆæ­¢Two Phase Termination åœ¨ä¸€ä¸ªçº¿ç¨‹ T1 ä¸­å¦‚ä½•â€œä¼˜é›…â€ç»ˆæ­¢çº¿ç¨‹ T2ï¼Ÿè¿™é‡Œçš„ã€ä¼˜é›…ã€‘æŒ‡çš„æ˜¯ç»™ T2 ä¸€ä¸ªæ–™ç†åŽäº‹çš„æœºä¼šã€‚ é”™è¯¯æ€è·¯ ä½¿ç”¨çº¿ç¨‹å¯¹è±¡çš„ stop() æ–¹æ³•åœæ­¢çº¿ç¨‹ stop æ–¹æ³•ä¼šçœŸæ­£æ€æ­»çº¿ç¨‹ï¼Œå¦‚æžœè¿™æ—¶çº¿ç¨‹é”ä½äº†å…±äº«èµ„æºï¼Œé‚£ä¹ˆå½“å®ƒè¢«æ€æ­»åŽå°±å†ä¹Ÿæ²¡æœ‰æœºä¼šé‡Šæ”¾é”ï¼Œå…¶å®ƒçº¿ç¨‹å°†æ°¸è¿œæ— æ³•èŽ·å–é” ä½¿ç”¨ System.exit(int) æ–¹æ³•åœæ­¢çº¿ç¨‹ ç›®çš„ä»…æ˜¯åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Œä½†è¿™ç§åšæ³•ä¼šè®©æ•´ä¸ªç¨‹åºéƒ½åœæ­¢ ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ (1) åˆ©ç”¨ isInterruptedinterrupt å¯ä»¥æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œæ— è®ºè¿™ä¸ªçº¿ç¨‹æ˜¯åœ¨ sleepï¼Œwaitï¼Œè¿˜æ˜¯æ­£å¸¸è¿è¡Œ 12345678910111213141516171819202122232425class TPTInterrupt &#123; private Thread thread; public void start()&#123; thread = new Thread(() -&gt; &#123; while(true) &#123; Thread current = Thread.currentThread(); if(current.isInterrupted()) &#123; log.debug(&quot;æ–™ç†åŽäº‹&quot;); break; &#125; try &#123; Thread.sleep(1000); log.debug(&quot;å°†ç»“æžœä¿å­˜&quot;); &#125; catch (InterruptedException e) &#123; current.interrupt(); &#125; // æ‰§è¡Œç›‘æŽ§æ“ä½œ &#125; &#125;,&quot;ç›‘æŽ§çº¿ç¨‹&quot;); thread.start(); &#125; public void stop() &#123; thread.interrupt(); &#125;&#125; è°ƒç”¨ 12345TPTInterrupt t = new TPTInterrupt();t.start();Thread.sleep(3500);log.debug(&quot;stop&quot;);t.stop(); ç»“æžœ 1234511:49:42.915 c.TwoPhaseTermination [ç›‘æŽ§çº¿ç¨‹] - å°†ç»“æžœä¿å­˜11:49:43.919 c.TwoPhaseTermination [ç›‘æŽ§çº¿ç¨‹] - å°†ç»“æžœä¿å­˜11:49:44.919 c.TwoPhaseTermination [ç›‘æŽ§çº¿ç¨‹] - å°†ç»“æžœä¿å­˜11:49:45.413 c.TestTwoPhaseTermination [main] - stop11:49:45.413 c.TwoPhaseTermination [ç›‘æŽ§çº¿ç¨‹] - æ–™ç†åŽäº‹ (2) åˆ©ç”¨åœæ­¢æ ‡è®°12345678910111213141516171819202122232425262728// åœæ­¢æ ‡è®°ç”¨ volatile æ˜¯ä¸ºäº†ä¿è¯è¯¥å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§// æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå³ä¸»çº¿ç¨‹æŠŠå®ƒä¿®æ”¹ä¸º true å¯¹ t1 çº¿ç¨‹å¯è§class TPTVolatile &#123; private Thread thread; private volatile boolean stop = false; public void start()&#123; thread = new Thread(() -&gt; &#123; while(true) &#123; Thread current = Thread.currentThread(); if(stop) &#123; log.debug(&quot;æ–™ç†åŽäº‹&quot;); break; &#125; try &#123; Thread.sleep(1000); log.debug(&quot;å°†ç»“æžœä¿å­˜&quot;); &#125; catch (InterruptedException e) &#123; &#125; // æ‰§è¡Œç›‘æŽ§æ“ä½œ &#125; &#125;,&quot;ç›‘æŽ§çº¿ç¨‹&quot;); thread.start(); &#125; public void stop() &#123; stop = true; thread.interrupt(); &#125;&#125; è°ƒç”¨ 12345TPTVolatile t = new TPTVolatile();t.start();Thread.sleep(3500);log.debug(&quot;stop&quot;);t.stop(); ç»“æžœ 1234511:54:52.003 c.TPTVolatile [ç›‘æŽ§çº¿ç¨‹] - å°†ç»“æžœä¿å­˜11:54:53.006 c.TPTVolatile [ç›‘æŽ§çº¿ç¨‹] - å°†ç»“æžœä¿å­˜11:54:54.007 c.TPTVolatile [ç›‘æŽ§çº¿ç¨‹] - å°†ç»“æžœä¿å­˜11:54:54.502 c.TestTwoPhaseTermination [main] - stop11:54:54.502 c.TPTVolatile [ç›‘æŽ§çº¿ç¨‹] - æ–™ç†åŽäº‹ (3) æ¡ˆä¾‹ï¼šJVM å†…å­˜ç›‘æŽ§3.5 æ¨¡å¼ä¹‹Balkingå®šä¹‰Balking ï¼ˆçŠ¹è±«ï¼‰æ¨¡å¼ç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹å‘çŽ°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒçš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åšäº†ï¼Œç›´æŽ¥ç»“æŸè¿”å›ž å®žçŽ°ä¾‹å¦‚ï¼š 1234567891011121314public class MonitorService &#123; // ç”¨æ¥è¡¨ç¤ºæ˜¯å¦å·²ç»æœ‰çº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œå¯åŠ¨äº† private volatile boolean starting; public void start() &#123; log.info(&quot;å°è¯•å¯åŠ¨ç›‘æŽ§çº¿ç¨‹...&quot;); synchronized (this) &#123; if (starting) &#123; return; &#125; starting = true; &#125; // çœŸæ­£å¯åŠ¨ç›‘æŽ§çº¿ç¨‹... &#125;&#125; å½“å‰ç«¯é¡µé¢å¤šæ¬¡ç‚¹å‡»æŒ‰é’®è°ƒç”¨ start æ—¶ è¾“å‡º 12345[http-nio-8080-exec-1] cn.itcast.monitor.service.MonitorService - è¯¥ç›‘æŽ§çº¿ç¨‹å·²å¯åŠ¨?(false)[http-nio-8080-exec-1] cn.itcast.monitor.service.MonitorService - ç›‘æŽ§çº¿ç¨‹å·²å¯åŠ¨...[http-nio-8080-exec-2] cn.itcast.monitor.service.MonitorService - è¯¥ç›‘æŽ§çº¿ç¨‹å·²å¯åŠ¨?(true)[http-nio-8080-exec-3] cn.itcast.monitor.service.MonitorService - è¯¥ç›‘æŽ§çº¿ç¨‹å·²å¯åŠ¨?(true)[http-nio-8080-exec-4] cn.itcast.monitor.service.MonitorService - è¯¥ç›‘æŽ§çº¿ç¨‹å·²å¯åŠ¨?(true) å®ƒè¿˜ç»å¸¸ç”¨æ¥å®žçŽ°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ 123456789101112public final class Singleton &#123; private Singleton() &#123; &#125; private static Singleton INSTANCE = null; public static synchronized Singleton getInstance() &#123; if (INSTANCE != null) &#123; return INSTANCE; &#125; INSTANCE = new Singleton(); return INSTANCE; &#125;&#125; å¯¹æ¯”ä¸€ä¸‹ä¿æŠ¤æ€§æš‚åœæ¨¡å¼ï¼šä¿æŠ¤æ€§æš‚åœæ¨¡å¼ç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æžœï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶çº¿ç¨‹ç­‰å¾…ã€‚ 4. æœ‰åºæ€§JVM ä¼šåœ¨ä¸å½±å“æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥è°ƒæ•´è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œæ€è€ƒä¸‹é¢ä¸€æ®µä»£ç  12345static int i;static int j;// åœ¨æŸä¸ªçº¿ç¨‹å†…æ‰§è¡Œå¦‚ä¸‹èµ‹å€¼æ“ä½œi = ...;j = ...; å¯ä»¥çœ‹åˆ°ï¼Œè‡³äºŽæ˜¯å…ˆæ‰§è¡Œ i è¿˜æ˜¯ å…ˆæ‰§è¡Œ j ï¼Œå¯¹æœ€ç»ˆçš„ç»“æžœä¸ä¼šäº§ç”Ÿå½±å“ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä»£ç çœŸæ­£æ‰§è¡Œæ—¶ï¼Œæ—¢å¯ä»¥æ˜¯ 12i = ...;j = ...; ä¹Ÿå¯ä»¥æ˜¯ 12j = ...;i = ...; è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€ŽæŒ‡ä»¤é‡æŽ’ã€ï¼Œå¤šçº¿ç¨‹ä¸‹ã€ŽæŒ‡ä»¤é‡æŽ’ã€ä¼šå½±å“æ­£ç¡®æ€§ã€‚ä¸ºä»€ä¹ˆè¦æœ‰é‡æŽ’æŒ‡ä»¤è¿™é¡¹ä¼˜åŒ–å‘¢ï¼Ÿä»Ž CPUæ‰§è¡ŒæŒ‡ä»¤çš„åŽŸç†æ¥ç†è§£ä¸€ä¸‹å§ 4.1 åŽŸç†ä¹‹æŒ‡ä»¤çº§å¹¶è¡Œäº‹å®žä¸Šï¼ŒçŽ°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´æœ€é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›ž è¿™ 5 ä¸ªé˜¶æ®µ æœ¯è¯­å‚è€ƒï¼š instruction fetch (IF) instruction decode (ID) execute (EX) memory access (MEM) register write back (WB) åœ¨ä¸æ”¹å˜ç¨‹åºç»“æžœçš„å‰æä¸‹ï¼Œè¿™äº›æŒ‡ä»¤çš„å„ä¸ªé˜¶æ®µå¯ä»¥é€šè¿‡é‡æŽ’åºå’Œç»„åˆæ¥å®žçŽ°æŒ‡ä»¤çº§å¹¶è¡Œï¼Œè¿™ä¸€æŠ€æœ¯åœ¨ 80â€™s ä¸­å¶åˆ° 90â€™s ä¸­å¶å æ®äº†è®¡ç®—æž¶æž„çš„é‡è¦åœ°ä½ã€‚ æç¤ºï¼š åˆ†é˜¶æ®µï¼Œåˆ†å·¥æ˜¯æå‡æ•ˆçŽ‡çš„å…³é”®ï¼ æŒ‡ä»¤é‡æŽ’çš„å‰ææ˜¯ï¼Œé‡æŽ’æŒ‡ä»¤ä¸èƒ½å½±å“ç»“æžœï¼Œä¾‹å¦‚ 1234567// å¯ä»¥é‡æŽ’çš„ä¾‹å­int a = 10; // æŒ‡ä»¤1int b = 20; // æŒ‡ä»¤2System.out.println( a + b );// ä¸èƒ½é‡æŽ’çš„ä¾‹å­int a = 10; // æŒ‡ä»¤1int b = a - 5; // æŒ‡ä»¤2 å‚è€ƒï¼š Scoreboarding and the Tomasulo algorithm (which is similar to scoreboarding but makes use of register renaming) are two of the most common techniques for implementing out-of-order execution and instruction-level parallelism. çŽ°ä»£ CPU æ”¯æŒå¤šçº§æŒ‡ä»¤æµæ°´çº¿ï¼Œä¾‹å¦‚æ”¯æŒåŒæ—¶æ‰§è¡Œ å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›ž çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºäº”çº§æŒ‡ä»¤æµæ°´çº¿ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºŽä¸€æ¡æ‰§è¡Œæ—¶é—´æœ€é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC = 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°åžåçŽ‡ã€‚ æç¤ºï¼š å¥”è…¾å››ï¼ˆPentium 4ï¼‰æ”¯æŒé«˜è¾¾ 35 çº§æµæ°´çº¿ï¼Œä½†ç”±äºŽåŠŸè€—å¤ªé«˜è¢«åºŸå¼ƒ 4.2 è¯¡å¼‚çš„ç»“æžœ123456789101112131415int num = 0;boolean ready = false;// çº¿ç¨‹1 æ‰§è¡Œæ­¤æ–¹æ³•public void actor1(I_Result r) &#123; if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125;&#125;// çº¿ç¨‹2 æ‰§è¡Œæ­¤æ–¹æ³•public void actor2(I_Result r) &#123; num = 2; ready = true;&#125; I_Result æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªå±žæ€§ r1 ç”¨æ¥ä¿å­˜ç»“æžœï¼Œé—®ï¼Œå¯èƒ½çš„ç»“æžœæœ‰å‡ ç§ï¼Ÿ æœ‰åŒå­¦è¿™ä¹ˆåˆ†æž æƒ…å†µ1ï¼šçº¿ç¨‹1 å…ˆæ‰§è¡Œï¼Œè¿™æ—¶ ready = falseï¼Œæ‰€ä»¥è¿›å…¥ else åˆ†æ”¯ç»“æžœä¸º 1 æƒ…å†µ2ï¼šçº¿ç¨‹2 å…ˆæ‰§è¡Œ num = 2ï¼Œä½†æ²¡æ¥å¾—åŠæ‰§è¡Œ ready = trueï¼Œçº¿ç¨‹1 æ‰§è¡Œï¼Œè¿˜æ˜¯è¿›å…¥ else åˆ†æ”¯ï¼Œç»“æžœä¸º1 æƒ…å†µ3ï¼šçº¿ç¨‹2 æ‰§è¡Œåˆ° ready = trueï¼Œçº¿ç¨‹1 æ‰§è¡Œï¼Œè¿™å›žè¿›å…¥ if åˆ†æ”¯ï¼Œç»“æžœä¸º 4ï¼ˆå› ä¸º num å·²ç»æ‰§è¡Œè¿‡äº†ï¼‰ ä½†æˆ‘å‘Šè¯‰ä½ ï¼Œç»“æžœè¿˜æœ‰å¯èƒ½æ˜¯ 0 ðŸ˜ðŸ˜ðŸ˜ï¼Œä¿¡ä¸ä¿¡å§ï¼ è¿™ç§æƒ…å†µä¸‹æ˜¯ï¼šçº¿ç¨‹2 æ‰§è¡Œ ready = trueï¼Œåˆ‡æ¢åˆ°çº¿ç¨‹1ï¼Œè¿›å…¥ if åˆ†æ”¯ï¼Œç›¸åŠ ä¸º 0ï¼Œå†åˆ‡å›žçº¿ç¨‹2 æ‰§è¡Œ num = 2 ç›¸ä¿¡å¾ˆå¤šäººå·²ç»æ™•äº† ðŸ˜µðŸ˜µðŸ˜µ è¿™ç§çŽ°è±¡å«åšæŒ‡ä»¤é‡æŽ’ï¼Œæ˜¯ JIT ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶çš„ä¸€äº›ä¼˜åŒ–ï¼Œè¿™ä¸ªçŽ°è±¡éœ€è¦é€šè¿‡å¤§é‡æµ‹è¯•æ‰èƒ½å¤çŽ°ï¼š å€ŸåŠ© java å¹¶å‘åŽ‹æµ‹å·¥å…· jcstress https://wiki.openjdk.java.net/display/CodeTools/jcstress 1mvn archetype:generate -DinteractiveMode=false -DarchetypeGroupId=org.openjdk.jcstress -DarchetypeArtifactId=jcstress-java-test-archetype -DarchetypeVersion=0.5 -DgroupId=cn.itcast -DartifactId=ordering -Dversion=1.0 åˆ›å»º maven é¡¹ç›®ï¼Œæä¾›å¦‚ä¸‹æµ‹è¯•ç±» 123456789101112131415161718192021@JCStressTest@Outcome(id = &#123;&quot;1&quot;, &quot;4&quot;&#125;, expect = Expect.ACCEPTABLE, desc = &quot;ok&quot;)@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;!!!!&quot;)@Statepublic class ConcurrencyTest &#123; int num = 0; boolean ready = false; @Actor public void actor1(I_Result r) &#123; if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125; &#125; @Actor public void actor2(I_Result r) &#123; num = 2; ready = true; &#125;&#125; æ‰§è¡Œ 12mvn clean installjava -jar target/jcstress.jar ä¼šè¾“å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„ç»“æžœï¼Œæ‘˜å½•å…¶ä¸­ä¸€æ¬¡ç»“æžœï¼š 123456789101112131415161718192021222324*** INTERESTING tests Some interesting behaviors observed. This is for the plain curiosity. 2 matching test results. [OK] cn.itcast.ConcurrencyTest1 (JVM args: [-XX:-TieredCompilation]) Observed state Occurrences Expectation Interpretation 0 3,943 ACCEPTABLE_INTERESTING !!!! 1 20,090,265 ACCEPTABLE ok 4 26,615,603 ACCEPTABLE ok [OK] cn.itcast.ConcurrencyTest1 (JVM args: []) Observed state Occurrences Expectation Interpretation 0 1,714 ACCEPTABLE_INTERESTING !!!! 1 18,118,845 ACCEPTABLE ok 4 29,707,292 ACCEPTABLE ok å¯ä»¥çœ‹åˆ°ï¼Œå‡ºçŽ°ç»“æžœä¸º 0 çš„æƒ…å†µæœ‰ 3,943 æ¬¡ï¼Œè™½ç„¶æ¬¡æ•°ç›¸å¯¹å¾ˆå°‘ï¼Œä½†æ¯•ç«Ÿæ˜¯å‡ºçŽ°äº†ã€‚ 4.3 è§£å†³æ–¹æ³•volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æŽ’ 123456789101112131415161718192021@JCStressTest@Outcome(id = &#123;&quot;1&quot;, &quot;4&quot;&#125;, expect = Expect.ACCEPTABLE, desc = &quot;ok&quot;)@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;!!!!&quot;)@Statepublic class ConcurrencyTest &#123; int num = 0; volatile boolean ready = false; @Actor public void actor1(I_Result r) &#123; if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125; &#125; @Actor public void actor2(I_Result r) &#123; num = 2; ready = true; &#125;&#125; ç»“æžœä¸ºï¼š 123*** INTERESTING testsSome interesting behaviors observed. This is for the plain curiosity.0 matching test results. 4.4 åŽŸç†ä¹‹ volatilevolatile çš„åº•å±‚å®žçŽ°åŽŸç†æ˜¯å†…å­˜å±éšœï¼ŒMemory Barrierï¼ˆMemory Fenceï¼‰ å¯¹ volatile å˜é‡çš„å†™æŒ‡ä»¤åŽä¼šåŠ å…¥å†™å±éšœ å¯¹ volatile å˜é‡çš„è¯»æŒ‡ä»¤å‰ä¼šåŠ å…¥è¯»å±éšœ (1) å¦‚ä½•ä¿è¯å¯è§æ€§ å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­ 12345public void actor2(I_Result r) &#123; num = 2; ready = true; // ready æ˜¯ volatile èµ‹å€¼å¸¦å†™å±éšœ // å†™å±éšœ&#125; è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åŽï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ® 123456789public void actor1(I_Result r) &#123; // è¯»å±éšœ // ready æ˜¯ volatile è¯»å–å€¼å¸¦è¯»å±éšœ if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125;&#125; (2) å¦‚ä½•ä¿è¯æœ‰åºæ€§ å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æŽ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æŽ’åœ¨å†™å±éšœä¹‹åŽ 12345public void actor2(I_Result r) &#123; num = 2; ready = true; // ready æ˜¯ volatile èµ‹å€¼å¸¦å†™å±éšœ // å†™å±éšœ&#125; è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æŽ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åŽçš„ä»£ç æŽ’åœ¨è¯»å±éšœä¹‹å‰ 123456789public void actor1(I_Result r) &#123; // è¯»å±éšœ // ready æ˜¯ volatile è¯»å–å€¼å¸¦è¯»å±éšœ if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125;&#125; è¿˜æ˜¯é‚£å¥è¯ï¼Œä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™ï¼š å†™å±éšœä»…ä»…æ˜¯ä¿è¯ä¹‹åŽçš„è¯»èƒ½å¤Ÿè¯»åˆ°æœ€æ–°çš„ç»“æžœï¼Œä½†ä¸èƒ½ä¿è¯è¯»è·‘åˆ°å®ƒå‰é¢åŽ» è€Œæœ‰åºæ€§çš„ä¿è¯ä¹Ÿåªæ˜¯ä¿è¯äº†æœ¬çº¿ç¨‹å†…ç›¸å…³ä»£ç ä¸è¢«é‡æŽ’åº (3) double-checked locking é—®é¢˜ä»¥è‘—åçš„ double-checked locking å•ä¾‹æ¨¡å¼ä¸ºä¾‹ 123456789101112131415public final class Singleton &#123; private Singleton() &#123; &#125; private static Singleton INSTANCE = null; public static Singleton getInstance() &#123; if(INSTANCE == null) &#123; // t2 // é¦–æ¬¡è®¿é—®ä¼šåŒæ­¥ï¼Œè€Œä¹‹åŽçš„ä½¿ç”¨æ²¡æœ‰ synchronized synchronized(Singleton.class) &#123; if (INSTANCE == null) &#123; // t1 INSTANCE = new Singleton(); &#125; &#125; &#125; return INSTANCE; &#125;&#125; ä»¥ä¸Šçš„å®žçŽ°ç‰¹ç‚¹æ˜¯ï¼š æ‡’æƒ°å®žä¾‹åŒ– é¦–æ¬¡ä½¿ç”¨ getInstance() æ‰ä½¿ç”¨ synchronized åŠ é”ï¼ŒåŽç»­ä½¿ç”¨æ—¶æ— éœ€åŠ é” æœ‰éšå«çš„ï¼Œä½†å¾ˆå…³é”®çš„ä¸€ç‚¹ï¼šç¬¬ä¸€ä¸ª if ä½¿ç”¨äº† INSTANCE å˜é‡ï¼Œæ˜¯åœ¨åŒæ­¥å—ä¹‹å¤– ä½†åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼ŒgetInstance æ–¹æ³•å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š 123456789101112131415161718192021220: getstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton; # èŽ·å–å¸¸é‡æ±  ç´¢å¼•ï¼Œ åŽ‹å…¥åˆ° æ“ä½œæ•°æ ˆ ä¸­3: ifnonnull 37 # å¼¹å‡º æ“ä½œæ•° æ ˆé¡¶ å…ƒç´ ï¼Œ åˆ¤æ–­ å…ƒç´  æ˜¯å¦ ä¸º null6: ldc #3 // class cn/itcast/n5/Singleton # å°† å‰é¢ getstatic èŽ·å–çš„ Singleton åŽ‹å…¥åˆ° æ“ä½œæ•°æ ˆ8: dup # å¤åˆ¶ æ“ä½œæ•° æ ˆé¡¶ å€¼ï¼Œå¹¶å°†å…¶åŽ‹å…¥ æ ˆé¡¶ ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆä¸Šæœ‰è¿žç»­ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡åœ°å€9: astore_0 # å¼¹å‡ºæ ˆé¡¶å…ƒç´ ï¼Œå°†æ ˆé¡¶å€¼ ä¿å­˜åˆ°æˆå‘˜å˜é‡å¯¹åº”çš„ slots(0) æ§½10: monitorenter # å¼€å¯ sychronized é”11: getstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton;14: ifnonnull 2717: new #3 // class cn/itcast/n5/Singleton åœ¨ java å †ä¸Šä¸º Singleton å¯¹è±¡åˆ†é… å†…å­˜ç©ºé—´ï¼Œå¹¶å°†å…¶ åŽ‹å…¥ æ“ä½œæ•° æ ˆé¡¶20: dup # å¤åˆ¶ æ“ä½œæ•° æ ˆé¡¶ å€¼ï¼Œå¹¶å°†å…¶åŽ‹å…¥ æ ˆé¡¶ ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆä¸Šæœ‰è¿žç»­ç›¸åŒçš„ä¸¤ä¸ªå¯¹è±¡åœ°å€21: invokespecial #4 // Method &quot;&lt;init&gt;&quot;:()V # è°ƒç”¨å®žä¾‹åˆå§‹åŒ–æ–¹æ³•ï¼Œä»Žæ“ä½œæ•°æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªthiså¼•ç”¨24: putstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton; # å¼¹å‡ºæ“ä½œæ•° æ ˆé¡¶å…ƒç´ ï¼Œå¹¶å°† æ ˆé¡¶å€¼ èµ‹å€¼ç»™ æˆå‘˜å˜é‡ INSTANCE27: aload_0 # å°†æˆå‘˜å˜é‡è¡¨ slots(1) æ§½ï¼ˆå·²ç» å®žä¾‹å¥½çš„ INSTANCE ï¼‰ åŽ‹å…¥åˆ° æ“ä½œæ•° æ ˆä¸­28: monitorexit # å…³é—­ sychronized é”29: goto 37 32: astore_1 # å°† æŠ›å‡ºå¼‚å¸¸çš„å€¼ ä¿å­˜åˆ° æˆå‘˜å˜é‡è¡¨ slots(2) ä¸­ï¼Œç­‰ä¸‹ä¼šå–å‡º33: aload_0 # åŠ è½½ INSTANCE å€¼ åˆ° æ“ä½œæ•°æ ˆ ç¬¬äºŒä¸ª if ä¸­ INSTANCE ä¸æ˜¯ null ä¼šæ‰§è¡Œï¼Œç›¸å½“äºŽ return INSTANCE34: monitorexit # å¼‚å¸¸å¯¼è‡´ éž æ­£å¸¸ é” å…³é—­ï¼Œè¿™é‡Œ ä¼šå†æ¬¡åŽ» å…³é—­ synchronized é”35: aload_1 # å–å‡º slots(2), åŽ‹å…¥åˆ° æ“ä½œæ•°æ ˆ36: athrow # å¼¹å‡ºæ“ä½œæ•°æ ˆé¡¶ å…ƒç´ ï¼ŒåŒ¹é… å¼‚å¸¸è¡¨ ç±»åž‹ï¼Œç„¶åŽæŠ›å‡ºå¼‚å¸¸37: getstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton; èŽ·å– INSTANCE # èŽ·å–å¸¸é‡æ±  ç´¢å¼•ï¼Œ åŽ‹å…¥åˆ° æ“ä½œæ•°æ ˆ ä¸­40: areturn # å°† æ“ä½œæ•° æ ˆé¡¶ å…ƒç´  å¼¹å‡ºï¼ŒåŽ‹å…¥åˆ° è°ƒç”¨è€…çš„ æ“ä½œæ•°æ ˆ å…¶ä¸­ 17 è¡¨ç¤ºåˆ›å»ºå¯¹è±¡ï¼Œå°†å¯¹è±¡å¼•ç”¨å…¥æ ˆ // new Singleton 20 è¡¨ç¤ºå¤åˆ¶ä¸€ä»½å¯¹è±¡å¼•ç”¨ // å¼•ç”¨åœ°å€ 21 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œè°ƒç”¨æž„é€ æ–¹æ³• 24 è¡¨ç¤ºåˆ©ç”¨ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ï¼Œèµ‹å€¼ç»™ static INSTANCE ä¹Ÿè®¸ jvm ä¼šä¼˜åŒ–ä¸ºï¼šå…ˆæ‰§è¡Œ 24ï¼Œå†æ‰§è¡Œ 21ã€‚å¦‚æžœä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2 æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œï¼š å…³é”®åœ¨äºŽ 0: getstatic è¿™è¡Œä»£ç åœ¨ monitor æŽ§åˆ¶ä¹‹å¤–ï¼Œå®ƒå°±åƒä¹‹å‰ä¸¾ä¾‹ä¸­ä¸å®ˆè§„åˆ™çš„äººï¼Œå¯ä»¥è¶Šè¿‡ monitor è¯»å–INSTANCE å˜é‡çš„å€¼ è¿™æ—¶ t1 è¿˜æœªå®Œå…¨å°†æž„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æžœåœ¨æž„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ t2 æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹ å¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æŽ’ï¼Œä½†è¦æ³¨æ„åœ¨ JDK 5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ volatile æ‰ä¼šçœŸæ­£æœ‰æ•ˆ (4) double-checked locking è§£å†³12345678910111213141516public final class Singleton &#123; private Singleton() &#123; &#125; private static volatile Singleton INSTANCE = null; public static Singleton getInstance() &#123; // å®žä¾‹æ²¡åˆ›å»ºï¼Œæ‰ä¼šè¿›å…¥å†…éƒ¨çš„ synchronizedä»£ç å— if (INSTANCE == null) &#123; synchronized (Singleton.class) &#123; // t2 // ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®žä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡ if (INSTANCE == null) &#123; // t1 INSTANCE = new Singleton(); &#125; &#125; &#125; return INSTANCE; &#125;&#125; å­—èŠ‚ç ä¸Šçœ‹ä¸å‡ºæ¥ volatile æŒ‡ä»¤çš„æ•ˆæžœ 123456789101112131415161718192021222324# -------------------------------------&gt; åŠ å…¥å¯¹ INSTANCE å˜é‡çš„è¯»å±éšœ0: getstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton;3: ifnonnull 376: ldc #3 // class cn/itcast/n5/Singleton8: dup9: astore_010: monitorenter -----------------------&gt; ä¿è¯åŽŸå­æ€§ã€å¯è§æ€§11: getstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton;14: ifnonnull 2717: new #3 // class cn/itcast/n5/Singleton20: dup21: invokespecial #4 // Method &quot;&lt;init&gt;&quot;:()V24: putstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton;# -------------------------------------&gt; åŠ å…¥å¯¹ INSTANCE å˜é‡çš„å†™å±éšœ27: aload_028: monitorexit ------------------------&gt; ä¿è¯åŽŸå­æ€§ã€å¯è§æ€§29: goto 3732: astore_133: aload_034: monitorexit35: aload_136: athrow37: getstatic #2 // Field INSTANCE:Lcn/itcast/n5/Singleton;40: areturn å¦‚ä¸Šé¢çš„æ³¨é‡Šå†…å®¹æ‰€ç¤ºï¼Œè¯»å†™ volatile å˜é‡æ—¶ä¼šåŠ å…¥å†…å­˜å±éšœï¼ˆMemory Barrierï¼ˆMemory Fenceï¼‰ï¼‰ï¼Œä¿è¯ä¸‹é¢ä¸¤ç‚¹ï¼š å¯è§æ€§ å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ t1 å¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­ è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åŽ t2 å¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ® æœ‰åºæ€§ å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æŽ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æŽ’åœ¨å†™å±éšœä¹‹åŽ è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æŽ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åŽçš„ä»£ç æŽ’åœ¨è¯»å±éšœä¹‹å‰ æ›´åº•å±‚æ˜¯è¯»å†™å˜é‡æ—¶ä½¿ç”¨ lock æŒ‡ä»¤æ¥å¤šæ ¸ CPU ä¹‹é—´çš„å¯è§æ€§ä¸Žæœ‰åºæ€§ 4.5 happens-beforehappens-before è§„å®šäº†å¯¹å…±äº«å˜é‡çš„å†™æ“ä½œå¯¹å…¶å®ƒçº¿ç¨‹çš„è¯»æ“ä½œå¯è§ï¼Œå®ƒæ˜¯å¯è§æ€§ä¸Žæœ‰åºæ€§çš„ä¸€å¥—è§„åˆ™æ€»ç»“ï¼ŒæŠ›å¼€ä»¥ä¸‹ happens-before è§„åˆ™ï¼ŒJMM å¹¶ä¸èƒ½ä¿è¯ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™ï¼Œå¯¹äºŽå…¶å®ƒçº¿ç¨‹å¯¹è¯¥å…±äº«å˜é‡çš„è¯»å¯è§ çº¿ç¨‹è§£é” m ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºŽæŽ¥ä¸‹æ¥å¯¹ m åŠ é”çš„å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ 12345678910111213static int x;static Object m = new Object();new Thread(()-&gt;&#123; synchronized(m) &#123; x = 10; &#125;&#125;,&quot;t1&quot;).start();new Thread(()-&gt;&#123; synchronized(m) &#123; System.out.println(x); &#125;&#125;,&quot;t2&quot;).start(); çº¿ç¨‹å¯¹ volatile å˜é‡çš„å†™ï¼Œå¯¹æŽ¥ä¸‹æ¥å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ 1234567volatile static int x;new Thread(()-&gt;&#123; x = 10;&#125;,&quot;t1&quot;).start();new Thread(()-&gt;&#123; System.out.println(x);&#125;,&quot;t2&quot;).start(); çº¿ç¨‹ start å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹è¯¥çº¿ç¨‹å¼€å§‹åŽå¯¹è¯¥å˜é‡çš„è¯»å¯è§ 12345static int x;x = 10;new Thread(()-&gt;&#123; System.out.println(x);&#125;,&quot;t2&quot;).start(); çº¿ç¨‹ç»“æŸå‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¾—çŸ¥å®ƒç»“æŸåŽçš„è¯»å¯è§ï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æœ€æ–°æ•°æ®ï¼ˆæ¯”å¦‚å…¶å®ƒçº¿ç¨‹è°ƒç”¨ t1.isAlive() æˆ– t1.join()ç­‰å¾…å®ƒç»“æŸï¼‰ 1234567static int x;Thread t1 = new Thread(()-&gt;&#123; x = 10;&#125;,&quot;t1&quot;);t1.start();t1.join();System.out.println(x); çº¿ç¨‹ t1 æ‰“æ–­ t2ï¼ˆinterruptï¼‰å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºŽå…¶ä»–çº¿ç¨‹å¾—çŸ¥ t2 è¢«æ‰“æ–­åŽå¯¹å˜é‡çš„è¯»å¯è§ï¼ˆé€šè¿‡t2.interrupted æˆ– t2.isInterruptedï¼‰ 12345678910111213141516171819202122static int x;public static void main(String[] args) &#123; Thread t2 = new Thread(()-&gt;&#123; while(true) &#123; if(Thread.currentThread().isInterrupted()) &#123; System.out.println(x); break; &#125; &#125; &#125;,&quot;t2&quot;); t2.start(); new Thread(()-&gt;&#123; sleep(1); x = 10; t2.interrupt(); &#125;,&quot;t1&quot;).start(); while(!t2.isInterrupted()) &#123; Thread.yield(); &#125; System.out.println(x);&#125; å¯¹å˜é‡é»˜è®¤å€¼ï¼ˆ0ï¼Œfalseï¼Œnullï¼‰çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ å…·æœ‰ä¼ é€’æ€§ï¼Œå¦‚æžœ x hb-&gt; y å¹¶ä¸” y hb-&gt; z é‚£ä¹ˆæœ‰ x hb-&gt; z ï¼Œé…åˆ volatile çš„é˜²æŒ‡ä»¤é‡æŽ’ï¼Œæœ‰ä¸‹é¢çš„ä¾‹å­ 12345678910volatile static int x;static int y;new Thread(()-&gt;&#123; y = 10; x = 20;&#125;,&quot;t1&quot;).start();new Thread(()-&gt;&#123; // x=20 å¯¹ t2 å¯è§, åŒæ—¶ y=10 ä¹Ÿå¯¹ t2 å¯è§ System.out.println(x);&#125;,&quot;t2&quot;).start(); å˜é‡éƒ½æ˜¯æŒ‡æˆå‘˜å˜é‡æˆ–é™æ€æˆå‘˜å˜é‡ 4.6 ä¹ é¢˜balking æ¨¡å¼ä¹ é¢˜å¸Œæœ› doInit() æ–¹æ³•ä»…è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸‹é¢çš„å®žçŽ°æ˜¯å¦æœ‰é—®é¢˜ï¼Œä¸ºä»€ä¹ˆï¼Ÿ 123456789101112131415public class TestVolatile &#123; volatile boolean initialized = false; void init() &#123; if (initialized) &#123; return; &#125; doInit(); initialized = true; &#125; private void doInit() &#123; &#125;&#125; çº¿ç¨‹å®‰å…¨å•ä¾‹ä¹ é¢˜å•ä¾‹æ¨¡å¼æœ‰å¾ˆå¤šå®žçŽ°æ–¹æ³•ï¼Œé¥¿æ±‰ã€æ‡’æ±‰ã€é™æ€å†…éƒ¨ç±»ã€æžšä¸¾ç±»ï¼Œè¯•åˆ†æžæ¯ç§å®žçŽ°ä¸‹èŽ·å–å•ä¾‹å¯¹è±¡ï¼ˆå³è°ƒç”¨getInstanceï¼‰æ—¶çš„çº¿ç¨‹å®‰å…¨ï¼Œå¹¶æ€è€ƒæ³¨é‡Šä¸­çš„é—®é¢˜ é¥¿æ±‰å¼ï¼šç±»åŠ è½½å°±ä¼šå¯¼è‡´è¯¥å•å®žä¾‹å¯¹è±¡è¢«åˆ›å»º æ‡’æ±‰å¼ï¼šç±»åŠ è½½ä¸ä¼šå¯¼è‡´è¯¥å•å®žä¾‹å¯¹è±¡è¢«åˆ›å»ºï¼Œè€Œæ˜¯é¦–æ¬¡ä½¿ç”¨è¯¥å¯¹è±¡æ—¶æ‰ä¼šåˆ›å»º å®žçŽ°1ï¼š 123456789101112131415// é—®é¢˜1ï¼šä¸ºä»€ä¹ˆåŠ  final// é—®é¢˜2ï¼šå¦‚æžœå®žçŽ°äº†åºåˆ—åŒ–æŽ¥å£, è¿˜è¦åšä»€ä¹ˆæ¥é˜²æ­¢ååºåˆ—åŒ–ç ´åå•ä¾‹public final class Singleton implements Serializable &#123; // é—®é¢˜3ï¼šä¸ºä»€ä¹ˆè®¾ç½®ä¸ºç§æœ‰? æ˜¯å¦èƒ½é˜²æ­¢åå°„åˆ›å»ºæ–°çš„å®žä¾‹? private Singleton() &#123;&#125; // é—®é¢˜4ï¼šè¿™æ ·åˆå§‹åŒ–æ˜¯å¦èƒ½ä¿è¯å•ä¾‹å¯¹è±¡åˆ›å»ºæ—¶çš„çº¿ç¨‹å®‰å…¨? private static final Singleton INSTANCE = new Singleton(); // é—®é¢˜5ï¼šä¸ºä»€ä¹ˆæä¾›é™æ€æ–¹æ³•è€Œä¸æ˜¯ç›´æŽ¥å°† INSTANCE è®¾ç½®ä¸º public, è¯´å‡ºä½ çŸ¥é“çš„ç†ç”± public static Singleton getInstance() &#123; return INSTANCE; &#125; public Object readResolve() &#123; return INSTANCE; &#125;&#125; å®žçŽ°2ï¼š 123456789// é—®é¢˜1ï¼šæžšä¸¾å•ä¾‹æ˜¯å¦‚ä½•é™åˆ¶å®žä¾‹ä¸ªæ•°çš„// é—®é¢˜2ï¼šæžšä¸¾å•ä¾‹åœ¨åˆ›å»ºæ—¶æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜// é—®é¢˜3ï¼šæžšä¸¾å•ä¾‹èƒ½å¦è¢«åå°„ç ´åå•ä¾‹// é—®é¢˜4ï¼šæžšä¸¾å•ä¾‹èƒ½å¦è¢«ååºåˆ—åŒ–ç ´åå•ä¾‹// é—®é¢˜5ï¼šæžšä¸¾å•ä¾‹å±žäºŽæ‡’æ±‰å¼è¿˜æ˜¯é¥¿æ±‰å¼// é—®é¢˜6ï¼šæžšä¸¾å•ä¾‹å¦‚æžœå¸Œæœ›åŠ å…¥ä¸€äº›å•ä¾‹åˆ›å»ºæ—¶çš„åˆå§‹åŒ–é€»è¾‘è¯¥å¦‚ä½•åšenum Singleton &#123; INSTANCE;&#125; å®žçŽ°3ï¼š 123456789101112public final class Singleton &#123; private Singleton() &#123; &#125; private static Singleton INSTANCE = null; // åˆ†æžè¿™é‡Œçš„çº¿ç¨‹å®‰å…¨, å¹¶è¯´æ˜Žæœ‰ä»€ä¹ˆç¼ºç‚¹ public static synchronized Singleton getInstance() &#123; if( INSTANCE != null )&#123; return INSTANCE; &#125; INSTANCE = new Singleton(); return INSTANCE; &#125;&#125; å®žçŽ°4ï¼šDCL 12345678910111213141516171819public final class Singleton &#123; private Singleton() &#123; &#125; // é—®é¢˜1ï¼šè§£é‡Šä¸ºä»€ä¹ˆè¦åŠ  volatile ? private static volatile Singleton INSTANCE = null; // é—®é¢˜2ï¼šå¯¹æ¯”å®žçŽ°3, è¯´å‡ºè¿™æ ·åšçš„æ„ä¹‰ public static Singleton getInstance() &#123; if (INSTANCE != null) &#123; return INSTANCE; &#125; synchronized (Singleton.class) &#123; // é—®é¢˜3ï¼šä¸ºä»€ä¹ˆè¿˜è¦åœ¨è¿™é‡ŒåŠ ä¸ºç©ºåˆ¤æ–­, ä¹‹å‰ä¸æ˜¯åˆ¤æ–­è¿‡äº†å— if (INSTANCE != null) &#123; // t2 return INSTANCE; &#125; INSTANCE = new Singleton(); return INSTANCE; &#125; &#125;&#125; å®žçŽ°5ï¼š 1234567891011public final class Singleton &#123; private Singleton() &#123; &#125; // é—®é¢˜1ï¼šå±žäºŽæ‡’æ±‰å¼è¿˜æ˜¯é¥¿æ±‰å¼ private static class LazyHolder &#123; static final Singleton INSTANCE = new Singleton(); &#125; // é—®é¢˜2ï¼šåœ¨åˆ›å»ºæ—¶æ˜¯å¦æœ‰å¹¶å‘é—®é¢˜ public static Singleton getInstance() &#123; return LazyHolder.INSTANCE; &#125;&#125; 5. æœ¬ç« å°ç»“æœ¬ç« é‡ç‚¹è®²è§£äº† JMM ä¸­çš„ å¯è§æ€§ - ç”± JVM ç¼“å­˜ä¼˜åŒ–å¼•èµ· æœ‰åºæ€§ - ç”± JVM æŒ‡ä»¤é‡æŽ’åºä¼˜åŒ–å¼•èµ· happens-before è§„åˆ™ åŽŸç†æ–¹é¢ CPU æŒ‡ä»¤å¹¶è¡Œ volatile æ¨¡å¼æ–¹é¢ ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼çš„ volatile æ”¹è¿› åŒæ­¥æ¨¡å¼ä¹‹ balking å››ã€å…±äº«æ¨¡åž‹ä¹‹æ— é”1. æœ¬ç« å†…å®¹ CAS ä¸Ž volatile åŽŸå­æ•´æ•° åŽŸå­å¼•ç”¨ åŽŸå­ç´¯åŠ å™¨ Unsafe 2. é—®é¢˜æå‡ºæœ‰å¦‚ä¸‹éœ€æ±‚ï¼Œä¿è¯ account.withdraw å–æ¬¾æ–¹æ³•çš„çº¿ç¨‹å®‰å…¨ 123456789101112131415161718192021222324252627282930313233package cn.itcast;import java.util.ArrayList;import java.util.List;interface Account &#123; // èŽ·å–ä½™é¢ Integer getBalance(); // å–æ¬¾ void withdraw(Integer amount); /*** æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ* å¦‚æžœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æžœåº”å½“æ˜¯ 0*/ static void demo(Account account) &#123; List&lt;Thread&gt; ts = new ArrayList&lt;&gt;(); long start = System.nanoTime(); for (int i = 0; i &lt; 1000; i++) &#123; ts.add(new Thread(() -&gt; &#123; account.withdraw(10); &#125;)); &#125; ts.forEach(Thread::start); ts.forEach(t -&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); long end = System.nanoTime(); System.out.println(account.getBalance() + &quot; cost: &quot; + (end-start)/1000_000 + &quot; ms&quot;); &#125;&#125; åŽŸæœ‰å®žçŽ°å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ 1234567891011121314class AccountUnsafe implements Account &#123; private Integer balance; public AccountUnsafe(Integer balance) &#123; this.balance = balance; &#125; @Override public Integer getBalance() &#123; return balance; &#125; @Override public void withdraw(Integer amount) &#123; balance -= amount; &#125;&#125; æ‰§è¡Œæµ‹è¯•ä»£ç  123public static void main(String[] args) &#123; Account.demo(new AccountUnsafe(10000));&#125; æŸæ¬¡çš„æ‰§è¡Œç»“æžœ 1330 cost: 306 ms 2.1 ä¸ºä»€ä¹ˆä¸å®‰å…¨withdraw æ–¹æ³• 123public void withdraw(Integer amount) &#123; balance -= amount;&#125; å¯¹åº”çš„å­—èŠ‚ç  123456789ALOAD 0 // &lt;- thisALOAD 0 GETFIELD cn/itcast/AccountUnsafe.balance : Ljava/lang/Integer; // &lt;- this.balanceINVOKEVIRTUAL java/lang/Integer.intValue ()I // æ‹†ç®±ALOAD 1 // &lt;- amountINVOKEVIRTUAL java/lang/Integer.intValue ()I // æ‹†ç®±ISUB // å‡æ³•INVOKESTATIC java/lang/Integer.valueOf (I)Ljava/lang/Integer; // ç»“æžœè£…ç®±PUTFIELD cn/itcast/AccountUnsafe.balance : Ljava/lang/Integer; // -&gt; this.balance å¤šçº¿ç¨‹æ‰§è¡Œæµç¨‹ 123456789101112131415161718ALOAD 0 // thread-0 &lt;- thisALOAD 0GETFIELD cn/itcast/AccountUnsafe.balance // thread-0 &lt;- this.balanceINVOKEVIRTUAL java/lang/Integer.intValue // thread-0 æ‹†ç®±ALOAD 1 // thread-0 &lt;- amountINVOKEVIRTUAL java/lang/Integer.intValue // thread-0 æ‹†ç®±ISUB // thread-0 å‡æ³•INVOKESTATIC java/lang/Integer.valueOf // thread-0 ç»“æžœè£…ç®±PUTFIELD cn/itcast/AccountUnsafe.balance // thread-0 -&gt; this.balanceALOAD 0 // thread-1 &lt;- thisALOAD 0GETFIELD cn/itcast/AccountUnsafe.balance // thread-1 &lt;- this.balanceINVOKEVIRTUAL java/lang/Integer.intValue // thread-1 æ‹†ç®±ALOAD 1 // thread-1 &lt;- amountINVOKEVIRTUAL java/lang/Integer.intValue // thread-1 æ‹†ç®±ISUB // thread-1 å‡æ³•INVOKESTATIC java/lang/Integer.valueOf // thread-1 ç»“æžœè£…ç®±PUTFIELD cn/itcast/AccountUnsafe.balance // thread-1 -&gt; this.balance å•æ ¸çš„æŒ‡ä»¤äº¤é”™ å¤šæ ¸çš„æŒ‡ä»¤äº¤é”™ 2.2 è§£å†³æ€è·¯-é”é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç»™ Account å¯¹è±¡åŠ é” 1234567891011121314class AccountUnsafe implements Account &#123; private Integer balance; public AccountUnsafe(Integer balance) &#123; this.balance = balance; &#125; @Override public synchronized Integer getBalance() &#123; return balance; &#125; @Override public synchronized void withdraw(Integer amount) &#123; balance -= amount; &#125;&#125; ç»“æžœä¸º 10 cost: 399 ms 2.3 è§£å†³æ€è·¯-æ— é”12345678910111213141516171819202122class AccountSafe implements Account &#123; private AtomicInteger balance; public AccountSafe(Integer balance) &#123; this.balance = new AtomicInteger(balance); &#125; @Override public Integer getBalance() &#123; return balance.get(); &#125; @Override public void withdraw(Integer amount) &#123; while (true) &#123; int prev = balance.get(); int next = prev - amount; if (balance.compareAndSet(prev, next)) &#123; break; &#125; &#125; // å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢çš„æ–¹æ³• // balance.addAndGet(-1 * amount); &#125;&#125; æ‰§è¡Œæµ‹è¯•ä»£ç  123public static void main(String[] args) &#123; Account.demo(new AccountSafe(10000));&#125; æŸæ¬¡çš„æ‰§è¡Œç»“æžœ 10 cost: 302 ms 3. CAS ä¸Ž volatileå‰é¢çœ‹åˆ°çš„ AtomicInteger çš„è§£å†³æ–¹æ³•ï¼Œå†…éƒ¨å¹¶æ²¡æœ‰ç”¨é”æ¥ä¿æŠ¤å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®žçŽ°çš„å‘¢ï¼Ÿ 123456789101112131415161718192021public void withdraw(Integer amount) &#123; while(true) &#123; // éœ€è¦ä¸æ–­å°è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ while (true) &#123; // æ¯”å¦‚æ‹¿åˆ°äº†æ—§å€¼ 1000 int prev = balance.get(); // åœ¨è¿™ä¸ªåŸºç¡€ä¸Š 1000-10 = 990 int next = prev - amount; /*compareAndSet æ­£æ˜¯åšè¿™ä¸ªæ£€æŸ¥ï¼Œåœ¨ set å‰ï¼Œå…ˆæ¯”è¾ƒ prev ä¸Žå½“å‰å€¼- ä¸ä¸€è‡´äº†ï¼Œnext ä½œåºŸï¼Œè¿”å›ž false è¡¨ç¤ºå¤±è´¥æ¯”å¦‚ï¼Œåˆ«çš„çº¿ç¨‹å·²ç»åšäº†å‡æ³•ï¼Œå½“å‰å€¼å·²ç»è¢«å‡æˆäº† 990é‚£ä¹ˆæœ¬çº¿ç¨‹çš„è¿™æ¬¡ 990 å°±ä½œåºŸäº†ï¼Œè¿›å…¥ while ä¸‹æ¬¡å¾ªçŽ¯é‡è¯•- ä¸€è‡´ï¼Œä»¥ next è®¾ç½®ä¸ºæ–°å€¼ï¼Œè¿”å›ž true è¡¨ç¤ºæˆåŠŸ*/ if (balance.compareAndSet(prev, next)) &#123; break; &#125; &#125; &#125;&#125; å…¶ä¸­çš„å…³é”®æ˜¯ compareAndSetï¼Œå®ƒçš„ç®€ç§°å°±æ˜¯ CAS ï¼ˆä¹Ÿæœ‰ Compare And Swap çš„è¯´æ³•ï¼‰ï¼Œå®ƒå¿…é¡»æ˜¯åŽŸå­æ“ä½œã€‚ æ³¨æ„ å…¶å®ž CAS çš„åº•å±‚æ˜¯ lock cmpxchg æŒ‡ä»¤ï¼ˆX86 æž¶æž„ï¼‰ï¼Œåœ¨å•æ ¸ CPU å’Œå¤šæ ¸ CPU ä¸‹éƒ½èƒ½å¤Ÿä¿è¯ã€æ¯”è¾ƒ-äº¤æ¢ã€‘çš„åŽŸå­æ€§ã€‚ åœ¨å¤šæ ¸çŠ¶æ€ä¸‹ï¼ŒæŸä¸ªæ ¸æ‰§è¡Œåˆ°å¸¦ lock çš„æŒ‡ä»¤æ—¶ï¼ŒCPU ä¼šè®©æ€»çº¿é”ä½ï¼Œå½“è¿™ä¸ªæ ¸æŠŠæ­¤æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå†å¼€å¯æ€»çº¿ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¢«çº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶æ‰€æ‰“æ–­ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹å¯¹å†…å­˜æ“ä½œçš„å‡†ç¡®æ€§ï¼Œæ˜¯åŽŸå­çš„ã€‚ 3.1 æ…¢åŠ¨ä½œåˆ†æž12345678910111213141516171819202122232425262728293031@Slf4jpublic class SlowMotion &#123; public static void main(String[] args) &#123; AtomicInteger balance = new AtomicInteger(10000); int mainPrev = balance.get(); log.debug(&quot;try get &#123;&#125;&quot;, mainPrev); new Thread(() -&gt; &#123; sleep(1000); int prev = balance.get(); balance.compareAndSet(prev, 9000); log.debug(balance.toString()); &#125;, &quot;t1&quot;).start(); sleep(2000); log.debug(&quot;try set 8000...&quot;); boolean isSuccess = balance.compareAndSet(mainPrev, 8000); log.debug(&quot;is success ? &#123;&#125;&quot;, isSuccess); if(!isSuccess)&#123; mainPrev = balance.get(); log.debug(&quot;try set 8000...&quot;); isSuccess = balance.compareAndSet(mainPrev, 8000); log.debug(&quot;is success ? &#123;&#125;&quot;, isSuccess); &#125; &#125; private static void sleep(int millis) &#123; try &#123; Thread.sleep(millis); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¾“å‡ºç»“æžœ 1234562019-10-13 11:28:37.134 [main] try get 100002019-10-13 11:28:38.154 [t1] 90002019-10-13 11:28:39.154 [main] try set 8000...2019-10-13 11:28:39.154 [main] is success ? false2019-10-13 11:28:39.154 [main] try set 8000...2019-10-13 11:28:39.154 [main] is success ? true 3.2 volatileèŽ·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„å¯è§æ€§ï¼Œéœ€è¦ä½¿ç”¨ volatile ä¿®é¥°ã€‚ å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»Žè‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­èŽ·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æŽ¥æ“ä½œä¸»å­˜ã€‚å³ä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ æ³¨æ„ volatile ä»…ä»…ä¿è¯äº†å…±äº«å˜é‡çš„å¯è§æ€§ï¼Œè®©å…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°æœ€æ–°å€¼ï¼Œä½†ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼ˆä¸èƒ½ä¿è¯åŽŸå­æ€§ï¼‰ CAS å¿…é¡»å€ŸåŠ© volatile æ‰èƒ½è¯»å–åˆ°å…±äº«å˜é‡çš„æœ€æ–°å€¼æ¥å®žçŽ°ã€æ¯”è¾ƒå¹¶äº¤æ¢ã€‘çš„æ•ˆæžœ 3.3 ä¸ºä»€ä¹ˆæ— é”æ•ˆçŽ‡é«˜ æ— é”æƒ…å†µä¸‹ï¼Œå³ä½¿é‡è¯•å¤±è´¥ï¼Œçº¿ç¨‹å§‹ç»ˆåœ¨é«˜é€Ÿè¿è¡Œï¼Œæ²¡æœ‰åœæ­‡ï¼Œè€Œ synchronized ä¼šè®©çº¿ç¨‹åœ¨æ²¡æœ‰èŽ·å¾—é”çš„æ—¶å€™ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥é˜»å¡žã€‚æ‰“ä¸ªæ¯”å–» çº¿ç¨‹å°±å¥½åƒé«˜é€Ÿè·‘é“ä¸Šçš„èµ›è½¦ï¼Œé«˜é€Ÿè¿è¡Œæ—¶ï¼Œé€Ÿåº¦è¶…å¿«ï¼Œä¸€æ—¦å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°±å¥½æ¯”èµ›è½¦è¦å‡é€Ÿã€ç†„ç«ï¼Œç­‰è¢«å”¤é†’åˆå¾—é‡æ–°æ‰“ç«ã€å¯åŠ¨ã€åŠ é€Ÿâ€¦ æ¢å¤åˆ°é«˜é€Ÿè¿è¡Œï¼Œä»£ä»·æ¯”è¾ƒå¤§ ä½†æ— é”æƒ…å†µä¸‹ï¼Œå› ä¸ºçº¿ç¨‹è¦ä¿æŒè¿è¡Œï¼Œéœ€è¦é¢å¤– CPU çš„æ”¯æŒï¼ŒCPU åœ¨è¿™é‡Œå°±å¥½æ¯”é«˜é€Ÿè·‘é“ï¼Œæ²¡æœ‰é¢å¤–çš„è·‘é“ï¼Œçº¿ç¨‹æƒ³é«˜é€Ÿè¿è¡Œä¹Ÿæ— ä»Žè°ˆèµ·ï¼Œè™½ç„¶ä¸ä¼šè¿›å…¥é˜»å¡žï¼Œä½†ç”±äºŽæ²¡æœ‰åˆ†åˆ°æ—¶é—´ç‰‡ï¼Œä»ç„¶ä¼šè¿›å…¥å¯è¿è¡ŒçŠ¶æ€ï¼Œè¿˜æ˜¯ä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ 3.4 CAS çš„ç‰¹ç‚¹ç»“åˆ CAS å’Œ volatile å¯ä»¥å®žçŽ°æ— é”å¹¶å‘ï¼Œé€‚ç”¨äºŽçº¿ç¨‹æ•°å°‘ã€å¤šæ ¸ CPU çš„åœºæ™¯ä¸‹ã€‚ CAS æ˜¯åŸºäºŽä¹è§‚é”çš„æ€æƒ³ï¼šæœ€ä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚ synchronized æ˜¯åŸºäºŽæ‚²è§‚é”çš„æ€æƒ³ï¼šæœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚ CAS ä½“çŽ°çš„æ˜¯æ— é”å¹¶å‘ã€æ— é˜»å¡žå¹¶å‘ï¼Œè¯·ä»”ç»†ä½“ä¼šè¿™ä¸¤å¥è¯çš„æ„æ€ å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡žï¼Œè¿™æ˜¯æ•ˆçŽ‡æå‡çš„å› ç´ ä¹‹ä¸€ ä½†å¦‚æžœç«žäº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆçŽ‡ä¼šå—å½±å“ 4. åŽŸå­æ•´æ•°J.U.C å¹¶å‘åŒ…æä¾›äº†ï¼š AtomicBoolean AtomicInteger AtomicLong ä»¥ AtomicInteger ä¸ºä¾‹ 123456789101112131415161718192021222324252627AtomicInteger i = new AtomicInteger(0);// èŽ·å–å¹¶è‡ªå¢žï¼ˆi = 0, ç»“æžœ i = 1, è¿”å›ž 0ï¼‰ï¼Œç±»ä¼¼äºŽ i++System.out.println(i.getAndIncrement());// è‡ªå¢žå¹¶èŽ·å–ï¼ˆi = 1, ç»“æžœ i = 2, è¿”å›ž 2ï¼‰ï¼Œç±»ä¼¼äºŽ ++iSystem.out.println(i.incrementAndGet());// è‡ªå‡å¹¶èŽ·å–ï¼ˆi = 2, ç»“æžœ i = 1, è¿”å›ž 1ï¼‰ï¼Œç±»ä¼¼äºŽ --iSystem.out.println(i.decrementAndGet());// èŽ·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æžœ i = 0, è¿”å›ž 1ï¼‰ï¼Œç±»ä¼¼äºŽ i--System.out.println(i.getAndDecrement());// èŽ·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æžœ i = 5, è¿”å›ž 0ï¼‰System.out.println(i.getAndAdd(5));// åŠ å€¼å¹¶èŽ·å–ï¼ˆi = 5, ç»“æžœ i = 0, è¿”å›ž 0ï¼‰System.out.println(i.addAndGet(-5));// èŽ·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æžœ i = -2, è¿”å›ž 0ï¼‰// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŽŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨System.out.println(i.getAndUpdate(p -&gt; p - 2));// æ›´æ–°å¹¶èŽ·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æžœ i = 0, è¿”å›ž 0ï¼‰// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŽŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨System.out.println(i.updateAndGet(p -&gt; p + 2));// èŽ·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æžœ i = 10, è¿”å›ž 0ï¼‰// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŽŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨// getAndUpdate å¦‚æžœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ finalSystem.out.println(i.getAndAccumulate(10, (p, x) -&gt; p + x));// è®¡ç®—å¹¶èŽ·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æžœ i = 0, è¿”å›ž 0ï¼‰// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŽŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨System.out.println(i.accumulateAndGet(-10, (p, x) -&gt; p + x)); 5. åŽŸå­å¼•ç”¨ä¸ºä»€ä¹ˆéœ€è¦åŽŸå­å¼•ç”¨ç±»åž‹ï¼Ÿ AtomicReference AtomicMarkableReference AtomicStampedReference æœ‰å¦‚ä¸‹æ–¹æ³• 123456789101112131415161718192021222324252627public interface DecimalAccount &#123; // èŽ·å–ä½™é¢ BigDecimal getBalance(); // å–æ¬¾ void withdraw(BigDecimal amount); /*** æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ* å¦‚æžœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æžœåº”å½“æ˜¯ 0*/ static void demo(DecimalAccount account) &#123; List&lt;Thread&gt; ts = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 1000; i++) &#123; ts.add(new Thread(() -&gt; &#123; account.withdraw(BigDecimal.TEN); &#125;)); &#125; ts.forEach(Thread::start); ts.forEach(t -&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); System.out.println(account.getBalance()); &#125;&#125; è¯•ç€æä¾›ä¸åŒçš„ DecimalAccount å®žçŽ°ï¼Œå®žçŽ°å®‰å…¨çš„å–æ¬¾æ“ä½œ 5.1 ä¸å®‰å…¨å®žçŽ°12345678910111213141516171819class DecimalAccountUnsafe implements DecimalAccount &#123; BigDecimal balance; public DecimalAccountUnsafe(BigDecimal balance) &#123; this.balance = balance; &#125; @Override public BigDecimal getBalance() &#123; return balance; &#125; @Override public void withdraw(BigDecimal amount) &#123; BigDecimal balance = this.getBalance(); this.balance = balance.subtract(amount); &#125;&#125; 5.2 å®‰å…¨å®žçŽ°-ä½¿ç”¨é”12345678910111213141516171819202122class DecimalAccountSafeLock implements DecimalAccount &#123; private final Object lock = new Object(); BigDecimal balance; public DecimalAccountSafeLock(BigDecimal balance) &#123; this.balance = balance; &#125; @Override public BigDecimal getBalance() &#123; return balance; &#125; @Override public void withdraw(BigDecimal amount) &#123; synchronized (lock) &#123; BigDecimal balance = this.getBalance(); this.balance = balance.subtract(amount); &#125; &#125;&#125; 5.3 å®‰å…¨å®žçŽ°-ä½¿ç”¨CAS123456789101112131415161718192021222324class DecimalAccountSafeCas implements DecimalAccount &#123; AtomicReference&lt;BigDecimal&gt; ref; public DecimalAccountSafeCas(BigDecimal balance) &#123; ref = new AtomicReference&lt;&gt;(balance); &#125; @Override public BigDecimal getBalance() &#123; return ref.get(); &#125; @Override public void withdraw(BigDecimal amount) &#123; while (true) &#123; BigDecimal prev = ref.get(); BigDecimal next = prev.subtract(amount); if (ref.compareAndSet(prev, next)) &#123; break; &#125; &#125; &#125;&#125; æµ‹è¯•ä»£ç  123DecimalAccount.demo(new DecimalAccountUnsafe(new BigDecimal(&quot;10000&quot;)));DecimalAccount.demo(new DecimalAccountSafeLock(new BigDecimal(&quot;10000&quot;)));DecimalAccount.demo(new DecimalAccountSafeCas(new BigDecimal(&quot;10000&quot;))); è¿è¡Œç»“æžœ 1234310 cost: 425 ms0 cost: 285 ms0 cost: 274 ms 5.4 ABAé—®é¢˜åŠè§£å†³ABA é—®é¢˜1234567891011121314151617181920static AtomicReference&lt;String&gt; ref = new AtomicReference&lt;&gt;(&quot;A&quot;);public static void main(String[] args) throws InterruptedException &#123; log.debug(&quot;main start...&quot;); // èŽ·å–å€¼ A // è¿™ä¸ªå…±äº«å˜é‡è¢«å®ƒçº¿ç¨‹ä¿®æ”¹è¿‡ï¼Ÿ String prev = ref.get(); other(); sleep(1); // å°è¯•æ”¹ä¸º C log.debug(&quot;change A-&gt;C &#123;&#125;&quot;, ref.compareAndSet(prev, &quot;C&quot;));&#125;private static void other() &#123; new Thread(() -&gt; &#123; log.debug(&quot;change A-&gt;B &#123;&#125;&quot;, ref.compareAndSet(ref.get(), &quot;B&quot;)); &#125;, &quot;t1&quot;).start(); sleep(0.5); new Thread(() -&gt; &#123; log.debug(&quot;change B-&gt;A &#123;&#125;&quot;, ref.compareAndSet(ref.get(), &quot;A&quot;)); &#125;, &quot;t2&quot;).start();&#125; è¾“å‡º 123411:29:52.325 c.Test36 [main] - main start...11:29:52.379 c.Test36 [t1] - change A-&gt;B true11:29:52.879 c.Test36 [t2] - change B-&gt;A true11:29:53.880 c.Test36 [main] - change A-&gt;C true ä¸»çº¿ç¨‹ä»…èƒ½åˆ¤æ–­å‡ºå…±äº«å˜é‡çš„å€¼ä¸Žæœ€åˆå€¼ A æ˜¯å¦ç›¸åŒï¼Œä¸èƒ½æ„ŸçŸ¥åˆ°è¿™ç§ä»Ž A æ”¹ä¸º B åˆ æ”¹å›ž A çš„æƒ…å†µï¼Œå¦‚æžœä¸»çº¿ç¨‹å¸Œæœ›ï¼š åªè¦æœ‰å…¶å®ƒçº¿ç¨‹ã€åŠ¨è¿‡äº†ã€‘å…±äº«å˜é‡ï¼Œé‚£ä¹ˆè‡ªå·±çš„ cas å°±ç®—å¤±è´¥ï¼Œè¿™æ—¶ï¼Œä»…æ¯”è¾ƒå€¼æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦å†åŠ ä¸€ä¸ªç‰ˆæœ¬å· AtomicStampedReference123456789101112131415161718192021222324252627static AtomicStampedReference&lt;String&gt; ref = new AtomicStampedReference&lt;&gt;(&quot;A&quot;, 0);public static void main(String[] args) throws InterruptedException &#123; log.debug(&quot;main start...&quot;); // èŽ·å–å€¼ A String prev = ref.getReference(); // èŽ·å–ç‰ˆæœ¬å· int stamp = ref.getStamp(); log.debug(&quot;ç‰ˆæœ¬ &#123;&#125;&quot;, stamp); // å¦‚æžœä¸­é—´æœ‰å…¶å®ƒçº¿ç¨‹å¹²æ‰°ï¼Œå‘ç”Ÿäº† ABA çŽ°è±¡ other(); sleep(1); // å°è¯•æ”¹ä¸º C log.debug(&quot;change A-&gt;C &#123;&#125;&quot;, ref.compareAndSet(prev, &quot;C&quot;, stamp, stamp + 1));&#125;private static void other() &#123; new Thread(() -&gt; &#123; log.debug(&quot;change A-&gt;B &#123;&#125;&quot;, ref.compareAndSet(ref.getReference(), &quot;B&quot;, ref.getStamp(), ref.getStamp() + 1)); log.debug(&quot;æ›´æ–°ç‰ˆæœ¬ä¸º &#123;&#125;&quot;, ref.getStamp()); &#125;, &quot;t1&quot;).start(); sleep(0.5); new Thread(() -&gt; &#123; log.debug(&quot;change B-&gt;A &#123;&#125;&quot;, ref.compareAndSet(ref.getReference(), &quot;A&quot;, ref.getStamp(), ref.getStamp() + 1)); log.debug(&quot;æ›´æ–°ç‰ˆæœ¬ä¸º &#123;&#125;&quot;, ref.getStamp()); &#125;, &quot;t2&quot;).start();&#125; è¾“å‡ºä¸º 123456715:41:34.891 c.Test36 [main] - main start...15:41:34.894 c.Test36 [main] - ç‰ˆæœ¬ 015:41:34.956 c.Test36 [t1] - change A-&gt;B true15:41:34.956 c.Test36 [t1] - æ›´æ–°ç‰ˆæœ¬ä¸º 115:41:35.457 c.Test36 [t2] - change B-&gt;A true15:41:35.457 c.Test36 [t2] - æ›´æ–°ç‰ˆæœ¬ä¸º 215:41:36.457 c.Test36 [main] - change A-&gt;C false AtomicStampedReference å¯ä»¥ç»™åŽŸå­å¼•ç”¨åŠ ä¸Šç‰ˆæœ¬å·ï¼Œè¿½è¸ªåŽŸå­å¼•ç”¨æ•´ä¸ªçš„å˜åŒ–è¿‡ç¨‹ï¼Œå¦‚ï¼š A -&gt; B -&gt; A -&gt;C ï¼Œé€šè¿‡AtomicStamped-Referenceï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¼•ç”¨å˜é‡ä¸­é€”è¢«æ›´æ”¹äº†å‡ æ¬¡ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œåªæ˜¯å•çº¯çš„å…³å¿ƒæ˜¯å¦æ›´æ”¹è¿‡ï¼Œæ‰€ä»¥å°±æœ‰äº†AtomicMarkableReference AtomicMarkableReference1234567class GarbageBag &#123;String desc;public GarbageBag(String desc) &#123;this.desc = desc;&#125;public void setDesc(String desc) &#123;this.desc = desc; 123456789101112131415161718192021222324@Slf4jpublic class TestABAAtomicMarkableReference &#123; public static void main(String[] args) throws InterruptedException &#123; GarbageBag bag = new GarbageBag(&quot;è£…æ»¡äº†åžƒåœ¾&quot;); // å‚æ•°2 mark å¯ä»¥çœ‹ä½œä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºåžƒåœ¾è¢‹æ»¡äº† AtomicMarkableReference&lt;GarbageBag&gt; ref = new AtomicMarkableReference&lt;&gt;(bag, true); log.debug(&quot;ä¸»çº¿ç¨‹ start...&quot;); GarbageBag prev = ref.getReference(); log.debug(prev.toString()); new Thread(() -&gt; &#123; log.debug(&quot;æ‰“æ‰«å«ç”Ÿçš„çº¿ç¨‹ start...&quot;); bag.setDesc(&quot;ç©ºåžƒåœ¾è¢‹&quot;); while (!ref.compareAndSet(bag, bag, true, false)) &#123;&#125; log.debug(bag.toString()); &#125;).start(); Thread.sleep(1000); log.debug(&quot;ä¸»çº¿ç¨‹æƒ³æ¢ä¸€åªæ–°åžƒåœ¾è¢‹ï¼Ÿ&quot;); boolean success = ref.compareAndSet(prev, new GarbageBag(&quot;ç©ºåžƒåœ¾è¢‹&quot;), true, false); log.debug(&quot;æ¢äº†ä¹ˆï¼Ÿ&quot; + success); log.debug(ref.getReference().toString()); &#125;&#125; è¾“å‡º 12345672019-10-13 15:30:09.264 [main] ä¸»çº¿ç¨‹ start...2019-10-13 15:30:09.270 [main] cn.itcast.GarbageBag@5f0fd5a0 è£…æ»¡äº†åžƒåœ¾2019-10-13 15:30:09.293 [Thread-1] æ‰“æ‰«å«ç”Ÿçš„çº¿ç¨‹ start...2019-10-13 15:30:09.294 [Thread-1] cn.itcast.GarbageBag@5f0fd5a0 ç©ºåžƒåœ¾è¢‹2019-10-13 15:30:10.294 [main] ä¸»çº¿ç¨‹æƒ³æ¢ä¸€åªæ–°åžƒåœ¾è¢‹ï¼Ÿ2019-10-13 15:30:10.294 [main] æ¢äº†ä¹ˆï¼Ÿfalse2019-10-13 15:30:10.294 [main] cn.itcast.GarbageBag@5f0fd5a0 ç©ºåžƒåœ¾è¢‹ å¯ä»¥æ³¨é‡ŠæŽ‰æ‰“æ‰«å«ç”Ÿçº¿ç¨‹ä»£ç ï¼Œå†è§‚å¯Ÿè¾“å‡º 6. åŽŸå­æ•°ç»„ AtomicIntegerArray AtomicLongArray AtomicReferenceArray æœ‰å¦‚ä¸‹æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435/**å‚æ•°1ï¼Œæä¾›æ•°ç»„ã€å¯ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨æ•°ç»„æˆ–çº¿ç¨‹å®‰å…¨æ•°ç»„å‚æ•°2ï¼ŒèŽ·å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•å‚æ•°3ï¼Œè‡ªå¢žæ–¹æ³•ï¼Œå›žä¼  array, indexå‚æ•°4ï¼Œæ‰“å°æ•°ç»„çš„æ–¹æ³•*/// supplier æä¾›è€… æ— ä¸­ç”Ÿæœ‰ ()-&gt;ç»“æžœ// function å‡½æ•° ä¸€ä¸ªå‚æ•°ä¸€ä¸ªç»“æžœ (å‚æ•°)-&gt;ç»“æžœ , BiFunction (å‚æ•°1,å‚æ•°2)-&gt;ç»“æžœ// consumer æ¶ˆè´¹è€… ä¸€ä¸ªå‚æ•°æ²¡ç»“æžœ (å‚æ•°)-&gt;void, BiConsumer (å‚æ•°1,å‚æ•°2)-&gt;private static &lt;T&gt; void demo( Supplier&lt;T&gt; arraySupplier, Function&lt;T, Integer&gt; lengthFun, BiConsumer&lt;T, Integer&gt; putConsumer, Consumer&lt;T&gt; printConsumer ) &#123; List&lt;Thread&gt; ts = new ArrayList&lt;&gt;(); T array = arraySupplier.get(); int length = lengthFun.apply(array); for (int i = 0; i &lt; length; i++) &#123; // æ¯ä¸ªçº¿ç¨‹å¯¹æ•°ç»„ä½œ 10000 æ¬¡æ“ä½œ ts.add(new Thread(() -&gt; &#123; for (int j = 0; j &lt; 10000; j++) &#123; putConsumer.accept(array, j%length); &#125; &#125;)); &#125; ts.forEach(t -&gt; t.start()); // å¯åŠ¨æ‰€æœ‰çº¿ç¨‹ ts.forEach(t -&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); // ç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸ printConsumer.accept(array);&#125; 6.1 ä¸å®‰å…¨çš„æ•°ç»„123456demo( ()-&gt;new int[10], (array)-&gt;array.length, (array, index) -&gt; array[index]++, array-&gt; System.out.println(Arrays.toString(array))); ç»“æžœ 1[9870, 9862, 9774, 9697, 9683, 9678, 9679, 9668, 9680, 9698] 6.2 å®‰å…¨çš„æ•°ç»„123456demo( ()-&gt; new AtomicIntegerArray(10), (array) -&gt; array.length(), (array, index) -&gt; array.getAndIncrement(index), array -&gt; System.out.println(array)); ç»“æžœ 1[10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000, 10000] 7. å­—æ®µæ›´æ–°å™¨ AtomicReferenceFieldUpdater // åŸŸ å­—æ®µ AtomicIntegerFieldUpdater AtomicLongFieldUpdater åˆ©ç”¨å­—æ®µæ›´æ–°å™¨ï¼Œå¯ä»¥é’ˆå¯¹å¯¹è±¡çš„æŸä¸ªåŸŸï¼ˆFieldï¼‰è¿›è¡ŒåŽŸå­æ“ä½œï¼Œåªèƒ½é…åˆ volatile ä¿®é¥°çš„å­—æ®µä½¿ç”¨ï¼Œå¦åˆ™ä¼šå‡ºçŽ°å¼‚å¸¸ 1Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: Must be volatile type 1234567891011121314151617public class Test5 &#123; private volatile int field; public static void main(String[] args) &#123; AtomicIntegerFieldUpdater fieldUpdater = AtomicIntegerFieldUpdater.newUpdater(Test5.class, &quot;field&quot;); Test5 test5 = new Test5(); fieldUpdater.compareAndSet(test5, 0, 10); // ä¿®æ”¹æˆåŠŸ field = 10 System.out.println(test5.field); // ä¿®æ”¹æˆåŠŸ field = 20 fieldUpdater.compareAndSet(test5, 10, 20); System.out.println(test5.field); // ä¿®æ”¹å¤±è´¥ field = 20 fieldUpdater.compareAndSet(test5, 10, 30); System.out.println(test5.field); &#125;&#125; è¾“å‡º 123102020 8. åŽŸå­ç´¯åŠ å™¨8.1 ç´¯åŠ å™¨æ€§èƒ½æ¯”è¾ƒ1234567891011121314151617181920212223242526private static &lt;T&gt; void demo(Supplier&lt;T&gt; adderSupplier, Consumer&lt;T&gt; action) &#123; T adder = adderSupplier.get(); long start = System.nanoTime(); List&lt;Thread&gt; ts = new ArrayList&lt;&gt;(); // 4 ä¸ªçº¿ç¨‹ï¼Œæ¯äººç´¯åŠ  50 ä¸‡ for (int i = 0; i &lt; 40; i++) &#123; ts.add(new Thread(() -&gt; &#123; for (int j = 0; j &lt; 500000; j++) &#123; action.accept(adder); &#125; &#125;)); &#125; ts.forEach(t -&gt; t.start()); ts.forEach(t -&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); long end = System.nanoTime(); System.out.println(adder + &quot; cost:&quot; + (end - start)/1000_000);&#125; æ¯”è¾ƒ AtomicLong ä¸Ž LongAdder 1234567for (int i = 0; i &lt; 5; i++) &#123; demo(() -&gt; new LongAdder(), adder -&gt; adder.increment());&#125;for (int i = 0; i &lt; 5; i++) &#123; demo(() -&gt; new AtomicLong(), adder -&gt; adder.getAndIncrement());&#125; è¾“å‡º 123456789101000000 cost:431000000 cost:91000000 cost:71000000 cost:71000000 cost:71000000 cost:311000000 cost:271000000 cost:281000000 cost:241000000 cost:22 æ€§èƒ½æå‡çš„åŽŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœ‰ç«žäº‰æ—¶ï¼Œè®¾ç½®å¤šä¸ªç´¯åŠ å•å…ƒï¼ŒTherad-0 ç´¯åŠ  Cell[0]ï¼Œè€Œ Thread-1 ç´¯åŠ Cell[1]â€¦ æœ€åŽå°†ç»“æžœæ±‡æ€»ã€‚è¿™æ ·å®ƒä»¬åœ¨ç´¯åŠ æ—¶æ“ä½œçš„ä¸åŒçš„ Cell å˜é‡ï¼Œå› æ­¤å‡å°‘äº† CAS é‡è¯•å¤±è´¥ï¼Œä»Žè€Œæé«˜æ€§èƒ½ã€‚ 8.2 æºç ä¹‹LongAdderLongAdder æ˜¯å¹¶å‘å¤§å¸ˆ @author Doug Lea ï¼ˆå¤§å“¥æŽï¼‰çš„ä½œå“ï¼Œè®¾è®¡çš„éžå¸¸ç²¾å·§ LongAdder ç±»æœ‰å‡ ä¸ªå…³é”®åŸŸ 123456// ç´¯åŠ å•å…ƒæ•°ç»„, æ‡’æƒ°åˆå§‹åŒ–transient volatile Cell[] cells;// åŸºç¡€å€¼, å¦‚æžœæ²¡æœ‰ç«žäº‰, åˆ™ç”¨ cas ç´¯åŠ è¿™ä¸ªåŸŸtransient volatile long base;// åœ¨ cells åˆ›å»ºæˆ–æ‰©å®¹æ—¶, ç½®ä¸º 1, è¡¨ç¤ºåŠ é”transient volatile int cellsBusy; 8.3 cas é”123456789101112131415// ä¸è¦ç”¨äºŽå®žè·µï¼ï¼ï¼public class LockCas &#123; private AtomicInteger state = new AtomicInteger(0); public void lock() &#123; while (true) &#123; if (state.compareAndSet(0, 1)) &#123; break; &#125; &#125; &#125; public void unlock() &#123; log.debug(&quot;unlock...&quot;); state.set(0); &#125;&#125; æµ‹è¯• 1234567891011121314151617181920LockCas lock = new LockCas();new Thread(() -&gt; &#123; log.debug(&quot;begin...&quot;); lock.lock(); try &#123; log.debug(&quot;lock...&quot;); sleep(1); &#125; finally &#123; lock.unlock(); &#125;&#125;).start();new Thread(() -&gt; &#123; log.debug(&quot;begin...&quot;); lock.lock(); try &#123; log.debug(&quot;lock...&quot;); &#125; finally &#123; lock.unlock(); &#125;&#125;).start(); è¾“å‡º 12345618:27:07.198 c.Test42 [Thread-0] - begin...18:27:07.202 c.Test42 [Thread-0] - lock...18:27:07.198 c.Test42 [Thread-1] - begin...18:27:08.204 c.Test42 [Thread-0] - unlock...18:27:08.204 c.Test42 [Thread-1] - lock...18:27:08.204 c.Test42 [Thread-1] - unlock... 8.4 åŽŸç†ä¹‹ä¼ªå…±äº«å…¶ä¸­ Cell å³ä¸ºç´¯åŠ å•å…ƒ 1234567891011// é˜²æ­¢ç¼“å­˜è¡Œä¼ªå…±äº«@sun.misc.Contended static final class Cell &#123; volatile long value; Cell(long x) &#123; value = x; &#125; // æœ€é‡è¦çš„æ–¹æ³•, ç”¨æ¥ cas æ–¹å¼è¿›è¡Œç´¯åŠ , prev è¡¨ç¤ºæ—§å€¼, next è¡¨ç¤ºæ–°å€¼ final boolean cas(long prev, long next) &#123; return UNSAFE.compareAndSwapLong(this, valueOffset, prev, next); &#125; // çœç•¥ä¸é‡è¦ä»£ç  &#125; å¾—ä»Žç¼“å­˜è¯´èµ· ç¼“å­˜ä¸Žå†…å­˜çš„é€Ÿåº¦æ¯”è¾ƒ ä»Ž cpu åˆ° å¤§çº¦éœ€è¦çš„æ—¶é’Ÿå‘¨æœŸ å¯„å­˜å™¨ 1 cycle (4GHz çš„ CPU çº¦ä¸º0.25ns) L1 3~4 cycle L2 10~20 cycle L3 40~45 cycle å†…å­˜ 120~240 cycle å› ä¸º CPU ä¸Ž å†…å­˜çš„é€Ÿåº¦å·®å¼‚å¾ˆå¤§ï¼Œéœ€è¦é é¢„è¯»æ•°æ®è‡³ç¼“å­˜æ¥æå‡æ•ˆçŽ‡ã€‚ è€Œç¼“å­˜ä»¥ç¼“å­˜è¡Œä¸ºå•ä½ï¼Œæ¯ä¸ªç¼“å­˜è¡Œå¯¹åº”ç€ä¸€å—å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ 64 byteï¼ˆ8 ä¸ª longï¼‰ï¼ˆè¯‘æ³¨ï¼šæœ‰å¯èƒ½å¤„ç†å™¨çš„ç¼“å­˜è¡Œæ˜¯128å­—èŠ‚ï¼Œé‚£ä¹ˆä½¿ç”¨64å­—èŠ‚å¡«å……è¿˜æ˜¯ä¼šå­˜åœ¨ä¼ªå…±äº«é—®é¢˜ï¼‰ ç¼“å­˜çš„åŠ å…¥ä¼šé€ æˆæ•°æ®å‰¯æœ¬çš„äº§ç”Ÿï¼Œå³åŒä¸€ä»½æ•°æ®ä¼šç¼“å­˜åœ¨ä¸åŒæ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­ CPU è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦‚æžœæŸä¸ª CPU æ ¸å¿ƒæ›´æ”¹äº†æ•°æ®ï¼Œå…¶å®ƒ CPU æ ¸å¿ƒå¯¹åº”çš„æ•´ä¸ªç¼“å­˜è¡Œå¿…é¡»å¤±æ•ˆ å› ä¸º Cell æ˜¯æ•°ç»„å½¢å¼ï¼Œåœ¨å†…å­˜ä¸­æ˜¯è¿žç»­å­˜å‚¨çš„ï¼Œä¸€ä¸ª Cell ä¸º 24 å­—èŠ‚ï¼ˆ16 å­—èŠ‚çš„å¯¹è±¡å¤´å’Œ 8 å­—èŠ‚çš„ valueï¼‰ï¼Œå› æ­¤ç¼“å­˜è¡Œå¯ä»¥å­˜ä¸‹ 2 ä¸ªçš„ Cell å¯¹è±¡ã€‚è¿™æ ·é—®é¢˜æ¥äº†ï¼š Core-0 è¦ä¿®æ”¹ Cell[0] Core-1 è¦ä¿®æ”¹ Cell[1] æ— è®ºè°ä¿®æ”¹æˆåŠŸï¼Œéƒ½ä¼šå¯¼è‡´å¯¹æ–¹ Core çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œæ¯”å¦‚ Core-0 ä¸­ Cell[0]=6000, Cell[1]=8000 è¦ç´¯åŠ Cell[0]=6001, Cell[1]=8000 ï¼Œè¿™æ—¶ä¼šè®© Core-1 çš„ç¼“å­˜è¡Œå¤±æ•ˆ @sun.misc.Contended ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒçš„åŽŸç†æ˜¯åœ¨ä½¿ç”¨æ­¤æ³¨è§£çš„å¯¹è±¡æˆ–å­—æ®µçš„å‰åŽå„å¢žåŠ  128 å­—èŠ‚å¤§å°çš„paddingï¼Œä»Žè€Œè®© CPU å°†å¯¹è±¡é¢„è¯»è‡³ç¼“å­˜æ—¶å ç”¨ä¸åŒçš„ç¼“å­˜è¡Œï¼Œè¿™æ ·ï¼Œä¸ä¼šé€ æˆå¯¹æ–¹ç¼“å­˜è¡Œçš„å¤±æ•ˆ ç´¯åŠ ä¸»è¦è°ƒç”¨ä¸‹é¢çš„æ–¹æ³• 123456789101112131415161718192021222324public void add(long x) &#123; // as ä¸ºç´¯åŠ å•å…ƒæ•°ç»„ // b ä¸ºåŸºç¡€å€¼ // x ä¸ºç´¯åŠ å€¼ Cell[] as; long b, v; int m; Cell a; // è¿›å…¥ if çš„ä¸¤ä¸ªæ¡ä»¶ // 1. as æœ‰å€¼, è¡¨ç¤ºå·²ç»å‘ç”Ÿè¿‡ç«žäº‰, è¿›å…¥ if // 2. cas ç»™ base ç´¯åŠ æ—¶å¤±è´¥äº†, è¡¨ç¤º base å‘ç”Ÿäº†ç«žäº‰, è¿›å…¥ if if ((as = cells) != null || !casBase(b = base, b + x)) &#123; // uncontended è¡¨ç¤º cell æ²¡æœ‰ç«žäº‰ boolean uncontended = true; if ( // as è¿˜æ²¡æœ‰åˆ›å»º as == null || (m = as.length - 1) &lt; 0 || // å½“å‰çº¿ç¨‹å¯¹åº”çš„ cell è¿˜æ²¡æœ‰ (a = as[getProbe() &amp; m]) == null || // cas ç»™å½“å‰çº¿ç¨‹çš„ cell ç´¯åŠ å¤±è´¥ uncontended=false ( a ä¸ºå½“å‰çº¿ç¨‹çš„ cell ) !(uncontended = a.cas(v = a.value, v + x)) ) &#123; // è¿›å…¥ cell æ•°ç»„åˆ›å»ºã€cell åˆ›å»ºçš„æµç¨‹ longAccumulate(x, null, uncontended); &#125; &#125;&#125; add æµç¨‹å›¾ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152final void longAccumulate(long x, LongBinaryOperator fn, boolean wasUncontended) &#123; int h; // å½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰å¯¹åº”çš„ cell, éœ€è¦éšæœºç”Ÿæˆä¸€ä¸ª h å€¼ç”¨æ¥å°†å½“å‰çº¿ç¨‹ç»‘å®šåˆ° cell if ((h = getProbe()) == 0) &#123; // åˆå§‹åŒ– probe ThreadLocalRandom.current(); // h å¯¹åº”æ–°çš„ probe å€¼, ç”¨æ¥å¯¹åº” cell h = getProbe(); wasUncontended = true; &#125; // collide ä¸º true è¡¨ç¤ºéœ€è¦æ‰©å®¹ boolean collide = false; for (;;) &#123; Cell[] as; Cell a; int n; long v; // å·²ç»æœ‰äº† cells if ((as = cells) != null &amp;&amp; (n = as.length) &gt; 0) &#123; // è¿˜æ²¡æœ‰ cell if ((a = as[(n - 1) &amp; h]) == null) &#123; // ä¸º cellsBusy åŠ é”, åˆ›å»º cell, cell çš„åˆå§‹ç´¯åŠ å€¼ä¸º x // æˆåŠŸåˆ™ break, å¦åˆ™ç»§ç»­ continue å¾ªçŽ¯ &#125; // æœ‰ç«žäº‰, æ”¹å˜çº¿ç¨‹å¯¹åº”çš„ cell æ¥é‡è¯• cas else if (!wasUncontended) wasUncontended = true; // cas å°è¯•ç´¯åŠ , fn é…åˆ LongAccumulator ä¸ä¸º null, é…åˆ LongAdder ä¸º null else if (a.cas(v = a.value, ((fn == null) ? v + x : fn.applyAsLong(v, x)))) break; // å¦‚æžœ cells é•¿åº¦å·²ç»è¶…è¿‡äº†æœ€å¤§é•¿åº¦, æˆ–è€…å·²ç»æ‰©å®¹, æ”¹å˜çº¿ç¨‹å¯¹åº”çš„ cell æ¥é‡è¯• cas else if (n &gt;= NCPU || cells != as) collide = false; // ç¡®ä¿ collide ä¸º false è¿›å…¥æ­¤åˆ†æ”¯, å°±ä¸ä¼šè¿›å…¥ä¸‹é¢çš„ else if è¿›è¡Œæ‰©å®¹äº† else if (!collide) collide = true; // åŠ é” else if (cellsBusy == 0 &amp;&amp; casCellsBusy()) &#123; // åŠ é”æˆåŠŸ, æ‰©å®¹ continue; &#125; // æ”¹å˜çº¿ç¨‹å¯¹åº”çš„ cell h = advanceProbe(h); &#125; // è¿˜æ²¡æœ‰ cells, å°è¯•ç»™ cellsBusy åŠ é” else if (cellsBusy == 0 &amp;&amp; cells == as &amp;&amp; casCellsBusy()) &#123; // åŠ é”æˆåŠŸ, åˆå§‹åŒ– cells, æœ€å¼€å§‹é•¿åº¦ä¸º 2, å¹¶å¡«å……ä¸€ä¸ª cell // æˆåŠŸåˆ™ break; &#125; // ä¸Šä¸¤ç§æƒ…å†µå¤±è´¥, å°è¯•ç»™ base ç´¯åŠ  else if (casBase(v = base, ((fn == null) ? v + x : fn.applyAsLong(v, x)))) break; &#125;&#125; longAccumulate æµç¨‹å›¾ æ¯ä¸ªçº¿ç¨‹åˆšè¿›å…¥ longAccumulate æ—¶ï¼Œä¼šå°è¯•å¯¹åº”ä¸€ä¸ª cell å¯¹è±¡ï¼ˆæ‰¾åˆ°ä¸€ä¸ªå‘ä½ï¼‰ èŽ·å–æœ€ç»ˆç»“æžœé€šè¿‡ sum æ–¹æ³• 1234567891011public long sum() &#123; Cell[] as = cells; Cell a; long sum = base; if (as != null) &#123; for (int i = 0; i &lt; as.length; ++i) &#123; if ((a = as[i]) != null) sum += a.value; &#125; &#125; return sum;&#125; 9. Unsafe9.1 æ¦‚è¿°Unsafe å¯¹è±¡æä¾›äº†éžå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æŽ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„èŽ·å¾— 123456789101112131415public class UnsafeAccessor &#123; static Unsafe unsafe; static &#123; try &#123; Field theUnsafe = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); theUnsafe.setAccessible(true); unsafe = (Unsafe) theUnsafe.get(null); &#125; catch (NoSuchFieldException | IllegalAccessException e) &#123; throw new Error(e); &#125; &#125; static Unsafe getUnsafe() &#123; return unsafe; &#125;&#125; 9.2 Unsafe CAS æ“ä½œ12345@Dataclass Student &#123; volatile int id; volatile String name;&#125; 1234567891011Unsafe unsafe = UnsafeAccessor.getUnsafe();Field id = Student.class.getDeclaredField(&quot;id&quot;);Field name = Student.class.getDeclaredField(&quot;name&quot;);// èŽ·å¾—æˆå‘˜å˜é‡çš„åç§»é‡long idOffset = UnsafeAccessor.unsafe.objectFieldOffset(id);long nameOffset = UnsafeAccessor.unsafe.objectFieldOffset(name);Student student = new Student();// ä½¿ç”¨ cas æ–¹æ³•æ›¿æ¢æˆå‘˜å˜é‡çš„å€¼UnsafeAccessor.unsafe.compareAndSwapInt(student, idOffset, 0, 20); // è¿”å›ž trueUnsafeAccessor.unsafe.compareAndSwapObject(student, nameOffset, null, &quot;å¼ ä¸‰&quot;); // è¿”å›ž trueSystem.out.println(student); è¾“å‡º 1Student(id=20, name=å¼ ä¸‰) ä½¿ç”¨è‡ªå®šä¹‰çš„ AtomicData å®žçŽ°ä¹‹å‰çº¿ç¨‹å®‰å…¨çš„åŽŸå­æ•´æ•° Account å®žçŽ° 12345678910111213141516171819202122232425262728293031class AtomicData &#123; private volatile int data; static final Unsafe unsafe; static final long DATA_OFFSET; static &#123; unsafe = UnsafeAccessor.getUnsafe(); try &#123; // data å±žæ€§åœ¨ DataContainer å¯¹è±¡ä¸­çš„åç§»é‡ï¼Œç”¨äºŽ Unsafe ç›´æŽ¥è®¿é—®è¯¥å±žæ€§ DATA_OFFSET = unsafe.objectFieldOffset(AtomicData.class.getDeclaredField(&quot;data&quot;)); &#125; catch (NoSuchFieldException e) &#123; throw new Error(e); &#125; &#125; public AtomicData(int data) &#123; this.data = data; &#125; public void decrease(int amount) &#123; int oldValue; while(true) &#123; // èŽ·å–å…±äº«å˜é‡æ—§å€¼ï¼Œå¯ä»¥åœ¨è¿™ä¸€è¡ŒåŠ å…¥æ–­ç‚¹ï¼Œä¿®æ”¹ data è°ƒè¯•æ¥åŠ æ·±ç†è§£ oldValue = data; // cas å°è¯•ä¿®æ”¹ data ä¸º æ—§å€¼ + amountï¼Œå¦‚æžœæœŸé—´æ—§å€¼è¢«åˆ«çš„çº¿ç¨‹æ”¹äº†ï¼Œè¿”å›ž false if (unsafe.compareAndSwapInt(this, DATA_OFFSET, oldValue, oldValue - amount)) &#123; return; &#125; &#125; &#125; public int getData() &#123; return data; &#125;&#125; Account å®žçŽ° 1234567891011Account.demo(new Account() &#123; AtomicData atomicData = new AtomicData(10000); @Override public Integer getBalance() &#123; return atomicData.getData(); &#125; @Override public void withdraw(Integer amount) &#123; atomicData.decrease(amount); &#125;&#125;); 10. æœ¬ç« å° ç»“ CAS ä¸Ž volatile API åŽŸå­æ•´æ•° åŽŸå­å¼•ç”¨ åŽŸå­æ•°ç»„ å­—æ®µæ›´æ–°å™¨ åŽŸå­ç´¯åŠ å™¨ Unsafe åŽŸç†æ–¹é¢ LongAdder æºç  ä¼ªå…±äº« äº”ã€å…±äº«æ¨¡åž‹ä¹‹ä¸å¯å˜1. æœ¬ç« å†…å®¹ ä¸å¯å˜ç±»çš„ä½¿ç”¨ ä¸å¯å˜ç±»è®¾è®¡ æ— çŠ¶æ€ç±»è®¾è®¡ 2. æ—¥æœŸè½¬æ¢çš„é—®é¢˜2.1 é—®é¢˜æå‡ºä¸‹é¢çš„ä»£ç åœ¨è¿è¡Œæ—¶ï¼Œç”±äºŽ SimpleDateFormat ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ 12345678910SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);for (int i = 0; i &lt; 10; i++) &#123; new Thread(() -&gt; &#123; try &#123; log.debug(&quot;&#123;&#125;&quot;, sdf.parse(&quot;1951-04-21&quot;)); &#125; catch (Exception e) &#123; log.error(&quot;&#123;&#125;&quot;, e); &#125; &#125;).start();&#125; æœ‰å¾ˆå¤§å‡ çŽ‡å‡ºçŽ° java.lang.NumberFormatException æˆ–è€…å‡ºçŽ°ä¸æ­£ç¡®çš„æ—¥æœŸè§£æžç»“æžœï¼Œä¾‹å¦‚ï¼š 123456789101112131415161718192021222324252627282930313219:10:40.859 [Thread-2] c.TestDateParse - &#123;&#125;java.lang.NumberFormatException: For input string: &quot;&quot; at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) at java.lang.Long.parseLong(Long.java:601) at java.lang.Long.parseLong(Long.java:631) at java.text.DigitList.getLong(DigitList.java:195) at java.text.DecimalFormat.parse(DecimalFormat.java:2084) at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:2162) at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1514) at java.text.DateFormat.parse(DateFormat.java:364) at cn.itcast.n7.TestDateParse.lambda$test1$0(TestDateParse.java:18) at java.lang.Thread.run(Thread.java:748)19:10:40.859 [Thread-1] c.TestDateParse - &#123;&#125;java.lang.NumberFormatException: empty String at sun.misc.FloatingDecimal.readJavaFormatString(FloatingDecimal.java:1842) at sun.misc.FloatingDecimal.parseDouble(FloatingDecimal.java:110) at java.lang.Double.parseDouble(Double.java:538) at java.text.DigitList.getDouble(DigitList.java:169) at java.text.DecimalFormat.parse(DecimalFormat.java:2089) at java.text.SimpleDateFormat.subParse(SimpleDateFormat.java:2162) at java.text.SimpleDateFormat.parse(SimpleDateFormat.java:1514) at java.text.DateFormat.parse(DateFormat.java:364) at cn.itcast.n7.TestDateParse.lambda$test1$0(TestDateParse.java:18) at java.lang.Thread.run(Thread.java:748)19:10:40.857 [Thread-8] c.TestDateParse - Sat Apr 21 00:00:00 CST 195119:10:40.857 [Thread-9] c.TestDateParse - Sat Apr 21 00:00:00 CST 195119:10:40.857 [Thread-6] c.TestDateParse - Sat Apr 21 00:00:00 CST 195119:10:40.857 [Thread-4] c.TestDateParse - Sat Apr 21 00:00:00 CST 195119:10:40.857 [Thread-5] c.TestDateParse - Mon Apr 21 00:00:00 CST 17896064519:10:40.857 [Thread-0] c.TestDateParse - Sat Apr 21 00:00:00 CST 195119:10:40.857 [Thread-7] c.TestDateParse - Sat Apr 21 00:00:00 CST 195119:10:40.857 [Thread-3] c.TestDateParse - Sat Apr 21 00:00:00 CST 1951 2.2 æ€è·¯ - åŒæ­¥é”è¿™æ ·è™½èƒ½è§£å†³é—®é¢˜ï¼Œä½†å¸¦æ¥çš„æ˜¯æ€§èƒ½ä¸Šçš„æŸå¤±ï¼Œå¹¶ä¸ç®—å¾ˆå¥½ï¼š 123456789101112SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd&quot;);for (int i = 0; i &lt; 50; i++) &#123; new Thread(() -&gt; &#123; synchronized (sdf) &#123; try &#123; log.debug(&quot;&#123;&#125;&quot;, sdf.parse(&quot;1951-04-21&quot;)); &#125; catch (Exception e) &#123; log.error(&quot;&#123;&#125;&quot;, e); &#125; &#125; &#125;).start();&#125; 2.3 æ€è·¯ - ä¸å¯å˜å¦‚æžœä¸€ä¸ªå¯¹è±¡åœ¨ä¸èƒ½å¤Ÿä¿®æ”¹å…¶å†…éƒ¨çŠ¶æ€ï¼ˆå±žæ€§ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸å­˜åœ¨å¹¶å‘ä¿®æ”¹å•Šï¼è¿™æ ·çš„å¯¹è±¡åœ¨Java ä¸­æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚åœ¨ Java 8 åŽï¼Œæä¾›äº†ä¸€ä¸ªæ–°çš„æ—¥æœŸæ ¼å¼åŒ–ç±» 1234567DateTimeFormatter dtf = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd&quot;);for (int i = 0; i &lt; 10; i++) &#123; new Thread(() -&gt; &#123; LocalDate date = dtf.parse(&quot;2018-10-01&quot;, LocalDate::from); log.debug(&quot;&#123;&#125;&quot;, date); &#125;).start();&#125; å¯ä»¥çœ‹ DateTimeFormatter çš„æ–‡æ¡£ï¼š 12@implSpecThis class is immutable and thread-safe. ä¸å¯å˜å¯¹è±¡ï¼Œå®žé™…æ˜¯å¦ä¸€ç§é¿å…ç«žäº‰çš„æ–¹å¼ã€‚ 3. ä¸å¯å˜è®¾è®¡å¦ä¸€ä¸ªå¤§å®¶æ›´ä¸ºç†Ÿæ‚‰çš„ String ç±»ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œä»¥å®ƒä¸ºä¾‹ï¼Œè¯´æ˜Žä¸€ä¸‹ä¸å¯å˜è®¾è®¡çš„è¦ç´  12345678public final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence &#123; /** The value is used for character storage. */ private final char value[]; /** Cache the hash code for the string */ private int hash; // Default to 0 // ...&#125; 3.1 final çš„ä½¿ç”¨å‘çŽ°è¯¥ç±»ã€ç±»ä¸­æ‰€æœ‰å±žæ€§éƒ½æ˜¯ final çš„ å±žæ€§ç”¨ final ä¿®é¥°ä¿è¯äº†è¯¥å±žæ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹ ç±»ç”¨ final ä¿®é¥°ä¿è¯äº†è¯¥ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œé˜²æ­¢å­ç±»æ— æ„é—´ç ´åä¸å¯å˜æ€§ 3.2 ä¿æŠ¤æ€§æ‹·è´ä½†æœ‰åŒå­¦ä¼šè¯´ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›è·Ÿä¿®æ”¹ç›¸å…³çš„æ–¹æ³•å•Šï¼Œæ¯”å¦‚ substring ç­‰ï¼Œé‚£ä¹ˆä¸‹é¢å°±çœ‹ä¸€çœ‹è¿™äº›æ–¹æ³•æ˜¯å¦‚ä½•å®žçŽ°çš„ï¼Œå°±ä»¥ substring ä¸ºä¾‹ï¼š 12345678910public String substring(int beginIndex) &#123; if (beginIndex &lt; 0) &#123; throw new StringIndexOutOfBoundsException(beginIndex); &#125; int subLen = value.length - beginIndex; if (subLen &lt; 0) &#123; throw new StringIndexOutOfBoundsException(subLen); &#125; return (beginIndex == 0) ? this : new String(value, beginIndex, subLen);&#125; å‘çŽ°å…¶å†…éƒ¨æ˜¯è°ƒç”¨ String çš„æž„é€ æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œå†è¿›å…¥è¿™ä¸ªæž„é€ çœ‹çœ‹ï¼Œæ˜¯å¦å¯¹ final char[] value åšäº†ä¿®æ”¹ï¼š 123456789101112131415161718public String(char value[], int offset, int count) &#123; if (offset &lt; 0) &#123; throw new StringIndexOutOfBoundsException(offset); &#125; if (count &lt;= 0) &#123; if (count &lt; 0) &#123; throw new StringIndexOutOfBoundsException(count); &#125; if (offset &lt;= value.length) &#123; this.value = &quot;&quot;.value; return; &#125; &#125; if (offset &gt; value.length - count) &#123; throw new StringIndexOutOfBoundsException(offset + count); &#125; this.value = Arrays.copyOfRange(value, offset, offset+count);&#125; ç»“æžœå‘çŽ°ä¹Ÿæ²¡æœ‰ï¼Œæž„é€ æ–°å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ char[] valueï¼Œå¯¹å†…å®¹è¿›è¡Œå¤åˆ¶ ã€‚è¿™ç§é€šè¿‡åˆ›å»ºå‰¯æœ¬å¯¹è±¡æ¥é¿å…å…±äº«çš„æ‰‹æ®µç§°ä¹‹ä¸ºã€ä¿æŠ¤æ€§æ‹·è´ï¼ˆdefensive copyï¼‰ã€‘ 3.3 æ¨¡å¼ä¹‹äº«å…ƒç®€ä»‹å®šä¹‰ è‹±æ–‡åç§°ï¼šFlyweight pattern. å½“éœ€è¦é‡ç”¨æ•°é‡æœ‰é™çš„åŒä¸€ç±»å¯¹è±¡æ—¶ wikipediaï¼š A flyweight is an object that minimizes memory usage by sharing as much data as possible with other similar objects å‡ºè‡ª â€œGang of Fourâ€ design patternså½’ç±» Structual patterns ä½“çŽ°åŒ…è£…ç±»åœ¨JDKä¸­ Booleanï¼ŒByteï¼ŒShortï¼ŒIntegerï¼ŒLongï¼ŒCharacter ç­‰åŒ…è£…ç±»æä¾›äº† valueOf æ–¹æ³•ï¼Œä¾‹å¦‚ Long çš„ valueOf ä¼šç¼“å­˜ -128~127 ä¹‹é—´çš„ Long å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹é—´ä¼šé‡ç”¨å¯¹è±¡ï¼Œå¤§äºŽè¿™ä¸ªèŒƒå›´ï¼Œæ‰ä¼šæ–°å»º Long å¯¹è±¡ï¼š 1234567public static Long valueOf(long l) &#123; final int offset = 128; if (l &gt;= -128 &amp;&amp; l &lt;= 127) &#123; // will cache return LongCache.cache[(int)l + offset]; &#125; return new Long(l);&#125; æ³¨æ„ï¼š Byte, Short, Long ç¼“å­˜çš„èŒƒå›´éƒ½æ˜¯ -128~127 Character ç¼“å­˜çš„èŒƒå›´æ˜¯ 0~127 Integerçš„é»˜è®¤èŒƒå›´æ˜¯ -128~127 æœ€å°å€¼ä¸èƒ½å˜ ä½†æœ€å¤§å€¼å¯ä»¥é€šè¿‡è°ƒæ•´è™šæ‹Ÿæœºå‚æ•° -Djava.lang.Integer.IntegerCache.high æ¥æ”¹å˜ Boolean ç¼“å­˜äº† TRUE å’Œ FALSE String æ± BigDecimal BigIntegerDIYä¾‹å¦‚ï¼šä¸€ä¸ªçº¿ä¸Šå•†åŸŽåº”ç”¨ï¼ŒQPS è¾¾åˆ°æ•°åƒï¼Œå¦‚æžœæ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºå’Œå…³é—­æ•°æ®åº“è¿žæŽ¥ï¼Œæ€§èƒ½ä¼šå—åˆ°æžå¤§å½±å“ã€‚ è¿™æ—¶é¢„å…ˆåˆ›å»ºå¥½ä¸€æ‰¹è¿žæŽ¥ï¼Œæ”¾å…¥è¿žæŽ¥æ± ã€‚ä¸€æ¬¡è¯·æ±‚åˆ°è¾¾åŽï¼Œä»Žè¿žæŽ¥æ± èŽ·å–è¿žæŽ¥ï¼Œä½¿ç”¨å®Œæ¯•åŽå†è¿˜å›žè¿žæŽ¥æ± ï¼Œè¿™æ ·æ—¢èŠ‚çº¦äº†è¿žæŽ¥çš„åˆ›å»ºå’Œå…³é—­æ—¶é—´ï¼Œä¹Ÿå®žçŽ°äº†è¿žæŽ¥çš„é‡ç”¨ï¼Œä¸è‡³äºŽè®©åºžå¤§çš„è¿žæŽ¥æ•°åŽ‹åž®æ•°æ®åº“ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556class Pool &#123; // 1. è¿žæŽ¥æ± å¤§å° private final int poolSize; // 2. è¿žæŽ¥å¯¹è±¡æ•°ç»„ private Connection[] connections; // 3. è¿žæŽ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™ private AtomicIntegerArray states; // 4. æž„é€ æ–¹æ³•åˆå§‹åŒ– public Pool(int poolSize) &#123; this.poolSize = poolSize; this.connections = new Connection[poolSize]; this.states = new AtomicIntegerArray(new int[poolSize]); for (int i = 0; i &lt; poolSize; i++) &#123; connections[i] = new MockConnection(&quot;è¿žæŽ¥&quot; + (i+1)); &#125; &#125; // 5. å€Ÿè¿žæŽ¥ public Connection borrow() &#123; while(true) &#123; for (int i = 0; i &lt; poolSize; i++) &#123; // èŽ·å–ç©ºé—²è¿žæŽ¥ if(states.get(i) == 0) &#123; if (states.compareAndSet(i, 0, 1)) &#123; log.debug(&quot;borrow &#123;&#125;&quot;, connections[i]); return connections[i]; &#125; &#125; &#125; // å¦‚æžœæ²¡æœ‰ç©ºé—²è¿žæŽ¥ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾… synchronized (this) &#123; try &#123; log.debug(&quot;wait...&quot;); this.wait(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; // 6. å½’è¿˜è¿žæŽ¥ public void free(Connection conn) &#123; for (int i = 0; i &lt; poolSize; i++) &#123; if (connections[i] == conn) &#123; states.set(i, 0); synchronized (this) &#123; log.debug(&quot;free &#123;&#125;&quot;, conn); this.notifyAll(); &#125; break; &#125; &#125; &#125;&#125;class MockConnection implements Connection &#123; // å®žçŽ°ç•¥&#125; ä½¿ç”¨è¿žæŽ¥æ± ï¼š 123456789101112Pool pool = new Pool(2);for (int i = 0; i &lt; 5; i++) &#123; new Thread(() -&gt; &#123; Connection conn = pool.borrow(); try &#123; Thread.sleep(new Random().nextInt(1000)); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; pool.free(conn); &#125;).start();&#125; ä»¥ä¸Šå®žçŽ°æ²¡æœ‰è€ƒè™‘ï¼š è¿žæŽ¥çš„åŠ¨æ€å¢žé•¿ä¸Žæ”¶ç¼© è¿žæŽ¥ä¿æ´»ï¼ˆå¯ç”¨æ€§æ£€æµ‹ï¼‰ ç­‰å¾…è¶…æ—¶å¤„ç† åˆ†å¸ƒå¼ hash å¯¹äºŽå…³ç³»åž‹æ•°æ®åº“ï¼Œæœ‰æ¯”è¾ƒæˆç†Ÿçš„è¿žæŽ¥æ± å®žçŽ°ï¼Œä¾‹å¦‚c3p0, druidç­‰ å¯¹äºŽæ›´é€šç”¨çš„å¯¹è±¡æ± ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨apachecommons poolï¼Œä¾‹å¦‚redisè¿žæŽ¥æ± å¯ä»¥å‚è€ƒjedisä¸­å…³äºŽè¿žæŽ¥æ± çš„å®žçŽ° 3.4 åŽŸç†ä¹‹ finalè®¾ç½® final å˜é‡çš„åŽŸç†ç†è§£äº† volatile åŽŸç†ï¼Œå†å¯¹æ¯” final çš„å®žçŽ°å°±æ¯”è¾ƒç®€å•äº† 123public class TestFinal &#123; final int a = 20;&#125; å­—èŠ‚ç  123456780: aload_01: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V4: aload_05: bipush 207: putfield #2 // Field a:I&lt;-- å†™å±éšœ10: return å‘çŽ° final å˜é‡çš„èµ‹å€¼ä¹Ÿä¼šé€šè¿‡ putfield æŒ‡ä»¤æ¥å®Œæˆï¼ŒåŒæ ·åœ¨è¿™æ¡æŒ‡ä»¤ä¹‹åŽä¹Ÿä¼šåŠ å…¥å†™å±éšœï¼Œä¿è¯åœ¨å…¶å®ƒçº¿ç¨‹è¯»åˆ°å®ƒçš„å€¼æ—¶ä¸ä¼šå‡ºçŽ°ä¸º 0 çš„æƒ…å†µ èŽ·å–final å˜é‡çš„åŽŸç†123456789101112131415161718192021222324252627282930313233public class TestFinal &#123; static int A = 10; static int B = Short.MAX_VALUE+1; final int a = 20; final int b = Integer.MAX_VALUE; final void test1() &#123; final int c = 30; new Thread(()-&gt;&#123; System.out.println(c); &#125;).start(); final int d = 30; class Task implements Runnable &#123; @Override public void run() &#123; System.out.println(d); &#125; &#125; new Thread(new Task()).start(); &#125;&#125;class UseFinal1 &#123; public void test() &#123; System.out.println(TestFinal.A); System.out.println(TestFinal.B); System.out.println(new TestFinal().a); System.out.println(new TestFinal().b); new TestFinal().test1(); &#125;&#125; å¯¹UseFinal1ç±»åç¼–è¯‘åŽ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162class cn/itcast/n5/UseFinal1 &#123; // compiled from: TestFinal.java // access flags 0x0 &lt;init&gt;()V L0 LINENUMBER 29 L0 ALOAD 0 INVOKESPECIAL java/lang/Object.&lt;init&gt; ()V RETURN L1 LOCALVARIABLE this Lcn/itcast/n5/UseFinal1; L0 L1 0 MAXSTACK = 1 MAXLOCALS = 1 // access flags 0x1 public test()V L0 LINENUMBER 31 L0 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; GETSTATIC cn/itcast/n5/TestFinal.A : I // 1 å¤„ è¿™é‡Œï¼Œç›´æŽ¥æ‹¿ é™æ€å˜é‡ INVOKEVIRTUAL java/io/PrintStream.println (I)V L1 LINENUMBER 32 L1 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; GETSTATIC cn/itcast/n5/TestFinal.B : I // 2 å¤„ è¿™é‡Œ INVOKEVIRTUAL java/io/PrintStream.println (I)V L2 LINENUMBER 33 L2 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; NEW cn/itcast/n5/TestFinal DUP INVOKESPECIAL cn/itcast/n5/TestFinal.&lt;init&gt; ()V INVOKEVIRTUAL java/lang/Object.getClass ()Ljava/lang/Class; POP BIPUSH 20 // 1 å¤„ è¿™é‡Œï¼ŒåŠ äº† final,bipush æ˜¯ æŠŠ20 æ”¾åˆ° è¿™ä¸ªæ–¹æ³• test() çš„æ ˆä¸­ï¼Œç›¸å½“äºŽå¤åˆ¶ä¸€ä»½ INVOKEVIRTUAL java/io/PrintStream.println (I)V L3 LINENUMBER 34 L3 GETSTATIC java/lang/System.out : Ljava/io/PrintStream; NEW cn/itcast/n5/TestFinal DUP INVOKESPECIAL cn/itcast/n5/TestFinal.&lt;init&gt; ()V INVOKEVIRTUAL java/lang/Object.getClass ()Ljava/lang/Class; POP LDC 2147483647 // 2 å¤„ è¿™é‡Œï¼Œæ˜¯å°† Integer.MAX_VALUE æ”¾åˆ°è¿è¡Œå¸¸é‡æ±  é‡Œ INVOKEVIRTUAL java/io/PrintStream.println (I)V L4 LINENUMBER 35 L4 NEW cn/itcast/n5/TestFinal DUP INVOKESPECIAL cn/itcast/n5/TestFinal.&lt;init&gt; ()V INVOKEVIRTUAL cn/itcast/n5/TestFinal.test1 ()V L5 LINENUMBER 36 L5 RETURN L6 LOCALVARIABLE this Lcn/itcast/n5/UseFinal1; L0 L6 0 MAXSTACK = 3 MAXLOCALS = 1&#125; æ€»ç»“ï¼š jdk1.8åŽï¼Œä¸åŠ finalä¿®é¥°çš„ç±»æˆå‘˜å˜é‡æˆ–éžé™æ€æˆå‘˜å˜é‡ï¼Œç±»å˜é‡æ˜¯é€šè¿‡getstatic åˆ°è¯¥ç±» æ ˆèŽ·å–ï¼Œæ™®é€šå˜é‡æ˜¯é€šè¿‡ getfieldåˆ°æ ˆèŽ·å– åŠ  final åŽï¼Œç±»å˜é‡æˆ–è€…æ™®é€šå˜é‡ -128~127 æ•°å€¼ä½¿ç”¨ bipush æ“ä½œï¼Œä¿®é¥°çš„å˜é‡åŽ‹å…¥åˆ°æ–¹æ³•æ ˆä¸­ï¼Œç›¸å½“äºŽå¤åˆ¶äº†ä¸€ä»½ä½œä¸ºå…±äº«å˜é‡ ä¾› æ–¹æ³• test() ä½¿ç”¨ -2147483648~2147483647 æ•°å€¼ ä½¿ç”¨ ldc æ“ä½œï¼Œä¿®é¥°çš„å˜é‡å­˜æ”¾åˆ°äº†å¸¸é‡æ± ä¸­ï¼Œå…±äº«å˜é‡ä»Žå¸¸é‡æ± èŽ·å– 4. æ— çŠ¶æ€åœ¨ web é˜¶æ®µå­¦ä¹ æ—¶ï¼Œè®¾è®¡ Servlet æ—¶ä¸ºäº†ä¿è¯å…¶çº¿ç¨‹å®‰å…¨ï¼Œéƒ½ä¼šæœ‰è¿™æ ·çš„å»ºè®®ï¼Œä¸è¦ä¸º Servlet è®¾ç½®æˆå‘˜å˜é‡ï¼Œè¿™ç§æ²¡æœ‰ä»»ä½•æˆå‘˜å˜é‡çš„ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ å› ä¸ºæˆå‘˜å˜é‡ä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä»¥ç§°ä¸ºçŠ¶æ€ä¿¡æ¯ï¼Œå› æ­¤æ²¡æœ‰æˆå‘˜å˜é‡å°±ç§°ä¹‹ä¸ºã€æ— çŠ¶æ€ã€‘ 5. æœ¬ç« å°ç»“ ä¸å¯å˜ç±»ä½¿ç”¨ ä¸å¯å˜ç±»è®¾è®¡ * åŽŸç†æ–¹é¢ final æ¨¡å¼æ–¹é¢ äº«å…ƒ å…­ã€å…±äº«æ¨¡åž‹ä¹‹å·¥å…·1. çº¿ç¨‹æ± 1.1 è‡ªå®šä¹‰çº¿ç¨‹æ±  æ­¥éª¤1ï¼šè‡ªå®šä¹‰æ‹’ç»ç­–ç•¥æŽ¥å£ 1234@FunctionalInterface // æ‹’ç»ç­–ç•¥interface RejectPolicy&lt;T&gt; &#123; void reject(BlockingQueue&lt;T&gt; queue, T task);&#125; æ­¥éª¤2ï¼šè‡ªå®šä¹‰ä»»åŠ¡é˜Ÿåˆ— 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123class BlockingQueue&lt;T&gt; &#123; // 1. ä»»åŠ¡é˜Ÿåˆ— private Deque&lt;T&gt; queue = new ArrayDeque&lt;&gt;(); // 2. é” private ReentrantLock lock = new ReentrantLock(); // 3. ç”Ÿäº§è€…æ¡ä»¶å˜é‡ private Condition fullWaitSet = lock.newCondition(); // 4. æ¶ˆè´¹è€…æ¡ä»¶å˜é‡ private Condition emptyWaitSet = lock.newCondition(); // 5. å®¹é‡ private int capcity; public BlockingQueue(int capcity) &#123; this.capcity = capcity; &#125; // å¸¦è¶…æ—¶é˜»å¡žèŽ·å– public T poll(long timeout, TimeUnit unit) &#123; lock.lock(); try &#123; // å°† timeout ç»Ÿä¸€è½¬æ¢ä¸º çº³ç§’ long nanos = unit.toNanos(timeout); while (queue.isEmpty()) &#123; try &#123; // è¿”å›žå€¼æ˜¯å‰©ä½™æ—¶é—´ if (nanos &lt;= 0) &#123; return null; &#125; nanos = emptyWaitSet.awaitNanos(nanos); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; T t = queue.removeFirst(); fullWaitSet.signal(); return t; &#125; finally &#123; lock.unlock(); &#125; &#125; // é˜»å¡žèŽ·å– public T take() &#123; lock.lock(); try &#123; while (queue.isEmpty()) &#123; try &#123; emptyWaitSet.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; T t = queue.removeFirst(); fullWaitSet.signal(); return t; &#125; finally &#123; lock.unlock(); &#125; &#125; // é˜»å¡žæ·»åŠ  public void put(T task) &#123; lock.lock(); try &#123; while (queue.size() == capcity) &#123; try &#123; log.debug(&quot;ç­‰å¾…åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— &#123;&#125; ...&quot;, task); fullWaitSet.await(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— &#123;&#125;&quot;, task); queue.addLast(task); emptyWaitSet.signal(); &#125; finally &#123; lock.unlock(); &#125; &#125; // å¸¦è¶…æ—¶æ—¶é—´é˜»å¡žæ·»åŠ  public boolean offer(T task, long timeout, TimeUnit timeUnit) &#123; lock.lock(); try &#123; long nanos = timeUnit.toNanos(timeout); while (queue.size() == capcity) &#123; try &#123; if(nanos &lt;= 0) &#123; return false; &#125; log.debug(&quot;ç­‰å¾…åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— &#123;&#125; ...&quot;, task); nanos = fullWaitSet.awaitNanos(nanos); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; log.debug(&quot;åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— &#123;&#125;&quot;, task); queue.addLast(task); emptyWaitSet.signal(); return true; &#125; finally &#123; lock.unlock(); &#125; &#125; public int size() &#123; lock.lock(); try &#123; return queue.size(); &#125; finally &#123; lock.unlock(); &#125; &#125; public void tryPut(RejectPolicy&lt;T&gt; rejectPolicy, T task) &#123; lock.lock(); try &#123; // åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡ if(queue.size() == capcity) &#123; rejectPolicy.reject(this, task); &#125; else &#123; // æœ‰ç©ºé—² log.debug(&quot;åŠ å…¥ä»»åŠ¡é˜Ÿåˆ— &#123;&#125;&quot;, task); queue.addLast(task); emptyWaitSet.signal(); &#125; &#125; finally &#123; lock.unlock(); &#125; &#125;&#125; æ­¥éª¤3ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ±  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869class ThreadPool &#123; // ä»»åŠ¡é˜Ÿåˆ— private BlockingQueue&lt;Runnable&gt; taskQueue; // çº¿ç¨‹é›†åˆ private HashSet&lt;Worker&gt; workers = new HashSet&lt;&gt;(); // æ ¸å¿ƒçº¿ç¨‹æ•° private int coreSize; // èŽ·å–ä»»åŠ¡æ—¶çš„è¶…æ—¶æ—¶é—´ private long timeout; private TimeUnit timeUnit; private RejectPolicy&lt;Runnable&gt; rejectPolicy; // æ‰§è¡Œä»»åŠ¡ public void execute(Runnable task) &#123; // å½“ä»»åŠ¡æ•°æ²¡æœ‰è¶…è¿‡ coreSize æ—¶ï¼Œç›´æŽ¥äº¤ç»™ worker å¯¹è±¡æ‰§è¡Œ // å¦‚æžœä»»åŠ¡æ•°è¶…è¿‡ coreSize æ—¶ï¼ŒåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—æš‚å­˜ synchronized (workers) &#123; if(workers.size() &lt; coreSize) &#123; Worker worker = new Worker(task); log.debug(&quot;æ–°å¢ž worker&#123;&#125;, &#123;&#125;&quot;, worker, task); workers.add(worker); worker.start(); &#125; else &#123; // taskQueue.put(task); // 1) æ­»ç­‰ // 2) å¸¦è¶…æ—¶ç­‰å¾… // 3) è®©è°ƒç”¨è€…æ”¾å¼ƒä»»åŠ¡æ‰§è¡Œ // 4) è®©è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸ // 5) è®©è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡ taskQueue.tryPut(rejectPolicy, task); &#125; &#125; &#125; public ThreadPool(int coreSize, long timeout, TimeUnit timeUnit, int queueCapcity, RejectPolicy&lt;Runnable&gt; rejectPolicy) &#123; this.coreSize = coreSize; this.timeout = timeout; this.timeUnit = timeUnit; this.taskQueue = new BlockingQueue&lt;&gt;(queueCapcity); this.rejectPolicy = rejectPolicy; &#125; class Worker extends Thread&#123; private Runnable task; public Worker(Runnable task) &#123; this.task = task; &#125; @Override public void run() &#123; // æ‰§è¡Œä»»åŠ¡ // 1) å½“ task ä¸ä¸ºç©ºï¼Œæ‰§è¡Œä»»åŠ¡ // 2) å½“ task æ‰§è¡Œå®Œæ¯•ï¼Œå†æŽ¥ç€ä»Žä»»åŠ¡é˜Ÿåˆ—èŽ·å–ä»»åŠ¡å¹¶æ‰§è¡Œ // while(task != null || (task = taskQueue.take()) != null) &#123; while(task != null || (task = taskQueue.poll(timeout, timeUnit)) != null) &#123; try &#123; log.debug(&quot;æ­£åœ¨æ‰§è¡Œ...&#123;&#125;&quot;, task); // taskçš„run æ–¹æ³•è·Ÿ work çš„run æ˜¯ä¸åŒçš„ï¼Œtaskçš„run åœ¨å¤–éƒ¨ é‡å†™äº† task.run(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; task = null; &#125; &#125; synchronized (workers) &#123; log.debug(&quot;worker è¢«ç§»é™¤&#123;&#125;&quot;, this); workers.remove(this); &#125; &#125; &#125;&#125; æ­¥éª¤4ï¼šæµ‹è¯• 1234567891011121314151617181920212223242526public static void main(String[] args) &#123; ThreadPool threadPool = new ThreadPool(1, 1000, TimeUnit.MILLISECONDS, 1, (queue, task)-&gt;&#123; // 1. æ­»ç­‰ // queue.put(task); // 2) å¸¦è¶…æ—¶ç­‰å¾… // queue.offer(task, 1500, TimeUnit.MILLISECONDS); // 3) è®©è°ƒç”¨è€…æ”¾å¼ƒä»»åŠ¡æ‰§è¡Œ // log.debug(&quot;æ”¾å¼ƒ&#123;&#125;&quot;, task); // 4) è®©è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸ // throw new RuntimeException(&quot;ä»»åŠ¡æ‰§è¡Œå¤±è´¥ &quot; + task); // 5) è®©è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡ task.run(); &#125;); for (int i = 0; i &lt; 4; i++) &#123; int j = i; threadPool.execute(() -&gt; &#123; try &#123; Thread.sleep(1000L); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; log.debug(&quot;&#123;&#125;&quot;, j); &#125;); &#125;&#125; 1.2 ThreadPoolExecutor (1) çº¿ç¨‹æ± çŠ¶æ€ThreadPoolExecutor ä½¿ç”¨ int çš„é«˜ 3 ä½æ¥è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œä½Ž 29 ä½è¡¨ç¤ºçº¿ç¨‹æ•°é‡ çŠ¶æ€å é«˜ 3 ä½ æŽ¥æ”¶æ–°ä»» åŠ¡ å¤„ç†é˜»å¡žé˜Ÿåˆ—ä»» åŠ¡ è¯´æ˜Ž RUNNING 111 Y Y SHUTDOWN 000 N Y ä¸ä¼šæŽ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡žé˜Ÿåˆ—å‰©ä½™ ä»»åŠ¡ STOP 001 N N ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶æŠ›å¼ƒé˜»å¡žé˜Ÿåˆ— ä»»åŠ¡ TIDYING 010 - - ä»»åŠ¡å…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º 0 å³å°†è¿›å…¥ ç»ˆç»“ TERMINATED 011 - - ç»ˆç»“çŠ¶æ€ ä»Žæ•°å­—ä¸Šæ¯”è¾ƒï¼ŒTERMINATED &gt; TIDYING &gt; STOP &gt; SHUTDOWN &gt; RUNNING è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåŽŸå­å˜é‡ ctl ä¸­ï¼Œç›®çš„æ˜¯å°†çº¿ç¨‹æ± çŠ¶æ€ä¸Žçº¿ç¨‹ä¸ªæ•°åˆäºŒä¸ºä¸€ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ä¸€æ¬¡ cas åŽŸå­æ“ä½œè¿›è¡Œèµ‹å€¼ 1234// c ä¸ºæ—§å€¼ï¼Œ ctlOf è¿”å›žç»“æžœä¸ºæ–°å€¼ctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c))));// rs ä¸ºé«˜ 3 ä½ä»£è¡¨çº¿ç¨‹æ± çŠ¶æ€ï¼Œ wc ä¸ºä½Ž 29 ä½ä»£è¡¨çº¿ç¨‹ä¸ªæ•°ï¼Œctl æ˜¯åˆå¹¶å®ƒä»¬private static int ctlOf(int rs, int wc) &#123; return rs | wc; &#125; (2) æž„é€ æ–¹æ³•1234567public ThreadPoolExecutor(int corePoolSize, int maximumPoolSize, long keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue, ThreadFactory threadFactory, RejectedExecutionHandler handler) corePoolSize æ ¸å¿ƒçº¿ç¨‹æ•°ç›® (æœ€å¤šä¿ç•™çš„çº¿ç¨‹æ•°) maximumPoolSize æœ€å¤§çº¿ç¨‹æ•°ç›® keepAliveTime ç”Ÿå­˜æ—¶é—´ - é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹ unit æ—¶é—´å•ä½ - é’ˆå¯¹æ•‘æ€¥çº¿ç¨‹ workQueue é˜»å¡žé˜Ÿåˆ— threadFactory çº¿ç¨‹å·¥åŽ‚ - å¯ä»¥ä¸ºçº¿ç¨‹åˆ›å»ºæ—¶èµ·ä¸ªå¥½åå­— handler æ‹’ç»ç­–ç•¥ å·¥ä½œæ–¹å¼ï¼š 123456789101112131415161718192021graph LRsubgraph é˜»å¡žé˜Ÿåˆ—size=2t3(ä»»åŠ¡3)t4(ä»»åŠ¡4)endsubgraph çº¿ç¨‹æ± c=2,m=3ct1(æ ¸å¿ƒçº¿ç¨‹1)ct2(æ ¸å¿ƒçº¿ç¨‹2)mt1(æ•‘æ€¥çº¿ç¨‹)ct1 --&gt; t1(ä»»åŠ¡1)ct2 --&gt; t2(ä»»åŠ¡2)endstyle ct1 fill:#ccf,stroke:#f66,stroke-width:2pxstyle ct2 fill:#ccf,stroke:#f66,stroke-width:2pxstyle mt1 fill:#ccf,stroke:#f66,stroke-width:2px,stroke-dasharray: 5.5 çº¿ç¨‹æ± ä¸­åˆšå¼€å§‹æ²¡æœ‰çº¿ç¨‹ï¼Œå½“ä¸€ä¸ªä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± åŽï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ å½“çº¿ç¨‹æ•°è¾¾åˆ° corePoolSize å¹¶æ²¡æœ‰çº¿ç¨‹ç©ºé—²ï¼Œè¿™æ—¶å†åŠ å…¥ä»»åŠ¡ï¼Œæ–°åŠ çš„ä»»åŠ¡ä¼šè¢«åŠ å…¥workQueue é˜Ÿåˆ—æŽ’é˜Ÿï¼Œç›´åˆ°æœ‰ç©ºé—²çš„çº¿ç¨‹ã€‚ å¦‚æžœé˜Ÿåˆ—é€‰æ‹©äº†æœ‰ç•Œé˜Ÿåˆ—ï¼Œé‚£ä¹ˆä»»åŠ¡è¶…è¿‡äº†é˜Ÿåˆ—å¤§å°æ—¶ï¼Œä¼šåˆ›å»º maximumPoolSize - corePoolSize æ•°ç›®çš„çº¿ç¨‹æ¥æ•‘æ€¥ã€‚ å¦‚æžœçº¿ç¨‹åˆ°è¾¾ maximumPoolSize ä»ç„¶æœ‰æ–°ä»»åŠ¡è¿™æ—¶ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚æ‹’ç»ç­–ç•¥ jdk æä¾›äº† 4 ç§å®žçŽ°ï¼Œå…¶å®ƒè‘—åæ¡†æž¶ä¹Ÿæä¾›äº†å®žçŽ° AbortPolicy è®©è°ƒç”¨è€…æŠ›å‡º RejectedExecutionException å¼‚å¸¸ï¼Œè¿™æ˜¯é»˜è®¤ç­–ç•¥ CallerRunsPolicy è®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡ DiscardPolicy æ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡ DiscardOldestPolicy æ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£ä¹‹ Dubbo çš„å®žçŽ°ï¼Œåœ¨æŠ›å‡º RejectedExecutionException å¼‚å¸¸ä¹‹å‰ä¼šè®°å½•æ—¥å¿—ï¼Œå¹¶ dump çº¿ç¨‹æ ˆä¿¡æ¯ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ Netty çš„å®žçŽ°ï¼Œæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ ActiveMQ çš„å®žçŽ°ï¼Œå¸¦è¶…æ—¶ç­‰å¾…ï¼ˆ60sï¼‰å°è¯•æ”¾å…¥é˜Ÿåˆ—ï¼Œç±»ä¼¼æˆ‘ä»¬ä¹‹å‰è‡ªå®šä¹‰çš„æ‹’ç»ç­–ç•¥ PinPoint çš„å®žçŽ°ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªæ‹’ç»ç­–ç•¥é“¾ï¼Œä¼šé€ä¸€å°è¯•ç­–ç•¥é“¾ä¸­æ¯ç§æ‹’ç»ç­–ç•¥ å½“é«˜å³°è¿‡åŽ»åŽï¼Œè¶…è¿‡corePoolSize çš„æ•‘æ€¥çº¿ç¨‹å¦‚æžœä¸€æ®µæ—¶é—´æ²¡æœ‰ä»»åŠ¡åšï¼Œéœ€è¦ç»“æŸèŠ‚çœèµ„æºï¼Œè¿™ä¸ªæ—¶é—´ç”± keepAliveTime å’Œ unit æ¥æŽ§åˆ¶ã€‚ æ ¹æ®è¿™ä¸ªæž„é€ æ–¹æ³•ï¼ŒJDK Executors ç±»ä¸­æä¾›äº†ä¼—å¤šå·¥åŽ‚æ–¹æ³•æ¥åˆ›å»ºå„ç§ç”¨é€”çš„çº¿ç¨‹æ±  (3) newFixedThreadPool12345public static ExecutorService newFixedThreadPool(int nThreads) &#123; return new ThreadPoolExecutor(nThreads, nThreads, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;());&#125; ç‰¹ç‚¹ æ ¸å¿ƒçº¿ç¨‹æ•° == æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ²¡æœ‰æ•‘æ€¥çº¿ç¨‹è¢«åˆ›å»ºï¼‰ï¼Œå› æ­¤ä¹Ÿæ— éœ€è¶…æ—¶æ—¶é—´ é˜»å¡žé˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡ è¯„ä»· é€‚ç”¨äºŽä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡ (4) newCachedThreadPool12345public static ExecutorService newCachedThreadPool() &#123; return new ThreadPoolExecutor(0, Integer.MAX_VALUE, 60L, TimeUnit.SECONDS, new SynchronousQueue&lt;Runnable&gt;());&#125; ç‰¹ç‚¹ æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯ 0ï¼Œ æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer.MAX_VALUEï¼Œæ•‘æ€¥çº¿ç¨‹çš„ç©ºé—²ç”Ÿå­˜æ—¶é—´æ˜¯ 60sï¼Œæ„å‘³ç€ å…¨éƒ¨éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹ï¼ˆ60s åŽå¯ä»¥å›žæ”¶ï¼‰ æ•‘æ€¥çº¿ç¨‹å¯ä»¥æ— é™åˆ›å»º é˜Ÿåˆ—é‡‡ç”¨äº† SynchronousQueue å®žçŽ°ç‰¹ç‚¹æ˜¯ï¼Œå®ƒæ²¡æœ‰å®¹é‡ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›åŽ»çš„ï¼ˆä¸€æ‰‹äº¤é’±ã€ä¸€æ‰‹äº¤è´§ï¼‰ 12345678910111213141516171819202122232425262728293031SynchronousQueue&lt;Integer&gt; integers = new SynchronousQueue&lt;&gt;();new Thread(() -&gt; &#123; try &#123; log.debug(&quot;putting &#123;&#125; &quot;, 1); integers.put(1); log.debug(&quot;&#123;&#125; putted...&quot;, 1); log.debug(&quot;putting...&#123;&#125; &quot;, 2); integers.put(2); log.debug(&quot;&#123;&#125; putted...&quot;, 2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;,&quot;t1&quot;).start();sleep(1);new Thread(() -&gt; &#123; try &#123; log.debug(&quot;taking &#123;&#125;&quot;, 1); integers.take(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;,&quot;t2&quot;).start();sleep(1);new Thread(() -&gt; &#123; try &#123; log.debug(&quot;taking &#123;&#125;&quot;, 2); integers.take(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;&#125;,&quot;t3&quot;).start(); è¾“å‡º 12345611:48:15.500 c.TestSynchronousQueue [t1] - putting 111:48:16.500 c.TestSynchronousQueue [t2] - taking 111:48:16.500 c.TestSynchronousQueue [t1] - 1 putted...11:48:16.500 c.TestSynchronousQueue [t1] - putting...211:48:17.502 c.TestSynchronousQueue [t3] - taking 211:48:17.503 c.TestSynchronousQueue [t1] - 2 putted... è¯„ä»· æ•´ä¸ªçº¿ç¨‹æ± è¡¨çŽ°ä¸ºçº¿ç¨‹æ•°ä¼šæ ¹æ®ä»»åŠ¡é‡ä¸æ–­å¢žé•¿ï¼Œæ²¡æœ‰ä¸Šé™ï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç©ºé—² 1åˆ†é’ŸåŽé‡Šæ”¾çº¿ç¨‹ã€‚ é€‚åˆä»»åŠ¡æ•°æ¯”è¾ƒå¯†é›†ï¼Œä½†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µ (5) newSingleThreadExecutor123456public static ExecutorService newSingleThreadExecutor() &#123; return new FinalizableDelegatedExecutorService (new ThreadPoolExecutor(1, 1, 0L, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;()));&#125; ä½¿ç”¨åœºæ™¯ï¼š å¸Œæœ›å¤šä¸ªä»»åŠ¡æŽ’é˜Ÿæ‰§è¡Œã€‚çº¿ç¨‹æ•°å›ºå®šä¸º 1ï¼Œä»»åŠ¡æ•°å¤šäºŽ 1 æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æŽ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™å”¯ä¸€çš„çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚ åŒºåˆ«ï¼š è‡ªå·±åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æžœä»»åŠ¡æ‰§è¡Œå¤±è´¥è€Œç»ˆæ­¢é‚£ä¹ˆæ²¡æœ‰ä»»ä½•è¡¥æ•‘æŽªæ–½ï¼Œè€Œçº¿ç¨‹æ± è¿˜ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¿è¯æ± çš„æ­£å¸¸å·¥ä½œ Executors.newSingleThreadExecutor() çº¿ç¨‹ä¸ªæ•°å§‹ç»ˆä¸º1ï¼Œä¸èƒ½ä¿®æ”¹ FinalizableDelegatedExecutorService åº”ç”¨çš„æ˜¯è£…é¥°å™¨æ¨¡å¼ï¼ˆFinalizableDelegatedExecutorService æ˜¯å…·ä½“è£…é¥°è§’è‰²ï¼ŒDelegatedExecutorService æ˜¯æŠ½è±¡è£…é¥°è§’è‰²ï¼ŒExecutorService æ˜¯æŠ½è±¡æž„ä»¶è§’è‰²ï¼‰ï¼Œåªå¯¹å¤–æš´éœ²äº† ExecutorService æŽ¥å£ï¼Œå› æ­¤ä¸èƒ½è°ƒç”¨ ThreadPoolExecutor ä¸­ç‰¹æœ‰çš„æ–¹æ³• Executors.newFixedThreadPool(1) åˆå§‹æ—¶ä¸º1ï¼Œä»¥åŽè¿˜å¯ä»¥ä¿®æ”¹ å¯¹å¤–æš´éœ²çš„æ˜¯ ThreadPoolExecutor å¯¹è±¡ï¼Œå¯ä»¥å¼ºè½¬åŽè°ƒç”¨ setCorePoolSize ç­‰æ–¹æ³•è¿›è¡Œä¿®æ”¹ (6) æäº¤ä»»åŠ¡123456789101112131415161718// æ‰§è¡Œä»»åŠ¡void execute(Runnable command);// æäº¤ä»»åŠ¡ taskï¼Œç”¨è¿”å›žå€¼ Future èŽ·å¾—ä»»åŠ¡æ‰§è¡Œç»“æžœ&lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task);// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException;// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå¸¦è¶…æ—¶æ—¶é—´&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException;// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›žæ­¤ä»»åŠ¡æ‰§è¡Œç»“æžœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆ&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) throws InterruptedException, ExecutionException;// æäº¤ tasks ä¸­æ‰€æœ‰ä»»åŠ¡ï¼Œå“ªä¸ªä»»åŠ¡å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›žæ­¤ä»»åŠ¡æ‰§è¡Œç»“æžœï¼Œå…¶å®ƒä»»åŠ¡å–æ¶ˆï¼Œå¸¦è¶…æ—¶æ—¶é—´&lt;T&gt; T invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks, long timeout, TimeUnit unit) throws InterruptedException, ExecutionException, TimeoutException; executeå’Œsubmitçš„åŒºåˆ« executeåªèƒ½æäº¤Runnableç±»åž‹çš„ä»»åŠ¡ï¼Œæ— è¿”å›žå€¼ã€‚submitæ—¢å¯ä»¥æäº¤Runnableç±»åž‹çš„ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æäº¤Callableç±»åž‹çš„ä»»åŠ¡ï¼Œä¼šæœ‰ä¸€ä¸ªç±»åž‹ä¸ºFutureçš„è¿”å›žå€¼ï¼Œä½†å½“ä»»åŠ¡ç±»åž‹ä¸ºRunnableæ—¶ï¼Œè¿”å›žå€¼ä¸ºnullã€‚ executeåœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œå¦‚æžœé‡åˆ°å¼‚å¸¸ä¼šç›´æŽ¥æŠ›å‡ºï¼Œè€Œsubmitä¸ä¼šç›´æŽ¥æŠ›å‡ºï¼Œåªæœ‰åœ¨ä½¿ç”¨Futureçš„getæ–¹æ³•èŽ·å–è¿”å›žå€¼æ—¶ï¼Œæ‰ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ submit æ‰§è¡ŒåŽä¼šç«‹å³è¿”å›žä¸€ä¸ªç»“æžœï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥å°†è¿”å›žçš„å¯¹è±¡è°ƒç”¨å…¶æ–¹æ³•get() èŽ·å–å°†æ¥çš„ç»“æžœï¼Œä¼šé˜»å¡žç­‰å¾…ï¼ˆä»»åŠ¡æœªæ‰§è¡Œå®Œæˆï¼‰ã€‚ (7) å…³é—­çº¿ç¨‹æ± shutdown 1234567/*çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º SHUTDOWN- ä¸ä¼šæŽ¥æ”¶æ–°ä»»åŠ¡- ä½†å·²æäº¤ä»»åŠ¡ä¼šæ‰§è¡Œå®Œ- æ­¤æ–¹æ³•ä¸ä¼šé˜»å¡žè°ƒç”¨çº¿ç¨‹çš„æ‰§è¡Œ*/void shutdown(); 12345678910111213141516public void shutdown() &#123; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; checkShutdownAccess(); // ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ advanceRunState(SHUTDOWN); // ä»…ä¼šæ‰“æ–­ç©ºé—²çº¿ç¨‹ interruptIdleWorkers(); onShutdown(); // æ‰©å±•ç‚¹ ScheduledThreadPoolExecutor &#125; finally &#123; mainLock.unlock(); &#125; // å°è¯•ç»ˆç»“(æ²¡æœ‰è¿è¡Œçš„çº¿ç¨‹å¯ä»¥ç«‹åˆ»ç»ˆç»“ï¼Œå¦‚æžœè¿˜æœ‰è¿è¡Œçš„çº¿ç¨‹ä¹Ÿä¸ä¼šç­‰) tryTerminate();&#125; shutdownNow 1234567/*çº¿ç¨‹æ± çŠ¶æ€å˜ä¸º STOP- ä¸ä¼šæŽ¥æ”¶æ–°ä»»åŠ¡- ä¼šå°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡è¿”å›ž- å¹¶ç”¨ interrupt çš„æ–¹å¼ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡*/List&lt;Runnable&gt; shutdownNow(); 12345678910111213141516171819public List&lt;Runnable&gt; shutdownNow() &#123; List&lt;Runnable&gt; tasks; final ReentrantLock mainLock = this.mainLock; mainLock.lock(); try &#123; checkShutdownAccess(); // ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ advanceRunState(STOP); // æ‰“æ–­æ‰€æœ‰çº¿ç¨‹ interruptWorkers(); // èŽ·å–é˜Ÿåˆ—ä¸­å‰©ä½™ä»»åŠ¡ tasks = drainQueue(); &#125; finally &#123; mainLock.unlock(); &#125; // å°è¯•ç»ˆç»“ tryTerminate(); return tasks;&#125; å…¶å®ƒæ–¹æ³• 1234567// ä¸åœ¨ RUNNING çŠ¶æ€çš„çº¿ç¨‹æ± ï¼Œæ­¤æ–¹æ³•å°±è¿”å›ž trueboolean isShutdown();// çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦æ˜¯ TERMINATEDboolean isTerminated();// è°ƒç”¨ shutdown åŽï¼Œç”±äºŽè°ƒç”¨çº¿ç¨‹å¹¶ä¸ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡è¿è¡Œç»“æŸï¼Œå› æ­¤å¦‚æžœå®ƒæƒ³åœ¨çº¿ç¨‹æ±  TERMINATED åŽåšäº›äº‹æƒ…ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•ç­‰å¾… boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; * å¼‚æ­¥æ¨¡å¼ä¹‹å·¥ä½œçº¿ç¨‹å®šä¹‰è®©æœ‰é™çš„å·¥ä½œçº¿ç¨‹ï¼ˆWorker Threadï¼‰æ¥è½®æµå¼‚æ­¥å¤„ç†æ— é™å¤šçš„ä»»åŠ¡ã€‚ä¹Ÿå¯ä»¥å°†å…¶å½’ç±»ä¸ºåˆ†å·¥æ¨¡å¼ï¼Œå®ƒçš„å…¸åž‹å®žçŽ°å°±æ˜¯çº¿ç¨‹æ± ï¼Œä¹Ÿä½“çŽ°äº†ç»å…¸è®¾è®¡æ¨¡å¼ä¸­çš„äº«å…ƒæ¨¡å¼ã€‚ ä¾‹å¦‚ï¼Œæµ·åº•æžçš„æœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰ï¼Œè½®æµå¤„ç†æ¯ä½å®¢äººçš„ç‚¹é¤ï¼ˆä»»åŠ¡ï¼‰ï¼Œå¦‚æžœä¸ºæ¯ä½å®¢äººéƒ½é…ä¸€åä¸“å±žçš„æœåŠ¡å‘˜ï¼Œé‚£ä¹ˆæˆæœ¬å°±å¤ªé«˜äº†ï¼ˆå¯¹æ¯”å¦ä¸€ç§å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ï¼šThread-Per-Messageï¼‰ æ³¨æ„ï¼Œä¸åŒä»»åŠ¡ç±»åž‹åº”è¯¥ä½¿ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œè¿™æ ·èƒ½å¤Ÿé¿å…é¥¥é¥¿ï¼Œå¹¶èƒ½æå‡æ•ˆçŽ‡ ä¾‹å¦‚ï¼Œå¦‚æžœä¸€ä¸ªé¤é¦†çš„å·¥äººæ—¢è¦æ‹›å‘¼å®¢äººï¼ˆä»»åŠ¡ç±»åž‹Aï¼‰ï¼Œåˆè¦åˆ°åŽåŽ¨åšèœï¼ˆä»»åŠ¡ç±»åž‹Bï¼‰æ˜¾ç„¶æ•ˆçŽ‡ä¸å’‹åœ°ï¼Œåˆ†æˆæœåŠ¡å‘˜ï¼ˆçº¿ç¨‹æ± Aï¼‰ä¸ŽåŽ¨å¸ˆï¼ˆçº¿ç¨‹æ± Bï¼‰æ›´ä¸ºåˆç†ï¼Œå½“ç„¶ä½ èƒ½æƒ³åˆ°æ›´ç»†è‡´çš„åˆ†å·¥ é¥¥é¥¿å›ºå®šå¤§å°çº¿ç¨‹æ± ä¼šæœ‰é¥¥é¥¿çŽ°è±¡ ä¸¤ä¸ªå·¥äººæ˜¯åŒä¸€ä¸ªçº¿ç¨‹æ± ä¸­çš„ä¸¤ä¸ªçº¿ç¨‹ ä»–ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šä¸ºå®¢äººç‚¹é¤å’Œåˆ°åŽåŽ¨åšèœï¼Œè¿™æ˜¯ä¸¤ä¸ªé˜¶æ®µçš„å·¥ä½œ å®¢äººç‚¹é¤ï¼šå¿…é¡»å…ˆç‚¹å®Œé¤ï¼Œç­‰èœåšå¥½ï¼Œä¸Šèœï¼Œåœ¨æ­¤æœŸé—´å¤„ç†ç‚¹é¤çš„å·¥äººå¿…é¡»ç­‰å¾… åŽåŽ¨åšèœï¼šæ²¡å•¥è¯´çš„ï¼Œåšå°±æ˜¯äº† æ¯”å¦‚å·¥äººA å¤„ç†äº†ç‚¹é¤ä»»åŠ¡ï¼ŒæŽ¥ä¸‹æ¥å®ƒè¦ç­‰ç€ å·¥äººB æŠŠèœåšå¥½ï¼Œç„¶åŽä¸Šèœï¼Œä»–ä¿©ä¹Ÿé…åˆçš„è›®å¥½ ä½†çŽ°åœ¨åŒæ—¶æ¥äº†ä¸¤ä¸ªå®¢äººï¼Œè¿™ä¸ªæ—¶å€™å·¥äººA å’Œå·¥äººB éƒ½åŽ»å¤„ç†ç‚¹é¤äº†ï¼Œè¿™æ—¶æ²¡äººåšé¥­äº†ï¼Œé¥¥é¥¿ 123456789101112131415161718192021222324252627282930313233343536public class TestDeadLock &#123; static final List&lt;String&gt; MENU = Arrays.asList(&quot;åœ°ä¸‰é²œ&quot;, &quot;å®«ä¿é¸¡ä¸&quot;, &quot;è¾£å­é¸¡ä¸&quot;, &quot;çƒ¤é¸¡ç¿…&quot;); static Random RANDOM = new Random(); static String cooking() &#123; return MENU.get(RANDOM.nextInt(MENU.size())); &#125; public static void main(String[] args) &#123; ExecutorService executorService = Executors.newFixedThreadPool(2); executorService.execute(() -&gt; &#123; log.debug(&quot;å¤„ç†ç‚¹é¤...&quot;); Future&lt;String&gt; f = executorService.submit(() -&gt; &#123; log.debug(&quot;åšèœ&quot;); return cooking(); &#125;); try &#123; log.debug(&quot;ä¸Šèœ: &#123;&#125;&quot;, f.get()); &#125; catch (InterruptedException | ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;); /* executorService.execute(() -&gt; &#123; log.debug(&quot;å¤„ç†ç‚¹é¤...&quot;); Future&lt;String&gt; f = executorService.submit(() -&gt; &#123; log.debug(&quot;åšèœ&quot;); return cooking(); &#125;); try &#123; log.debug(&quot;ä¸Šèœ: &#123;&#125;&quot;, f.get()); &#125; catch (InterruptedException | ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;); */ &#125;&#125; è¾“å‡º 12317:21:27.883 c.TestDeadLock [pool-1-thread-1] - å¤„ç†ç‚¹é¤...17:21:27.891 c.TestDeadLock [pool-1-thread-2] - åšèœ17:21:27.891 c.TestDeadLock [pool-1-thread-1] - ä¸Šèœ: çƒ¤é¸¡ç¿… å½“æ³¨é‡Šå–æ¶ˆåŽï¼Œå¯èƒ½çš„è¾“å‡º 1217:08:41.339 c.TestDeadLock [pool-1-thread-2] - å¤„ç†ç‚¹é¤...17:08:41.339 c.TestDeadLock [pool-1-thread-1] - å¤„ç†ç‚¹é¤... è§£å†³æ–¹æ³•å¯ä»¥å¢žåŠ çº¿ç¨‹æ± çš„å¤§å°ï¼Œä¸è¿‡ä¸æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯å‰é¢æåˆ°çš„ï¼Œä¸åŒçš„ä»»åŠ¡ç±»åž‹ï¼Œé‡‡ç”¨ä¸åŒçš„çº¿ç¨‹æ± ï¼Œä¾‹å¦‚ï¼š 1234567891011121314151617181920212223242526272829303132333435public class TestDeadLock &#123; static final List&lt;String&gt; MENU = Arrays.asList(&quot;åœ°ä¸‰é²œ&quot;, &quot;å®«ä¿é¸¡ä¸&quot;, &quot;è¾£å­é¸¡ä¸&quot;, &quot;çƒ¤é¸¡ç¿…&quot;); static Random RANDOM = new Random(); static String cooking() &#123; return MENU.get(RANDOM.nextInt(MENU.size())); &#125; public static void main(String[] args) &#123; ExecutorService waiterPool = Executors.newFixedThreadPool(1); ExecutorService cookPool = Executors.newFixedThreadPool(1); waiterPool.execute(() -&gt; &#123; log.debug(&quot;å¤„ç†ç‚¹é¤...&quot;); Future&lt;String&gt; f = cookPool.submit(() -&gt; &#123; log.debug(&quot;åšèœ&quot;); return cooking(); &#125;); try &#123; log.debug(&quot;ä¸Šèœ: &#123;&#125;&quot;, f.get()); &#125; catch (InterruptedException | ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;); waiterPool.execute(() -&gt; &#123; log.debug(&quot;å¤„ç†ç‚¹é¤...&quot;); Future&lt;String&gt; f = cookPool.submit(() -&gt; &#123; log.debug(&quot;åšèœ&quot;); return cooking(); &#125;); try &#123; log.debug(&quot;ä¸Šèœ: &#123;&#125;&quot;, f.get()); &#125; catch (InterruptedException | ExecutionException e) &#123; e.printStackTrace(); &#125; &#125;); &#125;&#125; è¾“å‡º 12345617:25:14.626 c.TestDeadLock [pool-1-thread-1] - å¤„ç†ç‚¹é¤...17:25:14.630 c.TestDeadLock [pool-2-thread-1] - åšèœ17:25:14.631 c.TestDeadLock [pool-1-thread-1] - ä¸Šèœ: åœ°ä¸‰é²œ17:25:14.632 c.TestDeadLock [pool-1-thread-1] - å¤„ç†ç‚¹é¤...17:25:14.632 c.TestDeadLock [pool-2-thread-1] - åšèœ17:25:14.632 c.TestDeadLock [pool-1-thread-1] - ä¸Šèœ: è¾£å­é¸¡ä¸ åˆ›å»ºå¤šå°‘çº¿ç¨‹æ± åˆé€‚ è¿‡å°ä¼šå¯¼è‡´ç¨‹åºä¸èƒ½å……åˆ†åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºã€å®¹æ˜“å¯¼è‡´é¥¥é¥¿ è¿‡å¤§ä¼šå¯¼è‡´æ›´å¤šçš„çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå ç”¨æ›´å¤šå†…å­˜ CPU å¯†é›†åž‹è¿ç®—é€šå¸¸é‡‡ç”¨ cpu æ ¸æ•° + 1 èƒ½å¤Ÿå®žçŽ°æœ€ä¼˜çš„ CPU åˆ©ç”¨çŽ‡ï¼Œ+1 æ˜¯ä¿è¯å½“çº¿ç¨‹ç”±äºŽé¡µç¼ºå¤±æ•…éšœï¼ˆæ“ä½œç³»ç»Ÿï¼‰æˆ–å…¶å®ƒåŽŸå› å¯¼è‡´æš‚åœæ—¶ï¼Œé¢å¤–çš„è¿™ä¸ªçº¿ç¨‹å°±èƒ½é¡¶ä¸ŠåŽ»ï¼Œä¿è¯ CPU æ—¶é’Ÿå‘¨æœŸä¸è¢«æµªè´¹ I/O å¯†é›†åž‹è¿ç®—CPU ä¸æ€»æ˜¯å¤„äºŽç¹å¿™çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œå½“ä½ æ‰§è¡Œä¸šåŠ¡è®¡ç®—æ—¶ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨ CPU èµ„æºï¼Œä½†å½“ä½ æ‰§è¡Œ I/O æ“ä½œæ—¶ã€è¿œç¨‹RPC è°ƒç”¨æ—¶ï¼ŒåŒ…æ‹¬è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ CPU å°±é—²ä¸‹æ¥äº†ï¼Œä½ å¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹æé«˜å®ƒçš„åˆ©ç”¨çŽ‡ã€‚ ç»éªŒå…¬å¼å¦‚ä¸‹ çº¿ç¨‹æ•° = æ ¸æ•° * æœŸæœ› CPU åˆ©ç”¨çŽ‡ * æ€»æ—¶é—´(CPUè®¡ç®—æ—¶é—´+ç­‰å¾…æ—¶é—´) / CPU è®¡ç®—æ—¶é—´ ä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 50% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 50%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼ 4 * 100% * 100% / 50% = 8 ä¾‹å¦‚ 4 æ ¸ CPU è®¡ç®—æ—¶é—´æ˜¯ 10% ï¼Œå…¶å®ƒç­‰å¾…æ—¶é—´æ˜¯ 90%ï¼ŒæœŸæœ› cpu è¢« 100% åˆ©ç”¨ï¼Œå¥—ç”¨å…¬å¼ 4 * 100% * 100% / 10% = 40 è‡ªå®šä¹‰çº¿ç¨‹æ± (8) ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± åœ¨ã€Žä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ã€åŠŸèƒ½åŠ å…¥ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ java.util.Timer æ¥å®žçŽ°å®šæ—¶åŠŸèƒ½ï¼ŒTimer çš„ä¼˜ç‚¹åœ¨äºŽç®€å•æ˜“ç”¨ï¼Œä½†ç”±äºŽæ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ¥è°ƒåº¦ï¼Œå› æ­¤æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå‰ä¸€ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæˆ–å¼‚å¸¸éƒ½å°†ä¼šå½±å“åˆ°ä¹‹åŽçš„ä»»åŠ¡ã€‚ 1234567891011121314151617181920public static void main(String[] args) &#123; Timer timer = new Timer(); TimerTask task1 = new TimerTask() &#123; @Override public void run() &#123; log.debug(&quot;task 1&quot;); sleep(2); &#125; &#125;; TimerTask task2 = new TimerTask() &#123; @Override public void run() &#123; log.debug(&quot;task 2&quot;); &#125; &#125;; // ä½¿ç”¨ timer æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åŽæ‰§è¡Œ // ä½†ç”±äºŽ timer å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ¥é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œå› æ­¤ã€Žä»»åŠ¡1ã€çš„å»¶æ—¶ï¼Œå½±å“äº†ã€Žä»»åŠ¡2ã€çš„æ‰§è¡Œ timer.schedule(task1, 1000); timer.schedule(task2, 1000);&#125; è¾“å‡º 1230:46:09.444 c.TestTimer [main] - start...20:46:10.447 c.TestTimer [Timer-0] - task 120:46:12.448 c.TestTimer [Timer-0] - task 2 ä½¿ç”¨ ScheduledExecutorService æ”¹å†™ï¼š 123456789ScheduledExecutorService executor = Executors.newScheduledThreadPool(2);// æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åŽæ‰§è¡Œexecutor.schedule(() -&gt; &#123; System.out.println(&quot;ä»»åŠ¡1ï¼Œæ‰§è¡Œæ—¶é—´ï¼š&quot; + new Date()); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; &#125;&#125;, 1000, TimeUnit.MILLISECONDS);executor.schedule(() -&gt; &#123; System.out.println(&quot;ä»»åŠ¡2ï¼Œæ‰§è¡Œæ—¶é—´ï¼š&quot; + new Date());&#125;, 1000, TimeUnit.MILLISECONDS); è¾“å‡º 12ä»»åŠ¡1ï¼Œæ‰§è¡Œæ—¶é—´ï¼šThu Jan 03 12:45:17 CST 2019ä»»åŠ¡2ï¼Œæ‰§è¡Œæ—¶é—´ï¼šThu Jan 03 12:45:17 CST 2019 scheduleAtFixedRate ä¾‹å­ï¼š 12345ScheduledExecutorService pool = Executors.newScheduledThreadPool(1);log.debug(&quot;start...&quot;);pool.scheduleAtFixedRate(() -&gt; &#123; log.debug(&quot;running...&quot;);&#125;, 1, 1, TimeUnit.SECONDS); è¾“å‡º 1234521:45:43.167 c.TestTimer [main] - start...21:45:44.215 c.TestTimer [pool-1-thread-1] - running...21:45:45.215 c.TestTimer [pool-1-thread-1] - running...21:45:46.215 c.TestTimer [pool-1-thread-1] - running...21:45:47.215 c.TestTimer [pool-1-thread-1] - running... scheduleAtFixedRate ä¾‹å­ï¼ˆä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡äº†é—´éš”æ—¶é—´ï¼‰ï¼š 123456ScheduledExecutorService pool = Executors.newScheduledThreadPool(1);log.debug(&quot;start...&quot;);pool.scheduleAtFixedRate(() -&gt; &#123; log.debug(&quot;running...&quot;); sleep(2);&#125;, 1, 1, TimeUnit.SECONDS); è¾“å‡ºåˆ†æžï¼šä¸€å¼€å§‹ï¼Œå»¶æ—¶ 1sï¼ŒæŽ¥ä¸‹æ¥ï¼Œç”±äºŽä»»åŠ¡æ‰§è¡Œæ—¶é—´ &gt; é—´éš”æ—¶é—´ï¼Œé—´éš”è¢«ã€Žæ’‘ã€åˆ°äº† 2s 1234521:44:30.311 c.TestTimer [main] - start...21:44:31.360 c.TestTimer [pool-1-thread-1] - running...21:44:33.361 c.TestTimer [pool-1-thread-1] - running...21:44:35.362 c.TestTimer [pool-1-thread-1] - running...21:44:37.362 c.TestTimer [pool-1-thread-1] - running... scheduleWithFixedDelay ä¾‹å­ï¼š 123456ScheduledExecutorService pool = Executors.newScheduledThreadPool(1);log.debug(&quot;start...&quot;);pool.scheduleWithFixedDelay(()-&gt; &#123; log.debug(&quot;running...&quot;); sleep(2);&#125;, 1, 1, TimeUnit.SECONDS); è¾“å‡ºåˆ†æžï¼šä¸€å¼€å§‹ï¼Œå»¶æ—¶ 1sï¼ŒscheduleWithFixedDelay çš„é—´éš”æ˜¯ ä¸Šä¸€ä¸ªä»»åŠ¡ç»“æŸ &lt;-&gt; å»¶æ—¶ &lt;-&gt; ä¸‹ä¸€ä¸ªä»»åŠ¡å¼€å§‹ æ‰€ä»¥é—´éš”éƒ½æ˜¯ 3s 1234521:40:55.078 c.TestTimer [main] - start...21:40:56.140 c.TestTimer [pool-1-thread-1] - running...21:40:59.143 c.TestTimer [pool-1-thread-1] - running...21:41:02.145 c.TestTimer [pool-1-thread-1] - running...21:41:05.147 c.TestTimer [pool-1-thread-1] - running... è¯„ä»· æ•´ä¸ªçº¿ç¨‹æ± è¡¨çŽ°ä¸ºï¼šçº¿ç¨‹æ•°å›ºå®šï¼Œä»»åŠ¡æ•°å¤šäºŽçº¿ç¨‹æ•°æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æŽ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™äº›çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚ç”¨æ¥æ‰§è¡Œå»¶è¿Ÿæˆ–åå¤æ‰§è¡Œçš„ä»»åŠ¡ (9) æ­£ç¡®å¤„ç†æ‰§è¡Œä»»åŠ¡å¼‚å¸¸æ–¹æ³•1ï¼šä¸»åŠ¨æ‰å¼‚å¸¸ 123456789ExecutorService pool = Executors.newFixedThreadPool(1);pool.submit(() -&gt; &#123; try &#123; log.debug(&quot;task1&quot;); int i = 1 / 0; &#125; catch (Exception e) &#123; log.error(&quot;error:&quot;, e); &#125;&#125;); è¾“å‡º 12345678921:59:04.558 c.TestTimer [pool-1-thread-1] - task121:59:04.562 c.TestTimer [pool-1-thread-1] - error:java.lang.ArithmeticException: / by zero at cn.itcast.n8.TestTimer.lambda$main$0(TestTimer.java:28) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748) æ–¹æ³•2ï¼šä½¿ç”¨ Future 1234567ExecutorService pool = Executors.newFixedThreadPool(1);Future&lt;Boolean&gt; f = pool.submit(() -&gt; &#123; log.debug(&quot;task1&quot;); int i = 1 / 0; return true;&#125;);log.debug(&quot;result:&#123;&#125;&quot;, f.get()); è¾“å‡º 12345678910111221:54:58.208 c.TestTimer [pool-1-thread-1] - task1Exception in thread &quot;main&quot; java.util.concurrent.ExecutionException:java.lang.ArithmeticException: / by zero at java.util.concurrent.FutureTask.report(FutureTask.java:122) at java.util.concurrent.FutureTask.get(FutureTask.java:192) at cn.itcast.n8.TestTimer.main(TestTimer.java:31)Caused by: java.lang.ArithmeticException: / by zero at cn.itcast.n8.TestTimer.lambda$main$0(TestTimer.java:28) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748) * åº”ç”¨ä¹‹å®šæ—¶ä»»åŠ¡å®šæœŸæ‰§è¡Œå¦‚ä½•è®©æ¯å‘¨å›› 18:00:00 å®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼Ÿ 123456789101112131415161718// èŽ·å¾—å½“å‰æ—¶é—´LocalDateTime now = LocalDateTime.now();// èŽ·å–æœ¬å‘¨å›› 18:00:00.000LocalDateTime thursday = now.with(DayOfWeek.THURSDAY).withHour(18).withMinute(0).withSecond(0).withNano(0);// å¦‚æžœå½“å‰æ—¶é—´å·²ç»è¶…è¿‡ æœ¬å‘¨å›› 18:00:00.000ï¼Œ é‚£ä¹ˆæ‰¾ä¸‹å‘¨å›› 18:00:00.000if(now.compareTo(thursday) &gt;= 0) &#123; thursday = thursday.plusWeeks(1);&#125;// è®¡ç®—æ—¶é—´å·®ï¼Œå³å»¶æ—¶æ‰§è¡Œæ—¶é—´long initialDelay = Duration.between(now, thursday).toMillis();// è®¡ç®—é—´éš”æ—¶é—´ï¼Œå³ 1 å‘¨çš„æ¯«ç§’å€¼long oneWeek = 7 * 24 * 3600 * 1000;ScheduledExecutorService executor = Executors.newScheduledThreadPool(2);System.out.println(&quot;å¼€å§‹æ—¶é—´ï¼š&quot; + new Date());executor.scheduleAtFixedRate(() -&gt; &#123; System.out.println(&quot;æ‰§è¡Œæ—¶é—´ï¼š&quot; + new Date());&#125;, initialDelay, oneWeek, TimeUnit.MILLISECONDS); (10) tomcat çº¿ç¨‹æ± Tomcat åœ¨å“ªé‡Œç”¨åˆ°äº†çº¿ç¨‹æ± å‘¢ LimitLatch ç”¨æ¥é™æµï¼Œå¯ä»¥æŽ§åˆ¶æœ€å¤§è¿žæŽ¥ä¸ªæ•°ï¼Œç±»ä¼¼ J.U.C ä¸­çš„ Semaphore åŽé¢å†è®² Acceptor åªè´Ÿè´£ã€æŽ¥æ”¶æ–°çš„ socket è¿žæŽ¥ã€‘ Poller åªè´Ÿè´£ç›‘å¬ socket channel æ˜¯å¦æœ‰ã€å¯è¯»çš„ I/O äº‹ä»¶ã€‘ ä¸€æ—¦å¯è¯»ï¼Œå°è£…ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼ˆsocketProcessorï¼‰ï¼Œæäº¤ç»™ Executor çº¿ç¨‹æ± å¤„ç† Executor çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹æœ€ç»ˆè´Ÿè´£ã€å¤„ç†è¯·æ±‚ã€‘ Tomcat çº¿ç¨‹æ± æ‰©å±•äº† ThreadPoolExecutorï¼Œè¡Œä¸ºç¨æœ‰ä¸åŒ å¦‚æžœæ€»çº¿ç¨‹æ•°è¾¾åˆ° maximumPoolSize è¿™æ—¶ä¸ä¼šç«‹åˆ»æŠ› RejectedExecutionException å¼‚å¸¸ è€Œæ˜¯å†æ¬¡å°è¯•å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦‚æžœè¿˜å¤±è´¥ï¼Œæ‰æŠ›å‡º RejectedExecutionException å¼‚å¸¸ æºç  tomcat-7.0.42 1234567891011121314151617181920212223public void execute(Runnable command, long timeout, TimeUnit unit) &#123; submittedCount.incrementAndGet(); try &#123; super.execute(command); &#125; catch (RejectedExecutionException rx) &#123; if (super.getQueue() instanceof TaskQueue) &#123; final TaskQueue queue = (TaskQueue)super.getQueue(); try &#123; if (!queue.force(command, timeout, unit)) &#123; submittedCount.decrementAndGet(); throw new RejectedExecutionException(&quot;Queue capacity is full.&quot;); &#125; &#125; catch (InterruptedException x) &#123; submittedCount.decrementAndGet(); Thread.interrupted(); throw new RejectedExecutionException(x); &#125; &#125; else &#123; submittedCount.decrementAndGet(); throw rx; &#125; &#125;&#125; TaskQueue.java 1234567public boolean force(Runnable o, long timeout, TimeUnit unit) throws InterruptedException &#123; if ( parent.isShutdown() ) throw new RejectedExecutionException( &quot;Executor not running, can&#x27;t force a command into the queue&quot; ); return super.offer(o,timeout,unit); //forces the item onto the queue, to be used if the task is rejected&#125; Connector é…ç½® é…ç½®é¡¹ é»˜è®¤å€¼ è¯´æ˜Ž acceptorThreadCount 1 acceptor çº¿ç¨‹æ•°é‡ pollerThreadCount 1 poller çº¿ç¨‹æ•°é‡ minSpareThreads 10 æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ corePoolSize maxThreads 200 æœ€å¤§çº¿ç¨‹æ•°ï¼Œå³ maximumPoolSize executor - Executor åç§°ï¼Œç”¨æ¥å¼•ç”¨ä¸‹é¢çš„ Executor Executor çº¿ç¨‹é…ç½® é…ç½®é¡¹ é»˜è®¤å€¼ è¯´æ˜Ž threadPriority 5 çº¿ç¨‹ä¼˜å…ˆçº§ daemon true æ˜¯å¦å®ˆæŠ¤çº¿ç¨‹ minSpareThreads 25 æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå³ corePoolSize maxThreads 200 æœ€å¤§çº¿ç¨‹æ•°ï¼Œå³ maximumPoolSize maxIdleTime 60000 çº¿ç¨‹ç”Ÿå­˜æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œé»˜è®¤å€¼å³ 1 åˆ†é’Ÿ maxQueueSize Integer.MAX_VALUE é˜Ÿåˆ—é•¿åº¦ prestartminSpareThreads false æ ¸å¿ƒçº¿ç¨‹æ˜¯å¦åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å¯åŠ¨ 123456graph LRa(æ·»åŠ æ–°ä»»åŠ¡) --&gt; b(æäº¤ä»»åŠ¡ &lt; æ ¸å¿ƒçº¿ç¨‹)b --&gt;|æ˜¯| c(åŠ å…¥é˜Ÿåˆ—)b --&gt; |å¦| d(æäº¤ä»»åŠ¡ &lt; æœ€å¤§çº¿ç¨‹)d --&gt; |æ˜¯| e(åˆ›å»ºæ€¥æ•‘çº¿ç¨‹)d --&gt; |å¦| c 1.3 Fork/Join(1) æ¦‚å¿µFork/Join æ˜¯ JDK 1.7 åŠ å…¥çš„æ–°çš„çº¿ç¨‹æ± å®žçŽ°ï¼Œå®ƒä½“çŽ°çš„æ˜¯ä¸€ç§åˆ†æ²»æ€æƒ³ï¼Œé€‚ç”¨äºŽèƒ½å¤Ÿè¿›è¡Œä»»åŠ¡æ‹†åˆ†çš„ cpu å¯†é›†åž‹è¿ç®— æ‰€è°“çš„ä»»åŠ¡æ‹†åˆ†ï¼Œæ˜¯å°†ä¸€ä¸ªå¤§ä»»åŠ¡æ‹†åˆ†ä¸ºç®—æ³•ä¸Šç›¸åŒçš„å°ä»»åŠ¡ï¼Œç›´è‡³ä¸èƒ½æ‹†åˆ†å¯ä»¥ç›´æŽ¥æ±‚è§£ã€‚è·Ÿé€’å½’ç›¸å…³çš„ä¸€äº›è®¡ç®—ï¼Œå¦‚å½’å¹¶æŽ’åºã€æ–æ³¢é‚£å¥‘æ•°åˆ—ã€éƒ½å¯ä»¥ç”¨åˆ†æ²»æ€æƒ³è¿›è¡Œæ±‚è§£ Fork/Join åœ¨åˆ†æ²»çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å¤šçº¿ç¨‹ï¼Œå¯ä»¥æŠŠæ¯ä¸ªä»»åŠ¡çš„åˆ†è§£å’Œåˆå¹¶äº¤ç»™ä¸åŒçš„çº¿ç¨‹æ¥å®Œæˆï¼Œè¿›ä¸€æ­¥æå‡äº†è¿ç®—æ•ˆçŽ‡ Fork/Join é»˜è®¤ä¼šåˆ›å»ºä¸Ž cpu æ ¸å¿ƒæ•°å¤§å°ç›¸åŒçš„çº¿ç¨‹æ±  (2) ä½¿ç”¨æäº¤ç»™ Fork/Join çº¿ç¨‹æ± çš„ä»»åŠ¡éœ€è¦ç»§æ‰¿ RecursiveTaskï¼ˆæœ‰è¿”å›žå€¼ï¼‰æˆ– RecursiveActionï¼ˆæ²¡æœ‰è¿”å›žå€¼ï¼‰ï¼Œä¾‹å¦‚ä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå¯¹ 1~n ä¹‹é—´çš„æ•´æ•°æ±‚å’Œçš„ä»»åŠ¡ 123456789101112131415161718192021222324252627@Slf4j(topic = &quot;c.AddTask&quot;)class AddTask1 extends RecursiveTask&lt;Integer&gt; &#123; int n; public AddTask1(int n) &#123; this.n = n; &#125; @Override public String toString() &#123; return &quot;&#123;&quot; + n + &#x27;&#125;&#x27;; &#125; @Override protected Integer compute() &#123; // å¦‚æžœ n å·²ç»ä¸º 1ï¼Œå¯ä»¥æ±‚å¾—ç»“æžœäº† if (n == 1) &#123; log.debug(&quot;join() &#123;&#125;&quot;, n); return n; &#125; // å°†ä»»åŠ¡è¿›è¡Œæ‹†åˆ†(fork) AddTask1 t1 = new AddTask1(n - 1); t1.fork(); log.debug(&quot;fork() &#123;&#125; + &#123;&#125;&quot;, n, t1); // åˆå¹¶(join)ç»“æžœ int result = n + t1.join(); log.debug(&quot;join() &#123;&#125; + &#123;&#125; = &#123;&#125;&quot;, n, t1, result); return result; &#125;&#125; ç„¶åŽæäº¤ç»™ ForkJoinPool æ¥æ‰§è¡Œ 1234public static void main(String[] args) &#123; ForkJoinPool pool = new ForkJoinPool(4); System.out.println(pool.invoke(new AddTask1(5)));&#125; ç»“æžœ 12345678910[ForkJoinPool-1-worker-0] - fork() 2 + &#123;1&#125;[ForkJoinPool-1-worker-1] - fork() 5 + &#123;4&#125;[ForkJoinPool-1-worker-0] - join() 1[ForkJoinPool-1-worker-0] - join() 2 + &#123;1&#125; = 3[ForkJoinPool-1-worker-2] - fork() 4 + &#123;3&#125;[ForkJoinPool-1-worker-3] - fork() 3 + &#123;2&#125;[ForkJoinPool-1-worker-3] - join() 3 + &#123;2&#125; = 6[ForkJoinPool-1-worker-2] - join() 4 + &#123;3&#125; = 10[ForkJoinPool-1-worker-1] - join() 5 + &#123;4&#125; = 1515 ç”¨å›¾æ¥è¡¨ç¤º 123456789101112131415graph LRt1(&quot;t1 5 + &#123;4&#125;&quot;)t2(&quot;t2 4 + &#123;3&#125;&quot;)t3(&quot;t3 3 + &#123;2&#125;&quot;)t00(&quot;t0 2 + &#123;1&#125;&quot;)t0(&quot;t0&quot;)t00 -- &quot;&#123;1&#125;&quot; --&gt; t0t0 -. &quot;1&quot; .-&gt; t00t3 -. &quot;&#123;2&#125;&quot; .-&gt; t00t00 -. &quot;3&quot; .-&gt; t3t2 -- &quot;&#123;3&#125;&quot; --&gt; t3t3 -. &quot;6&quot; .-&gt; t2t1 -- &quot;&#123;4&#125;&quot; --&gt; t2t2 -. &quot;10&quot; .-&gt; t1 æ”¹è¿› 1234567891011121314151617181920212223242526272829303132333435class AddTask3 extends RecursiveTask&lt;Integer&gt; &#123; int begin; int end; public AddTask3(int begin, int end) &#123; this.begin = begin; this.end = end; &#125; @Override public String toString() &#123; return &quot;&#123;&quot; + begin + &quot;,&quot; + end + &#x27;&#125;&#x27;; &#125; @Override protected Integer compute() &#123; // 5, 5 if (begin == end) &#123; log.debug(&quot;join() &#123;&#125;&quot;, begin); return begin; &#125; // 4, 5 if (end - begin == 1) &#123; log.debug(&quot;join() &#123;&#125; + &#123;&#125; = &#123;&#125;&quot;, begin, end, end + begin); return end + begin; &#125; // 1 5 int mid = (end + begin) / 2; // 3 AddTask3 t1 = new AddTask3(begin, mid); // 1,3 t1.fork(); AddTask3 t2 = new AddTask3(mid + 1, end); // 4,5 t2.fork(); log.debug(&quot;fork() &#123;&#125; + &#123;&#125; = ?&quot;, t1, t2); int result = t1.join() + t2.join(); log.debug(&quot;join() &#123;&#125; + &#123;&#125; = &#123;&#125;&quot;, t1, t2, result); return result; &#125;&#125; ç„¶åŽæäº¤ç»™ ForkJoinPool æ¥æ‰§è¡Œ 1234public static void main(String[] args) &#123; ForkJoinPool pool = new ForkJoinPool(4); System.out.println(pool.invoke(new AddTask3(1, 10)));&#125; ç»“æžœ 12345678[ForkJoinPool-1-worker-0] - join() 1 + 2 = 3[ForkJoinPool-1-worker-3] - join() 4 + 5 = 9[ForkJoinPool-1-worker-0] - join() 3[ForkJoinPool-1-worker-1] - fork() &#123;1,3&#125; + &#123;4,5&#125; = ?[ForkJoinPool-1-worker-2] - fork() &#123;1,2&#125; + &#123;3,3&#125; = ?[ForkJoinPool-1-worker-2] - join() &#123;1,2&#125; + &#123;3,3&#125; = 6[ForkJoinPool-1-worker-1] - join() &#123;1,3&#125; + &#123;4,5&#125; = 1515 ç”¨å›¾æ¥è¡¨ç¤º 12345678910111213141516graph LRt1(&quot;t1 &#123;1,3&#125; + &#123;4,5&#125;&quot;)t2(&quot;t2 &#123;1,2&#125;,&#123;3,3&#125;&quot;)t3(&quot;t3&quot;)t0(&quot;t0&quot;)t1 -- &quot;&#123;1,3&#125;&quot; --&gt; t2t1 -- &quot;&#123;4,5&#125;&quot; --&gt; t3t2 -- &quot;&#123;1,2&#125;&quot; --&gt; t0t2 -- &quot;&#123;3,3&#125;&quot; --&gt; t0t0 -. &quot;3&quot;.-&gt; t2t0 -. &quot;3&quot; .-&gt; t2t2 -. &quot;6&quot; .- t1t3 -. &quot;9&quot; .-&gt; t1t1 -. 15 .-&gt; ç»“æžœ 2. J.U.C2.1 AQS åŽŸç†æ¦‚è¿°å…¨ç§°æ˜¯ AbstractQueuedSynchronizerï¼Œæ˜¯é˜»å¡žå¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„æ¡†æž¶ ç‰¹ç‚¹ï¼š ç”¨ state å±žæ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼ˆåˆ†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼‰ï¼Œå­ç±»éœ€è¦å®šä¹‰å¦‚ä½•ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼ŒæŽ§åˆ¶å¦‚ä½•èŽ·å–é”å’Œé‡Šæ”¾é” getState - èŽ·å– state çŠ¶æ€ setState - è®¾ç½® state çŠ¶æ€ compareAndSetState - cas æœºåˆ¶è®¾ç½® state çŠ¶æ€ ç‹¬å æ¨¡å¼æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®èµ„æºï¼Œè€Œå…±äº«æ¨¡å¼å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®èµ„æº æä¾›äº†åŸºäºŽ FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äºŽ Monitor çš„ EntryList æ¡ä»¶å˜é‡æ¥å®žçŽ°ç­‰å¾…ã€å”¤é†’æœºåˆ¶ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œç±»ä¼¼äºŽ Monitor çš„ WaitSet å­ç±»ä¸»è¦å®žçŽ°è¿™æ ·ä¸€äº›æ–¹æ³•ï¼ˆé»˜è®¤æŠ›å‡º UnsupportedOperationExceptionï¼‰ tryAcquire tryRelease tryAcquireShared tryReleaseShared isHeldExclusively èŽ·å–é”çš„å§¿åŠ¿ 1234// å¦‚æžœèŽ·å–é”å¤±è´¥if (!tryAcquire(arg)) &#123; // å…¥é˜Ÿ, å¯ä»¥é€‰æ‹©é˜»å¡žå½“å‰çº¿ç¨‹ park unpark&#125; é‡Šæ”¾é”çš„å§¿åŠ¿ 1234// å¦‚æžœé‡Šæ”¾é”æˆåŠŸif (tryRelease(arg)) &#123; // è®©é˜»å¡žçº¿ç¨‹æ¢å¤è¿è¡Œ&#125; å®žçŽ°ä¸å¯é‡å…¥é”è‡ªå®šä¹‰åŒæ­¥å™¨12345678910111213141516171819202122232425262728293031final class MySync extends AbstractQueuedSynchronizer &#123; @Override protected boolean tryAcquire(int acquires) &#123; if (acquires == 1)&#123; if (compareAndSetState(0, 1)) &#123; setExclusiveOwnerThread(Thread.currentThread()); return true; &#125; &#125; return false; &#125; @Override protected boolean tryRelease(int acquires) &#123; if(acquires == 1) &#123; if(getState() == 0) &#123; throw new IllegalMonitorStateException(); &#125; setExclusiveOwnerThread(null); setState(0); return true; &#125; return false; &#125; protected Condition newCondition() &#123; return new ConditionObject(); &#125; @Override protected boolean isHeldExclusively() &#123; return getState() == 1; &#125;&#125; è‡ªå®šä¹‰é”æœ‰äº†è‡ªå®šä¹‰åŒæ­¥å™¨ï¼Œå¾ˆå®¹æ˜“å¤ç”¨ AQS ï¼Œå®žçŽ°ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„è‡ªå®šä¹‰é” 123456789101112131415161718192021222324252627282930313233class MyLock implements Lock &#123; static MySync sync = new MySync(); @Override // å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ— public void lock() &#123; sync.acquire(1); &#125; @Override // å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¯æ‰“æ–­ public void lockInterruptibly() throws InterruptedException &#123; sync.acquireInterruptibly(1); &#125; @Override // å°è¯•ä¸€æ¬¡ï¼Œä¸æˆåŠŸè¿”å›žï¼Œä¸è¿›å…¥é˜Ÿåˆ— public boolean tryLock() &#123; return sync.tryAcquire(1); &#125; @Override // å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œæœ‰æ—¶é™ public boolean tryLock(long time, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireNanos(1, unit.toNanos(time)); &#125; @Override // é‡Šæ”¾é” public void unlock() &#123; sync.release(1); &#125; @Override // ç”Ÿæˆæ¡ä»¶å˜é‡ public Condition newCondition() &#123; return sync.newCondition(); &#125;&#125; æµ‹è¯•ä¸€ä¸‹ 1234567891011121314151617181920MyLock lock = new MyLock();new Thread(() -&gt; &#123; lock.lock(); try &#123; log.debug(&quot;locking...&quot;); sleep(1); &#125; finally &#123; log.debug(&quot;unlocking...&quot;); lock.unlock(); &#125;&#125;,&quot;t1&quot;).start();new Thread(() -&gt; &#123; lock.lock(); try &#123; log.debug(&quot;locking...&quot;); &#125; finally &#123; log.debug(&quot;unlocking...&quot;); lock.unlock(); &#125;&#125;,&quot;t2&quot;).start(); è¾“å‡º 123422:29:28.727 c.TestAqs [t1] - locking...22:29:29.732 c.TestAqs [t1] - unlocking...22:29:29.732 c.TestAqs [t2] - locking...22:29:29.732 c.TestAqs [t2] - unlocking... ä¸å¯é‡å…¥æµ‹è¯• å¦‚æžœæ”¹ä¸ºä¸‹é¢ä»£ç ï¼Œä¼šå‘çŽ°è‡ªå·±ä¹Ÿä¼šè¢«æŒ¡ä½ï¼ˆåªä¼šæ‰“å°ä¸€æ¬¡ lockingï¼‰ 1234lock.lock();log.debug(&quot;locking...&quot;);lock.lock();log.debug(&quot;locking...&quot;) å¿ƒå¾—èµ·æºæ—©æœŸç¨‹åºå‘˜ä¼šè‡ªå·±é€šè¿‡ä¸€ç§åŒæ­¥å™¨åŽ»å®žçŽ°å¦ä¸€ç§ç›¸è¿‘çš„åŒæ­¥å™¨ï¼Œä¾‹å¦‚ç”¨å¯é‡å…¥é”åŽ»å®žçŽ°ä¿¡å·é‡ï¼Œæˆ–åä¹‹ã€‚è¿™æ˜¾ç„¶ä¸å¤Ÿä¼˜é›…ï¼ŒäºŽæ˜¯åœ¨ JSR166ï¼ˆjava è§„èŒƒææ¡ˆï¼‰ä¸­åˆ›å»ºäº† AQSï¼Œæä¾›äº†è¿™ç§é€šç”¨çš„åŒæ­¥å™¨æœºåˆ¶ã€‚ ç›®æ ‡AQS è¦å®žçŽ°çš„åŠŸèƒ½ç›®æ ‡ é˜»å¡žç‰ˆæœ¬èŽ·å–é” acquire å’Œéžé˜»å¡žçš„ç‰ˆæœ¬å°è¯•èŽ·å–é” tryAcquire èŽ·å–é”è¶…æ—¶æœºåˆ¶ é€šè¿‡æ‰“æ–­å–æ¶ˆæœºåˆ¶ ç‹¬å æœºåˆ¶åŠå…±äº«æœºåˆ¶ æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„ç­‰å¾…æœºåˆ¶ è¦å®žçŽ°çš„æ€§èƒ½ç›®æ ‡ Instead, the primary performance goal here is scalability: to predictably maintain efficiency even, or especially, when synchronizers are contended. è®¾è®¡AQS çš„åŸºæœ¬æ€æƒ³å…¶å®žå¾ˆç®€å• èŽ·å–é”çš„é€»è¾‘ 123456while(state çŠ¶æ€ä¸å…è®¸èŽ·å–) &#123; if(é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰æ­¤è¿›ç¨‹) &#123; å…¥é˜Ÿå¹¶é˜»å¡ž &#125;&#125;å½“å‰çº¿ç¨‹å‡ºé˜Ÿ é‡Šæ”¾é”çš„é€»è¾‘ 123if(state çŠ¶æ€å…è®¸äº†) &#123; æ¢å¤é˜»å¡žçš„çº¿ç¨‹(s)&#125; è¦ç‚¹ åŽŸå­ç»´æŠ¤ state çŠ¶æ€ é˜»å¡žåŠæ¢å¤çº¿ç¨‹ ç»´æŠ¤é˜Ÿåˆ— 1) stateè®¾è®¡ tate ä½¿ç”¨ volatile é…åˆ cas ä¿è¯å…¶ä¿®æ”¹æ—¶çš„åŽŸå­æ€§ state ä½¿ç”¨äº† 32bit int æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œå› ä¸ºå½“æ—¶ä½¿ç”¨ long åœ¨å¾ˆå¤šå¹³å°ä¸‹æµ‹è¯•çš„ç»“æžœå¹¶ä¸ç†æƒ³ 2) é˜»å¡žæ¢å¤è®¾è®¡ æ—©æœŸçš„æŽ§åˆ¶çº¿ç¨‹æš‚åœå’Œæ¢å¤çš„ api æœ‰ suspend å’Œ resumeï¼Œä½†å®ƒä»¬æ˜¯ä¸å¯ç”¨çš„ï¼Œå› ä¸ºå¦‚æžœå…ˆè°ƒç”¨çš„ resumeé‚£ä¹ˆ suspend å°†æ„ŸçŸ¥ä¸åˆ° è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ park &amp; unpark æ¥å®žçŽ°çº¿ç¨‹çš„æš‚åœå’Œæ¢å¤ï¼Œå…·ä½“åŽŸç†åœ¨ä¹‹å‰è®²è¿‡äº†ï¼Œå…ˆ unparkå†park ä¹Ÿæ²¡é—®é¢˜ park &amp; unpark æ˜¯é’ˆå¯¹çº¿ç¨‹çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŒæ­¥å™¨çš„ï¼Œå› æ­¤æŽ§åˆ¶ç²’åº¦æ›´ä¸ºç²¾ç»† park çº¿ç¨‹è¿˜å¯ä»¥é€šè¿‡ interrupt æ‰“æ–­ 3) é˜Ÿåˆ—è®¾è®¡ ç”¨äº† FIFO å…ˆå…¥å…ˆå‡ºé˜Ÿåˆ—ï¼Œå¹¶ä¸æ”¯æŒä¼˜å…ˆçº§é˜Ÿåˆ— è®¾è®¡æ—¶å€Ÿé‰´äº† CLH é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§å•å‘æ— é”é˜Ÿåˆ— 1234567891011121314graph LRsubgraph åˆå§‹head1(head) --&gt; Dumy1(Dumy)tail1(tail) --&gt; Dumy1endsubgraph æ–°èŠ‚ç‚¹head2(head) --&gt; Dumy2(Dumy)tail2(tail) --&gt; NodeNode -- &quot;prev&quot; --&gt; Dumy2endstyle Dumy1 fill:#f9f,stroke:#333,stroke-width:2pxstyle Dumy2 fill:#f9f,stroke:#333,stroke-width:2px é˜Ÿåˆ—ä¸­æœ‰ head å’Œ tail ä¸¤ä¸ªæŒ‡é’ˆèŠ‚ç‚¹ï¼Œéƒ½ç”¨ volatile ä¿®é¥°é…åˆ cas ä½¿ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ state ç»´æŠ¤èŠ‚ç‚¹çŠ¶æ€å…¥é˜Ÿä¼ªä»£ç ï¼Œåªéœ€è¦è€ƒè™‘ tail èµ‹å€¼çš„åŽŸå­æ€§ 12345do &#123; // åŽŸæ¥çš„ tail Node prev = tail; // ç”¨ cas åœ¨åŽŸæ¥ tail çš„åŸºç¡€ä¸Šæ”¹ä¸º node&#125; while(tail.compareAndSet(prev,node)) å‡ºé˜Ÿä¼ªä»£ç  123456// prev æ˜¯ä¸Šä¸€ä¸ªèŠ‚ç‚¹while (Node prev=node.prev).state != å”¤é†’çŠ¶æ€) &#123; &#125;// è®¾ç½®å¤´ç»“ç‚¹head = node; CLHå¥½å¤„ï¼š æ— é”ï¼Œä½¿ç”¨è‡ªæ—‹ å¿«é€Ÿï¼Œæ— é˜»å¡ž AQS åœ¨ä¸€äº›æ–¹é¢æ”¹è¿›äº†CLH 1234567891011121314151617181920private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; // é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰å…ƒç´  tail ä¸º null if (t == null) &#123; // å°† head ä»Ž null -&gt; dummy if (compareAndSetHead(new Node())) tail = head; &#125; else &#123; // å°† node çš„ prev è®¾ç½®ä¸ºåŽŸæ¥çš„ tail node.prev = t; // å°† tail ä»ŽåŽŸæ¥çš„ tail è®¾ç½®ä¸º node if (compareAndSetTail(t, node)) &#123; // åŽŸæ¥ tail çš„ next è®¾ç½®ä¸º node t.next = node; return t; &#125; &#125; &#125;&#125; ä¸»è¦ç”¨åˆ°ASQ çš„å¹¶å‘å·¥å…·ç±» 2.2 RenntrantLock åŽŸç† éžå…¬å¹³é”å®žçŽ°åŽŸç†åŠ é”è§£é”æµç¨‹å…ˆä»Žæž„é€ å™¨å¼€å§‹çœ‹ï¼Œé»˜è®¤ä¸ºéžå…¬å¹³é”å®žçŽ° 123public ReentrantLock() &#123; sync = new NonFairSync();&#125; NonfairSyncç»§æ‰¿è‡ªASQ æ²¡æœ‰ç«žäº‰æ—¶ ç¬¬å‡ºçŽ°æ—¶ä¸€ä¸ªç«žäº‰ Thread-1 æ‰§è¡Œäº† (1) CAS å°è¯•å°† state ç”± 0 æ”¹ä¸º 1ï¼Œç»“æžœå¤±è´¥ (2)è¿›å…¥ tryAcquire é€»è¾‘ï¼Œè¿™æ—¶ state å·²ç»æ˜¯1ï¼Œç»“æžœä»ç„¶å¤±è´¥ (3) æŽ¥ä¸‹æ¥è¿›å…¥ addWaiter é€»è¾‘ï¼Œæž„é€  Node é˜Ÿåˆ— å›¾ä¸­é»„è‰²ä¸‰è§’è¡¨ç¤ºè¯¥ Node çš„ waitStatus çŠ¶æ€ï¼Œå…¶ä¸­ 0 ä¸ºé»˜è®¤æ­£å¸¸çŠ¶æ€ Node çš„åˆ›å»ºæ˜¯æ‡’æƒ°çš„ å…¶ä¸­ç¬¬ä¸€ä¸ª Node ç§°ä¸º Dummyï¼ˆå“‘å…ƒï¼‰æˆ–å“¨å…µï¼Œç”¨æ¥å ä½ï¼Œå¹¶ä¸å…³è”çº¿ç¨‹ å½“å‰çº¿ç¨‹è¿›å…¥ acquireQueued é€»è¾‘ (1) acquireQueued ä¼šåœ¨ä¸€ä¸ªæ­»å¾ªçŽ¯ä¸­ä¸æ–­å°è¯•èŽ·å¾—é”ï¼Œå¤±è´¥åŽè¿›å…¥ park é˜»å¡ž(2) å¦‚æžœè‡ªå·±æ˜¯ç´§é‚»ç€ headï¼ˆæŽ’ç¬¬äºŒä½ï¼‰ï¼Œé‚£ä¹ˆå†æ¬¡ tryAcquire å°è¯•èŽ·å–é”ï¼Œå½“ç„¶è¿™æ—¶ state ä»ä¸º1ï¼Œå¤±è´¥(3) è¿›å…¥ shouldParkAfterFailedAcquire é€»è¾‘ï¼Œå°†å‰é©± nodeï¼Œå³ head çš„ waitStatus æ”¹ä¸º -1ï¼Œè¿™æ¬¡è¿”å›ž false (4) shouldParkAfterFailedAcquire æ‰§è¡Œå®Œæ¯•å›žåˆ° acquireQueued ï¼Œå†æ¬¡ tryAcquire å°è¯•èŽ·å–é”ï¼Œå½“ç„¶è¿™æ—¶state ä»ä¸º 1ï¼Œå¤±è´¥(5) å½“å†æ¬¡è¿›å…¥ shouldParkAfterFailedAcquire æ—¶ï¼Œè¿™æ—¶å› ä¸ºå…¶å‰é©± node çš„ waitStatus å·²ç»æ˜¯ -1ï¼Œè¿™æ¬¡è¿”å›žtrue(6) è¿›å…¥ parkAndCheckInterruptï¼Œ Thread-1 parkï¼ˆç°è‰²è¡¨ç¤ºï¼‰ å†æ¬¡æœ‰å¤šä¸ªçº¿ç¨‹ç»åŽ†ä¸Šè¿°è¿‡ç¨‹ç«žäº‰å¤±è´¥ï¼Œå˜æˆè¿™ä¸ªæ ·å­ Thread-0 é‡Šæ”¾é”ï¼Œè¿›å…¥ tryRelease æµç¨‹ï¼Œå¦‚æžœæˆåŠŸ è®¾ç½® exclusiveOwnerThread ä¸º null state = 0 å½“å‰é˜Ÿåˆ—ä¸ä¸º nullï¼Œå¹¶ä¸” head çš„ waitStatus = -1ï¼Œè¿›å…¥ unparkSuccessor æµç¨‹ æ‰¾åˆ°é˜Ÿåˆ—ä¸­ç¦» head æœ€è¿‘çš„ä¸€ä¸ª Nodeï¼ˆæ²¡å–æ¶ˆçš„ï¼‰ï¼Œunpark æ¢å¤å…¶è¿è¡Œï¼Œæœ¬ä¾‹ä¸­å³ä¸º Thread-1å›žåˆ° Thread-1 çš„ acquireQueued æµç¨‹ å¦‚æžœåŠ é”æˆåŠŸï¼ˆæ²¡æœ‰ç«žäº‰ï¼‰ï¼Œä¼šè®¾ç½® exclusiveOwnerThread ä¸º Thread-1ï¼Œstate = 1 head æŒ‡å‘åˆšåˆš Thread-1 æ‰€åœ¨çš„ Nodeï¼Œè¯¥ Node æ¸…ç©º Thread åŽŸæœ¬çš„ head å› ä¸ºä»Žé“¾è¡¨æ–­å¼€ï¼Œè€Œå¯è¢«åžƒåœ¾å›žæ”¶ å¦‚æžœè¿™æ—¶å€™æœ‰å…¶å®ƒçº¿ç¨‹æ¥ç«žäº‰ï¼ˆéžå…¬å¹³çš„ä½“çŽ°ï¼‰ï¼Œä¾‹å¦‚è¿™æ—¶æœ‰ Thread-4 æ¥äº† å¦‚æžœä¸å·§åˆè¢« Thread-4 å äº†å…ˆ Thread-4 è¢«è®¾ç½®ä¸º exclusiveOwnerThreadï¼Œstate = 1 Thread-1 å†æ¬¡è¿›å…¥ acquireQueued æµç¨‹ï¼ŒèŽ·å–é”å¤±è´¥ï¼Œé‡æ–°è¿›å…¥ park é˜»å¡ž åŠ é”æºç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147// Sync ç»§æ‰¿è‡ª AQSstatic final class NonfairSync extends Sync &#123; private static final long serialVersionUID = 7316153563782823691L; // åŠ é”å®žçŽ° final void lock() &#123; // é¦–å…ˆç”¨ cas å°è¯•ï¼ˆä»…å°è¯•ä¸€æ¬¡ï¼‰å°† state ä»Ž 0 æ”¹ä¸º 1, å¦‚æžœæˆåŠŸè¡¨ç¤ºèŽ·å¾—äº†ç‹¬å é” if (compareAndSetState(0, 1)) setExclusiveOwnerThread(Thread.currentThread()); else // å¦‚æžœå°è¯•å¤±è´¥ï¼Œè¿›å…¥ ãˆ  acquire(1); &#125; // ãˆ  AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final void acquire(int arg) &#123; // ãˆ¡ tryAcquire if ( !tryAcquire(arg) &amp;&amp; // å½“ tryAcquire è¿”å›žä¸º false æ—¶, å…ˆè°ƒç”¨ addWaiter ãˆ£, æŽ¥ç€ acquireQueued ãˆ¤ acquireQueued(addWaiter(Node.EXCLUSIVE), arg) ) &#123; selfInterrupt(); &#125; &#125; // ãˆ¡ è¿›å…¥ ãˆ¢ protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires); &#125; // ãˆ¢ Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); // å¦‚æžœè¿˜æ²¡æœ‰èŽ·å¾—é” if (c == 0) &#123; // å°è¯•ç”¨ cas èŽ·å¾—, è¿™é‡Œä½“çŽ°äº†éžå…¬å¹³æ€§: ä¸åŽ»æ£€æŸ¥ AQS é˜Ÿåˆ— if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; // å¦‚æžœå·²ç»èŽ·å¾—äº†é”, çº¿ç¨‹è¿˜æ˜¯å½“å‰çº¿ç¨‹, è¡¨ç¤ºå‘ç”Ÿäº†é”é‡å…¥ else if (current == getExclusiveOwnerThread()) &#123; // state++ int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; // èŽ·å–å¤±è´¥, å›žåˆ°è°ƒç”¨å¤„ return false; &#125; // ãˆ£ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private Node addWaiter(Node mode) &#123; // å°†å½“å‰çº¿ç¨‹å…³è”åˆ°ä¸€ä¸ª Node å¯¹è±¡ä¸Š, æ¨¡å¼ä¸ºç‹¬å æ¨¡å¼ Node node = new Node(Thread.currentThread(), mode); // å¦‚æžœ tail ä¸ä¸º null, cas å°è¯•å°† Node å¯¹è±¡åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨ Node pred = tail; if (pred != null) &#123; node.prev = pred; if (compareAndSetTail(pred, node)) &#123; // åŒå‘é“¾è¡¨ pred.next = node; return node; &#125; &#125; // å°è¯•å°† Node åŠ å…¥ AQS, è¿›å…¥ ãˆ¥ enq(node); return node; &#125; // ãˆ¥ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private Node enq(final Node node) &#123; for (;;) &#123; Node t = tail; if (t == null) &#123; // è¿˜æ²¡æœ‰, è®¾ç½® head ä¸ºå“¨å…µèŠ‚ç‚¹ï¼ˆä¸å¯¹åº”çº¿ç¨‹ï¼ŒçŠ¶æ€ä¸º 0ï¼‰ if (compareAndSetHead(new Node())) &#123; tail = head; &#125; &#125; else &#123; // cas å°è¯•å°† Node å¯¹è±¡åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨ node.prev = t; if (compareAndSetTail(t, node)) &#123; t.next = node; return t; &#125; &#125; &#125; &#125; // ãˆ¤ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); // ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯ head, è¡¨ç¤ºè½®åˆ°è‡ªå·±ï¼ˆå½“å‰çº¿ç¨‹å¯¹åº”çš„ nodeï¼‰äº†, å°è¯•èŽ·å– if (p == head &amp;&amp; tryAcquire(arg)) &#123; // èŽ·å–æˆåŠŸ, è®¾ç½®è‡ªå·±ï¼ˆå½“å‰çº¿ç¨‹å¯¹åº”çš„ nodeï¼‰ä¸º head setHead(node); // ä¸Šä¸€ä¸ªèŠ‚ç‚¹ help GC p.next = null; failed = false; // è¿”å›žä¸­æ–­æ ‡è®° false return interrupted; &#125; if ( // åˆ¤æ–­æ˜¯å¦åº”å½“ park, è¿›å…¥ ãˆ¦ shouldParkAfterFailedAcquire(p, node) &amp;&amp; // park ç­‰å¾…, æ­¤æ—¶ Node çš„çŠ¶æ€è¢«ç½®ä¸º Node.SIGNAL ãˆ§ parkAndCheckInterrupt() ) &#123; interrupted = true; &#125; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125; &#125; // ãˆ¦ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; // èŽ·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ int ws = pred.waitStatus; if (ws == Node.SIGNAL) &#123; // ä¸Šä¸€ä¸ªèŠ‚ç‚¹éƒ½åœ¨é˜»å¡ž, é‚£ä¹ˆè‡ªå·±ä¹Ÿé˜»å¡žå¥½äº† return true; &#125; // &gt; 0 è¡¨ç¤ºå–æ¶ˆçŠ¶æ€ if (ws &gt; 0) &#123; // ä¸Šä¸€ä¸ªèŠ‚ç‚¹å–æ¶ˆ, é‚£ä¹ˆé‡æž„åˆ é™¤å‰é¢æ‰€æœ‰å–æ¶ˆçš„èŠ‚ç‚¹, è¿”å›žåˆ°å¤–å±‚å¾ªçŽ¯é‡è¯• do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; // è¿™æ¬¡è¿˜æ²¡æœ‰é˜»å¡ž // ä½†ä¸‹æ¬¡å¦‚æžœé‡è¯•ä¸æˆåŠŸ, åˆ™éœ€è¦é˜»å¡žï¼Œè¿™æ—¶éœ€è¦è®¾ç½®ä¸Šä¸€ä¸ªèŠ‚ç‚¹çŠ¶æ€ä¸º Node.SIGNAL compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false; &#125; // ãˆ§ é˜»å¡žå½“å‰çº¿ç¨‹ private final boolean parkAndCheckInterrupt() &#123; LockSupport.park(this); return Thread.interrupted(); &#125;&#125; æ³¨æ„ æ˜¯å¦éœ€è¦ unpark æ˜¯ç”±å½“å‰èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹çš„ waitStatus == Node.SIGNAL æ¥å†³å®šï¼Œè€Œä¸æ˜¯æœ¬èŠ‚ç‚¹çš„ waitStatus å†³å®š è§£é”æºç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061// Sync ç»§æ‰¿è‡ª AQSstatic final class NonfairSync extends Sync &#123; // è§£é”å®žçŽ° public void unlock() &#123; sync.release(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final boolean release(int arg) &#123; // å°è¯•é‡Šæ”¾é”, è¿›å…¥ ãˆ  if (tryRelease(arg)) &#123; // é˜Ÿåˆ—å¤´èŠ‚ç‚¹ unpark Node h = head; if ( // é˜Ÿåˆ—ä¸ä¸º null h != null &amp;&amp; // waitStatus == Node.SIGNAL æ‰éœ€è¦ unpark h.waitStatus != 0 ) &#123; // unpark AQS ä¸­ç­‰å¾…çš„çº¿ç¨‹, è¿›å…¥ ãˆ¡ unparkSuccessor(h); &#125; return true; &#125; return false; &#125; // ãˆ  Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final boolean tryRelease(int releases) &#123; // state-- int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; // æ”¯æŒé”é‡å…¥, åªæœ‰ state å‡ä¸º 0, æ‰é‡Šæ”¾æˆåŠŸ if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free; &#125; // ãˆ¡ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private void unparkSuccessor(Node node) &#123; // å¦‚æžœçŠ¶æ€ä¸º Node.SIGNAL å°è¯•é‡ç½®çŠ¶æ€ä¸º 0 // ä¸æˆåŠŸä¹Ÿå¯ä»¥ int ws = node.waitStatus; if (ws &lt; 0) &#123; compareAndSetWaitStatus(node, ws, 0); &#125; // æ‰¾åˆ°éœ€è¦ unpark çš„èŠ‚ç‚¹, ä½†æœ¬èŠ‚ç‚¹ä»Ž AQS é˜Ÿåˆ—ä¸­è„±ç¦», æ˜¯ç”±å”¤é†’èŠ‚ç‚¹å®Œæˆçš„ Node s = node.next; // ä¸è€ƒè™‘å·²å–æ¶ˆçš„èŠ‚ç‚¹, ä»Ž AQS é˜Ÿåˆ—ä»ŽåŽè‡³å‰æ‰¾åˆ°é˜Ÿåˆ—æœ€å‰é¢éœ€è¦ unpark çš„èŠ‚ç‚¹ if (s == null || s.waitStatus &gt; 0) &#123; s = null; for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) if (t.waitStatus &lt;= 0) s = t; &#125; if (s != null) LockSupport.unpark(s.thread); &#125;&#125; å¯é‡å…¥åŽŸç†123456789101112131415161718192021222324252627282930313233343536373839static final class NonfairSync extends Sync &#123; // ... // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; // å¦‚æžœå·²ç»èŽ·å¾—äº†é”, çº¿ç¨‹è¿˜æ˜¯å½“å‰çº¿ç¨‹, è¡¨ç¤ºå‘ç”Ÿäº†é”é‡å…¥ else if (current == getExclusiveOwnerThread()) &#123; // state++ int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final boolean tryRelease(int releases) &#123; // state-- int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; // æ”¯æŒé”é‡å…¥, åªæœ‰ state å‡ä¸º 0, æ‰é‡Šæ”¾æˆåŠŸ if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); return free; &#125;&#125; å¯æ‰“æ–­åŽŸç†ä¸å¯æ‰“æ–­æ¨¡å¼åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå³ä½¿å®ƒè¢«æ‰“æ–­ï¼Œä»ä¼šé©»ç•™åœ¨ AQS é˜Ÿåˆ—ä¸­ï¼Œä¸€ç›´è¦ç­‰åˆ°èŽ·å¾—é”åŽæ–¹èƒ½å¾—çŸ¥è‡ªå·±è¢«æ‰“æ–­äº† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849// Sync ç»§æ‰¿è‡ª AQSstatic final class NonfairSync extends Sync &#123; // ... private final boolean parkAndCheckInterrupt() &#123; // å¦‚æžœæ‰“æ–­æ ‡è®°å·²ç»æ˜¯ true, åˆ™ park ä¼šå¤±æ•ˆ LockSupport.park(this); // interrupted ä¼šæ¸…é™¤æ‰“æ–­æ ‡è®° return Thread.interrupted(); &#125; final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; failed = false; // è¿˜æ˜¯éœ€è¦èŽ·å¾—é”åŽ, æ‰èƒ½è¿”å›žæ‰“æ–­çŠ¶æ€ return interrupted; &#125; if ( shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt() ) &#123; // å¦‚æžœæ˜¯å› ä¸º interrupt è¢«å”¤é†’, è¿”å›žæ‰“æ–­çŠ¶æ€ä¸º true interrupted = true; &#125; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125; &#125; public final void acquire(int arg) &#123; if ( !tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg) ) &#123; // å¦‚æžœæ‰“æ–­çŠ¶æ€ä¸º true selfInterrupt(); &#125; &#125; static void selfInterrupt() &#123; // é‡æ–°äº§ç”Ÿä¸€æ¬¡ä¸­æ–­ Thread.currentThread().interrupt(); &#125;&#125; æ‰“æ–­æ¨¡å¼12345678910111213141516171819202122232425262728293031323334static final class NonfairSync extends Sync &#123; public final void acquireInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); // å¦‚æžœæ²¡æœ‰èŽ·å¾—åˆ°é”, è¿›å…¥ ãˆ  if (!tryAcquire(arg)) doAcquireInterruptibly(arg); &#125; // ãˆ  å¯æ‰“æ–­çš„èŽ·å–é”æµç¨‹ private void doAcquireInterruptibly(int arg) throws InterruptedException &#123; final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try &#123; for (;;) &#123; final Node p = node.predecessor(); if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; return; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) &#123; // åœ¨ park è¿‡ç¨‹ä¸­å¦‚æžœè¢« interrupt ä¼šè¿›å…¥æ­¤ // è¿™æ—¶å€™æŠ›å‡ºå¼‚å¸¸, è€Œä¸ä¼šå†æ¬¡è¿›å…¥ for (;;) throw new InterruptedException(); &#125; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125; &#125;&#125; å…¬å¹³é”å®žçŽ°åŽŸç†1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950static final class FairSync extends Sync &#123; private static final long serialVersionUID = -3000897897090466540L; final void lock() &#123; acquire(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final void acquire(int arg) &#123; if ( !tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg) ) &#123; selfInterrupt(); &#125; &#125; // ä¸Žéžå…¬å¹³é”ä¸»è¦åŒºåˆ«åœ¨äºŽ tryAcquire æ–¹æ³•çš„å®žçŽ° protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; // å…ˆæ£€æŸ¥ AQS é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹, æ²¡æœ‰æ‰åŽ»ç«žäº‰ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error(&quot;Maximum lock count exceeded&quot;); setState(nextc); return true; &#125; return false; &#125; // ãˆ  AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final boolean hasQueuedPredecessors() &#123; Node t = tail; Node h = head; Node s; // h != t æ—¶è¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ‰ Node return h != t &amp;&amp; ( // (s = h.next) == null è¡¨ç¤ºé˜Ÿåˆ—ä¸­è¿˜æœ‰æ²¡æœ‰è€äºŒ (s = h.next) == null || // æˆ–è€…é˜Ÿåˆ—ä¸­è€äºŒçº¿ç¨‹ä¸æ˜¯æ­¤çº¿ç¨‹ s.thread != Thread.currentThread() ); &#125;&#125; æ¡ä»¶å˜é‡å®žçŽ°åŽŸç†æ¯ä¸ªæ¡ä»¶å˜é‡å…¶å®žå°±å¯¹åº”ç€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼Œå…¶å®žçŽ°ç±»æ˜¯ ConditionObject await æµç¨‹å¼€å§‹ Thread-0 æŒæœ‰é”ï¼Œè°ƒç”¨ awaitï¼Œè¿›å…¥ ConditionObject çš„ addConditionWaiter æµç¨‹åˆ›å»ºæ–°çš„ Node çŠ¶æ€ä¸º -2ï¼ˆNode.CONDITIONï¼‰ï¼Œå…³è” Thread-0ï¼ŒåŠ å…¥ç­‰å¾…é˜Ÿåˆ—å°¾éƒ¨ æŽ¥ä¸‹æ¥è¿›å…¥ AQS çš„ fullyRelease æµç¨‹ï¼Œé‡Šæ”¾åŒæ­¥å™¨ä¸Šçš„é” unpark AQS é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç«žäº‰é”ï¼Œå‡è®¾æ²¡æœ‰å…¶ä»–ç«žäº‰çº¿ç¨‹ï¼Œé‚£ä¹ˆ Thread-1 ç«žäº‰æˆåŠŸ signal æµç¨‹å‡è®¾ Thread-1 è¦æ¥å”¤é†’ Thread-0 è¿›å…¥ ConditionObject çš„ doSignal æµç¨‹ï¼Œå–å¾—ç­‰å¾…é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ª Nodeï¼Œå³ Thread-0 æ‰€åœ¨ Node firstWaiterå°±æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯firstWaiterçš„nextWaiterï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è„±ç¦»è¯¥é“¾è¡¨ç»“æž„ï¼ŒfirstWaiteræŒ‡å‘ä¸‹ä¸€ä¸ª lastWaiteræ€»æ˜¯æœ€åŽä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´åˆ°æ²¡æœ‰èŠ‚ç‚¹firstWaiterå’ŒlastWaiteréƒ½æŒ‡å‘null æ‰§è¡Œ transferForSignal æµç¨‹ï¼Œå°†è¯¥ Node åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨ï¼Œå°† Thread-0 çš„ waitStatus æ”¹ä¸º 0ï¼ŒThread-3 çš„ waitStatus æ”¹ä¸º -1 å¦‚æžœ Node èŠ‚ç‚¹è¿™æ—¶è¢« å–æ¶ˆï¼Œè¿™Node èŠ‚ç‚¹ä¸ä¼šå† signal ï¼Œä¼šé‡æ–°åŽ»æ‰§è¡Œ åœ¨ ConditionObjectä¸­ çš„ firstWaiterçš„doSignal æµç¨‹ Thread-1 é‡Šæ”¾é” å¦‚æžœ æ–°åŠ å…¥çš„Node çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ ç”±äºŽ è¢«å–æ¶ˆæˆ–è€…è¶…æ—¶ï¼Œä¼šä¼˜å…ˆå°† Node èŠ‚ç‚¹ æ¢å¤ä¸º(è°ƒç”¨unpark) è¿è¡Œ å…¶ä»–æƒ…å†µæŒ‰ç…§ AQS èŠ‚ç‚¹ä¼˜å…ˆé¡ºåº åŽ» æ‰§è¡Œ æºç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219public class ConditionObject implements Condition, java.io.Serializable &#123; private static final long serialVersionUID = 1173984872572414699L; // ç¬¬ä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹ private transient Node firstWaiter; // æœ€åŽä¸€ä¸ªç­‰å¾…èŠ‚ç‚¹ private transient Node lastWaiter; public ConditionObject() &#123; &#125; // ãˆ  æ·»åŠ ä¸€ä¸ª Node è‡³ç­‰å¾…é˜Ÿåˆ— private Node addConditionWaiter() &#123; Node t = lastWaiter; // æ‰€æœ‰å·²å–æ¶ˆçš„ Node ä»Žé˜Ÿåˆ—é“¾è¡¨åˆ é™¤, è§ ãˆ¡ if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) &#123; unlinkCancelledWaiters(); t = lastWaiter; &#125; // åˆ›å»ºä¸€ä¸ªå…³è”å½“å‰çº¿ç¨‹çš„æ–° Node, æ·»åŠ è‡³é˜Ÿåˆ—å°¾éƒ¨ Node node = new Node(Thread.currentThread(), Node.CONDITION); if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node; &#125; // å”¤é†’ - å°†æ²¡å–æ¶ˆçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è½¬ç§»è‡³ AQS é˜Ÿåˆ— private void doSignal(Node first) &#123; do &#123; // å·²ç»æ˜¯å°¾èŠ‚ç‚¹äº† if ( (firstWaiter = first.nextWaiter) == null) &#123; lastWaiter = null; &#125; first.nextWaiter = null; &#125; while ( // å°†ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ Node è½¬ç§»è‡³ AQS é˜Ÿåˆ—, ä¸æˆåŠŸä¸”è¿˜æœ‰èŠ‚ç‚¹åˆ™ç»§ç»­å¾ªçŽ¯ ãˆ¢ !transferForSignal(first) &amp;&amp; // é˜Ÿåˆ—è¿˜æœ‰èŠ‚ç‚¹ (first = firstWaiter) != null ); &#125; // å¤–éƒ¨ç±»æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ // ãˆ¢ å¦‚æžœèŠ‚ç‚¹çŠ¶æ€æ˜¯å–æ¶ˆ, è¿”å›ž false è¡¨ç¤ºè½¬ç§»å¤±è´¥, å¦åˆ™è½¬ç§»æˆåŠŸ final boolean transferForSignal(Node node) &#123; // å¦‚æžœçŠ¶æ€å·²ç»ä¸æ˜¯ Node.CONDITION, è¯´æ˜Žè¢«å–æ¶ˆäº† if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) return false; // åŠ å…¥ AQS é˜Ÿåˆ—å°¾éƒ¨ Node p = enq(node); int ws = p.waitStatus; if ( // ä¸Šä¸€ä¸ªèŠ‚ç‚¹è¢«å–æ¶ˆ ws &gt; 0 || // ä¸Šä¸€ä¸ªèŠ‚ç‚¹ä¸èƒ½è®¾ç½®çŠ¶æ€ä¸º Node.SIGNAL !compareAndSetWaitStatus(p, ws, Node.SIGNAL) ) &#123; // unpark å–æ¶ˆé˜»å¡ž, è®©çº¿ç¨‹é‡æ–°åŒæ­¥çŠ¶æ€ LockSupport.unpark(node.thread); &#125; return true; &#125; // å…¨éƒ¨å”¤é†’ - ç­‰å¾…é˜Ÿåˆ—çš„æ‰€æœ‰èŠ‚ç‚¹è½¬ç§»è‡³ AQS é˜Ÿåˆ— private void doSignalAll(Node first) &#123; lastWaiter = firstWaiter = null; do &#123; Node next = first.nextWaiter; first.nextWaiter = null; transferForSignal(first); first = next; &#125; while (first != null); &#125; // ãˆ¡ private void unlinkCancelledWaiters() &#123; // ... &#125; // å”¤é†’ - å¿…é¡»æŒæœ‰é”æ‰èƒ½å”¤é†’, å› æ­¤ doSignal å†…æ— éœ€è€ƒè™‘åŠ é” public final void signal() &#123; if (!isHeldExclusively()) throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignal(first); &#125; // å…¨éƒ¨å”¤é†’ - å¿…é¡»æŒæœ‰é”æ‰èƒ½å”¤é†’, å› æ­¤ doSignalAll å†…æ— éœ€è€ƒè™‘åŠ é” public final void signalAll() &#123; if (!isHeldExclusively()) throw new IllegalMonitorStateException(); Node first = firstWaiter; if (first != null) doSignalAll(first); &#125; // ä¸å¯æ‰“æ–­ç­‰å¾… - ç›´åˆ°è¢«å”¤é†’ public final void awaitUninterruptibly() &#123; // æ·»åŠ ä¸€ä¸ª Node è‡³ç­‰å¾…é˜Ÿåˆ—, è§ ãˆ  Node node = addConditionWaiter(); // é‡Šæ”¾èŠ‚ç‚¹æŒæœ‰çš„é”, è§ ãˆ£ int savedState = fullyRelease(node); boolean interrupted = false; // å¦‚æžœè¯¥èŠ‚ç‚¹è¿˜æ²¡æœ‰è½¬ç§»è‡³ AQS é˜Ÿåˆ—, é˜»å¡ž while (!isOnSyncQueue(node)) &#123; // park é˜»å¡ž LockSupport.park(this); // å¦‚æžœè¢«æ‰“æ–­, ä»…è®¾ç½®æ‰“æ–­çŠ¶æ€ if (Thread.interrupted()) interrupted = true; &#125; // å”¤é†’åŽ, å°è¯•ç«žäº‰é”, å¦‚æžœå¤±è´¥è¿›å…¥ AQS é˜Ÿåˆ— if (acquireQueued(node, savedState) || interrupted) selfInterrupt(); &#125; // å¤–éƒ¨ç±»æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ // ãˆ£ å› ä¸ºæŸçº¿ç¨‹å¯èƒ½é‡å…¥ï¼Œéœ€è¦å°† state å…¨éƒ¨é‡Šæ”¾ final int fullyRelease(Node node) &#123; boolean failed = true; try &#123; int savedState = getState(); if (release(savedState)) &#123; failed = false; return savedState; &#125; else &#123; throw new IllegalMonitorStateException(); &#125; &#125; finally &#123; if (failed) node.waitStatus = Node.CANCELLED; &#125; &#125; // æ‰“æ–­æ¨¡å¼ - åœ¨é€€å‡ºç­‰å¾…æ—¶é‡æ–°è®¾ç½®æ‰“æ–­çŠ¶æ€ private static final int REINTERRUPT = 1; // æ‰“æ–­æ¨¡å¼ - åœ¨é€€å‡ºç­‰å¾…æ—¶æŠ›å‡ºå¼‚å¸¸ private static final int THROW_IE = -1; // åˆ¤æ–­æ‰“æ–­æ¨¡å¼ private int checkInterruptWhileWaiting(Node node) &#123; return Thread.interrupted() ? (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) : 0; &#125; // ãˆ¤ åº”ç”¨æ‰“æ–­æ¨¡å¼ private void reportInterruptAfterWait(int interruptMode) throws InterruptedException &#123; if (interruptMode == THROW_IE) throw new InterruptedException(); else if (interruptMode == REINTERRUPT) selfInterrupt(); &#125; // ç­‰å¾… - ç›´åˆ°è¢«å”¤é†’æˆ–æ‰“æ–­ public final void await() throws InterruptedException &#123; if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; // æ·»åŠ ä¸€ä¸ª Node è‡³ç­‰å¾…é˜Ÿåˆ—, è§ ãˆ  Node node = addConditionWaiter(); // é‡Šæ”¾èŠ‚ç‚¹æŒæœ‰çš„é” int savedState = fullyRelease(node); int interruptMode = 0; // å¦‚æžœè¯¥èŠ‚ç‚¹è¿˜æ²¡æœ‰è½¬ç§»è‡³ AQS é˜Ÿåˆ—, é˜»å¡ž while (!isOnSyncQueue(node)) &#123; // park é˜»å¡ž LockSupport.park(this); // å¦‚æžœè¢«æ‰“æ–­, é€€å‡ºç­‰å¾…é˜Ÿåˆ— if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; &#125; // é€€å‡ºç­‰å¾…é˜Ÿåˆ—åŽ, è¿˜éœ€è¦èŽ·å¾— AQS é˜Ÿåˆ—çš„é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; // æ‰€æœ‰å·²å–æ¶ˆçš„ Node ä»Žé˜Ÿåˆ—é“¾è¡¨åˆ é™¤, è§ ãˆ¡ if (node.nextWaiter != null) unlinkCancelledWaiters(); // åº”ç”¨æ‰“æ–­æ¨¡å¼, è§ ãˆ¤ if (interruptMode != 0) reportInterruptAfterWait(interruptMode); &#125; // ç­‰å¾… - ç›´åˆ°è¢«å”¤é†’æˆ–æ‰“æ–­æˆ–è¶…æ—¶ public final long awaitNanos(long nanosTimeout) throws InterruptedException &#123; if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; // æ·»åŠ ä¸€ä¸ª Node è‡³ç­‰å¾…é˜Ÿåˆ—, è§ ãˆ  Node node = addConditionWaiter(); // é‡Šæ”¾èŠ‚ç‚¹æŒæœ‰çš„é” int savedState = fullyRelease(node); // èŽ·å¾—æœ€åŽæœŸé™ final long deadline = System.nanoTime() + nanosTimeout; int interruptMode = 0; // å¦‚æžœè¯¥èŠ‚ç‚¹è¿˜æ²¡æœ‰è½¬ç§»è‡³ AQS é˜Ÿåˆ—, é˜»å¡ž while (!isOnSyncQueue(node)) &#123; // å·²è¶…æ—¶, é€€å‡ºç­‰å¾…é˜Ÿåˆ— if (nanosTimeout &lt;= 0L) &#123; transferAfterCancelledWait(node); break; &#125; // park é˜»å¡žä¸€å®šæ—¶é—´, spinForTimeoutThreshold ä¸º 1000 ns if (nanosTimeout &gt;= spinForTimeoutThreshold) LockSupport.parkNanos(this, nanosTimeout); // å¦‚æžœè¢«æ‰“æ–­, é€€å‡ºç­‰å¾…é˜Ÿåˆ— if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) break; nanosTimeout = deadline - System.nanoTime(); &#125; // é€€å‡ºç­‰å¾…é˜Ÿåˆ—åŽ, è¿˜éœ€è¦èŽ·å¾— AQS é˜Ÿåˆ—çš„é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) interruptMode = REINTERRUPT; // æ‰€æœ‰å·²å–æ¶ˆçš„ Node ä»Žé˜Ÿåˆ—é“¾è¡¨åˆ é™¤, è§ ãˆ¡ if (node.nextWaiter != null) unlinkCancelledWaiters(); // åº”ç”¨æ‰“æ–­æ¨¡å¼, è§ ãˆ¤ if (interruptMode != 0) reportInterruptAfterWait(interruptMode); return deadline - System.nanoTime(); &#125; // ç­‰å¾… - ç›´åˆ°è¢«å”¤é†’æˆ–æ‰“æ–­æˆ–è¶…æ—¶, é€»è¾‘ç±»ä¼¼äºŽ awaitNanos public final boolean awaitUntil(Date deadline) throws InterruptedException &#123; // ... &#125; // ç­‰å¾… - ç›´åˆ°è¢«å”¤é†’æˆ–æ‰“æ–­æˆ–è¶…æ—¶, é€»è¾‘ç±»ä¼¼äºŽ awaitNanos public final boolean await(long time, TimeUnit unit) throws InterruptedException &#123; // ... &#125; // å·¥å…·æ–¹æ³• çœç•¥ ...&#125; 2.3 è¯»å†™é”ReentrantReadWriteLockå½“è¯»æ“ä½œè¿œè¿œé«˜äºŽå†™æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ä½¿ç”¨ è¯»å†™é” è®© è¯»-è¯» å¯ä»¥å¹¶å‘ï¼Œæé«˜æ€§èƒ½ã€‚ ç±»ä¼¼äºŽæ•°æ®åº“ä¸­çš„ select ... from ... lock in share mode æä¾›ä¸€ä¸ª æ•°æ®å®¹å™¨ç±» å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ write() æ–¹æ³• 1234567891011121314151617181920212223242526272829class DataContainer &#123; private Object data; private ReentrantReadWriteLock rw = new ReentrantReadWriteLock(); private ReentrantReadWriteLock.ReadLock r = rw.readLock(); private ReentrantReadWriteLock.WriteLock w = rw.writeLock(); public Object read() &#123; log.debug(&quot;èŽ·å–è¯»é”...&quot;); r.lock(); try &#123; log.debug(&quot;è¯»å–&quot;); sleep(1); return data; &#125; finally &#123; log.debug(&quot;é‡Šæ”¾è¯»é”...&quot;); r.unlock(); &#125; &#125; public void write() &#123; log.debug(&quot;èŽ·å–å†™é”...&quot;); w.lock(); try &#123; log.debug(&quot;å†™å…¥&quot;); sleep(1); &#125; finally &#123; log.debug(&quot;é‡Šæ”¾å†™é”...&quot;); w.unlock(); &#125; &#125;&#125; æµ‹è¯• è¯»é”-è¯»é” å¯ä»¥å¹¶å‘ 1234567DataContainer dataContainer = new DataContainer();new Thread(() -&gt; &#123; dataContainer.read();&#125;, &quot;t1&quot;).start();new Thread(() -&gt; &#123; dataContainer.read();&#125;, &quot;t2&quot;).start() è¾“å‡ºç»“æžœï¼Œä»Žè¿™é‡Œå¯ä»¥çœ‹åˆ° Thread-0 é”å®šæœŸé—´ï¼ŒThread-1 çš„è¯»æ“ä½œä¸å—å½±å“ 12345614:05:14.341 c.DataContainer [t2] - èŽ·å–è¯»é”...14:05:14.341 c.DataContainer [t1] - èŽ·å–è¯»é”...14:05:14.345 c.DataContainer [t1] - è¯»å–14:05:14.345 c.DataContainer [t2] - è¯»å–14:05:15.365 c.DataContainer [t2] - é‡Šæ”¾è¯»é”...14:05:15.386 c.DataContainer [t1] - é‡Šæ”¾è¯»é”... æµ‹è¯• è¯»é”-å†™é” ç›¸äº’é˜»å¡ž 12345678DataContainer dataContainer = new DataContainer();new Thread(() -&gt; &#123; dataContainer.read();&#125;, &quot;t1&quot;).start();Thread.sleep(100);new Thread(() -&gt; &#123; dataContainer.write();&#125;, &quot;t2&quot;).start(); è¾“å‡ºç»“æžœ 12345614:04:21.838 c.DataContainer [t1] - èŽ·å–è¯»é”...14:04:21.838 c.DataContainer [t2] - èŽ·å–å†™é”...14:04:21.841 c.DataContainer [t2] - å†™å…¥14:04:22.843 c.DataContainer [t2] - é‡Šæ”¾å†™é”...14:04:22.843 c.DataContainer [t1] - è¯»å–14:04:23.843 c.DataContainer [t1] - é‡Šæ”¾è¯»é”... å†™é”-å†™é” ä¹Ÿæ˜¯ç›¸äº’é˜»å¡žçš„ï¼Œè¿™é‡Œå°±ä¸æµ‹è¯•äº† æ³¨æ„äº‹é¡¹ è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡ é‡å…¥æ—¶å‡çº§ä¸æ”¯æŒï¼šå³æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹åŽ»èŽ·å–å†™é”ï¼Œä¼šå¯¼è‡´èŽ·å–å†™é”æ°¸ä¹…ç­‰å¾… 123456789101112r.lock();try &#123;// ...w.lock();try &#123;// ...&#125; finally&#123;w.unlock();&#125;&#125; finally&#123;r.unlock();&#125; é‡å…¥æ—¶é™çº§æ”¯æŒï¼šå³æŒæœ‰å†™é”çš„æƒ…å†µä¸‹åŽ»èŽ·å–è¯»é” 12345678910111213141516171819202122232425262728293031class CachedData &#123; Object data; // æ˜¯å¦æœ‰æ•ˆï¼Œå¦‚æžœå¤±æ•ˆï¼Œéœ€è¦é‡æ–°è®¡ç®— data volatile boolean cacheValid; final ReentrantReadWriteLock rwl = new ReentrantReadWriteLock(); void processCachedData() &#123; rwl.readLock().lock(); if (!cacheValid) &#123; // èŽ·å–å†™é”å‰å¿…é¡»é‡Šæ”¾è¯»é” rwl.readLock().unlock(); rwl.writeLock().lock(); try &#123; // åˆ¤æ–­æ˜¯å¦æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»èŽ·å–äº†å†™é”ã€æ›´æ–°äº†ç¼“å­˜, é¿å…é‡å¤æ›´æ–° if (!cacheValid) &#123; data = ... cacheValid = true; &#125; // é™çº§ä¸ºè¯»é”, é‡Šæ”¾å†™é”, è¿™æ ·èƒ½å¤Ÿè®©å…¶å®ƒçº¿ç¨‹è¯»å–ç¼“å­˜ rwl.readLock().lock(); &#125; finally &#123; rwl.writeLock().unlock(); &#125; &#125; // è‡ªå·±ç”¨å®Œæ•°æ®, é‡Šæ”¾è¯»é” try &#123; use(data); &#125; finally &#123; rwl.readLock().unlock(); &#125; &#125;&#125; åº”ç”¨ä¹‹ç¼“å­˜ç¼“å­˜æ›´æ–°ç­–ç•¥æ›´æ–°æ—¶ï¼Œæ˜¯å…ˆæ¸…ç¼“å­˜è¿˜æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ å…ˆæ¸…ç¼“å­˜ å…ˆæ›´æ–°æ•°æ®åº“ è¡¥å……ä¸€ç§æƒ…å†µï¼Œå‡è®¾æŸ¥è¯¢çº¿ç¨‹ A æŸ¥è¯¢æ•°æ®æ—¶æ°å¥½ç¼“å­˜æ•°æ®ç”±äºŽæ—¶é—´åˆ°æœŸå¤±æ•ˆï¼Œæˆ–æ˜¯ç¬¬ä¸€æ¬¡æŸ¥è¯¢ è¿™ç§æƒ…å†µçš„å‡ºçŽ°å‡ çŽ‡éžå¸¸å°ï¼Œè§ facebook è®ºæ–‡ è¯»å†™é”ä¸€è‡´æ€§ç¼“å­˜ä½¿ç”¨è¯»å†™é”å®žçŽ°ä¸€ä¸ªç®€å•çš„æŒ‰éœ€åŠ è½½ç¼“å­˜ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273class GenericCachedDao&lt;T&gt; &#123; // HashMap ä½œä¸ºç¼“å­˜éžçº¿ç¨‹å®‰å…¨, éœ€è¦ä¿æŠ¤ HashMap&lt;SqlPair, T&gt; map = new HashMap&lt;&gt;(); ReentrantReadWriteLock lock = new ReentrantReadWriteLock(); GenericDao genericDao = new GenericDao(); public int update(String sql, Object... params) &#123; SqlPair key = new SqlPair(sql, params); // åŠ å†™é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜è¯»å–å’Œæ›´æ”¹ lock.writeLock().lock(); try &#123; int rows = genericDao.update(sql, params); map.clear(); return rows; &#125; finally &#123; lock.writeLock().unlock(); &#125; &#125; public T queryOne(Class&lt;T&gt; beanClass, String sql, Object... params) &#123; SqlPair key = new SqlPair(sql, params); // åŠ è¯»é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜æ›´æ”¹ lock.readLock().lock(); try &#123; T value = map.get(key); if (value != null) &#123; return value; &#125; &#125; finally &#123; lock.readLock().unlock(); &#125; // åŠ å†™é”, é˜²æ­¢å…¶å®ƒçº¿ç¨‹å¯¹ç¼“å­˜è¯»å–å’Œæ›´æ”¹ lock.writeLock().lock(); try &#123; // get æ–¹æ³•ä¸Šé¢éƒ¨åˆ†æ˜¯å¯èƒ½å¤šä¸ªçº¿ç¨‹è¿›æ¥çš„, å¯èƒ½å·²ç»å‘ç¼“å­˜å¡«å……äº†æ•°æ® // ä¸ºé˜²æ­¢é‡å¤æŸ¥è¯¢æ•°æ®åº“, å†æ¬¡éªŒè¯ T value = map.get(key); if (value == null) &#123; // å¦‚æžœæ²¡æœ‰, æŸ¥è¯¢æ•°æ®åº“ value = genericDao.queryOne(beanClass, sql, params); map.put(key, value); &#125; return value; &#125; finally &#123; lock.writeLock().unlock(); &#125; &#125; // ä½œä¸º key ä¿è¯å…¶æ˜¯ä¸å¯å˜çš„ class SqlPair &#123; private String sql; private Object[] params; public SqlPair(String sql, Object[] params) &#123; this.sql = sql; this.params = params; &#125; @Override public boolean equals(Object o) &#123; if (this == o) &#123; return true; &#125; if (o == null || getClass() != o.getClass()) &#123; return false; &#125; SqlPair sqlPair = (SqlPair) o; return sql.equals(sqlPair.sql) &amp;&amp; Arrays.equals(params, sqlPair.params); &#125; @Override public int hashCode() &#123; int result = Objects.hash(sql); result = 31 * result + Arrays.hashCode(params); return result; &#125; &#125;&#125; æ³¨æ„ ä»¥ä¸Šå®žçŽ°ä½“çŽ°çš„æ˜¯è¯»å†™é”çš„åº”ç”¨ï¼Œä¿è¯ç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œä½†æœ‰ä¸‹é¢çš„é—®é¢˜æ²¡æœ‰è€ƒè™‘ é€‚åˆè¯»å¤šå†™å°‘ï¼Œå¦‚æžœå†™æ“ä½œæ¯”è¾ƒé¢‘ç¹ï¼Œä»¥ä¸Šå®žçŽ°æ€§èƒ½ä½Ž æ²¡æœ‰è€ƒè™‘ç¼“å­˜å®¹é‡ æ²¡æœ‰è€ƒè™‘ç¼“å­˜è¿‡æœŸ åªé€‚åˆå•æœº å¹¶å‘æ€§è¿˜æ˜¯ä½Žï¼Œç›®å‰åªä¼šç”¨ä¸€æŠŠé” æ›´æ–°æ–¹æ³•å¤ªè¿‡ç®€å•ç²—æš´ï¼Œæ¸…ç©ºäº†æ‰€æœ‰ keyï¼ˆè€ƒè™‘æŒ‰ç±»åž‹åˆ†åŒºæˆ–é‡æ–°è®¾è®¡ keyï¼‰ ä¹è§‚é”å®žçŽ°ï¼šç”¨ CAS åŽ»æ›´æ–° è¯»å†™é”åŽŸç†(1) å›¾è§£æµç¨‹è¯»å†™é”ç”¨çš„æ˜¯åŒä¸€ä¸ª Sycn åŒæ­¥å™¨ï¼Œå› æ­¤ç­‰å¾…é˜Ÿåˆ—ã€state ç­‰ä¹Ÿæ˜¯åŒä¸€ä¸ª t1 w.lockï¼Œt2 r.lock(1) t1 æˆåŠŸä¸Šé”ï¼Œæµç¨‹ä¸Ž ReentrantLock åŠ é”ç›¸æ¯”æ²¡æœ‰ç‰¹æ®Šä¹‹å¤„ï¼Œä¸åŒæ˜¯å†™é”çŠ¶æ€å äº† state çš„ä½Ž 16 ä½ï¼Œè€Œè¯»é”ä½¿ç”¨çš„æ˜¯ state çš„é«˜ 16 ä½ (2) t2 æ‰§è¡Œ r.lockï¼Œè¿™æ—¶è¿›å…¥è¯»é”çš„ sync.acquireShared(1) æµç¨‹ï¼Œé¦–å…ˆä¼šè¿›å…¥ tryAcquireShared æµç¨‹ã€‚å¦‚æžœæœ‰å†™é”å æ®ï¼Œé‚£ä¹ˆ tryAcquireShared è¿”å›ž -1 è¡¨ç¤ºå¤±è´¥ tryAcquireShared è¿”å›žå€¼è¡¨ç¤º -1 è¡¨ç¤ºå¤±è´¥ 0 è¡¨ç¤ºæˆåŠŸï¼Œä½†åŽç»§èŠ‚ç‚¹ä¸ä¼šç»§ç»­å”¤é†’ æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œè€Œä¸”æ•°å€¼æ˜¯è¿˜æœ‰å‡ ä¸ªåŽç»§èŠ‚ç‚¹éœ€è¦å”¤é†’ï¼Œè¯»å†™é”è¿”å›ž 1 (3) è¿™æ—¶ä¼šè¿›å…¥ sync.doAcquireShared(1) æµç¨‹ï¼Œé¦–å…ˆä¹Ÿæ˜¯è°ƒç”¨ addWaiter æ·»åŠ èŠ‚ç‚¹ï¼Œä¸åŒä¹‹å¤„åœ¨äºŽèŠ‚ç‚¹è¢«è®¾ç½®ä¸º Node.SHARED æ¨¡å¼è€Œéž Node.EXCLUSIVE æ¨¡å¼ï¼Œæ³¨æ„æ­¤æ—¶ t2 ä»å¤„äºŽæ´»è·ƒçŠ¶æ€ (4) t2 ä¼šçœ‹çœ‹è‡ªå·±çš„èŠ‚ç‚¹æ˜¯ä¸æ˜¯è€äºŒï¼Œå¦‚æžœæ˜¯ï¼Œè¿˜ä¼šå†æ¬¡è°ƒç”¨ tryAcquireShared(1) æ¥å°è¯•èŽ·å–é” (5) å¦‚æžœæ²¡æœ‰æˆåŠŸï¼Œåœ¨ doAcquireShared å†… for (;;) å¾ªçŽ¯ä¸€æ¬¡ï¼ŒæŠŠå‰é©±èŠ‚ç‚¹çš„ waitStatus æ”¹ä¸º -1ï¼Œå† for (;;) å¾ªçŽ¯ä¸€æ¬¡å°è¯• tryAcquireShared(1) å¦‚æžœè¿˜ä¸æˆåŠŸï¼Œ(æ€»å…±å°è¯•äº†ä¸‰æ¬¡tryAcquireShared) é‚£ä¹ˆåœ¨ parkAndCheckInterrupt() å¤„ park t3 r.lockï¼Œt4 w.lockè¿™ç§çŠ¶æ€ä¸‹ï¼Œå‡è®¾åˆæœ‰ t3 åŠ è¯»é”å’Œ t4 åŠ å†™é”ï¼Œè¿™æœŸé—´ t1 ä»ç„¶æŒæœ‰é”ï¼Œå°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ 1 w.unlockè¿™æ—¶ä¼šèµ°åˆ°å†™é”çš„ sync.release(1) æµç¨‹ï¼Œè°ƒç”¨ sync.tryRelease(1) æˆåŠŸï¼Œå˜æˆä¸‹é¢çš„æ ·å­ æŽ¥ä¸‹æ¥æ‰§è¡Œå”¤é†’æµç¨‹ sync.unparkSuccessorï¼Œå³è®©è€äºŒæ¢å¤è¿è¡Œï¼Œè¿™æ—¶ t2 åœ¨ doAcquireShared å†… parkAndCheckInterrupt() å¤„æ¢å¤è¿è¡Œ è¿™å›žå†æ¥ä¸€æ¬¡ for (;;) æ‰§è¡Œ tryAcquireShared æˆåŠŸåˆ™è®©è¯»é”è®¡æ•°åŠ ä¸€ è¿™æ—¶ t2 å·²ç»æ¢å¤è¿è¡Œï¼ŒæŽ¥ä¸‹æ¥ t2 è°ƒç”¨ setHeadAndPropagate(node, 1)ï¼Œå®ƒåŽŸæœ¬æ‰€åœ¨èŠ‚ç‚¹è¢«ç½®ä¸ºå¤´èŠ‚ç‚¹ äº‹æƒ…è¿˜æ²¡å®Œï¼Œåœ¨ setHeadAndPropagate æ–¹æ³•å†…è¿˜ä¼šæ£€æŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ sharedï¼Œå¦‚æžœæ˜¯åˆ™è°ƒç”¨ doReleaseShared() å°† head çš„çŠ¶æ€ä»Ž -1 æ”¹ä¸º 0 å¹¶å”¤é†’è€äºŒï¼Œè¿™æ—¶ t3 åœ¨ doAcquireShared å†… parkAndCheckInterrupt() å¤„æ¢å¤è¿è¡Œ è¿™å›žå†æ¥ä¸€æ¬¡ for (;;) æ‰§è¡Œ tryAcquireShared æˆåŠŸåˆ™è®©è¯»é”è®¡æ•°åŠ ä¸€ è¿™æ—¶ t3 å·²ç»æ¢å¤è¿è¡Œï¼ŒæŽ¥ä¸‹æ¥ t3 è°ƒç”¨ setHeadAndPropagate(node, 1)ï¼Œå®ƒåŽŸæœ¬æ‰€åœ¨èŠ‚ç‚¹è¢«ç½®ä¸ºå¤´èŠ‚ç‚¹ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸æ˜¯ shared äº†ï¼Œå› æ­¤ä¸ä¼šç»§ç»­å”¤é†’ t4 æ‰€åœ¨èŠ‚ç‚¹ t2 r.unlockï¼Œt3 r.unlockt2 è¿›å…¥ sync.releaseShared(1) ä¸­ï¼Œè°ƒç”¨ tryReleaseShared(1) è®©è®¡æ•°å‡ä¸€ï¼Œä½†ç”±äºŽè®¡æ•°è¿˜ä¸ä¸ºé›¶ t3 è¿›å…¥ sync.releaseShared(1) ä¸­ï¼Œè°ƒç”¨ tryReleaseShared(1) è®©è®¡æ•°å‡ä¸€ï¼Œè¿™å›žè®¡æ•°ä¸ºé›¶äº†ï¼Œè¿›å…¥ doReleaseShared() å°†å¤´èŠ‚ç‚¹ä»Ž -1 æ”¹ä¸º 0 å¹¶å”¤é†’è€äºŒï¼Œå³ ä¹‹åŽ t4 åœ¨ acquireQueued ä¸­ parkAndCheckInterrupt å¤„æ¢å¤è¿è¡Œï¼Œå†æ¬¡ for (;;) è¿™æ¬¡è‡ªå·±æ˜¯è€äºŒï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–ç«žäº‰ï¼ŒtryAcquire(1) æˆåŠŸï¼Œä¿®æ”¹å¤´ç»“ç‚¹ï¼Œæµç¨‹ç»“æŸ (2) æºç åˆ†æžå†™é”ä¸Šé”æµç¨‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859static final class NonfairSync extends Sync &#123; // ... çœç•¥æ— å…³ä»£ç  // å¤–éƒ¨ç±» WriteLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public void lock() &#123; sync.acquire(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final void acquire(int arg) &#123; if ( // å°è¯•èŽ·å¾—å†™é”å¤±è´¥ !tryAcquire(arg) &amp;&amp; // å°†å½“å‰çº¿ç¨‹å…³è”åˆ°ä¸€ä¸ª Node å¯¹è±¡ä¸Š, æ¨¡å¼ä¸ºç‹¬å æ¨¡å¼ // è¿›å…¥ AQS é˜Ÿåˆ—é˜»å¡ž acquireQueued(addWaiter(Node.EXCLUSIVE), arg) ) &#123; selfInterrupt(); &#125; &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final boolean tryAcquire(int acquires) &#123; // èŽ·å¾—ä½Ž 16 ä½, ä»£è¡¨å†™é”çš„ state è®¡æ•° Thread current = Thread.currentThread(); int c = getState(); int w = exclusiveCount(c); if (c != 0) &#123; if ( // c != 0 and w == 0 è¡¨ç¤ºæœ‰è¯»é”, æˆ–è€… w == 0 || // å¦‚æžœ exclusiveOwnerThread ä¸æ˜¯è‡ªå·± current != getExclusiveOwnerThread() ) &#123; // èŽ·å¾—é”å¤±è´¥ return false; &#125; // å†™é”è®¡æ•°è¶…è¿‡ä½Ž 16 ä½, æŠ¥å¼‚å¸¸ if (w + exclusiveCount(acquires) &gt; MAX_COUNT) throw new Error(&quot;Maximum lock count exceeded&quot;); // å†™é”é‡å…¥, èŽ·å¾—é”æˆåŠŸ setState(c + acquires); return true; &#125; if ( // åˆ¤æ–­å†™é”æ˜¯å¦è¯¥é˜»å¡ž, æˆ–è€… writerShouldBlock() || // å°è¯•æ›´æ”¹è®¡æ•°å¤±è´¥ !compareAndSetState(c, c + acquires) ) &#123; // èŽ·å¾—é”å¤±è´¥ return false; &#125; // èŽ·å¾—é”æˆåŠŸ setExclusiveOwnerThread(current); return true; &#125; // éžå…¬å¹³é” writerShouldBlock æ€»æ˜¯è¿”å›ž false, æ— éœ€é˜»å¡ž final boolean writerShouldBlock() &#123; return false; &#125;&#125; å†™é”é‡Šæ”¾æµç¨‹1234567891011121314151617181920212223242526272829303132static final class NonfairSync extends Sync &#123; // ... çœç•¥æ— å…³ä»£ç  // WriteLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public void unlock() &#123; sync.release(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final boolean release(int arg) &#123; // å°è¯•é‡Šæ”¾å†™é”æˆåŠŸ if (tryRelease(arg)) &#123; // unpark AQS ä¸­ç­‰å¾…çš„çº¿ç¨‹ Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false; &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final boolean tryRelease(int releases) &#123; if (!isHeldExclusively()) throw new IllegalMonitorStateException(); int nextc = getState() - releases; // å› ä¸ºå¯é‡å…¥çš„åŽŸå› , å†™é”è®¡æ•°ä¸º 0, æ‰ç®—é‡Šæ”¾æˆåŠŸ boolean free = exclusiveCount(nextc) == 0; if (free) &#123; setExclusiveOwnerThread(null); &#125; setState(nextc); return free; &#125;&#125; è¯»é”ä¸Šé”æµç¨‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144static final class NonfairSync extends Sync &#123; // ReadLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public void lock() &#123; sync.acquireShared(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final void acquireShared(int arg) &#123; // tryAcquireShared è¿”å›žè´Ÿæ•°, è¡¨ç¤ºèŽ·å–è¯»é”å¤±è´¥ if (tryAcquireShared(arg) &lt; 0) &#123; doAcquireShared(arg); &#125; &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final int tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); int c = getState(); // å¦‚æžœæ˜¯å…¶å®ƒçº¿ç¨‹æŒæœ‰å†™é”, èŽ·å–è¯»é”å¤±è´¥ if ( exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current ) &#123; return -1; &#125; int r = sharedCount(c); if ( // è¯»é”ä¸è¯¥é˜»å¡ž(å¦‚æžœè€äºŒæ˜¯å†™é”ï¼Œè¯»é”è¯¥é˜»å¡ž), å¹¶ä¸” !readerShouldBlock() &amp;&amp; // å°äºŽè¯»é”è®¡æ•°, å¹¶ä¸” r &lt; MAX_COUNT &amp;&amp; // å°è¯•å¢žåŠ è®¡æ•°æˆåŠŸ compareAndSetState(c, c + SHARED_UNIT) ) &#123; // ... çœç•¥ä¸é‡è¦çš„ä»£ç  return 1; &#125; return fullTryAcquireShared(current); &#125; // éžå…¬å¹³é” readerShouldBlock çœ‹ AQS é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯å†™é” // true åˆ™è¯¥é˜»å¡ž, false åˆ™ä¸é˜»å¡ž final boolean readerShouldBlock() &#123; return apparentlyFirstQueuedIsExclusive(); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ // ä¸Ž tryAcquireShared åŠŸèƒ½ç±»ä¼¼, ä½†ä¼šä¸æ–­å°è¯• for (;;) èŽ·å–è¯»é”, æ‰§è¡Œè¿‡ç¨‹ä¸­æ— é˜»å¡ž final int fullTryAcquireShared(Thread current) &#123; HoldCounter rh = null; for (;;) &#123; int c = getState(); if (exclusiveCount(c) != 0) &#123; if (getExclusiveOwnerThread() != current) return -1; &#125; else if (readerShouldBlock()) &#123; // ... çœç•¥ä¸é‡è¦çš„ä»£ç  &#125; if (sharedCount(c) == MAX_COUNT) throw new Error(&quot;Maximum lock count exceeded&quot;); if (compareAndSetState(c, c + SHARED_UNIT)) &#123; // ... çœç•¥ä¸é‡è¦çš„ä»£ç  return 1; &#125; &#125; &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private void doAcquireShared(int arg) &#123; // å°†å½“å‰çº¿ç¨‹å…³è”åˆ°ä¸€ä¸ª Node å¯¹è±¡ä¸Š, æ¨¡å¼ä¸ºå…±äº«æ¨¡å¼ final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; // å†ä¸€æ¬¡å°è¯•èŽ·å–è¯»é” int r = tryAcquireShared(arg); // æˆåŠŸ if (r &gt;= 0) &#123; // ãˆ  // r è¡¨ç¤ºå¯ç”¨èµ„æºæ•°, åœ¨è¿™é‡Œæ€»æ˜¯ 1 å…è®¸ä¼ æ’­ //ï¼ˆå”¤é†’ AQS ä¸­ä¸‹ä¸€ä¸ª Share èŠ‚ç‚¹ï¼‰ setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; if ( // æ˜¯å¦åœ¨èŽ·å–è¯»é”å¤±è´¥æ—¶é˜»å¡žï¼ˆå‰ä¸€ä¸ªé˜¶æ®µ waitStatus == Node.SIGNALï¼‰ shouldParkAfterFailedAcquire(p, node) &amp;&amp; // park å½“å‰çº¿ç¨‹ parkAndCheckInterrupt() ) &#123; interrupted = true; &#125; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125; &#125; // ãˆ  AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private void setHeadAndPropagate(Node node, int propagate) &#123; Node h = head; // Record old head for check below // è®¾ç½®è‡ªå·±ä¸º head setHead(node); // propagate è¡¨ç¤ºæœ‰å…±äº«èµ„æºï¼ˆä¾‹å¦‚å…±äº«è¯»é”æˆ–ä¿¡å·é‡ï¼‰ // åŽŸ head waitStatus == Node.SIGNAL æˆ– Node.PROPAGATE // çŽ°åœ¨ head waitStatus == Node.SIGNAL æˆ– Node.PROPAGATE if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; Node s = node.next; // å¦‚æžœæ˜¯æœ€åŽä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯ç­‰å¾…å…±äº«è¯»é”çš„èŠ‚ç‚¹ if (s == null || s.isShared()) &#123; // è¿›å…¥ ãˆ¡ doReleaseShared(); &#125; &#125; &#125; // ãˆ¡ AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private void doReleaseShared() &#123; // å¦‚æžœ head.waitStatus == Node.SIGNAL ==&gt; 0 æˆåŠŸ, ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark // å¦‚æžœ head.waitStatus == 0 ==&gt; Node.PROPAGATE, ä¸ºäº†è§£å†³ bug, è§åŽé¢åˆ†æž for (;;) &#123; Node h = head; // é˜Ÿåˆ—è¿˜æœ‰èŠ‚ç‚¹ if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; if (ws == Node.SIGNAL) &#123; if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // loop to recheck cases // ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark å¦‚æžœæˆåŠŸèŽ·å–è¯»é” // å¹¶ä¸”ä¸‹ä¸‹ä¸ªèŠ‚ç‚¹è¿˜æ˜¯ shared, ç»§ç»­ doReleaseShared unparkSuccessor(h); &#125; else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; if (h == head) // loop if head changed break; &#125; &#125;&#125; è¯»é”é‡Šæ”¾æµç¨‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051static final class NonfairSync extends Sync &#123; // ReadLock æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public void unlock() &#123; sync.releaseShared(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false; &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final boolean tryReleaseShared(int unused) &#123; // ... çœç•¥ä¸é‡è¦çš„ä»£ç  for (;;) &#123; int c = getState(); int nextc = c - SHARED_UNIT; if (compareAndSetState(c, nextc)) &#123; // è¯»é”çš„è®¡æ•°ä¸ä¼šå½±å“å…¶å®ƒèŽ·å–è¯»é”çº¿ç¨‹, ä½†ä¼šå½±å“å…¶å®ƒèŽ·å–å†™é”çº¿ç¨‹ // è®¡æ•°ä¸º 0 æ‰æ˜¯çœŸæ­£é‡Šæ”¾ return nextc == 0; &#125; &#125; &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private void doReleaseShared() &#123; // å¦‚æžœ head.waitStatus == Node.SIGNAL ==&gt; 0 æˆåŠŸ, ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark // å¦‚æžœ head.waitStatus == 0 ==&gt; Node.PROPAGATE for (;;) &#123; Node h = head; if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; // å¦‚æžœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨é‡Šæ”¾è¯»é”ï¼Œé‚£ä¹ˆéœ€è¦å°† waitStatus å…ˆæ”¹ä¸º 0 // é˜²æ­¢ unparkSuccessor è¢«å¤šæ¬¡æ‰§è¡Œ if (ws == Node.SIGNAL) &#123; if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // loop to recheck cases unparkSuccessor(h); &#125; // å¦‚æžœå·²ç»æ˜¯ 0 äº†ï¼Œæ”¹ä¸º -3ï¼Œç”¨æ¥è§£å†³ä¼ æ’­æ€§ï¼Œè§åŽæ–‡ä¿¡å·é‡ bug åˆ†æž else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; if (h == head) // loop if head changed break; &#125; &#125;&#125; StampedLockè¯¥ç±»è‡ª JDK 8 åŠ å…¥ï¼Œæ˜¯ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–è¯»æ€§èƒ½ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯åœ¨ä½¿ç”¨è¯»é”ã€å†™é”æ—¶éƒ½å¿…é¡»é…åˆã€æˆ³ã€‘ä½¿ç”¨åŠ è§£è¯»é” 12long stamp = lock.readLock();lock.unlockRead(stamp); åŠ è§£å†™é” 12long stamp = lock.writeLock();lock.unlockWrite(stamp); ä¹è§‚è¯»ï¼ŒStampedLock æ”¯æŒ tryOptimisticRead() æ–¹æ³•ï¼ˆä¹è§‚è¯»ï¼‰ï¼Œè¯»å–å®Œæ¯•åŽéœ€è¦åšä¸€æ¬¡ æˆ³æ ¡éªŒ å¦‚æžœæ ¡éªŒé€šè¿‡ï¼Œè¡¨ç¤ºè¿™æœŸé—´ç¡®å®žæ²¡æœ‰å†™æ“ä½œï¼Œæ•°æ®å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œå¦‚æžœæ ¡éªŒæ²¡é€šè¿‡ï¼Œéœ€è¦é‡æ–°èŽ·å–è¯»é”ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚ 12345long stamp = lock.tryOptimisticRead();// éªŒæˆ³if(!lock.validate(stamp))&#123; // é”å‡çº§&#125; æä¾›ä¸€ä¸ª æ•°æ®å®¹å™¨ç±» å†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ write() æ–¹æ³• 123456789101112131415161718192021222324252627282930313233343536373839class DataContainerStamped &#123; private int data; private final StampedLock lock = new StampedLock(); public DataContainerStamped(int data) &#123; this.data = data; &#125; public int read(int readTime) &#123; long stamp = lock.tryOptimisticRead(); log.debug(&quot;optimistic read locking...&#123;&#125;&quot;, stamp); sleep(readTime); if (lock.validate(stamp)) &#123; log.debug(&quot;read finish...&#123;&#125;, data:&#123;&#125;&quot;, stamp, data); return data; &#125; // é”å‡çº§ - è¯»é” log.debug(&quot;updating to read lock... &#123;&#125;&quot;, stamp); try &#123; stamp = lock.readLock(); log.debug(&quot;read lock &#123;&#125;&quot;, stamp); sleep(readTime); log.debug(&quot;read finish...&#123;&#125;, data:&#123;&#125;&quot;, stamp, data); return data; &#125; finally &#123; log.debug(&quot;read unlock &#123;&#125;&quot;, stamp); lock.unlockRead(stamp); &#125; &#125; public void write(int newData) &#123; long stamp = lock.writeLock(); log.debug(&quot;write lock &#123;&#125;&quot;, stamp); try &#123; sleep(2); this.data = newData; &#125; finally &#123; log.debug(&quot;write unlock &#123;&#125;&quot;, stamp); lock.unlockWrite(stamp); &#125; &#125;&#125; æµ‹è¯• è¯»-è¯» å¯ä»¥ä¼˜åŒ– 12345678910public static void main(String[] args) &#123; DataContainerStamped dataContainer = new DataContainerStamped(1); new Thread(() -&gt; &#123; dataContainer.read(1); &#125;, &quot;t1&quot;).start(); sleep(0.5); new Thread(() -&gt; &#123; dataContainer.read(0); &#125;, &quot;t2&quot;).start();&#125; è¾“å‡ºç»“æžœï¼Œå¯ä»¥çœ‹åˆ°å®žé™…æ²¡æœ‰åŠ è¯»é” 123415:58:50.217 c.DataContainerStamped [t1] - optimistic read locking...25615:58:50.717 c.DataContainerStamped [t2] - optimistic read locking...25615:58:50.717 c.DataContainerStamped [t2] - read finish...256, data:115:58:51.220 c.DataContainerStamped [t1] - read finish...256, data:1 æµ‹è¯• è¯»-å†™ æ—¶ä¼˜åŒ–è¯»è¡¥åŠ è¯»é” 12345678910public static void main(String[] args) &#123; DataContainerStamped dataContainer = new DataContainerStamped(1); new Thread(() -&gt; &#123; dataContainer.read(1); &#125;, &quot;t1&quot;).start(); sleep(0.5); new Thread(() -&gt; &#123; dataContainer.write(100); &#125;, &quot;t2&quot;).start();&#125; è¾“å‡ºç»“æžœ 123456715:57:00.219 c.DataContainerStamped [t1] - optimistic read locking...25615:57:00.717 c.DataContainerStamped [t2] - write lock 38415:57:01.225 c.DataContainerStamped [t1] - updating to read lock... 25615:57:02.719 c.DataContainerStamped [t2] - write unlock 38415:57:02.719 c.DataContainerStamped [t1] - read lock 51315:57:03.719 c.DataContainerStamped [t1] - read finish...513, data:100015:57:03.719 c.DataContainerStamped [t1] - read unlock 513 æ³¨æ„ StampedLock ä¸æ”¯æŒæ¡ä»¶å˜é‡ StampedLock ä¸æ”¯æŒå¯é‡å…¥ 2.4 SemaphoreåŸºæœ¬ä½¿ç”¨[ËˆsÉ›mÉ™ËŒfÉ”r] ä¿¡å·é‡ï¼Œç”¨æ¥é™åˆ¶èƒ½åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ä¸Šé™ 1234567891011121314151617181920212223public static void main(String[] args) &#123; // 1. åˆ›å»º semaphore å¯¹è±¡ Semaphore semaphore = new Semaphore(3); // 2. 10ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ for (int i = 0; i &lt; 10; i++) &#123; new Thread(() -&gt; &#123; // 3. èŽ·å–è®¸å¯ try &#123; semaphore.acquire(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; log.debug(&quot;running...&quot;); sleep(1); log.debug(&quot;end...&quot;); &#125; finally &#123; // 4. é‡Šæ”¾è®¸å¯ semaphore.release(); &#125; &#125;).start(); &#125;&#125; è¾“å‡º 123456789101112131415161718192007:35:15.485 c.TestSemaphore [Thread-2] - running...07:35:15.485 c.TestSemaphore [Thread-1] - running...07:35:15.485 c.TestSemaphore [Thread-0] - running...07:35:16.490 c.TestSemaphore [Thread-2] - end...07:35:16.490 c.TestSemaphore [Thread-0] - end...07:35:16.490 c.TestSemaphore [Thread-1] - end...07:35:16.490 c.TestSemaphore [Thread-3] - running...07:35:16.490 c.TestSemaphore [Thread-5] - running...07:35:16.490 c.TestSemaphore [Thread-4] - running...07:35:17.490 c.TestSemaphore [Thread-5] - end...07:35:17.490 c.TestSemaphore [Thread-4] - end...07:35:17.490 c.TestSemaphore [Thread-3] - end...07:35:17.490 c.TestSemaphore [Thread-6] - running...07:35:17.490 c.TestSemaphore [Thread-7] - running...07:35:17.490 c.TestSemaphore [Thread-9] - running...07:35:18.491 c.TestSemaphore [Thread-6] - end...07:35:18.491 c.TestSemaphore [Thread-7] - end...07:35:18.491 c.TestSemaphore [Thread-9] - end...07:35:18.491 c.TestSemaphore [Thread-8] - running...07:35:19.492 c.TestSemaphore [Thread-8] - end... åº”ç”¨é™åˆ¶å¯¹å…±äº«èµ„æºçš„ä½¿ç”¨semaphore å®žçŽ° ä½¿ç”¨ Semaphore é™æµï¼Œåœ¨è®¿é—®é«˜å³°æœŸæ—¶ï¼Œè®©è¯·æ±‚çº¿ç¨‹é˜»å¡žï¼Œé«˜å³°æœŸè¿‡åŽ»å†é‡Šæ”¾è®¸å¯ï¼Œå½“ç„¶å®ƒåªé€‚åˆé™åˆ¶å•æœºçº¿ç¨‹æ•°é‡ï¼Œå¹¶ä¸”ä»…æ˜¯é™åˆ¶çº¿ç¨‹æ•°ï¼Œè€Œä¸æ˜¯é™åˆ¶èµ„æºæ•°ï¼ˆä¾‹å¦‚è¿žæŽ¥æ•°ï¼Œè¯·å¯¹æ¯” Tomcat LimitLatch çš„å®žçŽ°ï¼‰ ç”¨ Semaphore å®žçŽ°ç®€å•è¿žæŽ¥æ± ï¼Œå¯¹æ¯”ã€Žäº«å…ƒæ¨¡å¼ã€ä¸‹çš„å®žçŽ°ï¼ˆç”¨wait notifyï¼‰ï¼Œæ€§èƒ½å’Œå¯è¯»æ€§æ˜¾ç„¶æ›´å¥½ï¼Œæ³¨æ„ä¸‹é¢çš„å®žçŽ°ä¸­çº¿ç¨‹æ•°å’Œæ•°æ®åº“è¿žæŽ¥æ•°æ˜¯ç›¸ç­‰çš„ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152@Slf4j(topic = &quot;c.Pool&quot;)class Pool &#123; // 1. è¿žæŽ¥æ± å¤§å° private final int poolSize; // 2. è¿žæŽ¥å¯¹è±¡æ•°ç»„ private Connection[] connections; // 3. è¿žæŽ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™ private AtomicIntegerArray states; private Semaphore semaphore; // 4. æž„é€ æ–¹æ³•åˆå§‹åŒ– public Pool(int poolSize) &#123; this.poolSize = poolSize; // è®©è®¸å¯æ•°ä¸Žèµ„æºæ•°ä¸€è‡´ this.semaphore = new Semaphore(poolSize); this.connections = new Connection[poolSize]; this.states = new AtomicIntegerArray(new int[poolSize]); for (int i = 0; i &lt; poolSize; i++) &#123; connections[i] = new MockConnection(&quot;è¿žæŽ¥&quot; + (i+1)); &#125; &#125; // 5. å€Ÿè¿žæŽ¥ public Connection borrow() &#123;// t1, t2, t3 // èŽ·å–è®¸å¯ try &#123; semaphore.acquire(); // æ²¡æœ‰è®¸å¯çš„çº¿ç¨‹ï¼Œåœ¨æ­¤ç­‰å¾… &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; for (int i = 0; i &lt; poolSize; i++) &#123; // èŽ·å–ç©ºé—²è¿žæŽ¥ if(states.get(i) == 0) &#123; if (states.compareAndSet(i, 0, 1)) &#123; log.debug(&quot;borrow &#123;&#125;&quot;, connections[i]); return connections[i]; &#125; &#125; &#125; // ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ return null; &#125; // 6. å½’è¿˜è¿žæŽ¥ public void free(Connection conn) &#123; for (int i = 0; i &lt; poolSize; i++) &#123; if (connections[i] == conn) &#123; states.set(i, 0); log.debug(&quot;free &#123;&#125;&quot;, conn); semaphore.release(); break; &#125; &#125; &#125;&#125; åŽŸç†åŠ é”è§£é”æµç¨‹Semaphore æœ‰ç‚¹åƒä¸€ä¸ªåœè½¦åœºï¼Œpermits å°±å¥½åƒåœè½¦ä½æ•°é‡ï¼Œå½“çº¿ç¨‹èŽ·å¾—äº† permits å°±åƒæ˜¯èŽ·å¾—äº†åœè½¦ä½ï¼Œç„¶åŽåœè½¦åœºæ˜¾ç¤ºç©ºä½™è½¦ä½å‡ åˆšå¼€å§‹ï¼Œpermitsï¼ˆstateï¼‰ä¸º 3ï¼Œè¿™æ—¶ 5 ä¸ªçº¿ç¨‹æ¥èŽ·å–èµ„æº å‡è®¾å…¶ä¸­ Thread-1ï¼ŒThread-2ï¼ŒThread-4 cas ç«žäº‰æˆåŠŸï¼Œè€Œ Thread-0 å’Œ Thread-3 ç«žäº‰å¤±è´¥ï¼Œè¿›å…¥ AQS é˜Ÿåˆ— park é˜»å¡ž è¿™æ—¶ Thread-4 é‡Šæ”¾äº† permitsï¼ŒçŠ¶æ€å¦‚ä¸‹ æŽ¥ä¸‹æ¥ Thread-0 ç«žäº‰æˆåŠŸï¼Œpermits å†æ¬¡è®¾ç½®ä¸º 0ï¼Œè®¾ç½®è‡ªå·±ä¸º head èŠ‚ç‚¹ï¼Œæ–­å¼€åŽŸæ¥çš„ head èŠ‚ç‚¹ï¼Œunpark æŽ¥ä¸‹æ¥çš„ Thread-3 èŠ‚ç‚¹ï¼Œä½†ç”±äºŽ permits æ˜¯ 0ï¼Œå› æ­¤ Thread-3 åœ¨å°è¯•ä¸æˆåŠŸåŽå†æ¬¡è¿›å…¥ park çŠ¶æ€ è¢«å”¤é†’çš„èŠ‚ç‚¹ä¼šåŽ»å”¤é†’å®ƒæŽ¥ä¸‹æ¥çš„èŠ‚ç‚¹ é˜Ÿåˆ—ä¸­æœ‰äº›èŠ‚ç‚¹å› ä¸ºè¢«ç”¨æˆ·ä¸­æ–­è€ŒèŠ‚ç‚¹çŠ¶æ€è¢«è®¾ç½®ä¸ºäº†1ï¼Œä¸­æ–­åŽçš„èŠ‚ç‚¹è‡ªå·±ä¼šé™¤åŽ»è¯¥èŠ‚ç‚¹ï¼ˆå¯ä¸­æ–­æ¨¡å¼ï¼‰ è¢«å”¤é†’çš„èŠ‚ç‚¹ï¼Œä¸ä¼šå­˜åœ¨è¢«ç”¨æˆ·ä¸­æ–­çš„å¯èƒ½ï¼ˆå–æ¶ˆè¿˜æ²¡å®Œæˆï¼ŒèŠ‚ç‚¹è¿˜æ²¡åŽ»é™¤ï¼‰ï¼Œå› ä¸ºå”¤é†’ (release) æ˜¯æ‰¾åˆ°ç¦»headæœ€è¿‘çš„ä¸€ä¸ª çŠ¶æ€ä¸º-1ï¼Œè¢«ä¸­æ–­ä¸º1 çš„ä¸ä¼šåŽ»å”¤é†’(unpark) æºç åˆ†æž1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = -2694183684443567898L; NonfairSync(int permits) &#123; // permits å³ state super(permits); &#125; // Semaphore æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public void acquire() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; if (Thread.interrupted()) throw new InterruptedException(); if (tryAcquireShared(arg) &lt; 0) doAcquireSharedInterruptibly(arg); &#125; // å°è¯•èŽ·å¾—å…±äº«é” protected int tryAcquireShared(int acquires) &#123; return nonfairTryAcquireShared(acquires); &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ final int nonfairTryAcquireShared(int acquires) &#123; for (;;) &#123; int available = getState(); int remaining = available - acquires; if ( // å¦‚æžœè®¸å¯å·²ç»ç”¨å®Œ, è¿”å›žè´Ÿæ•°, è¡¨ç¤ºèŽ·å–å¤±è´¥, è¿›å…¥ doAcquireSharedInterruptibly remaining &lt; 0 || // å¦‚æžœ cas é‡è¯•æˆåŠŸ, è¿”å›žæ­£æ•°, è¡¨ç¤ºèŽ·å–æˆåŠŸ compareAndSetState(available, remaining) ) &#123; return remaining; &#125; &#125; &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ private void doAcquireSharedInterruptibly(int arg) throws InterruptedException &#123; final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; // å†æ¬¡å°è¯•èŽ·å–è®¸å¯ int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; // æˆåŠŸåŽæœ¬çº¿ç¨‹å‡ºé˜Ÿï¼ˆAQSï¼‰, æ‰€åœ¨ Nodeè®¾ç½®ä¸º head // å¦‚æžœ head.waitStatus == Node.SIGNAL ==&gt; 0 æˆåŠŸ, ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark // å¦‚æžœ head.waitStatus == 0 ==&gt; Node.PROPAGATE // r è¡¨ç¤ºå¯ç”¨èµ„æºæ•°, ä¸º 0 åˆ™ä¸ä¼šç»§ç»­ä¼ æ’­ setHeadAndPropagate(node, r); p.next = null; // help GC failed = false; return; &#125; &#125; // ä¸æˆåŠŸ, è®¾ç½®ä¸Šä¸€ä¸ªèŠ‚ç‚¹ waitStatus = Node.SIGNAL, ä¸‹è½®è¿›å…¥ park é˜»å¡ž if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) throw new InterruptedException(); &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125; &#125; // Semaphore æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public void release() &#123; sync.releaseShared(1); &#125; // AQS ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false; &#125; // Sync ç»§æ‰¿è¿‡æ¥çš„æ–¹æ³•, æ–¹ä¾¿é˜…è¯», æ”¾åœ¨æ­¤å¤„ protected final boolean tryReleaseShared(int releases) &#123; for (;;) &#123; int current = getState(); int next = current + releases; if (next &lt; current) // overflow throw new Error(&quot;Maximum permit count exceeded&quot;); if (compareAndSetState(current, next)) return true; &#125; &#125;&#125; ä¸ºä»€ä¹ˆè¦æœ‰ PROPAGATEæ—©æœŸæœ‰ bug releaseShared æ–¹æ³• 123456789public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; Node h = head; if (h != null &amp;&amp; h.waitStatus != 0) unparkSuccessor(h); return true; &#125; return false;&#125; doAcquireShared æ–¹æ³• 12345678910111213141516171819202122232425262728private void doAcquireShared(int arg) &#123; final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; // è¿™é‡Œä¼šæœ‰ç©ºæ¡£ setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; setHeadAndPropagate æ–¹æ³• 12345678910111213141516171819202122232425262728private void doAcquireShared(int arg) &#123; final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; // è¿™é‡Œä¼šæœ‰ç©ºæ¡£ setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; setHeadAndPropagate æ–¹æ³• 12345678910private void setHeadAndPropagate(Node node, int propagate) &#123; setHead(node); // æœ‰ç©ºé—²èµ„æº if (propagate &gt; 0 &amp;&amp; node.waitStatus != 0) &#123; Node s = node.next; // ä¸‹ä¸€ä¸ª if (s == null || s.isShared()) unparkSuccessor(node); &#125;&#125; å‡è®¾å­˜åœ¨æŸæ¬¡å¾ªçŽ¯ä¸­é˜Ÿåˆ—é‡ŒæŽ’é˜Ÿçš„ç»“ç‚¹æƒ…å†µä¸º head(-1)-&gt;t1(-1)-&gt;t2(-1) å‡è®¾å­˜åœ¨å°†è¦ä¿¡å·é‡é‡Šæ”¾çš„ T3 å’Œ T4ï¼Œé‡Šæ”¾é¡ºåºä¸ºå…ˆ T3 åŽ T4 (1) æ­£å¸¸æµç¨‹ (2) äº§ç”Ÿ bug çš„æƒ…å†µ ä¿®å¤å‰ç‰ˆæœ¬æ‰§è¡Œæµç¨‹(1) T3 è°ƒç”¨ releaseShared(1)ï¼Œç›´æŽ¥è°ƒç”¨äº† unparkSuccessor(head)ï¼Œhead çš„ç­‰å¾…çŠ¶æ€ä»Ž -1 å˜ä¸º 0 (2) T1 ç”±äºŽ T3 é‡Šæ”¾ä¿¡å·é‡è¢«å”¤é†’ï¼Œè°ƒç”¨ tryAcquireSharedï¼Œå‡è®¾è¿”å›žå€¼ä¸º 0ï¼ˆèŽ·å–é”æˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™èµ„æºé‡ï¼‰ (3) T4 è°ƒç”¨ releaseShared(1)ï¼Œæ­¤æ—¶ head.waitStatus ä¸º 0ï¼ˆæ­¤æ—¶è¯»åˆ°çš„ head å’Œ 1 ä¸­ä¸ºåŒä¸€ä¸ªheadï¼‰ï¼Œä¸æ»¡è¶³æ¡ä»¶ï¼Œå› æ­¤ä¸è°ƒç”¨ unpark-Successor(head) (4) T1 èŽ·å–ä¿¡å·é‡æˆåŠŸï¼Œè°ƒç”¨ setHeadAndPropagate æ—¶ï¼Œå› ä¸ºä¸æ»¡è¶³ propagate &gt; 0ï¼ˆ2 çš„è¿”å›žå€¼ä¹Ÿå°±æ˜¯ propagateï¼ˆå‰©ä½™èµ„æºé‡ï¼‰== 0ï¼‰ï¼Œä»Žè€Œä¸ä¼šå”¤é†’åŽç»§ç»“ç‚¹ï¼Œ T2 çº¿ç¨‹å¾—ä¸åˆ°å”¤é†’ (3) bug ä¿®å¤åŽ123456789101112131415161718192021222324252627282930313233343536private void setHeadAndPropagate(Node node, int propagate) &#123; Node h = head; // Record old head for check below // è®¾ç½®è‡ªå·±ä¸º head setHead(node); // propagate è¡¨ç¤ºæœ‰å…±äº«èµ„æºï¼ˆä¾‹å¦‚å…±äº«è¯»é”æˆ–ä¿¡å·é‡ï¼‰ // åŽŸ head waitStatus == Node.SIGNAL æˆ– Node.PROPAGATE // çŽ°åœ¨ head waitStatus == Node.SIGNAL æˆ– Node.PROPAGATE if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; Node s = node.next; // å¦‚æžœæ˜¯æœ€åŽä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…æ˜¯ç­‰å¾…å…±äº«è¯»é”çš„èŠ‚ç‚¹ if (s == null || s.isShared()) &#123; doReleaseShared(); &#125; &#125;&#125;private void doReleaseShared() &#123; // å¦‚æžœ head.waitStatus == Node.SIGNAL ==&gt; 0 æˆåŠŸ, ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ unpark // å¦‚æžœ head.waitStatus == 0 ==&gt; Node.PROPAGATE for (;;) &#123; Node h = head; if (h != null &amp;&amp; h != tail) &#123; int ws = h.waitStatus; if (ws == Node.SIGNAL) &#123; if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // loop to recheck cases unparkSuccessor(h); &#125; else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; if (h == head) // loop if head changed break; &#125;&#125; (1) T3 è°ƒç”¨ releaseShared()ï¼Œç›´æŽ¥è°ƒç”¨äº† unparkSuccessor(head)ï¼Œhead çš„ç­‰å¾…çŠ¶æ€ä»Ž -1 å˜ä¸º 0 (2) T1 ç”±äºŽ T3 é‡Šæ”¾ä¿¡å·é‡è¢«å”¤é†’ï¼Œè°ƒç”¨ tryAcquireSharedï¼Œå‡è®¾è¿”å›žå€¼ä¸º 0ï¼ˆèŽ·å–é”æˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™èµ„æºé‡ï¼‰ (3) T4 è°ƒç”¨ releaseShared()ï¼Œæ­¤æ—¶ head.waitStatus ä¸º 0ï¼ˆæ­¤æ—¶è¯»åˆ°çš„ head å’Œ 1 ä¸­ä¸ºåŒä¸€ä¸ª headï¼‰ï¼Œè°ƒç”¨ doReleaseShared() å°†ç­‰å¾…çŠ¶æ€ç½®ä¸º *PROPAGATE***ï¼ˆ-3ï¼‰ (4) T1 èŽ·å–ä¿¡å·é‡æˆåŠŸï¼Œè°ƒç”¨ setHeadAndPropagate æ—¶ï¼Œè¯»åˆ° h.waitStatus &lt; 0ï¼Œä»Žè€Œè°ƒç”¨ doReleaseShared() å”¤é†’ T2 2.5 CountdownLatch ç”¨æ¥è¿›è¡Œçº¿ç¨‹åŒæ­¥åä½œï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆå€’è®¡æ—¶ã€‚ å…¶ä¸­æž„é€ å‚æ•°ç”¨æ¥åˆå§‹åŒ–ç­‰å¾…è®¡æ•°å€¼ï¼Œawait() ç”¨æ¥ç­‰å¾…è®¡æ•°å½’é›¶ï¼ŒcountDown() ç”¨æ¥è®©è®¡æ•°å‡ä¸€ 123456789101112131415161718192021222324public static void main(String[] args) throws InterruptedException &#123; CountDownLatch latch = new CountDownLatch(3); new Thread(() -&gt; &#123; log.debug(&quot;begin...&quot;); sleep(1); latch.countDown(); log.debug(&quot;end...&#123;&#125;&quot;, latch.getCount()); &#125;).start(); new Thread(() -&gt; &#123; log.debug(&quot;begin...&quot;); sleep(2); latch.countDown(); log.debug(&quot;end...&#123;&#125;&quot;, latch.getCount()); &#125;).start(); new Thread(() -&gt; &#123; log.debug(&quot;begin...&quot;); sleep(1.5); latch.countDown(); log.debug(&quot;end...&#123;&#125;&quot;, latch.getCount()); &#125;).start(); log.debug(&quot;waiting...&quot;); latch.await(); log.debug(&quot;wait end...&quot;);&#125; è¾“å‡º 1234567818:44:00.778 c.TestCountDownLatch [main] - waiting...18:44:00.778 c.TestCountDownLatch [Thread-2] - begin...18:44:00.778 c.TestCountDownLatch [Thread-0] - begin...18:44:00.778 c.TestCountDownLatch [Thread-1] - begin...18:44:01.782 c.TestCountDownLatch [Thread-0] - end...218:44:02.283 c.TestCountDownLatch [Thread-2] - end...118:44:02.782 c.TestCountDownLatch [Thread-1] - end...018:44:02.782 c.TestCountDownLatch [main] - wait end... å¯ä»¥é…åˆçº¿ç¨‹æ± ä½¿ç”¨ï¼Œæ”¹è¿›å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031public static void main(String[] args) throws InterruptedException &#123; CountDownLatch latch = new CountDownLatch(3); ExecutorService service = Executors.newFixedThreadPool(4); service.submit(() -&gt; &#123; log.debug(&quot;begin...&quot;); sleep(1); latch.countDown(); log.debug(&quot;end...&#123;&#125;&quot;, latch.getCount()); &#125;); service.submit(() -&gt; &#123; log.debug(&quot;begin...&quot;); sleep(1.5); latch.countDown(); log.debug(&quot;end...&#123;&#125;&quot;, latch.getCount()); &#125;); service.submit(() -&gt; &#123; log.debug(&quot;begin...&quot;); sleep(2); latch.countDown(); log.debug(&quot;end...&#123;&#125;&quot;, latch.getCount()); &#125;); service.submit(()-&gt;&#123; try &#123; log.debug(&quot;waiting...&quot;); latch.await(); log.debug(&quot;wait end...&quot;); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;);&#125; è¾“å‡º 1234567818:52:25.831 c.TestCountDownLatch [pool-1-thread-3] - begin...18:52:25.831 c.TestCountDownLatch [pool-1-thread-1] - begin...18:52:25.831 c.TestCountDownLatch [pool-1-thread-2] - begin...18:52:25.831 c.TestCountDownLatch [pool-1-thread-4] - waiting...18:52:26.835 c.TestCountDownLatch [pool-1-thread-1] - end...218:52:27.335 c.TestCountDownLatch [pool-1-thread-2] - end...118:52:27.835 c.TestCountDownLatch [pool-1-thread-3] - end...018:52:27.835 c.TestCountDownLatch [pool-1-thread-4] - wait end... åº”ç”¨ä¹‹åŒæ­¥ç­‰å¾…å¤šçº¿ç¨‹å‡†å¤‡å®Œæ¯•123456789101112131415161718192021222324AtomicInteger num = new AtomicInteger(0);ExecutorService service = Executors.newFixedThreadPool(10, (r) -&gt; &#123; return new Thread(r, &quot;t&quot; + num.getAndIncrement());&#125;);CountDownLatch latch = new CountDownLatch(10);String[] all = new String[10];Random r = new Random();for (int j = 0; j &lt; 10; j++) &#123; int x = j; service.submit(() -&gt; &#123; for (int i = 0; i &lt;= 100; i++) &#123; try &#123; Thread.sleep(r.nextInt(100)); &#125; catch (InterruptedException e) &#123; &#125; all[x] = Thread.currentThread().getName() + &quot;(&quot; + (i + &quot;%&quot;) + &quot;)&quot;; System.out.print(&quot;\\r&quot; + Arrays.toString(all)); &#125; latch.countDown(); &#125;);&#125;latch.await();System.out.println(&quot;\\næ¸¸æˆå¼€å§‹...&quot;);service.shutdown(); ä¸­é—´è¾“å‡º 1[t0(52%), t1(47%), t2(51%), t3(40%), t4(49%), t5(44%), t6(49%), t7(52%), t8(46%), t9(46%)] æœ€åŽè¾“å‡º 123[t0(100%), t1(100%), t2(100%), t3(100%), t4(100%), t5(100%), t6(100%), t7(100%), t8(100%),t9(100%)]æ¸¸æˆå¼€å§‹... åº”ç”¨ä¹‹åŒæ­¥ç­‰å¾…å¤šä¸ªè¿œç¨‹è°ƒç”¨ç»“æŸ12345678910111213141516171819202122232425262728293031323334353637383940@RestControllerpublic class TestCountDownlatchController &#123; @GetMapping(&quot;/order/&#123;id&#125;&quot;) public Map&lt;String, Object&gt; order(@PathVariable int id) &#123; HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;id&quot;, id); map.put(&quot;total&quot;, &quot;2300.00&quot;); sleep(2000); return map; &#125; @GetMapping(&quot;/product/&#123;id&#125;&quot;) public Map&lt;String, Object&gt; product(@PathVariable int id) &#123; HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;(); if (id == 1) &#123; map.put(&quot;name&quot;, &quot;å°çˆ±éŸ³ç®±&quot;); map.put(&quot;price&quot;, 300); &#125; else if (id == 2) &#123; map.put(&quot;name&quot;, &quot;å°ç±³æ‰‹æœº&quot;); map.put(&quot;price&quot;, 2000); &#125; map.put(&quot;id&quot;, id); sleep(1000); return map; &#125; @GetMapping(&quot;/logistics/&#123;id&#125;&quot;) public Map&lt;String, Object&gt; logistics(@PathVariable int id) &#123; HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;id&quot;, id); map.put(&quot;name&quot;, &quot;ä¸­é€šå¿«é€’&quot;); sleep(2500); return map; &#125; private void sleep(int millis) &#123; try &#123; Thread.sleep(millis); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; rest è¿œç¨‹è°ƒç”¨ 123456789101112131415161718192021222324252627282930RestTemplate restTemplate = new RestTemplate();log.debug(&quot;begin&quot;);ExecutorService service = Executors.newCachedThreadPool();CountDownLatch latch = new CountDownLatch(4);Future&lt;Map&lt;String,Object&gt;&gt; f1 = service.submit(() -&gt; &#123; Map&lt;String, Object&gt; r = restTemplate.getForObject(&quot;http://localhost:8080/order/&#123;1&#125;&quot;, Map.class, 1); return r;&#125;);Future&lt;Map&lt;String, Object&gt;&gt; f2 = service.submit(() -&gt; &#123; Map&lt;String, Object&gt; r = restTemplate.getForObject(&quot;http://localhost:8080/product/&#123;1&#125;&quot;, Map.class, 1); return r;&#125;);Future&lt;Map&lt;String, Object&gt;&gt; f3 = service.submit(() -&gt; &#123; Map&lt;String, Object&gt; r = restTemplate.getForObject(&quot;http://localhost:8080/product/&#123;1&#125;&quot;, Map.class, 2); return r;&#125;);Future&lt;Map&lt;String, Object&gt;&gt; f4 = service.submit(() -&gt; &#123; Map&lt;String, Object&gt; r = restTemplate.getForObject(&quot;http://localhost:8080/logistics/&#123;1&#125;&quot;, Map.class, 1); return r;&#125;);System.out.println(f1.get());System.out.println(f2.get());System.out.println(f3.get());System.out.println(f4.get());log.debug(&quot;æ‰§è¡Œå®Œæ¯•&quot;);service.shutdown(); æ‰§è¡Œç»“æžœ 12345619:51:39.711 c.TestCountDownLatch [main] - begin&#123;total=2300.00, id=1&#125;&#123;price=300, name=å°çˆ±éŸ³ç®±, id=1&#125;&#123;price=2000, name=å°ç±³æ‰‹æœº, id=2&#125;&#123;name=ä¸­é€šå¿«é€’, id=1&#125;19:51:42.407 c.TestCountDownLatch [main] - æ‰§è¡Œå®Œæ¯• 2.6 CydicBarrier[ËˆsaÉªklÉªk ËˆbÃ¦riÉš] å¾ªçŽ¯æ …æ ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹åä½œï¼Œç­‰å¾…çº¿ç¨‹æ»¡è¶³æŸä¸ªè®¡æ•°ã€‚æž„é€ æ—¶è®¾ç½®ã€Žè®¡æ•°ä¸ªæ•°ã€ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°æŸä¸ªéœ€è¦â€œåŒæ­¥â€çš„æ—¶åˆ»è°ƒç”¨ await() æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå½“ç­‰å¾…çš„çº¿ç¨‹æ•°æ»¡è¶³ã€Žè®¡æ•°ä¸ªæ•°ã€æ—¶ï¼Œç»§ç»­æ‰§è¡Œ 1234567891011121314151617181920CyclicBarrier cb = new CyclicBarrier(2); // ä¸ªæ•°ä¸º2æ—¶æ‰ä¼šç»§ç»­æ‰§è¡Œnew Thread(()-&gt;&#123; System.out.println(&quot;çº¿ç¨‹1å¼€å§‹..&quot;+new Date()); try &#123; cb.await(); // å½“ä¸ªæ•°ä¸è¶³æ—¶ï¼Œç­‰å¾… &#125; catch (InterruptedException | BrokenBarrierException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;çº¿ç¨‹1ç»§ç»­å‘ä¸‹è¿è¡Œ...&quot;+new Date());&#125;).start();new Thread(()-&gt;&#123; System.out.println(&quot;çº¿ç¨‹2å¼€å§‹..&quot;+new Date()); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; &#125; try &#123; cb.await(); // 2 ç§’åŽï¼Œçº¿ç¨‹ä¸ªæ•°å¤Ÿ2ï¼Œç»§ç»­è¿è¡Œ &#125; catch (InterruptedException | BrokenBarrierException e) &#123; e.printStackTrace(); &#125; System.out.println(&quot;çº¿ç¨‹2ç»§ç»­å‘ä¸‹è¿è¡Œ...&quot;+new Date());&#125;).start(); æ³¨æ„ CyclicBarrier ä¸Ž CountDownLatch çš„ä¸»è¦åŒºåˆ«åœ¨äºŽ CyclicBarrier æ˜¯å¯ä»¥é‡ç”¨çš„ CyclicBarrier å¯ä»¥è¢«æ¯”å–»ä¸ºã€Žäººæ»¡å‘è½¦ã€ 2.7 çº¿ç¨‹å®‰å…¨é›†åˆç±»æ¦‚è¿° çº¿ç¨‹å®‰å…¨é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š é—ç•™çš„çº¿ç¨‹å®‰å…¨é›†åˆå¦‚ Hashtable ï¼Œ Vector ä½¿ç”¨ Collections è£…é¥°çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¦‚ï¼š Collections.synchronizedCollection Collections.synchronizedList Collections.synchronizedMap Collections.synchronizedSet Collections.synchronizedNavigableMap Collections.synchronizedNavigableSet Collections.synchronizedSortedMap Collections.synchronizedSortedSet java.util.concurrent.*é‡ç‚¹ä»‹ç» java.util.concurrent.* ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆç±»ï¼Œå¯ä»¥å‘çŽ°å®ƒä»¬æœ‰è§„å¾‹ï¼Œé‡Œé¢åŒ…å«ä¸‰ç±»å…³é”®è¯ï¼š Blockingã€CopyOnWriteã€Concurrent Blocking å¤§éƒ¨åˆ†å®žçŽ°åŸºäºŽé”ï¼Œå¹¶æä¾›ç”¨æ¥é˜»å¡žçš„æ–¹æ³• CopyOnWrite ä¹‹ç±»å®¹å™¨ä¿®æ”¹å¼€é”€ç›¸å¯¹è¾ƒé‡ Concurrent ç±»åž‹çš„å®¹å™¨ å†…éƒ¨å¾ˆå¤šæ“ä½œä½¿ç”¨ cas ä¼˜åŒ–ï¼Œä¸€èˆ¬å¯ä»¥æä¾›è¾ƒé«˜åžåé‡ å¼±ä¸€è‡´æ€§ éåŽ†æ—¶å¼±ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ï¼Œå½“åˆ©ç”¨è¿­ä»£å™¨éåŽ†æ—¶ï¼Œå¦‚æžœå®¹å™¨å‘ç”Ÿä¿®æ”¹ï¼Œè¿­ä»£å™¨ä»ç„¶å¯ä»¥ç»§ç»­è¿›è¡ŒéåŽ†ï¼Œè¿™æ—¶å†…å®¹æ˜¯æ—§çš„ æ±‚å¤§å°å¼±ä¸€è‡´æ€§ï¼Œsize æ“ä½œæœªå¿…æ˜¯ 100% å‡†ç¡® è¯»å–å¼±ä¸€è‡´æ€§ éåŽ†æ—¶å¦‚æžœå‘ç”Ÿäº†ä¿®æ”¹ï¼Œå¯¹äºŽéžå®‰å…¨å®¹å™¨æ¥è®²ï¼Œä½¿ç”¨ fail-fast æœºåˆ¶ä¹Ÿå°±æ˜¯è®©éåŽ†ç«‹åˆ»å¤±è´¥ï¼ŒæŠ›å‡ºConcurrentModificationExceptionï¼Œä¸å†ç»§ç»­éåŽ† 2.8 ConcurrentHashMapç»ƒä¹ ï¼šå•è¯è®¡æ•°ç”Ÿæˆæµ‹è¯•æ•°æ® 1234567891011121314151617181920212223static final String ALPHA = &quot;abcedfghijklmnopqrstuvwxyz&quot;;public static void main(String[] args) &#123; int length = ALPHA.length(); int count = 200; List&lt;String&gt; list = new ArrayList&lt;&gt;(length * count); for (int i = 0; i &lt; length; i++) &#123; char ch = ALPHA.charAt(i); for (int j = 0; j &lt; count; j++) &#123; list.add(String.valueOf(ch)); &#125; &#125; Collections.shuffle(list); for (int i = 0; i &lt; 26; i++) &#123; try (PrintWriter out = new PrintWriter( new OutputStreamWriter( new FileOutputStream(&quot;tmp/&quot; + (i+1) + &quot;.txt&quot;)))) &#123; String collect = list.subList(i * count, (i + 1) * count).stream() .collect(Collectors.joining(&quot;\\n&quot;)); out.print(collect); &#125; catch (IOException e) &#123; &#125; &#125;&#125; æ¨¡ç‰ˆä»£ç ï¼Œæ¨¡ç‰ˆä»£ç ä¸­å°è£…äº†å¤šçº¿ç¨‹è¯»å–æ–‡ä»¶çš„ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738private static &lt;V&gt; void demo(Supplier&lt;Map&lt;String,V&gt;&gt; supplier, BiConsumer&lt;Map&lt;String,V&gt;,List&lt;String&gt;&gt; consumer) &#123; Map&lt;String, V&gt; counterMap = supplier.get(); List&lt;Thread&gt; ts = new ArrayList&lt;&gt;(); for (int i = 1; i &lt;= 26; i++) &#123; int idx = i; Thread thread = new Thread(() -&gt; &#123; List&lt;String&gt; words = readFromFile(idx); consumer.accept(counterMap, words); &#125;); ts.add(thread); &#125; ts.forEach(t-&gt;t.start()); ts.forEach(t-&gt; &#123; try &#123; t.join(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;); System.out.println(counterMap);&#125;public static List&lt;String&gt; readFromFile(int i) &#123; ArrayList&lt;String&gt; words = new ArrayList&lt;&gt;(); try (BufferedReader in = new BufferedReader(new InputStreamReader(new FileInputStream(&quot;tmp/&quot; + i +&quot;.txt&quot;)))) &#123; while(true) &#123; String word = in.readLine(); if(word == null) &#123; break; &#125; words.add(word); &#125; return words; &#125; catch (IOException e) &#123; throw new RuntimeException(e); &#125;&#125; ä½ è¦åšçš„æ˜¯å®žçŽ°ä¸¤ä¸ªå‚æ•° ä¸€æ˜¯æä¾›ä¸€ä¸ª map é›†åˆï¼Œç”¨æ¥å­˜æ”¾æ¯ä¸ªå•è¯çš„è®¡æ•°ç»“æžœï¼Œkey ä¸ºå•è¯ï¼Œvalue ä¸ºè®¡æ•° äºŒæ˜¯æä¾›ä¸€ç»„æ“ä½œï¼Œä¿è¯è®¡æ•°çš„å®‰å…¨æ€§ï¼Œä¼šä¼ é€’ map é›†åˆä»¥åŠ å•è¯ List æ­£ç¡®ç»“æžœè¾“å‡ºåº”è¯¥æ˜¯æ¯ä¸ªå•è¯å‡ºçŽ° 200 æ¬¡ 12&#123;a=200, b=200, c=200, d=200, e=200, f=200, g=200, h=200, i=200, j=200, k=200, l=200, m=200,n=200, o=200, p=200, q=200, r=200, s=200, t=200, u=200, v=200, w=200, x=200, y=200, z=200&#125; ä¸‹é¢çš„å®žçŽ°ä¸ºï¼š 12345678910111213demo( // åˆ›å»º map é›†åˆ // åˆ›å»º ConcurrentHashMap å¯¹ä¸å¯¹ï¼Ÿ () -&gt; new HashMap&lt;String, Integer&gt;(), // è¿›è¡Œè®¡æ•° (map, words) -&gt; &#123; for (String word : words) &#123; Integer counter = map.get(word); int newValue = counter == null ? 1 : counter + 1; map.put(word, newValue); &#125; &#125;); æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿè¯·æ”¹è¿› å‚è€ƒè§£ç­”1 123456789demo( () -&gt; new ConcurrentHashMap&lt;String, LongAdder&gt;(), (map, words) -&gt; &#123; for (String word : words) &#123; // æ³¨æ„ä¸èƒ½ä½¿ç”¨ putIfAbsentï¼Œæ­¤æ–¹æ³•è¿”å›žçš„æ˜¯ä¸Šä¸€æ¬¡çš„ valueï¼Œé¦–æ¬¡è°ƒç”¨è¿”å›ž null map.computeIfAbsent(word, (key) -&gt; new LongAdder()).increment(); &#125; &#125;); å‚è€ƒè§£ç­”2 123456789demo( () -&gt; new ConcurrentHashMap&lt;String, Integer&gt;(), (map, words) -&gt; &#123; for (String word : words) &#123; // å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ— éœ€åŽŸå­å˜é‡ map.merge(word, 1, Integer::sum); &#125; &#125;); ConcurrentHashMap åŽŸç†JDK 7 HashMap å¹¶å‘æ­»é“¾(1) æµ‹è¯•ä»£ç æ³¨æ„ è¦åœ¨ JDK 7 ä¸‹è¿è¡Œï¼Œå¦åˆ™æ‰©å®¹æœºåˆ¶å’Œ hash çš„è®¡ç®—æ–¹æ³•éƒ½å˜äº† ä»¥ä¸‹æµ‹è¯•ä»£ç æ˜¯ç²¾å¿ƒå‡†å¤‡çš„ï¼Œä¸è¦éšä¾¿æ”¹åŠ¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556public static void main(String[] args) &#123; // æµ‹è¯• java 7 ä¸­å“ªäº›æ•°å­—çš„ hash ç»“æžœç›¸ç­‰ System.out.println(&quot;é•¿åº¦ä¸º16æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key&quot;); for (int i = 0; i &lt; 64; i++) &#123; if (hash(i) % 16 == 1) &#123; System.out.println(i); &#125; &#125; System.out.println(&quot;é•¿åº¦ä¸º32æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key&quot;); for (int i = 0; i &lt; 64; i++) &#123; if (hash(i) % 32 == 1) &#123; System.out.println(i); &#125; &#125; // 1, 35, 16, 50 å½“å¤§å°ä¸º16æ—¶ï¼Œå®ƒä»¬åœ¨ä¸€ä¸ªæ¡¶å†… final HashMap&lt;Integer, Integer&gt; map = new HashMap&lt;Integer, Integer&gt;(); // æ”¾ 12 ä¸ªå…ƒç´  map.put(2, null); map.put(3, null); map.put(4, null); map.put(5, null); map.put(6, null); map.put(7, null); map.put(8, null); map.put(9, null); map.put(10, null); map.put(16, null); map.put(35, null); map.put(1, null); System.out.println(&quot;æ‰©å®¹å‰å¤§å°[main]:&quot;+map.size()); new Thread() &#123; @Override public void run() &#123; // æ”¾ç¬¬ 13 ä¸ªå…ƒç´ , å‘ç”Ÿæ‰©å®¹ map.put(50, null); System.out.println(&quot;æ‰©å®¹åŽå¤§å°[Thread-0]:&quot;+map.size()); &#125; &#125;.start(); new Thread() &#123; @Override public void run() &#123; // æ”¾ç¬¬ 13 ä¸ªå…ƒç´ , å‘ç”Ÿæ‰©å®¹ map.put(50, null); System.out.println(&quot;æ‰©å®¹åŽå¤§å°[Thread-1]:&quot;+map.size()); &#125; &#125;.start();&#125;final static int hash(Object k) &#123; int h = 0; if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);&#125; (2) æ­»é”å¤çŽ°è°ƒè¯•å·¥å…·ä½¿ç”¨ idea åœ¨ HashMap æºç  590 è¡ŒåŠ æ–­ç‚¹ 1int newCapacity = newTable.length; æ–­ç‚¹çš„æ¡ä»¶å¦‚ä¸‹ï¼Œç›®çš„æ˜¯è®© HashMap åœ¨æ‰©å®¹ä¸º 32 æ—¶ï¼Œå¹¶ä¸”çº¿ç¨‹ä¸º Thread-0 æˆ– Thread-1 æ—¶åœä¸‹æ¥ 12345newTable.length==32 &amp;&amp; ( Thread.currentThread().getName().equals(&quot;Thread-0&quot;)|| Thread.currentThread().getName().equals(&quot;Thread-1&quot;)) æ–­ç‚¹æš‚åœæ–¹å¼é€‰æ‹© Threadï¼Œå¦åˆ™åœ¨è°ƒè¯• Thread-0 æ—¶ï¼ŒThread-1 æ— æ³•æ¢å¤è¿è¡Œ è¿è¡Œä»£ç ï¼Œç¨‹åºåœ¨é¢„æ–™çš„æ–­ç‚¹ä½ç½®åœäº†ä¸‹æ¥ï¼Œè¾“å‡º 123456789é•¿åº¦ä¸º16æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key1163550é•¿åº¦ä¸º32æ—¶ï¼Œæ¡¶ä¸‹æ ‡ä¸º1çš„key135æ‰©å®¹å‰å¤§å°[main]:12 æŽ¥ä¸‹æ¥è¿›å…¥æ‰©å®¹æµç¨‹è°ƒè¯• åœ¨ HashMap æºç  594 è¡ŒåŠ æ–­ç‚¹ 123Entry&lt;K,V&gt; next = e.next; // 593if (rehash) // 594 // ... è¿™æ˜¯ä¸ºäº†è§‚å¯Ÿ e èŠ‚ç‚¹å’Œ next èŠ‚ç‚¹çš„çŠ¶æ€ï¼ŒThread-0 å•æ­¥æ‰§è¡Œåˆ° 594 è¡Œï¼Œå† 594 å¤„å†æ·»åŠ ä¸€ä¸ªæ–­ç‚¹ï¼ˆæ¡ä»¶Thread.currentThread().getName().equals(â€œThread-0â€)ï¼‰ è¿™æ—¶å¯ä»¥åœ¨ Variables é¢æ¿è§‚å¯Ÿåˆ° e å’Œ next å˜é‡ï¼Œä½¿ç”¨ view as -&gt; Object æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ 12e (1)-&gt;(35)-&gt;(16)-&gt;nullnext (35)-&gt;(16)-&gt;null åœ¨ Threads é¢æ¿é€‰ä¸­ Thread-1 æ¢å¤è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°æŽ§åˆ¶å°è¾“å‡ºæ–°çš„å†…å®¹å¦‚ä¸‹ï¼ŒThread-1 æ‰©å®¹å·²å®Œæˆ 12newTable[1] (35)-&gt;(1)-&gt;nullæ‰©å®¹åŽå¤§å°:13 è¿™æ—¶ Thread-0 è¿˜åœåœ¨ 594 å¤„ï¼Œ Variables é¢æ¿å˜é‡çš„çŠ¶æ€å·²ç»å˜åŒ–ä¸º 12e (1)-&gt;nullnext (35)-&gt;(1)-&gt;null ä¸ºä»€ä¹ˆå‘¢ï¼Œå› ä¸º Thread-1 æ‰©å®¹æ—¶é“¾è¡¨ä¹Ÿæ˜¯åŽåŠ å…¥çš„å…ƒç´ æ”¾å…¥é“¾è¡¨å¤´ï¼Œå› æ­¤é“¾è¡¨å°±å€’è¿‡æ¥äº†ï¼Œä½† Thread-1 è™½ç„¶ç»“æžœæ­£ç¡®ï¼Œä½†å®ƒç»“æŸåŽ Thread-0 è¿˜è¦ç»§ç»­è¿è¡Œ æŽ¥ä¸‹æ¥å°±å¯ä»¥å•æ­¥è°ƒè¯•ï¼ˆF8ï¼‰è§‚å¯Ÿæ­»é“¾çš„äº§ç”Ÿäº† ä¸‹ä¸€è½®å¾ªçŽ¯åˆ° 594ï¼Œå°† e æ¬è¿åˆ° newTable é“¾è¡¨å¤´ 123newTable[1] (1)-&gt;nulle (35)-&gt;(1)-&gt;nullnext (1)-&gt;null ä¸‹ä¸€è½®å¾ªçŽ¯åˆ° 594ï¼Œå°† e æ¬è¿åˆ° newTable é“¾è¡¨å¤´ 123newTable[1] (35)-&gt;(1)-&gt;nulle (1)-&gt;nullnext null å†çœ‹çœ‹æºç  1234567e.next = newTable[1];// è¿™æ—¶ e (1,35)// è€Œ newTable[1] (35,1)-&gt;(1,35) å› ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡newTable[1] = e;// å†å°è¯•å°† e ä½œä¸ºé“¾è¡¨å¤´, æ­»é“¾å·²æˆe = next;// è™½ç„¶ next æ˜¯ null, ä¼šè¿›å…¥ä¸‹ä¸€ä¸ªé“¾è¡¨çš„å¤åˆ¶, ä½†æ­»é“¾å·²ç»å½¢æˆäº† (3) æºç åˆ†æžHashMap çš„å¹¶å‘æ­»é“¾å‘ç”Ÿåœ¨æ‰©å®¹æ—¶ 12345678910111213141516171819// å°† table è¿ç§»è‡³ newTablevoid transfer(Entry[] newTable, boolean rehash) &#123; int newCapacity = newTable.length; for (Entry&lt;K,V&gt; e : table) &#123; while(null != e) &#123; Entry&lt;K,V&gt; next = e.next; // 1 å¤„ if (rehash) &#123; e.hash = null == e.key ? 0 : hash(e.key); &#125; int i = indexFor(e.hash, newCapacity); // 2 å¤„ // å°†æ–°å…ƒç´ åŠ å…¥ newTable[i], åŽŸ newTable[i] ä½œä¸ºæ–°å…ƒç´ çš„ next e.next = newTable[i]; newTable[i] = e; e = next; &#125; &#125;&#125; å‡è®¾ map ä¸­åˆå§‹å…ƒç´ æ˜¯ 1234567891011121314151617181920åŽŸå§‹é“¾è¡¨ï¼Œæ ¼å¼ï¼š[ä¸‹æ ‡] (key,next)[1] (1,35)-&gt;(35,16)-&gt;(16,null)çº¿ç¨‹ a æ‰§è¡Œåˆ° 1 å¤„ ï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e ä¸º (1,35)ï¼Œè€Œå±€éƒ¨å˜é‡ next ä¸º (35,16) çº¿ç¨‹ a æŒ‚èµ·çº¿ç¨‹ b å¼€å§‹æ‰§è¡Œç¬¬ä¸€æ¬¡å¾ªçŽ¯[1] (1,null)ç¬¬äºŒæ¬¡å¾ªçŽ¯[1] (35,1)-&gt;(1,null)ç¬¬ä¸‰æ¬¡å¾ªçŽ¯[1] (35,1)-&gt;(1,null)[17] (16,null)åˆ‡æ¢å›žçº¿ç¨‹ aï¼Œæ­¤æ—¶å±€éƒ¨å˜é‡ e å’Œ next è¢«æ¢å¤ï¼Œå¼•ç”¨æ²¡å˜ä½†å†…å®¹å˜äº†ï¼še çš„å†…å®¹è¢«æ”¹ä¸º (1,null)ï¼Œè€Œ next çš„å†…å®¹è¢«æ”¹ä¸º (35,1) å¹¶é“¾å‘ (1,null)ç¬¬ä¸€æ¬¡å¾ªçŽ¯[1] (1,null)ç¬¬äºŒæ¬¡å¾ªçŽ¯ï¼Œæ³¨æ„è¿™æ—¶ e æ˜¯ (35,1) å¹¶é“¾å‘ (1,null) æ‰€ä»¥ next åˆæ˜¯ (1,null)[1] (35,1)-&gt;(1,null)ç¬¬ä¸‰æ¬¡å¾ªçŽ¯ï¼Œe æ˜¯ (1,null)ï¼Œè€Œ next æ˜¯ nullï¼Œä½† e è¢«æ”¾å…¥é“¾è¡¨å¤´ï¼Œè¿™æ · e.next å˜æˆäº† 35 ï¼ˆ2 å¤„ï¼‰[1] (1,35)-&gt;(35,1)-&gt;(1,35)å·²ç»æ˜¯æ­»é“¾äº† (4) å°ç»“ ç©¶å…¶åŽŸå› ï¼Œæ˜¯å› ä¸ºåœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä½¿ç”¨äº†éžçº¿ç¨‹å®‰å…¨çš„ map é›†åˆ JDK 8 è™½ç„¶å°†æ‰©å®¹ç®—æ³•åšäº†è°ƒæ•´ï¼Œä¸å†å°†å…ƒç´ åŠ å…¥é“¾è¡¨å¤´ï¼ˆè€Œæ˜¯ä¿æŒä¸Žæ‰©å®¹å‰ä¸€æ ·çš„é¡ºåºï¼‰ï¼Œä½†ä»ä¸æ„å‘³ç€èƒ½å¤Ÿåœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹èƒ½å¤Ÿå®‰å…¨æ‰©å®¹ï¼Œè¿˜ä¼šå‡ºçŽ°å…¶å®ƒé—®é¢˜ï¼ˆå¦‚æ‰©å®¹ä¸¢æ•°æ®ï¼‰ JDK 8 ConcurrentHashMap(1) é‡è¦å±žæ€§å’Œå†…éƒ¨ç±»12345678910111213141516171819// é»˜è®¤ä¸º 0// å½“åˆå§‹åŒ–æ—¶, ä¸º -1// å½“æ‰©å®¹æ—¶, ä¸º -(1 + æ‰©å®¹çº¿ç¨‹æ•°)// å½“åˆå§‹åŒ–æˆ–æ‰©å®¹å®ŒæˆåŽï¼Œä¸º ä¸‹ä¸€æ¬¡çš„æ‰©å®¹çš„é˜ˆå€¼å¤§å°private transient volatile int sizeCtl;// æ•´ä¸ª ConcurrentHashMap å°±æ˜¯ä¸€ä¸ª Node[]static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123;&#125;// hash è¡¨transient volatile Node&lt;K,V&gt;[] table;// æ‰©å®¹æ—¶çš„ æ–° hash è¡¨private transient volatile Node&lt;K,V&gt;[] nextTable;// æ‰©å®¹æ—¶å¦‚æžœæŸä¸ª bin è¿ç§»å®Œæ¯•, ç”¨ ForwardingNode ä½œä¸ºæ—§ table bin çš„å¤´ç»“ç‚¹static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;&#125;// ç”¨åœ¨ compute ä»¥åŠ computeIfAbsent æ—¶, ç”¨æ¥å ä½, è®¡ç®—å®ŒæˆåŽæ›¿æ¢ä¸ºæ™®é€š Nodestatic final class ReservationNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;&#125;// ä½œä¸º treebin çš„å¤´èŠ‚ç‚¹, å­˜å‚¨ root å’Œ firststatic final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;&#125;// ä½œä¸º treebin çš„èŠ‚ç‚¹, å­˜å‚¨ parent, left, rightstatic final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123;&#125; (2) é‡è¦æ–¹æ³•123456// èŽ·å– Node[] ä¸­ç¬¬ i ä¸ª Nodestatic final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i)// cas ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, c ä¸ºæ—§å€¼, v ä¸ºæ–°å€¼static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)// ç›´æŽ¥ä¿®æ”¹ Node[] ä¸­ç¬¬ i ä¸ª Node çš„å€¼, v ä¸ºæ–°å€¼static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) (3) æž„é€ å™¨åˆ†æžå¯ä»¥çœ‹åˆ°å®žçŽ°äº†æ‡’æƒ°åˆå§‹åŒ–ï¼Œåœ¨æž„é€ æ–¹æ³•ä¸­ä»…ä»…è®¡ç®—äº† table çš„å¤§å°ï¼Œä»¥åŽåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æ‰ä¼šçœŸæ­£åˆ›å»º 1234567891011public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) &#123; if (!(loadFactor &gt; 0.0f) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (initialCapacity &lt; concurrencyLevel) // Use at least as many bins initialCapacity = concurrencyLevel; // as estimated threads long size = (long)(1.0 + (long)initialCapacity / loadFactor); // tableSizeFor ä»ç„¶æ˜¯ä¿è¯è®¡ç®—çš„å¤§å°æ˜¯ 2^n, å³ 16,32,64 ... int cap = (size &gt;= (long)MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : tableSizeFor((int)size); this.sizeCtl = cap;&#125; (4) getæµç¨‹1234567891011121314151617181920212223public V get(Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek; // spread æ–¹æ³•èƒ½ç¡®ä¿è¿”å›žç»“æžœæ˜¯æ­£æ•° int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) &#123; // å¦‚æžœå¤´ç»“ç‚¹å·²ç»æ˜¯è¦æŸ¥æ‰¾çš„ key if ((eh = e.hash) == h) &#123; if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; &#125; // hash ä¸ºè´Ÿæ•°è¡¨ç¤ºè¯¥ bin åœ¨æ‰©å®¹ä¸­æˆ–æ˜¯ treebin, è¿™æ—¶è°ƒç”¨ find æ–¹æ³•æ¥æŸ¥æ‰¾ else if (eh &lt; 0) return (p = e.find(h, key)) != null ? p.val : null; // æ­£å¸¸éåŽ†é“¾è¡¨, ç”¨ equals æ¯”è¾ƒ while ((e = e.next) != null) &#123; if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; &#125; &#125; return null;&#125; (5) putæµç¨‹ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161public V put(K key, V value) &#123; return putVal(key, value, false);&#125;final V putVal(K key, V value, boolean onlyIfAbsent) &#123; if (key == null || value == null) throw new NullPointerException(); // å…¶ä¸­ spread æ–¹æ³•ä¼šç»¼åˆé«˜ä½ä½Žä½, å…·æœ‰æ›´å¥½çš„ hash æ€§ int hash = spread(key.hashCode()); int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) &#123; // f æ˜¯é“¾è¡¨å¤´èŠ‚ç‚¹ // fh æ˜¯é“¾è¡¨å¤´ç»“ç‚¹çš„ hash // i æ˜¯é“¾è¡¨åœ¨ table ä¸­çš„ä¸‹æ ‡ Node&lt;K,V&gt; f; int n, i, fh; // è¦åˆ›å»º table if (tab == null || (n = tab.length) == 0) // åˆå§‹åŒ– table ä½¿ç”¨äº† cas, æ— éœ€ synchronized åˆ›å»ºæˆåŠŸ, è¿›å…¥ä¸‹ä¸€è½®å¾ªçŽ¯ tab = initTable(); // è¦åˆ›å»ºé“¾è¡¨å¤´èŠ‚ç‚¹ else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; // æ·»åŠ é“¾è¡¨å¤´ä½¿ç”¨äº† cas, æ— éœ€ synchronized if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; &#125; // å¸®å¿™æ‰©å®¹ else if ((fh = f.hash) == MOVED) // å¸®å¿™ä¹‹åŽ, è¿›å…¥ä¸‹ä¸€è½®å¾ªçŽ¯ tab = helpTransfer(tab, f); else &#123; V oldVal = null; // é”ä½é“¾è¡¨å¤´èŠ‚ç‚¹ synchronized (f) &#123; // å†æ¬¡ç¡®è®¤é“¾è¡¨å¤´èŠ‚ç‚¹æ²¡æœ‰è¢«ç§»åŠ¨ if (tabAt(tab, i) == f) &#123; // é“¾è¡¨ if (fh &gt;= 0) &#123; binCount = 1; // éåŽ†é“¾è¡¨ for (Node&lt;K,V&gt; e = f;; ++binCount) &#123; K ek; // æ‰¾åˆ°ç›¸åŒçš„ key if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; // æ›´æ–° if (!onlyIfAbsent) e.val = value; break; &#125; Node&lt;K,V&gt; pred = e; // å·²ç»æ˜¯æœ€åŽçš„èŠ‚ç‚¹äº†, æ–°å¢ž Node, è¿½åŠ è‡³é“¾è¡¨å°¾ if ((e = e.next) == null) &#123; pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; &#125; &#125; &#125; // çº¢é»‘æ ‘ else if (f instanceof TreeBin) &#123; Node&lt;K,V&gt; p; binCount = 2; // putTreeVal ä¼šçœ‹ key æ˜¯å¦å·²ç»åœ¨æ ‘ä¸­, æ˜¯, åˆ™è¿”å›žå¯¹åº”çš„ TreeNode if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; // é‡Šæ”¾é“¾è¡¨å¤´èŠ‚ç‚¹çš„é” &#125; if (binCount != 0) &#123; if (binCount &gt;= TREEIFY_THRESHOLD) // å¦‚æžœé“¾è¡¨é•¿åº¦ &gt;= æ ‘åŒ–é˜ˆå€¼(8), è¿›è¡Œé“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘ treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; // å¢žåŠ  size è®¡æ•° addCount(1L, binCount); return null;&#125;private final Node&lt;K,V&gt;[] initTable() &#123; Node&lt;K,V&gt;[] tab; int sc; while ((tab = table) == null || tab.length == 0) &#123; if ((sc = sizeCtl) &lt; 0) Thread.yield(); // å°è¯•å°† sizeCtl è®¾ç½®ä¸º -1ï¼ˆè¡¨ç¤ºåˆå§‹åŒ– tableï¼‰ else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; // èŽ·å¾—é”, åˆ›å»º table, è¿™æ—¶å…¶å®ƒçº¿ç¨‹ä¼šåœ¨ while() å¾ªçŽ¯ä¸­ yield ç›´è‡³ table åˆ›å»º try &#123; if ((tab = table) == null || tab.length == 0) &#123; int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = tab = nt; sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; &#125; break; &#125; &#125; return tab;&#125;// check æ˜¯ä¹‹å‰ binCount çš„ä¸ªæ•°private final void addCount(long x, int check) &#123; CounterCell[] as; long b, s; if ( // å·²ç»æœ‰äº† counterCells, å‘ cell ç´¯åŠ  (as = counterCells) != null || // è¿˜æ²¡æœ‰, å‘ baseCount ç´¯åŠ  !U.compareAndSwapLong(this, BASECOUNT, b = baseCount, s = b + x) ) &#123; CounterCell a; long v; int m; boolean uncontended = true; if ( // è¿˜æ²¡æœ‰ counterCells as == null || (m = as.length - 1) &lt; 0 || // è¿˜æ²¡æœ‰ cell (a = as[ThreadLocalRandom.getProbe() &amp; m]) == null || // cell cas å¢žåŠ è®¡æ•°å¤±è´¥ !(uncontended = U.compareAndSwapLong(a, CELLVALUE, v = a.value, v + x)) ) &#123; // åˆ›å»ºç´¯åŠ å•å…ƒæ•°ç»„å’Œcell, ç´¯åŠ é‡è¯• fullAddCount(x, uncontended); return; &#125; if (check &lt;= 1) return; // èŽ·å–å…ƒç´ ä¸ªæ•° s = sumCount(); &#125; if (check &gt;= 0) &#123; Node&lt;K,V&gt;[] tab, nt; int n, sc; while (s &gt;= (long)(sc = sizeCtl) &amp;&amp; (tab = table) != null &amp;&amp; (n = tab.length) &lt; MAXIMUM_CAPACITY) &#123; int rs = resizeStamp(n); if (sc &lt; 0) &#123; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; // newtable å·²ç»åˆ›å»ºäº†ï¼Œå¸®å¿™æ‰©å®¹ if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); &#125; // éœ€è¦æ‰©å®¹ï¼Œè¿™æ—¶ newtable æœªåˆ›å»º else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); s = sumCount(); &#125; &#125;&#125; (6) size è®¡ç®—æµç¨‹size è®¡ç®—å®žé™…å‘ç”Ÿåœ¨ putï¼Œremove æ”¹å˜é›†åˆå…ƒç´ çš„æ“ä½œä¹‹ä¸­ æ²¡æœ‰ç«žäº‰å‘ç”Ÿï¼Œå‘ baseCount ç´¯åŠ è®¡æ•° æœ‰ç«žäº‰å‘ç”Ÿï¼Œæ–°å»º counterCellsï¼Œå‘å…¶ä¸­çš„ä¸€ä¸ª cell ç´¯åŠ è®¡æ•° counterCells åˆå§‹æœ‰ä¸¤ä¸ª cell å¦‚æžœè®¡æ•°ç«žäº‰æ¯”è¾ƒæ¿€çƒˆï¼Œä¼šåˆ›å»ºæ–°çš„ cell æ¥ç´¯åŠ è®¡æ•° 123456789101112131415161718public int size() &#123; long n = sumCount(); return ((n &lt; 0L) ? 0 : (n &gt; (long)Integer.MAX_VALUE) ? Integer.MAX_VALUE : (int)n);&#125;final long sumCount() &#123; CounterCell[] as = counterCells; CounterCell a; // å°† baseCount è®¡æ•°ä¸Žæ‰€æœ‰ cell è®¡æ•°ç´¯åŠ  long sum = baseCount; if (as != null) &#123; for (int i = 0; i &lt; as.length; ++i) &#123; if ((a = as[i]) != null) sum += a.value; &#125; &#125; return sum;&#125; Java 8 æ•°ç»„ï¼ˆNodeï¼‰ +ï¼ˆ é“¾è¡¨ Node | çº¢é»‘æ ‘ TreeNode ï¼‰ ä»¥ä¸‹æ•°ç»„ç®€ç§°ï¼ˆtableï¼‰ï¼Œé“¾è¡¨ç®€ç§°ï¼ˆbinï¼‰ åˆå§‹åŒ–ï¼Œä½¿ç”¨ cas æ¥ä¿è¯å¹¶å‘å®‰å…¨ï¼Œæ‡’æƒ°åˆå§‹åŒ– table æ ‘åŒ–ï¼Œå½“ table.length &lt; 64 æ—¶ï¼Œå…ˆå°è¯•æ‰©å®¹ï¼Œè¶…è¿‡ 64 æ—¶ï¼Œå¹¶ä¸” bin.length &gt; 8 æ—¶ï¼Œä¼šå°†é“¾è¡¨æ ‘åŒ–ï¼Œæ ‘åŒ–è¿‡ç¨‹ä¼šç”¨ synchronized é”ä½é“¾è¡¨å¤´ putï¼Œå¦‚æžœè¯¥ bin å°šæœªåˆ›å»ºï¼Œåªéœ€è¦ä½¿ç”¨ cas åˆ›å»º binï¼›å¦‚æžœå·²ç»æœ‰äº†ï¼Œé”ä½é“¾è¡¨å¤´è¿›è¡ŒåŽç»­ put æ“ä½œï¼Œå…ƒç´ æ·»åŠ è‡³ bin çš„å°¾éƒ¨ getï¼Œæ— é”æ“ä½œä»…éœ€è¦ä¿è¯å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ get æ“ä½œæ‹¿åˆ°çš„æ˜¯ ForwardingNode å®ƒä¼šè®© get æ“ä½œåœ¨æ–°table è¿›è¡Œæœç´¢ æ‰©å®¹ï¼Œæ‰©å®¹æ—¶ä»¥ bin ä¸ºå•ä½è¿›è¡Œï¼Œéœ€è¦å¯¹ bin è¿›è¡Œ synchronizedï¼Œä½†è¿™æ—¶å¦™çš„æ˜¯å…¶å®ƒç«žäº‰çº¿ç¨‹ä¹Ÿä¸æ˜¯æ— äº‹å¯åšï¼Œå®ƒä»¬ä¼šå¸®åŠ©æŠŠå…¶å®ƒ bin è¿›è¡Œæ‰©å®¹ï¼Œæ‰©å®¹æ—¶å¹³å‡åªæœ‰ 1/6 çš„èŠ‚ç‚¹ä¼šæŠŠå¤åˆ¶åˆ°æ–° table ä¸­ sizeï¼Œå…ƒç´ ä¸ªæ•°ä¿å­˜åœ¨ baseCount ä¸­ï¼Œå¹¶å‘æ—¶çš„ä¸ªæ•°å˜åŠ¨ä¿å­˜åœ¨ CounterCell[] å½“ä¸­ã€‚æœ€åŽç»Ÿè®¡æ•°é‡æ—¶ç´¯åŠ å³å¯ æºç åˆ†æž http://www.importnew.com/28263.html å…¶å®ƒå®žçŽ° Cliff Clickâ€™s high scale lib JDK 7 ConcurrentHashMapå®ƒç»´æŠ¤äº†ä¸€ä¸ª segment æ•°ç»„ï¼Œæ¯ä¸ª segment å¯¹åº”ä¸€æŠŠé” ä¼˜ç‚¹ï¼šå¦‚æžœå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒçš„ segmentï¼Œå®žé™…æ˜¯æ²¡æœ‰å†²çªçš„ï¼Œè¿™ä¸Ž jdk8 ä¸­æ˜¯ç±»ä¼¼çš„ ç¼ºç‚¹ï¼šSegments æ•°ç»„é»˜è®¤å¤§å°ä¸º16ï¼Œè¿™ä¸ªå®¹é‡åˆå§‹åŒ–æŒ‡å®šåŽå°±ä¸èƒ½æ”¹å˜äº†ï¼Œå¹¶ä¸”ä¸æ˜¯æ‡’æƒ°åˆå§‹åŒ– (1) æž„é€ å™¨åˆ†æž1234567891011121314151617181920212223242526272829303132public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) &#123; if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; // ssize å¿…é¡»æ˜¯ 2^n, å³ 2, 4, 8, 16 ... è¡¨ç¤ºäº† segments æ•°ç»„çš„å¤§å° int sshift = 0; int ssize = 1; while (ssize &lt; concurrencyLevel) &#123; ++sshift; ssize &lt;&lt;= 1; &#125; // segmentShift é»˜è®¤æ˜¯ 32 - 4 = 28 this.segmentShift = 32 - sshift; // segmentMask é»˜è®¤æ˜¯ 15 å³ 0000 0000 0000 1111 this.segmentMask = ssize - 1; if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; int c = initialCapacity / ssize; if (c * ssize &lt; initialCapacity) ++c; int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // åˆ›å»º segments and segments[0] Segment&lt;K,V&gt; s0 = new Segment&lt;K,V&gt;(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V&gt;[])new HashEntry[cap]); Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss;&#125; æž„é€ å®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å¯ä»¥çœ‹åˆ° ConcurrentHashMap æ²¡æœ‰å®žçŽ°æ‡’æƒ°åˆå§‹åŒ–ï¼Œç©ºé—´å ç”¨ä¸å‹å¥½ å…¶ä¸­ this.segmentShift å’Œ this.segmentMask çš„ä½œç”¨æ˜¯å†³å®šå°† key çš„ hash ç»“æžœåŒ¹é…åˆ°å“ªä¸ª segment ä¾‹å¦‚ï¼Œæ ¹æ®æŸä¸€ hash å€¼æ±‚ segment ä½ç½®ï¼Œå…ˆå°†é«˜ä½å‘ä½Žä½ç§»åŠ¨ this.segmentShift ä½ (2) putæµç¨‹1234567891011121314151617public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; if (value == null) throw new NullPointerException(); int hash = hash(key); // è®¡ç®—å‡º segment ä¸‹æ ‡ int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; // èŽ·å¾— segment å¯¹è±¡, åˆ¤æ–­æ˜¯å¦ä¸º null, æ˜¯åˆ™åˆ›å»ºè¯¥ segment if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) &#123; // è¿™æ—¶ä¸èƒ½ç¡®å®šæ˜¯å¦çœŸçš„ä¸º null, å› ä¸ºå…¶å®ƒçº¿ç¨‹ä¹Ÿå‘çŽ°è¯¥ segment ä¸º null, // å› æ­¤åœ¨ ensureSegment é‡Œç”¨ cas æ–¹å¼ä¿è¯è¯¥ segment å®‰å…¨æ€§ s = ensureSegment(j); &#125; // è¿›å…¥ segment çš„put æµç¨‹ return s.put(key, hash, value, false);&#125; segment ç»§æ‰¿äº†å¯é‡å…¥é”ï¼ˆReentrantLockï¼‰ï¼Œå®ƒçš„ put æ–¹æ³•ä¸º 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; // å°è¯•åŠ é” HashEntry&lt;K,V&gt; node = tryLock() ? null : // å¦‚æžœä¸æˆåŠŸ, è¿›å…¥ scanAndLockForPut æµç¨‹ // å¦‚æžœæ˜¯å¤šæ ¸ cpu æœ€å¤š tryLock 64 æ¬¡, è¿›å…¥ lock æµç¨‹ // åœ¨å°è¯•æœŸé—´, è¿˜å¯ä»¥é¡ºä¾¿çœ‹è¯¥èŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­æœ‰æ²¡æœ‰, å¦‚æžœæ²¡æœ‰é¡ºä¾¿åˆ›å»ºå‡ºæ¥ scanAndLockForPut(key, hash, value); // æ‰§è¡Œåˆ°è¿™é‡Œ segment å·²ç»è¢«æˆåŠŸåŠ é”, å¯ä»¥å®‰å…¨æ‰§è¡Œ V oldValue; try &#123; HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123; // æ›´æ–° K k; if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123; // æ–°å¢ž // 1) ä¹‹å‰ç­‰å¾…é”æ—¶, node å·²ç»è¢«åˆ›å»º, next æŒ‡å‘é“¾è¡¨å¤´ if (node != null) node.setNext(first); else // 2) åˆ›å»ºæ–° node node = new HashEntry&lt;K,V&gt;(hash, key, value, first); int c = count + 1; // 3) æ‰©å®¹ if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY) rehash(node); else // å°† node ä½œä¸ºé“¾è¡¨å¤´ setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; (3) rehashæµç¨‹å‘ç”Ÿåœ¨ put ä¸­ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»èŽ·å¾—äº†é”ï¼Œå› æ­¤ rehash æ—¶ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647private void rehash(HashEntry&lt;K,V&gt; node) &#123; HashEntry&lt;K,V&gt;[] oldTable = table; int oldCapacity = oldTable.length; int newCapacity = oldCapacity &lt;&lt; 1; threshold = (int)(newCapacity * loadFactor); HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; int sizeMask = newCapacity - 1; for (int i = 0; i &lt; oldCapacity ; i++) &#123; HashEntry&lt;K,V&gt; e = oldTable[i]; if (e != null) &#123; HashEntry&lt;K,V&gt; next = e.next; int idx = e.hash &amp; sizeMask; if (next == null) // Single node on list newTable[idx] = e; else &#123; // Reuse consecutive sequence at same slot HashEntry&lt;K,V&gt; lastRun = e; int lastIdx = idx; // è¿‡ä¸€éé“¾è¡¨, å°½å¯èƒ½æŠŠ rehash åŽ idx ä¸å˜çš„èŠ‚ç‚¹é‡ç”¨ for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) &#123; int k = last.hash &amp; sizeMask; if (k != lastIdx) &#123; lastIdx = k; lastRun = last; &#125; &#125; newTable[lastIdx] = lastRun; // å‰©ä½™èŠ‚ç‚¹éœ€è¦æ–°å»º for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123; V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V&gt; n = newTable[k]; newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); &#125; &#125; &#125; &#125; // æ‰©å®¹å®Œæˆ, æ‰åŠ å…¥æ–°çš„èŠ‚ç‚¹ int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; // æ›¿æ¢ä¸ºæ–°çš„ HashEntry table table = newTable;&#125; é™„ï¼Œè°ƒè¯•ä»£ç  12345678910111213141516171819202122232425262728293031323334353637public static void main(String[] args) &#123; ConcurrentHashMap&lt;Integer, String&gt; map = new ConcurrentHashMap&lt;&gt;(); for (int i = 0; i &lt; 1000; i++) &#123; int hash = hash(i); int segmentIndex = (hash &gt;&gt;&gt; 28) &amp; 15; if (segmentIndex == 4 &amp;&amp; hash % 8 == 2) &#123; System.out.println(i + &quot;\\t&quot; + segmentIndex + &quot;\\t&quot; + hash % 2 + &quot;\\t&quot; + hash % 4 + &quot;\\t&quot; + hash % 8); &#125; &#125; map.put(1, &quot;value&quot;); map.put(15, &quot;value&quot;); // 2 æ‰©å®¹ä¸º 4 15 çš„ hash%8 ä¸Žå…¶ä»–ä¸åŒ map.put(169, &quot;value&quot;); map.put(197, &quot;value&quot;); // 4 æ‰©å®¹ä¸º 8 map.put(341, &quot;value&quot;); map.put(484, &quot;value&quot;); map.put(545, &quot;value&quot;); // 8 æ‰©å®¹ä¸º 16 map.put(912, &quot;value&quot;); map.put(941, &quot;value&quot;); System.out.println(&quot;ok&quot;);&#125;private static int hash(Object k) &#123; int h = 0; if ((0 != h) &amp;&amp; (k instanceof String)) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); // Spread bits to regularize both segment and index locations, // using variant of single-word Wang/Jenkins hash. h += (h &lt;&lt; 15) ^ 0xffffcd7d; h ^= (h &gt;&gt;&gt; 10); h += (h &lt;&lt; 3); h ^= (h &gt;&gt;&gt; 6); h += (h &lt;&lt; 2) + (h &lt;&lt; 14); int v = h ^ (h &gt;&gt;&gt; 16); return v;&#125; (4) getæµç¨‹get æ—¶å¹¶æœªåŠ é”ï¼Œç”¨äº† UNSAFE æ–¹æ³•ä¿è¯äº†å¯è§æ€§ï¼Œæ‰©å®¹è¿‡ç¨‹ä¸­ï¼Œget å…ˆå‘ç”Ÿå°±ä»Žæ—§è¡¨å–å†…å®¹ï¼Œget åŽå‘ç”Ÿå°±ä»Žæ–°è¡¨å–å†…å®¹ 12345678910111213141516171819public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; int h = hash(key); // u ä¸º segment å¯¹è±¡åœ¨æ•°ç»„ä¸­çš„åç§»é‡ long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; // s å³ä¸º segment if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null;&#125; (5) size è®¡ç®—æµç¨‹ è®¡ç®—å…ƒç´ ä¸ªæ•°å‰ï¼Œå…ˆä¸åŠ é”è®¡ç®—ä¸¤æ¬¡ï¼Œå¦‚æžœå‰åŽä¸¤æ¬¡ç»“æžœå¦‚ä¸€æ ·ï¼Œè®¤ä¸ºä¸ªæ•°æ­£ç¡®è¿”å›ž å¦‚æžœä¸ä¸€æ ·ï¼Œè¿›è¡Œé‡è¯•ï¼Œé‡è¯•æ¬¡æ•°è¶…è¿‡ 3ï¼Œå°†æ‰€æœ‰ segment é”ä½ï¼Œé‡æ–°è®¡ç®—ä¸ªæ•°è¿”å›ž 12345678910111213141516171819202122232425262728293031323334353637383940public int size() &#123; // Try a few times to get accurate count. On failure due to // continuous async changes in table, resort to locking. final Segment&lt;K,V&gt;[] segments = this.segments; int size; boolean overflow; // true if size overflows 32 bits long sum; // sum of modCounts long last = 0L; // previous sum int retries = -1; // first iteration isn&#x27;t retry try &#123; for (;;) &#123; if (retries++ == RETRIES_BEFORE_LOCK) &#123; // è¶…è¿‡é‡è¯•æ¬¡æ•°, éœ€è¦åˆ›å»ºæ‰€æœ‰ segment å¹¶åŠ é” for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation &#125; sum = 0L; size = 0; overflow = false; for (int j = 0; j &lt; segments.length; ++j) &#123; Segment&lt;K,V&gt; seg = segmentAt(segments, j); if (seg != null) &#123; sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; &#125; &#125; if (sum == last) break; last = sum; &#125; &#125; finally &#123; if (retries &gt; RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); &#125; &#125; return overflow ? Integer.MAX_VALUE : size;&#125; 2.9 BlockingQueueåŸºæœ¬çš„å…¥é˜Ÿå‡ºé˜Ÿ1234567891011121314public class LinkedBlockingQueue&lt;E&gt; extends AbstractQueue&lt;E&gt; implements BlockingQueue&lt;E&gt;, java.io.Serializable &#123; static class Node&lt;E&gt; &#123; E item; /*** ä¸‹åˆ—ä¸‰ç§æƒ…å†µä¹‹ä¸€* - çœŸæ­£çš„åŽç»§èŠ‚ç‚¹* - è‡ªå·±, å‘ç”Ÿåœ¨å‡ºé˜Ÿæ—¶* - null, è¡¨ç¤ºæ˜¯æ²¡æœ‰åŽç»§èŠ‚ç‚¹, æ˜¯æœ€åŽäº†*/ Node&lt;E&gt; next; Node(E x) &#123; item = x; &#125; &#125;&#125; åˆå§‹åŒ–é“¾è¡¨ last = head = new Node&lt;E&gt;(null); Dummy èŠ‚ç‚¹ç”¨æ¥å ä½ï¼Œitem ä¸º null å½“ä¸€ä¸ªèŠ‚ç‚¹å…¥é˜Ÿ `last = last.next = node; å†æ¥ä¸€ä¸ªèŠ‚ç‚¹å…¥é˜Ÿ last = last.next = node; å‡ºé˜Ÿ 123456Node&lt;E&gt; h = head;Node&lt;E&gt; first = h.next;h.next = h; // help GCE x = first.item;first.item = null;return x; h = head first = h.next h.next = h head = first 123E x = first.item;first.item = null;return x; åŠ é”åˆ†æž==é«˜æ˜Žä¹‹å¤„==åœ¨äºŽç”¨äº†ä¸¤æŠŠé”å’Œ dummy èŠ‚ç‚¹ ç”¨ä¸€æŠŠé”ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œæœ€å¤šåªå…è®¸æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼ˆç”Ÿäº§è€…æˆ–æ¶ˆè´¹è€…ï¼ŒäºŒé€‰ä¸€ï¼‰æ‰§è¡Œ ç”¨ä¸¤æŠŠé”ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ï¼ˆä¸€ä¸ªç”Ÿäº§è€…ä¸Žä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰æ‰§è¡Œ æ¶ˆè´¹è€…ä¸Žæ¶ˆè´¹è€…çº¿ç¨‹ä»ç„¶ä¸²è¡Œ ç”Ÿäº§è€…ä¸Žç”Ÿäº§è€…çº¿ç¨‹ä»ç„¶ä¸²è¡Œ çº¿ç¨‹å®‰å…¨åˆ†æž å½“èŠ‚ç‚¹æ€»æ•°å¤§äºŽ 2 æ—¶ï¼ˆåŒ…æ‹¬ dummy èŠ‚ç‚¹ï¼‰ï¼ŒputLock ä¿è¯çš„æ˜¯ last èŠ‚ç‚¹çš„çº¿ç¨‹å®‰å…¨ï¼ŒtakeLock ä¿è¯çš„æ˜¯ head èŠ‚ç‚¹çš„çº¿ç¨‹å®‰å…¨ã€‚ä¸¤æŠŠé”ä¿è¯äº†å…¥é˜Ÿå’Œå‡ºé˜Ÿæ²¡æœ‰ç«žäº‰ å½“èŠ‚ç‚¹æ€»æ•°ç­‰äºŽ 2 æ—¶ï¼ˆå³ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼Œä¸€ä¸ªæ­£å¸¸èŠ‚ç‚¹ï¼‰è¿™æ—¶å€™ï¼Œä»ç„¶æ˜¯ä¸¤æŠŠé”é”ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸ä¼šç«žäº‰ å½“èŠ‚ç‚¹æ€»æ•°ç­‰äºŽ 1 æ—¶ï¼ˆå°±ä¸€ä¸ª dummy èŠ‚ç‚¹ï¼‰è¿™æ—¶ take çº¿ç¨‹ä¼šè¢« notEmpty æ¡ä»¶é˜»å¡žï¼Œæœ‰ç«žäº‰ï¼Œä¼šé˜»å¡ž 1234// ç”¨äºŽ put(é˜»å¡ž) offer(éžé˜»å¡ž)private final ReentrantLock putLock = new ReentrantLock();// ç”¨æˆ· take(é˜»å¡ž) poll(éžé˜»å¡ž)private final ReentrantLock takeLock = new ReentrantLock(); put æ“ä½œ 12345678910111213141516171819202122232425262728public void put(E e) throws InterruptedException &#123; if (e == null) throw new NullPointerException(); int c = -1; Node&lt;E&gt; node = new Node&lt;E&gt;(e); final ReentrantLock putLock = this.putLock; // count ç”¨æ¥ç»´æŠ¤å…ƒç´ è®¡æ•° final AtomicInteger count = this.count; putLock.lockInterruptibly(); try &#123; // æ»¡äº†ç­‰å¾… while (count.get() == capacity) &#123; // å€’è¿‡æ¥è¯»å°±å¥½: ç­‰å¾… notFull notFull.await(); &#125; // æœ‰ç©ºä½, å…¥é˜Ÿä¸”è®¡æ•°åŠ ä¸€ enqueue(node); c = count.getAndIncrement(); // é™¤äº†è‡ªå·± put ä»¥å¤–, é˜Ÿåˆ—è¿˜æœ‰ç©ºä½, ç”±è‡ªå·±å«é†’å…¶ä»– put çº¿ç¨‹ if (c + 1 &lt; capacity) notFull.signal(); &#125; finally &#123; putLock.unlock(); &#125; // å¦‚æžœé˜Ÿåˆ—ä¸­æœ‰ä¸€ä¸ªå…ƒç´ , å«é†’ take çº¿ç¨‹ if (c == 0) // è¿™é‡Œè°ƒç”¨çš„æ˜¯ notEmpty.signal() è€Œä¸æ˜¯ notEmpty.signalAll() æ˜¯ä¸ºäº†å‡å°‘ç«žäº‰ signalNotEmpty();&#125; take æ“ä½œ 123456789101112131415161718192021222324public E take() throws InterruptedException &#123; E x; int c = -1; final AtomicInteger count = this.count; final ReentrantLock takeLock = this.takeLock; takeLock.lockInterruptibly(); try &#123; while (count.get() == 0) &#123; notEmpty.await(); &#125; x = dequeue(); c = count.getAndDecrement(); if (c &gt; 1) notEmpty.signal(); &#125; finally &#123; takeLock.unlock(); &#125; // å¦‚æžœé˜Ÿåˆ—ä¸­åªæœ‰ä¸€ä¸ªç©ºä½æ—¶, å«é†’ put çº¿ç¨‹ // å¦‚æžœæœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œå‡ºé˜Ÿ, ç¬¬ä¸€ä¸ªçº¿ç¨‹æ»¡è¶³ c == capacity, ä½†åŽç»­çº¿ç¨‹ c &lt; capacity if (c == capacity) // è¿™é‡Œè°ƒç”¨çš„æ˜¯ notFull.signal() è€Œä¸æ˜¯ notFull.signalAll() æ˜¯ä¸ºäº†å‡å°‘ç«žäº‰ signalNotFull(); return x;&#125; ç”± put å”¤é†’ put æ˜¯ä¸ºäº†é¿å…ä¿¡å·ä¸è¶³ æ€§èƒ½æ¯”è¾ƒä¸»è¦åˆ—ä¸¾ LinkedBlockingQueue ä¸Ž ArrayBlockingQueue çš„æ€§èƒ½æ¯”è¾ƒ Linked æ”¯æŒæœ‰ç•Œï¼ŒArray å¼ºåˆ¶æœ‰ç•Œ Linked å®žçŽ°æ˜¯é“¾è¡¨ï¼ŒArray å®žçŽ°æ˜¯æ•°ç»„ Linked æ˜¯æ‡’æƒ°çš„ï¼Œè€Œ Array éœ€è¦æå‰åˆå§‹åŒ– Node æ•°ç»„ Linked æ¯æ¬¡å…¥é˜Ÿä¼šç”Ÿæˆæ–° Nodeï¼Œè€Œ Array çš„ Node æ˜¯æå‰åˆ›å»ºå¥½çš„ Linked ä¸¤æŠŠé”ï¼ŒArray ä¸€æŠŠé” 2.10 ConcurrentLinkQueueConcurrentLinkedQueue çš„è®¾è®¡ä¸Ž LinkedBlockingQueue éžå¸¸åƒï¼Œä¹Ÿæ˜¯ ä¸¤æŠŠã€é”ã€‘ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œå¯ä»¥å…è®¸ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ï¼ˆä¸€ä¸ªç”Ÿäº§è€…ä¸Žä¸€ä¸ªæ¶ˆè´¹è€…ï¼‰æ‰§è¡Œ dummy èŠ‚ç‚¹çš„å¼•å…¥è®©ä¸¤æŠŠã€é”ã€‘å°†æ¥é”ä½çš„æ˜¯ä¸åŒå¯¹è±¡ï¼Œé¿å…ç«žäº‰ åªæ˜¯è¿™ã€é”ã€‘ä½¿ç”¨äº† cas æ¥å®žçŽ° äº‹å®žä¸Šï¼ŒConcurrentLinkedQueue åº”ç”¨è¿˜æ˜¯éžå¸¸å¹¿æ³›çš„ ä¾‹å¦‚ä¹‹å‰è®²çš„ Tomcat çš„ Connector ç»“æž„æ—¶ï¼ŒAcceptor ä½œä¸ºç”Ÿäº§è€…å‘ Poller æ¶ˆè´¹è€…ä¼ é€’äº‹ä»¶ä¿¡æ¯æ—¶ï¼Œæ­£æ˜¯é‡‡ç”¨äº† ConcurrentLinkedQueue å°† SocketChannel ç»™ Poller ä½¿ç”¨ æ¨¡ä»¿ ConcurrentLinkedQueueåˆå§‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122package cn.itcast.concurrent.thirdpart.test;import java.util.Collection;import java.util.Iterator;import java.util.Queue;import java.util.concurrent.atomic.AtomicReference;public class Test3 &#123; public static void main(String[] args) &#123; MyQueue&lt;String&gt; queue = new MyQueue&lt;&gt;(); queue.offer(&quot;1&quot;); queue.offer(&quot;2&quot;); queue.offer(&quot;3&quot;); System.out.println(queue); &#125;&#125;class MyQueue&lt;E&gt; implements Queue&lt;E&gt; &#123; @Override public String toString() &#123; StringBuilder sb = new StringBuilder(); for (Node&lt;E&gt; p = head; p != null; p = p.next.get()) &#123; E item = p.item; if (item != null) &#123; sb.append(item).append(&quot;-&gt;&quot;); &#125; &#125; sb.append(&quot;null&quot;); return sb.toString(); &#125; @Override public int size() &#123; return 0; &#125; @Override public boolean isEmpty() &#123; return false; &#125; @Override public boolean contains(Object o) &#123; return false; &#125; @Override public Iterator&lt;E&gt; iterator() &#123; return null; &#125; @Override public Object[] toArray() &#123; return new Object[0]; &#125; @Override public &lt;T&gt; T[] toArray(T[] a) &#123; return null; &#125; @Override public boolean add(E e) &#123; return false; &#125; @Override public boolean remove(Object o) &#123; return false; &#125; @Override public boolean containsAll(Collection&lt;?&gt; c) &#123; return false; &#125; @Override public boolean addAll(Collection&lt;? extends E&gt; c) &#123; return false; &#125; @Override public boolean removeAll(Collection&lt;?&gt; c) &#123; return false; &#125; @Override public boolean retainAll(Collection&lt;?&gt; c) &#123; return false; &#125; @Override public void clear() &#123; &#125; @Override public E remove() &#123; return null; &#125; @Override public E element() &#123; return null; &#125; @Override public E peek() &#123; return null; &#125; public MyQueue() &#123; head = last = new Node&lt;&gt;(null, null); &#125; private volatile Node&lt;E&gt; last; private volatile Node&lt;E&gt; head; private E dequeue() &#123; /*Node&lt;E&gt; h = head; Node&lt;E&gt; first = h.next; h.next = h; head = first; E x = first.item; first.item = null; return x;*/ return null; &#125; @Override public E poll() &#123; return null; &#125; @Override public boolean offer(E e) &#123; return true; &#125; static class Node&lt;E&gt; &#123; volatile E item; public Node(E item, Node&lt;E&gt; next) &#123; this.item = item; this.next = new AtomicReference&lt;&gt;(next); &#125; AtomicReference&lt;Node&lt;E&gt;&gt; next; &#125;&#125; offer 1234567891011121314public boolean offer(E e) &#123; Node&lt;E&gt; n = new Node&lt;&gt;(e, null); while(true) &#123; // èŽ·å–å°¾èŠ‚ç‚¹ AtomicReference&lt;Node&lt;E&gt;&gt; next = last.next; // S1: çœŸæ­£å°¾èŠ‚ç‚¹çš„ next æ˜¯ null, cas ä»Ž null åˆ°æ–°èŠ‚ç‚¹ if(next.compareAndSet(null, n)) &#123; // è¿™æ—¶çš„ last å·²ç»æ˜¯å€’æ•°ç¬¬äºŒ, next ä¸ä¸ºç©ºäº†, å…¶å®ƒçº¿ç¨‹çš„ cas è‚¯å®šå¤±è´¥ // S2: æ›´æ–° last ä¸ºå€’æ•°ç¬¬ä¸€çš„èŠ‚ç‚¹ last = n; return true; &#125; &#125;&#125; 2.11 CopyOnWriteArrayListCopyOnWriteArraySet æ˜¯å®ƒçš„é©¬ç”² åº•å±‚å®žçŽ°é‡‡ç”¨äº† å†™å…¥æ—¶æ‹·è´ çš„æ€æƒ³ï¼Œå¢žåˆ æ”¹æ“ä½œä¼šå°†åº•å±‚æ•°ç»„æ‹·è´ä¸€ä»½ï¼Œæ›´æ”¹æ“ä½œåœ¨æ–°æ•°ç»„ä¸Šæ‰§è¡Œï¼Œè¿™æ—¶ä¸å½±å“å…¶å®ƒçº¿ç¨‹çš„å¹¶å‘è¯»ï¼Œè¯»å†™åˆ†ç¦»ã€‚ ä»¥æ–°å¢žä¸ºä¾‹ï¼š 1234567891011121314public boolean add(E e) &#123; synchronized (lock) &#123; // èŽ·å–æ—§çš„æ•°ç»„ Object[] es = getArray(); int len = es.length; // æ‹·è´æ–°çš„æ•°ç»„ï¼ˆè¿™é‡Œæ˜¯æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼Œä½†ä¸å½±å“å…¶å®ƒè¯»çº¿ç¨‹ï¼‰ es = Arrays.copyOf(es, len + 1); // æ·»åŠ æ–°å…ƒç´  es[len] = e; // æ›¿æ¢æ—§çš„æ•°ç»„ setArray(es); return true; &#125;&#125; è¿™é‡Œçš„æºç ç‰ˆæœ¬æ˜¯ Java 11ï¼Œåœ¨ Java 1.8 ä¸­ä½¿ç”¨çš„æ˜¯å¯é‡å…¥é”è€Œä¸æ˜¯ synchronized å…¶å®ƒè¯»æ“ä½œå¹¶æœªåŠ é”ï¼Œä¾‹å¦‚ï¼š get å¼±ä¸€è‡´æ€§ æ—¶é—´ç‚¹ æ“ä½œ 1 Thread-0 getArray() 2 Thread-1 getArray() 3 Thread-1 setArray(arrayCopy) 4 Thread-0 array[index] ä¸å®¹æ˜“æµ‹è¯•ï¼Œä½†é—®é¢˜ç¡®å®žå­˜åœ¨ è¿­ä»£å™¨å¼±ä¸€è‡´æ€§12345678910111213CopyOnWriteArrayList&lt;Integer&gt; list = new CopyOnWriteArrayList&lt;&gt;();list.add(1);list.add(2);list.add(3);Iterator&lt;Integer&gt; iter = list.iterator();new Thread(() -&gt; &#123; list.remove(0); System.out.println(list);&#125;).start();sleep1s();while (iter.hasNext()) &#123; System.out.println(iter.next());&#125; ä¸è¦è§‰å¾—å¼±ä¸€è‡´æ€§å°±ä¸å¥½ æ•°æ®åº“çš„ MVCC éƒ½æ˜¯å¼±ä¸€è‡´æ€§çš„è¡¨çŽ° å¹¶å‘é«˜å’Œä¸€è‡´æ€§æ˜¯çŸ›ç›¾çš„ï¼Œéœ€è¦æƒè¡¡","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"juc","slug":"juc","permalink":"http://fyupeng.github.io/tags/juc/"}],"author":"fyupeng"},{"title":"jvmå†…å­˜æœºåˆ¶","slug":"JVMå†…å­˜æœºåˆ¶","date":"2022-06-25T07:17:22.000Z","updated":"2022-06-25T07:22:52.101Z","comments":true,"path":"2022/06/25/JVMå†…å­˜æœºåˆ¶/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/JVM%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6/","excerpt":"","text":"typora-root-url: imgä¸€ã€å¼•è¨€1. ä»€ä¹ˆæ˜¯JVM?å®šä¹‰ï¼šJava Virtual Machine -java ç¨‹åºçš„è¿è¡ŒçŽ¯å¢ƒï¼ˆjavaäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡ŒçŽ¯å¢ƒï¼‰ å¥½å¤„ï¼š ä¸€æ¬¡ç¼–ç¨‹ï¼Œåˆ°å¤„è¿è¡Œ è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåžƒåœ¾å›žæ”¶åŠŸèƒ½ æ•°ç»„ä¸‹æ ‡è¶Šç•Œè¶ŠæŸ¥æ£€æŸ¥ å¤šæ€ æ¯”è¾ƒï¼š jvm jre jdk 2. å­¦ä¹ JVMæœ‰ä»€ä¹ˆç”¨ï¼Ÿ é¢è¯• ç†è§£åº•å±‚çš„å®žçŽ°åŽŸç† ä¸­é«˜çº§ç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½ 3. å¸¸è§çš„JVM 4. å­¦ä¹ è·¯çº¿ äºŒã€å†…å­˜ç»“æž„1. ç¨‹åºè®¡æ•°å™¨ å®šä¹‰ï¼šProgram Counter Register ç¨‹åºè®¡æ•°å™¨ï¼ˆå¯„å­˜å™¨ï¼‰ ä½œç”¨ï¼Œæ˜¯è®°ä½ä¸‹ä¸€æ¡jvmæŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ ç‰¹ç‚¹ æ˜¯çº¿ç¨‹ç§æœ‰çš„ ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º ä½œç”¨:1234567891011121314151617180: getstatic #20 // PrintStream out = System.out;3: astore_1 // --4: aload_1 // out.println(1);5: iconst_1 // --6: invokevirtual #26 // --9: aload_1 // out.println(2);10: iconst_2 // --11: invokevirtual #26 // --14: aload_1 // out.println(3);15: iconst_3 // --16: invokevirtual #26 // --19: aload_1 // out.println(4);20: iconst_4 // --21: invokevirtual #26 // --24: aload_1 // out.println(5);25: iconst_5 // --26: invokevirtual #26 // --29: return 2. è™šæ‹Ÿæœºæ ˆ å®šä¹‰ï¼šjava Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰ æ¯ä¸ªçº¿ç¨‹è¿è¡Œæ—¶æ‰€éœ€è¦çš„å†…å­˜ï¼Œç§°ä¸ºè™šæ‹Ÿæœºæ ˆ æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜ æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³• é—®é¢˜è¾¨æž åžƒåœ¾å›žæ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ æ ˆå†…å­˜åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿã€æ ˆå†…å­˜åˆ†é…è¶Šå¤§ï¼Œçº¿ç¨‹æ•°åˆ†é…å°±è¶Šå°‘ã€‘ æ–¹æ³•å†…çš„å±€éƒ¨é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ å¦‚æžœæ–¹æ³•å†…å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨è®¿é—®ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ å¦‚æžœæ˜¯å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡ï¼Œå¹¶é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ æ ˆå†…å­˜æº¢å‡ºï¼ˆStackOverFlowï¼‰: æ ˆå¸§è¿‡å¤šå¯¼è‡´æ ˆå†…å­˜æº¢å‡º æ ˆå¸§è¿‡å¤§å¯¼è‡´æ ˆå†…å­˜æº¢å‡º çº¿ç¨‹è¿è¡Œè¯Šæ–­ï¼šæ¡ˆä¾‹1ï¼š cpu å ç”¨è¿‡å¤šå®šä½ ç”¨topå®šä½å“ªä¸ªè¿›ç¨‹å¯¹cpuçš„å ç”¨è¿‡é«˜ ps H -eo pid,tid,%cpu | grep è¿›ç¨‹id ï¼ˆç”¨pså‘½ä»¤è¿›ä¸€æ­¥å®šä½æ˜¯å“ªä¸ªçº¿ç¨‹å¼•èµ·çš„cpuå ç”¨è¿‡é«˜ï¼‰ jstack è¿›ç¨‹id å¯ä»¥æ ¹æ®çº¿ç¨‹id æ‰¾åˆ°æœ‰é—®é¢˜çš„çº¿ç¨‹ï¼Œè¿›ä¸€æ­¥å®šä½åˆ°é—®é¢˜ä»£ç çš„æºç è¡Œå· æ¡ˆä¾‹2ï¼šç¨‹åºè¿è¡Œå¾ˆé•¿æ—¶é—´æ²¡æœ‰ç»“æžœ 3. æœ¬åœ°æ–¹æ³•æ ˆ 4. å † å®šä¹‰ï¼šHeap å † é€šè¿‡ new å…³é”®å­—ï¼Œåˆ›å»ºå¯¹è±¡éƒ½ä¼šä½¿ç”¨å †å†…å­˜ ç‰¹ç‚¹ å®ƒæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå †ä¸­å¯¹è±¡éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ æœ‰åžƒåœ¾å›žæ”¶æœºåˆ¶ å †å†…å­˜æº¢å‡ºï¼šå †å†…å­˜è¯Šæ–­ï¼š jps å·¥å…· æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰å“ªäº› java è¿›ç¨‹ jmap å·¥å…· æŸ¥çœ‹å †å†…å­˜å ç”¨æƒ…å†µ jmap - heap è¿›ç¨‹id jconsole å·¥å…· å›¾å½¢ç•Œé¢çš„ï¼Œå¤šåŠŸèƒ½çš„ç›‘æµ‹å·¥å…·ï¼Œå¯ä»¥è¿žç»­ç›‘æµ‹ æ¡ˆä¾‹ åžƒåœ¾å›žæ”¶åŽï¼Œå†…å­˜å ç”¨ä»ç„¶å¾ˆé«˜ 5. æ–¹æ³•åŒº å®šä¹‰ï¼šJVMè§„èŒƒ-æ–¹æ³•åŒºå®šä¹‰ ç»„æˆï¼š æ–¹æ³•åŒºå†…å­˜æº¢å‡º1.8 ä»¥å‰ä¼šå¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡º 12* æ¼”ç¤ºæ°¸ä¹…ä»£å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: PermGen space* -XX:MaxPermSize=8m 1.8 ä¹‹åŽä¼šå¯¼è‡´å…ƒç©ºé—´å†…å­˜æº¢å‡º 12* æ¼”ç¤ºå…ƒç©ºé—´å†…å­˜æº¢å‡º java.lang.OutOfMemoryError: Metaspace* -XX:MaxMetaspaceSize=8m åœºæ™¯ spring mybatis è¿è¡Œæ—¶å¸¸é‡æ±  å¸¸é‡æ± ï¼Œå°±æ˜¯ä¸€å¼ è¡¨ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»åž‹ã€å­—é¢é‡ç­‰ä¿¡æ¯ è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¸¸é‡æ± æ˜¯ *.class æ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥ç±»è¢«åŠ è½½ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼šæ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå¹¶æŠŠé‡Œé¢çš„ç¬¦å·åœ°å€å˜ä¸ºçœŸå®žåœ°å€ String Tableå…ˆçœ‹å‡ é“é¢è¯•é¢˜ï¼š 123456789101112131415String s1 = &quot;a&quot;;String s2 = &quot;b&quot;;String s3 = &quot;a&quot; + &quot;b&quot;;String s4 = s1 + s2;String s5 = &quot;ab&quot;;String s6 = s4.intern();// é—®System.out.println(s3 == s4);System.out.println(s3 == s5);System.out.println(s3 == s6);String x2 = new String(&quot;c&quot;) + new String(&quot;d&quot;);String x1 = &quot;cd&quot;;x2.intern();// é—®ï¼Œå¦‚æžœè°ƒæ¢äº†ã€æœ€åŽä¸¤è¡Œä»£ç ã€‘çš„ä½ç½®å‘¢ï¼Œå¦‚æžœæ˜¯jdk1.6å‘¢System.out.println(x1 == x2); String Table ç‰¹æ€§ å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œç¬¬ä¸€æ¬¡ç”¨åˆ°æ—¶æ‰å˜ä¸ºå¯¹è±¡ åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡ å­—ç¬¦ä¸²å˜é‡æ‹¼æŽ¥çš„åŽŸç†æ˜¯ StringBuilder ï¼ˆ1.8ï¼‰ å­—ç¬¦ä¸²å¸¸é‡æ‹¼æŽ¥çš„åŽŸç†æ˜¯ç¼–è¯‘æœŸä¼˜åŒ– å¯ä»¥ä½¿ç”¨ intern æ–¹æ³•ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ±  1.8 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æžœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æžœæ²¡æœ‰åˆ™æ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸² æ± ä¸­çš„å¯¹è±¡è¿”å›ž 1.6 å°†è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥ä¸²æ± ï¼Œå¦‚æžœæœ‰åˆ™å¹¶ä¸ä¼šæ”¾å…¥ï¼Œå¦‚æžœæ²¡æœ‰ä¼šæŠŠæ­¤å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œæ”¾å…¥ä¸²æ± ï¼Œ ä¼šæŠŠä¸²æ± ä¸­çš„å¯¹è±¡è¿”å›ž String Table ä½ç½®123456789101112131415161718192021222324252627package cn.itcast.jvm.t1.stringtable;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤º StringTable ä½ç½® * åœ¨jdk8ä¸‹è®¾ç½® -Xmx10m(å¯¹å †çš„è°ƒä¼˜å‚æ•°) -XX:-UseGCOverheadLimit(ä½¿ç”¨GCåžƒåœ¾å›žæ”¶ä¸Šé™ï¼Œä»¥é¿å…è¿‡å¤šèŠ±è´¹è¯´æ”¶é›†å°‘é‡çš„å †) * åœ¨jdk6ä¸‹è®¾ç½® -XX:MaxPermSize=10m(éžå †åŒºåˆ†é…çš„å†…å­˜çš„æœ€å¤§ä¸Šé™) */public class Demo1_6 &#123; public static void main(String[] args) throws InterruptedException &#123; List&lt;String&gt; list = new ArrayList&lt;String&gt;(); int i = 0; try &#123; for (int j = 0; j &lt; 260000; j++) &#123; list.add(String.valueOf(j).intern()); i++; &#125; &#125; catch (Throwable e) &#123; e.printStackTrace(); &#125; finally &#123; System.out.println(i); &#125; &#125;&#125; String Table åžƒåœ¾å›žæ”¶12345678910111213141516171819202122232425package cn.itcast.jvm.t1.stringtable;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤º StringTable åžƒåœ¾å›žæ”¶ * -Xmx10m -XX:+PrintStringTableStatistics -XX:+PrintGCDetails -verbose:gc */public class Demo1_7 &#123; public static void main(String[] args) throws InterruptedException &#123; int i = 0; try &#123; for (int j = 0; j &lt; 100000; j++) &#123; // j=100, j=10000 String.valueOf(j).intern(); i++; &#125; &#125; catch (Throwable e) &#123; e.printStackTrace(); &#125; finally &#123; System.out.println(i); &#125; &#125;&#125; String Table æ€§èƒ½è°ƒä¼˜æ¼”ç¤ºä¸²æ± å¤§å°å¯¹æ€§èƒ½çš„å½±å“ 123456789101112131415161718192021222324252627282930package cn.itcast.jvm.t1.stringtable;import java.io.BufferedReader;import java.io.FileInputStream;import java.io.IOException;import java.io.InputStreamReader;/** * æ¼”ç¤ºä¸²æ± å¤§å°å¯¹æ€§èƒ½çš„å½±å“ * -Xms500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=1009 */public class Demo1_24 &#123; public static void main(String[] args) throws IOException &#123; try (BufferedReader reader = new BufferedReader(new InputStreamReader(new FileInputStream(&quot;linux.words&quot;), &quot;utf-8&quot;))) &#123; String line = null; long start = System.nanoTime(); while (true) &#123; line = reader.readLine(); if (line == null) &#123; break; &#125; line.intern(); &#125; System.out.println(&quot;cost:&quot; + (System.nanoTime() - start) / 1000000); &#125; &#125;&#125; æ¼”ç¤º intern å‡å°‘å†…å­˜å ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839package cn.itcast.jvm.t1.stringtable;import java.io.BufferedReader;import java.io.FileInputStream;import java.io.IOException;import java.io.InputStreamReader;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤º intern å‡å°‘å†…å­˜å ç”¨ * -XX:StringTableSize=200000 -XX:+PrintStringTableStatistics * -Xsx500m -Xmx500m -XX:+PrintStringTableStatistics -XX:StringTableSize=200000 */public class Demo1_25 &#123; public static void main(String[] args) throws IOException &#123; List&lt;String&gt; address = new ArrayList&lt;&gt;(); System.in.read(); for (int i = 0; i &lt; 10; i++) &#123; try (BufferedReader reader = new BufferedReader(new InputStreamReader(new FileInputStream(&quot;linux.words&quot;), &quot;utf-8&quot;))) &#123; String line = null; long start = System.nanoTime(); while (true) &#123; line = reader.readLine(); if(line == null) &#123; break; &#125; address.add(line.intern()); &#125; System.out.println(&quot;cost:&quot; +(System.nanoTime()-start)/1000000); &#125; &#125; System.in.read(); &#125;&#125; è°ƒæ•´ -XX:StringTableSize=æ¡¶ä¸ªæ•° å­—ç¬¦ä¸²é‡å¤å¯ä½¿ç”¨intern()æ–¹æ³•å…¥ä¸²æ±  6. ç›´æŽ¥å†…å­˜å®šä¹‰ï¼šDirect Memory å¸¸è§äºŽ NIO æ“ä½œæ—¶ï¼Œç”¨äºŽæ•°æ®ç¼“å†²åŒº åˆ†é…å›žæ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜ ä¸å— JVM å†…å­˜å›žæ”¶ç®¡ç† æ¼”ç¤º ByteBuffer ä½œç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263package cn.itcast.jvm.t1.direct;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.IOException;import java.nio.ByteBuffer;import java.nio.channels.FileChannel;/** * æ¼”ç¤º ByteBuffer ä½œç”¨ */public class Demo1_9 &#123; static final String FROM = &quot;E:\\\\ç¼–ç¨‹èµ„æ–™\\\\ç¬¬ä¸‰æ–¹æ•™å­¦è§†é¢‘\\\\youtube\\\\Getting Started with Spring Boot-sbPSjI4tt10.mp4&quot;; static final String TO = &quot;E:\\\\a.mp4&quot;; static final int _1Mb = 1024 * 1024; public static void main(String[] args) &#123; io(); // io ç”¨æ—¶ï¼š1535.586957 1766.963399 1359.240226 directBuffer(); // directBuffer ç”¨æ—¶ï¼š479.295165 702.291454 562.56592 &#125; private static void directBuffer() &#123; long start = System.nanoTime(); try (FileChannel from = new FileInputStream(FROM).getChannel(); FileChannel to = new FileOutputStream(TO).getChannel(); ) &#123; ByteBuffer bb = ByteBuffer.allocateDirect(_1Mb); while (true) &#123; int len = from.read(bb); if (len == -1) &#123; break; &#125; bb.flip(); to.write(bb); bb.clear(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; long end = System.nanoTime(); System.out.println(&quot;directBuffer ç”¨æ—¶ï¼š&quot; + (end - start) / 1000_000.0); &#125; private static void io() &#123; long start = System.nanoTime(); try (FileInputStream from = new FileInputStream(FROM); FileOutputStream to = new FileOutputStream(TO); ) &#123; byte[] buf = new byte[_1Mb]; while (true) &#123; int len = from.read(buf); if (len == -1) &#123; break; &#125; to.write(buf, 0, len); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; long end = System.nanoTime(); System.out.println(&quot;io ç”¨æ—¶ï¼š&quot; + (end - start) / 1000_000.0); &#125;&#125; æ¼”ç¤ºç›´æŽ¥å†…å­˜æº¢å‡º 1234567891011121314151617181920212223242526272829package cn.itcast.jvm.t1.direct;import java.nio.ByteBuffer;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤ºç›´æŽ¥å†…å­˜æº¢å‡º */public class Demo1_10 &#123; static int _100Mb = 1024 * 1024 * 100; public static void main(String[] args) &#123; List&lt;ByteBuffer&gt; list = new ArrayList&lt;&gt;(); int i = 0; try &#123; while (true) &#123; ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_100Mb); list.add(byteBuffer); i++; &#125; &#125; finally &#123; System.out.println(i); &#125; // æ–¹æ³•åŒºæ˜¯jvmè§„èŒƒï¼Œ jdk6 ä¸­å¯¹æ–¹æ³•åŒºçš„å®žçŽ°ç§°ä¸ºæ°¸ä¹…ä»£ // jdk8 å¯¹æ–¹æ³•åŒºçš„å®žçŽ°ç§°ä¸ºå…ƒç©ºé—´ &#125;&#125; ç¦ç”¨æ˜¾å¼å›žæ”¶å¯¹ç›´æŽ¥å†…å­˜çš„å½±å“ 123456789101112131415161718192021222324package cn.itcast.jvm.t1.direct;import java.io.IOException;import java.nio.ByteBuffer;/** * ç¦ç”¨æ˜¾å¼å›žæ”¶å¯¹ç›´æŽ¥å†…å­˜çš„å½±å“ */public class Demo1_26 &#123; static int _1Gb = 1024 * 1024 * 1024; /* * -XX:+DisableExplicitGC æ˜¾å¼çš„ */ public static void main(String[] args) throws IOException &#123; ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1Gb); System.out.println(&quot;åˆ†é…å®Œæ¯•...&quot;); System.in.read(); System.out.println(&quot;å¼€å§‹é‡Šæ”¾...&quot;); byteBuffer = null; System.gc(); // æ˜¾å¼çš„åžƒåœ¾å›žæ”¶ï¼ŒFull GC System.in.read(); &#125;&#125; ç›´æŽ¥å†…å­˜åˆ†é…çš„åº•å±‚åŽŸç†ï¼šUnsafe 123456789101112131415161718192021222324252627282930313233343536 package cn.itcast.jvm.t1.direct;import sun.misc.Unsafe;import java.io.IOException;import java.lang.reflect.Field;/** * ç›´æŽ¥å†…å­˜åˆ†é…çš„åº•å±‚åŽŸç†ï¼šUnsafe */public class Demo1_27 &#123; static int _1Gb = 1024 * 1024 * 1024; public static void main(String[] args) throws IOException &#123; Unsafe unsafe = getUnsafe(); // åˆ†é…å†…å­˜ long base = unsafe.allocateMemory(_1Gb); unsafe.setMemory(base, _1Gb, (byte) 0); System.in.read(); // é‡Šæ”¾å†…å­˜ unsafe.freeMemory(base); System.in.read(); &#125; public static Unsafe getUnsafe() &#123; try &#123; Field f = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); f.setAccessible(true); Unsafe unsafe = (Unsafe) f.get(null); return unsafe; &#125; catch (NoSuchFieldException | IllegalAccessException e) &#123; throw new RuntimeException(e); &#125; &#125;&#125; åˆ†é…å’Œå›žæ”¶åŽŸç† ä½¿ç”¨äº† Unsafe å¯¹è±¡å®Œæˆç›´æŽ¥å†…å­˜çš„åˆ†é…å›žæ”¶ï¼Œå¹¶ä¸”å›žæ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨ freeMemory æ–¹æ³• ByteBuffer çš„å®žçŽ°ç±»å†…éƒ¨ï¼Œä½¿ç”¨äº† Cleaner ï¼ˆè™šå¼•ç”¨ï¼‰æ¥ç›‘æµ‹ ByteBuffer å¯¹è±¡ï¼Œä¸€æ—¦ByteBuffer å¯¹è±¡è¢«åžƒåœ¾å›žæ”¶ï¼Œé‚£ä¹ˆå°±ä¼šç”± ReferenceHandler çº¿ç¨‹é€šè¿‡ Cleaner çš„ clean æ–¹æ³•è°ƒç”¨ freeMemory æ¥é‡Šæ”¾ç›´æŽ¥å†…å­˜ ä¸‰ã€åžƒåœ¾å›žæ”¶1. å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›žæ”¶å¼•ç”¨è®¡æ•°æ³• å¯è¾¾æ€§åˆ†æžç®—æ³• Java è™šæ‹Ÿæœºä¸­çš„åžƒåœ¾å›žæ”¶å™¨é‡‡ç”¨å¯è¾¾æ€§åˆ†æžæ¥æŽ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿæ²¿ç€ GC Rootå¯¹è±¡ ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œæ‰¾ä¸åˆ°ï¼Œè¡¨ç¤ºå¯ä»¥å›žæ”¶ å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Root ? å››ç§å¼•ç”¨ å¼ºå¼•ç”¨ åªæœ‰æ‰€æœ‰ GC Roots å¯¹è±¡éƒ½ä¸é€šè¿‡ã€å¼ºå¼•ç”¨ã€‘å¼•ç”¨è¯¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«åžƒåœ¾å›žæ”¶ è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ ä»…æœ‰è½¯å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åžƒåœ¾å›žæ”¶åŽï¼Œå†…å­˜ä»ä¸è¶³æ—¶ä¼šå†æ¬¡å‡ºå‘åžƒåœ¾å›žæ”¶ï¼Œå›žæ”¶è½¯å¼•ç”¨å¯¹è±¡ å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾è½¯å¼•ç”¨è‡ªèº« 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package cn.itcast.jvm.t2;import java.io.IOException;import java.lang.ref.SoftReference;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤ºè½¯å¼•ç”¨ * -Xmx20m -XX:+PrintGCDetails -verbose:gc */public class Demo2_3 &#123; private static final int _4MB = 4 * 1024 * 1024; public static void main(String[] args) throws IOException &#123; /*List&lt;byte[]&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 5; i++) &#123; list.add(new byte[_4MB]); &#125; System.in.read();*/ soft(); &#125; public static void soft() &#123; // list --&gt; SoftReference --&gt; byte[] List&lt;SoftReference&lt;byte[]&gt;&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 5; i++) &#123; SoftReference&lt;byte[]&gt; ref = new SoftReference&lt;&gt;(new byte[_4MB]); System.out.println(ref.get()); list.add(ref); System.out.println(list.size()); &#125; System.out.println(&quot;å¾ªçŽ¯ç»“æŸï¼š&quot; + list.size()); for (SoftReference&lt;byte[]&gt; ref : list) &#123; System.out.println(ref.get()); &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142package cn.itcast.jvm.t2;import java.lang.ref.Reference;import java.lang.ref.ReferenceQueue;import java.lang.ref.SoftReference;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤ºè½¯å¼•ç”¨, é…åˆå¼•ç”¨é˜Ÿåˆ— */public class Demo2_4 &#123; private static final int _4MB = 4 * 1024 * 1024; public static void main(String[] args) &#123; List&lt;SoftReference&lt;byte[]&gt;&gt; list = new ArrayList&lt;&gt;(); // å¼•ç”¨é˜Ÿåˆ— ReferenceQueue&lt;byte[]&gt; queue = new ReferenceQueue&lt;&gt;(); for (int i = 0; i &lt; 5; i++) &#123; // å…³è”äº†å¼•ç”¨é˜Ÿåˆ—ï¼Œ å½“è½¯å¼•ç”¨æ‰€å…³è”çš„ byte[]è¢«å›žæ”¶æ—¶ï¼Œè½¯å¼•ç”¨è‡ªå·±ä¼šåŠ å…¥åˆ° queue ä¸­åŽ» SoftReference&lt;byte[]&gt; ref = new SoftReference&lt;&gt;(new byte[_4MB], queue); System.out.println(ref.get()); list.add(ref); System.out.println(list.size()); &#125; // ä»Žé˜Ÿåˆ—ä¸­èŽ·å–æ— ç”¨çš„ è½¯å¼•ç”¨å¯¹è±¡ï¼Œå¹¶ç§»é™¤ Reference&lt;? extends byte[]&gt; poll = queue.poll(); while( poll != null) &#123; list.remove(poll); poll = queue.poll(); &#125; System.out.println(&quot;===========================&quot;); for (SoftReference&lt;byte[]&gt; reference : list) &#123; System.out.println(reference.get()); &#125; &#125;&#125; å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ ä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åžƒåœ¾å›žæ”¶æ—¶ï¼Œæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼Œéƒ½ä¼šå›žæ”¶å¼±å¼•ç”¨å¯¹è±¡ å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—æ¥é‡Šæ”¾å¼±å¼•ç”¨è‡ªèº« 12345678910111213141516171819202122232425262728293031package cn.itcast.jvm.t2;import java.lang.ref.Reference;import java.lang.ref.ReferenceQueue;import java.lang.ref.SoftReference;import java.lang.ref.WeakReference;import java.util.ArrayList;import java.util.List;/** * æ¼”ç¤ºå¼±å¼•ç”¨ * -Xmx20m -XX:+PrintGCDetails -verbose:gc */public class Demo2_5 &#123; private static final int _4MB = 4 * 1024 * 1024; public static void main(String[] args) &#123; // list --&gt; WeakReference --&gt; byte[] List&lt;WeakReference&lt;byte[]&gt;&gt; list = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 10; i++) &#123; WeakReference&lt;byte[]&gt; ref = new WeakReference&lt;&gt;(new byte[_4MB]); list.add(ref); for (WeakReference&lt;byte[]&gt; w : list) &#123; System.out.print(w.get()+&quot; &quot;); &#125; System.out.println(); &#125; System.out.println(&quot;å¾ªçŽ¯ç»“æŸï¼š&quot; + list.size()); &#125;&#125; è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ å¿…é¡»é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œä¸»è¦é…åˆ ByteBuffer ä½¿ç”¨ï¼Œè¢«å¼•ç”¨å¯¹è±¡å›žæ”¶æ—¶ï¼Œä¼šå°†è™šå¼•ç”¨å…¥é˜Ÿï¼Œç”± Reference Handler çº¿ç¨‹è°ƒç”¨è™šå¼•ç”¨ç›¸å…³æ–¹æ³•é‡Šæ”¾ç›´æŽ¥å†…å­˜ ç»ˆç»“å™¨å¼•ç”¨ï¼ˆFinalReferenceï¼‰ æ— éœ€æ‰‹åŠ¨ç¼–ç ï¼Œä½†å…¶å†…éƒ¨é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨ï¼Œåœ¨åžƒåœ¾å›žæ”¶æ—¶ï¼Œç»ˆç»“å™¨å¼•ç”¨å…¥é˜Ÿï¼ˆè¢«å¼•ç”¨å¯¹è±¡æš‚æ—¶æ²¡æœ‰è¢«å›žæ”¶ï¼‰ï¼Œå†ç”± Finalizer çº¿ç¨‹é€šè¿‡ç»ˆç»“å™¨å¼•ç”¨æ‰¾åˆ°è¢«å¼•ç”¨å¯¹è±¡å¹¶è°ƒç”¨å®ƒçš„ finalize æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡ GC æ—¶æ‰èƒ½å›žæ”¶è¢«å¼•ç”¨å¯¹è±¡ 2. åžƒåœ¾å›žæ”¶ç®—æ³•æ ‡è®°æ¸…é™¤å®šä¹‰ï¼š Mark Sweep é€Ÿåº¦è¾ƒå¿« æœ‰å†…å­˜ç¢Žç‰‡ æ ‡è®°æ•´ç†å®šä¹‰ï¼šMark Compact é€Ÿåº¦æ…¢ æ— å†…å­˜ç¢Žç‰‡ å¤åˆ¶å®šä¹‰ï¼šCopy ä¸ä¼šæœ‰å†…å­˜ç¢Žç‰‡ éœ€è¦å ç”¨åŒå€å†…å­˜ç©ºé—´ 3. åˆ†ä»£åžƒåœ¾å›žæ”¶ å¯¹è±¡é¦–å…ˆåˆ†`é…åœ¨ä¼Šç”¸å›­åŒºåŸŸ æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œè§¦å‘ minor gcï¼Œä¼Šç”¸å›­å’Œ from å­˜æ´»çš„å¯¹è±¡ä½¿ç”¨ copy å¤åˆ¶åˆ° to ä¸­ï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„åŠ  1å¹¶ä¸”äº¤æ¢ from to minor gc ä¼šå¼•å‘ stop the worldï¼Œæš‚åœå…¶å®ƒç”¨æˆ·çš„çº¿ç¨‹ï¼Œç­‰åžƒåœ¾å›žæ”¶ç»“æŸï¼Œç”¨æˆ·çº¿ç¨‹æ‰æ¢å¤è¿è¡Œ å½“å¯¹è±¡å¯¿å‘½è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œä¼šæ™‹å‡è‡³è€å¹´ä»£ï¼Œæœ€å¤§å¯¿å‘½æ˜¯15ï¼ˆ4bitï¼‰ å½“è€å¹´ä»£ç©ºé—´ä¸è¶³ï¼Œä¼šå…ˆå°è¯•è§¦å‘ minor gcï¼Œå¦‚æžœä¹‹åŽç©ºé—´ä»ä¸è¶³ï¼Œé‚£ä¹ˆè§¦å‘ full gcï¼ŒSTWçš„æ—¶é—´æ›´é•¿ ç›¸å…³VMå‚æ•° å †åˆå§‹å¤§å° -Xms å †æœ€å¤§å¤§å° -Xmx æˆ– -XX:MaxHeapSize=size æ–°ç”Ÿä»£å¤§å° -Xmn æˆ– (-XX:NewSize=size + -XX:MaxNewSize=size ) å¹¸å­˜åŒºæ¯”ä¾‹ï¼ˆåŠ¨æ€ï¼‰ -XX:InitialSurvivorRatio=ratio å’Œ -XX:+UseAdaptiveSizePolicy å¹¸å­˜åŒºæ¯”ä¾‹ -XX:SurvivorRatio=ratio æ™‹å‡é˜ˆå€¼ -XX:MaxTenuringThreshold=threshold æ™‹å‡è¯¦æƒ… -XX:+PrintTenuringDistribution GCè¯¦æƒ… -XX:+PrintGCDetails -verbose:gc FullGC å‰ MinorGC -XX:+ScavengeBeforeFullGC 4. åžƒåœ¾å›žæ”¶å™¨ ä¸²è¡Œ å•çº¿ç¨‹ å †å†…å­˜è¾ƒå°ï¼Œé€‚åˆä¸ªäººç”µè„‘ åžåé‡ä¼˜å…ˆ è®©å•ä½æ—¶é—´å†…ï¼ŒSTW çš„æ—¶é—´æœ€çŸ­ 0.2 0.2 = 0.4ï¼Œåžƒåœ¾å›žæ”¶æ—¶é—´å æ¯”æœ€ä½Žï¼Œè¿™æ ·å°±ç§°åžåé‡é«˜ å“åº”æ—¶é—´ä¼˜å…ˆ å¤šçº¿ç¨‹ å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸ cpu å°½å¯èƒ½è®©å•æ¬¡ STW çš„æ—¶é—´æœ€çŸ­ 0.1 0.1 0.1 0.1 0.1 = 0.5 ä¸²è¡Œ-XX:+UseSerialGC = Serial + SerialOld åžåé‡ä¼˜å…ˆ-XX:+UseParallelGC ~ -XX:+UseParallelOldGC (å¼€å¯ä¸€ä¸ªï¼Œå¦ä¸€ä¸ªä¹Ÿä¼šå¼€å¯) -XX:GCTimeRatio=ratio -XX:MaxGCPauseMillis=ms -XX:ParallelGCThreads=n å“åº”æ—¶é—´ä¼˜å…ˆ-XX:+UseConcMarkSweepGC ~ -XX:+UseParNewGC ~ SerialOld -XX:ParallelGCThreads=n ~ -XX:ConcGCThreads=threads -XX:CMSInitiatingOccupancyFraction=percent -XX:+CMSScavengeBeforeRemark GIå®šä¹‰ï¼šGarbage First 2004 è®ºæ–‡å‘å¸ƒ 2009 JDK 6u14 ä½“éªŒ 2012 JDK 7u4 å®˜æ–¹æ”¯æŒ 2017 JDK 9 é»˜è®¤ é€‚ç”¨åœºæ™¯ åŒæ—¶æ³¨é‡åžåé‡ï¼ˆThroughputï¼‰å’Œä½Žå»¶è¿Ÿï¼ˆLow latencyï¼‰ï¼Œé»˜è®¤çš„æš‚åœç›®æ ‡æ˜¯ 200 ms è¶…å¤§å †å†…å­˜ï¼Œä¼šå°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ Region æ•´ä½“ä¸Šæ˜¯ æ ‡è®°+æ•´ç† ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯ å¤åˆ¶ ç®—æ³• ç›¸å…³ JVM å‚æ•° -XX:+UseG1GC -XX:G1HeapRegionSize=size -XX:MaxGCPauseMillis=time G1åžƒåœ¾å›žæ”¶é˜¶æ®µ Young Collection ä¼šSTW Young Collection + CM åœ¨ Young GC æ—¶ä¼šè¿›è¡Œ GC Root çš„åˆå§‹æ ‡è®° è€å¹´ä»£å ç”¨å †ç©ºé—´æ¯”ä¾‹è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆä¸ä¼š STWï¼‰ï¼Œç”±ä¸‹é¢çš„ JVM å‚æ•°å†³å®š Mixed Collectionä¼šå¯¹ Eã€Sã€O è¿›è¡Œå…¨é¢åžƒåœ¾å›žæ”¶ æœ€ç»ˆæ ‡è®°ï¼ˆRemarkï¼‰ä¼š STW æ‹·è´å­˜æ´»ï¼ˆEvacuationï¼‰ä¼š STW-XX:MaxGCPauseMillis=ms Full GC SerialGC æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åžƒåœ¾æ”¶é›† - minor gc è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åžƒåœ¾æ”¶é›† - full gc ParallelGC æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åžƒåœ¾æ”¶é›† - minor gc è€å¹´ä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åžƒåœ¾æ”¶é›† - full gc CMS æ–°ç”Ÿä»£å†…å­˜ä¸è¶³å‘ç”Ÿçš„åžƒåœ¾æ”¶é›† - minor gc è€å¹´ä»£å†…å­˜ä¸è¶³ G1 æ–°ç”Ÿä»£å†…å­˜ä¸è¶³ å‘ç”Ÿçš„åžƒåœ¾æ”¶é›† - minor gc è€å¹´ä»£å†…å­˜ä¸è¶³ Young Collection è·¨ä»£å¼•ç”¨æ–°ç”Ÿä»£å›žæ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜ Remarkpre-write barrier + satb_mark_queue JDK 8u20å­—ç¬¦ä¸²åŽ»é‡ ä¼˜ç‚¹ï¼šèŠ‚çœå¤§é‡å†…å­˜ ç¼ºç‚¹ï¼šç•¥å¾®å¤šå ç”¨äº† cpu æ—¶é—´ï¼Œæ–°ç”Ÿä»£å›žæ”¶æ—¶é—´ç•¥å¾®å¢žåŠ -XX:+UseStringDeduplication 12String s1 = new String(&quot;hello&quot;); // char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125;String s2 = new String(&quot;hello&quot;); // char[]&#123;&#x27;h&#x27;,&#x27;e&#x27;,&#x27;l&#x27;,&#x27;l&#x27;,&#x27;o&#x27;&#125; å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ— å½“æ–°ç”Ÿä»£å›žæ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰å­—ç¬¦ä¸²é‡å¤ å¦‚æžœå®ƒä»¬å€¼ä¸€æ ·ï¼Œè®©å®ƒä»¬å¼•ç”¨åŒä¸€ä¸ª char[] æ³¨æ„ï¼Œä¸Ž String.intern() ä¸ä¸€æ · String.intern() å…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡ è€Œå­—ç¬¦ä¸²åŽ»é‡å…³æ³¨çš„æ˜¯ char[] åœ¨ JVM å†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²è¡¨ JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½æ‰€æœ‰å¯¹è±¡éƒ½ç»è¿‡å¹¶å‘æ ‡è®°åŽï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ï¼Œå½“ä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸å†ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±» -XX:+ClassUnloadingWithConcurrentMark é»˜è®¤å¯ç”¨ JDK 8060 å›žæ”¶å·¨åž‹å¯¹è±¡ ä¸€ä¸ªå¯¹è±¡å¤§äºŽ region çš„ä¸€åŠæ—¶ï¼Œç§°ä¹‹ä¸ºå·¨åž‹å¯¹è±¡ G1 ä¸ä¼šå¯¹å·¨åž‹å¯¹è±¡è¿›è¡Œæ‹·è´ å›žæ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘ G1 ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰ incoming å¼•ç”¨ï¼Œè¿™æ ·è€å¹´ä»£ incoming å¼•ç”¨ä¸º0 çš„å·¨åž‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶æ—¶å¤„ç†æŽ‰ JDK9å¹¶å‘æ ‡è®°èµ·å§‹æ—¶é—´çš„è°ƒæ•´ å¹¶å‘æ ‡è®°å¿…é¡»åœ¨å †ç©ºé—´å æ»¡å‰å®Œæˆï¼Œå¦åˆ™é€€åŒ–ä¸º FullGC JDK 9 ä¹‹å‰éœ€è¦ä½¿ç”¨ -XX:InitiatingHeapOccupancyPercent JDK 9 å¯ä»¥åŠ¨æ€è°ƒæ•´ -XX:InitiatingHeapOccupancyPercent ç”¨æ¥è®¾ç½®åˆå§‹å€¼ è¿›è¡Œæ•°æ®é‡‡æ ·å¹¶åŠ¨æ€è°ƒæ•´ æ€»ä¼šæ·»åŠ ä¸€ä¸ªå®‰å…¨çš„ç©ºæ¡£ç©ºé—´ JDK 9 æ›´é«˜æ•ˆçš„å›žæ”¶ 250+å¢žå¼º 180+bugä¿®å¤ https://docs.oracle.com/en/java/javase/12/gctuning 5. åžƒåœ¾å›žæ”¶è°ƒä¼˜é¢„å¤‡çŸ¥è¯† æŽŒæ¡ GC ç›¸å…³çš„ VM å‚æ•°ï¼Œä¼šåŸºæœ¬çš„ç©ºé—´è°ƒæ•´ 1java -XX:+PrintFlagsFinal -version | findstr &quot;GC&quot; æŽŒæ¡ç›¸å…³å·¥å…· æ˜Žç™½ä¸€ç‚¹ï¼šè°ƒä¼˜è·Ÿåº”ç”¨ã€çŽ¯å¢ƒæœ‰å…³ï¼Œæ²¡æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„æ³•åˆ™ è°ƒä¼˜é¢†åŸŸ å†…å­˜ é”ç«žäº‰ cpu å ç”¨ io ç¡®å®šç›®æ ‡ ã€ä½Žå»¶è¿Ÿã€‘è¿˜æ˜¯ã€é«˜åžåé‡ã€‘ï¼Œé€‰æ‹©åˆé€‚çš„å›žæ”¶å™¨ CMSï¼ŒG1ï¼ŒZGC ParallelGC Zing æœ€å¿«çš„GCç­”æ¡ˆæ˜¯ä¸å‘ç”Ÿ GC æŸ¥çœ‹ FullGC å‰åŽçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä¸‹é¢å‡ ä¸ªé—®é¢˜ æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤šï¼Ÿ resultSet = statement.executeQuery(â€œselect * from å¤§è¡¨ limit nâ€) æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿ï¼Ÿ å¯¹è±¡å›¾ å¯¹è±¡å¤§å° 16 Integer 24 int 4 æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼Ÿ static Map map = è½¯ å¼± ç¬¬ä¸‰æ–¹ç¼“å­˜å®žçŽ° æ–°ç”Ÿä»£è°ƒä¼˜ æ–°ç”Ÿä»£çš„ç‰¹ç‚¹ æ‰€æœ‰çš„ new æ“ä½œçš„å†…å­˜åˆ†é…éžå¸¸å»‰ä»· TLAB thread-local allocation buffer æ­»äº¡å¯¹è±¡çš„å›žæ”¶ä»£ä»·æ˜¯é›¶ å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­» Minor GC çš„æ—¶é—´è¿œè¿œä½ŽäºŽ Full GC è¶Šå¤§è¶Šå¥½å—ï¼Ÿ 1-Xmn Sets the initial and maximum size (in bytes) of the heap for the young generation (nursery). GC is performed in this region more often than in other regions. If the size for the younggeneration is too small, then a lot of minor garbage collections are performed. If the size is toolarge, then only full garbage collections are performed, which can take a long time to complete.Oracle recommends that you keep the size for the young generation greater than 25% and lessthan 50% of the overall heap size. æ–°ç”Ÿä»£èƒ½å®¹çº³æ‰€æœ‰ã€å¹¶å‘é‡ * (è¯·æ±‚-å“åº”)ã€‘çš„æ•°æ® å¹¸å­˜åŒºå¤§åˆ°èƒ½ä¿ç•™ã€å½“å‰æ´»è·ƒå¯¹è±¡+éœ€è¦æ™‹å‡å¯¹è±¡ã€‘ æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»å¯¹è±¡å°½å¿«æ™‹å‡ -XX:MaxTenuringThreshold=threshold -XX:+PrintTenuringDistribution 12345Desired survivor size 48286924 bytes, new threshold 10 (max 10)- age 1: 28992024 bytes, 28992024 total- age 2: 1366864 bytes, 30358888 total- age 3: 1425912 bytes, 31784800 total... è€å¹´ä»£è°ƒä¼˜ä»¥ CMS ä¸ºä¾‹ CMS çš„è€å¹´ä»£å†…å­˜è¶Šå¤§è¶Šå¥½ å…ˆå°è¯•ä¸åšè°ƒä¼˜ï¼Œå¦‚æžœæ²¡æœ‰ Full GC é‚£ä¹ˆå·²ç»â€¦ï¼Œå¦åˆ™å…ˆå°è¯•è°ƒä¼˜æ–°ç”Ÿä»£ è§‚å¯Ÿå‘ç”Ÿ Full GC æ—¶è€å¹´ä»£å†…å­˜å ç”¨ï¼Œå°†è€å¹´ä»£å†…å­˜é¢„è®¾è°ƒå¤§ 1/4 ~ 1/3 -XX:CMSInitiatingOccupancyFraction=percent æ¡ˆä¾‹ æ¡ˆä¾‹1 Full GC å’Œ Minor GCé¢‘ç¹ æ¡ˆä¾‹2 è¯·æ±‚é«˜å³°æœŸå‘ç”Ÿ Full GCï¼Œå•æ¬¡æš‚åœæ—¶é—´ç‰¹åˆ«é•¿ ï¼ˆCMSï¼‰ æ¡ˆä¾‹3 è€å¹´ä»£å……è£•æƒ…å†µä¸‹ï¼Œå‘ç”Ÿ Full GC ï¼ˆCMS jdk1.7ï¼‰ å››ã€ç±»åŠ è½½ä¸Žå­—èŠ‚ç æŠ€æœ¯1. ç±»æ–‡ä»¶ç»“æž„é­”æ•°0~3 å­—èŠ‚ï¼Œè¡¨ç¤ºå®ƒæ˜¯å¦æ˜¯ã€classã€‘ç±»åž‹çš„æ–‡ä»¶0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09 ç‰ˆæœ¬4~7 å­—èŠ‚ï¼Œè¡¨ç¤ºç±»çš„ç‰ˆæœ¬ 00 34ï¼ˆ52ï¼‰ è¡¨ç¤ºæ˜¯ Java 80000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09 å¸¸é‡æ±  CONSTANT_Class 7 CONSTANT_Fieldref 9 CONSTANT_Methodref 10 CONSTANT_InterfaceMethodref 11 CONSTANT_String 8 CONSTANT_Integer 3 CONSTANT_Float 4 CONSTANT_Long 5 CONSTANT_Double 6 CONSTANT_NameAndType 12 CONSTANT_Utf8 1 CONSTANT_MethodHandle 15 CONSTANT_MethodType 16 CONSTANT_InvokeDynamic 89 å­—èŠ‚ï¼Œè¡¨ç¤ºå¸¸é‡æ± é•¿åº¦ï¼Œ00 23 ï¼ˆ35ï¼‰ è¡¨ç¤ºå¸¸é‡æ± æœ‰ #1#34é¡¹ï¼Œæ³¨æ„ #0 é¡¹ä¸è®¡å…¥ï¼Œä¹Ÿæ²¡æœ‰å€¼0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09 ç¬¬#1é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 06 å’Œ 00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #6 å’Œ #21 é¡¹æ¥èŽ·å¾—è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±žç±»ã€‘å’Œã€æ–¹æ³•åã€‘0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 09 ç¬¬#2é¡¹ 09 è¡¨ç¤ºä¸€ä¸ª Field ä¿¡æ¯ï¼Œ00 16ï¼ˆ22ï¼‰å’Œ 00 17ï¼ˆ23ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #22 å’Œ # 23 é¡¹æ¥èŽ·å¾—è¿™ä¸ªæˆå‘˜å˜é‡çš„ã€æ‰€å±žç±»ã€‘å’Œã€æˆå‘˜å˜é‡åã€‘0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 090000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 ç¬¬#3é¡¹ 08 è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡åç§°ï¼Œ00 18ï¼ˆ24ï¼‰è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #24 é¡¹0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 ç¬¬#4é¡¹ 0a è¡¨ç¤ºä¸€ä¸ª Method ä¿¡æ¯ï¼Œ00 19ï¼ˆ25ï¼‰ å’Œ 00 1aï¼ˆ26ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #25 å’Œ #26é¡¹æ¥èŽ·å¾—è¿™ä¸ªæ–¹æ³•çš„ã€æ‰€å±žç±»ã€‘å’Œã€æ–¹æ³•åã€‘0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 ç¬¬#5é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #27 é¡¹0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 07 ç¬¬#6é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1cï¼ˆ28ï¼‰ è¡¨ç¤ºå®ƒå¼•ç”¨äº†å¸¸é‡æ± ä¸­ #28 é¡¹0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b 070000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29 ç¬¬#7é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 06 è¡¨ç¤ºé•¿åº¦ï¼Œ3c 69 6e 69 74 3e æ˜¯ã€ ã€‘0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29 ç¬¬#8é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œ28 29 56 æ˜¯ã€()Vã€‘å…¶å®žå°±æ˜¯è¡¨ç¤ºæ— å‚ã€æ— è¿”å›žå€¼0000040 00 1c 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 290000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e ç¬¬#10é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œ4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65æ˜¯ã€LineNumberTableã€‘0000060 56 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 63 ç¬¬#11é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 12ï¼ˆ18ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œ4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 6162 6c 65æ˜¯ã€LocalVariableTableã€‘0000100 75 6d 62 65 72 54 61 62 6c 65 01 00 12 4c 6f 630000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 01 ç¬¬#12é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€thisã€‘0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 010000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 63 ç¬¬#13é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1dï¼ˆ29ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Lcn/itcast/jvm/t5/HelloWorld;ã€‘0000140 00 04 74 68 69 73 01 00 1d 4c 63 6e 2f 69 74 630000160 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f ç¬¬#14é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œ74 68 69 73 æ˜¯ã€mainã€‘0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 16 ç¬¬#15é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 16ï¼ˆ22ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€([Ljava/lang/String;)Vã€‘å…¶å®žå°±æ˜¯å‚æ•°ä¸ºå­—ç¬¦ä¸²æ•°ç»„ï¼Œæ— è¿”å›žå€¼0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e 01 00 160000220 28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 720000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13 ç¬¬#16é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 04 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€argsã€‘0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13 ç¬¬#17é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13ï¼ˆ19ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€[Ljava/lang/String;ã€‘0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 01 00 13 0000260 5b 4c 6a 61 76 61 2f 6c 61 6e67 2f 53 74 72 69 0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 61 ç¬¬#18é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€MethodParametersã€‘0000300 6e 67 3b 01 00 10 4d 65 74 68 6f 64 50 61 72 610000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 46 ç¬¬#19é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0aï¼ˆ10ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€SourceFileã€‘0000320 6d 65 74 65 72 73 01 00 0a 53 6f 75 72 63 65 460000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 ç¬¬#20é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€HelloWorld.javaã€‘0000340 69 6c 65 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 0000360 2e 6a 61 76 61 0c 00 07 00 08 0700 1d 0c 00 1e ç¬¬#21é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»åž‹ã€‘ï¼Œ00 07 00 08 å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #7 #8 ä¸¤é¡¹0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e ç¬¬#22é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 1dï¼ˆ29ï¼‰ å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #29 é¡¹0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e ç¬¬#23é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»åž‹ã€‘ï¼Œ00 1eï¼ˆ30ï¼‰ 00 1f ï¼ˆ31ï¼‰å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #30 #31 ä¸¤é¡¹0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d 0c 00 1e0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 ç¬¬#24é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 0fï¼ˆ15ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€hello worldã€‘0000400 00 1f 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 ç¬¬#25é¡¹ 07 è¡¨ç¤ºä¸€ä¸ª Class ä¿¡æ¯ï¼Œ00 20ï¼ˆ32ï¼‰ å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #32 é¡¹0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74 ç¬¬#26é¡¹ 0c è¡¨ç¤ºä¸€ä¸ª ã€å+ç±»åž‹ã€‘ï¼Œ00 21ï¼ˆ33ï¼‰ 00 22ï¼ˆ34ï¼‰å¼•ç”¨äº†å¸¸é‡æ± ä¸­ #33 #34 ä¸¤é¡¹0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74 ç¬¬#27é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 1bï¼ˆ27ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€cn/itcast/jvm/t5/HelloWorldã€‘0000420 07 00 20 0c 00 21 00 22 01 00 1b 63 6e 2f 69 740000440 63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 61 ç¬¬#28é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Objectã€‘0000460 6f 57 6f 72 6c 64 01 00 10 6a 61 76 61 2f 6c 610000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 61 ç¬¬#29é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 10ï¼ˆ16ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/lang/Systemã€‘0000500 6e 67 2f 4f 62 6a 65 63 74 01 00 10 6a 61 76 610000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f ç¬¬#30é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 03 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€outã€‘0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d 01 00 03 6f0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72 ç¬¬#31é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€Ljava/io/PrintStream;ã€‘0000540 75 74 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 720000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 76 ç¬¬#32é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 13ï¼ˆ19ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€java/io/PrintStreamã€‘0000560 69 6e 74 53 74 72 65 61 6d 3b 01 00 13 6a 61 760000600 61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d ç¬¬#33é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 07 è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€printlnã€‘0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a ç¬¬#34é¡¹ 01 è¡¨ç¤ºä¸€ä¸ª utf8 ä¸²ï¼Œ00 15ï¼ˆ21ï¼‰ è¡¨ç¤ºé•¿åº¦ï¼Œæ˜¯ã€(Ljava/lang/String;)Vã€‘0000620 01 00 07 70 72 69 6e 74 6c 6e 01 00 15 28 4c 6a0000640 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 è®¿é—®æ ‡è¯†ä¸Žç»§æ‰¿ä¿¡æ¯21 è¡¨ç¤ºè¯¥ class æ˜¯ä¸€ä¸ªç±»ï¼Œå…¬å…±çš„0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 05 è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ #5 æ‰¾åˆ°æœ¬ç±»å…¨é™å®šå0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 06 è¡¨ç¤ºæ ¹æ®å¸¸é‡æ± ä¸­ #6 æ‰¾åˆ°çˆ¶ç±»å…¨é™å®šå0000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 è¡¨ç¤ºæŽ¥å£çš„æ•°é‡ï¼Œæœ¬ç±»ä¸º 00000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 Flag Name Value Interpretation ACC_PUBLIC 0x0001 Declared public ; may be accessed from outside its package. ACC_FINAL 0x0010 Declared final ; no subclasses allowed. ACC_SUPER 0x0020 Treat superclass methods specially when invoked by the invokespecial instruction. ACC_INTERFACE 0x0200 Is an interface, not a class. ACC_ABSTRACT 0x0400 Declared abstract ; must not be instantiated. ACC_SYNTHETIC 0x1000 Declared synthetic; not present in the source code. ACC_ANNOTATION 0x2000 Declared as an annotation type. ACC_ENUM 0x4000 Declared as an enum type. Field ä¿¡æ¯è¡¨ç¤ºæˆå‘˜å˜é‡æ•°é‡ï¼Œæœ¬ç±»ä¸º 00000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01 FieldType Type Interpretation B byte signed byte C char Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16 D double double-precision floating-point value F float single-precision floating-point value I int integer J long long integer L ClassName ; reference an instance of class ClassName S short signed short Z boolean true or false [ reference one array dimension Method ä¿¡æ¯è¡¨ç¤ºæ–¹æ³•æ•°é‡ï¼Œæœ¬ç±»ä¸º 20000660 29 56 00 21 00 05 00 06 00 00 00 00 00 02 00 01ä¸€ä¸ªæ–¹æ³•ç”± è®¿é—®ä¿®é¥°ç¬¦ï¼Œåç§°ï¼Œå‚æ•°æè¿°ï¼Œæ–¹æ³•å±žæ€§æ•°é‡ï¼Œæ–¹æ³•å±žæ€§ç»„æˆ çº¢è‰²ä»£è¡¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆæœ¬ç±»ä¸­æ˜¯ publicï¼‰ è“è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #07 é¡¹ä½œä¸ºæ–¹æ³•åç§° ç»¿è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #08 é¡¹ä½œä¸ºæ–¹æ³•å‚æ•°æè¿° é»„è‰²ä»£è¡¨æ–¹æ³•å±žæ€§æ•°é‡ï¼Œæœ¬æ–¹æ³•æ˜¯ 1 çº¢è‰²ä»£è¡¨æ–¹æ³•å±žæ€§ 00 09 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #09 é¡¹ï¼Œå‘çŽ°æ˜¯ã€Codeã€‘å±žæ€§ 00 00 00 2f è¡¨ç¤ºæ­¤å±žæ€§çš„é•¿åº¦æ˜¯ 47 00 01 è¡¨ç¤ºã€æ“ä½œæ•°æ ˆã€‘æœ€å¤§æ·±åº¦ 00 01 è¡¨ç¤ºã€å±€éƒ¨å˜é‡è¡¨ã€‘æœ€å¤§æ§½ï¼ˆslotï¼‰æ•° 2a b7 00 01 b1 æ˜¯å­—èŠ‚ç æŒ‡ä»¤ 00 00 00 02 è¡¨ç¤ºæ–¹æ³•ç»†èŠ‚å±žæ€§æ•°é‡ï¼Œæœ¬ä¾‹æ˜¯ 2 00 0a è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #10 é¡¹ï¼Œå‘çŽ°æ˜¯ã€LineNumberTableã€‘å±žæ€§ 00 00 00 06 è¡¨ç¤ºæ­¤å±žæ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 6 00 01 è¡¨ç¤ºã€LineNumberTableã€‘é•¿åº¦ 00 00 è¡¨ç¤ºã€å­—èŠ‚ç ã€‘è¡Œå· 00 04 è¡¨ç¤ºã€java æºç ã€‘è¡Œå· 00 0b è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #11 é¡¹ï¼Œå‘çŽ°æ˜¯ã€LocalVariableTableã€‘å±žæ€§ 00 00 00 0c è¡¨ç¤ºæ­¤å±žæ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 12 00 01 è¡¨ç¤ºã€LocalVariableTableã€‘é•¿åº¦ 00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼Œç›¸å¯¹äºŽå­—èŠ‚ç çš„åç§»é‡ 00 05 è¡¨ç¤ºå±€éƒ¨å˜é‡è¦†ç›–çš„èŒƒå›´é•¿åº¦ 00 0c è¡¨ç¤ºå±€éƒ¨å˜é‡åç§°ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #12 é¡¹ï¼Œæ˜¯ã€thisã€‘ 00 0d è¡¨ç¤ºå±€éƒ¨å˜é‡çš„ç±»åž‹ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #13 é¡¹ï¼Œæ˜¯ã€Lcn/itcast/jvm/t5/HelloWorld;ã€‘ 00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡å æœ‰çš„æ§½ä½ï¼ˆslotï¼‰ç¼–å·ï¼Œæœ¬ä¾‹æ˜¯ 0 çº¢è‰²ä»£è¡¨è®¿é—®ä¿®é¥°ç¬¦ï¼ˆæœ¬ç±»ä¸­æ˜¯ public staticï¼‰ è“è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #14 é¡¹ä½œä¸ºæ–¹æ³•åç§° ç»¿è‰²ä»£è¡¨å¼•ç”¨äº†å¸¸é‡æ±  #15 é¡¹ä½œä¸ºæ–¹æ³•å‚æ•°æè¿° é»„è‰²ä»£è¡¨æ–¹æ³•å±žæ€§æ•°é‡ï¼Œæœ¬æ–¹æ³•æ˜¯ 2 çº¢è‰²ä»£è¡¨æ–¹æ³•å±žæ€§ï¼ˆå±žæ€§1ï¼‰ 00 09 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #09 é¡¹ï¼Œå‘çŽ°æ˜¯ã€Codeã€‘å±žæ€§ 00 00 00 37 è¡¨ç¤ºæ­¤å±žæ€§çš„é•¿åº¦æ˜¯ 55 00 02 è¡¨ç¤ºã€æ“ä½œæ•°æ ˆã€‘æœ€å¤§æ·±åº¦ 00 01 è¡¨ç¤ºã€å±€éƒ¨å˜é‡è¡¨ã€‘æœ€å¤§æ§½ï¼ˆslotï¼‰æ•° 00 00 00 05 è¡¨ç¤ºå­—èŠ‚ç é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 9 b2 00 02 12 03 b6 00 04 b1 æ˜¯å­—èŠ‚ç æŒ‡ä»¤ 00 00 00 02 è¡¨ç¤ºæ–¹æ³•ç»†èŠ‚å±žæ€§æ•°é‡ï¼Œæœ¬ä¾‹æ˜¯ 2 00 0a è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #10 é¡¹ï¼Œå‘çŽ°æ˜¯ã€LineNumberTableã€‘å±žæ€§ 00 00 00 0a è¡¨ç¤ºæ­¤å±žæ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 10 00 02 è¡¨ç¤ºã€LineNumberTableã€‘é•¿åº¦ 00 00 è¡¨ç¤ºã€å­—èŠ‚ç ã€‘è¡Œå· 00 06 è¡¨ç¤ºã€java æºç ã€‘è¡Œå· 00 08 è¡¨ç¤ºã€å­—èŠ‚ç ã€‘è¡Œå· 00 07 è¡¨ç¤ºã€java æºç ã€‘è¡Œå· 00 0b è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #11 é¡¹ï¼Œå‘çŽ°æ˜¯ã€LocalVariableTableã€‘å±žæ€§ 00 00 00 0c è¡¨ç¤ºæ­¤å±žæ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 12 00 01 è¡¨ç¤ºã€LocalVariableTableã€‘é•¿åº¦ 00 10 è¡¨ç¤ºå±€éƒ¨å˜é‡åç§°ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #16 é¡¹ï¼Œæ˜¯ã€argsã€‘ 00 11 è¡¨ç¤ºå±€éƒ¨å˜é‡çš„ç±»åž‹ï¼Œæœ¬ä¾‹å¼•ç”¨äº†å¸¸é‡æ±  #17 é¡¹ï¼Œæ˜¯ã€[Ljava/lang/String;ã€‘ 00 00 è¡¨ç¤ºå±€éƒ¨å˜é‡å æœ‰çš„æ§½ä½ï¼ˆslotï¼‰ç¼–å·ï¼Œæœ¬ä¾‹æ˜¯ 0 çº¢è‰²ä»£è¡¨æ–¹æ³•å±žæ€§ï¼ˆå±žæ€§2ï¼‰ 00 12 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #18 é¡¹ï¼Œå‘çŽ°æ˜¯ã€MethodParametersã€‘å±žæ€§ 00 00 00 05 è¡¨ç¤ºæ­¤å±žæ€§çš„æ€»é•¿åº¦ï¼Œæœ¬ä¾‹æ˜¯ 5 01 å‚æ•°æ•°é‡ 00 10 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #16 é¡¹ï¼Œæ˜¯ã€argsã€‘ 00 00 è®¿é—®ä¿®é¥°ç¬¦ â€‹ é™„åŠ å±žæ€§ 00 01 è¡¨ç¤ºé™„åŠ å±žæ€§æ•°é‡ 00 13 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #19 é¡¹ï¼Œå³ã€SourceFileã€‘ 00 00 00 02 è¡¨ç¤ºæ­¤å±žæ€§çš„é•¿åº¦ 00 14 è¡¨ç¤ºå¼•ç”¨äº†å¸¸é‡æ±  #20 é¡¹ï¼Œå³ã€HelloWorld.javaã€‘ å‚è€ƒæ–‡çŒ®https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html 2. å­—èŠ‚ç æŒ‡ä»¤å…¥é—¨æŽ¥ç€ä¸Šä¸€èŠ‚ï¼Œç ”ç©¶ä¸€ä¸‹ä¸¤ç»„å­—èŠ‚ç æŒ‡ä»¤ï¼Œä¸€ä¸ªæ˜¯public cn.itcast.jvm.t5.HelloWorld(); æž„é€ æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ 2a =&gt; aload_0 åŠ è½½ slot 0 çš„å±€éƒ¨å˜é‡ï¼Œå³ thisï¼Œåšä¸ºä¸‹é¢çš„ invokespecial æž„é€ æ–¹æ³•è°ƒç”¨çš„å‚æ•° b7 =&gt; invokespecial é¢„å¤‡è°ƒç”¨æž„é€ æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ 00 01 å¼•ç”¨å¸¸é‡æ± ä¸­ #1 é¡¹ï¼Œå³ã€ Method java/lang/Object.â€â€œ:()V ã€‘ b1 è¡¨ç¤ºè¿”å›ž å¦ä¸€ä¸ªæ˜¯ public static void main(java.lang.String[]); ä¸»æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ 1b2 00 02 12 03 b6 00 04 b1 b2 =&gt; getstatic ç”¨æ¥åŠ è½½é™æ€å˜é‡ï¼Œå“ªä¸ªé™æ€å˜é‡å‘¢ï¼Ÿ 00 02 å¼•ç”¨å¸¸é‡æ± ä¸­ #2 é¡¹ï¼Œå³ã€Field java/lang/System.out:Ljava/io/PrintStream;ã€‘ 12 =&gt; ldc åŠ è½½å‚æ•°ï¼Œå“ªä¸ªå‚æ•°å‘¢ï¼Ÿ 03 å¼•ç”¨å¸¸é‡æ± ä¸­ #3 é¡¹ï¼Œå³ ã€String hello worldã€‘ b6 =&gt; invokevirtual é¢„å¤‡è°ƒç”¨æˆå‘˜æ–¹æ³•ï¼Œå“ªä¸ªæ–¹æ³•å‘¢ï¼Ÿ 00 04 å¼•ç”¨å¸¸é‡æ± ä¸­ #4 é¡¹ï¼Œå³ã€Method java/io/PrintStream.println:(Ljava/lang/String;)Vã€‘ b1 è¡¨ç¤ºè¿”å›ž è¯·å‚è€ƒhttps://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5 javap å·¥å…·è‡ªå·±åˆ†æžç±»æ–‡ä»¶ç»“æž„å¤ªéº»çƒ¦äº†ï¼ŒOracle æä¾›äº† javap å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445C:\\Users\\fyp01\\Desktop\\èµ„æ–™-è§£å¯†JVM\\ä»£ç \\jvm\\jvm\\src\\cn\\itcast\\jvm\\t5&gt;javap -v HelloWorld.classClassfile /C:/Users/fyp01/Desktop/èµ„æ–™-è§£å¯†JVM/ä»£ç /jvm/jvm/src/cn/itcast/jvm/t5/HelloWorld.class Last modified 2022-2-27; size 442 bytes MD5 checksum 103606e24ec918e862312533fda15bbc Compiled from &quot;HelloWorld.java&quot;public class cn.itcast.jvm.t5.HelloWorld minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPERConstant pool: #1 = Methodref #6.#15 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Fieldref #16.#17 // java/lang/System.out:Ljava/io/PrintStream; #3 = String #18 // hello world #4 = Methodref #19.#20 // java/io/PrintStream.println:(Ljava/lang/String;)V #5 = Class #21 // cn/itcast/jvm/t5/HelloWorld #6 = Class #22 // java/lang/Object #7 = Utf8 &lt;init&gt; #8 = Utf8 ()V #9 = Utf8 Code #10 = Utf8 LineNumberTable #11 = Utf8 main #12 = Utf8 ([Ljava/lang/String;)V #13 = Utf8 SourceFile #14 = Utf8 HelloWorld.java #15 = NameAndType #7:#8 // &quot;&lt;init&gt;&quot;:()V #16 = Class #23 // java/lang/System #17 = NameAndType #24:#25 // out:Ljava/io/PrintStream; #18 = Utf8 hello world #19 = Class #26 // java/io/PrintStream #20 = NameAndType #27:#28 // println:(Ljava/lang/String;)V #21 = Utf8 cn/itcast/jvm/t5/HelloWorld #22 = Utf8 java/lang/Object #23 = Utf8 java/lang/System #24 = Utf8 out stack=2, locals=1, args_size=1 0: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 3: ldc #3 // String hello world 5: invokevirtual #4 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 8: return LineNumberTable: line 6: 0 line 7: 8&#125;SourceFile: &quot;HelloWorld.java&quot; å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹(1) åŽŸå§‹ java ä»£ç 123456789101112package cn.itcast.jvm.t3.bytecode;/** * æ¼”ç¤º å­—èŠ‚ç æŒ‡ä»¤ å’Œ æ“ä½œæ•°æ ˆã€å¸¸é‡æ± çš„å…³ç³» */public class Demo3_1 &#123; public static void main(String[] args) &#123; int a = 10; int b = Short.MAX_VALUE + 1; int c = a + b; System.out.println(c); &#125;&#125; (2) ç¼–è¯‘åŽçš„å­—èŠ‚ç æ–‡ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576C:\\Users\\fyp01\\Desktop\\èµ„æ–™-è§£å¯†JVM\\ä»£ç \\jvm\\jvm\\src\\cn\\itcast\\jvm\\t3\\bytecode&gt;javap -v Demo3_1.classClassfile /C:/Users/fyp01/Desktop/èµ„æ–™-è§£å¯†JVM/ä»£ç /jvm/jvm/src/cn/itcast/jvm/t3/bytecode/Demo3_1.class Last modified 2022-2-27; size 458 bytes MD5 checksum 9a972eb3f4d5db211d370df006319849 Compiled from &quot;Demo3_1.java&quot;public class cn.itcast.jvm.t3.bytecode.Demo3_1 minor version: 0 major version: 52 flags: ACC_PUBLIC, ACC_SUPERConstant pool: #1 = Methodref #7.#16 // java/lang/Object.&quot;&lt;init&gt;&quot;:()V #2 = Class #17 // java/lang/Short #3 = Integer 32768 #4 = Fieldref #18.#19 // java/lang/System.out:Ljava/io/PrintStream; #5 = Methodref #20.#21 // java/io/PrintStream.println:(I)V #6 = Class #22 // cn/itcast/jvm/t3/bytecode/Demo3_1 #7 = Class #23 // java/lang/Object #8 = Utf8 &lt;init&gt; #9 = Utf8 ()V #10 = Utf8 Code #11 = Utf8 LineNumberTable #12 = Utf8 main #13 = Utf8 ([Ljava/lang/String;)V #14 = Utf8 SourceFile #15 = Utf8 Demo3_1.java #16 = NameAndType #8:#9 // &quot;&lt;init&gt;&quot;:()V #17 = Utf8 java/lang/Short #18 = Class #24 // java/lang/System #19 = NameAndType #25:#26 // out:Ljava/io/PrintStream; #20 = Class #27 // java/io/PrintStream #21 = NameAndType #28:#29 // println:(I)V #22 = Utf8 cn/itcast/jvm/t3/bytecode/Demo3_1 #23 = Utf8 java/lang/Object #24 = Utf8 java/lang/System #25 = Utf8 out #26 = Utf8 Ljava/io/PrintStream; #27 = Utf8 java/io/PrintStream #28 = Utf8 println #29 = Utf8 (I)V&#123; public cn.itcast.jvm.t3.bytecode.Demo3_1(); descriptor: ()V flags: ACC_PUBLIC Code: stack=1, locals=1, args_size=1 0: aload_0 1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 4: return LineNumberTable: line 5: 0 public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=4, args_size=1 0: bipush 10 2: istore_1 3: ldc #3 // int 32768 5: istore_2 6: iload_1 7: iload_2 8: iadd 9: istore_3 10: getstatic #4 // Field java/lang/System.out:Ljava/io/PrintStream; 13: iload_3 14: invokevirtual #5 // Method java/io/PrintStream.println:(I)V 17: return LineNumberTable: line 7: 0 line 8: 3 line 9: 6 line 10: 10 line 11: 17&#125;SourceFile: &quot;Demo3_1.java&quot; (3) å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ±  (4) æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº (5) main çº¿ç¨‹å¼€å§‹è¿è¡Œï¼Œåˆ†é…æ ˆå¸§å†…å­˜ï¼ˆstack=2ï¼Œlocals=4ï¼‰ (6) æ‰§è¡Œå¼•æ“Žå¼€å§‹æ‰§è¡Œå­—èŠ‚ç bipush 10 å°†ä¸€ä¸ª byte åŽ‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰ sipush å°†ä¸€ä¸ª short åŽ‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ ldc å°†ä¸€ä¸ª int åŽ‹å…¥æ“ä½œæ•°æ ˆ ldc2_w å°†ä¸€ä¸ª long åŽ‹å…¥æ“ä½œæ•°æ ˆï¼ˆåˆ†ä¸¤æ¬¡åŽ‹å…¥ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰ è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œè¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ±  istore_1å°†æ“ä½œæ•°æ ˆé¡¶æ•°æ®å¼¹å‡ºï¼Œå­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 1 ldc #3 ä»Žå¸¸é‡æ± åŠ è½½ #3 æ•°æ®åˆ°æ“ä½œæ•°æ ˆ æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®žé™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„ istore_2 iload_1 iload_2 iadd istore_3 getstatic #4 iload_3 invokevirtual #5 æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹ å®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³• ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰ ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç  return å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ ç¨‹åºç»“æŸ ç»ƒä¹  - åˆ†æž i++ç›®çš„ï¼šä»Žå­—èŠ‚ç è§’åº¦åˆ†æž a++ ç›¸å…³é¢˜ç›® æºç ï¼š 123456789101112package cn.itcast.jvm.t3.bytecode;/** * ä»Žå­—èŠ‚ç è§’åº¦åˆ†æž a++ ç›¸å…³é¢˜ç›® */public class Demo3_2 &#123; public static void main(String[] args) &#123; int a = 10; int b = a++ + ++a + a--; System.out.println(a); System.out.println(b); &#125;&#125; å­—èŠ‚ç ï¼š 123456789101112131415161718192021222324252627282930313233343536public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: (0x0009) ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=3, args_size=1 0: bipush 10 2: istore_1 3: iload_1 4: iinc 1, 1 7: iinc 1, 1 10: iload_1 11: iadd 12: iload_1 13: iinc 1, -1 16: iadd 17: istore_2 21: iload_1 22: invokevirtual #3 // Method java/io/PrintStream.println:(I)V 25: getstatic #2 // Field java/lang/System.out:Ljava/io/PrintStream; 28: iload_2 29: invokevirtual #3 // Method java/io/PrintStream.println:(I)V 32: return LineNumberTable: line 8: 0 line 9: 3 line 10: 18 line 11: 25 line 12: 32 LocalVariableTable: Start Length Slot Name Signature 0 33 0 args [Ljava/lang/String; 3 30 1 a I 18 15 2 b I åˆ†æžï¼š æ³¨æ„ iinc æŒ‡ä»¤æ˜¯ç›´æŽ¥åœ¨å±€éƒ¨å˜é‡ slot ä¸Šè¿›è¡Œè¿ç®— a++ å’Œ ++a çš„åŒºåˆ«æ˜¯å…ˆæ‰§è¡Œ iload è¿˜æ˜¯ å…ˆæ‰§è¡Œ iinc æ¡ä»¶åˆ¤æ–­æŒ‡ä»¤ 0x99 ifeq åˆ¤æ–­æ˜¯å¦ == 0 0x9a ifne åˆ¤æ–­æ˜¯å¦ != 0 0x9b iflt åˆ¤æ–­æ˜¯å¦ &lt; 0 0x9c ifge åˆ¤æ–­æ˜¯å¦ &gt;= 0 0x9d ifgt åˆ¤æ–­æ˜¯å¦ &gt; 0 0x9e ifle åˆ¤æ–­æ˜¯å¦ &lt;= 0 0x9f if_icmpeq ä¸¤ä¸ªintæ˜¯å¦ == 0xa0 if_icmpne ä¸¤ä¸ªintæ˜¯å¦ != 0xa1 if_icmplt ä¸¤ä¸ªintæ˜¯å¦ &lt; 0xa2 if_icmpge ä¸¤ä¸ªintæ˜¯å¦ &gt;= 0xa3 if_icmpgt ä¸¤ä¸ªintæ˜¯å¦ &gt; 0xa4 if_icmple ä¸¤ä¸ªintæ˜¯å¦ &lt;= 0xa5 if_acmpeq ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ == 0xa6 if_acmpne ä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ != 0xc6 ifnull åˆ¤æ–­æ˜¯å¦ == null 0xc7 ifnonnull åˆ¤æ–­æ˜¯å¦ != null å‡ ç‚¹è¯´æ˜Žï¼š byteï¼Œshortï¼Œchar éƒ½ä¼šæŒ‰ int æ¯”è¾ƒï¼Œå› ä¸ºæ“ä½œæ•°æ ˆéƒ½æ˜¯ 4 å­—èŠ‚ goto ç”¨æ¥è¿›è¡Œè·³è½¬åˆ°æŒ‡å®šè¡Œå·çš„å­—èŠ‚ç  æºç ï¼š 12345678910public class Demo3_3 &#123; public static void main(String[] args) &#123; int a = 0; if(a == 0) &#123; a = 10; &#125; else &#123; a = 20; &#125; &#125;&#125; å­—èŠ‚ç ï¼š 123456789100: iconst_01: istore_12: iload_13: ifne 126: bipush 108: istore_19: goto 1512: bipush 2014: istore_115: return æ€è€ƒ ç»†å¿ƒçš„åŒå­¦åº”å½“æ³¨æ„åˆ°ï¼Œä»¥ä¸Šæ¯”è¾ƒæŒ‡ä»¤ä¸­æ²¡æœ‰ longï¼Œfloatï¼Œdouble çš„æ¯”è¾ƒï¼Œé‚£ä¹ˆå®ƒä»¬è¦æ¯”è¾ƒæ€Žä¹ˆåŠžï¼Ÿ å‚è€ƒ https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp å¾ªçŽ¯æŽ§åˆ¶æŒ‡ä»¤å…¶å®žå¾ªçŽ¯æŽ§åˆ¶è¿˜æ˜¯å‰é¢ä»‹ç»çš„é‚£äº›æŒ‡ä»¤ï¼Œä¾‹å¦‚ while å¾ªçŽ¯ï¼š 12345678public class Demo3_4 &#123; public static void main(String[] args) &#123; int a = 0; while (a &lt; 10) &#123; a++; &#125; &#125;&#125; å­—èŠ‚ç æ˜¯ï¼š 123456780: iconst_01: istore_12: iload_13: bipush 105: if_icmpge 148: iinc 1, 111: goto 214: return å†æ¯”å¦‚ do while å¾ªçŽ¯ï¼š 12345678public class Demo3_5 &#123; public static void main(String[] args) &#123; int a = 0; do &#123; a++; &#125; while (a &lt; 10); &#125;&#125; å­—èŠ‚ç ï¼š 12345670: iconst_0 1: istore_1 2: iinc 1, 1 5: iload_1 6: bipush 10 8: if_icmplt 2 11: return æœ€åŽå†çœ‹çœ‹ for å¾ªçŽ¯ï¼š 123456public class Demo3_6 &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; &#125; &#125;&#125; å­—èŠ‚ç æ˜¯ï¼š 123456780: iconst_01: istore_12: iload_13: bipush 105: if_icmpge 148: iinc 1, 111: goto 214: return æ³¨æ„æ¯”è¾ƒ while å’Œ for çš„å­—èŠ‚ç ï¼Œä½ å‘çŽ°å®ƒä»¬æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ®Šé€”ä¹Ÿèƒ½åŒå½’ è”ç³» - åˆ¤æ–­ç»“æžœè¯·ä»Žå­—èŠ‚ç è§’åº¦åˆ†æžï¼Œä¸‹åˆ—ä»£ç è¿è¡Œçš„ç»“æžœ 1234567891011public class Demo3_6_1 &#123; public static void main(String[] args) &#123; int i = 0; int x = 0; while (i &lt; 10) &#123; x = x++; i++; &#125; S ystem.out.println(x); // ç»“æžœæ˜¯ 0 &#125;&#125; æž„é€ æ–¹æ³•(1) &lt;cinit&gt;()V123456789public class Demo3_8_1 &#123; static int i = 10; static &#123; i = 20; &#125; s tatic &#123; i = 30; &#125;&#125; ç¼–è¯‘å™¨ä¼šæŒ‰ä»Žä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• &lt;cinit&gt;()V ï¼š 12345670: bipush 102: putstatic #2 // Field i:I5: bipush 207: putstatic #2 // Field i:I10: bipush 3012: putstatic #2 // Field i:I15: return &lt;cinit&gt;()V æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½çš„åˆå§‹åŒ–é˜¶æ®µè¢«è°ƒç”¨ **ç»ƒä¹ **åŒå­¦ä»¬å¯ä»¥è‡ªå·±è°ƒæ•´ä¸€ä¸‹ static å˜é‡å’Œé™æ€ä»£ç å—çš„ä½ç½®ï¼Œè§‚å¯Ÿå­—èŠ‚ç çš„æ”¹åŠ¨ (2) &lt;init&gt;()V12345678910111213141516171819202122232425262728package cn.itcast.jvm.t3.bytecode;public class Demo3_8_2 &#123; private String a = &quot;s1&quot;; &#123; b = 20; &#125; private int b = 10; &#123; a = &quot;s2&quot;; &#125; public Demo3_8_2(String a, int b) &#123; this.a = a; this.b = b; &#125; public static void main(String[] args) &#123; Demo3_8_2 d = new Demo3_8_2(&quot;s3&quot;, 30); System.out.println(d.a); System.out.println(d.b); &#125;&#125; ç¼–è¯‘å™¨ä¼šæŒ‰ä»Žä¸Šè‡³ä¸‹çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œå½¢æˆæ–°çš„æž„é€ æ–¹æ³•ï¼Œä½†åŽŸå§‹æž„é€ æ–¹æ³•å†…çš„ä»£ç æ€»æ˜¯åœ¨æœ€åŽ 123456789101112131415161718192021222324252627282930313233public cn.itcast.jvm.t3.bytecode.Demo3_8_2(java.lang.String, int); descriptor: (Ljava/lang/String;I)V flags: ACC_PUBLIC Code: stack=2, locals=3, args_size=3 0: aload_0 1: invokespecial #1 // super.&lt;init&gt;()V 4: aload_0 5: ldc #2 // &lt;- &quot;s1&quot; 7: putfield #3 // -&gt; this.a 10: aload_0 11: bipush 20 // &lt;- 20 13: putfield #4 // -&gt; this.b 16: aload_0 17: bipush 10 // &lt;- 10 19: putfield #4 // -&gt; this.b 22: aload_0 23: ldc #5 // &lt;- &quot;s2&quot; 25: putfield #3 // -&gt; this.a 28: aload_0 // ------------------------------ 29: aload_1 // &lt;- slot 1(a) &quot;s3&quot; | 30: putfield #3 // -&gt; this.a | 33: aload_0 | 34: iload_2 // &lt;- slot 2(b) 30 | 35: putfield #4 // -&gt; this.b -------------------- 38: return LineNumberTable: ... LocalVariableTable: Start Length Slot Name Signature 0 39 0 this Lcn/itcast/jvm/t3/bytecode/Demo3_8_2; 0 39 1 a Ljava/lang/String; 0 39 2 b I MethodParameters: ... æ–¹æ³•è°ƒç”¨çœ‹ä¸€ä¸‹å‡ ç§ä¸åŒçš„æ–¹æ³•è°ƒç”¨å¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ 1234567891011121314151617181920212223242526272829package cn.itcast.jvm.t3.bytecode;public class Demo3_9 &#123; public Demo3_9() &#123; &#125; private void test1() &#123; &#125; private final void test2() &#123; &#125; public void test3() &#123; &#125; public static void test4() &#123; &#125; @Override public String toString() &#123; return super.toString(); &#125; public static void main(String[] args) &#123; Demo3_9 d = new Demo3_9(); d.test1(); d.test2(); d.test3(); d.test4(); Demo3_9.test4(); d.toString(); &#125;&#125; å­—èŠ‚ç ï¼š 1234567891011121314151617180: new #3 // class cn/itcast/jvm/t3/bytecode/Demo3_93: dup4: invokespecial #4 // Method &quot;&lt;init&gt;&quot;:()V7: astore_18: aload_19: invokespecial #5 // Method test1:()V12: aload_113: invokespecial #6 // Method test2:()V16: aload_117: invokevirtual #7 // Method test3:()V20: aload_121: pop22: invokestatic #8 // Method test4:()V25: invokestatic #8 // Method test4:()V28: aload_129: invokevirtual #9 // Method toString:()Ljava/lang/String;32: pop33: return new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€å¯¹è±¡å¼•ç”¨ã€‘åŽ‹å…¥æ“ä½œæ•°æ ˆ dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€å¯¹è±¡å¼•ç”¨ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æž„é€ æ–¹æ³• â€œâ€œ:()V ï¼ˆä¼šæ¶ˆè€—æŽ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡ æœ€ç»ˆæ–¹æ³•ï¼ˆfinalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæž„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±žäºŽé™æ€ç»‘å®š æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±žäºŽåŠ¨æ€ç»‘å®šï¼Œå³æ”¯æŒå¤šæ€ æˆå‘˜æ–¹æ³•ä¸Žé™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘ æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ d.test4(); æ˜¯é€šè¿‡ã€å¯¹è±¡å¼•ç”¨ã€‘è°ƒç”¨ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨invokestatic ä¹‹å‰æ‰§è¡Œäº† pop æŒ‡ä»¤ï¼ŒæŠŠã€å¯¹è±¡å¼•ç”¨ã€‘ä»Žæ“ä½œæ•°æ ˆå¼¹æŽ‰äº† è¿˜æœ‰ä¸€ä¸ªæ‰§è¡Œ invokespecial çš„æƒ…å†µæ˜¯é€šè¿‡ super è°ƒç”¨çˆ¶ç±»æ–¹æ³• å¤šæ€çš„åŽŸç†12345678910111213141516171819202122232425262728293031323334353637383940414243444546package cn.itcast.jvm.t3.bytecode;import java.io.IOException;/** * æ¼”ç¤ºå¤šæ€åŽŸç†ï¼Œæ³¨æ„åŠ ä¸Šä¸‹é¢çš„ JVM å‚æ•°ï¼Œç¦ç”¨æŒ‡é’ˆåŽ‹ç¼© * -XX:-UseCompressedOops -XX:-UseCompressedClassPointers */public class Demo3_10 &#123; public static void test(Animal animal) &#123; animal.eat(); System.out.println(animal.toString()); &#125; public static void main(String[] args) throws IOException &#123; test(new Cat()); test(new Dog()); System.in.read(); &#125;&#125;abstract class Animal &#123; public abstract void eat(); @Override public String toString() &#123; return &quot;æˆ‘æ˜¯&quot; + this.getClass().getSimpleName(); &#125;&#125;class Dog extends Animal &#123; @Override public void eat() &#123; System.out.println(&quot;å•ƒéª¨å¤´&quot;); &#125;&#125;class Cat extends Animal &#123; @Override public void eat() &#123; System.out.println(&quot;åƒé±¼&quot;); &#125;&#125; 1ï¼‰è¿è¡Œä»£ç åœåœ¨ System.in.read() æ–¹æ³•ä¸Šï¼Œè¿™æ—¶è¿è¡Œ jps èŽ·å–è¿›ç¨‹ id 2ï¼‰è¿è¡Œ HSDB å·¥å…·è¿›å…¥ JDK å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œ 1java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB è¿›å…¥å›¾å½¢ç•Œé¢ attach è¿›ç¨‹ id 3ï¼‰ æŸ¥æ‰¾æŸä¸ªå¯¹è±¡æ‰“å¼€ Tools -&gt; Find Object By Query è¾“å…¥ select d from cn.itcast.jvm.t3.bytecode.Dog d ç‚¹å‡» Execute æ‰§è¡Œ 4ï¼‰æŸ¥çœ‹å¯¹è±¡å†…å­˜ç»“æž„ç‚¹å‡»è¶…é“¾æŽ¥å¯ä»¥çœ‹åˆ°å¯¹è±¡çš„å†…å­˜ç»“æž„ï¼Œæ­¤å¯¹è±¡æ²¡æœ‰ä»»ä½•å±žæ€§ï¼Œå› æ­¤åªæœ‰å¯¹è±¡å¤´çš„ 16 å­—èŠ‚ï¼Œå‰ 8 å­—èŠ‚æ˜¯MarkWordï¼ŒåŽ 8 å­—èŠ‚å°±æ˜¯å¯¹è±¡çš„ Class æŒ‡é’ˆ ä½†ç›®å‰çœ‹ä¸åˆ°å®ƒçš„å®žé™…åœ°å€ 5) æŸ¥çœ‹å¯¹è±¡ Class çš„å†…å­˜åœ°å€å¯ä»¥é€šè¿‡ Windows -&gt; Console è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œ 1mem 0x00000001299b4978 2 mem æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‚æ•° 1 æ˜¯å¯¹è±¡åœ°å€ï¼Œå‚æ•° 2 æ˜¯æŸ¥çœ‹ 2 è¡Œï¼ˆå³ 16 å­—èŠ‚ï¼‰ç»“æžœä¸­ç¬¬äºŒè¡Œ 0x000000001b7d4028 å³ä¸º Class çš„å†…å­˜åœ°å€ 6ï¼‰æŸ¥çœ‹ç±»çš„ vtable æ–¹æ³•1ï¼šAlt+R è¿›å…¥ Inspector å·¥å…·ï¼Œè¾“å…¥åˆšæ‰çš„ Class å†…å­˜åœ°å€ï¼Œçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ æ–¹æ³•2ï¼šæˆ–è€… Tools -&gt; Class Browser è¾“å…¥ Dog æŸ¥æ‰¾ï¼Œå¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æžœ æ— è®ºé€šè¿‡å“ªç§æ–¹æ³•ï¼Œéƒ½å¯ä»¥æ‰¾åˆ° Dog Class çš„ vtable é•¿åº¦ä¸º 6ï¼Œæ„æ€å°±æ˜¯ Dog ç±»æœ‰ 6 ä¸ªè™šæ–¹æ³•ï¼ˆå¤šæ€ç›¸å…³çš„ï¼Œfinalï¼Œstatic ä¸ä¼šåˆ—å…¥ï¼‰é‚£ä¹ˆè¿™ 6 ä¸ªæ–¹æ³•éƒ½æ˜¯è°å‘¢ï¼Ÿä»Ž Class çš„èµ·å§‹åœ°å€å¼€å§‹ç®—ï¼Œåç§» 0x1b8 å°±æ˜¯ vtable çš„èµ·å§‹åœ°å€ï¼Œè¿›è¡Œè®¡ç®—å¾—åˆ°ï¼š 12340x000000001b7d40281b8 +---------------------0x000000001b7d41e0 é€šè¿‡ Windows -&gt; Console è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ï¼Œæ‰§è¡Œ 1234567mem 0x000000001b7d41e0 60x000000001b7d41e0: 0x000000001b3d1b100x000000001b7d41e8: 0x000000001b3d15e80x000000001b7d41f0: 0x000000001b7d35e80x000000001b7d41f8: 0x000000001b3d15400x000000001b7d4200: 0x000000001b3d16780x000000001b7d4208: 0x000000001b7d3fa8 å°±å¾—åˆ°äº† 6 ä¸ªè™šæ–¹æ³•çš„å…¥å£åœ°å€ 7ï¼‰éªŒè¯æ–¹æ³•åœ°å€é€šè¿‡ Tools -&gt; Class Browser æŸ¥çœ‹æ¯ä¸ªç±»çš„æ–¹æ³•å®šä¹‰ï¼Œæ¯”è¾ƒå¯çŸ¥ 123456Dog - public void eat() @0x000000001b7d3fa8Animal - public java.lang.String toString() @0x000000001b7d35e8;Object - protected void finalize() @0x000000001b3d1b10;Object - public boolean equals(java.lang.Object) @0x000000001b3d15e8;Object - public native int hashCode() @0x000000001b3d1540;Object - protected native java.lang.Object clone() @0x000000001b3d1678; å¯¹å·å…¥åº§ï¼Œå‘çŽ° 8ï¼‰å°ç»“å½“æ‰§è¡Œ invokevirtual æŒ‡ä»¤æ—¶ï¼Œ å…ˆé€šè¿‡æ ˆå¸§ä¸­çš„å¯¹è±¡å¼•ç”¨æ‰¾åˆ°å¯¹è±¡ åˆ†æžå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡çš„å®žé™… Class Class ç»“æž„ä¸­æœ‰ vtableï¼Œå®ƒåœ¨ç±»åŠ è½½çš„é“¾æŽ¥é˜¶æ®µå°±å·²ç»æ ¹æ®æ–¹æ³•çš„é‡å†™è§„åˆ™ç”Ÿæˆå¥½äº† æŸ¥è¡¨å¾—åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€ æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç  å¼‚å¸¸å¤„ç†1) try-catch12345678910111213package cn.itcast.jvm.t3.bytecode;public class Demo3_11_1 &#123; public static void main(String[] args) &#123; int i = 0; try &#123; i = 10; &#125; catch (Exception e) &#123; i = 20; &#125; &#125;&#125; æ³¨æ„ä¸ºäº†æŠ“ä½é‡ç‚¹ï¼Œä¸‹é¢çš„å­—èŠ‚ç çœç•¥äº†ä¸é‡è¦çš„éƒ¨åˆ† 12345678910111213141516171819202122232425 public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=1, locals=3, args_size=1 0: iconst_0 1: istore_1 2: bipush 10 4: istore_1 5: goto 12 8: astore_2 9: bipush 20 11: istore_1 12: return Exception table: from to target type 2 5 8 Class java/lang/Exception LocalVariableTable: Start Length Slot Name Signature 9 3 2 e Ljava/lang/Exception; 0 13 0 args [Ljava/lang/String; 2 11 1 i I StackMapTable: .... MethodParameters: ....&#125; å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æž„ï¼Œ[from, to) æ˜¯å‰é—­åŽå¼€çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºçŽ°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»åž‹ï¼Œå¦‚æžœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå· 8 è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„ slot 2 ä½ç½® 2) å¤šä¸ª single-catch å—çš„æƒ…å†µ1234567891011121314151617package cn.itcast.jvm.t3.bytecode;public class Demo3_11_2 &#123; public static void main(String[] args) &#123; int i = 0; try &#123; i = 10; &#125; catch (ArithmeticException e) &#123; i = 30; &#125; catch (NullPointerException e) &#123; i = 40; &#125; catch (Exception e) &#123; i = 50; &#125; &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536 public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=1, locals=3, args_size=1 0: iconst_0 1: istore_1 2: bipush 10 4: istore_1 5: goto 26 8: astore_2 9: bipush 30 11: istore_1 12: goto 26 15: astore_2 16: bipush 40 18: istore_1 19: goto 26 22: astore_2 23: bipush 50 25: istore_1 26: return Exception table: from to target type 2 5 8 Class java/lang/ArithmeticException 2 5 15 Class java/lang/NullPointerException 2 5 22 Class java/lang/Exception LocalVariableTable: Start Length Slot Name Signature 9 3 2 e Ljava/lang/ArithmeticException; 16 3 2 e Ljava/lang/NullPointerException; 23 3 2 e Ljava/lang/Exception; 0 27 0 args [Ljava/lang/String; 2 25 1 i I StackMapTable: ....&#125; å› ä¸ºå¼‚å¸¸å‡ºçŽ°æ—¶ï¼Œåªèƒ½è¿›å…¥ Exception table ä¸­ä¸€ä¸ªåˆ†æ”¯ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®è¢«å…±ç”¨ 3) multi-catch çš„æƒ…å†µ1234567891011121314151617181920package cn.itcast.jvm.t3.bytecode;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;public class Demo3_11_3 &#123; public static void main(String[] args) &#123; try &#123; Method test = Demo3_11_3.class.getMethod(&quot;test&quot;); test.invoke(null); &#125; catch (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) &#123; e.printStackTrace(); &#125; &#125; public static void test() &#123; System.out.println(&quot;ok&quot;); &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=3, locals=2, args_size=1 0: ldc #2 // class cn/itcast/jvm/t3/bytecode/Demo3_11_3 2: ldc #3 // String test 4: iconst_0 5: anewarray #4 // class java/lang/Class 8: invokevirtual #5 // Method java/lang/Class.getMethod:(Ljava/lang/String;[Ljava/lang/Class;)Ljava/lang/reflect/Method; 11: astore_1 12: aload_1 13: aconst_null 14: iconst_0 15: anewarray #6 // class java/lang/Object 18: invokevirtual #7 // Method java/lang/reflect/Method.invoke:(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object; 21: pop 22: goto 30 25: astore_1 26: aload_1 27: invokevirtual #11 // Method java/lang/ReflectiveOperationException.printStackTrace:()V 30: return Exception table: from to target type 0 22 25 Class java/lang/NoSuchMethodException 0 22 25 Class java/lang/IllegalAccessException 0 22 25 Class java/lang/reflect/InvocationTargetException LocalVariableTable: Start Length Slot Name Signature 12 10 1 test Ljava/lang/reflect/Method; 26 4 1 e Ljava/lang/ReflectiveOperationException; 0 31 0 args [Ljava/lang/String; StackMapTable: ....&#125; 4) finally123456789101112131415package cn.itcast.jvm.t3.bytecode;public class Demo3_11_4 &#123; public static void main(String[] args) &#123; int i = 0; try &#123; i = 10; &#125; catch (Exception e) &#123; i = 20; &#125; finally &#123; i = 30; &#125; &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=1, locals=4, args_size=1 0: iconst_0 1: istore_1 2: bipush 10 4: istore_1 5: bipush 30 7: istore_1 8: goto 27 11: astore_2 12: bipush 20 14: istore_1 15: bipush 30 17: istore_1 18: goto 27 21: astore_3 22: bipush 30 24: istore_1 25: aload_3 26: athrow 27: return Exception table: from to target type 2 5 11 Class java/lang/Exception 2 5 21 any 11 15 21 any LocalVariableTable: Start Length Slot Name Signature 12 3 2 e Ljava/lang/Exception; 0 28 0 args [Ljava/lang/String; 2 26 1 i I StackMapTable: ....&#125; å¯ä»¥çœ‹åˆ° finally ä¸­çš„ä»£ç è¢«å¤åˆ¶äº† 3 ä»½ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catch å‰©ä½™çš„å¼‚å¸¸ç±»åž‹æµç¨‹ ç»ƒä¹  - finally é¢è¯•é¢˜1) finally å‡ºçŽ°äº† returnå…ˆé—®é—®è‡ªå·±ï¼Œä¸‹é¢çš„é¢˜ç›®è¾“å‡ºä»€ä¹ˆï¼Ÿ 12345678910111213141516package cn.itcast.jvm.t3.bytecode;public class Demo3_12_1 &#123; public static void main(String[] args) &#123; int result = test(); System.out.println(result); &#125; public static int test() &#123; try &#123; return 10; &#125; finally &#123; return 20; &#125; &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 1234567891011121314151617public static int test(); descriptor: ()I flags: ACC_PUBLIC, ACC_STATIC Code: stack=1, locals=2, args_size=0 0: bipush 10 2: istore_0 3: bipush 20 5: ireturn 6: astore_1 7: bipush 20 9: ireturn Exception table: from to target type 0 3 6 any StackMapTable: ....&#125; ç”±äºŽ finally ä¸­çš„ ireturn è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›žç»“æžœè‚¯å®šä»¥ finally çš„ä¸ºå‡† è‡³äºŽå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹Žæ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­ è·Ÿä¸Šä¾‹ä¸­çš„ finally ç›¸æ¯”ï¼Œå‘çŽ°æ²¡æœ‰ athrow äº†ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æžœåœ¨ finally ä¸­å‡ºçŽ°äº† returnï¼Œä¼šåžæŽ‰å¼‚å¸¸ï¼Œå¯ä»¥è¯•ä¸€ä¸‹ä¸‹é¢çš„ä»£ç  1234567891011121314151617package cn.itcast.jvm.t3.bytecode;public class Demo3_12_1 &#123; public static void main(String[] args) &#123; int result = test(); System.out.println(result); &#125; public static int test() &#123; try &#123; int i = 1/0; return 10; &#125; finally &#123; return 20; &#125; &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324public static int test(); descriptor: ()I flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=3, args_size=0 0: iconst_1 1: iconst_0 2: idiv 3: istore_0 4: bipush 10 6: istore_1 7: bipush 20 9: ireturn 10: astore_2 11: bipush 20 13: ireturn Exception table: from to target type 0 7 10 any LocalVariableTable: Start Length Slot Name Signature 4 6 0 i I StackMapTable: ....&#125; 2) finally å¯¹è¿”å›žå€¼å½±å“åŒæ ·é—®é—®è‡ªå·±ï¼Œä¸‹é¢çš„é¢˜ç›®è¾“å‡ºä»€ä¹ˆï¼Ÿ 1234567891011121314151617package cn.itcast.jvm.t3.bytecode;public class Demo3_12_2 &#123; public static void main(String[] args) &#123; int result = test(); System.out.println(result); &#125; public static int test() &#123; int i = 10; try &#123; return i; &#125; finally &#123; i = 20; &#125; &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526 public static int test(); descriptor: ()I flags: ACC_PUBLIC, ACC_STATIC Code: stack=1, locals=3, args_size=0 0: bipush 10 2: istore_0 3: iload_0 4: istore_1 // æš‚å­˜ 10 åˆ°æœ¬åœ°å˜é‡è¡¨ slot(1) ä¸­ï¼Œç›®çš„ä¸ºäº†å›ºå®šè¿”å›žå€¼ 5: bipush 20 7: istore_0 8: iload_1 // åŠ è½½ 10ï¼Œå› ä¸ºæœ‰å˜é‡éœ€è¦è½½å…¥ï¼Œå¸¸é‡å°±ä¸éœ€è¦è½½å…¥ 9: ireturn // æŠ›å‡º 10 10: astore_2 11: bipush 20 13: istore_0 14: aload_2 15: athrow Exception table: from to target type 3 5 10 any LocalVariableTable: Start Length Slot Name Signature 3 13 0 i I StackMapTable: ....&#125; synchronized1234567891011package cn.itcast.jvm.t3.bytecode;public class Demo3_13 &#123; public static void main(String[] args) &#123; Object lock = new Object(); synchronized (lock) &#123; System.out.println(&quot;ok&quot;); &#125; &#125;&#125; éƒ¨åˆ†å­—èŠ‚ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041public static void main(java.lang.String[]); descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=4, args_size=1 0: new #2 // class java/lang/Object 3: dup 4: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V 7: astore_1 8: aload_1 9: dup 10: astore_2 11: monitorenter 12: getstatic #3 // Field java/lang/System.out:Ljava/io/PrintStream; 15: ldc #4 // String ok 17: invokevirtual #5 // Method java/io/PrintStream.println:(Ljava/lang/String;)V 20: aload_2 21: monitorexit 22: goto 30 25: astore_3 26: aload_2 27: monitorexit 28: aload_3 29: athrow 30: return Exception table: from to target type 12 22 25 any 25 28 25 any LocalVariableTable: Start Length Slot Name Signature 0 31 0 args [Ljava/lang/String; 8 23 1 lock Ljava/lang/Object; StackMapTable: number_of_entries = 2 frame_type = 255 /* full_frame */ offset_delta = 25 locals = [ class &quot;[Ljava/lang/String;&quot;, class java/lang/Object, class java/lang/Object ] stack = [ class java/lang/Throwable ] frame_type = 250 /* chop */ offset_delta = 4&#125; æ³¨æ„ æ–¹æ³•çº§åˆ«çš„ synchronized ä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“çŽ° 3. ç¼–è¯‘å™¨å¤„ç†æ‰€è°“çš„ è¯­æ³•ç³– ï¼Œå…¶å®žå°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ *.java æºç ç¼–è¯‘ä¸º *.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨ç”Ÿæˆå’Œè½¬æ¢çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©ï¼ˆç»™ç³–åƒå˜›ï¼‰æ³¨æ„ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æžï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œç¼–è¯‘å™¨è½¬æ¢çš„ç»“æžœç›´æŽ¥å°±æ˜¯ class å­—èŠ‚ç ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºŽé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹Žç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚ 1) é»˜è®¤æž„é€ å™¨12public class Candy1 &#123;&#125; ç¼–è¯‘æˆclassåŽçš„ä»£ç ï¼š 1234567public class Candy1 &#123; // è¿™ä¸ªæ— å‚æž„é€ æ˜¯ç¼–è¯‘å™¨å¸®åŠ©æˆ‘ä»¬åŠ ä¸Šçš„ public Candy1() &#123; super(); // å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æž„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object.&quot;&lt;init&gt;&quot;:()V &#125;&#125; 2) è‡ªåŠ¨æ‹†è£…ç®±è¿™ä¸ªç‰¹æ€§æ˜¯ JDK 5 å¼€å§‹åŠ å…¥çš„ï¼Œ ä»£ç ç‰‡æ®µ1 ï¼š 12345678package cn.itcast.jvm.t3.candy;public class Candy2 &#123; public static void main(String[] args) &#123; Integer x = 1; int y = x; &#125;&#125; è¿™æ®µä»£ç åœ¨ JDK 5 ä¹‹å‰æ˜¯æ— æ³•ç¼–è¯‘é€šè¿‡çš„ï¼Œå¿…é¡»æ”¹å†™ä¸º ä»£ç ç‰‡æ®µ2 : 123456public class Candy2 &#123; public static void main(String[] args) &#123; Integer x = Integer.valueOf(1); int y = x.intValue(); &#125;&#125; æ˜¾ç„¶ä¹‹å‰ç‰ˆæœ¬çš„ä»£ç å¤ªéº»çƒ¦äº†ï¼Œéœ€è¦åœ¨åŸºæœ¬ç±»åž‹å’ŒåŒ…è£…ç±»åž‹ä¹‹é—´æ¥å›žè½¬æ¢ï¼ˆå°¤å…¶æ˜¯é›†åˆç±»ä¸­æ“ä½œçš„éƒ½æ˜¯åŒ…è£…ç±»åž‹ï¼‰ï¼Œå› æ­¤è¿™äº›è½¬æ¢çš„äº‹æƒ…åœ¨JDK 5 ä¹‹åŽéƒ½ç”±ç¼–è¯‘é˜¶æ®µå®Œæˆã€‚å³ä»£ç ç‰‡æ®µ1éƒ½ä¼šåœ¨ç¼–è¯‘é˜¶æ®µè¢«è½¬æ¢ä¸º ä»£ç ç‰‡æ®µ2 3) æ³›åž‹é›†åˆå–å€¼æ³›åž‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨ç¼–è¯‘æ³›åž‹ä»£ç åŽä¼šæ‰§è¡Œ æ³›åž‹æ“¦é™¤ çš„åŠ¨ä½œï¼Œå³æ³›åž‹ä¿¡æ¯åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åŽå°±ä¸¢å¤±äº†ï¼Œå®žé™…çš„ç±»åž‹éƒ½å½“åšäº† Object ç±»åž‹æ¥å¤„ç†ï¼š 1234567public class Candy3 &#123; public static void main(String[] args) &#123; List&lt;Integer&gt; list = new ArrayList&lt;&gt;(); list.add(10); // å®žé™…è°ƒç”¨çš„æ˜¯ List.add(Object e) Integer x = list.get(0); // å®žé™…è°ƒç”¨çš„æ˜¯ Object obj = List.get(int index); &#125;&#125; æ‰€ä»¥åœ¨å–å€¼æ—¶ï¼Œç¼–è¯‘å™¨çœŸæ­£ç”Ÿæˆçš„å­—èŠ‚ç ä¸­ï¼Œè¿˜è¦é¢å¤–åšä¸€ä¸ªç±»åž‹è½¬æ¢çš„æ“ä½œï¼š 12// éœ€è¦å°† Object è½¬ä¸º IntegerInteger x = (Integer)list.get(0); å¦‚æžœå‰é¢çš„ x å˜é‡ç±»åž‹ä¿®æ”¹ä¸º int åŸºæœ¬ç±»åž‹é‚£ä¹ˆæœ€ç»ˆç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ï¼š 12// éœ€è¦å°† Object è½¬ä¸º Integer, å¹¶æ‰§è¡Œæ‹†ç®±æ“ä½œint x = ((Integer)list.get(0)).intValue() è¿˜å¥½è¿™äº›éº»çƒ¦äº‹éƒ½ä¸ç”¨è‡ªå·±åšã€‚ æ“¦é™¤çš„æ˜¯å­—èŠ‚ç ä¸Šçš„æ³›åž‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ° LocalVariableTypeTable ä»ç„¶ä¿ç•™äº†æ–¹æ³•å‚æ•°æ³›åž‹çš„ä¿¡æ¯ 12345678910111213141516171819202122232425262728293031public static void main(java.lang.String[]) throws java.lang.Exception; descriptor: ([Ljava/lang/String;)V flags: ACC_PUBLIC, ACC_STATIC Code: stack=2, locals=3, args_size=1 0: new #2 // class java/util/ArrayList 3: dup 4: invokespecial #3 // Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V 7: astore_1 8: aload_1 9: bipush 10 11: invokestatic #4 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer; 14: invokeinterface #5, 2 // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z 19: pop 20: aload_1 21: iconst_0 22: invokeinterface #6, 2 // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object; 27: checkcast #7 // class java/lang/Integer 30: astore_2 31: return LocalVariableTable: Start Length Slot Name Signature 0 32 0 args [Ljava/lang/String; 8 24 1 list Ljava/util/List; 31 1 2 x Ljava/lang/Integer; LocalVariableTypeTable: Start Length Slot Name Signature 8 24 1 list Ljava/util/List&lt;Ljava/lang/Integer;&gt;; Exceptions: throws java.lang.Exception&#125; ä½¿ç”¨åå°„ï¼Œä»ç„¶èƒ½å¤ŸèŽ·å¾—è¿™äº›ä¿¡æ¯ï¼š 12public Set&lt;Integer&gt; test(List&lt;String&gt; list, Map&lt;Integer, Object&gt; map) &#123;&#125; 12345678910111213Method test = Candy3.class.getMethod(&quot;test&quot;, List.class, Map.class);Type[] types = test.getGenericParameterTypes();for (Type type : types) &#123; if (type instanceof ParameterizedType) &#123; ParameterizedType parameterizedType = (ParameterizedType) type; System.out.println(&quot;åŽŸå§‹ç±»åž‹ - &quot; + parameterizedType.getRawType()); Type[] arguments = parameterizedType.getActualTypeArguments(); for (int i = 0; i &lt; arguments.length; i++) &#123; System.out.printf(&quot;æ³›åž‹å‚æ•°[%d] - %s\\n&quot;, i, arguments[i]); &#125; &#125;&#125; â€‹ è¾“å‡º 12345åŽŸå§‹ç±»åž‹ - interface java.util.Listæ³›åž‹å‚æ•°[0] -class java.lang.StringåŽŸå§‹ç±»åž‹ - interface java.util.Mapæ³›åž‹å‚æ•°[0] - class java.lang.Integeræ³›åž‹å‚æ•°[1] - class java.lang.Object 4) å¯å˜å‚æ•°å¯å˜å‚æ•°ä¹Ÿæ˜¯ JDK 5 å¼€å§‹åŠ å…¥çš„æ–°ç‰¹æ€§ï¼š ä¾‹å¦‚ï¼š 1234567891011package cn.itcast.jvm.t3.candy;public class Candy4 &#123; public static void foo(String... args) &#123; String[] array = args; // ç›´æŽ¥èµ‹å€¼ System.out.println(array); &#125; public static void main(String[] args) &#123; foo(&quot;hello&quot;, &quot;world&quot;); &#125;&#125; å¯å˜å‚æ•° String... args å…¶å®žæ˜¯ä¸€ä¸ª String[] args ï¼Œä»Žä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒæ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š 1234567891011package cn.itcast.jvm.t3.candy;public class Candy4 &#123; public static void foo(String[] args) &#123; String[] array = args; // ç›´æŽ¥èµ‹å€¼ System.out.println(array); &#125; public static void main(String[] args) &#123; foo(&quot;hello&quot;, &quot;world&quot;); &#125;&#125; æ³¨æ„ å¦‚æžœè°ƒç”¨äº† foo() åˆ™ç­‰ä»·ä»£ç ä¸º foo(new String[]{}) ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„æ•°ç»„ï¼Œè€Œä¸ä¼šä¼ é€’ null è¿›åŽ» 5) foreach å¾ªçŽ¯ä»æ˜¯ JDK 5 å¼€å§‹å¼•å…¥çš„è¯­æ³•ç³–ï¼Œæ•°ç»„çš„å¾ªçŽ¯ï¼š 12345678910package cn.itcast.jvm.t3.candy;public class Candy5_1 &#123; public static void main(String[] args) &#123; int[] array = &#123;1, 2, 3, 4, 5&#125;; // æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦ for (int e : array) &#123; System.out.println(e); &#125; &#125;&#125; ä¼šè¢«ç¼–è¯‘å™¨æŠ“æ¢ä¸ºï¼š 123456789101112package cn.itcast.jvm.t3.candy;public class Candy5_1 &#123; public Candy5_1() &#123; &#125; public static void main(String[] args) &#123; int[] array = &#123;1, 2, 3, 4, 5&#125;; // æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯è¯­æ³•ç³–å“¦ for (int i = 0; i &lt; array.length; ++i) &#123; int e = array[i]; System.out.println(e); &#125; &#125;&#125; è€Œé›†åˆçš„å¾ªçŽ¯ï¼š 12345678910111213package cn.itcast.jvm.t3.candy;import java.util.Arrays;import java.util.List;public class Candy5_2 &#123; public static void main(String[] args) &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5); for (Integer i : list) &#123; System.out.println(i); &#125; &#125;&#125; å®žé™…è¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºå¯¹è¿­ä»£å™¨çš„è°ƒç”¨ï¼š 123456789101112131415161718package cn.itcast.jvm.t3.candy;import java.util.Arrays;import java.util.List;public class Candy5_2 &#123; public Candy5_2() &#123; &#125; public static void main(String[] args) &#123; List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5); Iterator iter = list.iterator(); while(iter.hasNext()) &#123; Integer e = (Integer)iter.next(); System.out.println(e); &#125; &#125;&#125; æ³¨æ„ foreach å¾ªçŽ¯å†™æ³•ï¼Œèƒ½å¤Ÿé…åˆæ•°ç»„ï¼Œä»¥åŠæ‰€æœ‰å®žçŽ°äº† Iterable æŽ¥å£çš„é›†åˆç±»ä¸€èµ·ä½¿ç”¨ï¼Œå…¶ä¸­ Iterable ç”¨æ¥èŽ·å–é›†åˆçš„è¿­ä»£å™¨ï¼ˆ Iterator ï¼‰ 6) switch å­—ç¬¦ä¸²ä»Ž JDK 7 å¼€å§‹ï¼Œswitch å¯ä»¥ä½œç”¨äºŽå­—ç¬¦ä¸²å’Œæžšä¸¾ç±»ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®žä¹Ÿæ˜¯è¯­æ³•ç³–ï¼Œä¾‹å¦‚ï¼š 12345678910111213141516package cn.itcast.jvm.t3.candy;public class Candy6_1 &#123; public static void choose(String str) &#123; switch (str) &#123; case &quot;hello&quot;: &#123; System.out.println(&quot;h&quot;); break; &#125; case &quot;world&quot;: &#123; System.out.println(&quot;w&quot;); break; &#125; &#125; &#125;&#125; æ³¨æ„ switch é…åˆ String å’Œæžšä¸¾ä½¿ç”¨æ—¶ï¼Œå˜é‡ä¸èƒ½ä¸ºnullï¼ŒåŽŸå› åˆ†æžå®Œè¯­æ³•ç³–è½¬æ¢åŽçš„ä»£ç åº”å½“è‡ªç„¶æ¸…æ¥š ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š 123456789101112131415161718192021222324public class Candy6_1 &#123; public Candy6_1() &#123; &#125; public static void choose(String str) &#123; byte x = -1; switch(str.hashCode()) &#123; case 99162322: // hello çš„ hashCode if (str.equals(&quot;hello&quot;)) &#123; x = 0; &#125; b reak; case 113318802: // world çš„ hashCode if (str.equals(&quot;world&quot;)) &#123; x = 1; &#125; &#125; switch(x) &#123; case 0: System.out.println(&quot;h&quot;); break; case 1: System.out.println(&quot;w&quot;); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œäº†ä¸¤é switchï¼Œç¬¬ä¸€éæ˜¯æ ¹æ®å­—ç¬¦ä¸²çš„ hashCode å’Œ equals å°†å­—ç¬¦ä¸²çš„è½¬æ¢ä¸ºç›¸åº”byte ç±»åž‹ï¼Œç¬¬äºŒéæ‰æ˜¯åˆ©ç”¨ byte æ‰§è¡Œè¿›è¡Œæ¯”è¾ƒã€‚ ä¸ºä»€ä¹ˆç¬¬ä¸€éæ—¶å¿…é¡»æ—¢æ¯”è¾ƒ hashCodeï¼Œåˆåˆ©ç”¨ equals æ¯”è¾ƒå‘¢ï¼ŸhashCode æ˜¯ä¸ºäº†æé«˜æ•ˆçŽ‡ï¼Œå‡å°‘å¯èƒ½çš„æ¯”è¾ƒï¼›è€Œ equals æ˜¯ä¸ºäº†é˜²æ­¢ hashCode å†²çªï¼Œä¾‹å¦‚ BM å’Œ C. è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„hashCodeå€¼éƒ½æ˜¯2123 ï¼Œå¦‚æžœæœ‰å¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516package cn.itcast.jvm.t3.candy;public class Candy6_2 &#123; public static void choose(String str) &#123; switch (str) &#123; case &quot;BM&quot;: &#123; System.out.println(&quot;h&quot;); break; &#125; case &quot;C.&quot;: &#123; System.out.println(&quot;w&quot;); break; &#125; &#125; &#125;&#125; ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºï¼š 12345678910111213141516171819202122public class Candy6_2 &#123; public Candy6_2() &#123; &#125; public static void choose(String str) &#123; byte x = -1; switch(str.hashCode()) &#123; case 2123: // hashCode å€¼å¯èƒ½ç›¸åŒï¼Œéœ€è¦è¿›ä¸€æ­¥ç”¨ equals æ¯”è¾ƒ if (str.equals(&quot;C.&quot;)) &#123; x = 1; &#125; else if (str.equals(&quot;BM&quot;)) &#123; x = 0; &#125; default: // ä¸Šä¸€ä¸ªæ²¡æœ‰ break; è¿™é‡Œä¼šç»§ç»­æ‰§è¡Œ switch(x) &#123; case 0: System.out.println(&quot;h&quot;); break; case 1: System.out.println(&quot;w&quot;); &#125; &#125; &#125;&#125; 7) switch æžšä¸¾switch æžšä¸¾çš„ä¾‹å­ï¼ŒåŽŸå§‹ä»£ç ï¼š 123enum Sex &#123; MALE, FEMALE&#125; 12345678910public class Candy7 &#123; public static void foo(Sex sex) &#123; switch (sex) &#123; case MALE: System.out.println(&quot;ç”·&quot;); break; case FEMALE: System.out.println(&quot;å¥³&quot;); break; &#125; &#125;&#125; è½¬æ¢åŽä»£ç ï¼š 123456789101112131415161718192021222324252627public class Candy7 &#123; /** * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰ * ç”¨æ¥æ˜ å°„æžšä¸¾çš„ ordinal ä¸Žæ•°ç»„å…ƒç´ çš„å…³ç³» * æžšä¸¾çš„ ordinal è¡¨ç¤ºæžšä¸¾å¯¹è±¡çš„åºå·ï¼Œä»Ž 0 å¼€å§‹ * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1 */ static class $MAP &#123; // æ•°ç»„å¤§å°å³ä¸ºæžšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜å‚¨caseç”¨æ¥å¯¹æ¯”çš„æ•°å­— static int[] map = new int[2]; static &#123; map[Sex.MALE.ordinal()] = 1; map[Sex.FEMALE.ordinal()] = 2; &#125; &#125; public static void foo(Sex sex) &#123; int x = $MAP.map[sex.ordinal()]; switch (x) &#123; case 1: System.out.println(&quot;ç”·&quot;); break; case 2: System.out.println(&quot;å¥³&quot;); break; &#125; &#125;&#125; 8) æžšä¸¾ç±»JDK 7 æ–°å¢žäº†æžšä¸¾ç±»ï¼Œä»¥å‰é¢çš„æ€§åˆ«æžšä¸¾ä¸ºä¾‹ï¼š 123enum Sex &#123; ALE, FEMALE&#125; è½¬æ¢åŽä»£ç ï¼š 12345678910111213141516171819public final class Sex extends Enum&lt;Sex&gt; &#123; public static final Sex MALE; public static final Sex FEMALE; private static final Sex[] $VALUES; static &#123; MALE = new Sex(&quot;MALE&quot;, 0); FEMALE = new Sex(&quot;FEMALE&quot;, 1); $VALUES = new Sex[]&#123;MALE, FEMALE&#125;; &#125; private Sex(String name, int ordinal) &#123; super(name, ordinal); &#125; public static Sex[] values() &#123; return $VALUES.clone(); &#125; public static Sex valueOf(String name) &#123; return Enum.valueOf(Sex.class, name); &#125;&#125; 9) try-with-resourcesDK 7 å¼€å§‹æ–°å¢žäº†å¯¹éœ€è¦å…³é—­çš„èµ„æºå¤„ç†çš„ç‰¹æ®Šè¯­æ³• try-with-resources`ï¼š 12345try(èµ„æºå˜é‡ = åˆ›å»ºèµ„æºå¯¹è±¡)&#123; &#125; catch( ) &#123; &#125; å…¶ä¸­èµ„æºå¯¹è±¡éœ€è¦å®žçŽ° AutoCloseable æŽ¥å£ï¼Œä¾‹å¦‚ InputStream ã€ OutputStream ã€Connection ã€ Statement ã€ ResultSet ç­‰æŽ¥å£éƒ½å®žçŽ°äº† AutoCloseable ï¼Œä½¿ç”¨ try-withresources å¯ä»¥ä¸ç”¨å†™ finally è¯­å¥å—ï¼Œç¼–è¯‘å™¨ä¼šå¸®åŠ©ç”Ÿæˆå…³é—­èµ„æºä»£ç ï¼Œä¾‹å¦‚ï¼š 123456789public class Candy9 &#123; public static void main(String[] args) &#123; try(InputStream is = new FileInputStream(&quot;d:\\\\1.txt&quot;)) &#123; System.out.println(is); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ä¼šè¢«è½¬æ¢ä¸ºï¼š 1234567891011121314151617181920212223242526272829303132333435public class Candy9 &#123; public Candy9() &#123; &#125; public static void main(String[] args) &#123; try &#123; InputStream is = new FileInputStream(&quot;d:\\\\1.txt&quot;); Thread thread = null; try &#123; System.out.println(is); &#125; catch (Throwable e1) &#123; // t æ˜¯æˆ‘ä»¬ä»£ç å‡ºçŽ°çš„å¼‚å¸¸ t = e1; throw e1; &#125; finally &#123; // åˆ¤æ–­äº†èµ„æºä¸ä¸ºç©º if (is != null) &#123; // å¦‚æžœæˆ‘ä»¬ä»£ç æœ‰å¼‚å¸¸ if (t != null) &#123; try &#123; is.close(); &#125; catch (Throwable e2) &#123; // å¦‚æžœ close å‡ºçŽ°å¼‚å¸¸ï¼Œä½œä¸ºè¢«åŽ‹åˆ¶å¼‚å¸¸æ·»åŠ  t.addSuppressed(e2); &#125; &#125; else &#123; // å¦‚æžœæˆ‘ä»¬ä»£ç æ²¡æœ‰å¼‚å¸¸ï¼Œclose å‡ºçŽ°çš„å¼‚å¸¸å°±æ˜¯æœ€åŽ catch å—ä¸­çš„ e is.close(); &#125; &#125; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ä¸ºä»€ä¹ˆè¦è®¾è®¡ä¸€ä¸ª addSuppressed(Throwable e) ï¼ˆæ·»åŠ è¢«åŽ‹åˆ¶å¼‚å¸¸ï¼‰çš„æ–¹æ³•å‘¢ï¼Ÿæ˜¯ä¸ºäº†é˜²æ­¢å¼‚å¸¸ä¿¡æ¯çš„ä¸¢å¤±ï¼ˆæƒ³æƒ³ try-with-resources ç”Ÿæˆçš„ fianlly ä¸­å¦‚æžœæŠ›å‡ºäº†å¼‚å¸¸ï¼‰ï¼š 1234567891011121314public class Test6 &#123; public static void main(String[] args) &#123; try (MyResource resource = new MyResource()) &#123; int i = 1/0; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125;class MyResource implements AutoCloseable &#123; public void close() throws Exception &#123; throw new Exception(&quot;close å¼‚å¸¸&quot;); &#125;&#125; è¾“å‡ºï¼š 12345java.lang.ArithmeticException: / by zeroat test.Test6.main(Test6.java:7)Suppressed: java.lang.Exception: close å¼‚å¸¸at test.MyResource.close(Test6.java:18)at test.Test6.main(Test6.java:6) 10) æ–¹æ³•é‡å†™æ—¶çš„æ¡¥æŽ¥æ–¹æ³•æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ–¹æ³•é‡å†™æ—¶å¯¹è¿”å›žå€¼åˆ†ä¸¤ç§æƒ…å†µï¼š çˆ¶å­ç±»çš„è¿”å›žå€¼å®Œå…¨ä¸€è‡´ å­ç±»è¿”å›žå€¼å¯ä»¥æ˜¯çˆ¶ç±»è¿”å›žå€¼çš„å­ç±»ï¼ˆæ¯”è¾ƒç»•å£ï¼Œè§ä¸‹é¢çš„ä¾‹å­ï¼‰ 123456789101112class A &#123; public Number m() &#123; return 1; &#125;&#125; class B extends A &#123; @Override // å­ç±» m æ–¹æ³•çš„è¿”å›žå€¼æ˜¯ Integer æ˜¯çˆ¶ç±» m æ–¹æ³•è¿”å›žå€¼ Number çš„å­ç±» public Integer m() &#123; return 2; &#125;&#125; å¯¹äºŽå­ç±»ï¼Œjava ç¼–è¯‘å™¨ä¼šåšå¦‚ä¸‹å¤„ç†ï¼š 12345678910class B extends A &#123; public Integer m() &#123; return 2; &#125; // æ­¤æ–¹æ³•æ‰æ˜¯çœŸæ­£é‡å†™äº†çˆ¶ç±» public Number m() æ–¹æ³• public synthetic bridge Number m() &#123; // è°ƒç”¨ public Integer m() return m(); &#125;&#125; å…¶ä¸­æ¡¥æŽ¥æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œä»…å¯¹ java è™šæ‹Ÿæœºå¯è§ï¼Œå¹¶ä¸”ä¸ŽåŽŸæ¥çš„ public Integer m() æ²¡æœ‰å‘½åå†²çªï¼Œå¯ä»¥ç”¨ä¸‹é¢åå°„ä»£ç æ¥éªŒè¯ï¼š 123for (Method m : B.class.getDeclaredMethods()) &#123; System.out.println(m);&#125; ä¼šè¾“å‡ºï¼š 12public java.lang.Integer test.candy.B.m()public java.lang.Number test.candy.B.m() 11) åŒ¿åå†…éƒ¨ç±»æºä»£ç ï¼š 12345678910public class Candy11 &#123; public static void main(String args) &#123; Runnable runnable = new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;ok&quot;); &#125; &#125;; &#125;&#125; è½¬æ¢åŽä»£ç ï¼š 123456789// é¢å¤–ç”Ÿæˆçš„ç±»final class Candy11$1 implements Runnable &#123; Candy11$1() &#123; &#125; public void run() &#123; System.ut.println(&quot;ok&quot;); &#125;&#125; 12345public class Candy11 &#123; public static void main(String[] args) &#123; Runnable runnable = new Candy11$1(); &#125;&#125; å¼•ç”¨å±€éƒ¨å˜é‡çš„åŒ¿åå†…éƒ¨ç±»ï¼Œæºä»£ç ï¼š 12345678910public class Candy11 &#123; public static void test(final int x) &#123; Runnable runnable = new Runnable() &#123; @Override public void run() &#123; System.out.println(&quot;ok:&quot; + x); &#125; &#125; &#125;&#125; è½¬æ¢åŽä»£ç ï¼š 1234567891011// é¢å¤–ç”Ÿæˆçš„ç±»final class Candy11$1 implements Runnable &#123; int val$x; Candy11$1(int x) &#123; this.val$x = x; &#125; // run æ–¹æ³• é‡å†™åŽï¼Œæ˜¯ä¸èƒ½ä¼ å‚ï¼Œæ•…è€Œé€šè¿‡æž„é€ å™¨ public void run() &#123; System.out.println(&quot;ok:&quot; + this.val$x); &#125;&#125; 123456public class Candy11 &#123; // final : ä¸ºäº† ä¸Ž åŒ¿åç±» Candy11$1 çš„æˆå‘˜å˜é‡ä¿æŒä¸€è‡´ public static void test(final int x) &#123; Runnable runnable = new Candy11$1(x); &#125;&#125; æ³¨æ„ è¿™åŒæ—¶è§£é‡Šäº†ä¸ºä»€ä¹ˆåŒ¿åå†…éƒ¨ç±»å¼•ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œå±€éƒ¨å˜é‡å¿…é¡»æ˜¯ final çš„ï¼šå› ä¸ºåœ¨åˆ›å»ºCandy11$1 å¯¹è±¡æ—¶ï¼Œå°† x çš„å€¼èµ‹å€¼ç»™äº† Candy11$1 å¯¹è±¡çš„ valå±ž æ€§ï¼Œ æ‰€ä»¥ x ä¸åº” è¯¥å†å‘ç”Ÿå˜åŒ–äº† ï¼Œ å¦‚æžœå˜åŒ–ï¼Œé‚£ ä¹ˆ x å±žæ€§æ²¡æœ‰æœºä¼šå†è·Ÿç€ä¸€èµ·å˜åŒ– 4. ç±»åŠ è½½é˜¶æ®µ1) åŠ è½½ å°†ç±»çš„å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒºä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ field æœ‰ï¼š _java_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨ _super å³çˆ¶ç±» _fields å³æˆå‘˜å˜é‡ _methods å³æ–¹æ³• _constants å³å¸¸é‡æ±  _class_loader å³ç±»åŠ è½½å™¨ _vtable è™šæ–¹æ³•è¡¨ _itable æŽ¥å£æ–¹æ³•è¡¨ å¦‚æžœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½çˆ¶ç±» åŠ è½½å’Œé“¾æŽ¥å¯èƒ½æ˜¯äº¤æ›¿è¿è¡Œçš„ æ³¨æ„ instanceKlass è¿™æ ·çš„ã€å…ƒæ•°æ®ã€‘æ˜¯å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆ1.8 åŽçš„å…ƒç©ºé—´å†…ï¼‰ï¼Œä½† _java_mirroræ˜¯å­˜å‚¨åœ¨å †ä¸­ å¯ä»¥é€šè¿‡å‰é¢ä»‹ç»çš„ HSDB å·¥å…·æŸ¥çœ‹ 2) é“¾æŽ¥éªŒè¯éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥ç”¨ UE ç­‰æ”¯æŒäºŒè¿›åˆ¶çš„ç¼–è¾‘å™¨ä¿®æ”¹ HelloWorld.class çš„é­”æ•°ï¼Œåœ¨æŽ§åˆ¶å°è¿è¡Œ 12345678910111213141516C:\\Users\\fyp01\\Desktop\\èµ„æ–™-è§£å¯†JVM\\ä»£ç \\jvm\\jvm\\src\\cn\\itcast\\jvm\\t5&gt;java HelloWorldError: A JNI error has occurred, please check your installation and try againException in thread &quot;main&quot; java.lang.ClassFormatError: Incompatible magic value 3405691578 in class file HelloWorld at java.lang.ClassLoader.defineClass1(Native Method) at java.lang.ClassLoader.defineClass(ClassLoader.java:763) at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142) at java.net.URLClassLoader.defineClass(URLClassLoader.java:467) at java.net.URLClassLoader.access$100(URLClassLoader.java:73) at java.net.URLClassLoader$1.run(URLClassLoader.java:368) at java.net.URLClassLoader$1.run(URLClassLoader.java:362) at java.security.AccessController.doPrivileged(Native Method) at java.net.URLClassLoader.findClass(URLClassLoader.java:361) at java.lang.ClassLoader.loadClass(ClassLoader.java:424) at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:338) at java.lang.ClassLoader.loadClass(ClassLoader.java:357) at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:495) å‡†å¤‡ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼ static å˜é‡åœ¨ JDK 7 ä¹‹å‰å­˜å‚¨äºŽ instanceKlass æœ«å°¾ï¼Œä»Ž JDK 7 å¼€å§‹ï¼Œå­˜å‚¨äºŽ _java_mirror æœ«å°¾ static å˜é‡åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼Œåˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ å¦‚æžœ static å˜é‡æ˜¯ final çš„åŸºæœ¬ç±»åž‹ï¼Œä»¥åŠå­—ç¬¦ä¸²å¸¸é‡ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œèµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ å¦‚æžœ static å˜é‡æ˜¯ final çš„ï¼Œä½†å±žäºŽå¼•ç”¨ç±»åž‹ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ è§£æžå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æžä¸ºç›´æŽ¥å¼•ç”¨ 123456789101112131415161718192021222324package cn.itcast.jvm.t3.load;import java.io.IOException;/** * è§£æžçš„å«ä¹‰ */public class Load2 &#123; public static void main(String[] args) throws ClassNotFoundException, IOException &#123;// ClassLoader classloader = Load2.class.getClassLoader(); // loadClass æ–¹æ³•ä¸ä¼šå¯¼è‡´ç±»çš„è§£æžå’Œåˆå§‹åŒ–// Class&lt;?&gt; c = classloader.loadClass(&quot;cn.itcast.jvm.t3.load.C&quot;); new C(); System.in.read(); &#125;&#125;class C &#123; D d = new D();&#125;class D &#123;&#125; 3) åˆå§‹åŒ–&lt;cinit&gt;()V æ–¹æ³•åˆå§‹åŒ–å³è°ƒç”¨ &lt;cinit&gt;()V ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€Žæž„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨ å‘ç”Ÿçš„æ—¶æœºæ¦‚æ‹¬å¾—è¯´ï¼Œç±»åˆå§‹åŒ–æ˜¯ã€æ‡’æƒ°çš„ã€‘ main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ– é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶ å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æžœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘ å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ– Class.forName new ä¼šå¯¼è‡´åˆå§‹åŒ– ä¸ä¼šå¯¼è‡´ç±»åˆå§‹åŒ–çš„æƒ…å†µ è®¿é—®ç±»çš„ static final é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»åž‹å’Œå­—ç¬¦ä¸²ï¼‰ä¸ä¼šè§¦å‘åˆå§‹åŒ– ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ– åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ– ç±»åŠ è½½å™¨çš„loadClass æ–¹æ³• Class.forName çš„å‚æ•° 2 ä¸º false æ—¶ 1234567891011121314class A &#123; static int a = 0; static &#123; System.out.println(&quot;a init&quot;); &#125;&#125;class B extends A &#123; final static double b = 5.0; static boolean c = false; static &#123; System.out.println(&quot;b init&quot;); &#125;&#125; éªŒè¯ï¼ˆå®žéªŒæ—¶è¯·å…ˆå…¨éƒ¨æ³¨é‡Šï¼Œæ¯æ¬¡åªæ‰§è¡Œå…¶ä¸­ä¸€ä¸ªï¼‰ 1234567891011121314151617181920212223242526272829303132public class Load3 &#123; static &#123; System.out.println(&quot;main init&quot;); &#125; public static void main(String[] args) throws ClassNotFoundException, IOException &#123;// // 1. é™æ€å¸¸é‡ä¸ä¼šè§¦å‘åˆå§‹åŒ–// System.out.println(B.b);// // 2. ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–// System.out.println(B.class);// // 3. åˆ›å»ºè¯¥ç±»çš„æ•°ç»„ä¸ä¼šè§¦å‘åˆå§‹åŒ–// System.out.println(new B[0]); // 4. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A ClassLoader cl = Thread.currentThread().getContextClassLoader(); cl.loadClass(&quot;cn.itcast.jvm.t3.load.B&quot;);// // 5. ä¸ä¼šåˆå§‹åŒ–ç±» Bï¼Œä½†ä¼šåŠ è½½ Bã€A// ClassLoader c2 = Thread.currentThread().getContextClassLoader();// Class.forName(&quot;cn.itcast.jvm.t3.load.B&quot;, false, c2); System.in.read();// // 1. é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶// System.out.println(A.a);// // 2. å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æžœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘// System.out.println(B.c);// // 3. å­ç±»è®¿é—®çˆ¶ç±»é™æ€å˜é‡ï¼Œåªè§¦å‘çˆ¶ç±»åˆå§‹åŒ–// System.out.println(B.a);// // 4. ä¼šåˆå§‹åŒ–ç±» Bï¼Œå¹¶å…ˆåˆå§‹åŒ–ç±» A// Class.forName(&quot;cn.itcast.jvm.t3.load.B&quot;); &#125;&#125; 4) ç»ƒä¹ ä»Žå­—èŠ‚ç åˆ†æžï¼Œä½¿ç”¨ aï¼Œbï¼Œc è¿™ä¸‰ä¸ªå¸¸é‡æ˜¯å¦ä¼šå¯¼è‡´ E åˆå§‹åŒ– 12345678910111213141516171819package cn.itcast.jvm.t3.load;public class Load4 &#123; public static void main(String[] args) &#123; System.out.println(E.a); System.out.println(E.b); System.out.println(E.c); &#125;&#125;class E &#123; public static final int a = 10; public static final String b = &quot;hello&quot;; public static final Integer c = 20; // Integer.valueOf(20) final çš„ åŸºæœ¬ç±»åž‹ + String ä¸ä¼šè§¦å‘çš„ï¼ŒInteger ä¸æ˜¯ static &#123; System.out.println(&quot;init E&quot;); &#125;&#125; å…¸åž‹åº”ç”¨ - å®Œæˆæ‡’æƒ°åˆå§‹åŒ–å•ä¾‹æ¨¡å¼ 12345678910111213141516171819202122class Singleton &#123; public static void test() &#123; System.out.println(&quot;test&quot;); &#125; private Singleton() &#123;&#125; private static class LazyHolder&#123; // final å¯ä»¥ä¿è¯ æž„é€ æ–¹æ³•æ‰§è¡Œç»“æŸåŽï¼Œfinal æˆå‘˜å˜é‡ è¢« å…¶ä»–çº¿ç¨‹è®¿é—® æ˜¯ å¯è§çš„ private static final Singleton SINGLETON = new Singleton(); // jvm ä¿è¯ ç±» åˆå§‹åŒ– åœ¨ å¤šçº¿ç¨‹ä¸‹ è¢« åŒæ­¥åŠ é”ï¼Œé™æ€ä»£ç å— åœ¨åˆå§‹åŒ– é˜¶æ®µå®Œæˆ static &#123; System.out.println(&quot;lazy holder init&quot;); &#125; &#125; public static Singleton getInstance() &#123; return LazyHolder.SINGLETON; &#125;&#125; ä»¥ä¸Šçš„å®žçŽ°ç‰¹ç‚¹æ˜¯ï¼š æ‡’æƒ°å®žä¾‹åŒ– åˆå§‹åŒ–æ—¶çš„çº¿ç¨‹å®‰å…¨æ˜¯æœ‰ä¿éšœçš„ 5. ç±»åŠ è½½å™¨ä»¥ JDK 8 ä¸ºä¾‹ï¼š åç§° åŠ è½½å“ªçš„ç±» è¯´æ˜Ž Bootstrap ClassLoader JAVA_HOME/jre/lib æ— æ³•ç›´æŽ¥è®¿é—® Extension ClassLoader JAVA_HOME/jre/lib/ext ä¸Šçº§ä¸º Bootstrapï¼Œæ˜¾ç¤ºä¸º null Application ClassLoader classpath ä¸Šçº§ä¸º Extension è‡ªå®šä¹‰ç±»åŠ è½½å™¨ è‡ªå®šä¹‰ ä¸Šçº§ä¸º Application 1) å¯åŠ¨ç±»åŠ è½½å™¨ç”¨ Bootstrap ç±»åŠ è½½å™¨åŠ è½½ç±»ï¼š 1234567package cn.itcast.jvm.t3.load;public class F &#123; static &#123; System.out.println(&quot;bootstrap F init&quot;); &#125;&#125; æ‰§è¡Œ 12345678package cn.itcast.jvm.t3.load;public class Load5_1 &#123; public static void main(String[] args) throws ClassNotFoundException &#123; Class&lt;?&gt; aClass = Class.forName(&quot;cn.itcast.jvm.t3.load.F&quot;); System.out.println(aClass.getClassLoader()); // AppClassLoader ExtClassLoader &#125;&#125; è¾“å‡º 123E:\\git\\jvm\\out\\production\\jvm&gt;java -Xbootclasspath/a:. cn.itcast.jvm.t3.load.Load5_1bootstrap F initnull -Xbootclasspath è¡¨ç¤ºè®¾ç½® bootclasspath å…¶ä¸­ /a:. è¡¨ç¤ºå°†å½“å‰ç›®å½•è¿½åŠ è‡³ bootclasspath ä¹‹åŽ å¯ä»¥ç”¨è¿™ä¸ªåŠžæ³•æ›¿æ¢æ ¸å¿ƒç±» java -Xbootclasspath:&lt;new bootclasspath&gt; java -Xbootclasspath/a:&lt;è¿½åŠ è·¯å¾„&gt; java -Xbootclasspath/p:&lt;è¿½åŠ è·¯å¾„&gt; 2) æ‰©å±•ç±»åŠ è½½å™¨12345678package cn.itcast.jvm.t3.load;public class G &#123; static &#123;// System.out.println(&quot;ext G init&quot;); System.out.println(&quot;classpath G init&quot;); &#125;&#125; æ‰§è¡Œ 12345678910111213package cn.itcast.jvm.t3.load;/** * æ¼”ç¤º æ‰©å±•ç±»åŠ è½½å™¨ * åœ¨ C:\\Program Files\\Java\\jdk1.8.0_91 ä¸‹æœ‰ä¸€ä¸ª my.jar * é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ª G çš„ç±»ï¼Œè§‚å¯Ÿåˆ°åº•æ˜¯å“ªä¸ªç±»è¢«åŠ è½½äº† */public class Load5_2 &#123; public static void main(String[] args) throws ClassNotFoundException &#123; Class&lt;?&gt; aClass = Class.forName(&quot;cn.itcast.jvm.t3.load.G&quot;); System.out.println(aClass.getClassLoader()); &#125;&#125; è¾“å‡º 12classpath G initsun.misc.Launcher$AppClassLoader@18b4aac2 å†™ä¸€ä¸ªåŒåçš„ç±» 12345678package cn.itcast.jvm.t3.load;public class G &#123; static &#123; System.out.println(&quot;ext G init&quot;); //System.out.println(&quot;classpath G init&quot;); &#125;&#125; æ‰“ä¸ª jar åŒ… 123E:\\git\\jvm\\out\\production\\jvm&gt;jar -cvf my.jar cn/itcast/jvm/t3/load/G.classå·²æ·»åŠ æ¸…å•æ­£åœ¨æ·»åŠ : cn/itcast/jvm/t3/load/G.class(è¾“å…¥ = 481) (è¾“å‡º = 322)(åŽ‹ç¼©äº† 33%) å°† jar åŒ…æ‹·è´åˆ° JAVA_HOME/jre/lib/exté‡æ–°æ‰§è¡Œ Load5_2è¾“å‡º 12ext G initsun.misc.Launcher$ExtClassLoader@29453f44 3) åŒäº²å§”æ´¾æ¨¡å¼æ‰€è°“çš„åŒäº²å§”æ´¾ï¼Œå°±æ˜¯æŒ‡è°ƒç”¨ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™ æ³¨æ„ è¿™é‡Œçš„åŒäº²ï¼Œç¿»è¯‘ä¸ºä¸Šçº§ä¼¼ä¹Žæ›´åŠ åˆé€‚ï¼Œå› ä¸ºä»–ä»¬å¹¶æ²¡æœ‰ç»§æ‰¿å…³ç³» 123456789101112131415161718192021222324252627282930313233 protected Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException &#123; synchronized (getClassLoadingLock(name)) &#123; // 1. æ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²ç»åŠ è½½ Class&lt;?&gt; c = findLoadedClass(name); if (c == null) &#123; long t0 = System.nanoTime(); try &#123; if (parent != null) &#123; // 2. æœ‰ä¸Šçº§çš„è¯ï¼Œå§”æ´¾ä¸Šçº§ loadClass c = parent.loadClass(name, false); &#125; else &#123; // 3. å¦‚æžœæ²¡æœ‰ä¸Šçº§äº†ï¼ˆExtClassLoaderï¼‰ï¼Œåˆ™å§”æ´¾ BootstrapClassLoader c = findBootstrapClassOrNull(name); &#125; &#125; catch (ClassNotFoundException e) &#123; &#125; i f (c == null) &#123; long t1 = System.nanoTime(); // 4. æ¯ä¸€å±‚æ‰¾ä¸åˆ°ï¼Œè°ƒç”¨ findClass æ–¹æ³•ï¼ˆæ¯ä¸ªç±»åŠ è½½å™¨è‡ªå·±æ‰©å±•ï¼‰æ¥åŠ è½½ c = findClass(name); // 5. è®°å½•è€—æ—¶ sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0); sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1); sun.misc.PerfCounter.getFindClasses().increment(); &#125; &#125; i f (resolve) &#123; resolveClass(c); &#125; r eturn c; &#125;&#125; ä¾‹å¦‚ï¼š 123456789101112package cn.itcast.jvm.t3.load;import java.util.ServiceLoader;public class Load5_3 &#123; public static void main(String[] args) throws ClassNotFoundException &#123; System.out.println(Load5_3.class.getClassLoader()); Class&lt;?&gt; aClass = Load5_3.class.getClassLoader().loadClass(&quot;cn.itcast.jvm.t3.load.H&quot;); System.out.println(aClass.getClassLoader()); &#125;&#125; æ‰§è¡Œæµç¨‹ä¸ºï¼š sun.misc.Launcher$AppClassLoader //1 å¤„ï¼Œ å¼€å§‹æŸ¥çœ‹å·²åŠ è½½çš„ç±»ï¼Œç»“æžœæ²¡æœ‰ sun.misc.Launcher$AppClassLoader // 2 å¤„ï¼Œå§”æ´¾ä¸Šçº§sun.misc.Launcher$ExtClassLoader.loadClass() sun.misc.Launcher$ExtClassLoader // 1 å¤„ï¼ŒæŸ¥çœ‹å·²åŠ è½½çš„ç±»ï¼Œç»“æžœæ²¡æœ‰ sun.misc.Launcher$ExtClassLoader // 3 å¤„ï¼Œæ²¡æœ‰ä¸Šçº§äº†ï¼Œåˆ™å§”æ´¾ BootstrapClassLoader æŸ¥æ‰¾ BootstrapClassLoader æ˜¯åœ¨ JAVA_HOME/jre/lib ä¸‹æ‰¾ H è¿™ä¸ªç±»ï¼Œæ˜¾ç„¶æ²¡æœ‰ sun.misc.Launcher$ExtClassLoader // 4 å¤„ï¼Œè°ƒç”¨è‡ªå·±çš„ findClass æ–¹æ³•ï¼Œæ˜¯åœ¨JAVA_HOME/jre/lib/ext ä¸‹æ‰¾ H è¿™ä¸ªç±»ï¼Œæ˜¾ç„¶æ²¡æœ‰ï¼Œå›žåˆ° sun.misc.Launcher$AppClassLoaderçš„ // 2 å¤„ ç»§ç»­æ‰§è¡Œåˆ° sun.misc.Launcher$AppClassLoader // 4 å¤„ï¼Œè°ƒç”¨å®ƒè‡ªå·±çš„ findClass æ–¹æ³•ï¼Œåœ¨classpath ä¸‹æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº† æ€»ä¹‹å°±æ˜¯ï¼Œå…ˆæŸ¥æ‰¾è‡ªå·±å·²åŠ è½½çš„ç±»ï¼Œæ²¡æœ‰åˆ™å§”æ´¾ä¸Šçº§æŸ¥æ‰¾å·²åŠ è½½çš„ç±»ï¼Œé€’å½’åŽ»æŸ¥æ‰¾ï¼ˆå¥—å¨ƒï¼‰ï¼Œæ²¡æœ‰å†åŽ»å„è‡ªç±»åŠ è½½å™¨çš„ç±»è·¯å¾„æŸ¥æ‰¾æœªåŠ è½½çš„ç±»ï¼Œæœ‰åˆ™æŠŠå®ƒåŠ è½½ï¼Œæ²¡æœ‰ï¼ˆè§£å¨ƒï¼‰ï¼Œè®©ä¸‹çº§ç»§ç»­é€’å½’ 4) çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æˆ‘ä»¬åœ¨ä½¿ç”¨ JDBC æ—¶ï¼Œéƒ½éœ€è¦åŠ è½½ Driver é©±åŠ¨ï¼Œä¸çŸ¥é“ä½ æ³¨æ„åˆ°æ²¡æœ‰ï¼Œä¸å†™ 1Class.forName(&quot;com.mysql.jdbc.Driver&quot;) ä¹Ÿæ˜¯å¯ä»¥è®© com.mysql.jdbc.Driver æ­£ç¡®åŠ è½½çš„ï¼Œä½ çŸ¥é“æ˜¯æ€Žä¹ˆåšçš„å—ï¼Ÿè®©æˆ‘ä»¬è¿½è¸ªä¸€ä¸‹æºç ï¼š 12345678910public class DriverManager &#123; // æ³¨å†Œé©±åŠ¨çš„é›†åˆ private final static CopyOnWriteArrayList&lt;DriverInfo&gt; registeredDrivers = new CopyOnWriteArrayList&lt;&gt;(); // åˆå§‹åŒ–é©±åŠ¨ static &#123; loadInitialDrivers(); println(&quot;JDBC DriverManager initialized&quot;); &#125;&#125; å…ˆä¸çœ‹åˆ«çš„ï¼Œçœ‹çœ‹ DriverManager çš„ç±»åŠ è½½å™¨ï¼š 1System.out.println(DriverManager.class.getClassLoader()); æ‰“å° nullï¼Œè¡¨ç¤ºå®ƒçš„ç±»åŠ è½½å™¨æ˜¯ Bootstrap ClassLoaderï¼Œä¼šåˆ° JAVA_HOME/jre/lib ä¸‹æœç´¢ç±»ï¼Œä½†JAVA_HOME/jre/lib ä¸‹æ˜¾ç„¶æ²¡æœ‰ mysql-connector-java-5.1.47.jar åŒ…ï¼Œè¿™æ ·é—®é¢˜æ¥äº†ï¼Œåœ¨DriverManager çš„é™æ€ä»£ç å—ä¸­ï¼Œæ€Žä¹ˆèƒ½æ­£ç¡®åŠ è½½ com.mysql.jdbc.Driver å‘¢ï¼Ÿ ç»§ç»­çœ‹ loadInitialDrivers() æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344private static void loadInitialDrivers() &#123; String drivers; try &#123; drivers = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() &#123; public String run() &#123; return System.getProperty(&quot;jdbc.drivers&quot;); &#125; &#125;); &#125; catch (Exception ex) &#123; drivers = null; &#125; // 1ï¼‰ä½¿ç”¨ ServiceLoader æœºåˆ¶åŠ è½½é©±åŠ¨ï¼Œå³ SPI AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator(); try&#123; while(driversIterator.hasNext()) &#123; driversIterator.next(); &#125; &#125; catch(Throwable t) &#123; // Do nothing &#125; return null; &#125; &#125;); println(&quot;DriverManager.initialize: jdbc.drivers = &quot; + drivers); // 2ï¼‰ä½¿ç”¨ jdbc.drivers å®šä¹‰çš„é©±åŠ¨ååŠ è½½é©±åŠ¨ if (drivers == null || drivers.equals(&quot;&quot;)) &#123; return; &#125; String[] driversList = drivers.split(&quot;:&quot;); println(&quot;number of Drivers:&quot; + driversList.length); for (String aDriver : driversList) &#123; try &#123; println(&quot;DriverManager.Initialize: loading &quot; + aDriver); // è¿™é‡Œçš„ ClassLoader.getSystemClassLoader() å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ Class.forName(aDriver, true, ClassLoader.getSystemClassLoader()); &#125; catch (Exception ex) &#123; println(&quot;DriverManager.Initialize: load failed: &quot; + ex); &#125; &#125;&#125; å…ˆçœ‹ 2ï¼‰å‘çŽ°å®ƒæœ€åŽæ˜¯ä½¿ç”¨ Class.forName å®Œæˆç±»çš„åŠ è½½å’Œåˆå§‹åŒ–ï¼Œå…³è”çš„æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå› æ­¤å¯ä»¥é¡ºåˆ©å®Œæˆç±»åŠ è½½ å†çœ‹ 1ï¼‰å®ƒå°±æ˜¯å¤§åé¼Žé¼Žçš„ Service Provider Interface ï¼ˆSPIï¼‰ çº¦å®šå¦‚ä¸‹ï¼Œåœ¨ jar åŒ…çš„ META-INF/services åŒ…ä¸‹ï¼Œä»¥æŽ¥å£å…¨é™å®šååä¸ºæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯å®žçŽ°ç±»å è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ 12345ServiceLoader&lt;æŽ¥å£ç±»åž‹&gt; allImpls = ServiceLoader.load(æŽ¥å£ç±»åž‹.class);Iterator&lt;æŽ¥å£ç±»åž‹&gt; iter = allImpls.iterator();while(iter.hasNext()) &#123; iter.next();&#125; æ¥å¾—åˆ°å®žçŽ°ç±»ï¼Œä½“çŽ°çš„æ˜¯ã€é¢å‘æŽ¥å£ç¼–ç¨‹+è§£è€¦ã€‘çš„æ€æƒ³ï¼Œåœ¨ä¸‹é¢ä¸€äº›æ¡†æž¶ä¸­éƒ½è¿ç”¨äº†æ­¤æ€æƒ³ï¼š JDBC Servlet åˆå§‹åŒ–å™¨ Spring å®¹å™¨ Dubboï¼ˆå¯¹ SPI è¿›è¡Œäº†æ‰©å±•ï¼‰ æŽ¥ç€çœ‹ ServiceLoader.load æ–¹æ³•ï¼š 12345public static &lt;S&gt; ServiceLoader&lt;S&gt; load(Class&lt;S&gt; service) &#123; // èŽ·å–çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ ClassLoader cl = Thread.currentThread().getContextClassLoader(); return ServiceLoader.load(service, cl);&#125; çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯å½“å‰çº¿ç¨‹ä½¿ç”¨çš„ç±»åŠ è½½å™¨ï¼Œé»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œå®ƒå†…éƒ¨åˆæ˜¯ç”±Class.forName è°ƒç”¨äº†çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨å®Œæˆç±»åŠ è½½ï¼Œå…·ä½“ä»£ç åœ¨ ServiceLoader çš„å†…éƒ¨ç±»LazyIterator ä¸­ï¼š 123456789101112131415161718192021222324252627private S nextService() &#123; if (!hasNextService()) throw new NoSuchElementException(); String cn = nextName; nextName = null; Class&lt;?&gt; c = null; try &#123; c = Class.forName(cn, false, loader); &#125; catch (ClassNotFoundException x) &#123; fail(service, &quot;Provider &quot; + cn + &quot; not found&quot;); &#125; if (!service.isAssignableFrom(c)) &#123; fail(service, &quot;Provider &quot; + cn + &quot; not a subtype&quot;); &#125; try &#123; S p = service.cast(c.newInstance()); providers.put(cn, p); return p; &#125; catch (Throwable x) &#123; fail(service, &quot;Provider &quot; + cn + &quot; could not be instantiated&quot;, x); &#125; throw new Error(); // This cannot happen&#125; 5) è‡ªå®šä¹‰ç±»åŠ è½½å™¨é—®é—®è‡ªå·±ï¼Œä»€ä¹ˆæ—¶å€™éœ€è¦è‡ªå®šä¹‰ç±»åŠ è½½å™¨ æƒ³åŠ è½½éž classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶ éƒ½æ˜¯é€šè¿‡æŽ¥å£æ¥ä½¿ç”¨å®žçŽ°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æž¶è®¾è®¡ è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äºŽ tomcat å®¹å™¨ æ­¥éª¤ï¼š ç»§æ‰¿ ClassLoader çˆ¶ç±» è¦éµä»ŽåŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ findClass æ–¹æ³• æ³¨æ„ä¸æ˜¯é‡å†™ loadClass æ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶ è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç  è°ƒç”¨çˆ¶ç±»çš„ defineClass æ–¹æ³•æ¥åŠ è½½ç±» ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³• ç¤ºä¾‹ï¼š åœ¨å½“å‰ç±»çš„çˆ¶ç›®å½•ä¸‹ï¼Œåˆ›å»ºTestCassç±» NIOæ–¹å¼ 1234567891011121314151617181920212223class MyClassLoader extends ClassLoader &#123; @Override // name å°±æ˜¯ç±»åç§° protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; String path = &quot;D:\\\\Users\\\\fyp01\\\\IdeaProjects\\\\jvm\\\\jvm\\\\src\\\\cn\\\\itcast\\\\jvm\\\\t3\\\\load\\\\&quot; + name + &quot;.class&quot;; try &#123; ByteArrayOutputStream os = new ByteArrayOutputStream(); Files.copy(Paths.get(path), os); // å¾—åˆ°å­—èŠ‚æ•°ç»„ byte[] bytes = os.toByteArray(); // byte[] -&gt; *.class return defineClass(name, bytes, 0, bytes.length); &#125; catch (IOException e) &#123; e.printStackTrace(); throw new ClassNotFoundException(&quot;ç±»æ–‡ä»¶æœªæ‰¾åˆ°&quot;, e); &#125; &#125;&#125; ä¼ ç»ŸIOæ–¹å¼ 123456789101112131415161718192021222324252627282930public class MyClassLoder1 extends ClassLoader &#123; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; String path = &quot;D:\\\\Users\\\\fyp01\\\\IdeaProjects\\\\jvm\\\\jvm\\\\src\\\\cn\\\\itcast\\\\jvm\\\\t3\\\\load\\\\&quot; + name + &quot;.class&quot;; try &#123; FileInputStream in = new FileInputStream(new File(path)); ByteArrayOutputStream baos = new ByteArrayOutputStream(); int len = -1; byte[] b = new byte[1024]; while ((len = in.read(b)) != -1) &#123; baos.write(b, 0, len); &#125; byte[] bytes = baos.toByteArray(); in.close(); baos.close(); return defineClass(name, bytes, 0, bytes.length); &#125; catch (IOException e) &#123; e.printStackTrace(); return null; &#125; &#125; public static void main(String[] args) throws Exception &#123; MyClassLoder1 myClassLoder1 = new MyClassLoder1(); Class&lt;?&gt; demo = myClassLoder1.loadClass(&quot;com.itheima.Demo&quot;); Object o = demo.newInstance(); System.out.println(o); &#125;&#125; 6) ç±»åŠ è½½å™¨çš„å‘½åç©ºé—´æ¦‚å¿µï¼š æ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰å„è‡ªçš„å‘½åç©ºé—´ï¼Œå‘½åç©ºé—´ç”±è¯¥åŠ è½½å™¨åŠæ‰€æœ‰çˆ¶åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»ç»„æˆ åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­ï¼Œä¸ä¼šå‡ºçŽ°å…¨é™å®šç±»åç›¸åŒçš„ä¸¤ä¸ªClasså¯¹è±¡ åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸­ï¼Œå¯ä»¥å‡ºçŽ°å…¨é™å®šç±»åç›¸åŒçš„ä¸¤ä¸ªClasså¯¹è±¡ çˆ¶åŠ è½½å™¨åŠ è½½çš„ç±»å¯¹å…¶å­åŠ è½½å™¨å¯è§ï¼Œå­åŠ è½½å™¨åŠ è½½çš„ç±»å¯¹å…¶çˆ¶åŠ è½½å™¨ä¸å¯è§ å¦‚æžœä¸¤ä¸ªåŠ è½½å™¨ä¹‹é—´æ²¡æœ‰ç›´æŽ¥æˆ–é—´æŽ¥çˆ¶å­çš„å…³ç³»ï¼Œé‚£ä¹ˆå®ƒä»¬å„è‡ªåŠ è½½çš„ç±»ç›¸äº’ä¸å¯è§ å¦‚ä½•é€šè¿‡æ¡ˆä¾‹ä½è¯ï¼Ÿ éªŒè¯ï¼š æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç±»åŠ è½½å™¨MyClassLoaderåŽ»ç»§æ‰¿ClassLoaderï¼Œé‡å†™çˆ¶ç±»çš„ findClassæ–¹æ³• ä¸ºä»€ä¹ˆè¦é‡å†™ findClassæ–¹æ³•ï¼Ÿ é¦–å…ˆæˆ‘ä»¬æ˜¯ä½¿ç”¨åŒäº²å§”æ´¾çš„æ–¹å¼ æ¥å®žçŽ°ç±»åŠ è½½ï¼ŒfindClassæ–¹æ³• åœ¨ è°ƒç”¨ ClassLoaderçš„ loadClassæ–¹æ³•åŽï¼Œä¼šåœ¨è¯¥æ–¹æ³•ä½“ è°ƒç”¨ findClassæ–¹æ³•ï¼ŒfindClassæ–¹æ³•æ˜¯ ä»Ž è‡ªèº«åŠ è½½å™¨æ‰€åœ¨çš„ ç±»è·¯å¾„ä¸‹ åŠ è½½ class æ–‡ä»¶ æˆ‘ä»¬å…ˆ ç”¨ ClassLoader åŽ»åŠ è½½ æˆ‘ä»¬è‡ªå®šä¹‰çš„ Student ç±»ï¼Œç„¶åŽå†åŽ»ç”¨è‡ªå®šä¹‰çš„ ç±»åŠ è½½å™¨åŽ» åŠ è½½ Studengç±»ï¼š 1234567891011121314/** * @Auther: fyp * @Date: 2022/3/3 * @Description: * @Package: PACKAGE_NAME * @Version: 1.0 */public class Student&#123; private Student student; //setteræ–¹æ³•çš„å‚æ•°æ˜¯Objectç±»åž‹ public void setStudent(Object object) &#123; this.student = (Student) object; &#125;&#125; Demoæ¼”ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;/** * @Auther: fyp * @Date: 2022/3/3 * @Description: * @Package: PACKAGE_NAME * @Version: 1.0 */public class Demo &#123; public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchMethodException, InvocationTargetException &#123; //é€šè¿‡çº¿ç¨‹èŽ·å–çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨,é»˜è®¤æ˜¯Application ClassLoader ClassLoader classLoader = Thread.currentThread().getContextClassLoader(); /*ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨ ç±».class.getClassLoader èŽ·å– ç±»åŠ è½½å™¨ ClassLoader classLoader = Demo.class.getClassLoader(); ç¬¬ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨ Class.forName(&quot;å…¨é™å®šç±»å&quot;) æ¥èŽ·å–ç±»åŠ è½½å™¨ Class&lt;?&gt; sclass = Class.forName(&quot;Student&quot;); ClassLoader classLoader = sclass.getClassLoader(); */ //ä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½ä¸¤ä¸ªClasså¯¹è±¡ Class c1 = classLoader.loadClass(&quot;Student&quot;); Class c2 = classLoader.loadClass(&quot;Student&quot;); System.out.println(c1 == c2); //ä½¿ç”¨ä¸¤ä¸ªClasså¯¹è±¡åˆ†åˆ«åˆ›å»ºä¸€ä¸ªæ–°çš„å®žä¾‹(ä¸ä½¿ç”¨å¼ºè¡Œè½¬æ¢) Object o1 = c1.newInstance(); Object o2 = c2.newInstance(); //èŽ·å–setStudentæ–¹æ³• Method m1 = c1.getMethod(&quot;setStudent&quot;,Object.class); //ä½¿ç”¨o1å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œo2å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ å…¥ m1.invoke(o1,o2); System.out.println(o1); &#125;&#125; è¾“å‡ºï¼š 12trueStudent@677327b6 c1 == c2 è¿”å›žçš„ç»“æžœæ˜¯trueï¼Œè¯´æ˜Žåœ¨å †å†…å­˜ä¸­åŒä¸€ä¸ªç±»çš„Classå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼Œç¬¬äºŒæ¡å¾—ä»¥ä½è¯ æŽ¥ä¸‹æ¥é€šè¿‡è‡ªå®šä¹‰ç±»åŠ è½½å™¨ æ¥ä½è¯ç¬¬ä¸‰æ¡ è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¦‚ä¸‹ï¼š 12345678910111213141516171819class MyClassLoader extends ClassLoader&#123; @Override protected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123; String path = &quot;e:\\\\myclasspath\\\\&quot; + name + &quot;.class&quot;; try &#123; //åˆ›å»ºbyteæ•°ç»„è¾“å‡ºæµ ByteArrayOutputStream os = new ByteArrayOutputStream(); //æŠŠå­—èŠ‚ç æ–‡ä»¶å¤åˆ¶åˆ°æµä¸­ Files.copy(Paths.get(path),os); //å¾—åˆ°å­—èŠ‚æ•°ç»„ byte[] bytes = os.toByteArray(); //è°ƒç”¨çˆ¶ç±»çš„defineClassæ–¹æ³•åŠ è½½ç±» return defineClass(name,bytes,0,bytes.length); &#125; catch (Exception e) &#123; e.printStackTrace(); throw new ClassNotFoundException(&quot;æ‰¾ä¸åˆ°ç±»æ–‡ä»¶&quot;); &#125; &#125;&#125; æ³¨æ„ï¼š ä¹‹å‰åŠ è½½çš„ Studentç±»çš„ classå­—èŠ‚ç æ–‡ä»¶ æ˜¯ å…³è”äº† Studentçš„ javaç±»åŠ¨æ€ç”Ÿæˆçš„ï¼Œä¸Šé¢çš„ pathè·¯å¾„ä¸‹å¯¹åº”çš„ å­—èŠ‚ç æ–‡ä»¶æš‚æ—¶ä¸ç®¡ Demo1æ¼”ç¤ºï¼š 1234567891011121314151617181920212223242526272829import java.io.ByteArrayOutputStream;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Paths;/** * @Auther: fyp * @Date: 2022/3/3 * @Description: * @Package: PACKAGE_NAME * @Version: 1.0 */public class Demo1 &#123; public static void main(String[] args) throws ClassNotFoundException, IllegalAccessException, InstantiationException, InvocationTargetException, NoSuchMethodException, InvocationTargetException &#123; //åˆ›å»ºä¸¤ä¸ªè‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„å¯¹çº¿ä¸‹ MyClassLoader c1 = new MyClassLoader(); MyClassLoader c2 = new MyClassLoader(); //åˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªç±»åŠ è½½å™¨åŠ è½½Studentç±» Class s1 = c1.loadClass(&quot;Student&quot;); Class s2 = c2.loadClass(&quot;Student&quot;); System.out.println(s1 == s2); Object o1 = s1.newInstance(); Object o2 = s2.newInstance(); Method m1 = s1.getMethod(&quot;setStudent&quot;, Object.class); m1.invoke(o1,o2); System.out.println(o1); &#125;&#125; è¾“å‡ºï¼š 12trueStudent@14ae5a5 æˆ‘ä»¬ç»“åˆåŒäº²å§”æ´¾æ¥çœ‹ä¸¤ä¸ªDemoçš„è¾“å‡ºï¼Œç»“æžœéƒ½ä¸ºtrue çŽ°åœ¨æˆ‘æƒ³æœ€å¤§çš„ç–‘é—®å°±æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘æŠŠ ç±»åŠ è½½å™¨ åŠ è½½çš„ å­—èŠ‚ç  è·¯å¾„ è½¬ç§»åˆ° e:\\\\myclasspath\\\\è·¯å¾„ä¸‹ï¼Œè€Œä¸”è¯¥è·¯å¾„æ²¡æœ‰ Studentçš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä¸ºä»€ä¹ˆè¿˜å¯ä»¥ åŠ è½½ï¼Ÿ é‚£æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡ ClassLoaderçš„åŒäº²å§”æ´¾ æ¥åŠ è½½çš„ ç±»åŠ è½½å™¨ï¼Œå®ƒ åŠ è½½çš„ç±»æœ‰ ä¸€ä¸ªæœºåˆ¶ï¼ŒåŠ è½½çš„ä¼˜å…ˆé¡ºåºå¦‚ä¸‹ï¼š è‡ªå®šä¹‰ç±»åŠ è½½å™¨ &lt; åº”ç”¨ç±»åŠ è½½å™¨ &lt; æ‹“å±•ç±»åŠ è½½å™¨ &lt; å¯åŠ¨ç±»åŠ è½½å™¨ å®ƒä¼šå…ˆåŽ»ä¸Šçº§ åŠ è½½ Studentçš„ å­—èŠ‚ç æ–‡ä»¶ï¼Œå³ä»Ž å¯åŠ¨ç±»åŠ è½½å™¨ ä¾æ¬¡åˆ° è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ¬¡æ‰§è¡Œç¨‹åºæ—¶ï¼Œå°±åŠ¨æ€ç”Ÿæˆäº†Studentå­—èŠ‚ç ï¼Œæˆ‘ä»¬ ä¸å¦¨ åˆ é™¤ ä¹‹å‰çš„å­—èŠ‚ç æ–‡ä»¶ è¾“å‡ºï¼š 12345Exception in thread &quot;main&quot; java.lang.ClassNotFoundException: æ‰¾ä¸åˆ°ç±»æ–‡ä»¶ at MyClassLoader.findClass(Demo1.java:47) at java.lang.ClassLoader.loadClass(ClassLoader.java:424) at java.lang.ClassLoader.loadClass(ClassLoader.java:357) at Demo1.main(Demo1.java:20) è¯´æ˜Ž æˆ‘ä»¬ æ˜¯åŽ» åŠ è½½äº† ä¹‹å‰çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œæˆ‘ä»¬æŠŠä¹‹å‰çš„å­—èŠ‚ç æ–‡ä»¶ Student.classæ”¾åˆ° e:\\\\myclasspath\\\\ç›®å½•ä¸­åŽ»ï¼Œå†æ¬¡æ‰§è¡Œ è¾“å‡ºï¼š 123456falseException in thread &quot;main&quot; java.lang.reflect.InvocationTargetException...Caused by: java.lang.ClassCastException: Student cannot be cast to Student at Student.setStudent(Student.java:13) ... 5 more falseè¯´æ˜Žäº† è¿™ä¸¤ä¸ªç±»å¯¹è±¡ æ˜¯ä¸åŒçš„ Student cannot be cast to Student å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ ä¸¤ä¸ª è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œè€Œä¸”ä¸¤ä¸ª ç±»åŠ è½½åŽ ä¸åœ¨ åŒä¸€ä¸ª å‘½åç©ºé—´ï¼Œä¸ºä»€ä¹ˆä¸åœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ï¼Œæ ¹æ®åŒäº²å§”æ´¾çš„æœºåˆ¶ï¼Œåªæœ‰ä¸Šçº§çš„ç±»åŠ è½½å™¨å¯¹ä¸‹çº§çš„ç±»åŠ è½½å™¨å¯è§ï¼Œæ‰€ä»¥ä¹‹å‰çš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨ å¯¹ åº”ç”¨ç±»åŠ è½½å™¨å·²åŠ è½½çš„Student.classå¯è§ï¼ŒåŽæ¥åˆ äº†è¯¥å­—èŠ‚ç æ–‡ä»¶ï¼Œåº”ç”¨ç±»åŠ è½½å™¨å°±ä¸ä¼šåŽ»åŠ è½½äº†ï¼Œæ‰€ä»¥ä¸¤ä¸ªç±»ç›¸å¯¹æ¥è¯´æ˜¯ ä¸å¯è§çš„ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„å‘½åç©ºé—´ï¼Œè€Œä¸”ä¸¤ä¸ªå‘½åç©ºé—´å¯ä»¥å­˜åœ¨ç›¸åŒå…¨é™å®šç±»åçš„å¯¹è±¡ï¼Œä½è¯äº†ç¬¬3ã€4å’Œ5ç‚¹ã€‚ 7) å³æ—¶ç¼–è¯‘åˆ†å±‚ç¼–è¯‘ï¼ˆTieredCompilationï¼‰å…ˆæ¥ä¸ªä¾‹å­ 12345678910111213141516package cn.itcast.jvm.t3.jit;public class JIT1 &#123; // -XX:+PrintCompilation æŒ‡æ‰“å°ç¼–è¯‘ä¿¡æ¯ -XX:-DoEscapeAnalysis ç¬¬äºŒä¸ªæŒ‡ å…³é—­ C2 ç¼–è¯‘å™¨çš„ä¼˜åŒ–é˜¶æ®µ public static void main(String[] args) &#123; for (int i = 0; i &lt; 200; i++) &#123; long start = System.nanoTime(); for (int j = 0; j &lt; 1000; j++) &#123; new Object(); &#125; long end = System.nanoTime(); System.out.printf(&quot;%d\\t%d\\n&quot;,i,(end - start)); &#125; &#125;&#125; è¾“å‡º 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992000 2472001 932002 1129003 824004 861995 882006 929997 851998 902009 17720010 9260111 21130012 22860013 18560014 16299915 14719916 12239917 9179918 8559919 8899920 21140021 19890022 9030023 8850024 25150025 18580126 8379927 9370028 9630029 27550130 21320031 18320032 9140033 9330134 13540135 8990036 8960037 9689938 9040039 9650140 12710041 15019942 9120043 8760044 8450045 9080146 8960047 9170048 8430049 7830050 9160051 8720052 8720053 8230054 8619955 8620056 8660057 8820158 9160159 8800060 11540061 8990162 8400063 8270064 10940165 8730066 7400067 3449968 3850069 3790070 3030071 3070072 3040073 2789974 2750175 2789976 3000177 5710078 3230079 2980080 2580081 3029982 3099983 3800184 2680085 2790086 3290187 2990088 2550089 3209990 3930091 3580092 2650093 3060194 3740095 3160096 5960097 3410198 3119999 31300100 31399101 31399102 90401103 32400104 33100105 31400106 30900107 29001108 31900109 34600110 37401111 27201112 32000113 30500114 31400115 27501116 32300117 31200118 36399119 26001120 30900121 31000122 34701123 30700124 28299125 32500126 32600127 37601128 31100129 31400130 31801131 31400132 32399133 31800134 30600135 36101136 30900137 30901138 25499139 30201140 31801141 29999142 28200143 35000144 31500145 32000146 33000147 32400148 29700149 30200150 29399151 206900152 70300153 1500154 1500155 1499156 1700157 1399158 1499159 1401160 1501161 1499162 1401163 1700164 1401165 1400166 1400167 1500168 1500169 1600170 1400171 1800172 1400173 1501174 1500175 1600176 1499177 1500178 1500179 1601180 1400181 1399182 1399183 1500184 1400185 1500186 1399187 1500188 1500189 1499190 1500191 1501192 1600193 1500194 1599195 1499196 1400197 1600198 1600199 1599 åŽŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡ï¼š 0 å±‚ï¼Œè§£é‡Šæ‰§è¡Œï¼ˆInterpreterï¼‰ 1 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ profilingï¼‰ 2 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„ profilingï¼‰ 3 å±‚ï¼Œä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„ profilingï¼‰ 4 å±‚ï¼Œä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ profiling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªçŽ¯çš„å›žè¾¹æ¬¡æ•°ã€‘ç­‰ å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸Žè§£é‡Šå™¨çš„åŒºåˆ« è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š JIT æ˜¯å°†ä¸€äº›å­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜å…¥ Code Cacheï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æŽ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘ è§£é‡Šå™¨æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç  JIT ä¼šæ ¹æ®å¹³å°ç±»åž‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç  å¯¹äºŽå æ®å¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿è¡Œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºŽä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰§è¡Œæ•ˆçŽ‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter &lt; C1 &lt; C2ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘çŽ°çƒ­ç‚¹ä»£ç ï¼ˆhotspotåç§°çš„ç”±æ¥ï¼‰ï¼Œä¼˜åŒ–ä¹‹ åˆšæ‰çš„ä¸€ç§ä¼˜åŒ–æ‰‹æ®µç§°ä¹‹ä¸ºã€é€ƒé€¸åˆ†æžã€‘ï¼Œå‘çŽ°æ–°å»ºçš„å¯¹è±¡æ˜¯å¦é€ƒé€¸ã€‚å¯ä»¥ä½¿ç”¨ -XX:-DoEscapeAnalysis å…³é—­é€ƒé€¸åˆ†æžï¼Œå†è¿è¡Œåˆšæ‰çš„ç¤ºä¾‹è§‚å¯Ÿç»“æžœ å‚è€ƒèµ„æ–™ï¼šhttps://docs.oracle.com/en/java/javase/12/vm/java-hotspot-virtual-machineperformance-enhancements.html#GUID-D2E3DC58-D18B-4A6C-8167-4A1DFB4888E4 æ–¹æ³•å†…è”ï¼ˆInliningï¼‰ 123private static int square(final int i) &#123; return i * i;&#125; 1System.out.println(square(9)); å¦‚æžœå‘çŽ° square æ˜¯çƒ­ç‚¹æ–¹æ³•ï¼Œå¹¶ä¸”é•¿åº¦ä¸å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡Œå†…è”ï¼Œæ‰€è°“çš„å†…è”å°±æ˜¯æŠŠæ–¹æ³•å†…ä»£ç æ‹·è´ã€ç²˜è´´åˆ°è°ƒç”¨è€…çš„ä½ç½®ï¼š 1System.out.println(9 * 9); è¿˜èƒ½å¤Ÿè¿›è¡Œå¸¸é‡æŠ˜å ï¼ˆconstant foldingï¼‰çš„ä¼˜åŒ– 1System.out.println(81); å®žéªŒ 1234567891011121314151617181920public class JIT2 &#123; // -XX:+UnlockDiagnosticVMOptions -XX:+PrintInlining ï¼ˆè§£é”éšè—å‚æ•°ï¼‰æ‰“å° inlining ä¿¡æ¯ // -XX:CompileCommand=dontinline,*JIT2.square ç¦æ­¢æŸä¸ªæ–¹æ³• inlining // -XX:+PrintCompilation æ‰“å°ç¼–è¯‘ä¿¡æ¯ public static void main(String[] args) &#123; int x = 0; for (int i = 0; i &lt; 500; i++) &#123; long start = System.nanoTime(); for (int j = 0; j &lt; 1000; j++) &#123; x = square(9); &#125; long end = System.nanoTime(); System.out.printf(&quot;%d\\t%d\\t%d\\n&quot;,i,x,(end - start)); &#125; &#125; private static int square(final int i) &#123; return i * i; &#125; &#125; å­—æ®µä¼˜åŒ–JMH åŸºå‡†æµ‹è¯•è¯·å‚è€ƒï¼šhttp://openjdk.java.net/projects/code-tools/jmh/åˆ›å»º maven å·¥ç¨‹ï¼Œæ·»åŠ ä¾èµ–å¦‚ä¸‹ 1234567891011&lt;dependency&gt; &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt; &lt;artifactId&gt;jmh-core&lt;/artifactId&gt; &lt;version&gt;$&#123;jmh.version&#125;&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.openjdk.jmh&lt;/groupId&gt; &lt;artifactId&gt;jmh-generator-annprocess&lt;/artifactId&gt; &lt;version&gt;$&#123;jmh.version&#125;&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt;&lt;/dependency&gt; ç¼–å†™åŸºå‡†æµ‹è¯•ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package test;import org.openjdk.jmh.annotations.*;import org.openjdk.jmh.runner.Runner;import org.openjdk.jmh.runner.RunnerException;import org.openjdk.jmh.runner.options.Options;import org.openjdk.jmh.runner.options.OptionsBuilder;import java.util.Random;import java.util.concurrent.ThreadLocalRandom;@Warmup(iterations = 2, time = 1)@Measurement(iterations = 5, time = 1)@State(Scope.Benchmark)public class Benchmark1 &#123; int[] elements = randomInts(1_000); private static int[] randomInts(int size) &#123; Random random = ThreadLocalRandom.current(); int[] values = new int[size]; for (int i = 0; i &lt; size; i++) &#123; values[i] = random.nextInt(); &#125; return values; &#125; @Benchmark public void test1() &#123; for (int i = 0; i &lt; elements.length; i++) &#123; doSum(elements[i]); &#125; &#125; @Benchmark public void test2() &#123; int[] local = this.elements; for (int i = 0; i &lt; local.length; i++) &#123; doSum(local[i]); &#125; &#125; @Benchmark public void test3() &#123; for (int element : elements) &#123; doSum(element); &#125; &#125; static int sum = 0; @CompilerControl(CompilerControl.Mode.DONT_INLINE) static void doSum(int x) &#123; sum += x; &#125; public static void main(String[] args) throws RunnerException &#123; Options opt = new OptionsBuilder() .include(Benchmark1.class.getSimpleName()) .forks(1) .build(); new Runner(opt).run(); &#125;&#125; é¦–å…ˆå¯ç”¨ doSum çš„æ–¹æ³•å†…è”ï¼Œæµ‹è¯•ç»“æžœå¦‚ä¸‹ï¼ˆæ¯ç§’åžåé‡ï¼Œåˆ†æ•°è¶Šé«˜çš„æ›´å¥½ï¼‰ï¼š 1234Benchmark Mode Samples Score Score error Unitst.Benchmark1.test1 thrpt 5 2420286.539 390747.467 ops/st.Benchmark1.test2 thrpt 5 2544313.594 91304.136 ops/st.Benchmark1.test3 thrpt 5 2469176.697 450570.647 ops/s æŽ¥ä¸‹æ¥ç¦ç”¨ doSum æ–¹æ³•å†…è” 1234@CompilerControl(CompilerControl.Mode.DONT_INLINE) static void doSum(int x) &#123; sum += x; &#125; æµ‹è¯•ç»“æžœå¦‚ä¸‹ï¼š 1234Benchmark Mode Samples Score Score error Unitst.Benchmark1.test1 thrpt 5 296141.478 63649.220 ops/st.Benchmark1.test2 thrpt 5 371262.351 83890.984 ops/st.Benchmark1.test3 thrpt 5 368960.847 60163.391 ops/s åˆ†æžï¼š åœ¨åˆšæ‰çš„ç¤ºä¾‹ä¸­ï¼ŒdoSum æ–¹æ³•æ˜¯å¦å†…è”ä¼šå½±å“ elements æˆå‘˜å˜é‡è¯»å–çš„ä¼˜åŒ–ï¼šå¦‚æžœ doSum æ–¹æ³•å†…è”äº†ï¼Œåˆšæ‰çš„ test1 æ–¹æ³•ä¼šè¢«ä¼˜åŒ–æˆä¸‹é¢çš„æ ·å­ï¼ˆä¼ªä»£ç ï¼‰ï¼š 12345678@Benchmark public void test1() &#123; // elements.length é¦–æ¬¡è¯»å–ä¼šç¼“å­˜èµ·æ¥ -&gt; int[] local for (int i = 0; i &lt; elements.length; i++) &#123; // åŽç»­ 999 æ¬¡ æ±‚é•¿åº¦ &lt;- local sum += elements[i]; // 1000 æ¬¡å–ä¸‹æ ‡ i çš„å…ƒç´  &lt;- local &#125; &#125; å¯ä»¥èŠ‚çœ 1999 æ¬¡ Field è¯»å–æ“ä½œä½†å¦‚æžœ doSum æ–¹æ³•æ²¡æœ‰å†…è”ï¼Œåˆ™ä¸ä¼šè¿›è¡Œä¸Šé¢çš„ä¼˜åŒ– ç»ƒä¹ ï¼šåœ¨å†…è”æƒ…å†µä¸‹å°† elements æ·»åŠ  volatile ä¿®é¥°ç¬¦ï¼Œè§‚å¯Ÿæµ‹è¯•ç»“æžœ 8) åå°„ä¼˜åŒ–12345678910111213141516171819package cn.itcast.jvm.t3.reflect; import java.io.IOException; import java.lang.reflect.InvocationTargetException; import java.lang.reflect.Method; public class Reflect1 &#123; public static void foo() &#123; System.out.println(&quot;foo...&quot;); &#125; public static void main(String[] args) throws Exception &#123; Method foo = Reflect1.class.getMethod(&quot;foo&quot;); for (int i = 0; i &lt;= 16; i++) &#123; System.out.printf(&quot;%d\\t&quot;, i); foo.invoke(null); &#125; System.in.read(); &#125; &#125; foo.invoke å‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®žçŽ° 12345678910111213141516171819202122232425262728293031323334353637383940package sun.reflect; import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Method; import sun.reflect.misc.ReflectUtil; class NativeMethodAccessorImpl extends MethodAccessorImpl &#123; private final Method method; private DelegatingMethodAccessorImpl parent; private int numInvocations; NativeMethodAccessorImpl(Method method) &#123; this.method = method; &#125; public Object invoke(Object target, Object[] args) throws IllegalArgumentException, InvocationTargetException &#123; // inflationThreshold è†¨èƒ€é˜ˆå€¼ï¼Œé»˜è®¤ 15 if (++this.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(this.method.getDeclaringClass())) &#123; // ä½¿ç”¨ ASM åŠ¨æ€ç”Ÿæˆçš„æ–°å®žçŽ°ä»£æ›¿æœ¬åœ°å®žçŽ°ï¼Œé€Ÿåº¦è¾ƒæœ¬åœ°å®žçŽ°å¿« 20 å€å·¦å³ MethodAccessorImpl generatedMethodAccessor = (MethodAccessorImpl) (new MethodAccessorGenerator()) .generateMethod( this.method.getDeclaringClass(), this.method.getName(), this.method.getParameterTypes(), this.method.getReturnType(), this.method.getExceptionTypes(), this.method.getModifiers() ); this.parent.setDelegate(generatedMethodAccessor); &#125; // è°ƒç”¨æœ¬åœ°å®žçŽ° return invoke0(this.method, target, args); &#125; void setParent(DelegatingMethodAccessorImpl parent) &#123; this.parent = parent; &#125; private static native Object invoke0(Method method, Object target, Object[] args); &#125; å½“è°ƒç”¨åˆ°ç¬¬ 16 æ¬¡ï¼ˆä»Ž0å¼€å§‹ç®—ï¼‰æ—¶ï¼Œä¼šé‡‡ç”¨è¿è¡Œæ—¶ç”Ÿæˆçš„ç±»ä»£æ›¿æŽ‰æœ€åˆçš„å®žçŽ°ï¼Œå¯ä»¥é€šè¿‡ debug å¾—åˆ°ç±»åä¸º sun.reflect.GeneratedMethodAccessor1 å¯ä»¥ä½¿ç”¨é˜¿é‡Œçš„ arthas å·¥å…·ï¼š 1234java -jar arthas-boot.jar[INFO] arthas-boot version: 3.1.1[INFO] Found existing java process, please choose one and hit RETURN.* [1]: 13065 cn.itcast.jvm.t3.reflect.Reflect1 é€‰æ‹© 1 å›žè½¦è¡¨ç¤ºåˆ†æžè¯¥è¿›ç¨‹ 12345678910111213141516[INFO] arthas home: C:\\Users\\fyp01\\.arthas\\lib\\3.5.6\\arthas[INFO] Try to attach process 13012[INFO] Attach process 13012 success.[INFO] arthas-client connect 127.0.0.1 3658 ,---. ,------. ,--------.,--. ,--. ,---. ,---. / O \\ | .--. &#x27;&#x27;--. .--&#x27;| &#x27;--&#x27; | / O \\ &#x27; .-&#x27;| .-. || &#x27;--&#x27;.&#x27; | | | .--. || .-. |`. `-.| | | || |\\ \\ | | | | | || | | |.-&#x27; |`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27; `--&#x27; `--&#x27; `--&#x27;`--&#x27; `--&#x27;`-----&#x27;wiki https://arthas.aliyun.com/doctutorials https://arthas.aliyun.com/doc/arthas-tutorials.htmlversion 3.5.6main_classpid 13012time 2022-03-05 13:31:26 å†è¾“å…¥ã€jad + ç±»åã€‘æ¥è¿›è¡Œåç¼–è¯‘ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849[arthas@13012]$ jad sun.reflect.GeneratedMethodAccessor1ClassLoader:+-sun.reflect.DelegatingClassLoader@1d44bcfa +-sun.misc.Launcher$AppClassLoader@18b4aac2 +-sun.misc.Launcher$ExtClassLoader@5cad8086Location:/* * Decompiled with CFR. * * Could not load the following classes: * cn.itcast.jvm.t3.reflect.Reflect1 */package sun.reflect;import cn.itcast.jvm.t3.reflect.Reflect1;import java.lang.reflect.InvocationTargetException;import sun.reflect.MethodAccessorImpl;public class GeneratedMethodAccessor1extends MethodAccessorImpl &#123; /* * Loose catch block */ public Object invoke(Object object, Object[] objectArray) throws InvocationTargetException &#123; // æ¯”è¾ƒå¥‡è‘©çš„åšæ³•ï¼Œå¦‚æžœæœ‰å‚æ•°ï¼Œé‚£ä¹ˆæŠ›éžæ³•å‚æ•°å¼‚å¸¸ block4: &#123; if (objectArray == null || objectArray.length == 0) break block4; throw new IllegalArgumentException(); &#125; try &#123; // å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æ˜¯ç›´æŽ¥è°ƒç”¨äº† Reflect1.foo(); // å› ä¸ºæ²¡æœ‰è¿”å›žå€¼ return null; &#125; catch (Throwable throwable) &#123; throw new InvocationTargetException(throwable); &#125; catch (ClassCastException | NullPointerException runtimeException) &#123; throw new IllegalArgumentException(super.toString()); &#125; &#125;&#125;Affect(row-cnt:1) cost in 609 ms.[arthas@13012]$ æ³¨æ„é€šè¿‡æŸ¥çœ‹ ReflectionFactory æºç å¯çŸ¥ sun.reflect.noInflation å¯ä»¥ç”¨æ¥ç¦ç”¨è†¨èƒ€ï¼ˆç›´æŽ¥ç”Ÿæˆ GeneratedMethodAccessor1ï¼Œä½†é¦–æ¬¡ç”Ÿæˆæ¯”è¾ƒè€—æ—¶ï¼Œå¦‚æžœä»…åå°„è°ƒç”¨ä¸€æ¬¡ï¼Œä¸åˆ’ç®—ï¼‰ sun.reflect.inflationThreshold å¯ä»¥ä¿®æ”¹è†¨èƒ€é˜ˆå€¼ äº”ã€å†…å­˜æ¨¡åž‹1. javaå†…å­˜æ¨¡åž‹1) åŽŸå­æ€§åŽŸå­æ€§åœ¨å­¦ä¹ çº¿ç¨‹æ—¶è®²è¿‡ï¼Œä¸‹é¢æ¥ä¸ªä¾‹å­ç®€å•å›žé¡¾ä¸€ä¸‹ï¼š é—®é¢˜æå‡ºï¼Œä¸¤ä¸ªçº¿ç¨‹å¯¹åˆå§‹å€¼ä¸º 0 çš„é™æ€å˜é‡ä¸€ä¸ªåšè‡ªå¢žï¼Œä¸€ä¸ªåšè‡ªå‡ï¼Œå„åš 5000 æ¬¡ï¼Œç»“æžœæ˜¯ 0 å—ï¼Ÿ 2) é—®é¢˜åˆ†æžä»¥ä¸Šçš„ç»“æžœå¯èƒ½æ˜¯æ­£æ•°ã€è´Ÿæ•°ã€é›¶ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º Java ä¸­å¯¹é™æ€å˜é‡çš„è‡ªå¢žï¼Œè‡ªå‡å¹¶ä¸æ˜¯åŽŸå­æ“ä½œã€‚ ä¾‹å¦‚å¯¹äºŽ i++ è€Œè¨€ï¼ˆi ä¸ºé™æ€å˜é‡ï¼‰ï¼Œå®žé™…ä¼šäº§ç”Ÿå¦‚ä¸‹çš„ JVM å­—èŠ‚ç æŒ‡ä»¤ 1234getstatic i // èŽ·å–é™æ€å˜é‡içš„å€¼iconst_1 // å‡†å¤‡å¸¸é‡1iadd // åŠ æ³•putstatic i // å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i è€Œå¯¹åº” iâ€“ ä¹Ÿæ˜¯ç±»ä¼¼ï¼š 1234getstatic i // èŽ·å–é™æ€å˜é‡içš„å€¼iconst_1 // å‡†å¤‡å¸¸é‡1isub // å‡æ³•putstatic i // å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡ è€ŒJavaçš„å†…å­˜æ¨¡åž‹å¦‚ä¸‹ï¼Œå®Œæˆé™æ€å˜é‡çš„è‡ªå¢žï¼Œè‡ªå‡éœ€è¦åœ¨ä¸»å­˜å’Œå·¥ä½œå†…å­˜ä¸­è¿›è¡Œæ•°æ®äº¤æ¢ ï¼š å¦‚æžœæ˜¯å•çº¿ç¨‹ä»¥ä¸Š 8 è¡Œä»£ç æ˜¯é¡ºåºæ‰§è¡Œï¼ˆä¸ä¼šäº¤é”™ï¼‰æ²¡æœ‰é—®é¢˜ï¼š 123456789// å‡è®¾içš„åˆå§‹å€¼ä¸º0getstatic i // çº¿ç¨‹1-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0iconst_1 // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1iadd // çº¿ç¨‹1-è‡ªå¢ž çº¿ç¨‹å†…i=1putstatic i // çº¿ç¨‹1-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1getstatic i // çº¿ç¨‹1-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=1iconst_1 // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1isub // çº¿ç¨‹1-è‡ªå‡ çº¿ç¨‹å†…i=0putstatic i // çº¿ç¨‹1-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=0 ä½†å¤šçº¿ç¨‹ä¸‹è¿™ 8 è¡Œä»£ç å¯èƒ½äº¤é”™è¿è¡Œï¼ˆä¸ºä»€ä¹ˆä¼šäº¤é”™ï¼Ÿæ€è€ƒä¸€ä¸‹ï¼‰ï¼š å‡ºçŽ°è´Ÿæ•°çš„æƒ…å†µï¼š 123456789// å‡è®¾içš„åˆå§‹å€¼ä¸º0getstatic i // çº¿ç¨‹1-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0getstatic i // çº¿ç¨‹2-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0iconst_1 // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1iadd // çº¿ç¨‹1-è‡ªå¢ž çº¿ç¨‹å†…i=1putstatic i // çº¿ç¨‹1-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1iconst_1 // çº¿ç¨‹2-å‡†å¤‡å¸¸é‡1isub // çº¿ç¨‹2-è‡ªå‡ çº¿ç¨‹å†…i=-1putstatic i // çº¿ç¨‹2-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=-1 å‡ºçŽ°æ­£æ•°çš„æƒ…å†µï¼š 123456789/ å‡è®¾içš„åˆå§‹å€¼ä¸º0getstatic i // çº¿ç¨‹1-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0getstatic i // çº¿ç¨‹2-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0iconst_1 // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1iadd // çº¿ç¨‹1-è‡ªå¢ž çº¿ç¨‹å†…i=1iconst_1 // çº¿ç¨‹2-å‡†å¤‡å¸¸é‡1isub // çº¿ç¨‹2-è‡ªå‡ çº¿ç¨‹å†…i=-1putstatic i // çº¿ç¨‹2-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=-1putstatic i // çº¿ç¨‹1-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1 3) è§£å†³æ–¹æ³•è¯­æ³• 123synchronized( å¯¹è±¡ ) &#123; //è¦ä½œä¸ºåŽŸå­æ“ä½œä»£ç &#125; ç”¨ synchronized è§£å†³å¹¶å‘é—®é¢˜ï¼š 1234567891011121314151617181920212223static int i = 0;static Object obj = new Object();public static void main(String[] args) throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 5000; j++) &#123; synchronized (obj) &#123; i++; &#125; &#125; &#125;); Thread t2 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 5000; j++) &#123; synchronized (obj) &#123; i--; &#125; &#125; &#125;); t1.start(); t2.start(); t1.join(); t2.join(); System.out.println(i);&#125; å¦‚ä½•ç†è§£å‘¢ï¼šä½ å¯ä»¥æŠŠ obj æƒ³è±¡æˆä¸€ä¸ªæˆ¿é—´ï¼Œçº¿ç¨‹ t1ï¼Œt2 æƒ³è±¡æˆä¸¤ä¸ªäººã€‚ å½“çº¿ç¨‹ t1 æ‰§è¡Œåˆ° synchronized(obj) æ—¶å°±å¥½æ¯” t1 è¿›å…¥äº†è¿™ä¸ªæˆ¿é—´ï¼Œå¹¶åæ‰‹é”ä½äº†é—¨ï¼Œåœ¨é—¨å†…æ‰§è¡Œcount++ ä»£ç ã€‚ è¿™æ—¶å€™å¦‚æžœ t2 ä¹Ÿè¿è¡Œåˆ°äº† synchronized(obj) æ—¶ï¼Œå®ƒå‘çŽ°é—¨è¢«é”ä½äº†ï¼Œåªèƒ½åœ¨é—¨å¤–ç­‰å¾…ã€‚ å½“ t1 æ‰§è¡Œå®Œ synchronized{} å—å†…çš„ä»£ç ï¼Œè¿™æ—¶å€™æ‰ä¼šè§£å¼€é—¨ä¸Šçš„é”ï¼Œä»Ž obj æˆ¿é—´å‡ºæ¥ã€‚t2 çº¿ç¨‹è¿™æ—¶æ‰å¯ä»¥è¿›å…¥ obj æˆ¿é—´ï¼Œåé”ä½é—¨ï¼Œæ‰§è¡Œå®ƒçš„ countâ€“ ä»£ç ã€‚ æ³¨æ„ï¼šä¸Šä¾‹ä¸­ t1 å’Œ t2 çº¿ç¨‹å¿…é¡»ç”¨ synchronized é”ä½åŒä¸€ä¸ª obj å¯¹è±¡ï¼Œå¦‚æžœ t1 é”ä½çš„æ˜¯ m1 å¯¹è±¡ï¼Œt2 é”ä½çš„æ˜¯ m2 å¯¹è±¡ï¼Œå°±å¥½æ¯”ä¸¤ä¸ªäººåˆ†åˆ«è¿›å…¥äº†ä¸¤ä¸ªä¸åŒçš„æˆ¿é—´ï¼Œæ²¡æ³•èµ·åˆ°åŒæ­¥çš„æ•ˆæžœã€‚ Javaå¹¶å‘ä¹‹çº¿ç¨‹å…«é”é“¾æŽ¥ï¼šhttps://blog.csdn.net/F15217283411/article/details/122752255?spm=1001.2014.3001.5501 2. å¯è§æ€§1) é€€ä¸å‡ºçš„å¾ªçŽ¯å…ˆæ¥çœ‹ä¸€ä¸ªçŽ°è±¡ï¼Œmain çº¿ç¨‹å¯¹ run å˜é‡çš„ä¿®æ”¹å¯¹äºŽ t çº¿ç¨‹ä¸å¯è§ï¼Œå¯¼è‡´äº† t çº¿ç¨‹æ— æ³•åœæ­¢ï¼š 12345678910111213141516171819package cn.itcast.jvm.t4.avo;public class Demo4_2 &#123; static boolean run = true; public static void main(String[] args) throws InterruptedException &#123; Thread t = new Thread(()-&gt;&#123; while(run)&#123; // .... //System.out.println(1); &#125; &#125;); t.start(); Thread.sleep(1000); run = false; // çº¿ç¨‹tä¸ä¼šå¦‚é¢„æƒ³çš„åœä¸‹æ¥ &#125;&#125; ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåˆ†æžä¸€ä¸‹ï¼š åˆå§‹çŠ¶æ€ï¼Œ t çº¿ç¨‹åˆšå¼€å§‹ä»Žä¸»å†…å­˜è¯»å–äº† run çš„å€¼åˆ°å·¥ä½œå†…å­˜ã€‚ å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»Žä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆçŽ‡ 1 ç§’ä¹‹åŽï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»Žè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œç»“æžœæ°¸è¿œæ˜¯æ—§å€¼ 2) è§£å†³æ–¹æ³•volatileï¼ˆæ˜“å˜å…³é”®å­—ï¼‰ å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»Žè‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­èŽ·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æŽ¥æ“ä½œä¸»å­˜ 3) å¯è§æ€§å‰é¢ä¾‹å­ä½“çŽ°çš„å®žé™…å°±æ˜¯å¯è§æ€§ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œ ä¸èƒ½ä¿è¯åŽŸå­æ€§ï¼Œä»…ç”¨åœ¨ä¸€ä¸ªå†™çº¿ç¨‹ï¼Œå¤šä¸ªè¯»çº¿ç¨‹çš„æƒ…å†µï¼š ä¸Šä¾‹ä»Žå­—èŠ‚ç ç†è§£æ˜¯è¿™æ ·çš„ï¼š 123456getstatic run // çº¿ç¨‹ t èŽ·å– run truegetstatic run // çº¿ç¨‹ t èŽ·å– run truegetstatic run // çº¿ç¨‹ t èŽ·å– run truegetstatic run // çº¿ç¨‹ t èŽ·å– run trueputstatic run // çº¿ç¨‹ main ä¿®æ”¹ run ä¸º falseï¼Œ ä»…æ­¤ä¸€æ¬¡getstatic run // çº¿ç¨‹ t èŽ·å– run false æ¯”è¾ƒä¸€ä¸‹ä¹‹å‰æˆ‘ä»¬å°†çº¿ç¨‹å®‰å…¨æ—¶ä¸¾çš„ä¾‹å­ï¼šä¸¤ä¸ªçº¿ç¨‹ä¸€ä¸ª i++ ä¸€ä¸ª iâ€“ ï¼Œåªèƒ½ä¿è¯çœ‹åˆ°æœ€æ–°å€¼ï¼Œä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™ 12345678getstatic i // çº¿ç¨‹1-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0getstatic i // çº¿ç¨‹2-èŽ·å–é™æ€å˜é‡içš„å€¼ çº¿ç¨‹å†…i=0iconst_1 // çº¿ç¨‹1-å‡†å¤‡å¸¸é‡1iadd // çº¿ç¨‹1-è‡ªå¢ž çº¿ç¨‹å†…i=1putstatic i // çº¿ç¨‹1-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=1iconst_1 // çº¿ç¨‹2-å‡†å¤‡å¸¸é‡1isub // çº¿ç¨‹2-è‡ªå‡ çº¿ç¨‹å†…i=-1putstatic i //çº¿ç¨‹2-å°†ä¿®æ”¹åŽçš„å€¼å­˜å…¥é™æ€å˜é‡i é™æ€å˜é‡i=-1 æ³¨æ„ï¼š synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„åŽŸå­æ€§ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„å¯è§æ€§ã€‚ä½†ç¼ºç‚¹æ˜¯synchronizedæ˜¯å±žäºŽé‡é‡çº§æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½Ž å¦‚æžœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªçŽ¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘çŽ°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ°å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ 3. æœ‰åºæ€§1) è¯¡å¼‚çš„ç»“æžœ1234567891011121314151617int num = 0;boolean ready = false;// çº¿ç¨‹1 æ‰§è¡Œæ­¤æ–¹æ³•public void actor1(I_Result r) &#123; if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125;&#125; // çº¿ç¨‹2 æ‰§è¡Œæ­¤æ–¹æ³•public void actor2(I_Result r) &#123; num = 2; ready = true;&#125; I_Result æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªå±žæ€§ r1 ç”¨æ¥ä¿å­˜ç»“æžœï¼Œé—®ï¼Œå¯èƒ½çš„ç»“æžœæœ‰å‡ ç§ï¼Ÿ æœ‰åŒå­¦è¿™ä¹ˆåˆ†æž æƒ…å†µ1ï¼šçº¿ç¨‹1 å…ˆæ‰§è¡Œï¼Œè¿™æ—¶ ready = falseï¼Œæ‰€ä»¥è¿›å…¥ else åˆ†æ”¯ç»“æžœä¸º 1æƒ…å†µ2ï¼šçº¿ç¨‹2 å…ˆæ‰§è¡Œ num = 2ï¼Œä½†æ²¡æ¥å¾—åŠæ‰§è¡Œ ready = trueï¼Œçº¿ç¨‹1 æ‰§è¡Œï¼Œè¿˜æ˜¯è¿›å…¥ else åˆ†æ”¯ï¼Œç»“æžœä¸º1æƒ…å†µ3ï¼šçº¿ç¨‹2 æ‰§è¡Œåˆ° ready = trueï¼Œçº¿ç¨‹1 æ‰§è¡Œï¼Œè¿™å›žè¿›å…¥ if åˆ†æ”¯ï¼Œç»“æžœä¸º 4ï¼ˆå› ä¸º num å·²ç»æ‰§è¡Œè¿‡äº†ï¼‰ ä½†æˆ‘å‘Šè¯‰ä½ ï¼Œç»“æžœè¿˜æœ‰å¯èƒ½æ˜¯ 0 ï¼Œä¿¡ä¸ä¿¡å§ï¼ ç›¸ä¿¡å¾ˆå¤šäººå·²ç»æ™•äº† è¿™ç§çŽ°è±¡å«åšæŒ‡ä»¤é‡æŽ’ï¼Œæ˜¯ JIT ç¼–è¯‘å™¨åœ¨è¿è¡Œæ—¶çš„ä¸€äº›ä¼˜åŒ–ï¼Œè¿™ä¸ªçŽ°è±¡éœ€è¦é€šè¿‡å¤§é‡æµ‹è¯•æ‰èƒ½å¤çŽ°ï¼š å€ŸåŠ© java å¹¶å‘åŽ‹æµ‹å·¥å…· jcstressï¼šhttps://hg.openjdk.java.net/code-tools/jcstress/ åˆ›å»º maven é¡¹ç›®ï¼Œæä¾›å¦‚ä¸‹æµ‹è¯•ç±» 1234567891011121314151617181920212223242526272829package test;import org.openjdk.jcstress.annotations.*;import org.openjdk.jcstress.infra.results.I_Result;//@JCStressTest@Outcome(id = &#123;&quot;1&quot;, &quot;4&quot;&#125;, expect = Expect.ACCEPTABLE, desc = &quot;ok&quot;)@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;!!!!&quot;)@Statepublic class ConcurrencyTest &#123; int num = 0; volatile boolean ready = false; @Actor public void actor1(I_Result r) &#123; if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125; &#125; @Actor public void actor2(I_Result r) &#123; num = 2; ready = true; &#125;&#125; æ‰§è¡Œ 12mvn clean installjava -jar target/jcstress.jar ä¼šè¾“å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„ç»“æžœï¼Œæ‘˜å½•å…¶ä¸­ä¸€æ¬¡ç»“æžœï¼š 12345678910111213141516*** INTERESTING tests Some interesting behaviors observed. This is for the plain curiosity. 2 matching test results. [OK] test.ConcurrencyTest (JVM args: [-XX:-TieredCompilation]) Observed state Occurrences Expectation Interpretation 0 1,729 ACCEPTABLE_INTERESTING !!!! 1 42,617,915 ACCEPTABLE ok 4 5,146,627 ACCEPTABLE ok [OK] test.ConcurrencyTest (JVM args: []) Observed state Occurrences Expectation Interpretation 0 1,652 ACCEPTABLE_INTERESTING !!!! 0 46,460,657 ACCEPTABLE !!!! 0 4,571,072 ACCEPTABLE !!!! å¯ä»¥çœ‹åˆ°ï¼Œå‡ºçŽ°ç»“æžœä¸º 0 çš„æƒ…å†µæœ‰ 638 æ¬¡ï¼Œè™½ç„¶æ¬¡æ•°ç›¸å¯¹å¾ˆå°‘ï¼Œä½†æ¯•ç«Ÿæ˜¯å‡ºçŽ°äº†ã€‚ 2) è§£å†³æ–¹æ³•volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æŽ’ 1234567891011121314151617181920212223242526272829package test;import org.openjdk.jcstress.annotations.*;import org.openjdk.jcstress.infra.results.I_Result;//@JCStressTest@Outcome(id = &#123;&quot;1&quot;, &quot;4&quot;&#125;, expect = Expect.ACCEPTABLE, desc = &quot;ok&quot;)@Outcome(id = &quot;0&quot;, expect = Expect.ACCEPTABLE_INTERESTING, desc = &quot;!!!!&quot;)@Statepublic class ConcurrencyTest &#123; int num = 0; boolean ready = false; @Actor public void actor1(I_Result r) &#123; if(ready) &#123; r.r1 = num + num; &#125; else &#123; r.r1 = 1; &#125; &#125; @Actor public void actor2(I_Result r) &#123; num = 2; ready = true; &#125;&#125; ç»“æžœä¸ºï¼š 123*** INTERESTING testsSome interesting behaviors observed. This is for the plain curiosity.0 matching test results. 3) æœ‰åºæ€§ç†è§£JVM ä¼šåœ¨ä¸å½±å“æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¯ä»¥è°ƒæ•´è¯­å¥çš„æ‰§è¡Œé¡ºåºï¼Œæ€è€ƒä¸‹é¢ä¸€æ®µä»£ç  123456static int i;static int j;// åœ¨æŸä¸ªçº¿ç¨‹å†…æ‰§è¡Œå¦‚ä¸‹èµ‹å€¼æ“ä½œi = ...; // è¾ƒä¸ºè€—æ—¶çš„æ“ä½œj = ...; å¯ä»¥çœ‹åˆ°ï¼Œè‡³äºŽæ˜¯å…ˆæ‰§è¡Œ i è¿˜æ˜¯ å…ˆæ‰§è¡Œ j ï¼Œå¯¹æœ€ç»ˆçš„ç»“æžœä¸ä¼šäº§ç”Ÿå½±å“ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä»£ç çœŸæ­£æ‰§è¡Œæ—¶ï¼Œæ—¢å¯ä»¥æ˜¯ 12i = ...; // è¾ƒä¸ºè€—æ—¶çš„æ“ä½œj = ... ä¹Ÿå¯ä»¥æ˜¯ 12j = ...;i = ...; // è¾ƒä¸ºè€—æ—¶çš„æ“ä½œ è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€ŽæŒ‡ä»¤é‡æŽ’ã€ï¼Œå¤šçº¿ç¨‹ä¸‹ã€ŽæŒ‡ä»¤é‡æŽ’ã€ä¼šå½±å“æ­£ç¡®æ€§ï¼Œä¾‹å¦‚è‘—åçš„ double-checked locking æ¨¡å¼å®žçŽ°å•ä¾‹ 12345678910111213141516public final class Singleton &#123; private Singleton() &#123; &#125; private static Singleton INSTANCE = null; public static Singleton getInstance() &#123; // å®žä¾‹æ²¡åˆ›å»ºï¼Œæ‰ä¼šè¿›å…¥å†…éƒ¨çš„ synchronizedä»£ç å— if (INSTANCE == null) &#123; synchronized (Singleton.class) &#123; // ä¹Ÿè®¸æœ‰å…¶å®ƒçº¿ç¨‹å·²ç»åˆ›å»ºå®žä¾‹ï¼Œæ‰€ä»¥å†åˆ¤æ–­ä¸€æ¬¡ if (INSTANCE == null) &#123; INSTANCE = new Singleton(); &#125; &#125; &#125; return INSTANCE; &#125;&#125; ä»¥ä¸Šçš„å®žçŽ°ç‰¹ç‚¹æ˜¯ï¼š æ‡’æƒ°å®žä¾‹åŒ– é¦–æ¬¡ä½¿ç”¨ getInstance() æ‰ä½¿ç”¨ synchronized åŠ é”ï¼ŒåŽç»­ä½¿ç”¨æ—¶æ— éœ€åŠ é” ä½†åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ï¼Œä¸Šé¢çš„ä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼Œ INSTANCE = new Singleton() å¯¹åº”çš„å­—èŠ‚ç ä¸ºï¼š 123450: new #2 // class cn/itcast/jvm/t4/Singleton3: dup4: invokespecial #3 // Method &quot;&lt;init&gt;&quot;:()V7: putstatic #4 // FieldINSTANCE:Lcn/itcast/jvm/t4/Singleton; å…¶ä¸­ 4 7 ä¸¤æ­¥çš„é¡ºåºä¸æ˜¯å›ºå®šçš„ï¼Œä¹Ÿè®¸ jvm ä¼šä¼˜åŒ–ä¸ºï¼šå…ˆå°†å¼•ç”¨åœ°å€èµ‹å€¼ç»™ INSTANCE å˜é‡åŽï¼Œå†æ‰§è¡Œæž„é€ æ–¹æ³•ï¼Œå¦‚æžœä¸¤ä¸ªçº¿ç¨‹ t1ï¼Œt2 æŒ‰å¦‚ä¸‹æ—¶é—´åºåˆ—æ‰§è¡Œï¼š 123456æ—¶é—´1 t1 çº¿ç¨‹æ‰§è¡Œåˆ° INSTANCE = new Singleton();æ—¶é—´2 t1 çº¿ç¨‹åˆ†é…ç©ºé—´ï¼Œä¸ºSingletonå¯¹è±¡ç”Ÿæˆäº†å¼•ç”¨åœ°å€ï¼ˆ0 å¤„ï¼‰æ—¶é—´3 t1 çº¿ç¨‹å°†å¼•ç”¨åœ°å€èµ‹å€¼ç»™ INSTANCEï¼Œè¿™æ—¶ INSTANCE != nullï¼ˆ7 å¤„ï¼‰æ—¶é—´4 t2 çº¿ç¨‹è¿›å…¥getInstance() æ–¹æ³•ï¼Œå‘çŽ° INSTANCE != nullï¼ˆsynchronizedå—å¤–ï¼‰ï¼Œç›´æŽ¥è¿”å›ž INSTANCEæ—¶é—´5 t1 çº¿ç¨‹æ‰§è¡ŒSingletonçš„æž„é€ æ–¹æ³•ï¼ˆ4 å¤„ï¼‰ è¿™æ—¶ t1 è¿˜æœªå®Œå…¨å°†æž„é€ æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå¦‚æžœåœ¨æž„é€ æ–¹æ³•ä¸­è¦æ‰§è¡Œå¾ˆå¤šåˆå§‹åŒ–æ“ä½œï¼Œé‚£ä¹ˆ t2 æ‹¿åˆ°çš„æ˜¯å°†æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–å®Œæ¯•çš„å•ä¾‹ å¯¹ INSTANCE ä½¿ç”¨ volatile ä¿®é¥°å³å¯ï¼Œå¯ä»¥ç¦ç”¨æŒ‡ä»¤é‡æŽ’ï¼Œä½†è¦æ³¨æ„åœ¨ JDK 5 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„ volatile æ‰ä¼šçœŸæ­£æœ‰æ•ˆ 4) happens-beforehappens-before è§„å®šäº†å“ªäº›å†™æ“ä½œå¯¹å…¶å®ƒçº¿ç¨‹çš„è¯»æ“ä½œå¯è§ï¼Œå®ƒæ˜¯å¯è§æ€§ä¸Žæœ‰åºæ€§çš„ä¸€å¥—è§„åˆ™æ€»ç»“ï¼ŒæŠ›å¼€ä»¥ä¸‹ happens-before è§„åˆ™ï¼ŒJMM å¹¶ä¸èƒ½ä¿è¯ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™ï¼Œå¯¹äºŽå…¶å®ƒçº¿ç¨‹å¯¹è¯¥å…±äº«å˜é‡çš„è¯»å¯è§ çº¿ç¨‹è§£é” m ä¹‹å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºŽæŽ¥ä¸‹æ¥å¯¹ m åŠ é”çš„å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ 1234567891011121314static int x;static Object m = new Object();new Thread(()-&gt;&#123; synchronized(m) &#123; x = 10; &#125;&#125;,&quot;t1&quot;).start();new Thread(()-&gt;&#123; synchronized(m) &#123; System.out.println(x); &#125;&#125;,&quot;t2&quot;).start(); çº¿ç¨‹å¯¹ volatile å˜é‡çš„å†™ï¼Œå¯¹æŽ¥ä¸‹æ¥å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ 123456789volatile static int x;new Thread(()-&gt;&#123; x = 10;&#125;,&quot;t1&quot;).start();new Thread(()-&gt;&#123; System.out.println(x);&#125;,&quot;t2&quot;).start(); çº¿ç¨‹ start å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹è¯¥çº¿ç¨‹å¼€å§‹åŽå¯¹è¯¥å˜é‡çš„è¯»å¯è§ 1234567static int x;x = 10;new Thread(()-&gt;&#123; System.out.println(x);&#125;,&quot;t2&quot;).start(); çº¿ç¨‹ç»“æŸå‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¾—çŸ¥å®ƒç»“æŸåŽçš„è¯»å¯è§ï¼ˆæ¯”å¦‚å…¶å®ƒçº¿ç¨‹è°ƒç”¨ t1.isAlive() æˆ–t1.join()ç­‰å¾…å®ƒç»“æŸï¼‰ 12345678static int x;Thread t1 = new Thread(()-&gt;&#123; x = 10;&#125;,&quot;t1&quot;);t1.start();t1.join();System.out.println(x); çº¿ç¨‹ t1 æ‰“æ–­ t2ï¼ˆinterruptï¼‰å‰å¯¹å˜é‡çš„å†™ï¼Œå¯¹äºŽå…¶ä»–çº¿ç¨‹å¾—çŸ¥ t2 è¢«æ‰“æ–­åŽå¯¹å˜é‡çš„è¯»å¯è§ï¼ˆé€šè¿‡t2.interrupted æˆ– t2.isInterruptedï¼‰ 12345678910111213141516171819202122232425static int x;public static void main(String[] args) &#123; Thread t2 = new Thread(()-&gt;&#123; while(true) &#123; if(Thread.currentThread().isInterrupted()) &#123; System.out.println(x); break; &#125; &#125; &#125;,&quot;t2&quot;); t2.start(); new Thread(()-&gt;&#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; x = 10; t2.interrupt(); &#125;,&quot;t1&quot;).start(); while(!t2.isInterrupted()) &#123; Thread.yield(); &#125; System.out.println(x);&#125; å¯¹å˜é‡é»˜è®¤å€¼ï¼ˆ0ï¼Œfalseï¼Œnullï¼‰çš„å†™ï¼Œå¯¹å…¶å®ƒçº¿ç¨‹å¯¹è¯¥å˜é‡çš„è¯»å¯è§ å…·æœ‰ä¼ é€’æ€§ï¼Œå¦‚æžœ x hb-&gt; y å¹¶ä¸” y hb-&gt; z é‚£ä¹ˆæœ‰ x hb-&gt; z å˜é‡éƒ½æ˜¯æŒ‡æˆå‘˜å˜é‡æˆ–é™æ€æˆå‘˜å˜é‡ 4. CAS ä¸Ž åŽŸå­ç±»CASCAS å³ Compare and Swap ï¼Œå®ƒä½“çŽ°çš„ä¸€ç§ä¹è§‚é”çš„æ€æƒ³ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹è¦å¯¹ä¸€ä¸ªå…±äº«çš„æ•´åž‹å˜é‡æ‰§è¡Œ +1 æ“ä½œï¼š 1234567891011121314// éœ€è¦ä¸æ–­å°è¯•while(true) &#123; int æ—§å€¼ = å…±äº«å˜é‡ ; // æ¯”å¦‚æ‹¿åˆ°äº†å½“å‰å€¼ 0 int ç»“æžœ = æ—§å€¼ + 1; // åœ¨æ—§å€¼ 0 çš„åŸºç¡€ä¸Šå¢žåŠ  1 ï¼Œæ­£ç¡®ç»“æžœæ˜¯ 1 /* è¿™æ—¶å€™å¦‚æžœåˆ«çš„çº¿ç¨‹æŠŠå…±äº«å˜é‡æ”¹æˆäº† 5ï¼Œæœ¬çº¿ç¨‹çš„æ­£ç¡®ç»“æžœ 1 å°±ä½œåºŸäº†ï¼Œè¿™æ—¶å€™ compareAndSwap è¿”å›ž falseï¼Œé‡æ–°å°è¯•ï¼Œç›´åˆ°ï¼š compareAndSwap è¿”å›ž trueï¼Œè¡¨ç¤ºæˆ‘æœ¬çº¿ç¨‹åšä¿®æ”¹çš„åŒæ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ²¡æœ‰å¹²æ‰° */ if( compareAndSwap ( æ—§å€¼, ç»“æžœ )) &#123; // æˆåŠŸï¼Œé€€å‡ºå¾ªçŽ¯ &#125;&#125; èŽ·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„å¯è§æ€§ï¼Œéœ€è¦ä½¿ç”¨ volatile ä¿®é¥°ã€‚ç»“åˆ CAS å’Œ volatile å¯ä»¥å®žçŽ°æ— é”å¹¶å‘ï¼Œé€‚ç”¨äºŽç«žäº‰ä¸æ¿€çƒˆã€å¤šæ ¸ CPU çš„åœºæ™¯ä¸‹ã€‚ å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡žï¼Œè¿™æ˜¯æ•ˆçŽ‡æå‡çš„å› ç´ ä¹‹ä¸€ ä½†å¦‚æžœç«žäº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆçŽ‡ä¼šå—å½±å“ CAS åº•å±‚ä¾èµ–äºŽä¸€ä¸ª Unsafe ç±»æ¥ç›´æŽ¥è°ƒç”¨æ“ä½œç³»ç»Ÿåº•å±‚çš„ CAS æŒ‡ä»¤ï¼Œä¸‹é¢æ˜¯ç›´æŽ¥ä½¿ç”¨ Unsafe å¯¹è±¡è¿›è¡Œçº¿ç¨‹å®‰å…¨ä¿æŠ¤çš„ä¸€ä¸ªä¾‹å­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960import sun.misc.Unsafe;import java.lang.reflect.Field;public class TestCAS &#123; public static void main(String[] args) throws InterruptedException &#123; DataContainer dc = new DataContainer(); int count = 5; Thread t1 = new Thread(() -&gt; &#123; for (int i = 0; i &lt; count; i++) &#123; dc.increase(); &#125; &#125;); t1.start(); t1.join(); System.out.println(dc.getData()); &#125;&#125;class DataContainer &#123; private volatile int data; static final Unsafe unsafe; static final long DATA_OFFSET; static &#123; try &#123; // Unsafe å¯¹è±¡ä¸èƒ½ç›´æŽ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡åå°„èŽ·å¾— Field theUnsafe = Unsafe.class.getDeclaredField(&quot;theUnsafe&quot;); theUnsafe.setAccessible(true); unsafe = (Unsafe) theUnsafe.get(null); &#125; catch (NoSuchFieldException | IllegalAccessException e) &#123; throw new Error(e); &#125; try &#123; // data å±žæ€§åœ¨ DataContainer å¯¹è±¡ä¸­çš„åç§»é‡ï¼Œç”¨äºŽ Unsafe ç›´æŽ¥è®¿é—®è¯¥å±žæ€§ DATA_OFFSET = unsafe.objectFieldOffset(DataContainer.class.getDeclaredField(&quot;data&quot;)); &#125; catch (NoSuchFieldException e) &#123; throw new Error(e); &#125; &#125; public void increase() &#123; int oldValue; while(true) &#123; // èŽ·å–å…±äº«å˜é‡æ—§å€¼ï¼Œå¯ä»¥åœ¨è¿™ä¸€è¡ŒåŠ å…¥æ–­ç‚¹ï¼Œä¿®æ”¹ data è°ƒè¯•æ¥åŠ æ·±ç†è§£ oldValue = data; // cas å°è¯•ä¿®æ”¹ data ä¸º æ—§å€¼ + 1ï¼Œå¦‚æžœæœŸé—´æ—§å€¼è¢«åˆ«çš„çº¿ç¨‹æ”¹äº†ï¼Œè¿”å›ž false if (unsafe.compareAndSwapInt(this, DATA_OFFSET, oldValue, oldValue + 1)) &#123; return; &#125; &#125; &#125; public void decrease() &#123; int oldValue; while(true) &#123; oldValue = data; if (unsafe.compareAndSwapInt(this, DATA_OFFSET, oldValue, oldValue - 1)) &#123; return; &#125; &#125; &#125; synchronized public int getData() &#123; return data; &#125;&#125; ä¹è§‚é”ä¸Žæ‚²è§‚é” CAS æ˜¯åŸºäºŽä¹è§‚é”çš„æ€æƒ³ï¼šæœ€ä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚ synchronized æ˜¯åŸºäºŽæ‚²è§‚é”çš„æ€æƒ³ï¼šæœ€æ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚ åŽŸå­æ“ä½œç±»jucï¼ˆjava.util.concurrentï¼‰ä¸­æä¾›äº†åŽŸå­æ“ä½œç±»ï¼Œå¯ä»¥æä¾›çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œä¾‹å¦‚ï¼šAtomicIntegerã€AtomicBooleanç­‰ï¼Œå®ƒä»¬åº•å±‚å°±æ˜¯é‡‡ç”¨ CAS æŠ€æœ¯ + volatile æ¥å®žçŽ°çš„ã€‚ å¯ä»¥ä½¿ç”¨ AtomicInteger æ”¹å†™ä¹‹å‰çš„ä¾‹å­ï¼š 1234567891011121314151617181920// åˆ›å»ºåŽŸå­æ•´æ•°å¯¹è±¡private static AtomicInteger i = new AtomicInteger(0);public static void main(String[] args) throws InterruptedException &#123; Thread t1 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 5000; j++) &#123; i.getAndIncrement(); // èŽ·å–å¹¶ä¸”è‡ªå¢ž i++ // i.incrementAndGet(); // è‡ªå¢žå¹¶ä¸”èŽ·å– ++i &#125; &#125;); Thread t2 = new Thread(() -&gt; &#123; for (int j = 0; j &lt; 5000; j++) &#123; i.getAndDecrement(); // èŽ·å–å¹¶ä¸”è‡ªå‡ i-- &#125; &#125;); t1.start(); t2.start(); t1.join(); t2.join(); System.out.println(i);&#125; 5. synchronized ä¼˜åŒ–Java HotSpot è™šæ‹Ÿæœºä¸­ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰å¯¹è±¡å¤´ï¼ˆåŒ…æ‹¬ class æŒ‡é’ˆå’Œ Mark Wordï¼‰ã€‚Mark Word å¹³æ—¶å­˜å‚¨è¿™ä¸ªå¯¹è±¡çš„ å“ˆå¸Œç  ã€ åˆ†ä»£å¹´é¾„ ï¼Œå½“åŠ é”æ—¶ï¼Œè¿™äº›ä¿¡æ¯å°±æ ¹æ®æƒ…å†µè¢«æ›¿æ¢ä¸º æ ‡è®°ä½ ã€ çº¿ç¨‹é”è®°å½•æŒ‡é’ˆ ã€ é‡é‡çº§é”æŒ‡é’ˆ ã€ çº¿ç¨‹ID ç­‰å†…å®¹ è½»é‡çº§é”å¦‚æžœä¸€ä¸ªå¯¹è±¡è™½ç„¶æœ‰å¤šçº¿ç¨‹è®¿é—®ï¼Œä½†å¤šçº¿ç¨‹è®¿é—®çš„æ—¶é—´æ˜¯é”™å¼€çš„ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰ç«žäº‰ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨è½»é‡çº§é”æ¥ä¼˜åŒ–ã€‚è¿™å°±å¥½æ¯”ï¼š å­¦ç”Ÿï¼ˆçº¿ç¨‹ Aï¼‰ç”¨è¯¾æœ¬å åº§ï¼Œä¸Šäº†åŠèŠ‚è¯¾ï¼Œå‡ºé—¨äº†ï¼ˆCPUæ—¶é—´åˆ°ï¼‰ï¼Œå›žæ¥ä¸€çœ‹ï¼Œå‘çŽ°è¯¾æœ¬æ²¡å˜ï¼Œè¯´æ˜Žæ²¡æœ‰ç«žäº‰ï¼Œç»§ç»­ä¸Šä»–çš„è¯¾ã€‚ å¦‚æžœè¿™æœŸé—´æœ‰å…¶å®ƒå­¦ç”Ÿï¼ˆçº¿ç¨‹ Bï¼‰æ¥äº†ï¼Œä¼šå‘ŠçŸ¥ï¼ˆçº¿ç¨‹Aï¼‰æœ‰å¹¶å‘è®¿é—®ï¼Œçº¿ç¨‹A éšå³å‡çº§ä¸ºé‡é‡çº§é”ï¼Œè¿›å…¥é‡é‡çº§é”çš„æµç¨‹ã€‚ è€Œé‡é‡çº§é”å°±ä¸æ˜¯é‚£ä¹ˆç”¨è¯¾æœ¬å åº§é‚£ä¹ˆç®€å•äº†ï¼Œå¯ä»¥æƒ³è±¡çº¿ç¨‹ A èµ°ä¹‹å‰ï¼ŒæŠŠåº§ä½ç”¨ä¸€ä¸ªé“æ …æ å›´èµ·æ¥å‡è®¾æœ‰ä¸¤ä¸ªæ–¹æ³•åŒæ­¥å—ï¼Œåˆ©ç”¨åŒä¸€ä¸ªå¯¹è±¡åŠ é” 123456789101112static Object obj = new Object();public static void method1() &#123; synchronized( obj ) &#123; // åŒæ­¥å— A method2(); &#125;&#125; public static void method2() &#123; synchronized( obj ) &#123; // åŒæ­¥å— B &#125;&#125; æ¯ä¸ªçº¿ç¨‹éƒ½çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•çš„ç»“æž„ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„ Mark Word çº¿ç¨‹ 1 å¯¹è±¡ Mark Word çº¿ç¨‹ 2 è®¿é—®åŒæ­¥å— Aï¼ŒæŠŠ Mark å¤åˆ¶åˆ° çº¿ç¨‹ 1 çš„é”è®°å½• 01ï¼ˆæ— é”ï¼‰ - CAS ä¿®æ”¹ Mark ä¸ºçº¿ç¨‹ 1 é”è®°å½• åœ°å€ 01ï¼ˆæ— é”ï¼‰ - æˆåŠŸï¼ˆåŠ é”ï¼‰ 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - æ‰§è¡ŒåŒæ­¥å— A 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - è®¿é—®åŒæ­¥å— Bï¼ŒæŠŠ Mark å¤åˆ¶åˆ° çº¿ç¨‹ 1 çš„é”è®°å½• 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - CAS ä¿®æ”¹ Mark ä¸ºçº¿ç¨‹ 1 é”è®°å½• åœ°å€ 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - å¤±è´¥ï¼ˆå‘çŽ°æ˜¯è‡ªå·±çš„é”ï¼‰ 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - é”é‡å…¥ 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - æ‰§è¡ŒåŒæ­¥å— B 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - åŒæ­¥å— B æ‰§è¡Œå®Œæ¯• 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - åŒæ­¥å— A æ‰§è¡Œå®Œæ¯• 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é”è®°å½•åœ°å€ - æˆåŠŸï¼ˆè§£é”ï¼‰ 01ï¼ˆæ— é”ï¼‰ - - 01ï¼ˆæ— é”ï¼‰ è®¿é—®åŒæ­¥å— Aï¼ŒæŠŠ Mark å¤åˆ¶åˆ° çº¿ç¨‹ 2 çš„é”è®°å½• - 01ï¼ˆæ— é”ï¼‰ CAS ä¿®æ”¹ Mark ä¸ºçº¿ç¨‹ 2 é”è®°å½• åœ°å€ - 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 2 é”è®°å½•åœ°å€ æˆåŠŸï¼ˆåŠ é”ï¼‰ - â€¦ â€¦ é”è†¨èƒ€å¦‚æžœåœ¨å°è¯•åŠ è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­ï¼ŒCAS æ“ä½œæ— æ³•æˆåŠŸï¼Œè¿™æ—¶ä¸€ç§æƒ…å†µå°±æ˜¯æœ‰å…¶å®ƒçº¿ç¨‹ä¸ºæ­¤å¯¹è±¡åŠ ä¸Šäº†è½»é‡çº§é”ï¼ˆæœ‰ç«žäº‰ï¼‰ï¼Œè¿™æ—¶éœ€è¦è¿›è¡Œé”è†¨èƒ€ï¼Œå°†è½»é‡çº§é”å˜ä¸ºé‡é‡çº§é”ã€‚ 123456static Object obj = new Object();public static void method1() &#123; synchronized( obj ) &#123; // åŒæ­¥å— &#125;&#125; çº¿ç¨‹ 1 å¯¹è±¡ Mark çº¿ç¨‹ 2 è®¿é—®åŒæ­¥å—ï¼ŒæŠŠ Mark å¤åˆ¶åˆ°çº¿ç¨‹ 1 çš„é”è®°å½• 01ï¼ˆæ— é”ï¼‰ - CAS ä¿®æ”¹ Mark ä¸ºçº¿ç¨‹ 1 é”è®°å½•åœ° å€ 01ï¼ˆæ— é”ï¼‰ - æˆåŠŸï¼ˆåŠ é”ï¼‰ 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é” è®°å½•åœ°å€ - æ‰§è¡ŒåŒæ­¥å— 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é” è®°å½•åœ°å€ - æ‰§è¡ŒåŒæ­¥å— 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é” è®°å½•åœ°å€ è®¿é—®åŒæ­¥å—ï¼ŒæŠŠ Mark å¤åˆ¶ åˆ°çº¿ç¨‹ 2 æ‰§è¡ŒåŒæ­¥å— 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é” è®°å½•åœ°å€ CAS ä¿®æ”¹ Mark ä¸ºçº¿ç¨‹ 2 é” è®°å½•åœ°å€ æ‰§è¡ŒåŒæ­¥å— 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é” è®°å½•åœ°å€ å¤±è´¥ï¼ˆå‘çŽ°åˆ«äººå·²ç»å äº† é”ï¼‰ æ‰§è¡ŒåŒæ­¥å— 00ï¼ˆè½»é‡é”ï¼‰çº¿ç¨‹ 1 é” è®°å½•åœ°å€ CAS ä¿®æ”¹ Mark ä¸ºé‡é‡é” æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡ é’ˆ é˜»å¡žä¸­ æ‰§è¡Œå®Œæ¯• 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡ é’ˆ é˜»å¡žä¸­ å¤±è´¥ï¼ˆè§£é”ï¼‰ 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡ é’ˆ é˜»å¡žä¸­ é‡Šæ”¾é‡é‡é”ï¼Œå”¤èµ·é˜»å¡žçº¿ç¨‹ç«žäº‰ 01ï¼ˆæ— é”ï¼‰ é˜»å¡žä¸­ - 10ï¼ˆé‡é‡é”ï¼‰ ç«žäº‰é‡é‡é” - 10ï¼ˆé‡é‡é”ï¼‰ æˆåŠŸï¼ˆåŠ é”ï¼‰ - â€¦ â€¦ é‡é‡çº§é”é‡é‡çº§é”ç«žäº‰çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªæ—‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹è‡ªæ—‹æˆåŠŸï¼ˆå³è¿™æ—¶å€™æŒé”çº¿ç¨‹å·²ç»é€€å‡ºäº†åŒæ­¥å—ï¼Œé‡Šæ”¾äº†é”ï¼‰ï¼Œè¿™æ—¶å½“å‰çº¿ç¨‹å°±å¯ä»¥é¿å…é˜»å¡žã€‚ åœ¨ Java 6 ä¹‹åŽè‡ªæ—‹é”æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚å¯¹è±¡åˆšåˆšçš„ä¸€æ¬¡è‡ªæ—‹æ“ä½œæˆåŠŸè¿‡ï¼Œé‚£ä¹ˆè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹æˆåŠŸçš„å¯èƒ½æ€§ä¼šé«˜ï¼Œå°±å¤šè‡ªæ—‹å‡ æ¬¡ï¼›åä¹‹ï¼Œå°±å°‘è‡ªæ—‹ç”šè‡³ä¸è‡ªæ—‹ï¼Œæ€»ä¹‹ï¼Œæ¯”è¾ƒæ™ºèƒ½ã€‚ è‡ªæ—‹ä¼šå ç”¨ CPU æ—¶é—´ï¼Œå•æ ¸ CPU è‡ªæ—‹å°±æ˜¯æµªè´¹ï¼Œå¤šæ ¸ CPU è‡ªæ—‹æ‰èƒ½å‘æŒ¥ä¼˜åŠ¿ã€‚ å¥½æ¯”ç­‰çº¢ç¯æ—¶æ±½è½¦æ˜¯ä¸æ˜¯ç†„ç«ï¼Œä¸ç†„ç«ç›¸å½“äºŽè‡ªæ—‹ï¼ˆç­‰å¾…æ—¶é—´çŸ­äº†åˆ’ç®—ï¼‰ï¼Œç†„ç«äº†ç›¸å½“äºŽé˜»å¡žï¼ˆç­‰å¾…æ—¶é—´é•¿äº†åˆ’ç®—ï¼‰ Java 7 ä¹‹åŽä¸èƒ½æŽ§åˆ¶æ˜¯å¦å¼€å¯è‡ªæ—‹åŠŸèƒ½ è‡ªæ—‹é‡è¯•æˆåŠŸçš„æƒ…å†µ çº¿ç¨‹ 1 ï¼ˆcpu 1 ä¸Šï¼‰ å¯¹è±¡ Mark çº¿ç¨‹ 2 ï¼ˆcpu 2 ä¸Šï¼‰ - 10ï¼ˆé‡é‡é”ï¼‰ - è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æˆåŠŸï¼ˆåŠ é”ï¼‰ 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡Œå®Œæ¯• 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æˆåŠŸï¼ˆè§£é”ï¼‰ 01ï¼ˆæ— é”ï¼‰ è‡ªæ—‹é‡è¯• - 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ æˆåŠŸï¼ˆåŠ é”ï¼‰ - 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ æ‰§è¡ŒåŒæ­¥å— - â€¦ â€¦ è‡ªæ—‹é‡è¯•å¤±è´¥çš„æƒ…å†µ çº¿ç¨‹ 1ï¼ˆcpu 1 ä¸Šï¼‰ å¯¹è±¡ Mark çº¿ç¨‹ 2ï¼ˆcpu 2 ä¸Šï¼‰ - 10ï¼ˆé‡é‡é”ï¼‰ - è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æˆåŠŸï¼ˆåŠ é”ï¼‰ 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ - æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è®¿é—®åŒæ­¥å—ï¼ŒèŽ·å– monitor æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ è‡ªæ—‹é‡è¯• æ‰§è¡ŒåŒæ­¥å— 10ï¼ˆé‡é‡é”ï¼‰é‡é‡é”æŒ‡é’ˆ é˜»å¡ž - â€¦ â€¦ åå‘é”é‡çº§é”åœ¨æ²¡æœ‰ç«žäº‰æ—¶ï¼ˆå°±è‡ªå·±è¿™ä¸ªçº¿ç¨‹ï¼‰ï¼Œæ¯æ¬¡é‡å…¥ä»ç„¶éœ€è¦æ‰§è¡Œ CAS æ“ä½œã€‚Java 6 ä¸­å¼•å…¥äº†åå‘é”æ¥åšè¿›ä¸€æ­¥ä¼˜åŒ–ï¼šåªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨ CAS å°†çº¿ç¨‹ ID è®¾ç½®åˆ°å¯¹è±¡çš„ Mark Word å¤´ï¼Œä¹‹åŽå‘çŽ°è¿™ä¸ªçº¿ç¨‹ IDæ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«žäº‰ï¼Œä¸ç”¨é‡æ–° CAS. æ’¤é”€åå‘éœ€è¦å°†æŒé”çº¿ç¨‹å‡çº§ä¸ºè½»é‡çº§é”ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹éœ€è¦æš‚åœï¼ˆSTWï¼‰ è®¿é—®å¯¹è±¡çš„ hashCode ä¹Ÿä¼šæ’¤é”€åå‘é” å¦‚æžœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ²¡æœ‰ç«žäº‰ï¼Œè¿™æ—¶åå‘äº†çº¿ç¨‹ T1 çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘ T2ï¼Œ é‡åå‘ä¼šé‡ç½®å¯¹è±¡çš„ Thread ID æ’¤é”€åå‘å’Œé‡åå‘éƒ½æ˜¯æ‰¹é‡è¿›è¡Œçš„ï¼Œä»¥ç±»ä¸ºå•ä½ å¦‚æžœæ’¤é”€åå‘åˆ°è¾¾æŸä¸ªé˜ˆå€¼ï¼Œæ•´ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½ä¼šå˜ä¸ºä¸å¯åå‘çš„ å¯ä»¥ä¸»åŠ¨ä½¿ç”¨ -XX:-UseBiasedLocking ç¦ç”¨åå‘é” å¯ä»¥å‚è€ƒè¿™ç¯‡è®ºæ–‡ï¼šhttps://www.oracle.com/technetwork/java/biasedlocking-oopsla2006-wp-149958.pdf å‡è®¾æœ‰ä¸¤ä¸ªæ–¹æ³•åŒæ­¥å—ï¼Œåˆ©ç”¨åŒä¸€ä¸ªå¯¹è±¡åŠ é” 12345678910111213static Object obj = new Object();public static void method1() &#123; synchronized( obj ) &#123; // åŒæ­¥å— A method2(); &#125;&#125; public static void method2() &#123; synchronized( obj ) &#123; // åŒæ­¥å— B &#125;&#125; çº¿ç¨‹ 1 å¯¹è±¡ Mark è®¿é—®åŒæ­¥å— Aï¼Œæ£€æŸ¥ Mark ä¸­æ˜¯å¦æœ‰çº¿ç¨‹ ID 101ï¼ˆæ— é”å¯åå‘ï¼‰ å°è¯•åŠ åå‘é” 101ï¼ˆæ— é”å¯åå‘ï¼‰å¯¹è±¡ hashCode æˆåŠŸ 101ï¼ˆæ— é”å¯åå‘ï¼‰çº¿ç¨‹ID æ‰§è¡ŒåŒæ­¥å— A 101ï¼ˆæ— é”å¯åå‘ï¼‰çº¿ç¨‹ID è®¿é—®åŒæ­¥å— Bï¼Œæ£€æŸ¥ Mark ä¸­æ˜¯å¦æœ‰çº¿ç¨‹ ID 101ï¼ˆæ— é”å¯åå‘ï¼‰çº¿ç¨‹ID æ˜¯è‡ªå·±çš„çº¿ç¨‹ IDï¼Œé”æ˜¯è‡ªå·±çš„ï¼Œæ— éœ€åšæ›´å¤šæ“ä½œ 101ï¼ˆæ— é”å¯åå‘ï¼‰çº¿ç¨‹ID æ‰§è¡ŒåŒæ­¥å— B 101ï¼ˆæ— é”å¯åå‘ï¼‰çº¿ç¨‹ID æ‰§è¡Œå®Œæ¯• 101ï¼ˆæ— é”å¯åå‘ï¼‰å¯¹è±¡ hashCode å…¶ä»–ä¼˜åŒ–1) å‡å°‘ä¸Šé”æ—¶é—´åŒæ­¥ä»£ç å—ä¸­å°½é‡çŸ­ ï¼ˆæœ‰é’ˆå¯¹æ€§çš„ä¿æŠ¤ï¼‰ 2) å‡å°‘é”çš„ç²’åº¦å°†ä¸€ä¸ªé”æ‹†åˆ†ä¸ºå¤šä¸ªé”æé«˜å¹¶å‘åº¦ï¼Œä¾‹å¦‚ï¼š ConcurrentHashMap LongAdder åˆ†ä¸º base å’Œ cells ä¸¤éƒ¨åˆ†ã€‚æ²¡æœ‰å¹¶å‘äº‰ç”¨çš„æ—¶å€™æˆ–è€…æ˜¯ cells æ•°ç»„æ­£åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨ CAS æ¥ç´¯åŠ å€¼åˆ° baseï¼Œæœ‰å¹¶å‘äº‰ç”¨ï¼Œä¼šåˆå§‹åŒ– cells æ•°ç»„ï¼Œæ•°ç»„æœ‰å¤šå°‘ä¸ª cellï¼Œå°±å…è®¸æœ‰å¤šå°‘çº¿ç¨‹å¹¶è¡Œä¿®æ”¹ï¼Œæœ€åŽå°†æ•°ç»„ä¸­æ¯ä¸ª cell ç´¯åŠ ï¼Œå†åŠ ä¸Š base å°±æ˜¯æœ€ç»ˆçš„å€¼ LinkedBlockingQueue å…¥é˜Ÿå’Œå‡ºé˜Ÿä½¿ç”¨ä¸åŒçš„é”ï¼Œç›¸å¯¹äºŽLinkedBlockingArrayåªæœ‰ä¸€ä¸ªé”æ•ˆçŽ‡è¦é«˜ 3) é”ç²—åŒ–å¤šæ¬¡å¾ªçŽ¯è¿›å…¥åŒæ­¥å—ä¸å¦‚åŒæ­¥å—å†…å¤šæ¬¡å¾ªçŽ¯ å¦å¤– JVM å¯èƒ½ä¼šåšå¦‚ä¸‹ä¼˜åŒ–ï¼ŒæŠŠå¤šæ¬¡ append çš„åŠ é”æ“ä½œç²—åŒ–ä¸ºä¸€æ¬¡ï¼ˆå› ä¸ºéƒ½æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œæ²¡å¿…è¦é‡å…¥å¤šæ¬¡ï¼‰ 1new StringBuffer().append(&quot;a&quot;).append(&quot;b&quot;).append(&quot;c&quot;); 4) é”æ¶ˆé™¤JVM ä¼šè¿›è¡Œä»£ç çš„é€ƒé€¸åˆ†æžï¼Œä¾‹å¦‚æŸä¸ªåŠ é”å¯¹è±¡æ˜¯æ–¹æ³•å†…å±€éƒ¨å˜é‡ï¼Œä¸ä¼šè¢«å…¶å®ƒçº¿ç¨‹æ‰€è®¿é—®åˆ°ï¼Œè¿™æ—¶å€™å°±ä¼šè¢«å³æ—¶ç¼–è¯‘å™¨å¿½ç•¥æŽ‰æ‰€æœ‰åŒæ­¥æ“ä½œã€‚ 5) è¯»å†™åˆ†ç¦»CopyOnWriteArrayList ConyOnWriteSet å‚è€ƒï¼šOralceå®˜æ–¹ Synchronization javaé”ä¼˜åŒ–/ èŠèŠå¹¶å‘ï¼ˆäºŒï¼‰â€”â€”Java SE1.6 ä¸­çš„ Synchronized Javaé”ä¼˜åŒ–â€“JVMé”é™çº§ ä»Žjvmçš„è§’åº¦æ¥çœ‹javaçš„å¤šçº¿ç¨‹ Java æ˜¯å¦æ›¾ç»é‡æ–°è°ƒæ•´å•ä¸ªé”","categories":[{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"}],"tags":[{"name":"jvm","slug":"jvm","permalink":"http://fyupeng.github.io/tags/jvm/"}],"author":"fyupeng"},{"title":"Netty å…¥é—¨ - 03","slug":"Netty03","date":"2022-06-25T07:04:15.000Z","updated":"2022-06-25T07:09:42.295Z","comments":true,"path":"2022/06/25/Netty03/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/Netty03/","excerpt":"","text":"ä¸€ã€google-protobuf1. ç¼–ç å’Œè§£ç çš„åŸºæœ¬ä»‹ç» ç¼–å†™ç½‘ç»œåº”ç”¨ç¨‹åºæ—¶ï¼Œå› ä¸ºæ•°æ®åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„éƒ½æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç æ•°æ®ï¼Œåœ¨å‘é€æ•°æ®æ—¶å°±éœ€è¦ç¼–ç ï¼ŒæŽ¥æ”¶æ•°æ®æ—¶å°±éœ€è¦è§£ç [ç¤ºæ„å›¾] codecï¼ˆç¼–è§£ç å™¨ï¼‰çš„ç»„æˆéƒ¨åˆ†æœ‰ä¸¤ä¸ªï¼šdecoderï¼ˆè§£ç å™¨ï¼‰å’Œ encoderï¼ˆç¼–ç å™¨ï¼‰ã€‚encoder è´Ÿè´£æŠŠä¸šåŠ¡æ•°æ®è½¬æ¢æˆå­—èŠ‚ç æ•°æ®ï¼Œdecoder è´Ÿè´£æŠŠå­—èŠ‚ç æ•°æ®è½¬æ¢æˆä¸šåŠ¡æ•°æ® 2. Netty æœ¬èº«çš„ç¼–ç è§£ç çš„æœºåˆ¶å’Œé—®é¢˜åˆ†æž Netty è‡ªèº«æä¾›äº†ä¸€äº› codec(ç¼–è§£ç å™¨) Nettyæä¾›çš„ç¼–ç å™¨ StringEncoderï¼šå¯¹å­—ç¬¦ä¸²æ•°æ®è¿›è¡Œç¼–ç ã€‚ ObjectEncoderï¼šå¯¹Javaå¯¹è±¡è¿›è¡Œç¼–ç ã€‚ Nettyæä¾›çš„è§£ç å™¨ StringDecoder,å¯¹å­—ç¬¦ä¸²æ•°æ®è¿›è¡Œè§£ç  ObjectDecoderï¼Œå¯¹ Java å¯¹è±¡è¿›è¡Œè§£ç  Nettyæœ¬èº«è‡ªå¸¦çš„ObjectDecoderå’ŒObjectEncoderå¯ä»¥ç”¨æ¥å®žçŽ°POJOå¯¹è±¡æˆ–å„ç§ä¸šåŠ¡å¯¹è±¡çš„ç¼–ç å’Œè§£ç ï¼Œåº•å±‚ä½¿ç”¨çš„ä»æ˜¯Javaåºåˆ—åŒ–æŠ€æœ¯,è€ŒJavaåºåˆ—åŒ–æŠ€æœ¯æœ¬èº«æ•ˆçŽ‡å°±ä¸é«˜ï¼Œå­˜åœ¨å¦‚ä¸‹é—®é¢˜ æ— æ³•è·¨è¯­è¨€ åºåˆ—åŒ–åŽçš„ä½“ç§¯å¤ªå¤§ï¼Œæ˜¯äºŒè¿›åˆ¶ç¼–ç çš„5å€å¤šã€‚ åºåˆ—åŒ–æ€§èƒ½å¤ªä½Ž å¼•å‡ºæ–°çš„è§£å†³æ–¹æ¡ˆ[Google çš„ Protobuf] 3. Protobuf Protobuf åŸºæœ¬ä»‹ç»å’Œä½¿ç”¨ç¤ºæ„å›¾, protocä¸‹è½½https://developer.aliyun.com/article/710477 Protobuf æ˜¯ Google å‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œå…¨ç§° Google Protocol Buffersï¼Œæ˜¯ä¸€ç§è½»ä¾¿é«˜æ•ˆçš„ç»“æž„åŒ–æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œå¯ä»¥ç”¨äºŽç»“æž„åŒ–æ•°æ®ä¸²è¡ŒåŒ–ï¼Œæˆ–è€…è¯´åºåˆ—åŒ–ã€‚å®ƒå¾ˆé€‚åˆåšæ•°æ®å­˜å‚¨æˆ– RPC [è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ remote procedure call ]æ•°æ®äº¤æ¢æ ¼å¼ã€‚ç›®å‰å¾ˆå¤šå…¬å¸ ä»Žhttp + json è½¬å‘tcp + protobufï¼Œæ•ˆçŽ‡ä¼šæ›´é«˜ã€‚ å‚è€ƒæ–‡æ¡£ï¼šhttps://developers.google.com/protocol-buffers/docs/proto è¯­è¨€æŒ‡å— Protobuf æ˜¯ä»¥ message çš„æ–¹å¼æ¥ç®¡ç†æ•°æ®çš„. æ”¯æŒè·¨å¹³å°ã€è·¨è¯­è¨€ï¼Œå³[å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å¯ä»¥æ˜¯ä¸åŒçš„è¯­è¨€ç¼–å†™çš„]ï¼ˆæ”¯æŒç›®å‰ç»å¤§å¤šæ•°è¯­è¨€ï¼Œä¾‹å¦‚ C++ã€C#ã€Javaã€python ç­‰ï¼‰ é«˜æ€§èƒ½ï¼Œé«˜å¯é æ€§ ä½¿ç”¨ protobuf ç¼–è¯‘å™¨èƒ½è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼ŒProtobuf æ˜¯å°†ç±»çš„å®šä¹‰ä½¿ç”¨ .proto æ–‡ä»¶è¿›è¡Œæè¿°ã€‚è¯´æ˜Žï¼Œåœ¨ idea ä¸­ç¼–å†™ .proto æ–‡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨æç¤ºæ˜¯å¦ä¸‹è½½ .ptoto ç¼–å†™æ’ä»¶.å¯ä»¥è®©è¯­æ³•é«˜äº®ã€‚ ç„¶åŽé€šè¿‡ protoc.exe ç¼–è¯‘å™¨æ ¹æ® .proto è‡ªåŠ¨ç”Ÿæˆ .java æ–‡ä»¶ protobuf ä½¿ç”¨ç¤ºæ„å›¾ 4. Protobuf å¿«é€Ÿå…¥é—¨å®žä¾‹1ç¼–å†™ç¨‹åºï¼Œä½¿ç”¨ Protobuf å®Œæˆå¦‚ä¸‹åŠŸèƒ½ å®¢æˆ·ç«¯å¯ä»¥å‘é€ä¸€ä¸ª StudentPoJo å¯¹è±¡åˆ°æœåŠ¡å™¨(é€šè¿‡ Protobuf ç¼–ç ) æœåŠ¡ç«¯èƒ½æŽ¥æ”¶ StudentPoJo å¯¹è±¡ï¼Œå¹¶æ˜¾ç¤ºä¿¡æ¯(é€šè¿‡ Protobuf è§£ç ) 12345&lt;dependency&gt; &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt; &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt; &lt;version&gt;3.6.1&lt;/version&gt;&lt;/dependency&gt; Student.proto 1234567syntax = &quot;proto3&quot;; //ç‰ˆæœ¬option java_outer_classname = &quot;StudentPOJO&quot;; // ç”Ÿæˆçš„å¤–éƒ¨ç±»åï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ–‡ä»¶å// protobuf ä½¿ç”¨message ç®¡ç†æ•°æ®message Student &#123; // ä¼šåœ¨ StudentPOJO å¤–éƒ¨ç±»ç”Ÿæˆä¸€ä¸ªå†…éƒ¨ç±» Student, å®ƒæ˜¯çœŸæ­£å‘é€çš„ POJOå¯¹è±¡ int32 id = 1; // Student ç±»ä¸­æœ‰ä¸€ä¸ª å±žæ€§ åå­—ä¸º idç±»åž‹ä¸º int32(protobufç±»åž‹) 1 è¡¨ç¤ºå±žæ€§åºå· string name = 2;&#125; ç¼–è¯‘ protoc.exe â€“java_out=.Student.proto å°†ç”Ÿæˆçš„ StudentPOJO æ”¾å…¥åˆ°é¡¹ç›®ä½¿ç”¨ NettyServer 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package com.fyp.netty.codec;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.*;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioServerSocketChannel;import io.netty.handler.codec.protobuf.ProtobufDecoder;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyæœåŠ¡ç«¯ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyServer &#123; public static void main(String[] args) throws InterruptedException &#123; // åˆ›å»º BossGroup å’Œ WorkGroup /* è¯´æ˜Žï¼š 1. åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ bossGroup å’Œ workGroup 2. bossGroup åªæ˜¯ å¤„ç† è¿žæŽ¥è¯·æ±‚ï¼Œ çœŸæ­£çš„ å’Œå®¢æˆ·ç«¯ ä¸šåŠ¡å¤„ç†ï¼Œ ä¼šäº¤ç»™ workGroup æ¥å®Œæˆ 3. ä¸¤ä¸ªéƒ½æ˜¯ æ— é™å¾ªçŽ¯ 4. bossGroup å’Œ workerGroup å«æœ‰çš„ å­çº¿ç¨‹ ï¼ˆNioEventLoopï¼‰çš„ä¸ªæ•° é»˜è®¤å®žé™… cpuæ ¸æ•° * 2 */ EventLoopGroup bossGroup = new NioEventLoopGroup(); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; // åˆ›å»º æœåŠ¡å™¨ç«¯çš„ å¯åŠ¨å¯¹è±¡ï¼Œ é…ç½®å‚æ•° ServerBootstrap bootstrap = new ServerBootstrap(); // ä½¿ç”¨ é“¾å¼ç¼–ç¨‹ æ¥ è¿›è¡Œè®¾ç½® bootstrap.group(bossGroup, workerGroup) // è®¾ç½®ä¸¤ä¸ª çº¿ç¨‹ç»„ .channel(NioServerSocketChannel.class) // ä½¿ç”¨ NioSocketChannel ä½œä¸º æœåŠ¡å™¨çš„ é€šé“å®žçŽ° .option(ChannelOption.SO_BACKLOG, 128) // è®¾ç½® çº¿ç¨‹é˜Ÿåˆ— å¾—åˆ° è¿žæŽ¥ä¸ªæ•° .childOption(ChannelOption.SO_KEEPALIVE, true) // è®¾ç½® ä¿æŒæ´»åŠ¨ è¿žæŽ¥çŠ¶æ€ .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; // åˆ›å»ºä¸€ä¸ª é€šé“ æµ‹è¯•å¯¹è±¡ @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // åœ¨ pipeline ä¸­åŠ å…¥ ProtobufDecoder // æŒ‡å®šå¯¹ å“ªç§å¯¹è±¡ è¿›è¡Œè§£ç  pipeline.addLast(&quot;decoder&quot;, new ProtobufDecoder(StudentPOJO.Student.getDefaultInstance())); pipeline.addLast(new NettyServerHandler()); &#125; &#125;); // ç»™æˆ‘ä»¬çš„ workerGroup çš„ EventLoop å¯¹åº”çš„ç®¡é“ è®¾ç½®å¤„ç†å™¨ System.out.println(&quot;... æœåŠ¡å™¨ is ready...&quot;); // ç»‘å®šä¸€ä¸ª ç«¯å£ï¼Œ å¹¶ä¸”åŒæ­¥ï¼Œç”Ÿæˆ ä¸€ä¸ª ChannelFuture å¯¹è±¡ // å¯åŠ¨ æœåŠ¡å™¨å¹¶ç»‘å®šç«¯å£ ChannelFuture cf = bootstrap.bind(6667).sync(); // å¯¹ å…³é—­é€šé“ è¿›è¡Œç›‘å¬ cf.channel().closeFuture().sync(); &#125;finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; NettyServerHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.fyp.netty.codec;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.channel.SimpleChannelInboundHandler;import io.netty.util.CharsetUtil;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: netttyæœåŠ¡ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyServerHandler extends SimpleChannelInboundHandler&lt;StudentPOJO.Student&gt; &#123; /** * è¯»å–æ•°æ® * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ ç®¡é“ pipeline, é€šé“ channel, åœ°å€ * @param msg å®¢æˆ·ç«¯å‘é€çš„ æ•°æ®ï¼Œ é»˜è®¤ç±»åž‹ Object * @throws Exception */ @Override public void channelRead0(ChannelHandlerContext ctx, StudentPOJO.Student msg) throws Exception &#123; System.out.println(&quot;å®¢æˆ·ç«¯å‘é€çš„æ•°æ® id &quot; + msg.getId() + &quot; name &quot; + msg.getName()); &#125; // å¤„ç†è¯»å–å®Œæ¯• @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; super.channelReadComplete(ctx); // å°†æ•°æ® å†™å…¥åˆ° ç¼“å­˜ å¹¶ åˆ·æ–° ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯: ç‹—&quot;, CharsetUtil.UTF_8)); &#125; // å¤„ç†å¼‚å¸¸ï¼Œ è¦å…³é—­ é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; super.exceptionCaught(ctx, cause); ctx.close(); &#125;&#125; NerttyClient 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.fyp.netty.codec;import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioSocketChannel;import io.netty.handler.codec.protobuf.ProtobufEncoder;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyå®¢æˆ·ç«¯ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyClient &#123; public static void main(String[] args) throws InterruptedException &#123; // å®¢æˆ·ç«¯ éœ€è¦ ä¸€ä¸ª äº‹ä»¶å¾ªçŽ¯ç»„ NioEventLoopGroup group = new NioEventLoopGroup(); try &#123; // åˆ›å»º å®¢æˆ·ç«¯ å¯åŠ¨å¯¹è±¡ // æ³¨æ„å®¢æˆ·ç«¯ ä½¿ç”¨çš„ä¸æ˜¯ ServerBootStrap, è€Œæ˜¯BootStrap Bootstrap bootstrap = new Bootstrap(); // è®¾ç½®ç›¸å…³ å‚æ•° bootstrap.group(group) // è®¾ç½® çº¿ç¨‹ç»„ .channel(NioSocketChannel.class) // è®¾ç½® å®¢æˆ·ç«¯ é€šé“çš„ å®žçŽ°ç±»ï¼ˆåå°„) .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; // åœ¨ pipeline ä¸­ åŠ å…¥ ProtobufEncoder ch.pipeline().addLast(&quot;encoder&quot;, new ProtobufEncoder()); ch.pipeline().addLast(new NettyClientHandler()); // åŠ å…¥è‡ªå·±çš„ å¤„ç†å™¨ &#125; &#125;); System.out.println(&quot;å®¢æˆ·ç«¯ ok...&quot;); // å¯åŠ¨å®¢æˆ·ç«¯ åŽ»è¿žæŽ¥ æœåŠ¡å™¨ç«¯ // å…³äºŽ ChannelFuture è¦åˆ†æžï¼Œ æ¶‰åŠåˆ° netty çš„å¼‚æ­¥æ¨¡åž‹ ChannelFuture channelFuture = bootstrap.connect(&quot;127.0.0.1&quot;, 6667).sync(); // å¯¹å…³é—­ é€šé“ è¿›è¡Œç›‘å¬ channelFuture.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully(); &#125; &#125;&#125; NettyClientHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.fyp.netty.codec;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.util.CharsetUtil;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyå®¢æˆ·ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyClientHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; // å‘é€ä¸€ä¸ª Studentå¯¹è±¡ åˆ°æœåŠ¡å™¨ StudentPOJO.Student student = StudentPOJO.Student.newBuilder().setId(4).setName(&quot;è±¹å­å¤´ æž—å†²&quot;).build(); ctx.writeAndFlush(student); &#125; // å½“é€šé“ æœ‰è¯»å–äº‹ä»¶ æ—¶ ï¼Œä¼šè§¦å‘ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; ByteBuf buf = (ByteBuf) msg; System.out.println(&quot;æœåŠ¡å™¨å›žå¤çš„æ¶ˆæ¯:&quot; + buf.toString(CharsetUtil.UTF_8)); System.out.println(&quot;æœåŠ¡å™¨çš„åœ°å€ï¼š &quot;+ ctx.channel().remoteAddress()); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; 5. Protobuf å¿«é€Ÿå…¥é—¨å®žä¾‹ 2 ç¼–å†™ç¨‹åºï¼Œä½¿ç”¨ Protobuf å®Œæˆå¦‚ä¸‹åŠŸèƒ½ å®¢æˆ·ç«¯å¯ä»¥éšæœºå‘é€ StudentPoJo / WorkerPoJo å¯¹è±¡åˆ°æœåŠ¡å™¨(é€šè¿‡ Protobuf ç¼–ç ) æœåŠ¡ç«¯èƒ½æŽ¥æ”¶ StudentPoJo / WorkerPoJo å¯¹è±¡(éœ€è¦åˆ¤æ–­æ˜¯å“ªç§ç±»åž‹)ï¼Œå¹¶æ˜¾ç¤ºä¿¡æ¯(é€šè¿‡ Protobuf è§£ç ) 12345&lt;dependency&gt; &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt; &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt; &lt;version&gt;3.6.1&lt;/version&gt;&lt;/dependency&gt; Student.proto 123456789101112131415161718192021222324252627282930syntax = &quot;proto3&quot;;option optimize_for = SPEED; //åŠ å¿«è§£æžoption java_package = &quot;com.fyp.netty.codec2&quot;; // æŒ‡å®šç”Ÿæˆåˆ°å“ªä¸ªåŒ…option java_outer_classname = &quot;MyDataInfo&quot;; // å¤–éƒ¨ç±»å// protobuf å¯ä»¥ä½¿ç”¨ message ç®¡ç†å…¶ä»–çš„messagemessage MyMessage &#123; enum DataType &#123; StudentType = 0; // åœ¨ proto3 è¦æ±‚ enum çš„ç¼–å· ä»Ž0 å¼€å§‹ WorkerType = 1; &#125; //ç”¨ data_type æ¥æ ‡è¯† ä¼ çš„æ˜¯ å“ªä¸€ä¸ª æžšä¸¾ç±»åž‹ DataType data_type = 1; // è¡¨ç¤º æ¯æ¬¡ æžšä¸¾ç±»åž‹ æœ€å¤š åªèƒ½å‡ºçŽ° å…¶ä¸­ä¸€ä¸ªï¼ŒèŠ‚çœç©ºé—´ oneof dataBody &#123; Student student = 2; Worker worker = 3; &#125;&#125;message Student &#123; int32 id = 1; string name = 2;&#125;message Worker &#123; string name = 1; int32 age = 2;&#125; NettyServer 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package com.fyp.netty.codec2;import com.fyp.netty.codec.StudentPOJO;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.*;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioServerSocketChannel;import io.netty.handler.codec.protobuf.ProtobufDecoder;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyæœåŠ¡ç«¯ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyServer &#123; public static void main(String[] args) throws InterruptedException &#123; // åˆ›å»º BossGroup å’Œ WorkGroup /* è¯´æ˜Žï¼š 1. åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ bossGroup å’Œ workGroup 2. bossGroup åªæ˜¯ å¤„ç† è¿žæŽ¥è¯·æ±‚ï¼Œ çœŸæ­£çš„ å’Œå®¢æˆ·ç«¯ ä¸šåŠ¡å¤„ç†ï¼Œ ä¼šäº¤ç»™ workGroup æ¥å®Œæˆ 3. ä¸¤ä¸ªéƒ½æ˜¯ æ— é™å¾ªçŽ¯ 4. bossGroup å’Œ workerGroup å«æœ‰çš„ å­çº¿ç¨‹ ï¼ˆNioEventLoopï¼‰çš„ä¸ªæ•° é»˜è®¤å®žé™… cpuæ ¸æ•° * 2 */ EventLoopGroup bossGroup = new NioEventLoopGroup(); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; // åˆ›å»º æœåŠ¡å™¨ç«¯çš„ å¯åŠ¨å¯¹è±¡ï¼Œ é…ç½®å‚æ•° ServerBootstrap bootstrap = new ServerBootstrap(); // ä½¿ç”¨ é“¾å¼ç¼–ç¨‹ æ¥ è¿›è¡Œè®¾ç½® bootstrap.group(bossGroup, workerGroup) // è®¾ç½®ä¸¤ä¸ª çº¿ç¨‹ç»„ .channel(NioServerSocketChannel.class) // ä½¿ç”¨ NioSocketChannel ä½œä¸º æœåŠ¡å™¨çš„ é€šé“å®žçŽ° .option(ChannelOption.SO_BACKLOG, 128) // è®¾ç½® çº¿ç¨‹é˜Ÿåˆ— å¾—åˆ° è¿žæŽ¥ä¸ªæ•° .childOption(ChannelOption.SO_KEEPALIVE, true) // è®¾ç½® ä¿æŒæ´»åŠ¨ è¿žæŽ¥çŠ¶æ€ .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; // åˆ›å»ºä¸€ä¸ª é€šé“ æµ‹è¯•å¯¹è±¡ @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // åœ¨ pipeline ä¸­åŠ å…¥ ProtobufDecoder // æŒ‡å®šå¯¹ å“ªç§å¯¹è±¡ è¿›è¡Œè§£ç  pipeline.addLast(&quot;decoder&quot;, new ProtobufDecoder(MyDataInfo.MyMessage.getDefaultInstance())); pipeline.addLast(new NettyServerHandler()); &#125; &#125;); // ç»™æˆ‘ä»¬çš„ workerGroup çš„ EventLoop å¯¹åº”çš„ç®¡é“ è®¾ç½®å¤„ç†å™¨ System.out.println(&quot;... æœåŠ¡å™¨ is ready...&quot;); // ç»‘å®šä¸€ä¸ª ç«¯å£ï¼Œ å¹¶ä¸”åŒæ­¥ï¼Œç”Ÿæˆ ä¸€ä¸ª ChannelFuture å¯¹è±¡ // å¯åŠ¨ æœåŠ¡å™¨å¹¶ç»‘å®šç«¯å£ ChannelFuture cf = bootstrap.bind(6667).sync(); // å¯¹ å…³é—­é€šé“ è¿›è¡Œç›‘å¬ cf.channel().closeFuture().sync(); &#125;finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; NettyServerHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162package com.fyp.netty.codec2;import com.fyp.netty.codec.StudentPOJO;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import io.netty.util.CharsetUtil;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: netttyæœåŠ¡ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyServerHandler extends SimpleChannelInboundHandler&lt;MyDataInfo.MyMessage&gt; &#123; /** * è¯»å–æ•°æ® * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ ç®¡é“ pipeline, é€šé“ channel, åœ°å€ * @param msg å®¢æˆ·ç«¯å‘é€çš„ æ•°æ®ï¼Œ é»˜è®¤ç±»åž‹ Object * @throws Exception */ @Override public void channelRead0(ChannelHandlerContext ctx, MyDataInfo.MyMessage msg) throws Exception &#123; // æ ¹æ® dataType æ¥æ˜¾ç¤º ä¸åŒçš„ä¿¡æ¯ MyDataInfo.MyMessage.DataType dataType = msg.getDataType(); if (dataType == MyDataInfo.MyMessage.DataType.StudentType) &#123; MyDataInfo.Student student = msg.getStudent(); System.out.println(&quot;å­¦ç”Ÿid &quot; + student.getId() + &quot;å­¦ç”Ÿåå­— &quot; + student.getName()); &#125; else if (dataType == MyDataInfo.MyMessage.DataType.WorkerType) &#123; MyDataInfo.Worker worker = msg.getWorker(); System.out.println(&quot;å·¥äººåå­—&quot; + worker.getName() + &quot;å·¥äººå¹´é¾„&quot; + worker.getAge()); &#125; else &#123; System.out.println(&quot;ä¼ è¾“çš„ç±»åž‹ä¸æ­£ç¡®&quot;); &#125; &#125; // å¤„ç†è¯»å–å®Œæ¯• @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; super.channelReadComplete(ctx); // å°†æ•°æ® å†™å…¥åˆ° ç¼“å­˜ å¹¶ åˆ·æ–° ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯: ç‹—&quot;, CharsetUtil.UTF_8)); &#125; // å¤„ç†å¼‚å¸¸ï¼Œ è¦å…³é—­ é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; super.exceptionCaught(ctx, cause); ctx.close(); &#125;&#125; NettyClient 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.fyp.netty.codec2;import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioSocketChannel;import io.netty.handler.codec.protobuf.ProtobufEncoder;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyå®¢æˆ·ç«¯ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyClient &#123; public static void main(String[] args) throws InterruptedException &#123; // å®¢æˆ·ç«¯ éœ€è¦ ä¸€ä¸ª äº‹ä»¶å¾ªçŽ¯ç»„ NioEventLoopGroup group = new NioEventLoopGroup(); try &#123; // åˆ›å»º å®¢æˆ·ç«¯ å¯åŠ¨å¯¹è±¡ // æ³¨æ„å®¢æˆ·ç«¯ ä½¿ç”¨çš„ä¸æ˜¯ ServerBootStrap, è€Œæ˜¯BootStrap Bootstrap bootstrap = new Bootstrap(); // è®¾ç½®ç›¸å…³ å‚æ•° bootstrap.group(group) // è®¾ç½® çº¿ç¨‹ç»„ .channel(NioSocketChannel.class) // è®¾ç½® å®¢æˆ·ç«¯ é€šé“çš„ å®žçŽ°ç±»ï¼ˆåå°„) .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; // åœ¨ pipeline ä¸­ åŠ å…¥ ProtobufEncoder ch.pipeline().addLast(&quot;encoder&quot;, new ProtobufEncoder()); ch.pipeline().addLast(new NettyClientHandler()); // åŠ å…¥è‡ªå·±çš„ å¤„ç†å™¨ &#125; &#125;); System.out.println(&quot;å®¢æˆ·ç«¯ ok...&quot;); // å¯åŠ¨å®¢æˆ·ç«¯ åŽ»è¿žæŽ¥ æœåŠ¡å™¨ç«¯ // å…³äºŽ ChannelFuture è¦åˆ†æžï¼Œ æ¶‰åŠåˆ° netty çš„å¼‚æ­¥æ¨¡åž‹ ChannelFuture channelFuture = bootstrap.connect(&quot;127.0.0.1&quot;, 6667).sync(); // å¯¹å…³é—­ é€šé“ è¿›è¡Œç›‘å¬ channelFuture.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully(); &#125; &#125;&#125; NettyClientHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.fyp.netty.codec2;import com.fyp.netty.codec.StudentPOJO;import com.fyp.netty.heartbeat.MyServer;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.util.CharsetUtil;import java.util.Random;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyå®¢æˆ·ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyClientHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; // éšæœºçš„ å‘é€ Student æˆ–è€… Worker å¯¹è±¡ int random = new Random().nextInt(3); MyDataInfo.MyMessage myMessage = null; if (0 == random) &#123; // å‘é€ student å¯¹è±¡ myMessage = MyDataInfo.MyMessage.newBuilder().setDataType(MyDataInfo.MyMessage.DataType.StudentType).setStudent(MyDataInfo.Student.newBuilder().setId(5).setName(&quot;çŽ‰éº’éºŸ å¢ä¿Šä¹‰&quot;).build()).build(); &#125; else &#123; myMessage = MyDataInfo.MyMessage.newBuilder().setDataType(MyDataInfo.MyMessage.DataType.WorkerType).setWorker(MyDataInfo.Worker.newBuilder().setName(&quot;è€æŽ&quot;).setAge(20).build()).build(); &#125; ctx.writeAndFlush(myMessage); &#125; // å½“é€šé“ æœ‰è¯»å–äº‹ä»¶ æ—¶ ï¼Œä¼šè§¦å‘ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; ByteBuf buf = (ByteBuf) msg; System.out.println(&quot;æœåŠ¡å™¨å›žå¤çš„æ¶ˆæ¯:&quot; + buf.toString(CharsetUtil.UTF_8)); System.out.println(&quot;æœåŠ¡å™¨çš„åœ°å€ï¼š &quot;+ ctx.channel().remoteAddress()); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; äºŒã€Nettyå‡ºå…¥ç«™å’Œè°ƒç”¨æœºåˆ¶1. åŸºæœ¬è¯´æ˜Ž Netty çš„ç»„ä»¶è®¾è®¡ï¼šNetty çš„ä¸»è¦ç»„ä»¶æœ‰ Channelã€EventLoopã€ChannelFutureã€ChannelHandlerã€ChannelPipe ç­‰ ChannelHandler å……å½“äº†å¤„ç†å…¥ç«™å’Œå‡ºç«™æ•°æ®çš„åº”ç”¨ç¨‹åºé€»è¾‘çš„å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œå®žçŽ° ChannelInboundHandler æŽ¥å£ï¼ˆæˆ– ChannelInboundHandlerAdapterï¼‰ï¼Œä½ å°±å¯ä»¥æŽ¥æ”¶å…¥ç«™äº‹ä»¶å’Œæ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šè¢«ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚å½“è¦ç»™å®¢æˆ·ç«¯å‘é€å“åº”æ—¶ï¼Œä¹Ÿå¯ä»¥ä»Ž ChannelInboundHandler å†²åˆ·æ•°æ®ã€‚ä¸šåŠ¡é€»è¾‘é€šå¸¸å†™åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ª ChannelInboundHandler ä¸­ã€‚ChannelOutboundHandler åŽŸç†ä¸€æ ·ï¼Œåªä¸è¿‡å®ƒæ˜¯ç”¨æ¥å¤„ç†å‡ºç«™æ•°æ®çš„ ChannelPipeline æä¾›äº† ChannelHandler é“¾çš„å®¹å™¨ã€‚ä»¥å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸ºä¾‹ï¼Œå¦‚æžœäº‹ä»¶çš„è¿åŠ¨æ–¹å‘æ˜¯ä»Žå®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™äº›äº‹ä»¶ä¸ºå‡ºç«™çš„ï¼Œå³å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯çš„æ•°æ®ä¼šé€šè¿‡ pipeline ä¸­çš„ä¸€ç³»åˆ— ChannelOutboundHandlerï¼Œå¹¶è¢«è¿™äº› Handler å¤„ç†ï¼Œåä¹‹åˆ™ç§°ä¸ºå…¥ç«™çš„ 2. ç¼–ç è§£ç å™¨ å½“ Netty å‘é€æˆ–è€…æŽ¥å—ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶å€™ï¼Œå°±å°†ä¼šå‘ç”Ÿä¸€æ¬¡æ•°æ®è½¬æ¢ã€‚å…¥ç«™æ¶ˆæ¯ä¼šè¢«è§£ç ï¼šä»Žå­—èŠ‚è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼ï¼ˆæ¯”å¦‚ java å¯¹è±¡ï¼‰ï¼›å¦‚æžœæ˜¯å‡ºç«™æ¶ˆæ¯ï¼Œå®ƒä¼šè¢«ç¼–ç æˆå­—èŠ‚ã€‚ Netty æä¾›ä¸€ç³»åˆ—å®žç”¨çš„ç¼–è§£ç å™¨ï¼Œä»–ä»¬éƒ½å®žçŽ°äº† ChannelInboundHadnler æˆ–è€… ChannelOutboundHandler æŽ¥å£ã€‚åœ¨è¿™äº›ç±»ä¸­ï¼ŒchannelRead æ–¹æ³•å·²ç»è¢«é‡å†™äº†ã€‚ä»¥å…¥ç«™ä¸ºä¾‹ï¼Œå¯¹äºŽæ¯ä¸ªä»Žå…¥ç«™ Channel è¯»å–çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚éšåŽï¼Œå®ƒå°†è°ƒç”¨ç”±è§£ç å™¨æ‰€æä¾›çš„ decode() æ–¹æ³•è¿›è¡Œè§£ç ï¼Œå¹¶å°†å·²ç»è§£ç çš„å­—èŠ‚è½¬å‘ç»™ ChannelPipeline ä¸­çš„ä¸‹ä¸€ä¸ª ChannelInboundHandlerã€‚ 3. è§£ç å™¨ - ByteToMessageDecoder å…³ç³»ç»§æ‰¿å›¾ ç”±äºŽä¸å¯èƒ½çŸ¥é“è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦ä¼šä¸€æ¬¡æ€§å‘é€ä¸€ä¸ªå®Œæ•´çš„ä¿¡æ¯ï¼Œtcp æœ‰å¯èƒ½å‡ºçŽ°ç²˜åŒ…æ‹†åŒ…çš„é—®é¢˜ï¼Œè¿™ä¸ªç±»ä¼šå¯¹å…¥ç«™æ•°æ®è¿›è¡Œç¼“å†²ï¼Œç›´åˆ°å®ƒå‡†å¤‡å¥½è¢«å¤„ç†.ã€åŽé¢æœ‰è¯´TCPçš„ç²˜åŒ…å’Œæ‹†åŒ…é—®é¢˜ã€‘ ä¸€ä¸ªå…³äºŽ ByteToMessageDecoder å®žä¾‹åˆ†æž 4. Nettyçš„handleré“¾çš„è°ƒç”¨æœºåˆ¶å®žä¾‹è¦æ±‚: ä½¿ç”¨è‡ªå®šä¹‰çš„ç¼–ç å™¨å’Œè§£ç å™¨æ¥è¯´æ˜Ž Netty çš„ handler è°ƒç”¨æœºåˆ¶ å®¢æˆ·ç«¯å‘é€ long -&gt; æœåŠ¡å™¨ æœåŠ¡ç«¯å‘é€ long -&gt; å®¢æˆ·ç«¯ ä»£ç æ¼”ç¤ºMyServer 12345678910111213141516171819202122232425262728293031323334353637package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioServerSocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: æˆ‘çš„æœåŠ¡ç«¯ * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new MyServerInitializer()); // è‡ªå®šä¹‰ä¸€ä¸ª åˆå§‹åŒ–ç±» ChannelFuture channelFuture = serverBootstrap.bind(7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; MyServerHandler 123456789101112131415161718192021222324252627282930package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: æˆ‘çš„æœåŠ¡ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyServerHandler extends SimpleChannelInboundHandler&lt;Long&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, Long msg) throws Exception &#123; System.out.println(&quot;ä»Žå®¢æˆ·ç«¯&quot; + ctx.channel().remoteAddress() + &quot;è¯»å–åˆ°çš„long &quot; + msg); ctx.writeAndFlush(98765L); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; MyServerInitializer 1234567891011121314151617181920212223242526272829package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: æœåŠ¡å™¨åˆå§‹åŒ–ç±» * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // å…¥ç«™çš„ handler è¿›è¡Œè§£ç  MyByteToLongDecoder pipeline.addLast(new MyByteToLongDecoder()); // å‡ºç«™çš„ handler è¿›è¡Œç¼–ç  MyLongToByteEncoder pipeline.addLast(new MyLongToByteEncoder()); // è‡ªå®šä¹‰çš„ handler å¤„ç†ä¸šåŠ¡é€»è¾‘ pipeline.addLast(new MyServerHandler()); &#125;&#125; MyClient 12345678910111213141516171819202122232425262728293031323334353637383940package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioSocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyClient &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group) .channel(NioSocketChannel.class) .handler(new MyClientInitializer()); // è‡ªå®šä¹‰ä¸€ä¸ª åˆå§‹åŒ–ç±» ChannelFuture channelFuture = bootstrap.connect(&quot;localhost&quot;, 7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully(); &#125; &#125;&#125; MyClientHandler 1234567891011121314151617181920212223242526272829package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandler;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyClientHandler extends SimpleChannelInboundHandler&lt;Long&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, Long msg) throws Exception &#123; System.out.println(&quot;æœåŠ¡å™¨ç«¯å‘å›žçš„æ¶ˆæ¯ï¼š&quot; + msg); &#125; // å‘é€æ•°æ® @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; System.out.println(&quot;MyClientHandler å‘é€æ•°æ®&quot;); //ctx.writeAndFlush(Unpooled.copiedBuffer()) ctx.writeAndFlush(123456L); // å‘é€çš„æ˜¯ ä¸€ä¸ª Long &#125;&#125; MyClientInitializer 1234567891011121314151617181920212223242526272829package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: å®¢æˆ·ç«¯åˆå§‹åŒ–ç±» * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyClientInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // åŠ å…¥ ä¸€ä¸ª å…¥ç«™çš„ handler å¯¹æ•°æ® è¿›è¡Œ è§£ç  pipeline.addLast(new MyByteToLongDecoder()); // åŠ å…¥ ä¸€ä¸ª å‡ºç«™çš„ handler å¯¹æ•°æ® è¿›è¡Œ ç¼–ç  pipeline.addLast(new MyLongToByteEncoder()); // åŠ å…¥ ä¸€ä¸ªè‡ªå®šä¹‰çš„ handler å¤„ç†ä¸šåŠ¡ pipeline.addLast(new MyClientHandler()); &#125;&#125; MyByteToLongDecoder 1234567891011121314151617181920212223242526272829303132333435363738394041package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandler;import io.netty.channel.ChannelHandlerContext;import io.netty.handler.codec.ByteToMessageDecoder;import java.util.List;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyByteToLongDecoder extends ByteToMessageDecoder &#123; /** * decode ä¼šæ ¹æ®æŽ¥å—çš„æ•°æ®ï¼Œè°ƒç”¨å¤šæ¬¡ï¼Œç›´åˆ° ç¡®å®šæ²¡æœ‰ æ–°çš„å…ƒç´  æ·»åŠ åˆ° listï¼Œ * æˆ–è€…æ˜¯ ByteBuf æ²¡æœ‰æ›´å¤šçš„ å¯è¯»å­—èŠ‚ä¸ºæ­¢ * å¦‚æžœlist out ä¸ä¸ºç©ºï¼Œ å°±ä¼šå°† list çš„å†…å®¹ ä¼ é€’ç»™ ä¸‹ä¸€ä¸ª ChannelInBoundHandler * å¤„ç†ï¼Œè¯¥å¤„ç†å™¨çš„ æ–¹æ³•ä¹Ÿä¼šè¢« è°ƒç”¨å¤šæ¬¡ * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡ * @param in å…¥ç«™çš„ ByteBuf * @param out list é›†åˆï¼Œå°†è§£ç åŽçš„ æ•°æ® ä¼ ç»™ä¸‹ä¸€ä¸ª handler * @throws Exception */ @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; System.out.println(&quot;MyByteToLongDecoder decoder è¢«è°ƒç”¨&quot;); // å› ä¸º long 8ä¸ªå­—èŠ‚ if (in.readableBytes() &gt;= 8) &#123; out.add(in.readLong()); &#125; &#125;&#125; MyLongToByteEncoder 123456789101112131415161718192021222324package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandlerContext;import io.netty.handler.codec.MessageToByteEncoder;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyLongToByteEncoder extends MessageToByteEncoder&lt;Long&gt; &#123; @Override protected void encode(ChannelHandlerContext ctx, Long msg, ByteBuf out) throws Exception &#123; System.out.println(&quot;MyLongToByteEncoder encode è¢«è°ƒç”¨&quot;); System.out.println(&quot;msg &quot; + msg); out.writeLong(msg); &#125;&#125; æ•ˆæžœæœåŠ¡ç«¯ï¼šhandlerè°ƒç”¨é¡ºåºï¼šMyByteToLongDecoder -&gt; MyServerHandler-&gt; MyLongToByteEncoder å®¢æˆ·ç«¯ï¼šhandlerè°ƒç”¨é¡ºåºï¼šMyClientHandler-&gt; MyLongToByteEncoder -&gt; MyByteToLongDecoder å‡ºç«™å…¥ç«™å…³äºŽå‡ºç«™å…¥ç«™ï¼Œå¾ˆå¤šäººå¯èƒ½æœ‰ç‚¹è¿·ç³Š 1ï¼‰å®¢æˆ·ç«¯æœ‰å‡ºç«™å…¥ç«™ï¼ŒæœåŠ¡ç«¯ä¹Ÿæœ‰å‡ºç«™å…¥ç«™ 2ï¼‰ä»¥å®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œå¦‚æžœæœ‰æœåŠ¡ç«¯ä¼ é€çš„æ•°æ®åˆ°è¾¾å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆå¯¹äºŽå®¢æˆ·ç«¯æ¥è¯´å°±æ˜¯å…¥ç«™ï¼› å¦‚æžœå®¢æˆ·ç«¯ä¼ é€æ•°æ®åˆ°æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆå¯¹äºŽå®¢æˆ·ç«¯æ¥è¯´å°±æ˜¯å‡ºç«™ï¼› åŒç†ï¼Œå¯¹äºŽæœåŠ¡ç«¯æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæœ‰æ•°æ®æ¥å°±æ˜¯å…¥ç«™ï¼Œæœ‰æ•°æ®è¾“å‡ºå°±æ˜¯å‡ºç«™ 3ï¼‰ä¸ºä»€ä¹ˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„Serverhandleréƒ½æ˜¯ç»§æ‰¿SimpleChannelInboundHandlerï¼Œè€Œæ²¡æœ‰ChannelOutboundHandlerå‡ºç«™ç±»ï¼Ÿ å®žé™…ä¸Šå½“æˆ‘ä»¬åœ¨handlerä¸­è°ƒç”¨ctx.writeAndFlush()æ–¹æ³•åŽï¼Œå°±ä¼šå°†æ•°æ®äº¤ç»™ChannelOutboundHandlerè¿›è¡Œå‡ºç«™å¤„ç†ï¼Œåªæ˜¯æˆ‘ä»¬æ²¡æœ‰åŽ»å®šä¹‰å‡ºç«™ç±»è€Œå·²ï¼Œè‹¥æœ‰éœ€æ±‚å¯ä»¥è‡ªå·±åŽ»å®žçŽ°ChannelOutboundHandlerå‡ºç«™ç±» 4ï¼‰æ€»ç»“å°±æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æœ‰å‡ºç«™å’Œå…¥ç«™çš„æ“ä½œ æœåŠ¡ç«¯å‘æ•°æ®ç»™å®¢æˆ·ç«¯ï¼šæœåŠ¡ç«¯â€”&gt;å‡ºç«™â€”&gt;Socketé€šé“â€”&gt;å…¥ç«™â€”&gt;å®¢æˆ·ç«¯ å®¢æˆ·ç«¯å‘æ•°æ®ç»™æœåŠ¡ç«¯ï¼šå®¢æˆ·ç«¯â€”&gt;å‡ºç«™â€”&gt;Socketé€šé“â€”&gt;å…¥ç«™â€”&gt;æœåŠ¡ç«¯ ç†é€handleré“¾æ‰§è¡Œå…¥ç«™å‡ºç«™åŽŸç†ï¼ˆåŒé“¾ç»“æž„ï¼‰ç†è§£ï¼šé€šè¿‡å¯¹ç»§æ‰¿çš„ç±»æ¥è¿‡æ»¤æ˜¯å‡ºç«™çš„è¿˜æ˜¯å…¥ç«™çš„ï¼Œç„¶åŽå†åŽ»æ‰§è¡Œè¯¥ç±»çš„å®žçŽ°æ–¹æ³• head â†” ServerInitializer(æœåŠ¡ç«¯åˆå§‹åŒ–å™¨) â†” decoder(è§£ç å™¨) â†” encoder(ç¼–ç å™¨) â†” ServerHandler(è‡ªå®šä¹‰å¤„ç†å™¨)â†” tail é€šè¿‡ä»¥ä¸‹çš„ä»£ç ï¼š è¿‡æ»¤åŽå¾—åˆ°ï¼š å…¥ç«™(head-&gt;tailæ–¹å‘)ï¼šdecoder(è§£ç å™¨) -&gt; ServerHandler(è‡ªå®šä¹‰å¤„ç†å™¨) å‡ºç«™(tail-&gt;headæ–¹å‘)ï¼šServerHandler(è‡ªå®šä¹‰å¤„ç†å™¨) -&gt; encoder(ç¼–ç å™¨) 123456789101112131415161718private AbstractChannelHandlerContext findContextInbound(int mask) &#123; AbstractChannelHandlerContext ctx = this; EventExecutor currentExecutor = executor(); do &#123; ctx = ctx.next; &#125; while (skipContext(ctx, currentExecutor, mask, MASK_ONLY_INBOUND)); return ctx;&#125;private AbstractChannelHandlerContext findContextOutbound(int mask) &#123; AbstractChannelHandlerContext ctx = this; EventExecutor currentExecutor = executor(); do &#123; ctx = ctx.prev; // ä¼šè·³è¿‡åªå¤„ç†é‚£äº›å…¥ç«™çš„ handler &#125; while (skipContext(ctx, currentExecutor, mask, MASK_ONLY_OUTBOUND)); return ctx;&#125; 5. ByteToMessageDecoder ä¸è®ºè§£ç å™¨ handler è¿˜æ˜¯ç¼–ç å™¨ handler å³æŽ¥æ”¶çš„æ¶ˆæ¯ç±»åž‹å¿…é¡»ä¸Žå¾…å¤„ç†çš„æ¶ˆæ¯ç±»åž‹ä¸€è‡´ï¼Œå¦åˆ™è¯¥ handler ä¸ä¼šè¢«æ‰§è¡Œ åœ¨è§£ç å™¨è¿›è¡Œæ•°æ®è§£ç æ—¶ï¼Œéœ€è¦åˆ¤æ–­ç¼“å­˜åŒºï¼ˆByteBufï¼‰çš„æ•°æ®æ˜¯å¦è¶³å¤Ÿï¼Œå¦åˆ™æŽ¥æ”¶åˆ°çš„ç»“æžœä¼šæœŸæœ›ç»“æžœå¯èƒ½ä¸ä¸€è‡´ã€‚ 6. è§£ç å™¨ - ReplayingDecoder public abstract class ReplayingDecoder&lt;S&gt; extends ByteToMessageDecoder ReplayingDecoder æ‰©å±•äº† ByteToMessageDecoder ç±»ï¼Œä½¿ç”¨è¿™ä¸ªç±»ï¼Œæˆ‘ä»¬ä¸å¿…è°ƒç”¨ readableBytes() æ–¹æ³•ï¼Œä¹Ÿå°±ä¸ç”¨åˆ¤æ–­è¿˜æœ‰æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®æ¥è¯»å–ã€‚å‚æ•° S æŒ‡å®šäº†ç”¨æˆ·çŠ¶æ€ç®¡ç†çš„ç±»åž‹ï¼Œå…¶ä¸­ Void ä»£è¡¨ä¸éœ€è¦çŠ¶æ€ç®¡ç† åº”ç”¨å®žä¾‹ï¼šä½¿ç”¨ ReplayingDecoder ç¼–å†™è§£ç å™¨ï¼Œå¯¹å‰é¢çš„æ¡ˆä¾‹è¿›è¡Œç®€åŒ–[æ¡ˆä¾‹æ¼”ç¤º] 1234567891011121314151617181920212223242526package com.fyp.netty.inboundhandlerandoutboundhandler;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandlerContext;import io.netty.handler.codec.ByteToMessageDecoder;import io.netty.handler.codec.ReplayingDecoder;import java.util.List;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyByteToLongDecoder2 extends ReplayingDecoder&lt;Void&gt; &#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; System.out.println(&quot;MyByteToLongDecoder2 è¢«è°ƒç”¨&quot;); // åœ¨ ReplayingDecoder ä¸éœ€è¦ åˆ¤æ–­ æ•°æ® æ˜¯å¦è¶³å¤Ÿ è¯»å–ï¼Œå†…éƒ¨ä¼šè¿›è¡Œ å¤„ç†åˆ¤æ–­ out.add(in.readLong()); &#125;&#125; ReplayingDecoderä½¿ç”¨æ–¹ä¾¿ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼š å¹¶ä¸æ˜¯æ‰€æœ‰çš„ ByteBuf æ“ä½œéƒ½è¢«æ”¯æŒï¼Œå¦‚æžœè°ƒç”¨äº†ä¸€ä¸ªä¸è¢«æ”¯æŒçš„æ–¹æ³•ï¼Œå°†ä¼šæŠ›å‡ºä¸€ä¸ª UnsupportedOperationExceptionã€‚ ReplayingDecoder åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ç¨æ…¢äºŽ ByteToMessageDecoderï¼Œä¾‹å¦‚ç½‘ç»œç¼“æ…¢å¹¶ä¸”æ¶ˆæ¯æ ¼å¼å¤æ‚æ—¶ï¼Œæ¶ˆæ¯ä¼šè¢«æ‹†æˆäº†å¤šä¸ªç¢Žç‰‡ï¼Œé€Ÿåº¦å˜æ…¢ 7. å…¶å®ƒç¼–è§£ç å™¨ LineBasedFrameDecoderï¼šè¿™ä¸ªç±»åœ¨ Netty å†…éƒ¨ä¹Ÿæœ‰ä½¿ç”¨ï¼Œå®ƒä½¿ç”¨è¡Œå°¾æŽ§åˆ¶å­—ç¬¦ï¼ˆ\\næˆ–è€…\\r\\nï¼‰ä½œä¸ºåˆ†éš”ç¬¦æ¥è§£æžæ•°æ®ã€‚ DelimiterBasedFrameDecoderï¼šä½¿ç”¨è‡ªå®šä¹‰çš„ç‰¹æ®Šå­—ç¬¦ä½œä¸ºæ¶ˆæ¯çš„åˆ†éš”ç¬¦ã€‚ HttpObjectDecoderï¼šä¸€ä¸ª HTTP æ•°æ®çš„è§£ç å™¨ LengthFieldBasedFrameDecoderï¼šé€šè¿‡æŒ‡å®šé•¿åº¦æ¥æ ‡è¯†æ•´åŒ…æ¶ˆæ¯ï¼Œè¿™æ ·å°±å¯ä»¥è‡ªåŠ¨çš„å¤„ç†é»åŒ…å’ŒåŠåŒ…æ¶ˆæ¯ã€‚ 8. Log4j æ•´åˆåˆ° Netty åœ¨ Maven ä¸­æ·»åŠ å¯¹ Log4j çš„ä¾èµ–åœ¨ pom.xml 12345678910111213141516171819202122&lt;dependency&gt; &lt;groupId&gt;log4j&lt;/groupId&gt; &lt;artifactId&gt;log4j&lt;/artifactId&gt; &lt;version&gt;1.2.17&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-simple&lt;/artifactId&gt; &lt;version&gt;1.7.25&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt; é…ç½® Log4jï¼Œåœ¨ resources/log4j.properties 1234log4j.rootLogger=DEBUG,stdoutlog4j.appender.stdout=org.apache.log4j.ConsoleAppenderlog4j.appender.stdout.layout=org.apache.log4j.PatternLayoutlog4j.appender.stdout.layout.ConversionPattern=[%p]%C&#123;1&#125;-%m%n ä¸‰ã€TCPç²˜åŒ…å’Œæ‹†åŒ…1. TCP ç²˜åŒ…å’Œæ‹†åŒ…åŸºæœ¬ä»‹ç» TCP æ˜¯é¢å‘è¿žæŽ¥çš„ï¼Œé¢å‘æµçš„ï¼Œæä¾›é«˜å¯é æ€§æœåŠ¡ã€‚æ”¶å‘ä¸¤ç«¯ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ï¼‰éƒ½è¦æœ‰ä¸€ä¸€æˆå¯¹çš„ socketï¼Œå› æ­¤ï¼Œå‘é€ç«¯ä¸ºäº†å°†å¤šä¸ªå‘ç»™æŽ¥æ”¶ç«¯çš„åŒ…ï¼Œæ›´æœ‰æ•ˆçš„å‘ç»™å¯¹æ–¹ï¼Œä½¿ç”¨äº†ä¼˜åŒ–æ–¹æ³•ï¼ˆNagle ç®—æ³•ï¼‰ï¼Œå°†å¤šæ¬¡é—´éš”è¾ƒå°ä¸”æ•°æ®é‡å°çš„æ•°æ®ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§çš„æ•°æ®å—ï¼Œç„¶åŽè¿›è¡Œå°åŒ…ã€‚è¿™æ ·åšè™½ç„¶æé«˜äº†æ•ˆçŽ‡ï¼Œä½†æ˜¯æŽ¥æ”¶ç«¯å°±éš¾äºŽåˆ†è¾¨å‡ºå®Œæ•´çš„æ•°æ®åŒ…äº†ï¼Œå› ä¸ºé¢å‘æµçš„é€šä¿¡æ˜¯æ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œçš„ ç”±äºŽ TCP æ— æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œ,éœ€è¦åœ¨æŽ¥æ”¶ç«¯å¤„ç†æ¶ˆæ¯è¾¹ç•Œé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ç²˜åŒ…ã€æ‹†åŒ…é—®é¢˜,çœ‹ä¸€å¼ å›¾ TCP ç²˜åŒ…ã€æ‹†åŒ…å›¾è§£ å‡è®¾å®¢æˆ·ç«¯åˆ†åˆ«å‘é€äº†ä¸¤ä¸ªæ•°æ®åŒ… D1 å’Œ D2 ç»™æœåŠ¡ç«¯ï¼Œç”±äºŽæœåŠ¡ç«¯ä¸€æ¬¡è¯»å–åˆ°å­—èŠ‚æ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œæ•…å¯èƒ½å­˜åœ¨ä»¥ä¸‹å››ç§æƒ…å†µï¼š æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œåˆ†åˆ«æ˜¯ D1 å’Œ D2ï¼Œæ²¡æœ‰ç²˜åŒ…å’Œæ‹†åŒ… æœåŠ¡ç«¯ä¸€æ¬¡æŽ¥å—åˆ°äº†ä¸¤ä¸ªæ•°æ®åŒ…ï¼ŒD1 å’Œ D2 ç²˜åˆåœ¨ä¸€èµ·ï¼Œç§°ä¹‹ä¸º TCP ç²˜åŒ… æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†æ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº†å®Œæ•´çš„ D1 åŒ…å’Œ D2 åŒ…çš„éƒ¨åˆ†å†…å®¹ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº† D2 åŒ…çš„å‰©ä½™å†…å®¹ï¼Œè¿™ç§°ä¹‹ä¸º TCP æ‹†åŒ… æœåŠ¡ç«¯åˆ†ä¸¤æ¬¡è¯»å–åˆ°äº†æ•°æ®åŒ…ï¼Œç¬¬ä¸€æ¬¡è¯»å–åˆ°äº† D1 åŒ…çš„éƒ¨åˆ†å†…å®¹ D1_1ï¼Œç¬¬äºŒæ¬¡è¯»å–åˆ°äº† D1 åŒ…çš„å‰©ä½™éƒ¨åˆ†å†…å®¹ D1_2 å’Œå®Œæ•´çš„ D2 åŒ…ã€‚ 2. TCP ç²˜åŒ…å’Œæ‹†åŒ…çŽ°è±¡å®žä¾‹åœ¨ç¼–å†™ Netty ç¨‹åºæ—¶ï¼Œå¦‚æžœæ²¡æœ‰åšå¤„ç†ï¼Œå°±ä¼šå‘ç”Ÿç²˜åŒ…å’Œæ‹†åŒ…çš„é—®é¢˜ çœ‹ä¸€ä¸ªå…·ä½“çš„å®žä¾‹ï¼š MyServer 12345678910111213141516171819202122232425262728293031323334353637package com.fyp.netty.tcp;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioServerSocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: æˆ‘çš„æœåŠ¡ç«¯ * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new MyServerInitializer()); // è‡ªå®šä¹‰ä¸€ä¸ª åˆå§‹åŒ–ç±» ChannelFuture channelFuture = serverBootstrap.bind(7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; MyServerInitializer 123456789101112131415161718192021package com.fyp.netty.tcp;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new MyServerHandler()); &#125;&#125; MyServerHandler 1234567891011121314151617181920212223242526272829303132333435363738package com.fyp.netty.tcp;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandler;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import java.nio.charset.Charset;import java.util.UUID;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyServerHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; private int count; @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf msg) throws Exception &#123; byte[] buffer = new byte[msg.readableBytes()]; msg.readBytes(buffer); // å°† buffer è½¬æˆ å­—ç¬¦ä¸² String message = new String(buffer, Charset.forName(&quot;UTF-8&quot;)); System.out.println(&quot;æœåŠ¡å™¨æŽ¥æ”¶åˆ°æ•°æ® &quot; + message); System.out.println(&quot;æœåŠ¡å™¨æŽ¥æ”¶åˆ°æ•°æ®é‡= &quot; + (++this.count)); // æœåŠ¡ç«¯ å›žé€æ•°æ® ç»™å®¢æˆ·ç«¯ ï¼Œå›žé€ä¸€ä¸ª éšæœº id ByteBuf responseByteBuf = Unpooled.copiedBuffer(UUID.randomUUID().toString() + &quot;\\n&quot;, Charset.forName(&quot;utf-8&quot;)); ctx.writeAndFlush(responseByteBuf); &#125;&#125; MyClient 1234567891011121314151617181920212223242526272829303132333435363738package com.fyp.netty.tcp;import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioSocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyClient &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group) .channel(NioSocketChannel.class) .handler(new MyClientInitializer()); // è‡ªå®šä¹‰ä¸€ä¸ª åˆå§‹åŒ–ç±» ChannelFuture channelFuture = bootstrap.connect(&quot;localhost&quot;, 7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully(); &#125; &#125;&#125; MyClientInitializer 1234567891011121314151617181920212223package com.fyp.netty.tcp;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyClientInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new MyClientHandler()); &#125;&#125; MyClientHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.fyp.netty.tcp;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandler;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import io.netty.util.CharsetUtil;import java.nio.charset.Charset;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyClientHandler extends SimpleChannelInboundHandler&lt;ByteBuf&gt; &#123; private int count; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; // ä½¿ç”¨ å®¢æˆ·ç«¯ å‘é€ åæ¡ æ•°æ®ï¼Œä»Žè€Œæ¨¡æ‹Ÿ tcp çš„ ç²˜åŒ…å’Œæ‹†åŒ… for (int i = 0; i &lt;10; i++) &#123; ByteBuf buffer = Unpooled.copiedBuffer(&quot;hello,server&quot; + i, Charset.forName(&quot;utf-8&quot;)); ctx.writeAndFlush(buffer); &#125; &#125; @Override protected void channelRead0(ChannelHandlerContext ctx, ByteBuf msg) throws Exception &#123; byte[] buffer = new byte[msg.readableBytes()]; msg.readBytes(buffer); String message = new String(buffer, Charset.forName(&quot;utf-8&quot;)); System.out.println(&quot;å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æ¶ˆæ¯=&quot; + message); System.out.println(&quot;å®¢æˆ·ç«¯æŽ¥å—æ¶ˆæ¯æ•°æ®= &quot; + (++this.count)); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; 3. TCP ç²˜åŒ…å’Œæ‹†åŒ…è§£å†³æ–¹æ¡ˆ å¸¸ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨è‡ªå®šä¹‰åè®®+ç¼–è§£ç å™¨æ¥è§£å†³ å…³é”®å°±æ˜¯è¦è§£å†³æœåŠ¡å™¨ç«¯æ¯æ¬¡è¯»å–æ•°æ®é•¿åº¦çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜è§£å†³ï¼Œå°±ä¸ä¼šå‡ºçŽ°æœåŠ¡å™¨å¤šè¯»æˆ–å°‘è¯»æ•°æ®çš„é—®é¢˜ï¼Œä»Žè€Œé¿å…çš„ TCP ç²˜åŒ…ã€æ‹†åŒ…ã€‚ çœ‹ä¸€ä¸ªå…·ä½“çš„å®žä¾‹ è¦æ±‚å®¢æˆ·ç«¯å‘é€ 5 ä¸ª Message å¯¹è±¡ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡å‘é€ä¸€ä¸ª Message å¯¹è±¡ æœåŠ¡å™¨ç«¯æ¯æ¬¡æŽ¥æ”¶ä¸€ä¸ª Messageï¼Œåˆ† 5 æ¬¡è¿›è¡Œè§£ç ï¼Œæ¯è¯»å–åˆ°ä¸€ä¸ª Messageï¼Œä¼šå›žå¤ä¸€ä¸ª Message å¯¹è±¡ç»™å®¢æˆ·ç«¯ã€‚ MessageProtoco 123456789101112131415161718192021222324252627282930package com.fyp.netty.protocoltcp;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: åè®®åŒ… * @Package: com.fyp.netty.protocoltcp * @Version: 1.0 */public class MessageProtocol &#123; private int len; private byte[] content; public int getLen() &#123; return len; &#125; public void setLen(int len) &#123; this.len = len; &#125; public byte[] getContent() &#123; return content; &#125; public void setContent(byte[] content) &#123; this.content = content; &#125;&#125; MyServer 12345678910111213141516171819202122232425262728293031323334353637package com.fyp.netty.protocoltcp;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioServerSocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: æˆ‘çš„æœåŠ¡ç«¯ * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .childHandler(new MyServerInitializer()); // è‡ªå®šä¹‰ä¸€ä¸ª åˆå§‹åŒ–ç±» ChannelFuture channelFuture = serverBootstrap.bind(7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; MyServerInitializer 123456789101112131415161718192021222324package com.fyp.netty.protocoltcp;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new MyMessageDecoder()); pipeline.addLast(new MyMessageEncoder()); pipeline.addLast(new MyServerHandler()); &#125;&#125; MyServerHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.fyp.netty.protocoltcp;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import java.nio.charset.Charset;import java.util.UUID;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyServerHandler extends SimpleChannelInboundHandler&lt;MessageProtocol&gt; &#123; private int count; @Override protected void channelRead0(ChannelHandlerContext ctx, MessageProtocol msg) throws Exception &#123; //æŽ¥æ”¶åˆ°æ•°æ®ï¼Œå¹¶å¤„ç† int len = msg.getLen(); byte[] content = msg.getContent(); System.out.println(&quot;æœåŠ¡å™¨æŽ¥æ”¶åˆ°ä¿¡æ¯å¦‚ä¸‹&quot;); System.out.println(&quot;é•¿åº¦=&quot; + len); System.out.println(&quot;å†…å®¹=&quot; + new String(content, Charset.forName(&quot;utf-8&quot;))); System.out.println(&quot;æœåŠ¡å™¨æŽ¥æ”¶åˆ°æ¶ˆæ¯åŒ…æ•°é‡=&quot; + (++this.count)); //å›žå¤æ¶ˆæ¯ System.out.println(&quot;æœåŠ¡ç«¯å¼€å§‹å›žå¤æ¶ˆæ¯------&quot;); String responseContent = UUID.randomUUID().toString(); int responseLen = responseContent.getBytes(&quot;utf-8&quot;).length; byte[] responseContent2 = responseContent.getBytes(&quot;utf-8&quot;); //æž„å»ºä¸€ä¸ªåè®®åŒ… MessageProtocol messageProtocol = new MessageProtocol(); messageProtocol.setLen(responseLen); messageProtocol.setContent(responseContent2); ctx.writeAndFlush(messageProtocol); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; //cause.printStackTrace(); ctx.close(); &#125;&#125; MyMessageDecoder 123456789101112131415161718192021222324252627282930313233343536373839package com.fyp.netty.protocoltcp;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandlerContext;import io.netty.handler.codec.ReplayingDecoder;import java.util.List;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.protocoltcp * @Version: 1.0 */public class MyMessageDecoder extends ReplayingDecoder&lt;Void&gt; &#123; @Override protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123; System.out.println(&quot;MyMessageDecoder decode è¢«è°ƒç”¨&quot;); // éœ€è¦ å°† äºŒè¿›åˆ¶ å­—èŠ‚ç  -&gt; MessageProtocol æ•°æ®åŒ…ï¼ˆå¯¹è±¡ï¼‰ /** * èŽ·å– æ˜¯ åœ¨ ä¹‹å‰çš„ ç¼–ç å™¨å†™å…¥çš„ int å’Œ byte ç±»åž‹æ•°æ® * out.writeInt(msg.getLen()); * out.writeBytes(msg.getContent()); */ int length = in.readInt(); byte[] content = new byte[length]; in.readBytes(content); MessageProtocol messageProtocol = new MessageProtocol(); messageProtocol.setLen(length); messageProtocol.setContent(content); out.add(messageProtocol); &#125;&#125; MyClient 1234567891011121314151617181920212223242526272829303132333435363738package com.fyp.netty.protocoltcp;import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioSocketChannel;/** * @Auther: fyp * @Date: 2022/2/16 * @Description: * @Package: com.fyp.netty.inboundhandlerandoutboundhandler * @Version: 1.0 */public class MyClient &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap bootstrap = new Bootstrap(); bootstrap.group(group) .channel(NioSocketChannel.class) .handler(new MyClientInitializer()); // è‡ªå®šä¹‰ä¸€ä¸ª åˆå§‹åŒ–ç±» ChannelFuture channelFuture = bootstrap.connect(&quot;localhost&quot;, 7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully(); &#125; &#125;&#125; MyClientInitializer 1234567891011121314151617181920212223242526package com.fyp.netty.protocoltcp;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyClientInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(new MyMessageEncoder()); pipeline.addLast(new MyMessageDecoder()); pipeline.addLast(new MyClientHandler()); &#125;&#125; MyClientHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package com.fyp.netty.protocoltcp;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import java.nio.charset.Charset;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.tcp * @Version: 1.0 */public class MyClientHandler extends SimpleChannelInboundHandler&lt;MessageProtocol&gt; &#123; private int count; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; // ä½¿ç”¨å®¢æˆ·ç«¯ å‘é€åæ¡æ•°æ®ï¼Œä»Šå¤©å¤©æ°”å†·ï¼Œåƒç«é”… for (int i = 0; i &lt; 5; i++) &#123; String mes = &quot;abc&quot;; byte[] content = mes.getBytes(Charset.forName(&quot;utf-8&quot;)); int length = content.length; // åˆ›å»º åè®®åŒ… å¯¹è±¡ MessageProtocol messageProtocol = new MessageProtocol(); messageProtocol.setLen(length); messageProtocol.setContent(content); ctx.writeAndFlush(messageProtocol); &#125; &#125; @Override protected void channelRead0(ChannelHandlerContext ctx, MessageProtocol msg) throws Exception &#123; int len = msg.getLen(); byte[] content = msg.getContent(); System.out.println(&quot;å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æ¶ˆæ¯å¦‚ä¸‹&quot;); System.out.println(&quot;é•¿åº¦=&quot; + len); System.out.println(&quot;å†…å®¹=&quot; + new String(content, Charset.forName(&quot;utf-8&quot;))); System.out.println(&quot;å®¢æˆ·ç«¯æŽ¥æ”¶æ¶ˆæ¯æ•°é‡=&quot; + (++this.count)); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; System.out.println(&quot;å¼‚å¸¸æé†’=&quot; + cause.getMessage()); ctx.close(); &#125;&#125; MyMessageEncoder 1234567891011121314151617181920212223package com.fyp.netty.protocoltcp;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandlerContext;import io.netty.handler.codec.MessageToByteEncoder;/** * @Auther: fyp * @Date: 2022/2/17 * @Description: * @Package: com.fyp.netty.protocoltcp * @Version: 1.0 */public class MyMessageEncoder extends MessageToByteEncoder&lt;MessageProtocol&gt; &#123; @Override protected void encode(ChannelHandlerContext ctx, MessageProtocol msg, ByteBuf out) throws Exception &#123; System.out.println(&quot;MyMessageEncoder encode æ–¹æ³• è¢«è°ƒç”¨&quot;); out.writeInt(msg.getLen()); out.writeBytes(msg.getContent()); &#125;&#125; å››ã€Nettyå®žçŽ°RPC1. RPC åŸºæœ¬ä»‹ç» RPCï¼ˆRemote Procedure Callï¼‰â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡ŒäºŽä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ ä¸¤ä¸ªæˆ–å¤šä¸ªåº”ç”¨ç¨‹åºéƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨éƒ½åƒæ˜¯æœ¬åœ°æ–¹æ³•è°ƒç”¨ä¸€æ ·(å¦‚å›¾) è¿‡ç¨‹ï¼š è°ƒç”¨è€…(Caller)ï¼Œè°ƒç”¨è¿œç¨‹API(Remote API) è°ƒç”¨è¿œç¨‹APIä¼šé€šè¿‡ä¸€ä¸ªRPCä»£ç†(RpcProxy) RPCä»£ç†å†åŽ»è°ƒç”¨RpcInvoker(è¿™ä¸ªæ˜¯PRCçš„è°ƒç”¨è€…) RpcInvokeré€šè¿‡RPCè¿žæŽ¥å™¨(RpcConnector) RPCè¿žæŽ¥å™¨ç”¨ä¸¤å°æœºå™¨è§„å®šå¥½çš„PRCåè®®(RpcProtocol)æŠŠæ•°æ®è¿›è¡Œç¼–ç  æŽ¥ç€RPCè¿žæŽ¥å™¨é€šè¿‡RpcChannelé€šé“å‘é€åˆ°å¯¹æ–¹çš„PRCæŽ¥æ”¶å™¨(RpcAcceptor) PRCæŽ¥æ”¶å™¨é€šè¿‡PRCåè®®è¿›è¡Œè§£ç æ‹¿åˆ°æ•°æ® ç„¶åŽå°†æ•°æ®ä¼ ç»™RpcProcessor RpcProcessorå†ä¼ ç»™RpcInvoker RpcInvokerè°ƒç”¨Remote API æœ€åŽæŽ¨ç»™è¢«è°ƒç”¨è€…(Callee) å¸¸è§çš„ RPC æ¡†æž¶æœ‰ï¼šæ¯”è¾ƒçŸ¥åçš„å¦‚é˜¿é‡Œçš„ Dubboã€Google çš„ gRPCã€Go è¯­è¨€çš„ rpcxã€Apache çš„ thriftï¼ŒSpring æ——ä¸‹çš„ SpringCloudã€‚ 2. æˆ‘ä»¬çš„RPC è°ƒç”¨æµç¨‹å›¾ RPC è°ƒç”¨æµç¨‹è¯´æ˜Ž æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆclientï¼‰ä»¥æœ¬åœ°è°ƒç”¨æ–¹å¼è°ƒç”¨æœåŠ¡ client stub æŽ¥æ”¶åˆ°è°ƒç”¨åŽè´Ÿè´£å°†æ–¹æ³•ã€å‚æ•°ç­‰å°è£…æˆèƒ½å¤Ÿè¿›è¡Œç½‘ç»œä¼ è¾“çš„æ¶ˆæ¯ä½“ client stub å°†æ¶ˆæ¯è¿›è¡Œç¼–ç å¹¶å‘é€åˆ°æœåŠ¡ç«¯ server stub æ”¶åˆ°æ¶ˆæ¯åŽè¿›è¡Œè§£ç  server stub æ ¹æ®è§£ç ç»“æžœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡ æœ¬åœ°æœåŠ¡æ‰§è¡Œå¹¶å°†ç»“æžœè¿”å›žç»™ server stub server stub å°†è¿”å›žå¯¼å…¥ç»“æžœè¿›è¡Œç¼–ç å¹¶å‘é€è‡³æ¶ˆè´¹æ–¹ client stub æŽ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œè§£ç  æœåŠ¡æ¶ˆè´¹æ–¹ï¼ˆclientï¼‰å¾—åˆ°ç»“æžœ å°ç»“ï¼šRPC çš„ç›®æ ‡å°±æ˜¯å°† 2 - 8 è¿™äº›æ­¥éª¤éƒ½å°è£…èµ·æ¥ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒè¿™äº›ç»†èŠ‚ï¼Œå¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·å³å¯å®Œæˆè¿œç¨‹æœåŠ¡è°ƒç”¨ 3. å·±å®žçŽ° Dubbo RPCï¼ˆåŸºäºŽ Nettyï¼‰éœ€æ±‚è¯´æ˜Ž Dubbo åº•å±‚ä½¿ç”¨äº† Netty ä½œä¸ºç½‘ç»œé€šè®¯æ¡†æž¶ï¼Œè¦æ±‚ç”¨ Netty å®žçŽ°ä¸€ä¸ªç®€å•çš„ RPC æ¡†æž¶ æ¨¡ä»¿ Dubboï¼Œæ¶ˆè´¹è€…å’Œæä¾›è€…çº¦å®šæŽ¥å£å’Œåè®®ï¼Œæ¶ˆè´¹è€…è¿œç¨‹è°ƒç”¨æä¾›è€…çš„æœåŠ¡ï¼Œæä¾›è€…è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¶ˆè´¹è€…æ‰“å°æä¾›è€…è¿”å›žçš„æ•°æ®ã€‚åº•å±‚ç½‘ç»œé€šä¿¡ä½¿ç”¨ Netty 4.1.20 è®¾è®¡è¯´æ˜Ž åˆ›å»ºä¸€ä¸ªæŽ¥å£ï¼Œå®šä¹‰æŠ½è±¡æ–¹æ³•ã€‚ç”¨äºŽæ¶ˆè´¹è€…å’Œæä¾›è€…ä¹‹é—´çš„çº¦å®šã€‚ åˆ›å»ºä¸€ä¸ªæä¾›è€…ï¼Œè¯¥ç±»éœ€è¦ç›‘å¬æ¶ˆè´¹è€…çš„è¯·æ±‚ï¼Œå¹¶æŒ‰ç…§çº¦å®šè¿”å›žæ•°æ®ã€‚ åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œè¯¥ç±»éœ€è¦é€æ˜Žçš„è°ƒç”¨è‡ªå·±ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå†…éƒ¨éœ€è¦ä½¿ç”¨ Netty è¯·æ±‚æä¾›è€…è¿”å›žæ•°æ® å¼€å‘çš„åˆ†æžå›¾ ä½¿ç”¨rpcæ¡†æž¶æ‰“åŒ…æ—¶ï¼Œå¦‚æžœæ˜¯ç”¨çš„æ˜¯å…¨å±€åº“ï¼Œæ‰“åŒ…ä¼šæ‰¾ä¸åˆ°nettyçš„jaråŒ…ï¼Œéœ€è¦é€šè¿‡mavenå¼•å…¥çš„æ–¹å¼æ‰“åŒ…","categories":[{"name":"Javaæ¡†æž¶","slug":"Javaæ¡†æž¶","permalink":"http://fyupeng.github.io/categories/Java%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"netty","slug":"netty","permalink":"http://fyupeng.github.io/tags/netty/"}],"author":"fyupeng"},{"title":"Netty å…¥é—¨ - 02","slug":"Netty02","date":"2022-06-25T07:04:09.000Z","updated":"2022-06-25T07:09:33.572Z","comments":true,"path":"2022/06/25/Netty02/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/Netty02/","excerpt":"","text":"Nettyå…¥é—¨02 ä¸€ã€Netty æ¦‚è¿°1. åŽŸç”Ÿ NIO å­˜åœ¨çš„é—®é¢˜ NIO çš„ç±»åº“å’Œ API ç¹æ‚ï¼Œä½¿ç”¨éº»çƒ¦ï¼šéœ€è¦ç†Ÿç»ƒæŽŒæ¡ Selectorã€ServerSocketChannelã€SocketChannelã€ByteBufferç­‰ã€‚ éœ€è¦å…·å¤‡å…¶ä»–çš„é¢å¤–æŠ€èƒ½ï¼šè¦ç†Ÿæ‚‰ Java å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå› ä¸º NIO ç¼–ç¨‹æ¶‰åŠåˆ° Reactor æ¨¡å¼ï¼Œä½ å¿…é¡»å¯¹å¤šçº¿ç¨‹å’Œç½‘ç»œç¼–ç¨‹éžå¸¸ç†Ÿæ‚‰ï¼Œæ‰èƒ½ç¼–å†™å‡ºé«˜è´¨é‡çš„ NIO ç¨‹åºã€‚ å¼€å‘å·¥ä½œé‡å’Œéš¾åº¦éƒ½éžå¸¸å¤§ï¼šä¾‹å¦‚å®¢æˆ·ç«¯é¢ä¸´æ–­è¿žé‡è¿žã€ç½‘ç»œé—ªæ–­ã€åŠåŒ…è¯»å†™ã€å¤±è´¥ç¼“å­˜ã€ç½‘ç»œæ‹¥å¡žå’Œå¼‚å¸¸æµçš„å¤„ç†ç­‰ç­‰ã€‚ JDK NIO çš„ Bugï¼šä¾‹å¦‚è‡­åæ˜­è‘—çš„ Epoll Bugï¼Œå®ƒä¼šå¯¼è‡´ Selector ç©ºè½®è¯¢ï¼Œæœ€ç»ˆå¯¼è‡´ CPU100%ã€‚ç›´åˆ° JDK1.7 ç‰ˆæœ¬è¯¥é—®é¢˜ä»æ—§å­˜åœ¨ï¼Œæ²¡æœ‰è¢«æ ¹æœ¬è§£å†³ã€‚ 2. Netty å®˜ç½‘è¯´æ˜Žå®˜ç½‘ï¼šhttps://netty.io/ Netty is an asynchronous event-driven network application framework for rapid development of maintainable high performance protocol servers &amp; clients. 3. Netty çš„ä¼˜ç‚¹Netty å¯¹ JDK è‡ªå¸¦çš„ NIO çš„ API è¿›è¡Œäº†å°è£…ï¼Œè§£å†³äº†ä¸Šè¿°é—®é¢˜ã€‚ è®¾è®¡ä¼˜é›…ï¼šé€‚ç”¨äºŽå„ç§ä¼ è¾“ç±»åž‹çš„ç»Ÿä¸€ API é˜»å¡žå’Œéžé˜»å¡ž Socketï¼›åŸºäºŽçµæ´»ä¸”å¯æ‰©å±•çš„äº‹ä»¶æ¨¡åž‹ï¼Œå¯ä»¥æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ï¼›é«˜åº¦å¯å®šåˆ¶çš„çº¿ç¨‹æ¨¡åž‹-å•çº¿ç¨‹ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹æ± ã€‚ ä½¿ç”¨æ–¹ä¾¿ï¼šè¯¦ç»†è®°å½•çš„ Javadocï¼Œç”¨æˆ·æŒ‡å—å’Œç¤ºä¾‹ï¼›æ²¡æœ‰å…¶ä»–ä¾èµ–é¡¹ï¼ŒJDK5ï¼ˆNetty3.xï¼‰æˆ– 6ï¼ˆNetty4.xï¼‰å°±è¶³å¤Ÿäº†ã€‚ é«˜æ€§èƒ½ã€åžåé‡æ›´é«˜ï¼šå»¶è¿Ÿæ›´ä½Žï¼›å‡å°‘èµ„æºæ¶ˆè€—ï¼›æœ€å°åŒ–ä¸å¿…è¦çš„å†…å­˜å¤åˆ¶ã€‚ å®‰å…¨ï¼šå®Œæ•´çš„ SSL/TLS å’Œ StartTLS æ”¯æŒã€‚ ç¤¾åŒºæ´»è·ƒã€ä¸æ–­æ›´æ–°ï¼šç¤¾åŒºæ´»è·ƒï¼Œç‰ˆæœ¬è¿­ä»£å‘¨æœŸçŸ­ï¼Œå‘çŽ°çš„ Bug å¯ä»¥è¢«åŠæ—¶ä¿®å¤ï¼ŒåŒæ—¶ï¼Œæ›´å¤šçš„æ–°åŠŸèƒ½ä¼šè¢«åŠ å…¥ã€‚ 4. Netty ç‰ˆæœ¬è¯´æ˜Ž Netty ç‰ˆæœ¬åˆ†ä¸º Netty 3.x å’Œ Netty 4.xã€Netty 5.x å› ä¸º Netty 5 å‡ºçŽ°é‡å¤§ bugï¼Œå·²ç»è¢«å®˜ç½‘åºŸå¼ƒäº†ï¼Œç›®å‰æŽ¨èä½¿ç”¨çš„æ˜¯ Netty 4.xçš„ç¨³å®šç‰ˆæœ¬ ç›®å‰åœ¨å®˜ç½‘å¯ä¸‹è½½çš„ç‰ˆæœ¬ Netty 3.xã€Netty 4.0.x å’Œ Netty 4.1.x åœ¨æœ¬å¥—è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬è®²è§£ Netty4.1.x ç‰ˆæœ¬ Netty ä¸‹è½½åœ°å€ï¼šhttps://bintray.com/netty/downloads/netty/ 5. Netty Maven ä¸‹è½½5.1 é€šè¿‡å®˜ç½‘ä¸‹è½½ç‚¹å‡»è¿›å…¥ Project Structure ç‚¹å‡»Library æ·»åŠ Library From Maven è¾“å…¥ io.netty:netty-all:4.1.20.Final åŽæŸ¥æ‰¾ 5.2 é€šè¿‡ maven12345&lt;dependency&gt; &lt;groupId&gt;io.netty&lt;/groupId&gt; &lt;artifactId&gt;netty-all&lt;/artifactId&gt; &lt;version&gt;$&#123;netty.version&#125;&lt;/version&gt;&lt;/dependency&gt; äºŒã€Netty é«˜æ€§èƒ½æž¶æž„è®¾è®¡1. çº¿ç¨‹æ¨¡åž‹åŸºæœ¬ä»‹ç» ä¸åŒçš„çº¿ç¨‹æ¨¡å¼ï¼Œå¯¹ç¨‹åºçš„æ€§èƒ½æœ‰å¾ˆå¤§å½±å“ï¼Œä¸ºäº†æžæ¸… Netty çº¿ç¨‹æ¨¡å¼ï¼Œæˆ‘ä»¬æ¥ç³»ç»Ÿçš„è®²è§£ä¸‹å„ä¸ªçº¿ç¨‹æ¨¡å¼ï¼Œæœ€åŽçœ‹çœ‹ Netty çº¿ç¨‹æ¨¡åž‹æœ‰ä»€ä¹ˆä¼˜è¶Šæ€§ã€‚ ç›®å‰å­˜åœ¨çš„çº¿ç¨‹æ¨¡åž‹æœ‰ï¼šä¼ ç»Ÿé˜»å¡ž I/O æœåŠ¡æ¨¡åž‹ å’ŒReactor æ¨¡å¼ æ ¹æ®Reactorçš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰3ç§å…¸åž‹çš„å®žçŽ° å• Reactor å•çº¿ç¨‹ï¼› å• Reactorå¤šçº¿ç¨‹ï¼› ä¸»ä»Ž Reactorå¤šçº¿ç¨‹ Netty çº¿ç¨‹æ¨¡å¼ï¼ˆNetty ä¸»è¦åŸºäºŽä¸»ä»Ž Reactor å¤šçº¿ç¨‹æ¨¡åž‹åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä»Ž Reactor å¤šçº¿ç¨‹æ¨¡åž‹æœ‰å¤šä¸ª Reactorï¼‰ 2. ä¼ ç»Ÿé˜»å¡ž I/O æœåŠ¡æ¨¡åž‹å·¥ä½œåŽŸç†å›¾ é»„è‰²çš„æ¡†è¡¨ç¤ºå¯¹è±¡ï¼Œè“è‰²çš„æ¡†è¡¨ç¤ºçº¿ç¨‹ ç™½è‰²çš„æ¡†è¡¨ç¤ºæ–¹æ³•ï¼ˆAPIï¼‰ æ¨¡åž‹ç‰¹ç‚¹ é‡‡ç”¨é˜»å¡ž IO æ¨¡å¼èŽ·å–è¾“å…¥çš„æ•°æ® æ¯ä¸ªè¿žæŽ¥éƒ½éœ€è¦ç‹¬ç«‹çš„çº¿ç¨‹å®Œæˆæ•°æ®çš„è¾“å…¥ï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ®è¿”å›ž é—®é¢˜åˆ†æž å½“å¹¶å‘æ•°å¾ˆå¤§ï¼Œå°±ä¼šåˆ›å»ºå¤§é‡çš„çº¿ç¨‹ï¼Œå ç”¨å¾ˆå¤§ç³»ç»Ÿèµ„æº è¿žæŽ¥åˆ›å»ºåŽï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œè¯¥çº¿ç¨‹ä¼šé˜»å¡žåœ¨ Handlerå¯¹è±¡ä¸­çš„read æ“ä½œï¼Œå¯¼è‡´ä¸Šé¢çš„å¤„ç†çº¿ç¨‹èµ„æºæµªè´¹ 3. Reactor æ¨¡å¼é’ˆå¯¹ä¼ ç»Ÿé˜»å¡ž I/O æœåŠ¡æ¨¡åž‹çš„ 2 ä¸ªç¼ºç‚¹ï¼Œè§£å†³æ–¹æ¡ˆï¼šåŸºäºŽ I/O å¤ç”¨æ¨¡åž‹ï¼šå¤šä¸ªè¿žæŽ¥å…±ç”¨ä¸€ä¸ªé˜»å¡žå¯¹è±¡ServiceHandlerï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦åœ¨ä¸€ä¸ªé˜»å¡žå¯¹è±¡ç­‰å¾…ï¼Œæ— éœ€é˜»å¡žç­‰å¾…æ‰€æœ‰è¿žæŽ¥ã€‚å½“æŸä¸ªè¿žæŽ¥æœ‰æ–°çš„æ•°æ®å¯ä»¥å¤„ç†æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šçŸ¥åº”ç”¨ç¨‹åºï¼Œçº¿ç¨‹ä»Žé˜»å¡žçŠ¶æ€è¿”å›žï¼Œå¼€å§‹è¿›è¡Œä¸šåŠ¡å¤„ç†ã€‚ Reactor åœ¨ä¸åŒä¹¦ä¸­çš„å«æ³•ï¼š ååº”å™¨æ¨¡å¼ åˆ†å‘è€…æ¨¡å¼ï¼ˆDispatcherï¼‰ é€šçŸ¥è€…æ¨¡å¼ï¼ˆnotifierï¼‰ åŸºäºŽçº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹èµ„æºï¼šä¸å¿…å†ä¸ºæ¯ä¸ªè¿žæŽ¥åˆ›å»ºçº¿ç¨‹ï¼Œå°†è¿žæŽ¥å®ŒæˆåŽçš„ä¸šåŠ¡å¤„ç†ä»»åŠ¡åˆ†é…ç»™çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤„ç†å¤šä¸ªè¿žæŽ¥çš„ä¸šåŠ¡ã€‚ï¼ˆè§£å†³äº†å½“å¹¶å‘æ•°å¾ˆå¤§æ—¶ï¼Œä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œå ç”¨å¾ˆå¤§ç³»ç»Ÿèµ„æºï¼‰ åŸºäºŽ I/O å¤ç”¨æ¨¡åž‹ï¼šå¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿žæŽ¥ï¼Œå…ˆæŠŠè¿žæŽ¥è¯·æ±‚ç»™ServiceHandlerã€‚å¤šä¸ªè¿žæŽ¥å…±ç”¨ä¸€ä¸ªé˜»å¡žå¯¹è±¡ServiceHandlerã€‚å‡è®¾ï¼Œå½“C1è¿žæŽ¥æ²¡æœ‰æ•°æ®è¦å¤„ç†æ—¶ï¼ŒC1å®¢æˆ·ç«¯åªéœ€è¦é˜»å¡žäºŽServiceHandlerï¼ŒC1ä¹‹å‰çš„å¤„ç†çº¿ç¨‹ä¾¿å¯ä»¥å¤„ç†å…¶ä»–æœ‰æ•°æ®çš„è¿žæŽ¥ï¼Œä¸ä¼šé€ æˆçº¿ç¨‹èµ„æºçš„æµªè´¹ã€‚å½“C1è¿žæŽ¥å†æ¬¡æœ‰æ•°æ®æ—¶ï¼ŒServiceHandleræ ¹æ®çº¿ç¨‹æ± çš„ç©ºé—²çŠ¶æ€ï¼Œå°†è¯·æ±‚åˆ†å‘ç»™ç©ºé—²çš„çº¿ç¨‹æ¥å¤„ç†C1è¿žæŽ¥çš„ä»»åŠ¡ã€‚ï¼ˆè§£å†³äº†çº¿ç¨‹èµ„æºæµªè´¹çš„é‚£ä¸ªé—®é¢˜ï¼‰ I/O å¤ç”¨ç»“åˆçº¿ç¨‹æ± ï¼Œå°±æ˜¯ Reactor æ¨¡å¼åŸºæœ¬è®¾è®¡æ€æƒ³ï¼Œå¦‚å›¾å¯¹ä¸Šå›¾è¯´æ˜Žï¼š Reactor æ¨¡å¼ï¼Œé€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥åŒæ—¶ä¼ é€’ç»™æœåŠ¡å¤„ç†å™¨ï¼ˆServiceHandlerï¼‰çš„æ¨¡å¼ï¼ˆåŸºäºŽäº‹ä»¶é©±åŠ¨ï¼‰ æœåŠ¡å™¨ç«¯ç¨‹åºå¤„ç†ä¼ å…¥çš„å¤šä¸ªè¯·æ±‚,å¹¶å°†å®ƒä»¬åŒæ­¥åˆ†æ´¾åˆ°ç›¸åº”çš„å¤„ç†çº¿ç¨‹ï¼Œå› æ­¤ Reactor æ¨¡å¼ä¹Ÿå« Dispatcher æ¨¡å¼ Reactor æ¨¡å¼ä½¿ç”¨ IO å¤ç”¨ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åŽï¼Œåˆ†å‘ç»™æŸä¸ªçº¿ç¨‹ï¼ˆè¿›ç¨‹ï¼‰ï¼Œè¿™ç‚¹å°±æ˜¯ç½‘ç»œæœåŠ¡å™¨é«˜å¹¶å‘å¤„ç†å…³é”® åŽŸå…ˆæœ‰å¤šä¸ªHandleré˜»å¡žï¼ŒçŽ°åœ¨åªç”¨ä¸€ä¸ªServiceHandleré˜»å¡ž Reactor æ¨¡å¼ä¸­æ ¸å¿ƒç»„æˆ Reactorï¼ˆä¹Ÿå°±æ˜¯é‚£ä¸ªServiceHandlerï¼‰ï¼šReactor åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œè´Ÿè´£ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼Œåˆ†å‘ç»™é€‚å½“çš„å¤„ç†çº¿ç¨‹æ¥å¯¹ IO äº‹ä»¶åšå‡ºååº”ã€‚å®ƒå°±åƒå…¬å¸çš„ç”µè¯æŽ¥çº¿å‘˜ï¼Œå®ƒæŽ¥å¬æ¥è‡ªå®¢æˆ·çš„ç”µè¯å¹¶å°†çº¿è·¯è½¬ç§»åˆ°é€‚å½“çš„è”ç³»äººï¼› Handlersï¼ˆå¤„ç†çº¿ç¨‹EventHandlerï¼‰ï¼šå¤„ç†çº¿ç¨‹æ‰§è¡Œ I/O äº‹ä»¶è¦å®Œæˆçš„å®žé™…äº‹ä»¶ï¼Œç±»ä¼¼äºŽå®¢æˆ·æƒ³è¦ä¸Žä¹‹äº¤è°ˆçš„å…¬å¸ä¸­çš„å®žé™…å®˜å‘˜ã€‚Reactor é€šè¿‡è°ƒåº¦é€‚å½“çš„å¤„ç†çº¿ç¨‹æ¥å“åº” I/O äº‹ä»¶ï¼Œå¤„ç†ç¨‹åºæ‰§è¡Œéžé˜»å¡žæ“ä½œã€‚ Reactor æ¨¡å¼åˆ†ç±»æ ¹æ® Reactor çš„æ•°é‡å’Œå¤„ç†èµ„æºæ± çº¿ç¨‹çš„æ•°é‡ä¸åŒï¼Œæœ‰ 3 ç§å…¸åž‹çš„å®žçŽ° å• Reactor å•çº¿ç¨‹ å• Reactor å¤šçº¿ç¨‹ ä¸»ä»Ž Reactor å¤šçº¿ç¨‹ 4. å• Reactor å•çº¿ç¨‹åŽŸç†å›¾ï¼Œå¹¶ä½¿ç”¨ NIO ç¾¤èŠç³»ç»ŸéªŒè¯ æ–¹æ¡ˆè¯´æ˜Ž Select æ˜¯å‰é¢ I/O å¤ç”¨æ¨¡åž‹ä»‹ç»çš„æ ‡å‡†ç½‘ç»œç¼–ç¨‹ APIï¼Œå¯ä»¥å®žçŽ°åº”ç”¨ç¨‹åºé€šè¿‡ä¸€ä¸ªé˜»å¡žå¯¹è±¡ç›‘å¬å¤šè·¯è¿žæŽ¥è¯·æ±‚ Reactor å¯¹è±¡é€šè¿‡ Select ç›‘æŽ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åŽé€šè¿‡ Dispatch è¿›è¡Œåˆ†å‘ å¦‚æžœæ˜¯å»ºç«‹è¿žæŽ¥è¯·æ±‚äº‹ä»¶ï¼Œåˆ™ç”± Acceptor é€šè¿‡ Accept å¤„ç†è¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡å¤„ç†è¿žæŽ¥å®ŒæˆåŽçš„åŽç»­ä¸šåŠ¡å¤„ç† å¦‚æžœä¸æ˜¯å»ºç«‹è¿žæŽ¥äº‹ä»¶ï¼Œåˆ™ Reactor ä¼šåˆ†å‘è°ƒç”¨è¿žæŽ¥å¯¹åº”çš„ Handler æ¥å“åº” Handler ä¼šå®Œæˆ Read â†’ ä¸šåŠ¡å¤„ç† â†’ Send çš„å®Œæ•´ä¸šåŠ¡æµç¨‹ ç»“åˆå®žä¾‹ï¼šæœåŠ¡å™¨ç«¯ç”¨ä¸€ä¸ªçº¿ç¨‹é€šè¿‡å¤šè·¯å¤ç”¨æžå®šæ‰€æœ‰çš„ IO æ“ä½œï¼ˆåŒ…æ‹¬è¿žæŽ¥ï¼Œè¯»ã€å†™ç­‰ï¼‰ï¼Œç¼–ç ç®€å•ï¼Œæ¸…æ™°æ˜Žäº†ï¼Œä½†æ˜¯å¦‚æžœå®¢æˆ·ç«¯è¿žæŽ¥æ•°é‡è¾ƒå¤šï¼Œå°†æ— æ³•æ”¯æ’‘ï¼Œå‰é¢çš„ NIO æ¡ˆä¾‹å°±å±žäºŽè¿™ç§æ¨¡åž‹ã€‚ æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æž ä¼˜ç‚¹ï¼šæ¨¡åž‹ç®€å•ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹ã€è¿›ç¨‹é€šä¿¡ã€ç«žäº‰çš„é—®é¢˜ï¼Œå…¨éƒ¨éƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆ ç¼ºç‚¹ï¼šæ€§èƒ½é—®é¢˜ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œæ— æ³•å®Œå…¨å‘æŒ¥å¤šæ ¸ CPU çš„æ€§èƒ½ã€‚Handleråœ¨å¤„ç†æŸä¸ªè¿žæŽ¥ä¸Šçš„ä¸šåŠ¡æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ— æ³•å¤„ç†å…¶ä»–è¿žæŽ¥äº‹ä»¶ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ€§èƒ½ç“¶é¢ˆ ç¼ºç‚¹ï¼šå¯é æ€§é—®é¢˜ï¼Œçº¿ç¨‹æ„å¤–ç»ˆæ­¢ï¼Œæˆ–è€…è¿›å…¥æ­»å¾ªçŽ¯ï¼Œä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿé€šä¿¡æ¨¡å—ä¸å¯ç”¨ï¼Œä¸èƒ½æŽ¥æ”¶å’Œå¤„ç†å¤–éƒ¨æ¶ˆæ¯ï¼Œé€ æˆèŠ‚ç‚¹æ•…éšœ ä½¿ç”¨åœºæ™¯ï¼šå®¢æˆ·ç«¯çš„æ•°é‡æœ‰é™ï¼Œä¸šåŠ¡å¤„ç†éžå¸¸å¿«é€Ÿï¼Œæ¯”å¦‚ Redis åœ¨ä¸šåŠ¡å¤„ç†çš„æ—¶é—´å¤æ‚åº¦ O(1) çš„æƒ…å†µ 5. å• Reactor å¤šçº¿ç¨‹æ–¹æ¡ˆè¯´æ˜Ž Reactor å¯¹è±¡é€šè¿‡ Select ç›‘æŽ§å®¢æˆ·ç«¯è¯·æ±‚äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åŽï¼Œé€šè¿‡ Dispatch è¿›è¡Œåˆ†å‘ å¦‚æžœæ˜¯å»ºç«‹è¿žæŽ¥è¯·æ±‚ï¼Œåˆ™ç”± Acceptor é€šè¿‡ accept å¤„ç†è¿žæŽ¥è¯·æ±‚ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡å¤„ç†å®Œæˆè¿žæŽ¥åŽçš„å„ç§äº‹ä»¶ å¦‚æžœä¸æ˜¯è¿žæŽ¥è¯·æ±‚ï¼Œåˆ™ç”± Reactor åˆ†å‘è°ƒç”¨è¿žæŽ¥å¯¹åº”çš„ handler æ¥å¤„ç†ï¼ˆä¹Ÿå°±æ˜¯è¯´è¿žæŽ¥å·²ç»å»ºç«‹ï¼ŒåŽç»­å®¢æˆ·ç«¯å†æ¥è¯·æ±‚ï¼Œé‚£åŸºæœ¬å°±æ˜¯æ•°æ®è¯·æ±‚äº†ï¼Œç›´æŽ¥è°ƒç”¨ä¹‹å‰ä¸ºè¿™ä¸ªè¿žæŽ¥åˆ›å»ºå¥½çš„handleræ¥å¤„ç†ï¼‰ handler åªè´Ÿè´£å“åº”äº‹ä»¶ï¼Œä¸åšå…·ä½“çš„ä¸šåŠ¡å¤„ç†ï¼ˆè¿™æ ·ä¸ä¼šä½¿handleré˜»å¡žå¤ªä¹…ï¼‰ï¼Œé€šè¿‡ read è¯»å–æ•°æ®åŽï¼Œä¼šåˆ†å‘ç»™åŽé¢çš„ worker çº¿ç¨‹æ± çš„æŸä¸ªçº¿ç¨‹å¤„ç†ä¸šåŠ¡ã€‚ã€ä¸šåŠ¡å¤„ç†æ˜¯æœ€è´¹æ—¶çš„ï¼Œæ‰€ä»¥å°†ä¸šåŠ¡å¤„ç†äº¤ç»™çº¿ç¨‹æ± åŽ»æ‰§è¡Œã€‘ worker çº¿ç¨‹æ± ä¼šåˆ†é…ç‹¬ç«‹çº¿ç¨‹å®ŒæˆçœŸæ­£çš„ä¸šåŠ¡ï¼Œå¹¶å°†ç»“æžœè¿”å›žç»™ handler handler æ”¶åˆ°å“åº”åŽï¼Œé€šè¿‡ send å°†ç»“æžœè¿”å›žç»™ client æ–¹æ¡ˆä¼˜ç¼ºç‚¹åˆ†æž ä¼˜ç‚¹ï¼šå¯ä»¥å……åˆ†çš„åˆ©ç”¨å¤šæ ¸ cpu çš„å¤„ç†èƒ½åŠ› ç¼ºç‚¹ï¼šå¤šçº¿ç¨‹æ•°æ®å…±äº«å’Œè®¿é—®æ¯”è¾ƒå¤æ‚ã€‚Reactor æ‰¿æ‹…æ‰€æœ‰çš„äº‹ä»¶çš„ç›‘å¬å’Œå“åº”ï¼Œå®ƒæ˜¯å•çº¿ç¨‹è¿è¡Œï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯å®¹æ˜“å‡ºçŽ°æ€§èƒ½ç“¶é¢ˆã€‚ä¹Ÿå°±æ˜¯è¯´Reactorä¸»çº¿ç¨‹æ‰¿æ‹…äº†è¿‡å¤šçš„äº‹ 6. ä¸»ä»Ž Reactor å¤šçº¿ç¨‹å·¥ä½œåŽŸç†å›¾é’ˆå¯¹å• Reactor å¤šçº¿ç¨‹æ¨¡åž‹ä¸­ï¼ŒReactor åœ¨å•çº¿ç¨‹ä¸­è¿è¡Œï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹å®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆï¼Œå¯ä»¥è®© Reactor åœ¨å¤šçº¿ç¨‹ä¸­è¿è¡Œ Reactor ä¸»çº¿ç¨‹ MainReactor å¯¹è±¡é€šè¿‡ select ç›‘å¬è¿žæŽ¥äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åŽï¼Œé€šè¿‡ Acceptor å¤„ç†è¿žæŽ¥äº‹ä»¶ å½“ Acceptor å¤„ç†è¿žæŽ¥äº‹ä»¶åŽï¼ŒMainReactor å°†è¿žæŽ¥åˆ†é…ç»™ SubReactor subreactor å°†è¿žæŽ¥åŠ å…¥åˆ°è¿žæŽ¥é˜Ÿåˆ—è¿›è¡Œç›‘å¬ï¼Œå¹¶åˆ›å»º handler è¿›è¡Œå„ç§äº‹ä»¶å¤„ç† å½“æœ‰æ–°äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œsubreactor å°±ä¼šè°ƒç”¨å¯¹åº”çš„ handler å¤„ç† handler é€šè¿‡ read è¯»å–æ•°æ®ï¼Œåˆ†å‘ç»™åŽé¢çš„ worker çº¿ç¨‹å¤„ç† worker çº¿ç¨‹æ± åˆ†é…ç‹¬ç«‹çš„ worker çº¿ç¨‹è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¹¶è¿”å›žç»“æžœ handler æ”¶åˆ°å“åº”çš„ç»“æžœåŽï¼Œå†é€šè¿‡ send å°†ç»“æžœè¿”å›žç»™ client Reactor ä¸»çº¿ç¨‹å¯ä»¥å¯¹åº”å¤šä¸ª Reactor å­çº¿ç¨‹ï¼Œå³ MainRecator å¯ä»¥å…³è”å¤šä¸ª SubReactor æ–¹æ¡ˆä¼˜ç¼ºç‚¹è¯´æ˜Ž ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸Žå­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•èŒè´£æ˜Žç¡®ï¼Œçˆ¶çº¿ç¨‹åªéœ€è¦æŽ¥æ”¶æ–°è¿žæŽ¥ï¼Œå­çº¿ç¨‹å®ŒæˆåŽç»­çš„ä¸šåŠ¡å¤„ç†ã€‚ ä¼˜ç‚¹ï¼šçˆ¶çº¿ç¨‹ä¸Žå­çº¿ç¨‹çš„æ•°æ®äº¤äº’ç®€å•ï¼ŒReactor ä¸»çº¿ç¨‹åªéœ€è¦æŠŠæ–°è¿žæŽ¥ä¼ ç»™å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹æ— éœ€è¿”å›žæ•°æ®ã€‚ ç¼ºç‚¹ï¼šç¼–ç¨‹å¤æ‚åº¦è¾ƒé«˜ ç»“åˆå®žä¾‹ï¼šè¿™ç§æ¨¡åž‹åœ¨è®¸å¤šé¡¹ç›®ä¸­å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬ Nginx ä¸»ä»Ž Reactor å¤šè¿›ç¨‹æ¨¡åž‹ï¼ŒMemcached ä¸»ä»Žå¤šçº¿ç¨‹ï¼ŒNetty ä¸»ä»Žå¤šçº¿ç¨‹æ¨¡åž‹çš„æ”¯æŒ 7. Reactor æ¨¡å¼å°ç»“3 ç§æ¨¡å¼ç”¨ç”Ÿæ´»æ¡ˆä¾‹æ¥ç†è§£ å• Reactor å•çº¿ç¨‹ï¼Œå‰å°æŽ¥å¾…å‘˜å’ŒæœåŠ¡å‘˜æ˜¯åŒä¸€ä¸ªäººï¼Œå…¨ç¨‹ä¸ºé¡¾å®¢æœåŠ¡ å• Reactor å¤šçº¿ç¨‹ï¼Œ1 ä¸ªå‰å°æŽ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡å‘˜ï¼ŒæŽ¥å¾…å‘˜åªè´Ÿè´£æŽ¥å¾… ä¸»ä»Ž Reactor å¤šçº¿ç¨‹ï¼Œå¤šä¸ªå‰å°æŽ¥å¾…å‘˜ï¼Œå¤šä¸ªæœåŠ¡ç”Ÿ Reactor æ¨¡å¼å…·æœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹ å“åº”å¿«ï¼Œä¸å¿…ä¸ºå•ä¸ªåŒæ­¥æ—¶é—´æ‰€é˜»å¡žï¼Œè™½ç„¶ Reactor æœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„ï¼ˆæ¯”å¦‚ä½ ç¬¬ä¸€ä¸ªSubReactoré˜»å¡žäº†ï¼Œæˆ‘å¯ä»¥è°ƒä¸‹ä¸€ä¸ª SubReactorä¸ºå®¢æˆ·ç«¯æœåŠ¡ï¼‰ å¯ä»¥æœ€å¤§ç¨‹åº¦çš„é¿å…å¤æ‚çš„å¤šçº¿ç¨‹åŠåŒæ­¥é—®é¢˜ï¼Œå¹¶ä¸”é¿å…äº†å¤šçº¿ç¨‹/è¿›ç¨‹çš„åˆ‡æ¢å¼€é”€ æ‰©å±•æ€§å¥½ï¼Œå¯ä»¥æ–¹ä¾¿çš„é€šè¿‡å¢žåŠ  Reactor å®žä¾‹ä¸ªæ•°æ¥å……åˆ†åˆ©ç”¨ CPU èµ„æº å¤ç”¨æ€§å¥½ï¼ŒReactor æ¨¡åž‹æœ¬èº«ä¸Žå…·ä½“äº‹ä»¶å¤„ç†é€»è¾‘æ— å…³ï¼Œå…·æœ‰å¾ˆé«˜çš„å¤ç”¨æ€§ 8. Netty æ¨¡åž‹ è®²è§£nettyçš„æ—¶å€™é‡‡ç”¨çš„æ˜¯å…ˆå†™ä»£ç ä½“éªŒä¸€ä¸‹ï¼Œå†ç»†è®²é‡Œé¢çš„åŽŸç†ã€‚å‰é¢çœ‹ä¸æ‡‚çš„å¯ä»¥å…ˆä¸ç”¨çº ç»“ï¼Œå…ˆå¾€åŽé¢çœ‹ï¼ŒåŽé¢åŸºæœ¬éƒ½ä¼šè®²æ¸…æ¥š å·¥ä½œåŽŸç†ç¤ºæ„å›¾1 - ç®€å•ç‰ˆNettyä¸»è¦åŸºäºŽä¸»ä»Ž Reactors å¤šçº¿ç¨‹æ¨¡åž‹ï¼ˆå¦‚å›¾ï¼‰åšäº†ä¸€å®šçš„æ”¹è¿›ï¼Œå…¶ä¸­ä¸»ä»Ž Reactor å¤šçº¿ç¨‹æ¨¡åž‹æœ‰å¤šä¸ª Reactor å¯¹ä¸Šå›¾è¯´æ˜Ž BossGroup çº¿ç¨‹ç»´æŠ¤ Selectorï¼Œåªå…³æ³¨ Accept å½“æŽ¥æ”¶åˆ° Accept äº‹ä»¶ï¼ŒèŽ·å–åˆ°å¯¹åº”çš„ SocketChannelï¼Œå°è£…æˆ NIOScoketChannel å¹¶æ³¨å†Œåˆ° Worker çº¿ç¨‹ï¼ˆäº‹ä»¶å¾ªçŽ¯ï¼‰ï¼Œå¹¶è¿›è¡Œç»´æŠ¤ å½“ Worker çº¿ç¨‹ç›‘å¬åˆ° Selector ä¸­é€šé“å‘ç”Ÿè‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶åŽï¼Œå°±è¿›è¡Œå¤„ç†ï¼ˆå°±ç”± handlerï¼‰ï¼Œæ³¨æ„ handler å·²ç»åŠ å…¥åˆ°é€šé“ å·¥ä½œåŽŸç†ç¤ºæ„å›¾2 - è¿›é˜¶ç‰ˆ BossGroupæœ‰ç‚¹åƒä¸»Reactor å¯ä»¥æœ‰å¤šä¸ªï¼ŒWorkerGroupåˆ™åƒSubReactorä¸€æ ·å¯ä»¥æœ‰å¤šä¸ªã€‚ å·¥ä½œåŽŸç†ç¤ºæ„å›¾3 - è¯¦ç»†ç‰ˆ Netty æŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ±  ï¼ŒBossGroup ä¸“é—¨è´Ÿè´£æŽ¥æ”¶å®¢æˆ·ç«¯çš„è¿žæŽ¥ï¼ŒWorkerGroup ä¸“é—¨è´Ÿè´£ç½‘ç»œçš„è¯»å†™ BossGroup å’Œ WorkerGroup ç±»åž‹éƒ½æ˜¯ NioEventLoopGroup NioEventLoopGroup ç›¸å½“äºŽä¸€ä¸ªäº‹ä»¶å¾ªçŽ¯ç»„ï¼Œè¿™ä¸ªç»„ä¸­å«æœ‰å¤šä¸ªäº‹ä»¶å¾ªçŽ¯ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶å¾ªçŽ¯æ˜¯ NioEventLoop NioEventLoop è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªçŽ¯çš„æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ª NioEventLoop éƒ½æœ‰ä¸€ä¸ª Selectorï¼Œç”¨äºŽç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„ socket çš„ç½‘ç»œé€šè®¯ NioEventLoopGroup å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå³å¯ä»¥å«æœ‰å¤šä¸ª NioEventLoop æ¯ä¸ªBossGroupä¸‹é¢çš„NioEventLoopå¾ªçŽ¯æ‰§è¡Œçš„æ­¥éª¤æœ‰3æ­¥ è½®è¯¢ accept äº‹ä»¶ å¤„ç† accept äº‹ä»¶ï¼Œä¸Ž client å»ºç«‹è¿žæŽ¥ï¼Œç”Ÿæˆ NioScocketChannelï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°æŸä¸ª workerGroup NIOEventLoop ä¸Šçš„ Selector ç»§ç»­å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³ runAllTasks æ¯ä¸ªWorkerGroupã€NIOEventLoopå¾ªçŽ¯æ‰§è¡Œçš„æ­¥éª¤ è½®è¯¢ readï¼Œwrite äº‹ä»¶ å¤„ç† I/O äº‹ä»¶ï¼Œå³ readï¼Œwrite äº‹ä»¶ï¼Œåœ¨å¯¹åº” NioScocketChannel å¤„ç† å¤„ç†ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œå³ runAllTasks æ¯ä¸ª Worker NIOEventLoop å¤„ç†ä¸šåŠ¡æ—¶ï¼Œä¼šä½¿ç”¨ pipelineï¼ˆç®¡é“ï¼‰ï¼Œpipeline ä¸­åŒ…å«äº† channelï¼ˆé€šé“ï¼‰ï¼Œå³é€šè¿‡ pipeline å¯ä»¥èŽ·å–åˆ°å¯¹åº”é€šé“ï¼Œç®¡é“ä¸­ç»´æŠ¤äº†å¾ˆå¤šçš„å¤„ç†å™¨ã€‚ï¼ˆè¿™ä¸ªç‚¹ç›®å‰åªæ˜¯ç®€å•çš„è®²ï¼ŒåŽé¢é‡ç‚¹è¯´ï¼‰ Netty å¿«é€Ÿå…¥é—¨å®žä¾‹ - TCP æœåŠ¡å®žä¾‹è¦æ±‚ï¼šä½¿ç”¨ IDEA åˆ›å»º Netty é¡¹ç›® Netty æœåŠ¡å™¨åœ¨ 6668 ç«¯å£ç›‘å¬ï¼Œå®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯ç»™æœåŠ¡å™¨â€hello,æœåŠ¡å™¨~â€ æœåŠ¡å™¨å¯ä»¥å›žå¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯â€hello,å®¢æˆ·ç«¯~â€ ç›®çš„ï¼šå¯¹ Netty çº¿ç¨‹æ¨¡åž‹æœ‰ä¸€ä¸ªåˆæ­¥è®¤è¯†ï¼Œä¾¿äºŽç†è§£ Netty æ¨¡åž‹ç†è®º ç¼–å†™æœåŠ¡ç«¯ ç¼–å†™å®¢æˆ·ç«¯ å¯¹ netty ç¨‹åºè¿›è¡Œåˆ†æžï¼Œçœ‹çœ‹ netty æ¨¡åž‹ç‰¹ç‚¹ è¯´æ˜Žï¼šåˆ›å»º Maven é¡¹ç›®ï¼Œå¹¶å¼•å…¥ Netty åŒ… ä»£ç å¦‚ä¸‹ NettyServer 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263package com.fyp.netty.simple;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.*;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioServerSocketChannel;import io.netty.channel.socket.nio.NioSocketChannel;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyæœåŠ¡ç«¯ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyServer &#123; public static void main(String[] args) throws InterruptedException &#123; // åˆ›å»º BossGroup å’Œ WorkGroup /* è¯´æ˜Žï¼š 1. åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ç»„ bossGroup å’Œ workGroup 2. bossGroup åªæ˜¯ å¤„ç† è¿žæŽ¥è¯·æ±‚ï¼Œ çœŸæ­£çš„ å’Œå®¢æˆ·ç«¯ ä¸šåŠ¡å¤„ç†ï¼Œ ä¼šäº¤ç»™ workGroup æ¥å®Œæˆ 3. ä¸¤ä¸ªéƒ½æ˜¯ æ— é™å¾ªçŽ¯ 4. bossGroup å’Œ workerGroup å«æœ‰çš„ å­çº¿ç¨‹ ï¼ˆNioEventLoopï¼‰çš„ä¸ªæ•° é»˜è®¤å®žé™… cpuæ ¸æ•° * 2 */ EventLoopGroup bossGroup = new NioEventLoopGroup(); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; // åˆ›å»º æœåŠ¡å™¨ç«¯çš„ å¯åŠ¨å¯¹è±¡ï¼Œ é…ç½®å‚æ•° ServerBootstrap bootstrap = new ServerBootstrap(); // ä½¿ç”¨ é“¾å¼ç¼–ç¨‹ æ¥ è¿›è¡Œè®¾ç½® bootstrap.group(bossGroup, workerGroup) // è®¾ç½®ä¸¤ä¸ª çº¿ç¨‹ç»„ .channel(NioServerSocketChannel.class) // ä½¿ç”¨ NioSocketChannel ä½œä¸º æœåŠ¡å™¨çš„ é€šé“å®žçŽ° .option(ChannelOption.SO_BACKLOG, 128) // è®¾ç½® çº¿ç¨‹é˜Ÿåˆ— å¾—åˆ° è¿žæŽ¥ä¸ªæ•° .childOption(ChannelOption.SO_KEEPALIVE, true) // è®¾ç½® ä¿æŒæ´»åŠ¨ è¿žæŽ¥çŠ¶æ€ .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; // åˆ›å»ºä¸€ä¸ª é€šé“ æµ‹è¯•å¯¹è±¡ @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(new NettyServerHandler()); &#125; &#125;); // ç»™æˆ‘ä»¬çš„ workerGroup çš„ EventLoop å¯¹åº”çš„ç®¡é“ è®¾ç½®å¤„ç†å™¨ System.out.println(&quot;... æœåŠ¡å™¨ is ready...&quot;); // ç»‘å®šä¸€ä¸ª ç«¯å£ï¼Œ å¹¶ä¸”åŒæ­¥ï¼Œç”Ÿæˆ ä¸€ä¸ª ChannelFuture å¯¹è±¡ // å¯åŠ¨ æœåŠ¡å™¨å¹¶ç»‘å®šç«¯å£ ChannelFuture cf = bootstrap.bind(6667).sync(); // å¯¹ å…³é—­é€šé“ è¿›è¡Œç›‘å¬ cf.channel().closeFuture().sync(); &#125;finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; NettyServerHandler 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.fyp.netty.simple;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.util.CharsetUtil;import java.nio.charset.Charset;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: netttyæœåŠ¡ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyServerHandler extends ChannelInboundHandlerAdapter &#123; /** * è¯»å–æ•°æ® * @param ctx ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå«æœ‰ ç®¡é“ pipeline, é€šé“ channel, åœ°å€ * @param msg å®¢æˆ·ç«¯å‘é€çš„ æ•°æ®ï¼Œ é»˜è®¤ç±»åž‹ Object * @throws Exception */ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; System.out.println(&quot;æœåŠ¡å™¨è¯»å–çº¿ç¨‹ &quot; + Thread.currentThread().getName()); // ä¸èƒ½ è°ƒç”¨ çˆ¶ç±»çš„ channelReadæ–¹æ³•ï¼Œå¦åˆ™ ä¼šæŠ¥ ä»¥ä¸‹å¼‚å¸¸ï¼š // An exceptionCaught() event was fired, and it reached at the tail of the pipeline. // It usually means the last handler in the pipeline did not handle the exception //super.channelRead(ctx, msg); System.out.println(&quot;server ctx = &quot; + ctx); // å°† msg è½¬æˆä¸€ä¸ª ByteBuffer ByteBuf buf = (ByteBuf) msg; System.out.println(&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯ï¼š &quot; + buf.toString(CharsetUtil.UTF_8)); System.out.println(&quot;å®¢æˆ·ç«¯åœ°å€ï¼š&quot; + ctx.channel().remoteAddress()); &#125; // å¤„ç†è¯»å–å®Œæ¯• @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; super.channelReadComplete(ctx); // å°†æ•°æ® å†™å…¥åˆ° ç¼“å­˜ å¹¶ åˆ·æ–° ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯: ç‹—&quot;, CharsetUtil.UTF_8)); &#125; // å¤„ç†å¼‚å¸¸ï¼Œ è¦å…³é—­ é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; super.exceptionCaught(ctx, cause); ctx.close(); &#125;&#125; NettyClient 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.fyp.netty.simple;import io.netty.bootstrap.Bootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioSocketChannel;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyå®¢æˆ·ç«¯ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyClient &#123; public static void main(String[] args) throws InterruptedException &#123; // å®¢æˆ·ç«¯ éœ€è¦ ä¸€ä¸ª äº‹ä»¶å¾ªçŽ¯ç»„ NioEventLoopGroup group = new NioEventLoopGroup(); try &#123; // åˆ›å»º å®¢æˆ·ç«¯ å¯åŠ¨å¯¹è±¡ // æ³¨æ„å®¢æˆ·ç«¯ ä½¿ç”¨çš„ä¸æ˜¯ ServerBootStrap, è€Œæ˜¯BootStrap Bootstrap bootstrap = new Bootstrap(); // è®¾ç½®ç›¸å…³ å‚æ•° bootstrap.group(group) // è®¾ç½® çº¿ç¨‹ç»„ .channel(NioSocketChannel.class) // è®¾ç½® å®¢æˆ·ç«¯ é€šé“çš„ å®žçŽ°ç±»ï¼ˆåå°„) .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ch.pipeline().addLast(new NettyClientHandler()); // åŠ å…¥è‡ªå·±çš„ å¤„ç†å™¨ &#125; &#125;); System.out.println(&quot;å®¢æˆ·ç«¯ ok...&quot;); // å¯åŠ¨å®¢æˆ·ç«¯ åŽ»è¿žæŽ¥ æœåŠ¡å™¨ç«¯ // å…³äºŽ ChannelFuture è¦åˆ†æžï¼Œ æ¶‰åŠåˆ° netty çš„å¼‚æ­¥æ¨¡åž‹ ChannelFuture channelFuture = bootstrap.connect(&quot;127.0.0.1&quot;, 6667).sync(); // å¯¹å…³é—­ é€šé“ è¿›è¡Œç›‘å¬ channelFuture.channel().closeFuture().sync(); &#125; finally &#123; group.shutdownGracefully(); &#125; &#125;&#125; NettyClientHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.fyp.netty.simple;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.channel.Channel;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.util.CharsetUtil;/** * @Auther: fyp * @Date: 2022/2/11 * @Description: nettyå®¢æˆ·ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.simple * @Version: 1.0 */public class NettyClientHandler extends ChannelInboundHandlerAdapter &#123; @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; super.channelActive(ctx); System.out.println(&quot;client ctx = &quot; + ctx); ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello,server: (&gt;^Ï‰^&lt;)å–µ&quot;, CharsetUtil.UTF_8)); &#125; // å½“é€šé“ æœ‰è¯»å–äº‹ä»¶ æ—¶ ï¼Œä¼šè§¦å‘ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; ByteBuf buf = (ByteBuf) msg; System.out.println(&quot;æœåŠ¡ç«¯å›žå¤çš„æ¶ˆæ¯ï¼š &quot; + buf.toString()); System.out.println(&quot;æœåŠ¡ç«¯çš„åœ°å€ï¼š &quot; + ctx.channel().remoteAddress()); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; cause.printStackTrace(); ctx.close(); &#125;&#125; ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ Task æœ‰ 3 ç§å…¸åž‹ä½¿ç”¨åœºæ™¯ ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡ã€ä¸¾ä¾‹è¯´æ˜Žã€‘ ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ éžå½“å‰ Reactor çº¿ç¨‹è°ƒç”¨ Channel çš„å„ç§æ–¹æ³• â€‹ ä¾‹å¦‚åœ¨æŽ¨é€ç³»ç»Ÿçš„ä¸šåŠ¡çº¿ç¨‹é‡Œé¢ï¼Œæ ¹æ®ç”¨æˆ·çš„æ ‡è¯†ï¼Œæ‰¾åˆ°å¯¹åº”çš„ Channel å¼•ç”¨ï¼Œç„¶åŽè°ƒç”¨ Write ç±»æ–¹æ³•å‘è¯¥ç”¨æˆ·æŽ¨é€æ¶ˆæ¯ï¼Œå°±ä¼šè¿›å…¥åˆ°è¿™ç§åœºæ™¯ã€‚æœ€ç»ˆçš„ Write ä¼šæäº¤åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­åŽè¢«å¼‚æ­¥æ¶ˆè´¹ å‰ä¸¤ç§çš„ä»£ç ä¸¾ä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104package com.atguigu.netty.simple;import io.netty.buffer.Unpooled;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.util.CharsetUtil;import java.util.concurrent.TimeUnit;/** * è¯´æ˜Ž * 1. æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªHandler éœ€è¦ç»§ç»­netty è§„å®šå¥½çš„æŸä¸ªHandlerAdapter(è§„èŒƒ) * 2. è¿™æ—¶æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªHandler , æ‰èƒ½ç§°ä¸ºä¸€ä¸ªhandler */public class NettyServerHandler extends ChannelInboundHandlerAdapter &#123; //è¯»å–æ•°æ®å®žé™…(è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯) /** * 1. ChannelHandlerContext ctx:ä¸Šä¸‹æ–‡å¯¹è±¡, å«æœ‰ ç®¡é“pipeline , é€šé“channel, åœ°å€ * 2. Object msg: å°±æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ•°æ® é»˜è®¤Object */ @Override public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception &#123; // æ¯”å¦‚è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéžå¸¸è€—æ—¶é•¿çš„ä¸šåŠ¡-&gt; å¼‚æ­¥æ‰§è¡Œ -&gt; æäº¤è¯¥channel å¯¹åº”çš„ // NIOEventLoop çš„ taskQueueä¸­, // è§£å†³æ–¹æ¡ˆ1 ç”¨æˆ·ç¨‹åºè‡ªå®šä¹‰çš„æ™®é€šä»»åŠ¡ ctx.channel().eventLoop().execute(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(5 * 1000); ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ2&quot;, CharsetUtil.UTF_8)); System.out.println(&quot;channel code=&quot; + ctx.channel().hashCode()); &#125; catch (Exception ex) &#123; System.out.println(&quot;å‘ç”Ÿå¼‚å¸¸&quot; + ex.getMessage()); &#125; &#125; &#125;); ctx.channel().eventLoop().execute(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(5 * 1000); ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ3&quot;, CharsetUtil.UTF_8)); System.out.println(&quot;channel code=&quot; + ctx.channel().hashCode()); &#125; catch (Exception ex) &#123; System.out.println(&quot;å‘ç”Ÿå¼‚å¸¸&quot; + ex.getMessage()); &#125; &#125; &#125;); //è§£å†³æ–¹æ¡ˆ2 : ç”¨æˆ·è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡ -ã€‹ è¯¥ä»»åŠ¡æ˜¯æäº¤åˆ° scheduleTaskQueueä¸­ ctx.channel().eventLoop().schedule(new Runnable() &#123; @Override public void run() &#123; try &#123; Thread.sleep(5 * 1000); ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ4&quot;, CharsetUtil.UTF_8)); System.out.println(&quot;channel code=&quot; + ctx.channel().hashCode()); &#125; catch (Exception ex) &#123; System.out.println(&quot;å‘ç”Ÿå¼‚å¸¸&quot; + ex.getMessage()); &#125; &#125; &#125;, 5, TimeUnit.SECONDS); System.out.println(&quot;go on ...&quot;);// System.out.println(&quot;æœåŠ¡å™¨è¯»å–çº¿ç¨‹ &quot; + Thread.currentThread().getName() + &quot; channle =&quot; + ctx.channel());// System.out.println(&quot;server ctx =&quot; + ctx);// System.out.println(&quot;çœ‹çœ‹channel å’Œ pipelineçš„å…³ç³»&quot;);// Channel channel = ctx.channel();// ChannelPipeline pipeline = ctx.pipeline(); //æœ¬è´¨æ˜¯ä¸€ä¸ªåŒå‘é“¾æŽ¥, å‡ºç«™å…¥ç«™// // //å°† msg è½¬æˆä¸€ä¸ª ByteBuf// //ByteBuf æ˜¯ Netty æä¾›çš„ï¼Œä¸æ˜¯ NIO çš„ ByteBuffer.// ByteBuf buf = (ByteBuf) msg;// System.out.println(&quot;å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ˜¯:&quot; + buf.toString(CharsetUtil.UTF_8));// System.out.println(&quot;å®¢æˆ·ç«¯åœ°å€:&quot; + channel.remoteAddress()); &#125; //æ•°æ®è¯»å–å®Œæ¯• @Override public void channelReadComplete(ChannelHandlerContext ctx) throws Exception &#123; //writeAndFlush æ˜¯ write + flush //å°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶åˆ·æ–° //ä¸€èˆ¬è®²ï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªå‘é€çš„æ•°æ®è¿›è¡Œç¼–ç  ctx.writeAndFlush(Unpooled.copiedBuffer(&quot;hello, å®¢æˆ·ç«¯~(&gt;^Ï‰^&lt;)å–µ1&quot;, CharsetUtil.UTF_8)); &#125; //å¤„ç†å¼‚å¸¸, ä¸€èˆ¬æ˜¯éœ€è¦å…³é—­é€šé“ @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; ctx.close(); &#125;&#125; æ–¹æ¡ˆå†è¯´æ˜Ž Netty æŠ½è±¡å‡ºä¸¤ç»„çº¿ç¨‹æ± ï¼ŒBossGroup ä¸“é—¨è´Ÿè´£æŽ¥æ”¶å®¢æˆ·ç«¯è¿žæŽ¥ï¼ŒWorkerGroup ä¸“é—¨è´Ÿè´£ç½‘ç»œè¯»å†™æ“ä½œã€‚ NioEventLoop è¡¨ç¤ºä¸€ä¸ªä¸æ–­å¾ªçŽ¯æ‰§è¡Œå¤„ç†ä»»åŠ¡çš„çº¿ç¨‹ï¼Œæ¯ä¸ª NioEventLoop éƒ½æœ‰ä¸€ä¸ª Selectorï¼Œç”¨äºŽç›‘å¬ç»‘å®šåœ¨å…¶ä¸Šçš„ socketç½‘ç»œé€šé“ã€‚ NioEventLoop å†…éƒ¨é‡‡ç”¨ä¸²è¡ŒåŒ–è®¾è®¡ï¼Œä»Žæ¶ˆæ¯çš„ è¯»å–-&gt;è§£ç -&gt;å¤„ç†-&gt;ç¼–ç -&gt;å‘é€ï¼Œå§‹ç»ˆç”± IO çº¿ç¨‹ NioEventLoop è´Ÿè´£ NioEventLoopGroup ä¸‹åŒ…å«å¤šä¸ª NioEventLoop æ¯ä¸ª NioEventLoop ä¸­åŒ…å«æœ‰ä¸€ä¸ª Selectorï¼Œä¸€ä¸ª taskQueue æ¯ä¸ª NioEventLoop çš„ Selector ä¸Šå¯ä»¥æ³¨å†Œç›‘å¬å¤šä¸ª NioChannel æ¯ä¸ª NioChannel åªä¼šç»‘å®šåœ¨å”¯ä¸€çš„ NioEventLoop ä¸Š æ¯ä¸ª NioChannel éƒ½ç»‘å®šæœ‰ä¸€ä¸ªè‡ªå·±çš„ ChannelPipeline 9. å¼‚æ­¥æ¨¡åž‹åŸºæœ¬ä»‹ç» å¼‚æ­¥çš„æ¦‚å¿µå’ŒåŒæ­¥ç›¸å¯¹ã€‚å½“ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹è°ƒç”¨å‘å‡ºåŽï¼Œè°ƒç”¨è€…ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æžœã€‚å®žé™…å¤„ç†è¿™ä¸ªè°ƒç”¨çš„ç»„ä»¶åœ¨å®ŒæˆåŽï¼Œé€šè¿‡çŠ¶æ€ã€é€šçŸ¥å’Œå›žè°ƒæ¥é€šçŸ¥è°ƒç”¨è€…ã€‚ Netty ä¸­çš„ I/O æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼ŒåŒ…æ‹¬ Bindã€Writeã€Connect ç­‰æ“ä½œä¼šé¦–å…ˆç®€å•çš„è¿”å›žä¸€ä¸ª ChannelFutureã€‚ è°ƒç”¨è€…å¹¶ä¸èƒ½ç«‹åˆ»èŽ·å¾—ç»“æžœï¼Œè€Œæ˜¯é€šè¿‡ Future-Listener æœºåˆ¶ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„ä¸»åŠ¨èŽ·å–æˆ–è€…é€šè¿‡é€šçŸ¥æœºåˆ¶èŽ·å¾— IO æ“ä½œç»“æžœã€‚ Netty çš„å¼‚æ­¥æ¨¡åž‹æ˜¯å»ºç«‹åœ¨ future å’Œ callback çš„ä¹‹ä¸Šçš„ã€‚callback å°±æ˜¯å›žè°ƒã€‚é‡ç‚¹è¯´ Futureï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå‡è®¾ä¸€ä¸ªæ–¹æ³• funï¼Œè®¡ç®—è¿‡ç¨‹å¯èƒ½éžå¸¸è€—æ—¶ï¼Œç­‰å¾… fun è¿”å›žæ˜¾ç„¶ä¸åˆé€‚ã€‚é‚£ä¹ˆå¯ä»¥åœ¨è°ƒç”¨ fun çš„æ—¶å€™ï¼Œç«‹é©¬è¿”å›žä¸€ä¸ª Futureï¼ŒåŽç»­å¯ä»¥é€šè¿‡ Future åŽ»ç›‘æŽ§æ–¹æ³• fun çš„å¤„ç†è¿‡ç¨‹ï¼ˆå³ï¼šFuture-Listener æœºåˆ¶ï¼‰ Future è¯´æ˜Ž è¡¨ç¤ºå¼‚æ­¥çš„æ‰§è¡Œç»“æžœ,å¯ä»¥é€šè¿‡å®ƒæä¾›çš„æ–¹æ³•æ¥æ£€æµ‹æ‰§è¡Œæ˜¯å¦å®Œæˆï¼Œæ¯”å¦‚æ£€ç´¢è®¡ç®—ç­‰ç­‰ã€‚ ChannelFuture æ˜¯ä¸€ä¸ªæŽ¥å£ï¼špublic interface ChannelFuture extends Future&lt;Void&gt; æˆ‘ä»¬å¯ä»¥æ·»åŠ ç›‘å¬å™¨ï¼Œå½“ç›‘å¬çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°ç›‘å¬å™¨ã€‚ å·¥ä½œåŽŸç†ç¤ºæ„å›¾ä¸‹é¢ç¬¬ä¸€å¼ å›¾å°±æ˜¯ç®¡é“ï¼Œä¸­é—´ä¼šç»è¿‡å¤šä¸ªhandler è¯´æ˜Žï¼š åœ¨ä½¿ç”¨ Netty è¿›è¡Œç¼–ç¨‹æ—¶ï¼Œæ‹¦æˆªæ“ä½œå’Œè½¬æ¢å‡ºå…¥ç«™æ•°æ®åªéœ€è¦æ‚¨æä¾› callback æˆ–åˆ©ç”¨ future å³å¯ã€‚è¿™ä½¿å¾—é“¾å¼æ“ä½œç®€å•ã€é«˜æ•ˆï¼Œå¹¶æœ‰åˆ©äºŽç¼–å†™å¯é‡ç”¨çš„ã€é€šç”¨çš„ä»£ç ã€‚ Netty æ¡†æž¶çš„ç›®æ ‡å°±æ˜¯è®©ä½ çš„ä¸šåŠ¡é€»è¾‘ä»Žç½‘ç»œåŸºç¡€åº”ç”¨ç¼–ç ä¸­åˆ†ç¦»å‡ºæ¥ã€è§£è„±å‡ºæ¥ã€‚ Future-Listener æœºåˆ¶ è¿™é‡Œçœ‹ä¸æ‡‚çš„å¯ä»¥çœ‹ç¬”è€…çš„å¹¶å‘ç³»åˆ—-JUCéƒ¨åˆ† å½“ Future å¯¹è±¡åˆšåˆšåˆ›å»ºæ—¶ï¼Œå¤„äºŽéžå®ŒæˆçŠ¶æ€ï¼Œè°ƒç”¨è€…å¯ä»¥é€šè¿‡è¿”å›žçš„ ChannelFuture æ¥èŽ·å–æ“ä½œæ‰§è¡Œçš„çŠ¶æ€ï¼Œæ³¨å†Œç›‘å¬å‡½æ•°æ¥æ‰§è¡Œå®ŒæˆåŽçš„æ“ä½œã€‚ å¸¸è§æœ‰å¦‚ä¸‹æ“ä½œ é€šè¿‡ isDone æ–¹æ³•æ¥åˆ¤æ–­å½“å‰æ“ä½œæ˜¯å¦å®Œæˆï¼› é€šè¿‡ isSuccess æ–¹æ³•æ¥åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦æˆåŠŸï¼› é€šè¿‡ getCause æ–¹æ³•æ¥èŽ·å–å·²å®Œæˆçš„å½“å‰æ“ä½œå¤±è´¥çš„åŽŸå› ï¼› é€šè¿‡ isCancelled æ–¹æ³•æ¥åˆ¤æ–­å·²å®Œæˆçš„å½“å‰æ“ä½œæ˜¯å¦è¢«å–æ¶ˆï¼› é€šè¿‡ addListener æ–¹æ³•æ¥æ³¨å†Œç›‘å¬å™¨ï¼Œå½“æ“ä½œå·²å®Œæˆï¼ˆisDoneæ–¹æ³•è¿”å›žå®Œæˆï¼‰ï¼Œå°†ä¼šé€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨ï¼›å¦‚æžœ Future å¯¹è±¡å·²å®Œæˆï¼Œåˆ™é€šçŸ¥æŒ‡å®šçš„ç›‘å¬å™¨ ä¸¾ä¾‹è¯´æ˜Ž æ¼”ç¤ºï¼šç»‘å®šç«¯å£æ˜¯å¼‚æ­¥æ“ä½œï¼Œå½“ç»‘å®šæ“ä½œå¤„ç†å®Œï¼Œå°†ä¼šè°ƒç”¨ç›¸åº”çš„ç›‘å¬å™¨å¤„ç†é€»è¾‘ 1234567891011121314//ç»‘å®šä¸€ä¸ªç«¯å£å¹¶ä¸”åŒæ­¥,ç”Ÿæˆäº†ä¸€ä¸ªChannelFutureå¯¹è±¡//å¯åŠ¨æœåŠ¡å™¨(å¹¶ç»‘å®šç«¯å£)ChannelFuture cf = bootstrap.bind(6668).sync();//ç»™cfæ³¨å†Œç›‘å¬å™¨ï¼Œç›‘æŽ§æˆ‘ä»¬å…³å¿ƒçš„äº‹ä»¶cf.addListener(new ChannelFutureListener() &#123; @Override public void operationComplete (ChannelFuture future) throws Exception &#123; if (future.isSuccess()) &#123; System.out.println(&quot;ç›‘å¬ç«¯å£6668æˆåŠŸ&quot;); &#125; else &#123; System.out.println(&quot;ç›‘å¬ç«¯å£6668å¤±è´¥&quot;); &#125; &#125;&#125;); å¿«é€Ÿå…¥é—¨å®žä¾‹ - HTTPæœåŠ¡ å®žä¾‹è¦æ±‚ï¼šä½¿ç”¨ IDEA åˆ›å»º Netty é¡¹ç›® Netty æœåŠ¡å™¨åœ¨ 9999 ç«¯å£ç›‘å¬ï¼Œæµè§ˆå™¨å‘å‡ºè¯·æ±‚ http://localhost:9999/ æœåŠ¡å™¨å¯ä»¥å›žå¤æ¶ˆæ¯ç»™å®¢æˆ·ç«¯â€Hello!æˆ‘æ˜¯æœåŠ¡å™¨5â€,å¹¶å¯¹ç‰¹å®šè¯·æ±‚èµ„æºè¿›è¡Œè¿‡æ»¤ã€‚ ç›®çš„ï¼šNetty å¯ä»¥åš Http æœåŠ¡å¼€å‘ï¼Œå¹¶ä¸”ç†è§£ Handler å®žä¾‹å’Œå®¢æˆ·ç«¯åŠå…¶è¯·æ±‚çš„å…³ç³»ã€‚ ä»£ç æ¼”ç¤º TestServer 123456789101112131415161718192021222324252627282930313233343536373839package com.fyp.netty.http;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.nio.NioServerSocketChannel;/** * @Auther: fyp * @Date: 2022/2/12 * @Description: æµ‹è¯•httpæœåŠ¡ç«¯ * @Package: com.fyp.netty.http * @Version: 1.0 */public class TestServer &#123; public static void main(String[] args) throws Exception&#123; EventLoopGroup bossGroup = new NioEventLoopGroup(1); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup).channel(NioServerSocketChannel.class).childHandler(new TestServerInitializer()); ChannelFuture channelFuture = serverBootstrap.bind(9999).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; TestHttpServeHandler 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061package com.fyp.netty.http;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.buffer.UnpooledByteBufAllocator;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import io.netty.handler.codec.http.*;import io.netty.util.CharsetUtil;import java.net.URI;/** * @Auther: fyp * @Date: 2022/2/12 * @Description: æµ‹è¯•httpæœåŠ¡ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.http * @Version: 1.0 */public class TestHttpServerHandler extends SimpleChannelInboundHandler&lt;HttpObject&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, HttpObject msg) throws Exception &#123; // åˆ¤æ–­ msg æ˜¯ä¸æ˜¯ httpRequestè¯·æ±‚ if(msg instanceof HttpRequest) &#123; System.out.println(&quot;pipeline hashcode: &quot; + ctx.pipeline().hashCode() + &quot; TestHttpServerHandler hashcode: &quot; + this.hashCode()); System.out.println(&quot;msg ç±»åž‹ï¼š&quot; + msg.getClass()); System.out.println(&quot;å®¢æˆ·ç«¯åœ°å€ï¼š&quot; + ctx.channel().remoteAddress()); // èŽ·å– HttpRequest HttpRequest httpRequest = (HttpRequest) msg; // èŽ·å– uri URI uri = new URI(httpRequest.uri()); System.out.println(&quot;è¯·æ±‚è·¯å¾„ï¼š &quot; + uri); if (&quot;/favicon.ico&quot;.equals(uri.getPath())) &#123; System.out.println(&quot;è¯·æ±‚äº†favicon.ico, ä¸åšå“åº”&quot;); return; &#125; // å›žå¤ä¿¡æ¯ ç»™ æµè§ˆå™¨ [http åè®®] ByteBuf content = Unpooled.copiedBuffer(&quot;hello æˆ‘æ˜¯æœåŠ¡å™¨&quot;, CharsetUtil.UTF_8); // æž„é€ ä¸€ä¸ª http å“åº” FullHttpResponse response = new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.OK, content); response.headers().set(HttpHeaderNames.CONTENT_TYPE, &quot;text/plain;charset=UTF-8&quot;); response.headers().set(HttpHeaderNames.CONTENT_LENGTH, content.readableBytes()); //å°†æž„å»ºå¥½ responseè¿”å›žï¼Œå¿…è¦ä¸€æ­¥ï¼Œæ²¡æœ‰å®¢æˆ·ç«¯ å°†æ”¶ä¸åˆ°æœåŠ¡ç«¯ å‘é€çš„æ•°æ® ctx.writeAndFlush(response); &#125; &#125;&#125; TestServerInitializer 12345678910111213141516171819202122232425262728293031323334353637package com.fyp.netty.http;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.socket.SocketChannel;import io.netty.handler.codec.http.HttpServerCodec;/** * @Auther: fyp * @Date: 2022/2/12 * @Description: æµ‹è¯•httpæœåŠ¡ç«¯çš„åˆå§‹åŒ–å™¨ * @Package: com.fyp.netty.http * @Version: 1.0 */public class TestServerInitializer extends ChannelInitializer&lt;SocketChannel&gt; &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; // å‘ ç®¡é“ åŠ å…¥ å¤„ç†å™¨ // å¾—åˆ° ç®¡é“ ChannelPipeline pipeline = ch.pipeline(); // åŠ å…¥ ä¸€ä¸ª netty æä¾›çš„ httpServerCodec =&gt; [coder - decoder] /* HttpServerCodec è¯´æ˜Ž 1. HttpServerCodec æ˜¯ netty æä¾›çš„ å¤„ç† http çš„ç¼–è§£ç å™¨ 2. å¢žåŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ handler */ pipeline.addLast(&quot;MyHttpServerCodec&quot;, new HttpServerCodec()); pipeline.addLast(&quot;MyTestHttpServerHandler&quot;, new TestHttpServerHandler()); System.out.println(&quot;ok ~&quot;); &#125;&#125; ä¸‰ã€Netty æ ¸å¿ƒæ¨¡å—ç»„ä»¶Bootstrapã€ServerBootstrap Bootstrap æ„æ€æ˜¯å¼•å¯¼ï¼Œä¸€ä¸ª Netty åº”ç”¨é€šå¸¸ç”±ä¸€ä¸ª Bootstrap å¼€å§‹ï¼Œä¸»è¦ä½œç”¨æ˜¯é…ç½®æ•´ä¸ª Netty ç¨‹åºï¼Œä¸²è”å„ä¸ªç»„ä»¶ï¼ŒNetty ä¸­ Bootstrap ç±»æ˜¯å®¢æˆ·ç«¯ç¨‹åºçš„å¯åŠ¨å¼•å¯¼ç±»ï¼ŒServerBootstrap æ˜¯æœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼ç±»ã€‚ å¸¸è§çš„æ–¹æ³•æœ‰ public ServerBootstrap group(EventLoopGroup parentGroup, EventLoopGroup childGroup)ï¼Œè¯¥æ–¹æ³•ç”¨äºŽæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸¤ä¸ª EventLoop public B group(EventLoopGroup group)ï¼Œè¯¥æ–¹æ³•ç”¨äºŽå®¢æˆ·ç«¯ï¼Œç”¨æ¥è®¾ç½®ä¸€ä¸ª EventLoop public B channel(Class&lt;? extends C&gt; channelClass)ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„é€šé“å®žçŽ° public &lt;T&gt; B option(ChannelOption&lt;T&gt; option, T value)ï¼Œç”¨æ¥ç»™ ServerChannel æ·»åŠ é…ç½® public &lt;T&gt; ServerBootstrap childOption(ChannelOption&lt;T&gt; childOption, T value)ï¼Œç”¨æ¥ç»™æŽ¥æ”¶åˆ°çš„é€šé“æ·»åŠ é…ç½® public ServerBootstrap childHandler(ChannelHandler childHandler)ï¼Œè¯¥æ–¹æ³•ç”¨æ¥è®¾ç½®ä¸šåŠ¡å¤„ç†ç±»ï¼ˆè‡ªå®šä¹‰çš„handlerï¼‰ public ChannelFuture bind(int inetPort)ï¼Œè¯¥æ–¹æ³•ç”¨äºŽæœåŠ¡å™¨ç«¯ï¼Œç”¨æ¥è®¾ç½®å ç”¨çš„ç«¯å£å· public ChannelFuture connect(String inetHost, int inetPort)ï¼Œè¯¥æ–¹æ³•ç”¨äºŽå®¢æˆ·ç«¯ï¼Œç”¨æ¥è¿žæŽ¥æœåŠ¡å™¨ç«¯ Futureã€ChannelFutureNetty ä¸­æ‰€æœ‰çš„ IO æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸èƒ½ç«‹åˆ»å¾—çŸ¥æ¶ˆæ¯æ˜¯å¦è¢«æ­£ç¡®å¤„ç†ã€‚ä½†æ˜¯å¯ä»¥è¿‡ä¸€ä¼šç­‰å®ƒæ‰§è¡Œå®Œæˆæˆ–è€…ç›´æŽ¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå…·ä½“çš„å®žçŽ°å°±æ˜¯é€šè¿‡ Future å’Œ ChannelFuturesï¼Œä»–ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ªç›‘å¬ï¼Œå½“æ“ä½œæ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥æ—¶ç›‘å¬ä¼šè‡ªåŠ¨è§¦å‘æ³¨å†Œçš„ç›‘å¬äº‹ä»¶ å¸¸è§çš„æ–¹æ³•æœ‰ Channel channel()ï¼Œè¿”å›žå½“å‰æ­£åœ¨è¿›è¡Œ IO æ“ä½œçš„é€šé“ ChannelFuture sync()ï¼Œç­‰å¾…å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œæ¯• Channel Netty ç½‘ç»œé€šä¿¡çš„ç»„ä»¶ï¼Œèƒ½å¤Ÿç”¨äºŽæ‰§è¡Œç½‘ç»œ I/O æ“ä½œã€‚ é€šè¿‡ Channel å¯èŽ·å¾—å½“å‰ç½‘ç»œè¿žæŽ¥çš„é€šé“çš„çŠ¶æ€ é€šè¿‡ Channel å¯èŽ·å¾—ç½‘ç»œè¿žæŽ¥çš„é…ç½®å‚æ•°ï¼ˆä¾‹å¦‚æŽ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼‰ Channel æä¾›å¼‚æ­¥çš„ç½‘ç»œ I/O æ“ä½œ(å¦‚å»ºç«‹è¿žæŽ¥ï¼Œè¯»å†™ï¼Œç»‘å®šç«¯å£)ï¼Œå¼‚æ­¥è°ƒç”¨æ„å‘³ç€ä»»ä½• I/O è°ƒç”¨éƒ½å°†ç«‹å³è¿”å›žï¼Œå¹¶ä¸”ä¸ä¿è¯åœ¨è°ƒç”¨ç»“æŸæ—¶æ‰€è¯·æ±‚çš„ I/O æ“ä½œå·²å®Œæˆ è°ƒç”¨ç«‹å³è¿”å›žä¸€ä¸ª ChannelFuture å®žä¾‹ï¼Œé€šè¿‡æ³¨å†Œç›‘å¬å™¨åˆ° ChannelFuture ä¸Šï¼Œå¯ä»¥ I/O æ“ä½œæˆåŠŸã€å¤±è´¥æˆ–å–æ¶ˆæ—¶å›žè°ƒé€šçŸ¥è°ƒç”¨æ–¹ æ”¯æŒå…³è” I/O æ“ä½œä¸Žå¯¹åº”çš„å¤„ç†ç¨‹åº ä¸åŒåè®®ã€ä¸åŒçš„é˜»å¡žç±»åž‹çš„è¿žæŽ¥éƒ½æœ‰ä¸åŒçš„Channelç±»åž‹ä¸Žä¹‹å¯¹åº”ï¼Œå¸¸ç”¨çš„Channelç±»åž‹ï¼š NioSocketChannelï¼Œå¼‚æ­¥çš„å®¢æˆ·ç«¯ TCP Socket è¿žæŽ¥ã€‚ NioServerSocketChannelï¼Œå¼‚æ­¥çš„æœåŠ¡å™¨ç«¯ TCP Socket è¿žæŽ¥ã€‚ NioDatagramChannelï¼Œå¼‚æ­¥çš„ UDP è¿žæŽ¥ã€‚ NioSctpChannelï¼Œå¼‚æ­¥çš„å®¢æˆ·ç«¯ Sctp è¿žæŽ¥ã€‚ NioSctpServerChannelï¼Œå¼‚æ­¥çš„ Sctp æœåŠ¡å™¨ç«¯è¿žæŽ¥ï¼Œè¿™äº›é€šé“æ¶µç›–äº† UDP å’Œ TCP ç½‘ç»œ IO ä»¥åŠæ–‡ä»¶ IOã€‚ Selector Netty åŸºäºŽ Selector å¯¹è±¡å®žçŽ° I/O å¤šè·¯å¤ç”¨ï¼Œé€šè¿‡ Selector ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªè¿žæŽ¥çš„ Channel äº‹ä»¶ã€‚ å½“å‘ä¸€ä¸ª Selector ä¸­æ³¨å†Œ Channel åŽï¼ŒSelector å†…éƒ¨çš„æœºåˆ¶å°±å¯ä»¥è‡ªåŠ¨ä¸æ–­åœ°æŸ¥è¯¢ï¼ˆSelectï¼‰è¿™äº›æ³¨å†Œçš„ Channel æ˜¯å¦æœ‰å·²å°±ç»ªçš„ I/O äº‹ä»¶ï¼ˆä¾‹å¦‚å¯è¯»ï¼Œå¯å†™ï¼Œç½‘ç»œè¿žæŽ¥å®Œæˆç­‰ï¼‰ï¼Œè¿™æ ·ç¨‹åºå°±å¯ä»¥å¾ˆç®€å•åœ°ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ª Channel ChannelHandler åŠå…¶å®žçŽ°ç±» ChannelHandler æ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œå¤„ç† I/O äº‹ä»¶æˆ–æ‹¦æˆª I/O æ“ä½œï¼Œå¹¶å°†å…¶è½¬å‘åˆ°å…¶ ChannelPipelineï¼ˆä¸šåŠ¡å¤„ç†é“¾ï¼‰ä¸­çš„ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚ ChannelHandler æœ¬èº«å¹¶æ²¡æœ‰æä¾›å¾ˆå¤šæ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªæŽ¥å£æœ‰è®¸å¤šçš„æ–¹æ³•éœ€è¦å®žçŽ°ï¼Œæ–¹ä¾¿ä½¿ç”¨æœŸé—´ï¼Œå¯ä»¥ç»§æ‰¿å®ƒçš„å­ç±» ChannelHandler åŠå…¶å®žçŽ°ç±»ä¸€è§ˆå›¾ï¼ˆåŽï¼‰ æˆ‘ä»¬ç»å¸¸éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ª Handler ç±»åŽ»ç»§æ‰¿ ChannelInboundHandlerAdapterï¼Œç„¶åŽé€šè¿‡é‡å†™ç›¸åº”æ–¹æ³•å®žçŽ°ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬æŽ¥ä¸‹æ¥çœ‹çœ‹ä¸€èˆ¬éƒ½éœ€è¦é‡å†™å“ªäº›æ–¹æ³• Pipeline å’Œ ChannelPipelineChannelPipeline æ˜¯ä¸€ä¸ªé‡ç‚¹ï¼š ChannelPipeline æ˜¯ä¸€ä¸ª Handler çš„é›†åˆï¼Œå®ƒè´Ÿè´£å¤„ç†å’Œæ‹¦æˆª inbound æˆ–è€… outbound çš„äº‹ä»¶å’Œæ“ä½œï¼Œç›¸å½“äºŽä¸€ä¸ªè´¯ç©¿ Netty çš„é“¾ã€‚ï¼ˆä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼šChannelPipeline æ˜¯ä¿å­˜ ChannelHandler çš„ Listï¼Œç”¨äºŽå¤„ç†æˆ–æ‹¦æˆª Channel çš„å…¥ç«™äº‹ä»¶å’Œå‡ºç«™æ“ä½œï¼‰ ChannelPipeline å®žçŽ°äº†ä¸€ç§é«˜çº§å½¢å¼çš„æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼Œä½¿ç”¨æˆ·å¯ä»¥å®Œå…¨æŽ§åˆ¶äº‹ä»¶çš„å¤„ç†æ–¹å¼ï¼Œä»¥åŠ Channel ä¸­å„ä¸ªçš„ ChannelHandler å¦‚ä½•ç›¸äº’äº¤äº’ åœ¨ Netty ä¸­æ¯ä¸ª Channel éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª ChannelPipeline ä¸Žä¹‹å¯¹åº”ï¼Œå®ƒä»¬çš„ç»„æˆå…³ç³»å¦‚ä¸‹ ä¸€ä¸ªChannelåŒ…å«äº†ä¸€ä¸ªChannelPipelineï¼Œè€ŒChannelPipelineä¸­åˆç»´æŠ¤äº†ä¸€ä¸ªç”±ChannelHandlerContextç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œå¹¶ä¸”æ¯ä¸ªChannelHandlerContextä¸­åˆå…³è”ç€ä¸€ä¸ªChannelHandler å…¥ç«™äº‹ä»¶å’Œå‡ºæˆ˜äº‹ä»¶åœ¨ä¸€ä¸ªåŒå‘é“¾è¡¨ä¸­ï¼Œå…¥ç«™äº‹ä»¶ä¼šä»Žé“¾è¡¨headå¾€åŽä¼ é€’åˆ°æœ€åŽä¸€ä¸ªå…¥ç«™çš„handlerï¼Œå‡ºç«™äº‹ä»¶ä¼šé‡é“¾è¡¨tailå¾€å‰ä¼ é€’åˆ°æœ€å‰ä¸€ä¸ªå‡ºç«™çš„handlerï¼Œä¸¤ç§ç±»åž‹çš„handleräº’ä¸å¹²æ‰° å¸¸ç”¨æ–¹æ³• ChannelPipeline addFirst(ChannelHandler... handlers)ï¼ŒæŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆhandlerï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„ç¬¬ä¸€ä¸ªä½ç½® ChannelPipeline addLast(ChannelHandler... handlers)ï¼ŒæŠŠä¸€ä¸ªä¸šåŠ¡å¤„ç†ç±»ï¼ˆhandlerï¼‰æ·»åŠ åˆ°é“¾ä¸­çš„æœ€åŽä¸€ä¸ªä½ç½® TestServerInitializerå’ŒHttpServerCodecè¿™äº›ä¸œè¥¿æœ¬èº«ä¹Ÿæ˜¯handler ä¸€èˆ¬æ¥è¯´äº‹ä»¶ä»Žå®¢æˆ·ç«¯å¾€æœåŠ¡å™¨èµ°æˆ‘ä»¬ç§°ä¸ºå‡ºç«™ï¼Œåä¹‹åˆ™æ˜¯å…¥ç«™ã€‚ ChannelHandlerContext ä¿å­˜ Channel ç›¸å…³çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒåŒæ—¶å…³è”ä¸€ä¸ª ChannelHandler å¯¹è±¡ å³ ChannelHandlerContext ä¸­åŒ…å«ä¸€ä¸ªå…·ä½“çš„äº‹ä»¶å¤„ç†å™¨ ChannelHandlerï¼ŒåŒæ—¶ ChannelHandlerContext ä¸­ä¹Ÿç»‘å®šäº†å¯¹åº”çš„ pipeline å’Œ Channel çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿å¯¹ ChannelHandler è¿›è¡Œè°ƒç”¨ã€‚ å¸¸ç”¨æ–¹æ³• ChannelFuture close()ï¼Œå…³é—­é€šé“ ChannelOutboundInvoker flush()ï¼Œåˆ·æ–° ChannelFuture writeAndFlush(Object msg)ï¼Œå°†æ•°æ®å†™åˆ° ChannelPipeline ä¸­å½“å‰ ChannelHandler çš„ä¸‹ä¸€ä¸ª ChannelHandler å¼€å§‹å¤„ç†ï¼ˆå‡ºç«™ï¼‰ ChannelOption Netty åœ¨åˆ›å»º Channel å®žä¾‹åŽï¼Œä¸€èˆ¬éƒ½éœ€è¦è®¾ç½® ChannelOption å‚æ•°ã€‚ ChannelOption å‚æ•°å¦‚ä¸‹ï¼š EventLoopGroup å’Œå…¶å®žçŽ°ç±» NioEventLoopGroup EventLoopGroup æ˜¯ä¸€ç»„ EventLoop çš„æŠ½è±¡ï¼ŒNetty ä¸ºäº†æ›´å¥½çš„åˆ©ç”¨å¤šæ ¸ CPU èµ„æºï¼Œä¸€èˆ¬ä¼šæœ‰å¤šä¸ª EventLoop åŒæ—¶å·¥ä½œï¼Œæ¯ä¸ª EventLoop ç»´æŠ¤ç€ä¸€ä¸ª Selector å®žä¾‹ã€‚ EventLoopGroup æä¾› next æŽ¥å£ï¼Œå¯ä»¥ä»Žç»„é‡Œé¢æŒ‰ç…§ä¸€å®šè§„åˆ™èŽ·å–å…¶ä¸­ä¸€ä¸ª EventLoop æ¥å¤„ç†ä»»åŠ¡ã€‚åœ¨ Netty æœåŠ¡å™¨ç«¯ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½éœ€è¦æä¾›ä¸¤ä¸ª EventLoopGroupï¼Œä¾‹å¦‚ï¼šBossEventLoopGroup å’Œ WorkerEventLoopGroupã€‚ é€šå¸¸ä¸€ä¸ªæœåŠ¡ç«¯å£å³ä¸€ä¸ª ServerSocketChannel å¯¹åº”ä¸€ä¸ª Selector å’Œä¸€ä¸ª EventLoop çº¿ç¨‹ã€‚BossEventLoop è´Ÿè´£æŽ¥æ”¶å®¢æˆ·ç«¯çš„è¿žæŽ¥å¹¶å°† SocketChannel äº¤ç»™ WorkerEventLoopGroup æ¥è¿›è¡Œ IO å¤„ç†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º å¸¸ç”¨æ–¹æ³• public NioEventLoopGroup()ï¼Œæž„é€ æ–¹æ³• public Future&lt;?&gt; shutdownGracefully()ï¼Œæ–­å¼€è¿žæŽ¥ï¼Œå…³é—­çº¿ç¨‹ Unpooled ç±» Netty æä¾›ä¸€ä¸ªä¸“é—¨ç”¨æ¥æ“ä½œç¼“å†²åŒºï¼ˆå³ Netty çš„æ•°æ®å®¹å™¨ï¼‰çš„å·¥å…·ç±» å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤º ä¸¾ä¾‹è¯´æ˜Ž Unpooled èŽ·å– Netty çš„æ•°æ®å®¹å™¨ ByteBuf çš„åŸºæœ¬ä½¿ç”¨ ~ æ¡ˆä¾‹1ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.fyp.netty.buf;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;/** * @Auther: fyp * @Date: 2022/2/13 * @Description: ByteBufæµ‹è¯• * @Package: com.fyp.netty.buf * @Version: 1.0 */public class NettyByteBuf01 &#123; public static void main(String[] args) &#123; /* åˆ›å»ºä¸€ä¸ªByteBuf è¯´æ˜Ž: 1. åˆ›å»ºå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ åŒ…å«ä¸€ä¸ª æ•°ç»„ arrï¼Œæ˜¯ä¸€ä¸ª byte[10] 2. åœ¨ netty çš„ buffer ä¸­ï¼Œä¸éœ€è¦ ä½¿ç”¨ flip è¿›è¡Œ åè½¬ åº•å±‚ ç»´æŠ¤äº† readIndex å’Œ writeIndex 3. é€šè¿‡ readerIndex å’Œ writerIndex å’Œ capacity å°† buffer åˆ†ä¸º ä¸‰ä¸ª åŒºåŸŸ 0 - readerIndex å·²ç» è¯»å–çš„ åŒºåŸŸ readrIndex - writeIndex å¯è¯»çš„ åŒºåŸŸ writerIndex - capacity å¯å†™çš„ åŒºåŸŸ */ ByteBuf buffer = Unpooled.buffer(10); for (int i =0; i &lt; 10; i++) &#123; buffer.writeByte(i); &#125; System.out.println(&quot;capacity: &quot; + buffer.capacity()); //for (int i = 0; i &lt; buffer.capacity(); i++) &#123; // System.out.println(buffer.getByte(i)); //&#125; for (int i = 0; i &lt; buffer.capacity(); i++) &#123; System.out.println(buffer.readByte()); &#125; &#125;&#125; æ¡ˆä¾‹2 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.fyp.netty.buf;import io.netty.buffer.ByteBuf;import io.netty.buffer.Unpooled;import io.netty.util.CharsetUtil;/** * @Auther: fyp * @Date: 2022/2/13 * @Description: ByteBufæµ‹è¯• * @Package: com.fyp.netty.buf * @Version: 1.0 */public class NettyByteBuf02 &#123; public static void main(String[] args) &#123; // åˆ›å»º ByteBuf ByteBuf buf = Unpooled.copiedBuffer(&quot;hello,world!&quot;, CharsetUtil.UTF_8); if(buf.hasArray()) &#123; //true byte[] content = buf.array(); // å°† content è½¬æˆ å­—ç¬¦ä¸² System.out.println(new String(content, CharsetUtil.UTF_8)); System.out.println(&quot;ByteBuf= &quot; + buf); System.out.println(buf.arrayOffset()); System.out.println(buf.readerIndex()); System.out.println(buf.writerIndex()); System.out.println(buf.capacity()); int len = buf.readableBytes(); // å¯è¯»çš„ å­—èŠ‚æ•° System.out.println(&quot;len= &quot; + len); // ä½¿ç”¨ for å–å‡º å„ä¸ªå­—ç¬¦ for (int i = 0; i &lt; len; i++) &#123; System.out.println((char) buf.getUnsignedByte(i)); &#125; System.out.println(buf.getCharSequence(0, 4, CharsetUtil.UTF_8)); System.out.println(buf.getCharSequence(4, 6, CharsetUtil.UTF_8)); &#125; &#125;&#125; Netty åº”ç”¨å®žä¾‹-ç¾¤èŠç³»ç»Ÿå®žä¾‹è¦æ±‚ï¼š ç¼–å†™ä¸€ä¸ª Netty ç¾¤èŠç³»ç»Ÿï¼Œå®žçŽ°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéžé˜»å¡žï¼‰ å®žçŽ°å¤šäººç¾¤èŠ æœåŠ¡å™¨ç«¯ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®žçŽ°æ¶ˆæ¯è½¬å‘åŠŸèƒ½ å®¢æˆ·ç«¯ï¼šé€šè¿‡ channel å¯ä»¥æ— é˜»å¡žå‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æŽ¥å—å…¶å®ƒç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼ˆæœ‰æœåŠ¡å™¨è½¬å‘å¾—åˆ°ï¼‰ ç›®çš„ï¼šè¿›ä¸€æ­¥ç†è§£ Netty éžé˜»å¡žç½‘ç»œç¼–ç¨‹æœºåˆ¶ NioSocketChannelå’ŒNioSocketChannelå®žçŽ°çš„æŽ¥å£ NioSocketChannelå’ŒNioSocketChannelç»§æ‰¿çš„ç±» ä»£ç å¦‚ä¸‹ï¼š GroupChatServer 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package com.fyp.netty.groupchat;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.*;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioServerSocketChannel;import io.netty.handler.codec.string.StringDecoder;import io.netty.handler.codec.string.StringEncoder;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: ç¾¤èŠç³»ç»ŸæœåŠ¡ç«¯ * @Package: com.fyp.netty.groupchat * @Version: 1.0 */public class GroupChatServer &#123; private int port; // ç›‘å¬ç«¯å£ public GroupChatServer(int port) &#123; this.port = port; &#125; // ç¼–å†™ run æ–¹æ³•ï¼Œå¤„ç† å®¢æˆ·ç«¯çš„ è¯·æ±‚ public void run() throws Exception &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(1); EventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .option(ChannelOption.SO_BACKLOG, 128) .childOption(ChannelOption.SO_KEEPALIVE, true) .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; // èŽ·å–åˆ° pipeline ChannelPipeline pipeline = ch.pipeline(); // å‘ pipeline åŠ å…¥ è§£ç å™¨ pipeline.addLast(&quot;decoder&quot;, new StringDecoder()); // å‘ pipeline åŠ å…¥ ç¼–ç å™¨ pipeline.addLast(&quot;encoder&quot;, new StringEncoder()); // åŠ å…¥è‡ªå·± ä¸šåŠ¡å¤„ç†çš„ handler pipeline.addLast(new GroupChatServerHandler()); &#125; &#125;); System.out.println(&quot;netty æœåŠ¡å™¨å¯åŠ¨...&quot;); ChannelFuture channelFuture = serverBootstrap.bind(port).sync(); // ç›‘å¬ å…³é—­ channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125; public static void main(String[] args) throws Exception &#123; new GroupChatServer(7000).run(); &#125;&#125; GroupChatServerHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495package com.fyp.netty.groupchat;import io.netty.channel.Channel;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import io.netty.channel.group.ChannelGroup;import io.netty.channel.group.DefaultChannelGroup;import io.netty.util.concurrent.GlobalEventExecutor;import java.text.SimpleDateFormat;import java.util.Date;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: ç¾¤èŠç³»ç»ŸæœåŠ¡ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.groupchat * @Version: 1.0 */public class GroupChatServerHandler extends SimpleChannelInboundHandler&lt;String&gt; &#123; // å®šä¹‰ ä¸€ä¸ª channel ç»„ï¼Œ ç®¡ç†æ‰€æœ‰çš„ channel private static ChannelGroup channelGroup = new DefaultChannelGroup(GlobalEventExecutor.INSTANCE); SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;); /** * handlerAdded è¡¨ç¤ºè¿žæŽ¥å»ºç«‹ï¼Œ ä¸€æ—¦è¿žæŽ¥ï¼Œ ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œ * å°†å½“å‰çš„ channel åŠ å…¥åˆ° channelGroup * @param ctx * @throws Exception */ @Override public void handlerAdded(ChannelHandlerContext ctx) throws Exception &#123; Channel channel = ctx.channel(); // å°†è¯¥å®¢æˆ·ç«¯åŠ å…¥ èŠå¤©çš„ä¿¡æ¯ ï¼ŒæŽ¨é€ç»™ å…¶ä»– å®¢æˆ·ç«¯ /* è¯¥æ–¹æ³• ä¸ä¼š å°† channelGroup ä¸­ æ‰€æœ‰çš„ channel éåŽ†ï¼Œå¹¶å‘é€ æ¶ˆæ¯ æˆ‘ä»¬ ä¸éœ€è¦ è‡ªå·± éåŽ† */ channelGroup.writeAndFlush(&quot;[å®¢æˆ·ç«¯]&quot; + channel.remoteAddress() + &quot; åŠ å…¥èŠå¤© &quot; + sdf.format(new Date()) + &quot;\\t&quot;); channelGroup.add(channel); &#125; // æ–­å¼€ è¿žæŽ¥ï¼Œå°† xx å®¢æˆ·ç«¯ ç¦»å¼€ä¿¡æ¯ æŽ¨é€ç»™ å…¶ä»– åœ¨çº¿çš„ å®¢æˆ·ç«¯ @Override public void handlerRemoved(ChannelHandlerContext ctx) throws Exception &#123; Channel channel = ctx.channel(); channelGroup.writeAndFlush(&quot;[å®¢æˆ·ç«¯]&quot; + channel.remoteAddress() + &quot; ç¦»å¼€äº† \\t&quot;); System.out.println(&quot;channelGroup size &quot; + channelGroup.size()); &#125; // è¡¨ç¤º channel å¤„äºŽ æ´»åŠ¨çŠ¶æ€ï¼Œæç¤º xx åœ¨çº¿ @Override public void channelActive(ChannelHandlerContext ctx) throws Exception &#123; System.out.println(ctx.channel().remoteAddress() + &quot;ä¸Šçº¿äº†~&quot;); &#125; // è¡¨ç¤º channel å¤„äºŽ ä¸æ´»åŠ¨çŠ¶æ€ï¼Œæç¤º xx ä¸‹çº¿ @Override public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123; System.out.println(ctx.channel().remoteAddress() + &quot;ç¦»çº¿äº†~&quot;); &#125; @Override protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123; // èŽ·å–åˆ°å½“å‰çš„ channel Channel channel = ctx.channel(); // éåŽ† channelGroupï¼Œæ ¹æ®ä¸åŒçš„ æƒ…å†µï¼Œå›žé€ ä¸åŒçš„ æ¶ˆæ¯ channelGroup.forEach(ch -&gt; &#123; if (channel != ch) &#123; // ä¸æ˜¯å½“å‰çš„ channelï¼Œè½¬å‘æ¶ˆæ¯ ch.writeAndFlush(&quot;[å®¢æˆ·] &quot; + channel.remoteAddress() + &quot; å‘é€äº†æ¶ˆæ¯ï¼š &quot; + msg + &quot;\\n&quot;); &#125; else &#123;// å›žæ˜¾ è‡ªå·±å‘é€çš„æ¶ˆæ¯ ç»™è‡ªå·± ch.writeAndFlush(&quot;[è‡ªå·±] å‘é€äº†æ¶ˆæ¯ï¼š &quot; + msg + &quot;\\n&quot;); &#125; &#125;); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; // å…³é—­é€šé“ ctx.close(); &#125;&#125; GroupChatClient 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475package com.fyp.netty.groupchat;import io.netty.bootstrap.Bootstrap;import io.netty.channel.*;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioSocketChannel;import io.netty.handler.codec.string.StringDecoder;import io.netty.handler.codec.string.StringEncoder;import java.util.Scanner;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: ç¾¤èŠå®¢æˆ·ç«¯ * @Package: com.fyp.netty.groupchat * @Version: 1.0 */public class GroupChatClient &#123; //å±žæ€§ private final String host; private final int port; public GroupChatClient(String host, int port) &#123; this.host = host; this.port = port; &#125; public void run() throws InterruptedException &#123; EventLoopGroup group = new NioEventLoopGroup(); try &#123; Bootstrap bootstrap = new Bootstrap() .group(group) .channel(NioSocketChannel.class) .handler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; // å¾—åˆ° pipeline ChannelPipeline pipeline = ch.pipeline(); pipeline.addLast(&quot;decoder&quot;, new StringDecoder()); pipeline.addLast(&quot;encoder&quot;, new StringEncoder()); pipeline.addLast(new GroupChatClientHandler()); &#125; &#125;); ChannelFuture channelFuture = bootstrap.connect(host, port).sync(); Channel channel = channelFuture.channel(); System.out.println(&quot;-----&quot; + channel.localAddress() + &quot;-----&quot;); // å®¢æˆ·ç«¯ éœ€è¦ è¾“å…¥ä¿¡æ¯ï¼Œ åˆ›å»ºä¸€ä¸ª æ‰«æå™¨ Scanner scanner = new Scanner(System.in); while (scanner.hasNextLine()) &#123; String msg = scanner.nextLine(); // é€šè¿‡ channel å‘é€åˆ° æœåŠ¡å™¨ç«¯ channel.writeAndFlush(msg + &quot;\\r\\n&quot;); &#125; &#125; finally &#123; group.shutdownGracefully(); &#125; &#125; public static void main(String[] args) throws Exception&#123; new GroupChatClient(&quot;127.0.0.1&quot;, 7000).run(); &#125;&#125; GroupChatClientHandler 12345678910111213141516171819package com.fyp.netty.groupchat;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: ç¾¤èŠç³»ç»Ÿå®¢æˆ·ç«¯å¤„ç†å™¨ * @Package: com.fyp.netty.groupchat * @Version: 1.0 */public class GroupChatClientHandler extends SimpleChannelInboundHandler&lt;String&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, String msg) throws Exception &#123; System.out.println(msg.trim()); &#125;&#125; Netty å¿ƒè·³æ£€æµ‹æœºåˆ¶æ¡ˆä¾‹å®žä¾‹è¦æ±‚ï¼š ç¼–å†™ä¸€ä¸ª Netty å¿ƒè·³æ£€æµ‹æœºåˆ¶æ¡ˆä¾‹,å½“æœåŠ¡å™¨è¶…è¿‡ 3 ç§’æ²¡æœ‰è¯»æ—¶ï¼Œå°±æç¤ºè¯»ç©ºé—² å½“æœåŠ¡å™¨è¶…è¿‡ 5 ç§’æ²¡æœ‰å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºå†™ç©ºé—² å®žçŽ°å½“æœåŠ¡å™¨è¶…è¿‡ 7 ç§’æ²¡æœ‰è¯»æˆ–è€…å†™æ“ä½œæ—¶ï¼Œå°±æç¤ºè¯»å†™ç©ºé—² ä»£ç å¦‚ä¸‹ï¼š MyServer 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374package com.fyp.netty.heartbeat;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioServerSocketChannel;import io.netty.handler.logging.LogLevel;import io.netty.handler.logging.LoggingHandler;import io.netty.handler.timeout.IdleStateHandler;import java.util.concurrent.TimeUnit;import java.util.jar.Pack200;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: * @Package: com.fyp.netty.heartbeat * @Version: 1.0 */public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .handler(new LoggingHandler(LogLevel.INFO)) // åœ¨ bossGroup ä¸­ å¢žåŠ ä¸€ä¸ª æ—¥å¿— å¤„ç†å™¨ .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // åŠ å…¥ä¸€ä¸ª netty æä¾›çš„ IdleStateHandler /* è¯´æ˜Ž 1. IdleStateHandler æ˜¯ netty æä¾›çš„ å¤„ç† ç©ºé—²çŠ¶æ€çš„ å¤„ç†å™¨ 2.readerIdleTime è¡¨ç¤ºå¤šé•¿æ—¶é—´ æ²¡æœ‰è¯»ï¼Œå°±ä¼šå‘é€ä¸€ä¸ª å¿ƒè·³æ£€æµ‹åŒ… æ£€æµ‹æ˜¯å¦è¿žæŽ¥ 3. writerIdleTime è¡¨ç¤ºå¤šé•¿æ—¶é—´ æ²¡æœ‰å†™ï¼Œå°±ä¼šå‘é€ä¸€ä¸ª å¿ƒè·³æ£€æµ‹åŒ… æ£€æµ‹æ˜¯å¦è¿žæŽ¥ 4. allIdleTime è¡¨ç¤ºå¤šé•¿æ—¶é—´ æ²¡æœ‰è¯»å†™ï¼Œå°±ä¼šå‘é€ä¸€ä¸ª å¿ƒè·³æ£€æµ‹åŒ… æ£€æµ‹æ˜¯å¦è¿žæŽ¥ 5. æ–‡æ¡£è¯´æ˜Ž Triggers an &#123;@link IdleStateEvent&#125; when a &#123;@link Channel&#125; has not performed read, write, or both operation for a while. 6. å½“ IdleStateEvent è§¦å‘åŽï¼Œ å°±ä¼š ä¼ é€’ç»™ç®¡é“ çš„ä¸‹ä¸€ä¸ª handler åŽ»å¤„ç† é€šè¿‡ è°ƒç”¨ï¼ˆè§¦å‘ï¼‰ä¸‹ä¸€ä¸ª handler çš„ userEventTriggered, åœ¨è¯¥æ–¹æ³•ä¸­åŽ»å¤„ç† IdleStateEventï¼ˆè¯»ç©ºé—²ï¼Œå†™ç©ºé—²ï¼Œè¯»å†™ç©ºé—²ï¼‰ */ pipeline.addLast(new IdleStateHandler(3, 5, 7 , TimeUnit.SECONDS)); // åŠ å…¥ä¸€ä¸ª å¯¹ ç©ºé—²æ£€æµ‹ è¿›è¡Œå¤„ç†çš„ handler pipeline.addLast(new MyServerHandler()); &#125; &#125;); ChannelFuture channelFuture = serverBootstrap.bind(7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; MyServerHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.fyp.netty.heartbeat;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.ChannelInboundHandlerAdapter;import io.netty.handler.timeout.IdleStateEvent;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: MyServer å¤„ç†å™¨ * @Package: com.fyp.netty.heartbeat * @Version: 1.0 */public class MyServerHandler extends ChannelInboundHandlerAdapter &#123; /** * * @param ctx ä¸Šä¸‹æ–‡ * @param evt äº‹ä»¶ * @throws Exception */ @Override public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123; if (evt instanceof IdleStateEvent) &#123; // å°† evt å‘ä¸‹è½¬åž‹ä¸º IdleStateEvent IdleStateEvent event = (IdleStateEvent) evt; String eventType = null; switch (event.state()) &#123; case READER_IDLE: eventType = &quot;è¯»ç©ºé—²&quot;; break; case WRITER_IDLE: eventType = &quot;å†™ç©ºé—²&quot;; break; case ALL_IDLE: eventType = &quot;è¯»å†™ç©ºé—²&quot;; break; &#125; System.out.println(ctx.channel().remoteAddress() + &quot;--è¶…æ—¶äº‹ä»¶--&quot; + eventType); System.out.println(&quot;æœåŠ¡å™¨åšç›¸åº”å¤„ç†&quot;); &#125; &#125;&#125; Netty é€šè¿‡ WebSocket ç¼–ç¨‹å®žçŽ°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é•¿è¿žæŽ¥å®žä¾‹è¦æ±‚ï¼š Http åè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨é—´çš„è¯·æ±‚å“åº”ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡ä¼šé‡æ–°åˆ›å»ºè¿žæŽ¥ã€‚ è¦æ±‚ï¼šå®žçŽ°åŸºäºŽ WebSocket çš„é•¿è¿žæŽ¥çš„å…¨åŒå·¥çš„äº¤äº’ æ”¹å˜ Http åè®®å¤šæ¬¡è¯·æ±‚çš„çº¦æŸï¼Œå®žçŽ°é•¿è¿žæŽ¥äº†ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘é€æ¶ˆæ¯ç»™æµè§ˆå™¨ å®¢æˆ·ç«¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç«¯ä¼šç›¸äº’æ„ŸçŸ¥ï¼Œæ¯”å¦‚æœåŠ¡å™¨å…³é—­äº†ï¼Œæµè§ˆå™¨ä¼šæ„ŸçŸ¥ï¼ŒåŒæ ·æµè§ˆå™¨å…³é—­äº†ï¼ŒæœåŠ¡å™¨ä¼šæ„ŸçŸ¥ è¿è¡Œç•Œé¢ MyServer 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package com.fyp.netty.websocket;import com.fyp.netty.heartbeat.MyServerHandler;import io.netty.bootstrap.ServerBootstrap;import io.netty.channel.ChannelFuture;import io.netty.channel.ChannelInitializer;import io.netty.channel.ChannelPipeline;import io.netty.channel.EventLoopGroup;import io.netty.channel.nio.NioEventLoopGroup;import io.netty.channel.socket.SocketChannel;import io.netty.channel.socket.nio.NioServerSocketChannel;import io.netty.handler.codec.http.HttpObjectAggregator;import io.netty.handler.codec.http.HttpServerCodec;import io.netty.handler.codec.http.websocketx.WebSocketServerProtocolHandler;import io.netty.handler.logging.LogLevel;import io.netty.handler.logging.LoggingHandler;import io.netty.handler.stream.ChunkedWriteHandler;import io.netty.handler.timeout.IdleStateHandler;import java.util.concurrent.TimeUnit;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: * @Package: com.fyp.netty.websocket * @Version: 1.0 */public class MyServer &#123; public static void main(String[] args) throws InterruptedException &#123; EventLoopGroup bossGroup = new NioEventLoopGroup(); NioEventLoopGroup workerGroup = new NioEventLoopGroup(); try &#123; ServerBootstrap serverBootstrap = new ServerBootstrap(); serverBootstrap.group(bossGroup, workerGroup) .channel(NioServerSocketChannel.class) .handler(new LoggingHandler(LogLevel.INFO)) // åœ¨ bossGroup ä¸­ å¢žåŠ ä¸€ä¸ª æ—¥å¿— å¤„ç†å™¨ .childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123; @Override protected void initChannel(SocketChannel ch) throws Exception &#123; ChannelPipeline pipeline = ch.pipeline(); // å› ä¸º åŸºäºŽ httpåè®®ï¼Œä½¿ç”¨ httpçš„ ç¼–ç å’Œè§£ç  pipeline.addLast(new HttpServerCodec()); // æ˜¯ ä»¥å—æ–¹å¼ å†™ï¼Œæ·»åŠ  ChunkedWriteHandler å¤„ç†å™¨ pipeline.addLast(new ChunkedWriteHandler()); /* è¯´æ˜Ž 1. httpæ•°æ® åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åˆ†æ®µçš„ï¼Œ HttpObjectAggregator å°±æ˜¯å¯ä»¥å°† å¤šä¸ªæ®µ èšåˆ 2.è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ å½“ æµè§ˆå™¨ å‘é€ å¤§é‡æ•°æ®æ—¶ï¼Œ å°±ä¼š å‘é€ å¤šæ¬¡ httpè¯·æ±‚ */ pipeline.addLast(new HttpObjectAggregator(8192)); /* è¯´æ˜Ž 1. å¯¹åº”çš„ webSocket, å®ƒçš„æ•°æ® ä»¥å¸§ï¼ˆframeï¼‰å½¢å¼ä¼ é€’ 2. å¯ä»¥çœ‹åˆ°WebSocketFrame ä¸‹é¢æœ‰å…­ä¸ªå­ç±» 3. æµè§ˆå™¨è¯·æ±‚æ—¶ï¼Œ ws://localhost:7000/xxx è¡¨ç¤ºè¯·æ±‚çš„uri 4. WebSocketServerProtocolHandler æ ¸å¿ƒåŠŸèƒ½æ˜¯ å°† httpåè®® å‡çº§ä¸º ws åè®®ï¼Œä¿æŒé•¿é“¾æŽ¥ */ pipeline.addLast(new WebSocketServerProtocolHandler(&quot;/hello&quot;)); // è‡ªå®šä¹‰çš„ handler,å¤„ç†ä¸šåŠ¡é€»è¾‘ pipeline.addLast(new MyTextWebSocketFrameHandler()); &#125; &#125;); ChannelFuture channelFuture = serverBootstrap.bind(7000).sync(); channelFuture.channel().closeFuture().sync(); &#125; finally &#123; bossGroup.shutdownGracefully(); workerGroup.shutdownGracefully(); &#125; &#125;&#125; MyTextWebSocketFrameHandler 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.fyp.netty.websocket;import io.netty.channel.ChannelHandlerContext;import io.netty.channel.SimpleChannelInboundHandler;import io.netty.handler.codec.http.websocketx.TextWebSocketFrame;import java.time.LocalDateTime;/** * @Auther: fyp * @Date: 2022/2/14 * @Description: * @Package: com.fyp.netty.websocket * @Version: 1.0 */public class MyTextWebSocketFrameHandler extends SimpleChannelInboundHandler&lt;TextWebSocketFrame&gt; &#123; @Override protected void channelRead0(ChannelHandlerContext ctx, TextWebSocketFrame msg) throws Exception &#123; System.out.println(&quot;æœåŠ¡ç«¯é€åˆ°æ¶ˆæ¯ &quot; + msg.text()); // å›žå¤æ¶ˆæ¯ ctx.channel().writeAndFlush(new TextWebSocketFrame(&quot;æœåŠ¡å™¨æ—¶é—´&quot; + LocalDateTime.now() + &quot; &quot; + msg.text())); &#125; // å½“ å®¢æˆ·ç«¯è¿žæŽ¥åŽï¼Œ è§¦å‘æ–¹æ³• @Override public void handlerAdded(ChannelHandlerContext ctx) throws Exception &#123; // id è¡¨ç¤º å”¯ä¸€çš„å€¼ LongTextæ˜¯å”¯ä¸€çš„ ShortTextä¸æ˜¯å”¯ä¸€çš„ System.out.println(&quot;handlerAdded è¢«è°ƒç”¨&quot; + ctx.channel().id().asLongText()); System.out.println(&quot;handlerAdded è¢«è°ƒç”¨&quot; + ctx.channel().id().asShortText()); &#125; @Override public void handlerRemoved(ChannelHandlerContext ctx) throws Exception &#123; System.out.println(&quot;handlerRemoved è¢«è°ƒç”¨&quot; + ctx.channel().id().asLongText()); &#125; @Override public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123; System.out.println(&quot;å¼‚å¸¸å‘ç”Ÿ &quot; + cause.getMessage()); &#125;&#125; hello.html 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;script&gt; var socket; // åˆ¤æ–­å½“å‰ æµè§ˆå™¨ æ˜¯å¦æ”¯æŒ webSocket if (window.WebSocket) &#123; // go on // ç›¸å½“äºŽ channelRead0, evæ”¶åˆ°æœåŠ¡å™¨ç«¯å›žé€çš„æ¶ˆæ¯ socket = new WebSocket(&quot;ws://localhost:7000/hello&quot;); socket.onmessage = function (ev) &#123; var rt = document.getElementById(&quot;responseText&quot;); rt.value = rt.value + &quot;\\n&quot; + ev.data; &#125; // ç›¸å½“äºŽ è¿žæŽ¥å¼€å¯ï¼ˆæ„ŸçŸ¥åˆ°è¿žæŽ¥å¼€å¯ï¼‰ socket.onopen = function(ev) &#123; var rt = document.getElementById(&quot;responseText&quot;); rt.value = &quot;è¿žæŽ¥å¼€å¯äº†...&quot;; &#125; // ç›¸å½“äºŽ è¿žæŽ¥å…³é—­ï¼ˆæ„ŸçŸ¥åˆ°è¿žæŽ¥å…³é—­ï¼‰ socket.onclose = function (ev) &#123; var rt = document.getElementById(&quot;responseText&quot;); rt.value = rt.value + &quot;\\n&quot; + &quot;è¿žæŽ¥å…³é—­äº†...&quot;; &#125; &#125; else &#123; alert(&quot;å½“å‰æµè§ˆå™¨ä¸æ”¯æŒwebSocket&quot;) &#125; // å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨ function send(message) &#123; if(!window.socket) &#123; // å…ˆåˆ¤æ–­ socket æ˜¯å¦åˆ›å»ºå¥½ return; &#125; if (socket.readyState == WebSocket.OPEN) &#123; // é€šè¿‡ socket å‘é€æ¶ˆæ¯ socket.send(message); &#125; else &#123; alert(&quot;è¿žæŽ¥æ²¡æœ‰å¼€å¯&quot;); &#125; &#125;&lt;/script&gt; &lt;form onsubmit=&quot;return false&quot;&gt; &lt;textarea name=&quot;message&quot; style=&quot;height: 300px; width: 300px&quot;&gt;&lt;/textarea&gt; &lt;input type=&quot;button&quot; value=&quot;å‘é€æ¶ˆæ¯&quot; onclick=&quot;send(this.form.message.value)&quot;&gt;&lt;br&gt; &lt;textarea id=&quot;responseText&quot; style=&quot;height: 300px; width: 300px&quot;&gt;&lt;/textarea&gt; &lt;input type=&quot;button&quot; value=&quot;è¯·ç©ºå†…å®¹&quot; onclick=&quot;document.getElementById(&#x27;responseText&#x27;).value=&#x27;&#x27;&quot;&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt;","categories":[{"name":"Javaæ¡†æž¶","slug":"Javaæ¡†æž¶","permalink":"http://fyupeng.github.io/categories/Java%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"netty","slug":"netty","permalink":"http://fyupeng.github.io/tags/netty/"}],"author":"fyupeng"},{"title":"Netty å…¥é—¨ - 01","slug":"Netty01","date":"2022-06-25T07:04:05.000Z","updated":"2022-06-25T07:09:26.824Z","comments":true,"path":"2022/06/25/Netty01/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/Netty01/","excerpt":"","text":"ä¸€ã€ Nettyç®€ä»‹1. Nettyä»‹ç» Netty æ˜¯ç”± JBOSS æä¾›çš„ä¸€ä¸ª Java å¼€æºæ¡†æž¶ï¼ŒçŽ°ä¸º Github ä¸Šçš„ç‹¬ç«‹é¡¹ç›®ã€‚ Netty æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ã€åŸºäºŽäº‹ä»¶é©±åŠ¨çš„ç½‘ç»œåº”ç”¨æ¡†æž¶ï¼Œç”¨ä»¥å¿«é€Ÿå¼€å‘é«˜æ€§èƒ½ã€é«˜å¯é æ€§çš„ç½‘ç»œ IO ç¨‹åºã€‚ Netty ä¸»è¦é’ˆå¯¹åœ¨ TCP åè®®ä¸‹ï¼Œé¢å‘ Client ç«¯çš„é«˜å¹¶å‘åº”ç”¨ï¼Œæˆ–è€… Peer-to-Peer åœºæ™¯ä¸‹çš„å¤§é‡æ•°æ®æŒç»­ä¼ è¾“çš„åº”ç”¨ã€‚ Netty æœ¬è´¨æ˜¯ä¸€ä¸ª NIO æ¡†æž¶ï¼Œé€‚ç”¨äºŽæœåŠ¡å™¨é€šè®¯ç›¸å…³çš„å¤šç§åº”ç”¨åœºæ™¯ã€‚ è¦é€å½»ç†è§£ Nettyï¼Œéœ€è¦å…ˆå­¦ä¹  NIOï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½é˜…è¯» Netty çš„æºç ã€‚ 2. Nettyçš„åº”ç”¨åœºæ™¯äº’è”ç½‘è¡Œä¸š äº’è”ç½‘è¡Œä¸šï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¹‹é—´éœ€è¦è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œé«˜æ€§èƒ½çš„ RPC æ¡†æž¶å¿…ä¸å¯å°‘ï¼ŒNetty ä½œä¸ºå¼‚æ­¥é«˜æ€§èƒ½çš„é€šä¿¡æ¡†æž¶ï¼Œå¾€å¾€ä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶è¢«è¿™äº› RPC æ¡†æž¶ä½¿ç”¨ã€‚ å…¸åž‹çš„åº”ç”¨æœ‰ï¼šé˜¿é‡Œåˆ†å¸ƒå¼æœåŠ¡æ¡†æž¶ Dubbo çš„ RPC æ¡† æž¶ä½¿ç”¨ Dubbo åè®®è¿›è¡ŒèŠ‚ç‚¹é—´é€šä¿¡ï¼ŒDubbo åè®®é»˜è®¤ä½¿ç”¨ Netty ä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œç”¨äºŽå®žçŽ°å„è¿›ç¨‹èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡ã€‚ æ¸¸æˆè¡Œä¸š æ¸¸æˆè¡Œä¸š åè®®æ ˆï¼Œæ–¹ä¾¿å®šåˆ¶å’Œå¼€å‘ç§æœ‰åè®®æ ˆï¼Œè´¦å·ç™»å½•æœåŠ¡å™¨ã€‚ Netty ä½œä¸ºé«˜æ€§èƒ½çš„åŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œæä¾›äº† TCP/UDP å’Œ HTTP åè®®æ ˆï¼Œæ–¹ä¾¿å®šåˆ¶å’Œå¼€å‘ç§æœ‰åè®®æ ˆï¼Œè´¦å·ç™»å½•æœåŠ¡å™¨ã€‚ åœ°å›¾æœåŠ¡å™¨ä¹‹é—´å¯ä»¥æ–¹ä¾¿çš„é€šè¿‡ Netty è¿›è¡Œé«˜æ€§èƒ½çš„é€šä¿¡ã€‚ å¤§æ•°æ®é¢†åŸŸ ç»å…¸çš„ Hadoop çš„é«˜æ€§èƒ½é€šä¿¡å’Œåºåˆ—åŒ–ç»„ä»¶ Avro çš„ RPC æ¡†æž¶ï¼Œé»˜è®¤é‡‡ç”¨ Netty è¿›è¡Œè·¨ç•Œç‚¹é€šä¿¡ã€‚ å®ƒçš„ NettyService åŸºäºŽ Netty æ¡†æž¶äºŒæ¬¡å°è£…å®žçŽ°ã€‚ å¤§æ•°æ®è¡Œä¸š ç»å…¸çš„ Hadoop çš„é«˜æ€§èƒ½é€šä¿¡å’Œåºåˆ—åŒ–ç»„ä»¶ Avro çš„ RPC æ¡†æž¶ï¼Œé»˜è®¤é‡‡ç”¨ Netty è¿›è¡Œè·¨ç•Œç‚¹é€šä¿¡ã€‚ å®ƒçš„ NettyService åŸºäºŽ Netty æ¡†æž¶äºŒæ¬¡å°è£…å®žçŽ°ã€‚ äºŒã€Java BIOç¼–ç¨‹1. I/Oæ¨¡åž‹ I/O æ¨¡åž‹ç®€å•çš„ç†è§£ï¼šå°±æ˜¯ç”¨ä»€ä¹ˆæ ·çš„é€šé“è¿›è¡Œæ•°æ®çš„å‘é€å’ŒæŽ¥æ”¶ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå†³å®šäº†ç¨‹åºé€šä¿¡çš„æ€§èƒ½ã€‚ Java å…±æ”¯æŒ 3 ç§ç½‘ç»œç¼–ç¨‹æ¨¡åž‹ I/O æ¨¡å¼ï¼šBIOã€NIOã€AIOã€‚ Java BIOï¼šåŒæ­¥å¹¶é˜»å¡žï¼ˆä¼ ç»Ÿé˜»å¡žåž‹ï¼‰ï¼ŒæœåŠ¡å™¨å®žçŽ°æ¨¡å¼ä¸ºä¸€ä¸ªè¿žæŽ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿žæŽ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æžœè¿™ä¸ªè¿žæŽ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ã€‚ã€ç®€å•ç¤ºæ„å›¾ã€‘ Java NIOï¼šåŒæ­¥éžé˜»å¡žï¼ŒæœåŠ¡å™¨å®žçŽ°æ¨¡å¼ä¸ºä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªè¯·æ±‚ï¼ˆè¿žæŽ¥)ï¼Œå³å®¢æˆ·ç«¯å‘é€çš„è¿žæŽ¥è¯·æ±‚éƒ½ä¼šæ³¨å†Œåˆ°å¤šè·¯å¤ç”¨å™¨ä¸Šï¼Œå¤šè·¯å¤ç”¨å™¨è½®è¯¢åˆ°è¿žæŽ¥æœ‰ I/O è¯·æ±‚å°±è¿›è¡Œå¤„ç†ã€‚ã€ç®€å•ç¤ºæ„å›¾ã€‘ Java AIO(NIO.2)ï¼šå¼‚æ­¥éžé˜»å¡žï¼ŒAIO å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ï¼Œç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®ŒæˆåŽæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹åŽ»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºŽè¿žæŽ¥æ•°è¾ƒå¤šä¸”è¿žæŽ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨ã€‚ 2. BIOã€NIOã€AIOä½¿ç”¨åœºæ™¯åˆ†æž BIO æ–¹å¼é€‚ç”¨äºŽè¿žæŽ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æž¶æž„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºŽåº”ç”¨ä¸­ï¼ŒJDK1.4 ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œä½†ç¨‹åºç®€å•æ˜“ç†è§£ã€‚ NIO æ–¹å¼é€‚ç”¨äºŽè¿žæŽ¥æ•°ç›®å¤šä¸”è¿žæŽ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æž¶æž„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¼¹å¹•ç³»ç»Ÿï¼ŒæœåŠ¡å™¨é—´é€šè®¯ç­‰ã€‚ç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK1.4 å¼€å§‹æ”¯æŒã€‚ AIO æ–¹å¼ä½¿ç”¨äºŽè¿žæŽ¥æ•°ç›®å¤šä¸”è¿žæŽ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æž¶æž„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨ OS å‚ä¸Žå¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7 å¼€å§‹æ”¯æŒã€‚ 3. Java BIOåŸºæœ¬ä»‹ç» Java BIO å°±æ˜¯ä¼ ç»Ÿçš„ Java I/O ç¼–ç¨‹ï¼Œå…¶ç›¸å…³çš„ç±»å’ŒæŽ¥å£åœ¨ java.ioã€‚ BIO(BlockingI/O)ï¼šåŒæ­¥é˜»å¡žï¼ŒæœåŠ¡å™¨å®žçŽ°æ¨¡å¼ä¸ºä¸€ä¸ªè¿žæŽ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œå³å®¢æˆ·ç«¯æœ‰è¿žæŽ¥è¯·æ±‚æ—¶æœåŠ¡å™¨ç«¯å°±éœ€è¦å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œå¦‚æžœè¿™ä¸ªè¿žæŽ¥ä¸åšä»»ä½•äº‹æƒ…ä¼šé€ æˆä¸å¿…è¦çš„çº¿ç¨‹å¼€é”€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ï¼ˆå®žçŽ°å¤šä¸ªå®¢æˆ·è¿žæŽ¥æœåŠ¡å™¨ï¼‰ã€‚ã€åŽæœ‰åº”ç”¨å®žä¾‹ã€‘ BIO æ–¹å¼é€‚ç”¨äºŽè¿žæŽ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æž¶æž„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºŽåº”ç”¨ä¸­ï¼ŒJDK1.4 ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ï¼Œç¨‹åºç®€å•æ˜“ç†è§£ã€‚ 4. Java BIOå·¥ä½œæœºåˆ¶ å¯¹ BIO ç¼–ç¨‹æµç¨‹çš„æ¢³ç† æœåŠ¡å™¨ç«¯å¯åŠ¨ä¸€ä¸ª ServerSocketã€‚ å®¢æˆ·ç«¯å¯åŠ¨ Socket å¯¹æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œé»˜è®¤æƒ…å†µä¸‹æœåŠ¡å™¨ç«¯éœ€è¦å¯¹æ¯ä¸ªå®¢æˆ·å»ºç«‹ä¸€ä¸ªçº¿ç¨‹ä¸Žä¹‹é€šè®¯ã€‚ å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åŽï¼Œå…ˆå’¨è¯¢æœåŠ¡å™¨æ˜¯å¦æœ‰çº¿ç¨‹å“åº”ï¼Œå¦‚æžœæ²¡æœ‰åˆ™ä¼šç­‰å¾…ï¼Œæˆ–è€…è¢«æ‹’ç»ã€‚ å¦‚æžœæœ‰å“åº”ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹ä¼šç­‰å¾…è¯·æ±‚ç»“æŸåŽï¼Œå†ç»§ç»­æ‰§è¡Œã€‚ 5. Java BIOåº”ç”¨å®žä¾‹å®žä¾‹è¯´æ˜Žï¼š ä½¿ç”¨ BIO æ¨¡åž‹ç¼–å†™ä¸€ä¸ªæœåŠ¡å™¨ç«¯ï¼Œç›‘å¬ 6666 ç«¯å£ï¼Œå½“æœ‰å®¢æˆ·ç«¯è¿žæŽ¥æ—¶ï¼Œå°±å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ä¸Žä¹‹é€šè®¯ã€‚ è¦æ±‚ä½¿ç”¨çº¿ç¨‹æ± æœºåˆ¶æ”¹å–„ï¼Œå¯ä»¥è¿žæŽ¥å¤šä¸ªå®¢æˆ·ç«¯ã€‚ æœåŠ¡å™¨ç«¯å¯ä»¥æŽ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼ˆtelnet æ–¹å¼å³å¯ï¼‰ã€‚ ä»£ç æ¼”ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384package com.fyp.bio;import java.io.IOException;import java.io.InputStream;import java.net.ServerSocket;import java.net.Socket;import java.util.concurrent.ExecutorService;import java.util.concurrent.Executors;/** * @Auther: fyp * @Date: 2022/1/31 * @Description: BIOæœåŠ¡ * @Package: com.fyp.bio * @Version: 1.0 */public class BIOServer &#123; public static void main(String[] args) throws IOException &#123; /** * æ€è·¯ï¼š * 1. åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±  * 2. å¦‚æžœæœ‰å®¢æˆ·é“¾æŽ¥ï¼Œå°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸Žä¹‹é€šè®¯ï¼ˆå•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•ï¼‰ */ ExecutorService newCachedThreadPool = Executors.newCachedThreadPool(); //åˆ›å»ºServerSocket ServerSocket serverSocket = new ServerSocket(6666); System.out.println(&quot;æœåŠ¡å™¨å¯åŠ¨äº†&quot;); while (true) &#123; System.out.println(&quot;ç­‰å¾…è¿žæŽ¥&quot;); //ç›‘å¬ï¼Œç­‰å¾…å®¢æˆ·ç«¯é“¾æŽ¥ final Socket socket = serverSocket.accept(); System.out.println(&quot;è¿žæŽ¥åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯&quot;); //åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸Žä¹‹é€šè®¯ï¼ˆå•ç‹¬å†™ä¸€ä¸ªæ–¹æ³•ï¼‰ newCachedThreadPool.execute(new Runnable() &#123; @Override public void run() &#123; //å¯ä»¥å®¢æˆ·ç«¯é€šè®¯ handler(socket); &#125; &#125;); &#125; &#125; //ç¼–å†™ä¸€ä¸ªhandleæ–¹æ³•ï¼Œå’Œå®¢æˆ·ç«¯é€šè®¯ public static void handler(Socket socket) &#123; try &#123; System.out.println(&quot;çº¿ç¨‹ä¿¡æ¯ id = &quot; + Thread.currentThread().getId() + &quot; åå­— = &quot; + Thread.currentThread().getName()); byte[] bytes = new byte[10]; //é€šè¿‡SocketèŽ·å–è¾“å…¥æµ InputStream inputStream = socket.getInputStream(); while (true) &#123; System.out.println(&quot;read....&quot;); //æ²¡æœ‰è¯»åˆ°æ•°æ®ä¼šé˜»å¡ž int read = inputStream.read(bytes); if(read != -1) &#123; System.out.println(&quot;çº¿ç¨‹ä¿¡æ¯ id = &quot; + Thread.currentThread().getId() + &quot; åå­— = &quot; + Thread.currentThread().getName() + &quot; -- &quot; + new String(bytes, 0, read)); &#125; else &#123; System.out.println(&quot;break&quot;); break; &#125; &#125; System.out.println(&quot;è·³å‡ºreadå¾ªçŽ¯&quot;); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; System.out.println(&quot;å…³é—­å’Œclientçš„è¿žæŽ¥&quot;); try &#123; socket.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; 6. æ€»ç»“ æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åˆ›å»ºç‹¬ç«‹çš„çº¿ç¨‹ï¼Œä¸Žå¯¹åº”çš„å®¢æˆ·ç«¯è¿›è¡Œæ•°æ® Readï¼Œä¸šåŠ¡å¤„ç†ï¼Œæ•°æ® Writeã€‚ å½“å¹¶å‘æ•°è¾ƒå¤§æ—¶ï¼Œéœ€è¦åˆ›å»ºå¤§é‡çº¿ç¨‹æ¥å¤„ç†è¿žæŽ¥ï¼Œç³»ç»Ÿèµ„æºå ç”¨è¾ƒå¤§ã€‚ è¿žæŽ¥å»ºç«‹åŽï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æš‚æ—¶æ²¡æœ‰æ•°æ®å¯è¯»ï¼Œåˆ™çº¿ç¨‹å°±é˜»å¡žåœ¨ Read æ“ä½œä¸Šï¼Œé€ æˆçº¿ç¨‹èµ„æºæµªè´¹ã€‚ ä¸‰ã€Java NIOç¼–ç¨‹1. Java NIOåŸºæœ¬ä»‹ç» Java NIO å…¨ç§° Java non-blocking IOï¼Œæ˜¯æŒ‡ JDK æä¾›çš„æ–° APIã€‚ä»Ž JDK1.4 å¼€å§‹ï¼ŒJava æä¾›äº†ä¸€ç³»åˆ—æ”¹è¿›çš„è¾“å…¥/è¾“å‡ºçš„æ–°ç‰¹æ€§ï¼Œè¢«ç»Ÿç§°ä¸º NIOï¼ˆå³ NewIOï¼‰ï¼Œæ˜¯åŒæ­¥éžé˜»å¡žçš„ã€‚ NIO ç›¸å…³ç±»éƒ½è¢«æ”¾åœ¨ java.nio åŒ…åŠå­åŒ…ä¸‹ï¼Œå¹¶ä¸”å¯¹åŽŸ java.io åŒ…ä¸­çš„å¾ˆå¤šç±»è¿›è¡Œæ”¹å†™ã€‚ã€åŸºæœ¬æ¡ˆä¾‹ã€‘ NIO æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š**Channelï¼ˆé€šé“ï¼‰ã€Bufferï¼ˆç¼“å†²åŒºï¼‰ã€Selectorï¼ˆé€‰æ‹©å™¨ï¼‰** ã€‚ NIO æ˜¯é¢å‘ç¼“å†²åŒºï¼Œæˆ–è€…é¢å‘å—ç¼–ç¨‹çš„ã€‚æ•°æ®è¯»å–åˆ°ä¸€ä¸ªå®ƒç¨åŽå¤„ç†çš„ç¼“å†²åŒºï¼Œéœ€è¦æ—¶å¯åœ¨ç¼“å†²åŒºä¸­å‰åŽç§»åŠ¨ï¼Œè¿™å°±å¢žåŠ äº†å¤„ç†è¿‡ç¨‹ä¸­çš„çµæ´»æ€§ï¼Œä½¿ç”¨å®ƒå¯ä»¥æä¾›éžé˜»å¡žå¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œã€‚ Java NIO çš„éžé˜»å¡žæ¨¡å¼ï¼Œä½¿ä¸€ä¸ªçº¿ç¨‹ä»ŽæŸé€šé“å‘é€è¯·æ±‚æˆ–è€…è¯»å–æ•°æ®ï¼Œä½†æ˜¯å®ƒä»…èƒ½å¾—åˆ°ç›®å‰å¯ç”¨çš„æ•°æ®ï¼Œå¦‚æžœç›®å‰æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œå°±ä»€ä¹ˆéƒ½ä¸ä¼šèŽ·å–ï¼Œè€Œä¸æ˜¯ä¿æŒçº¿ç¨‹é˜»å¡žï¼Œæ‰€ä»¥ç›´è‡³æ•°æ®å˜çš„å¯ä»¥è¯»å–ä¹‹å‰ï¼Œè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­åšå…¶ä»–çš„äº‹æƒ…ã€‚éžé˜»å¡žå†™ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹è¯·æ±‚å†™å…¥ä¸€äº›æ•°æ®åˆ°æŸé€šé“ï¼Œä½†ä¸éœ€è¦ç­‰å¾…å®ƒå®Œå…¨å†™å…¥ï¼Œè¿™ä¸ªçº¿ç¨‹åŒæ—¶å¯ä»¥åŽ»åšåˆ«çš„äº‹æƒ…ã€‚ã€åŽé¢æœ‰æ¡ˆä¾‹è¯´æ˜Žã€‘ é€šä¿—ç†è§£ï¼šNIO æ˜¯å¯ä»¥åšåˆ°ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¤šä¸ªæ“ä½œçš„ã€‚å‡è®¾æœ‰ 10000 ä¸ªè¯·æ±‚è¿‡æ¥,æ ¹æ®å®žé™…æƒ…å†µï¼Œå¯ä»¥åˆ†é… 50 æˆ–è€… 100 ä¸ªçº¿ç¨‹æ¥å¤„ç†ã€‚ä¸åƒä¹‹å‰çš„é˜»å¡ž IO é‚£æ ·ï¼Œéžå¾—åˆ†é… 10000 ä¸ªã€‚ HTTP 2.0 ä½¿ç”¨äº†å¤šè·¯å¤ç”¨çš„æŠ€æœ¯ï¼Œåšåˆ°åŒä¸€ä¸ªè¿žæŽ¥å¹¶å‘å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œè€Œä¸”å¹¶å‘è¯·æ±‚çš„æ•°é‡æ¯” HTTP 1.1 å¤§äº†å¥½å‡ ä¸ªæ•°é‡çº§ã€‚ 2. NIOå’ŒBIOçš„æ¯”è¾ƒ BIO ä»¥æµçš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œè€Œ NIO ä»¥å—çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œå— I/O çš„æ•ˆçŽ‡æ¯”æµ I/O é«˜å¾ˆå¤šã€‚ BIO æ˜¯é˜»å¡žçš„ï¼ŒNIO åˆ™æ˜¯éžé˜»å¡žçš„ã€‚ BIO åŸºäºŽå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œè€Œ NIO åŸºäºŽ Channelï¼ˆé€šé“ï¼‰å’Œ Bufferï¼ˆç¼“å†²åŒºï¼‰è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»Žé€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»Žç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ç”¨äºŽç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè¿žæŽ¥è¯·æ±‚ï¼Œæ•°æ®åˆ°è¾¾ç­‰ï¼‰ï¼Œå› æ­¤ä½¿ç”¨å•ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯é€šé“ã€‚ Bufferå’ŒChannelä¹‹é—´çš„æ•°æ®æµå‘æ˜¯åŒå‘çš„ 3. NIOä¸‰å¤§æ ¸å¿ƒåŽŸç†ç¤ºæ„å›¾ä¸€å¼ å›¾æè¿° NIO çš„ Selectorã€Channel å’Œ Buffer çš„å…³ç³»ã€‚ Selectorã€Channel å’Œ Buffer å…³ç³»å›¾ï¼ˆç®€å•ç‰ˆï¼‰å…³ç³»å›¾çš„è¯´æ˜Ž: æ¯ä¸ª Channel éƒ½ä¼šå¯¹åº”ä¸€ä¸ª Bufferã€‚ Selector å¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”å¤šä¸ª Channelï¼ˆè¿žæŽ¥ï¼‰ã€‚ è¯¥å›¾ååº”äº†æœ‰ä¸‰ä¸ª Channel æ³¨å†Œåˆ°è¯¥ Selector //ç¨‹åº ç¨‹åºåˆ‡æ¢åˆ°å“ªä¸ª Channel æ˜¯ç”±äº‹ä»¶å†³å®šçš„ï¼ŒEvent å°±æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚ Selector ä¼šæ ¹æ®ä¸åŒçš„äº‹ä»¶ï¼Œåœ¨å„ä¸ªé€šé“ä¸Šåˆ‡æ¢ã€‚ Buffer å°±æ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œåº•å±‚æ˜¯æœ‰ä¸€ä¸ªæ•°ç»„ã€‚ æ•°æ®çš„è¯»å–å†™å…¥æ˜¯é€šè¿‡ Bufferï¼Œè¿™ä¸ªå’Œ BIOæ˜¯ä¸åŒçš„ï¼ŒBIO ä¸­è¦ä¹ˆæ˜¯è¾“å…¥æµï¼Œæˆ–è€…æ˜¯è¾“å‡ºæµï¼Œä¸èƒ½åŒå‘ï¼Œä½†æ˜¯ NIO çš„ Buffer æ˜¯å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™ï¼Œéœ€è¦ flip æ–¹æ³•åˆ‡æ¢ Channel æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¿”å›žåº•å±‚æ“ä½œç³»ç»Ÿçš„æƒ…å†µï¼Œæ¯”å¦‚ Linuxï¼Œåº•å±‚çš„æ“ä½œç³»ç»Ÿé€šé“å°±æ˜¯åŒå‘çš„ã€‚ 4. ç¼“å†²åŒºï¼ˆBufferï¼‰ç¼“å†²åŒºï¼ˆBufferï¼‰ï¼šç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥è¯»å†™æ•°æ®çš„å†…å­˜å—ï¼Œå¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼ˆå«æ•°ç»„ï¼‰ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€ç»„æ–¹æ³•ï¼Œå¯ä»¥æ›´è½»æ¾åœ°ä½¿ç”¨å†…å­˜å—ï¼Œç¼“å†²åŒºå¯¹è±¡å†…ç½®äº†ä¸€äº›æœºåˆ¶ï¼Œèƒ½å¤Ÿè·Ÿè¸ªå’Œè®°å½•ç¼“å†²åŒºçš„çŠ¶æ€å˜åŒ–æƒ…å†µã€‚Channel æä¾›ä»Žæ–‡ä»¶ã€ç½‘ç»œè¯»å–æ•°æ®çš„æ¸ é“ï¼Œä½†æ˜¯è¯»å–æˆ–å†™å…¥çš„æ•°æ®éƒ½å¿…é¡»ç»ç”± Bufferï¼Œå¦‚å›¾:ã€åŽé¢ä¸¾ä¾‹è¯´æ˜Žã€‘ Buffer ç±»åŠå…¶å­ç±» åœ¨ NIO ä¸­ï¼ŒBuffer æ˜¯ä¸€ä¸ªé¡¶å±‚çˆ¶ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œç±»çš„å±‚çº§å…³ç³»å›¾ Buffer ç±»å®šä¹‰äº†æ‰€æœ‰çš„ç¼“å†²åŒºéƒ½å…·æœ‰çš„å››ä¸ªå±žæ€§æ¥æä¾›å…³äºŽå…¶æ‰€åŒ…å«çš„æ•°æ®å…ƒç´ çš„ä¿¡æ¯ï¼š Buffer ç±»ç›¸å…³æ–¹æ³•ä¸€è§ˆ ByteBufferä»Žå‰é¢å¯ä»¥çœ‹å‡ºå¯¹äºŽ Java ä¸­çš„åŸºæœ¬æ•°æ®ç±»åž‹ï¼ˆboolean é™¤å¤–ï¼‰ï¼Œéƒ½æœ‰ä¸€ä¸ª Buffer ç±»åž‹ä¸Žä¹‹ç›¸å¯¹åº”ï¼Œæœ€å¸¸ç”¨çš„è‡ªç„¶æ˜¯ ByteBuffer ç±»ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ï¼Œè¯¥ç±»çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š 5. é€šé“(Channel)åŸºæœ¬ä»‹ç» NIOçš„é€šé“ç±»ä¼¼äºŽæµï¼Œä½†æœ‰äº›åŒºåˆ«å¦‚ä¸‹ï¼š é€šé“å¯ä»¥åŒæ—¶è¿›è¡Œè¯»å†™ï¼Œè€Œæµåªèƒ½è¯»æˆ–è€…åªèƒ½å†™ é€šé“å¯ä»¥å®žçŽ°å¼‚æ­¥è¯»å†™æ•°æ® é€šé“å¯ä»¥ä»Žç¼“å†²è¯»æ•°æ®ï¼Œä¹Ÿå¯ä»¥å†™æ•°æ®åˆ°ç¼“å†²: BIO ä¸­çš„ Stream æ˜¯å•å‘çš„ï¼Œä¾‹å¦‚ FileInputStream å¯¹è±¡åªèƒ½è¿›è¡Œè¯»å–æ•°æ®çš„æ“ä½œï¼Œè€Œ NIO ä¸­çš„é€šé“ï¼ˆChannelï¼‰æ˜¯åŒå‘çš„ï¼Œå¯ä»¥è¯»æ“ä½œï¼Œä¹Ÿå¯ä»¥å†™æ“ä½œã€‚ Channel åœ¨ NIO ä¸­æ˜¯ä¸€ä¸ªæŽ¥å£ public interface Channel extends Closeable&#123;&#125; å¸¸ç”¨çš„ Channel ç±»æœ‰ï¼š**FileChannelã€DatagramChannelã€ServerSocketChannel å’Œ SocketChannel**ã€‚ã€ServerSocketChanne ç±»ä¼¼ ServerSocketã€SocketChannel ç±»ä¼¼ Socketã€‘ FileChannel ç”¨äºŽæ–‡ä»¶çš„æ•°æ®è¯»å†™ï¼ŒDatagramChannel ç”¨äºŽ UDP çš„æ•°æ®è¯»å†™ï¼ŒServerSocketChannel å’Œ SocketChannel ç”¨äºŽ TCP çš„æ•°æ®è¯»å†™ã€‚ å›¾ç¤º FileChannel ç±»FileChannel ä¸»è¦ç”¨æ¥å¯¹æœ¬åœ°æ–‡ä»¶è¿›è¡Œ IO æ“ä½œï¼Œå¸¸è§çš„æ–¹æ³•æœ‰ public int read(ByteBuffer dst)ï¼Œä»Žé€šé“è¯»å–æ•°æ®å¹¶æ”¾åˆ°ç¼“å†²åŒºä¸­ public int write(ByteBuffer src)ï¼ŒæŠŠç¼“å†²åŒºçš„æ•°æ®å†™åˆ°é€šé“ä¸­ public long transferFrom(ReadableByteChannel src, long position, long count)ï¼Œä»Žç›®æ ‡é€šé“ä¸­å¤åˆ¶æ•°æ®åˆ°å½“å‰é€šé“ public long transferTo(long position, long count, WritableByteChannel target)ï¼ŒæŠŠæ•°æ®ä»Žå½“å‰é€šé“å¤åˆ¶ç»™ç›®æ ‡é€šé“ åº”ç”¨å®žä¾‹1 - æœ¬åœ°æ–‡ä»¶å†™æ•°æ®å®žä¾‹è¦æ±‚ï¼š ä½¿ç”¨å‰é¢å­¦ä¹ åŽçš„ ByteBufferï¼ˆç¼“å†²ï¼‰å’Œ FileChannelï¼ˆé€šé“ï¼‰ï¼Œå°† â€œhello,å°šç¡…è°·â€ å†™å…¥åˆ° file01.txt ä¸­ æ–‡ä»¶ä¸å­˜åœ¨å°±åˆ›å»º ä»£ç æ¼”ç¤º 123456789101112131415161718192021222324252627282930313233343536373839404142package com.fyp.nio;import sun.nio.ByteBuffered;import java.io.FileOutputStream;import java.io.IOException;import java.nio.ByteBuffer;import java.nio.channels.FileChannel;/** * @Auther: fyp * @Date: 2022/2/4 * @Description: ä½¿ç”¨Channelå†™æ–‡ä»¶ * @Package: com.fyp.nio * @Version: 1.0 */public class NIOFileChannel01 &#123; public static void main(String[] args) throws IOException &#123; String str = &quot;hello,å°šç¡…è°·&quot;; //åˆ›å»ºä¸€ä¸ªè¾“å‡ºæµ -&gt; Channel FileOutputStream fileOutputStream = new FileOutputStream(&quot;d:\\\\file01.txt&quot;); //é€šè¿‡fileOutStreamèŽ·å–å¯¹åº”çš„ FileChannel //è¿™ä¸ªfileChannel çš„çœŸæ˜¯ç±»åž‹æ˜¯ FileChannelImpl FileChannel fileChannel = fileOutputStream.getChannel(); //åˆ›å»ºä¸€ä¸ªç¼“å†²åŒº ByteBuffer ByteBuffer byteBuffer = ByteBuffer.allocate(1024); //å°†stræ”¾å…¥byteBuffer byteBuffer.put(str.getBytes()); //å¯¹byteBuffer è¿›è¡Œflip byteBuffer.flip(); //å°†byteBufferå†™å…¥åˆ° fileChannel fileChannel.write(byteBuffer); fileOutputStream.close(); &#125;&#125; åº”ç”¨å®žä¾‹2 - æœ¬åœ°æ–‡ä»¶è¯»æ•°æ®å®žä¾‹è¦æ±‚ï¼š ä½¿ç”¨å‰é¢å­¦ä¹ åŽçš„ ByteBufferï¼ˆç¼“å†²ï¼‰å’Œ FileChannelï¼ˆé€šé“ï¼‰ï¼Œå°† file01.txt ä¸­çš„æ•°æ®è¯»å…¥åˆ°ç¨‹åºï¼Œå¹¶æ˜¾ç¤ºåœ¨æŽ§åˆ¶å°å±å¹• å‡å®šæ–‡ä»¶å·²ç»å­˜åœ¨ ä»£ç æ¼”ç¤º 12345678910111213141516171819202122232425262728293031323334353637package com.fyp.nio;import com.sun.xml.internal.fastinfoset.stax.events.AttributeBase;import java.io.*;import java.nio.ByteBuffer;import java.nio.channels.FileChannel;/** * @Auther: fyp * @Date: 2022/2/4 * @Description: ä½¿ç”¨Channelè¯»æ–‡ä»¶ * @Package: com.fyp.nio * @Version: 1.0 */public class NIOFileChannel02 &#123; public static void main(String[] args) throws IOException &#123; //åˆ›å»ºæ–‡ä»¶è¾“å…¥æµ File file = new File(&quot;d:\\\\file01.txt&quot;); FileInputStream fileInputStream = new FileInputStream(file); //é€šè¿‡fileInputStreamèŽ·å–å¯¹åº”çš„FileChannel -&gt; å®žé™…ç±»åž‹ FileChannelImpl FileChannel fileChannel = fileInputStream.getChannel(); //åˆ›å»ºç¼“å†²åŒº ByteBuffer byteBuffer = ByteBuffer.allocate((int) file.length()); //å°†é€šé“çš„æ•°æ®è¯»å…¥åˆ°Buffer fileChannel.read(byteBuffer); //å°† byteBuffer çš„å­—èŠ‚æ•°æ®è½¬æˆ String System.out.println(new String(byteBuffer.array())); fileInputStream.close(); &#125;&#125; åº”ç”¨å®žä¾‹3 - ä½¿ç”¨ä¸€ä¸ª Buffer å®Œæˆæ–‡ä»¶è¯»å–ã€å†™å…¥å®žä¾‹è¦æ±‚ï¼š ä½¿ç”¨ FileChannelï¼ˆé€šé“ï¼‰å’Œæ–¹æ³• readã€writeï¼Œå®Œæˆæ–‡ä»¶çš„æ‹·è´ æ‹·è´ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ 1.txtï¼Œæ”¾åœ¨é¡¹ç›®ä¸‹å³å¯ ä»£ç æ¼”ç¤º 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.fyp.nio;import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.FileOutputStream;import java.io.IOException;import java.nio.ByteBuffer;import java.nio.channels.FileChannel;/** * @Auther: fyp * @Date: 2022/2/4 * @Description: ä½¿ç”¨Channelè¯»å†™æ–‡ä»¶ * @Package: com.fyp.nio * @Version: 1.0 */public class NIOFileChannel03 &#123; public static void main(String[] args) throws IOException &#123; FileInputStream fileInputStream = new FileInputStream(&quot;1.txt&quot;); FileChannel fileChannel01 = fileInputStream.getChannel(); FileOutputStream fileOutputStream = new FileOutputStream(&quot;2.txt&quot;); FileChannel fileChannel02 = fileOutputStream.getChannel(); ByteBuffer byteBuffer = ByteBuffer.allocate(512); while (true) &#123; //å¾ªçŽ¯è¯»æ•° /* public final Buffer clear() &#123; this.position = 0; this.limit = this.capacity; this.mark = -1; return this; &#125; */ byteBuffer.clear(); int read = fileChannel01.read(byteBuffer); System.out.println(&quot;read= &quot; + read); if (read == -1) &#123; //è¡¨ç¤ºè¯»å®Œ break; &#125; //å°†buffer ä¸­çš„æ•°æ® å†™å…¥åˆ° fileChannel02 --- 2.txt byteBuffer.flip(); fileChannel02.write(byteBuffer); &#125; fileInputStream.close(); &#125;&#125; åº”ç”¨å®žä¾‹4 - æ‹·è´æ–‡ä»¶ transferFrom æ–¹æ³• å®žä¾‹è¦æ±‚ï¼š ä½¿ç”¨ FileChannelï¼ˆé€šé“ï¼‰å’Œæ–¹æ³• transferFromï¼Œå®Œæˆæ–‡ä»¶çš„æ‹·è´ æ‹·è´ä¸€å¼ å›¾ç‰‡ ä»£ç æ¼”ç¤º 12345678910111213141516171819202122232425262728293031323334package com.fyp.nio;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.IOException;import java.nio.channels.FileChannel;/** * @Auther: fyp * @Date: 2022/2/4 * @Description: æ‹·è´æ–‡ä»¶-transferFromæ–¹æ³• * @Package: com.fyp.nio * @Version: 1.0 */public class NIOFileChannel04 &#123; public static void main(String[] args) throws IOException &#123; //åˆ›å»ºè¾“å…¥æµå’Œè¾“å‡ºæµ FileInputStream fileInputStream = new FileInputStream(&quot;d:\\\\wallhaven.png&quot;); FileOutputStream fileOutputStream = new FileOutputStream(&quot;d:\\\\wallhaven01.png&quot;); //èŽ·å–å„ä¸ªæµå¯¹åº”çš„Channel FileChannel sourceCh = fileInputStream.getChannel(); FileChannel destCh = fileOutputStream.getChannel(); //ä½¿ç”¨transferFromå®Œæˆæ‹·è´ destCh.transferFrom(sourceCh, 0, sourceCh.size()); //å…³é—­ç›¸å…³é€šé“å’Œæµ sourceCh.close(); destCh.close(); fileInputStream.close(); fileOutputStream.close(); &#125;&#125; å…³äºŽ Buffer å’Œ Channel çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚ ByteBuffer æ”¯æŒç±»åž‹åŒ–çš„ put å’Œ getï¼Œput æ”¾å…¥çš„æ˜¯ä»€ä¹ˆæ•°æ®ç±»åž‹ï¼Œget å°±åº”è¯¥ä½¿ç”¨ç›¸åº”çš„æ•°æ®ç±»åž‹æ¥å–å‡ºï¼Œå¦åˆ™å¯èƒ½æœ‰ BufferUnderflowException å¼‚å¸¸ã€‚ã€ä¸¾ä¾‹è¯´æ˜Žã€‘ 12345678910111213141516171819202122232425262728293031323334353637package com.fyp.nio;import java.nio.Buffer;import java.nio.ByteBuffer;/** * @Auther: fyp * @Date: 2022/2/4 * @Description: * @Package: com.fyp.nio * @Version: 1.0 */public class NIOByteBufferPutGet &#123; public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªBuffer ByteBuffer byteBuffer = ByteBuffer.allocate(64); //ç±»åž‹åŒ–æ“ä½œæ”¾å…¥æ•°æ® byteBuffer.putInt(100); byteBuffer.putLong(9); byteBuffer.putChar(&#x27;å°š&#x27;); byteBuffer.putShort((short) 4); //å–å‡º byteBuffer.flip(); System.out.println(); //æŒ‰é€šé“é¡ºåºèŽ·å–,å› ä¸ºèŽ·å–ä¼šç§»åŠ¨position //è€ŒèŽ·å–çš„æ•°æ®æ˜¯ä»Žpositionå‡ºå‘çš„ï¼Œæ ¹æ®èŽ·å–çš„getç±»åž‹æ¥å®šé‡positionç§»åŠ¨ System.out.println(byteBuffer.getInt()); System.out.println(byteBuffer.getLong()); System.out.println(byteBuffer.getChar()); System.out.println(byteBuffer.getShort()); &#125;&#125; å¯ä»¥å°†ä¸€ä¸ªæ™®é€š Buffer è½¬æˆåªè¯» Bufferã€ä¸¾ä¾‹è¯´æ˜Žã€‘ 1234567891011121314151617181920212223242526272829303132333435363738package com.fyp.nio;import java.nio.Buffer;import java.nio.ByteBuffer;/** * @Auther: fyp * @Date: 2022/2/4 * @Description: * @Package: com.fyp.nio * @Version: 1.0 */public class ReadOnlyBuffer &#123; public static void main(String[] args) &#123; //åˆ›å»ºä¸€ä¸ªBuffer ByteBuffer byteBuffer = ByteBuffer.allocate(64); for (int i = 0; i &lt; 64; i++) &#123; byteBuffer.put((byte) i); &#125; //è¯»å– byteBuffer.flip(); //å¾—åˆ°ä¸€ä¸ªåªè¯»Buffer ByteBuffer readOnlyBuffer = byteBuffer.asReadOnlyBuffer(); System.out.println(readOnlyBuffer.getClass()); //è¯»å– while (readOnlyBuffer.hasRemaining()) &#123; System.out.println(readOnlyBuffer.get()); &#125; //ä¼šæŠ›å‡º ReadOnlyBufferException å¼‚å¸¸ //readOnlyBuffer.put((byte) 100); &#125;&#125; NIO è¿˜æä¾›äº† MappedByteBufferï¼Œå¯ä»¥è®©æ–‡ä»¶ç›´æŽ¥åœ¨å†…å­˜ï¼ˆå †å¤–çš„å†…å­˜ï¼‰ä¸­è¿›è¡Œä¿®æ”¹ï¼Œè€Œå¦‚ä½•åŒæ­¥åˆ°æ–‡ä»¶ç”± NIO æ¥å®Œæˆã€‚ã€ä¸¾ä¾‹è¯´æ˜Žã€‘ 1234567891011121314151617181920212223242526272829303132333435363738394041package com.fyp.nio;import java.io.RandomAccessFile;import java.nio.MappedByteBuffer;import java.nio.channels.FileChannel;/** * @Auther: fyp * @Date: 2022/2/5 * @Description: ç›´æŽ¥ä¿®æ”¹å†…å­˜ * @Package: com.fyp.nio * @Version: 1.0 *//*è¯´æ˜Žï¼š1. MappedByteBuffer å¯è®©æ–‡ä»¶ç›´æŽ¥åœ¨å†…å­˜ä¿®æ”¹ï¼Œæ“ä½œç³»ç»Ÿä¸éœ€è¦æ‹·è´ä¸€æ¬¡ */public class MappedByteBufferTest &#123; public static void main(String[] args) throws Exception &#123; RandomAccessFile randomAccessFile = new RandomAccessFile(&quot;1.txt&quot;, &quot;rw&quot;); FileChannel channel = randomAccessFile.getChannel(); /** * å‚æ•°1: FileChannel.MapMode.READ_WRITE ä½¿ç”¨çš„è¯»å†™æ¨¡å¼ * å‚æ•°2: 0: å¯ä»¥ç›´æŽ¥ä¿®æ”¹çš„åˆå§‹ä½ç½® * å‚æ•°3: 5: æ˜¯æ˜ å°„åˆ°å†…å­˜çš„å¤§å°ï¼Œå³å°† 1.txt çš„å¤šå°‘ä¸ªå­—èŠ‚æ˜ å°„åˆ°å†…å­˜ * å¯ä»¥ç›´æŽ¥ä¿®æ”¹çš„èŒƒå›´å°±æ˜¯ 0-5 */ MappedByteBuffer mappedByteBuffer = channel.map(FileChannel.MapMode.READ_WRITE, 0, 5); mappedByteBuffer.put(0, (byte) &#x27;H&#x27;); mappedByteBuffer.put(3, (byte) &#x27;9&#x27;); //ä¼šæŠ›å‡º IndexOutOfBoundsException å¼‚å¸¸ //mappedByteBuffer.put(5, (byte) &#x27;Y&#x27;); randomAccessFile.close(); &#125;&#125; å‰é¢æˆ‘ä»¬è®²çš„è¯»å†™æ“ä½œï¼Œéƒ½æ˜¯é€šè¿‡ä¸€ä¸ª Buffer å®Œæˆçš„ï¼ŒNIO è¿˜æ”¯æŒé€šè¿‡å¤šä¸ª Bufferï¼ˆå³ Bufferæ•°ç»„ï¼‰å®Œæˆè¯»å†™æ“ä½œï¼Œå³ Scattering å’Œ Gatheringã€ä¸¾ä¾‹è¯´æ˜Žã€‘ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.fyp.nio;/** * @Auther: fyp * @Date: 2022/2/5 * @Description: Scatterå’ŒGatherçš„ä½¿ç”¨ * @Package: com.fyp.nio * @Version: 1.0 */import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.ServerSocketChannel;import java.nio.channels.SocketChannel;import java.util.Arrays;/** * Scattering: å°†æ•°æ®å†™å…¥åˆ°bufferæ—¶ï¼Œå¯ä»¥ é‡‡ç”¨bufferæ•°ç»„ï¼Œä¾æ¬¡å†™å…¥[åˆ†æ•£] * Gathering: ä»Žbufferè¯»å–æ•°æ®æ—¶ï¼Œå¯ä»¥ é‡‡ç”¨bufferæ•°ç»„ï¼Œä¾æ¬¡è¯» */public class ScatteringAndGatheringTest &#123; public static void main(String[] args) throws Exception&#123; //ä½¿ç”¨ServerSocketChannel å’Œ SocketChannel ç½‘ç»œ ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); InetSocketAddress inetSocketAddress = new InetSocketAddress(7000); //ç»‘å®šç«¯å£åˆ°socket, å¹¶å¯åŠ¨ serverSocketChannel.socket().bind(inetSocketAddress); ByteBuffer[] byteBuffers = new ByteBuffer[2]; byteBuffers[0] = ByteBuffer.allocate(5); byteBuffers[1] = ByteBuffer.allocate(3); //ç­‰å¾…å®¢æˆ·ç«¯è¿žæŽ¥ (telnet) SocketChannel socketChannel = serverSocketChannel.accept(); int messageLength = 8; //å¾ªçŽ¯åœ°è¯»æ•° while (true) &#123; int byteRead = 0; while (byteRead &lt; messageLength) &#123; long l = socketChannel.read(byteBuffers); byteRead += l;//ç´¯è®¡è¯»å–çš„å­—èŠ‚æ•° System.out.println(&quot;byteRead= &quot; + byteRead); //ä½¿ç”¨æµæ‰“å°ï¼ŒæŸ¥çœ‹å½“å‰çš„è¿™ä¸ªbufferçš„position å’Œ limit Arrays.asList(byteBuffers).stream().map(buffer -&gt; &quot;position= &quot; + buffer.position() + &quot;,limit= &quot; + buffer.limit()).forEach(System.out::println); &#125; //å°†æ‰€æœ‰çš„buffer è¿›è¡Œ flip Arrays.asList(byteBuffers).forEach(buffer -&gt; buffer.flip()); //å°†æ•°æ®è¯»å‡ºæ˜¾ç¤ºåˆ°å®¢æˆ·ç«¯ long byteWrite = 0; while (byteWrite &lt; messageLength) &#123; long l = socketChannel.write(byteBuffers); byteWrite += 1; &#125; //å°†æ‰€æœ‰çš„ buffer è¿›è¡Œ clear Arrays.asList(byteBuffers).forEach(buffer -&gt; &#123; buffer.clear(); &#125;); System.out.println(&quot;byteRead= &quot; + byteRead + &quot;,byteWrite= &quot; + byteWrite + &quot;,messageLength= &quot; + messageLength); &#125; &#125;&#125; 6. é€‰æ‹©å™¨ï¼ˆSelectorï¼‰åŸºæœ¬ä»‹ç» Java çš„ NIOï¼Œç”¨éžé˜»å¡žçš„ IO æ–¹å¼ã€‚å¯ä»¥ç”¨ä¸€ä¸ªçº¿ç¨‹ï¼Œå¤„ç†å¤šä¸ªçš„å®¢æˆ·ç«¯è¿žæŽ¥ï¼Œå°±ä¼šä½¿ç”¨åˆ° Selectorï¼ˆé€‰æ‹©å™¨ï¼‰ã€‚ Selector èƒ½å¤Ÿæ£€æµ‹å¤šä¸ªæ³¨å†Œçš„é€šé“ä¸Šæ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆæ³¨æ„ï¼šå¤šä¸ª Channel ä»¥äº‹ä»¶çš„æ–¹å¼å¯ä»¥æ³¨å†Œåˆ°åŒä¸€ä¸ª Selectorï¼‰ï¼Œå¦‚æžœæœ‰äº‹ä»¶å‘ç”Ÿï¼Œä¾¿èŽ·å–äº‹ä»¶ç„¶åŽé’ˆå¯¹æ¯ä¸ªäº‹ä»¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è¿™æ ·å°±å¯ä»¥åªç”¨ä¸€ä¸ªå•çº¿ç¨‹åŽ»ç®¡ç†å¤šä¸ªé€šé“ï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å¤šä¸ªè¿žæŽ¥å’Œè¯·æ±‚ã€‚ åªæœ‰åœ¨è¿žæŽ¥/é€šé“çœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰ä¼šè¿›è¡Œè¯»å†™ï¼Œå°±å¤§å¤§åœ°å‡å°‘äº†ç³»ç»Ÿå¼€é”€ï¼Œå¹¶ä¸”ä¸å¿…ä¸ºæ¯ä¸ªè¿žæŽ¥éƒ½åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸ç”¨åŽ»ç»´æŠ¤å¤šä¸ªçº¿ç¨‹ã€‚ é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¯¼è‡´çš„å¼€é”€ã€‚ Selector ç¤ºæ„å›¾å’Œç‰¹ç‚¹è¯´æ˜Ž è¯´æ˜Žå¦‚ä¸‹ï¼š Netty çš„ IO çº¿ç¨‹ NioEventLoop èšåˆäº† Selectorï¼ˆé€‰æ‹©å™¨ï¼Œä¹Ÿå«å¤šè·¯å¤ç”¨å™¨ï¼‰ï¼Œå¯ä»¥åŒæ—¶å¹¶å‘å¤„ç†æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯è¿žæŽ¥ã€‚ å½“çº¿ç¨‹ä»ŽæŸå®¢æˆ·ç«¯ Socket é€šé“è¿›è¡Œè¯»å†™æ•°æ®æ—¶ï¼Œè‹¥æ²¡æœ‰æ•°æ®å¯ç”¨æ—¶ï¼Œè¯¥çº¿ç¨‹å¯ä»¥è¿›è¡Œå…¶ä»–ä»»åŠ¡ã€‚ çº¿ç¨‹é€šå¸¸å°†éžé˜»å¡ž IO çš„ç©ºé—²æ—¶é—´ç”¨äºŽåœ¨å…¶ä»–é€šé“ä¸Šæ‰§è¡Œ IO æ“ä½œï¼Œæ‰€ä»¥å•ç‹¬çš„çº¿ç¨‹å¯ä»¥ç®¡ç†å¤šä¸ªè¾“å…¥å’Œè¾“å‡ºé€šé“ã€‚ ç”±äºŽè¯»å†™æ“ä½œéƒ½æ˜¯éžé˜»å¡žçš„ï¼Œè¿™å°±å¯ä»¥å……åˆ†æå‡ IO çº¿ç¨‹çš„è¿è¡Œæ•ˆçŽ‡ï¼Œé¿å…ç”±äºŽé¢‘ç¹ I/O é˜»å¡žå¯¼è‡´çš„çº¿ç¨‹æŒ‚èµ·ã€‚ ä¸€ä¸ª I/O çº¿ç¨‹å¯ä»¥å¹¶å‘å¤„ç† N ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥å’Œè¯»å†™æ“ä½œï¼Œè¿™ä»Žæ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»ŸåŒæ­¥é˜»å¡ž I/O ä¸€è¿žæŽ¥ä¸€çº¿ç¨‹æ¨¡åž‹ï¼Œæž¶æž„çš„æ€§èƒ½ã€å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›å’Œå¯é æ€§éƒ½å¾—åˆ°äº†æžå¤§çš„æå‡ã€‚ Selector ç±»ç›¸å…³æ–¹æ³• æ³¨æ„äº‹é¡¹ NIO ä¸­çš„ ServerSocketChannel åŠŸèƒ½ç±»ä¼¼ ServerSocketã€SocketChannel åŠŸèƒ½ç±»ä¼¼ Socketã€‚ Selectorç›¸å…³æ–¹æ³•è¯´æ˜Ž selector.select(); //é˜»å¡ž selector.select(1000); //é˜»å¡ž 1000 æ¯«ç§’ï¼Œåœ¨ 1000 æ¯«ç§’åŽè¿”å›ž selector.wakeup(); //å”¤é†’ selector selector.selectNow(); //ä¸é˜»å¡žï¼Œç«‹é©¬è¿”è¿˜ 7. NIOéžé˜»å¡žç½‘ç»œç¼–ç¨‹åŽŸç†åˆ†æžå›¾NIO éžé˜»å¡žç½‘ç»œç¼–ç¨‹ç›¸å…³çš„ï¼ˆSelectorã€SelectionKeyã€ServerScoketChannel å’Œ SocketChannelï¼‰å…³ç³»æ¢³ç†å›¾ å¯¹ä¸Šå›¾çš„è¯´æ˜Žï¼š å½“å®¢æˆ·ç«¯è¿žæŽ¥æ—¶ï¼Œä¼šé€šè¿‡ ServerSocketChannel å¾—åˆ° SocketChannelã€‚ Selector è¿›è¡Œç›‘å¬ select æ–¹æ³•ï¼Œè¿”å›žæœ‰äº‹ä»¶å‘ç”Ÿçš„é€šé“çš„ä¸ªæ•°ã€‚ å°† socketChannel æ³¨å†Œåˆ° Selector ä¸Šï¼Œregister(Selector sel, int ops)ï¼Œä¸€ä¸ª Selector ä¸Šå¯ä»¥æ³¨å†Œå¤šä¸ª SocketChannelã€‚ æ³¨å†ŒåŽè¿”å›žä¸€ä¸ª SelectionKeyï¼Œä¼šå’Œè¯¥ Selector å…³è”ï¼ˆé›†åˆï¼‰ã€‚ è¿›ä¸€æ­¥å¾—åˆ°å„ä¸ª SelectionKeyï¼ˆæœ‰äº‹ä»¶å‘ç”Ÿï¼‰ã€‚ åœ¨é€šè¿‡ SelectionKey åå‘èŽ·å– SocketChannelï¼Œæ–¹æ³• channel()ã€‚ å¯ä»¥é€šè¿‡å¾—åˆ°çš„ channelï¼Œå®Œæˆä¸šåŠ¡å¤„ç†ã€‚ ç›´æŽ¥çœ‹åŽé¢ä»£ç å§ 8. NIOéžé˜»å¡žç½‘ç»œç¼–ç¨‹å¿«é€Ÿå…¥é—¨æ¡ˆä¾‹ï¼š ç¼–å†™ä¸€ä¸ª NIO å…¥é—¨æ¡ˆä¾‹ï¼Œå®žçŽ°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéžé˜»å¡žï¼‰ ç›®çš„ï¼šç†è§£ NIO éžé˜»å¡žç½‘ç»œç¼–ç¨‹æœºåˆ¶ æœåŠ¡ç«¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package com.fyp.nio;import java.io.IOException;import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.*;import java.util.Iterator;import java.util.Set;/** * @Auther: fyp * @Date: 2022/2/5 * @Description: NIOæœåŠ¡å™¨ * @Package: com.fyp.nio * @Version: 1.0 */public class NIOServer &#123; public static void main(String[] args) throws IOException &#123; //åˆ›å»ºServerSocketChannel -&gt; ServerSocket ServerSocketChannel serverSocketChannel = ServerSocketChannel.open(); //å¾—åˆ°ä¸€ä¸ªSelectorå¯¹è±¡ Selector selector = Selector.open(); //ç»‘å®šä¸€ä¸ªç«¯å£6666ï¼Œåœ¨æœåŠ¡ç«¯ç›‘å¬ serverSocketChannel.socket().bind(new InetSocketAddress(6666)); //è®¾ç½®ä¸ºéžé˜»å¡ž serverSocketChannel.configureBlocking(false); //æŠŠ serverSocketChannel æ³¨å†Œåˆ° selector, å…³æ³¨äº‹ä»¶ ä¸º OP_ACCEPT serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT); //å¾ªçŽ¯ç­‰å¾…å®¢æˆ·ç«¯è¿žæŽ¥ while (true) &#123; //è¿™é‡Œæˆ‘ä»¬ç­‰å¾…1ç§’ï¼Œå¦‚æžœæ²¡æœ‰äº‹ä»¶å‘ç”Ÿï¼ˆè¿žæŽ¥äº‹ä»¶ï¼‰ if (selector.select(1000) == 0) &#123;//æ²¡æœ‰äº‹ä»¶å‘ç”Ÿ System.out.println(&quot;æœåŠ¡å™¨ç­‰å¾…äº†1ç§’ï¼Œæ— è¿žæŽ¥&quot;); continue; &#125; //å¦‚æžœè¿”å›žçš„ &gt; 0, å°±èŽ·å–åˆ°ç›¸å…³çš„ selectionKeyé›†åˆ //1. å¦‚æžœè¿”å›žçš„ &gt; 0, è¡¨ç¤ºå·²ç»èŽ·å–åˆ°å…³æ³¨çš„äº‹ä»¶ //2. selector.selectedKeys() è¿”å›žå…³æ³¨äº‹ä»¶çš„é›†åˆ //é€šè¿‡ selectionKeys åå‘èŽ·å–é€šé“ Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys(); //éåŽ† Set&lt;SelectionKey&gt;, ä½¿ç”¨è¿­ä»£å™¨ Iterator&lt;SelectionKey&gt; keyIterator = selectionKeys.iterator(); while (keyIterator.hasNext()) &#123; //èŽ·å–åˆ°selectionKey SelectionKey key = keyIterator.next(); //æ ¹æ®key å¯¹åº”çš„é€šé“å‘ç”Ÿçš„äº‹ä»¶åšç›¸åº”å¤„ç† if (key.isAcceptable()) &#123; //å¦‚æžœæ˜¯OP_ACCEPT, è¡¨ç¤ºæ–°çš„å®¢æˆ·ç«¯è¿žæŽ¥ //ç»™è¯¥å®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ª SocketChannel SocketChannel socketChannel = serverSocketChannel.accept(); System.out.println(&quot;å®¢æˆ·ç«¯è¿žæŽ¥æˆåŠŸï¼ç”Ÿæˆäº†ä¸€ä¸ªsocketChannel &quot; + socketChannel.hashCode()); //å°† SocketChannel è®¾ç½®ä¸ºéžé˜»å¡ž socketChannel.configureBlocking(false); //å°†socketChannelæ³¨å†Œåˆ° selectorä¸Š, å…³æ³¨äº‹ä»¶ä¸ºOP_READ, åŒæ—¶ç»™socketChannel //å…³è”ä¸€ä¸ªBuffer socketChannel.register(selector, SelectionKey.OP_READ, ByteBuffer.allocate(1024)); &#125; if (key.isReadable()) &#123; //å‘ç”ŸOP_READ // é€šè¿‡key åå‘èŽ·å–å¯¹åº”çš„channel SocketChannel channel = (SocketChannel) key.channel(); //èŽ·å–è¯¥channelå…³è”çš„ buffer,åœ¨ä¸Žå®¢æˆ·ç«¯è¿žæŽ¥å°±å·²ç»åˆ›å»ºå¥½äº† ByteBuffer buffer = (ByteBuffer) key.attachment(); channel.read(buffer); System.out.println(&quot;from å®¢æˆ·ç«¯ï¼š &quot; + new String(buffer.array())); &#125; //æ‰‹åŠ¨ä»Žé›†åˆä¸­ç§»åŠ¨å½“å‰çš„selectionKey, é˜²æ­¢é‡å¤æ“ä½œ keyIterator.remove(); &#125; &#125; &#125;&#125; å®¢æˆ·ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package com.fyp.nio;import java.io.IOException;import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/6 * @Description: å®¢æˆ·ç«¯ * @Package: com.fyp.nio * @Version: 1.0 */public class NIOClient &#123; public static void main(String[] args) throws IOException &#123; //å¾—åˆ°ä¸€ä¸ªç½‘ç»œé€šé“ SocketChannel socketChannel = SocketChannel.open(); //è®¾ç½®éžé˜»å¡ž socketChannel.configureBlocking(false); //æä¾›æœåŠ¡ç«¯çš„ ip å’Œ ç«¯å£ InetSocketAddress inetSocketAddress = new InetSocketAddress(&quot;127.0.0.1&quot;, 6666); /* è¿žæŽ¥æœåŠ¡å™¨ 1. ä¸ºéžé˜»å¡žæ¨¡å¼æ—¶ï¼Œå³ä¸ä¼šç­‰åˆ°æ–¹æ³•æ‰§è¡Œå®Œæ¯•å†è¿”å›žï¼Œä¼šç«‹å³è¿”å›žï¼Œå¦‚æžœè¿”å›žå‰å·²ç»è¿žæŽ¥æˆåŠŸï¼Œåˆ™è¿”å›žtrue è¿”å›žfalse æ—¶ï¼Œè¯´æ˜Žæœªè¿žæŽ¥æˆåŠŸï¼Œæ‰€ä»¥éœ€è¦å†é€šè¿‡whileå¾ªçŽ¯åœ°finishConnect()å®Œæˆæœ€ç»ˆçš„è¿žæŽ¥ 2. ä¸ºé˜»å¡žæ¨¡å¼æ—¶ï¼Œç›´åˆ°è¿žæŽ¥å»ºç«‹æˆ–æŠ›å‡ºå¼‚å¸¸ ä¸ä¼šè¿”å›žfalseï¼Œè¿žæŽ¥ä¸ä¸Šå°±æŠ›å¼‚å¸¸ï¼Œä¸éœ€è¦å€ŸåŠ©finishConnect() */ if (!socketChannel.connect(inetSocketAddress)) &#123; while (!socketChannel.finishConnect()) &#123; System.out.println(&quot;å› ä¸ºè¿žæŽ¥éœ€è¦æ—¶é—´ï¼Œå®¢æˆ·ç«¯ä¸ä¼šé˜»å¡žï¼Œå¯ä»¥åšå…¶ä»–å·¥ä½œ&quot;); &#125; &#125; //å¦‚æžœè¿žæŽ¥æˆåŠŸï¼Œå°±å‘é€æ•°æ® String str = &quot;hello, å°šç¡…è°·&quot;; ByteBuffer buffer = ByteBuffer.wrap(str.getBytes()); //å‘é€æ•°æ®ï¼Œå°†buffer å†™å…¥ channel socketChannel.write(buffer); System.in.read(); &#125;&#125; SelectionKey SelectionKeyï¼Œè¡¨ç¤ºSelectorå’Œç½‘ç»œé€šé“çš„æ³¨å†Œå…³ç³»ï¼Œå…±å››ç§ï¼š int OP_ACCEPTï¼šæœ‰æ–°çš„ç½‘ç»œè¿žæŽ¥å¯ä»¥ acceptï¼Œå€¼ä¸º 16 int OP_CONNECTï¼šä»£è¡¨è¿žæŽ¥å·²ç»å»ºç«‹ï¼Œå€¼ä¸º 8 int OP_READï¼šä»£è¡¨è¯»æ“ä½œï¼Œå€¼ä¸º 1 int OP_WRITEï¼šä»£è¡¨å†™æ“ä½œï¼Œå€¼ä¸º 4 æºç ä¸­ï¼š 1234public static final int OP_READ = 1 &lt;&lt; 0;public static final int OP_WRITE = 1 &lt;&lt; 2;public static final int OP_CONNECT = 1 &lt;&lt; 3;public static final int OP_ACCEPT = 1 &lt;&lt; 4; SelectionKey ç›¸å…³æ–¹æ³• ServerSocketChannel ServerSocketChannel åœ¨æœåŠ¡å™¨ç«¯ç›‘å¬æ–°çš„å®¢æˆ·ç«¯ Socket è¿žæŽ¥ï¼Œè´Ÿè´£ç›‘å¬ï¼Œä¸è´Ÿè´£å®žé™…çš„è¯»å†™æ“ä½œ ç›¸å…³æ–¹æ³•å¦‚ä¸‹ SocketChannel SocketChannelï¼Œç½‘ç»œ IO é€šé“ï¼Œå…·ä½“è´Ÿè´£è¿›è¡Œè¯»å†™æ“ä½œã€‚NIO æŠŠç¼“å†²åŒºçš„æ•°æ®å†™å…¥é€šé“ï¼Œæˆ–è€…æŠŠé€šé“é‡Œçš„æ•°æ®è¯»åˆ°ç¼“å†²åŒºã€‚ ç›¸å…³æ–¹æ³•å¦‚ä¸‹ 9. NIOç½‘ç»œç¼–ç¨‹åº”ç”¨å®žä¾‹-ç¾¤èŠç³»ç»Ÿå®žä¾‹è¦æ±‚ï¼š ç¼–å†™ä¸€ä¸ª NIO ç¾¤èŠç³»ç»Ÿï¼Œå®žçŽ°æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ç®€å•é€šè®¯ï¼ˆéžé˜»å¡žï¼‰ å®žçŽ°å¤šäººç¾¤èŠ æœåŠ¡å™¨ç«¯ï¼šå¯ä»¥ç›‘æµ‹ç”¨æˆ·ä¸Šçº¿ï¼Œç¦»çº¿ï¼Œå¹¶å®žçŽ°æ¶ˆæ¯è½¬å‘åŠŸèƒ½ å®¢æˆ·ç«¯ï¼šé€šè¿‡ Channel å¯ä»¥æ— é˜»å¡žå‘é€æ¶ˆæ¯ç»™å…¶å®ƒæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒæ—¶å¯ä»¥æŽ¥å—å…¶å®ƒç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼ˆç”±æœåŠ¡å™¨è½¬å‘å¾—åˆ°ï¼‰ ç›®çš„ï¼šè¿›ä¸€æ­¥ç†è§£ NIO éžé˜»å¡žç½‘ç»œç¼–ç¨‹æœºåˆ¶ ç¤ºæ„å›¾åˆ†æžå’Œä»£ç  æœåŠ¡ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152package com.fyp.nio.groupchat;import java.io.IOException;import java.net.InetSocketAddress;import java.net.Socket;import java.nio.ByteBuffer;import java.nio.channels.*;import java.util.Iterator;/** * @Auther: fyp * @Date: 2022/2/6 * @Description: ç¾¤èŠç³»ç»ŸæœåŠ¡ç«¯ * @Package: com.fyp.nio.groupchat * @Version: 1.0 */public class GroupChatServer &#123; private Selector selector; private ServerSocketChannel listenChannel; private static final int PORT = 6667; public GroupChatServer() &#123; try &#123; selector = Selector.open(); listenChannel = ServerSocketChannel.open(); listenChannel.socket().bind(new InetSocketAddress(PORT)); listenChannel.configureBlocking(false); listenChannel.register(selector, SelectionKey.OP_ACCEPT); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public void listen() &#123; try &#123; while (true) &#123; // count èŽ·å–çš„æ˜¯ åœ¨é˜»å¡žè¿‡ç¨‹ä¸­ åŒæ—¶å‘ç”Ÿçš„ äº‹ä»¶ æ•°ï¼Œç›´åˆ°æœ‰äº‹ä»¶ å‘ç”Ÿï¼Œæ‰ä¼šæ‰§è¡Œï¼Œå¦åˆ™ä¸€ç›´é˜»å¡ž /* select æ–¹æ³•åœ¨ æ²¡æœ‰ å®¢æˆ·ç«¯å‘èµ·è¿žæŽ¥æ—¶ï¼Œ ä¼šä¸€ç›´é˜»å¡žï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥ï¼Œå…¶ä»– å®¢æˆ·ç«¯å† å‘èµ·è¿žæŽ¥ ä¸å†é˜»å¡žï¼Œä¼šç«‹å³è¿”å›ž */ int count = selector.select(); System.out.println(count); if(count &gt; 0) &#123;// æœ‰äº‹ä»¶ å¤„ç† // éåŽ†å¾—åˆ° SelectionKey é›†åˆ Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator(); while (iterator.hasNext()) &#123; //å–å‡ºSelectionKey SelectionKey key = iterator.next(); //ç›‘å¬åˆ°accept if (key.isAcceptable()) &#123; SocketChannel sc = listenChannel.accept(); // ç›‘å¬åˆ° å®¢æˆ·ç«¯ çš„ SocketChannel æ€»æ˜¯é»˜è®¤ä¸ºé˜»å¡žæ–¹å¼ï¼Œéœ€è¦é‡æ–°è®¾ç½® sc.configureBlocking(false); //å°†è¯¥ sc æ³¨å†Œåˆ° selector sc.register(selector, SelectionKey.OP_READ); System.out.println(sc.getRemoteAddress() + &quot; ä¸Šçº¿ &quot;); &#125; if (key.isReadable()) &#123; // é€šé“å‘é€ read äº‹ä»¶ï¼Œ å³é€šé“æ˜¯å¯è¯»çŠ¶æ€ //å¤„ç†è¯» readData(key); &#125; /* æ¯æ¬¡ ç›‘å¬åˆ° å®¢æˆ·ç«¯åŽï¼Œ selectorä¼šå°† è¿žæŽ¥ä¸Šçš„ å®¢æˆ·ç«¯ é€‰ä¸­ï¼Œ å¹¶æ·»åŠ åˆ° selectionKeys ä¸­ è¦æ³¨å†Œåˆ° selector ä¸Šï¼Œä½¿ç”¨è¯¥æ–¹æ³•ï¼Œselector å°† ä¸å†é€‰ä¸­ å¦‚æžœæ²¡æœ‰ç§»é™¤ï¼Œselector ä¸èƒ½é€‰ä¸­ å…¶ä»–çš„ å®¢æˆ·ç«¯è¿žæŽ¥ iterator.remove() ç§»é™¤åŽï¼Œå°†é‡Šæ”¾ selector ä¸­çš„ selectionKeys */ iterator.remove(); &#125; &#125; else &#123; //System.out.println(&quot;ç­‰å¾…....&quot;); &#125; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; // å‘é€å¼‚å¸¸å¤„ç† &#125; &#125; public void readData(SelectionKey key) &#123; // å–åˆ°å…³è”çš„ channel SocketChannel channel = null; try &#123; // å¾—åˆ° channel channel = (SocketChannel) key.channel(); // åˆ›å»ºbuffer ByteBuffer buffer = ByteBuffer.allocate(1024); int count = channel.read(buffer); // æ ¹æ® count çš„å€¼ åš å¤„ç† if (count &gt; 0) &#123; // æŠŠ ç¼“å†²åŒº çš„ æ•°æ® è½¬æˆ å­—ç¬¦ä¸² String msg = new String(buffer.array()); // è¾“å‡ºè¯¥æ¶ˆæ¯ System.out.println(&quot;from å®¢æˆ·ç«¯ï¼š &quot; + msg); //æƒ³å…¶ä»–å®¢æˆ·ç«¯è½¬å‘æ¶ˆæ¯ï¼Œä¸“é—¨å†™ä¸€ä¸ªæ–¹æ³•æ¥å¤„ç† sendInfoToOtherClients(msg, channel); &#125; &#125; catch (IOException e) &#123; //e.printStackTrace(); try &#123; System.out.println(channel.getRemoteAddress() + &quot;ç¦»çº¿äº†&quot;); // å–æ¶ˆ æ³¨å†Œ key.cancel(); // å…³é—­é€šé“ channel.close(); &#125; catch (IOException ioException) &#123; ioException.printStackTrace(); &#125; &#125; &#125; // è½¬å‘æ¶ˆæ¯ç»™å…¶ä»–å®¢æˆ·ç«¯ï¼ˆé€šé“ï¼‰ private void sendInfoToOtherClients(String msg, SocketChannel self) throws IOException &#123; System.out.println(&quot;æœåŠ¡å™¨è½¬å‘æ¶ˆæ¯ä¸­....&quot;); // éåŽ†æ‰€æœ‰ æ³¨å†Œåˆ° selector ä¸Š çš„ SockChannel, å¹¶æŽ’é™¤ self for (SelectionKey key : selector.keys()) &#123; // é€šè¿‡ key å–å‡º å¯¹åº”çš„ SocketChannel Channel targetChannel = key.channel(); // æŽ’é™¤è‡ªå·± if (targetChannel instanceof SocketChannel &amp;&amp; targetChannel != self) &#123; // è½¬åž‹ SocketChannel dest = (SocketChannel) targetChannel; // å°† msg å­˜å‚¨åˆ° buffer ByteBuffer buffer = ByteBuffer.wrap(msg.getBytes()); // å°† buffer çš„æ•°æ® å†™å…¥ é€šé“ dest.write(buffer); &#125; &#125; &#125; public static void main(String[] args) &#123; // åˆ›å»º æœåŠ¡å™¨ å¯¹è±¡ GroupChatServer groupChatServer = new GroupChatServer(); groupChatServer.listen(); &#125;&#125; å®¢æˆ·ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118package com.fyp.nio.groupchat;import java.io.IOException;import java.net.InetSocketAddress;import java.nio.ByteBuffer;import java.nio.channels.SelectionKey;import java.nio.channels.Selector;import java.nio.channels.SocketChannel;import java.util.Iterator;import java.util.Scanner;/** * @Auther: fyp * @Date: 2022/2/7 * @Description: ç¾¤èŠç³»ç»Ÿå®¢æˆ·ç«¯ * @Package: com.fyp.nio.groupchat * @Version: 1.0 */public class GroupChatClient &#123; //å®šä¹‰ ç›¸å…³ å±žæ€§ private final String HOST = &quot;127.0.0.1&quot;; private final int PORT = 6667; private Selector selector; private SocketChannel socketChannel; private String username; // æž„é€ å™¨ï¼Œå®Œæˆåˆå§‹åŒ–å·¥ä½œ public GroupChatClient() throws IOException &#123; selector = Selector.open(); // è¿žæŽ¥ æœåŠ¡å™¨ socketChannel = socketChannel.open(new InetSocketAddress(&quot;127.0.0.1&quot;, PORT)); // è®¾ç½® éžé˜»å¡ž socketChannel.configureBlocking(false); // å°† channel æ³¨å†Œåˆ° selector socketChannel.register(selector, SelectionKey.OP_READ); // å¾—åˆ° username username = socketChannel.getLocalAddress().toString().substring(1); System.out.println(username + &quot; is ok....&quot;); &#125; // å‘ æœåŠ¡å™¨ å‘é€ æ¶ˆæ¯ public void sendInfo(String info) &#123; info = username + &quot; è¯´ï¼š&quot; + info; try &#123; socketChannel.write(ByteBuffer.wrap(info.getBytes())); &#125; catch (Exception e) &#123; &#125; &#125; // è¯»å–ä»Ž æœåŠ¡å™¨ ç«¯ å›žå¤çš„ æ¶ˆæ¯ public void readInfo() &#123; try &#123; int readChannels = selector.select(); if (readChannels &gt; 0) &#123;// æœ‰å¯ä»¥ç”¨çš„ é€šé“ Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator(); while (iterator.hasNext()) &#123; SelectionKey key = iterator.next(); if (key.isReadable()) &#123; // å¾—åˆ° ç›¸å…³çš„ é€šé“ SocketChannel sc = (SocketChannel) key.channel(); // å¾—åˆ°ä¸€ä¸ª Buffer ByteBuffer buffer = ByteBuffer.allocate(1024); // è¯»å– sc.read(buffer); // æŠŠç¼“å­˜åŒºçš„æ•°æ® è½¬æˆ å­—ç¬¦ä¸² String msg = new String(buffer.array()); System.out.println(msg.trim()); &#125; &#125; iterator.remove();// åˆ é™¤å½“å‰çš„selectionKey, é˜²æ­¢é‡å¤æ“ä½œ, æ²¡æœ‰åˆ é™¤ï¼Œç›´æŽ¥å½±å“åˆ°selector.select() &#125; else &#123; //System.out.println(&quot;æ²¡æœ‰å¯ä»¥ç”¨çš„é€šé“....&quot;); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) throws IOException &#123; // å¯åŠ¨ å®¢æˆ·ç«¯ GroupChatClient chatClient = new GroupChatClient(); // å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”3ç§’ï¼Œ è¯»å–ä»Ž æœåŠ¡å™¨ å‘é€è¿‡æ¥çš„æ•°æ® new Thread() &#123; @Override public void run() &#123; while (true) &#123; chatClient.readInfo(); try &#123; Thread.currentThread().sleep(3000); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;.start(); // å‘é€æ•°æ®ç»™ æœåŠ¡ç«¯ Scanner scanner = new Scanner(System.in); while (scanner.hasNextLine()) &#123; String s = scanner.nextLine(); chatClient.sendInfo(s); &#125; &#125;&#125; 10. NIOä¸Žé›¶æ‹·è´é›¶æ‹·è´ä¹‹ä¼ ç»Ÿæ–‡ä»¶IOåœºæ™¯ï¼šå°†ç£ç›˜ä¸Šçš„æ–‡ä»¶è¯»å–å‡ºæ¥ï¼Œç„¶åŽé€šè¿‡ç½‘ç»œåè®®å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å¾ˆæ˜Žæ˜¾å‘ç”Ÿäº†4æ¬¡æ‹·è´ ç¬¬ä¸€æ¬¡æ‹·è´ï¼ŒæŠŠç£ç›˜ä¸Šçš„æ•°æ®æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªæ‹·è´æ˜¯é€šè¿‡ DMA çš„ã€‚ ç¬¬äºŒæ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼ŒäºŽæ˜¯åº”ç”¨ç¨‹åºå°±å¯ä»¥ä½¿ç”¨è¿™éƒ¨åˆ†æ•°æ®äº†ï¼Œè¿™ä¸ªæ‹·è´æ˜¯ç”± CPU å®Œæˆçš„ã€‚ ç¬¬ä¸‰æ¬¡æ‹·è´ï¼ŒæŠŠåˆšæ‰æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œå†æ‹·è´åˆ°å†…æ ¸çš„ socket çš„ç¼“å†²åŒºé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¾ç„¶ç”± CPU å®Œæˆçš„ã€‚ ç¬¬å››æ¬¡æ‹·è´ï¼ŒæŠŠå†…æ ¸çš„ socket ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œæ‹·è´åˆ°åè®®æ ˆé‡Œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆæ˜¯ç”± DMA å®Œæˆçš„ã€‚å‘ç”Ÿäº†4æ¬¡ç”¨æˆ·ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºå‘ç”Ÿäº†ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨readå’Œwriteã€‚ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å¯¹åº”ä¸¤æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°åœ¨ä¸€èˆ¬æƒ…å†µä¸‹åªå¯èƒ½æ˜¯å¶æ•°ã€‚ æƒ³è¦ä¼˜åŒ–æ–‡ä»¶ä¼ è¾“çš„æ€§èƒ½å°±ä¸¤ä¸ªæ–¹å‘ å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•° å‡å°‘æ•°æ®æ‹·è´æ¬¡æ•° å› ä¸ºè¿™ä¸¤ä¸ªæ˜¯æœ€è€—æ—¶çš„ é›¶æ‹·è´ä¹‹mmapread() ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¼šæŠŠå†…æ ¸ç¼“å†²åŒºçš„æ•°æ®æ‹·è´åˆ°ç”¨æˆ·çš„ç¼“å†²åŒºé‡Œï¼Œä¸ºäº†å‡å°‘è¿™ä¸€æ­¥å¼€é”€ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ mmap() æ›¿æ¢ read() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚mmap() ç³»ç»Ÿè°ƒç”¨å‡½æ•°ä¼šç›´æŽ¥æŠŠå†…æ ¸ç¼“å†²åŒºé‡Œçš„æ•°æ®æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´ï¼Œè¿™æ ·ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸ä¸Žç”¨æˆ·ç©ºé—´å…±äº«ç¼“å†²åŒºï¼Œå°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•çš„æ•°æ®æ‹·è´æ“ä½œã€‚ æ€»çš„æ¥è¯´mmapå‡å°‘äº†ä¸€æ¬¡æ•°æ®æ‹·è´ï¼Œæ€»å…±4æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ3æ¬¡æ•°æ®æ‹·è´ é›¶æ‹·è´ä¹‹sendfileLinux2.1 ç‰ˆæœ¬æä¾›äº† sendFile å‡½æ•°ï¼Œå…¶åŸºæœ¬åŽŸç†å¦‚ä¸‹ï¼šæ•°æ®æ ¹æœ¬ä¸ç»è¿‡ç”¨æˆ·æ€ï¼Œç›´æŽ¥ä»Žå†…æ ¸ç¼“å†²åŒºè¿›å…¥åˆ° SocketBuffer æ€»çš„æ¥è¯´æœ‰2æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ3æ¬¡æ•°æ®æ‹·è´ã€‚ sendfileå†ä¼˜åŒ–Linuxåœ¨2.4 ç‰ˆæœ¬ä¸­ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œé¿å…äº†ä»Žå†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ° Socketbuffer çš„æ“ä½œï¼Œç›´æŽ¥æ‹·è´åˆ°åè®®æ ˆï¼Œä»Žè€Œå†ä¸€æ¬¡å‡å°‘äº†æ•°æ®æ‹·è´ mmap å’Œ sendFile çš„åŒºåˆ«ï¼ˆ1ï¼‰mmap é€‚åˆå°æ•°æ®é‡è¯»å†™ï¼ŒsendFile é€‚åˆå¤§æ–‡ä»¶ä¼ è¾“ã€‚ ï¼ˆ2ï¼‰mmap éœ€è¦ 4 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ3 æ¬¡æ•°æ®æ‹·è´ï¼›sendFile éœ€è¦ 3 æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæœ€å°‘ 2 æ¬¡æ•°æ®æ‹·è´ã€‚ ï¼ˆ3ï¼‰sendFile å¯ä»¥åˆ©ç”¨ DMA æ–¹å¼ï¼Œå‡å°‘ CPU æ‹·è´ï¼Œmmap åˆ™ä¸èƒ½ï¼ˆå¿…é¡»ä»Žå†…æ ¸æ‹·è´åˆ° Socketç¼“å†²åŒºï¼‰ã€‚ NIO é›¶æ‹·è´æ¡ˆä¾‹æ¡ˆä¾‹è¦æ±‚ï¼š ä½¿ç”¨ä¼ ç»Ÿçš„ IO æ–¹æ³•ä¼ é€’ä¸€ä¸ªå¤§æ–‡ä»¶ ä½¿ç”¨ NIO é›¶æ‹·è´æ–¹å¼ä¼ é€’ï¼ˆtransferToï¼‰ä¸€ä¸ªå¤§æ–‡ä»¶ çœ‹çœ‹ä¸¤ç§ä¼ é€’æ–¹å¼è€—æ—¶æ—¶é—´åˆ†åˆ«æ˜¯å¤šå°‘ ä¼ ç»Ÿæ‹·è´æ–¹å¼æœåŠ¡ç«¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.fyp.nio.zerocopy;import java.io.DataInputStream;import java.io.IOException;import java.net.ServerSocket;import java.net.Socket;/** * @Auther: fyp * @Date: 2022/2/9 * @Description: ä¼ ç»ŸIOæœåŠ¡ç«¯ * @Package: com.fyp.nio.zerocopy * @Version: 1.0 */public class OldIOServer &#123; public static void main(String[] args) throws IOException &#123; ServerSocket serverSocket = new ServerSocket(7001); while (true) &#123; Socket socket = serverSocket.accept(); DataInputStream dataInputStream = new DataInputStream(socket.getInputStream()); try &#123; byte[] byteArray = new byte[4096]; while (true) &#123; int readCount = dataInputStream.read(byteArray, 0, byteArray.length); if (-1 == readCount) &#123; break; &#125; System.out.println(&quot;è¯»å–å­—èŠ‚æ•°ï¼š &quot; + readCount); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; å®¢æˆ·ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.fyp.nio.zerocopy;import java.io.*;import java.net.Socket;/** * @Auther: fyp * @Date: 2022/2/9 * @Description: ä¼ ç»ŸIOå®¢æˆ·ç«¯ * @Package: com.fyp.nio.zerocopy * @Version: 1.0 */public class OldIOClient &#123; public static void main(String[] args) throws IOException &#123; Socket socket = new Socket(&quot;localhost&quot;, 7001); String fileName = &quot;aiXcoder-3.3.1-2020.zip&quot;; InputStream inputStream = new FileInputStream(fileName); DataOutputStream dataOutputStream = new DataOutputStream(socket.getOutputStream()); byte[] buffer = new byte[4096]; long readCount; long total = 0; long startTime = System.currentTimeMillis(); while ((readCount = inputStream.read(buffer)) &gt; 0) &#123; total += readCount; dataOutputStream.write(buffer, 0 , (int) readCount); &#125; System.out.println(&quot;å‘é€æ€»å­—èŠ‚æ•°ï¼š &quot; + total + &quot;, è€—æ—¶ï¼š &quot; + (System.currentTimeMillis() - startTime)); dataOutputStream.close(); socket.close(); inputStream.close(); &#125;&#125; NIOæ‹·è´æ–¹å¼æœåŠ¡ç«¯ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.fyp.nio.zerocopy;import java.io.IOException;import java.net.InetSocketAddress;import java.net.ServerSocket;import java.net.Socket;import java.nio.ByteBuffer;import java.nio.channels.ServerSocketChannel;import java.nio.channels.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/9 * @Description: æ–°IOæœåŠ¡ç«¯ * @Package: com.fyp.nio.zerocopy * @Version: 1.0 */public class NewIOServer &#123; public static void main(String[] args) throws IOException &#123; InetSocketAddress inetSocketAddress = new InetSocketAddress(7001); ServerSocketChannel serverSockChannel = ServerSocketChannel.open(); ServerSocket serverSocket = serverSockChannel.socket(); serverSocket.bind(inetSocketAddress); // åˆ›å»º buffer ByteBuffer buffer = ByteBuffer.allocate(4096); while (true) &#123; SocketChannel socketChannel = serverSockChannel.accept(); int readCount = 0; while (-1 != readCount) &#123; try &#123; readCount = socketChannel.read(buffer); &#125; catch (Exception e) &#123; //e.printStackTrace(); break; &#125; // buffer.rewind(); // å€’å¸¦ position = 0 , mark ä½œåºŸ &#125; &#125; &#125;&#125; å®¢æˆ·ç«¯ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041package com.fyp.nio.zerocopy;import java.io.FileInputStream;import java.io.IOException;import java.net.InetSocketAddress;import java.net.Socket;import java.nio.channels.FileChannel;import java.nio.channels.SocketChannel;/** * @Auther: fyp * @Date: 2022/2/9 * @Description: æ–°IOå®¢æˆ·ç«¯ * @Package: com.fyp.nio.zerocopy * @Version: 1.0 */public class NewIOClient &#123; public static void main(String[] args) throws IOException &#123; SocketChannel socketChannel = SocketChannel.open(); socketChannel.connect(new InetSocketAddress(&quot;localhost&quot;, 7001)); String filename = &quot;aiXcoder-3.3.1-2020.zip&quot;; // å¾—åˆ° ä¸€ä¸ª æ–‡ä»¶ channel FileChannel fileChannel = new FileInputStream(filename).getChannel(); // å‡†å¤‡ å‘é€ long startTime = System.currentTimeMillis(); // åœ¨ linux çš„ ä¸‹ä¸€ä¸ª transferTo æ–¹æ³•å°±å¯ä»¥ å®Œæˆ ä¼ è¾“ // åœ¨ windows ä¸‹ä¸€æ¬¡ è°ƒç”¨ transferTo åªèƒ½å‘é€ 8M // éœ€è¦ åˆ†æ®µ ä¼ è¾“æ–‡ä»¶ï¼Œè€Œä¸” ä¸»è¦ ä¼ è¾“æ—¶ çš„ä½ç½® transferTo åº•å±‚ç”¨åˆ°é›¶æ‹·è´ long transferCount = fileChannel.transferTo(0, fileChannel.size(), socketChannel); System.out.println(&quot;å‘é€æ€»å­—èŠ‚æ•°ï¼š &quot; + transferCount + &quot;, è€—æ—¶ï¼š &quot; + (System.currentTimeMillis() - startTime)); fileChannel.close(); &#125;&#125; ä¸‰ã€Java AIOä»‹ç»1. AIOåŸºæœ¬ä»‹ç» JDK7 å¼•å…¥äº† AsynchronousI/Oï¼Œå³ AIOã€‚åœ¨è¿›è¡Œ I/O ç¼–ç¨‹ä¸­ï¼Œå¸¸ç”¨åˆ°ä¸¤ç§æ¨¡å¼ï¼šReactor å’Œ Proactorã€‚Java çš„ NIO å°±æ˜¯ Reactorï¼Œå½“æœ‰äº‹ä»¶è§¦å‘æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç† AIO å³ NIO2.0ï¼Œå«åšå¼‚æ­¥ä¸é˜»å¡žçš„ IOã€‚AIO å¼•å…¥å¼‚æ­¥é€šé“çš„æ¦‚å¿µï¼Œé‡‡ç”¨äº† Proactor æ¨¡å¼ï¼Œç®€åŒ–äº†ç¨‹åºç¼–å†™ï¼Œæœ‰æ•ˆçš„è¯·æ±‚æ‰å¯åŠ¨çº¿ç¨‹ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…ˆç”±æ“ä½œç³»ç»Ÿå®ŒæˆåŽæ‰é€šçŸ¥æœåŠ¡ç«¯ç¨‹åºå¯åŠ¨çº¿ç¨‹åŽ»å¤„ç†ï¼Œä¸€èˆ¬é€‚ç”¨äºŽè¿žæŽ¥æ•°è¾ƒå¤šä¸”è¿žæŽ¥æ—¶é—´è¾ƒé•¿çš„åº”ç”¨ ç›®å‰ AIO è¿˜æ²¡æœ‰å¹¿æ³›åº”ç”¨ï¼ŒNetty ä¹Ÿæ˜¯åŸºäºŽ NIOï¼Œè€Œä¸æ˜¯ AIOï¼Œå› æ­¤æˆ‘ä»¬å°±ä¸è¯¦è§£ AIO äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒã€ŠJavaæ–°ä¸€ä»£ç½‘ç»œç¼–ç¨‹æ¨¡åž‹AIOåŽŸç†åŠLinuxç³»ç»ŸAIOä»‹ç»ã€‹ 2. BIOã€NIOã€AIOå¯¹æ¯”è¡¨ BIO NIO AIO IOæ¨¡åž‹ åŒæ­¥é˜»å¡ž åŒæ­¥éžé˜»å¡žï¼ˆå¤šè·¯å¤ç”¨ï¼‰ å¼‚æ­¥éžé˜»å¡ž ç¼–ç¨‹éš¾åº¦ ç®€å• å¤æ‚ å¤æ‚ å¯é æ€§ å·® å¥½ å¥½ åžåé‡ ä½Ž é«˜ é«˜ ä¸¾ä¾‹è¯´æ˜Ž åŒæ­¥é˜»å¡žï¼šåˆ°ç†å‘åº—ç†å‘ï¼Œå°±ä¸€ç›´ç­‰ç†å‘å¸ˆï¼Œç›´åˆ°è½®åˆ°è‡ªå·±ç†å‘ã€‚ åŒæ­¥éžé˜»å¡žï¼šåˆ°ç†å‘åº—ç†å‘ï¼Œå‘çŽ°å‰é¢æœ‰å…¶å®ƒäººç†å‘ï¼Œç»™ç†å‘å¸ˆè¯´ä¸‹ï¼Œå…ˆå¹²å…¶ä»–äº‹æƒ…ï¼Œä¸€ä¼šè¿‡æ¥çœ‹æ˜¯å¦è½®åˆ°è‡ªå·±. å¼‚æ­¥éžé˜»å¡žï¼šç»™ç†å‘å¸ˆæ‰“ç”µè¯ï¼Œè®©ç†å‘å¸ˆä¸Šé—¨æœåŠ¡ï¼Œè‡ªå·±å¹²å…¶å®ƒäº‹æƒ…ï¼Œç†å‘å¸ˆè‡ªå·±æ¥å®¶ç»™ä½ ç†å‘ æ¼«ç”»è®²IO","categories":[{"name":"Javaæ¡†æž¶","slug":"Javaæ¡†æž¶","permalink":"http://fyupeng.github.io/categories/Java%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"netty","slug":"netty","permalink":"http://fyupeng.github.io/tags/netty/"}],"author":"fyupeng"},{"title":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","date":"2022-06-25T06:45:22.000Z","updated":"2022-06-25T07:00:01.526Z","comments":true,"path":"2022/06/25/äºŒåˆ†æŸ¥æ‰¾/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/","excerpt":"","text":"1. çŸ©é˜µ1.1 1351. ç»Ÿè®¡æœ‰åºçŸ©é˜µä¸­çš„è´Ÿæ•°ç»™ä½ ä¸€ä¸ª m * n çš„çŸ©é˜µ gridï¼ŒçŸ©é˜µä¸­çš„å…ƒç´ æ— è®ºæ˜¯æŒ‰è¡Œè¿˜æ˜¯æŒ‰åˆ—ï¼Œéƒ½ä»¥éžé€’å¢žé¡ºåºæŽ’åˆ—ã€‚ è¯·ä½ ç»Ÿè®¡å¹¶è¿”å›ž grid ä¸­ è´Ÿæ•° çš„æ•°ç›®ã€‚ ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šgrid = [[4,3,2,-1],[3,2,1,-1],[1,1,-1,-2],[-1,-1,-2,-3]]è¾“å‡ºï¼š8è§£é‡Šï¼šçŸ©é˜µä¸­å…±æœ‰ 8 ä¸ªè´Ÿæ•°ã€‚ ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šgrid = [[3,2],[1,0]]è¾“å‡ºï¼š0 12345678910111213141516171819202122class Solution &#123; public int countNegatives(int[][] grid) &#123; int count = 0; for(int i = 0 ; i &lt; grid.length; i++) &#123; count += countRowNegatives(grid[i]); &#125; return count; &#125; private int countRowNegatives(int[] row) &#123; int left = 0; int right = row.length; while(left &lt; right) &#123; int mid = left + (right - left) / 2; if(row[mid] &gt;= 0) &#123; left = mid + 1; &#125; else &#123; right = mid; &#125; &#125; return row.length - 1 - left + 1; &#125;&#125; 1.2 74. æœç´¢äºŒç»´çŸ©é˜µç¼–å†™ä¸€ä¸ªé«˜æ•ˆçš„ç®—æ³•æ¥åˆ¤æ–­ m x n çŸ©é˜µä¸­ï¼Œæ˜¯å¦å­˜åœ¨ä¸€ä¸ªç›®æ ‡å€¼ã€‚è¯¥çŸ©é˜µå…·æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š æ¯è¡Œä¸­çš„æ•´æ•°ä»Žå·¦åˆ°å³æŒ‰å‡åºæŽ’åˆ—ã€‚æ¯è¡Œçš„ç¬¬ä¸€ä¸ªæ•´æ•°å¤§äºŽå‰ä¸€è¡Œçš„æœ€åŽä¸€ä¸ªæ•´æ•°ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šmatrix = [[1,3,5,7],[10,11,16,20],[23,30,34,60]], target = 3è¾“å‡ºï¼štrue ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šmatrix = [[1,3,5,7],[10,11,16,20],[23,30,34,60]], target = 13è¾“å‡ºï¼šfalse æç¤ºï¼š m == matrix.lengthn == matrix[i].length1 &lt;= m, n &lt;= 100-104 &lt;= matrix[i] [j], target &lt;= 104 1234567891011121314151617181920212223class Solution &#123; public boolean searchMatrix(int[][] matrix, int target) &#123; // äºŒç»´ å˜ ä¸€ç»´ // col + row = res // 1 * 4 + 1 = 5 -- 5 / 4 = 1 -- 5 % 4 = 1 int left = 0; int col = matrix[0].length; int row = matrix.length; int right = row * col; while(left &lt; right) &#123; int mid = left + (right - left) / 2; if(matrix[mid / col][mid % col] &lt; target) &#123; left = mid + 1; &#125; else &#123; right = mid; &#125; &#125; if(left &lt; row * col &amp;&amp; target == matrix[left / col][left % col]) &#123; return true; &#125; return false; &#125;&#125; 1.3 1337. çŸ©é˜µä¸­æˆ˜æ–—åŠ›æœ€å¼±çš„ K è¡Œç»™ä½ ä¸€ä¸ªå¤§å°ä¸º m * n çš„çŸ©é˜µ matï¼ŒçŸ©é˜µç”±è‹¥å¹²å†›äººå’Œå¹³æ°‘ç»„æˆï¼Œåˆ†åˆ«ç”¨ 1 å’Œ 0 è¡¨ç¤ºã€‚ è¯·ä½ è¿”å›žçŸ©é˜µä¸­æˆ˜æ–—åŠ›æœ€å¼±çš„ k è¡Œçš„ç´¢å¼•ï¼ŒæŒ‰ä»Žæœ€å¼±åˆ°æœ€å¼ºæŽ’åºã€‚ å¦‚æžœç¬¬ i è¡Œçš„å†›äººæ•°é‡å°‘äºŽç¬¬ j è¡Œï¼Œæˆ–è€…ä¸¤è¡Œå†›äººæ•°é‡ç›¸åŒä½† i å°äºŽ jï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¤ä¸ºç¬¬ i è¡Œçš„æˆ˜æ–—åŠ›æ¯”ç¬¬ j è¡Œå¼±ã€‚ å†›äºº æ€»æ˜¯ æŽ’åœ¨ä¸€è¡Œä¸­çš„é å‰ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ 1 æ€»æ˜¯å‡ºçŽ°åœ¨ 0 ä¹‹å‰ã€‚ ç¤ºä¾‹1ï¼š 12345678910111213141516è¾“å…¥ï¼šmat = [[1,1,0,0,0], [1,1,1,1,0], [1,0,0,0,0], [1,1,0,0,0], [1,1,1,1,1]], k = 3è¾“å‡ºï¼š[2,0,3]è§£é‡Šï¼šæ¯è¡Œä¸­çš„å†›äººæ•°ç›®ï¼šè¡Œ 0 -&gt; 2 è¡Œ 1 -&gt; 4 è¡Œ 2 -&gt; 1 è¡Œ 3 -&gt; 2 è¡Œ 4 -&gt; 5 ä»Žæœ€å¼±åˆ°æœ€å¼ºå¯¹è¿™äº›è¡ŒæŽ’åºåŽå¾—åˆ° [2,0,3,1,4] â€‹ ç¤ºä¾‹2ï¼š 1234567891011121314è¾“å…¥ï¼šmat = [[1,0,0,0], [1,1,1,1], [1,0,0,0], [1,0,0,0]], k = 2è¾“å‡ºï¼š[0,2]è§£é‡Šï¼š æ¯è¡Œä¸­çš„å†›äººæ•°ç›®ï¼šè¡Œ 0 -&gt; 1 è¡Œ 1 -&gt; 4 è¡Œ 2 -&gt; 1 è¡Œ 3 -&gt; 1 ä»Žæœ€å¼±åˆ°æœ€å¼ºå¯¹è¿™äº›è¡ŒæŽ’åºåŽå¾—åˆ° [0,2,3,1] æç¤ºï¼š m == mat.lengthn == mat[i].length2 &lt;= n, m &lt;= 1001 &lt;= k &lt;= mmatrix[i] [j] ä¸æ˜¯ 0 å°±æ˜¯ 1 12345678910111213141516171819202122232425262728293031323334353637class Solution &#123; public int[] kWeakestRows(int[][] mat, int k) &#123; List&lt;int[]&gt; list = new ArrayList&lt;&gt;(); for(int i = 0; i &lt; mat.length; i++) &#123; int left = 0; int right = mat[i].length; while(left &lt; right) &#123; int mid = left + (right - left) / 2; if(mat[i][mid] == 1) &#123; left = mid + 1; &#125; else &#123; right = mid; &#125; &#125; // ä¸‹æ ‡0 è¡¨ç¤º å†›äºº æ•° -- ä¸‹æ ‡1 è¡¨ç¤º ç´¢å¼• list.add(new int[]&#123;left, i&#125;); &#125; PriorityQueue&lt;int[]&gt; heap = new PriorityQueue(new Comparator &lt;int[]&gt;() &#123; @Override public int compare(int[] o1, int[] o2) &#123; if (o1[0] != o2[0]) &#123; return o1[0] - o2[0]; &#125; else &#123; return o1[1] - o2[1]; &#125; &#125; &#125;); for(int i = 0; i &lt; list.size(); i++) &#123; heap.offer(list.get(i)); &#125; int[] res = new int[k]; for(int i = 0; i &lt; k; i++) &#123; res[i] = heap.poll()[1]; &#125; return res; &#125;&#125; 1.4 1346. æ£€æŸ¥æ•´æ•°åŠå…¶ä¸¤å€æ•°æ˜¯å¦å­˜åœ¨ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ arrï¼Œè¯·ä½ æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªæ•´æ•° N å’Œ Mï¼Œæ»¡è¶³ N æ˜¯ M çš„ä¸¤å€ï¼ˆå³ï¼ŒN = 2 * Mï¼‰ã€‚ æ›´æ­£å¼åœ°ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸‹æ ‡ i å’Œ j æ»¡è¶³ï¼š i != j0 &lt;= i, j &lt; arr.lengtharr[i] == 2 * arr[j] ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šarr = [10,2,5,3]è¾“å‡ºï¼štrueè§£é‡Šï¼šN = 10 æ˜¯ M = 5 çš„ä¸¤å€ï¼Œå³ 10 = 2 * 5 ã€‚ ç¤ºä¾‹2ï¼š 123è¾“å…¥ï¼šarr = [7,1,14,11]è¾“å‡ºï¼štrueè§£é‡Šï¼šN = 14 æ˜¯ M = 7 çš„ä¸¤å€ï¼Œå³ 14 = 2 * 7 ã€‚ ç¤ºä¾‹3ï¼š 123è¾“å…¥ï¼šarr = [3,1,7,11]è¾“å‡ºï¼šfalseè§£é‡Šï¼šåœ¨è¯¥æƒ…å†µä¸‹ä¸å­˜åœ¨ N å’Œ M æ»¡è¶³ N = 2 * M ã€‚ æç¤ºï¼š 2 &lt;= arr.length &lt;= 500-10^3 &lt;= arr[i] &lt;= 10^3 1234567891011121314151617181920212223242526272829303132class Solution &#123; public boolean checkIfExist(int[] arr) &#123; Arrays.sort(arr); int poAndNaLine = binarySearch(arr, 0, arr.length, 0); // å¤„ç†è´Ÿæ•° for(int i = poAndNaLine - 1; i &gt;= 0; i--) &#123; int res = binarySearch(arr, 0, i, arr[i] * 2); if(res &lt; arr.length &amp;&amp; arr[res] == arr[i] * 2) &#123; return true; &#125; &#125; // å¤„ç† æ­£æ•° for(int i = poAndNaLine; i &lt; arr.length; i++) &#123; int res = binarySearch(arr, i + 1, arr.length, arr[i] * 2); if(res &lt; arr.length &amp;&amp; arr[res] == arr[i] * 2) &#123; return true; &#125; &#125; return false; &#125; private int binarySearch(int[] arr, int left, int right, int target) &#123; while(left &lt; right) &#123; int mid = left + (right - left) / 2; if(arr[mid] &lt; target) &#123; left = mid + 1; &#125; else &#123; right = mid; &#125; &#125; return left; &#125;&#125;","categories":[{"name":"leetCodeç®—æ³•","slug":"leetCodeç®—æ³•","permalink":"http://fyupeng.github.io/categories/leetCode%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","permalink":"http://fyupeng.github.io/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"}],"author":"fyupeng"},{"title":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","date":"2022-06-25T06:45:14.000Z","updated":"2022-06-25T07:00:55.547Z","comments":true,"path":"2022/06/25/äºŒå‰æ ‘/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/%E4%BA%8C%E5%8F%89%E6%A0%91/","excerpt":"","text":"1. 144. äºŒå‰æ ‘çš„å‰åºéåŽ†é—®é¢˜ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›žå®ƒèŠ‚ç‚¹å€¼çš„ å‰åº éåŽ†ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,null,2,3]è¾“å‡ºï¼š[1,2,3] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼š[] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [1]è¾“å‡ºï¼š[1] ç¤ºä¾‹4ï¼š 12è¾“å…¥ï¼šroot = [1,2]è¾“å‡ºï¼š[1,2] ç¤ºä¾‹5ï¼š 12è¾“å…¥ï¼šroot = [1,null,2]è¾“å‡ºï¼š[1,2] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 100] å†… -100 &lt;= Node.val &lt;= 100 ä»£ç  è¿­ä»£æ³• 123456789101112131415class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root != null) stack.push(root); while(!stack.empty()) &#123; TreeNode cur = stack.pop(); res.add(cur.val); if(cur.right != null) stack.push(cur.right); if(cur.left != null) stack.push(cur.left); &#125; return res; &#125;&#125; é€’å½’æ³• 123456789101112131415class Solution &#123; private List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; traversal(root); return res; &#125; private void traversal(TreeNode root) &#123; if(root == null) &#123; return; &#125; res.add(root.val); preorderTraversal(root.left); preorderTraversal(root.right); &#125;&#125; ç»Ÿä¸€è¿­ä»£æ³• 1234567891011121314151617181920212223242526// ç©ºæŒ‡é’ˆæ¥æ ‡è®° å·²è®¿é—®çš„èŠ‚ç‚¹class Solution &#123; public List&lt;Integer&gt; preorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root == null) &#123; return res; &#125; stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); if(node.right != null) stack.push(node.right); if(node.left != null) stack.push(node.left); stack.push(node); stack.push(null); &#125; else &#123; stack.pop(); node = stack.pop(); res.add(node.val); &#125; &#125; return res; &#125;&#125; 2. 94. äºŒå‰æ ‘çš„ä¸­åºéåŽ†é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›ž å®ƒçš„ ä¸­åº éåŽ† ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,null,2,3]è¾“å‡ºï¼š[1,3,2] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼š[] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [1]è¾“å‡ºï¼š[1] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 100] å†… -100 &lt;= Node.val &lt;= 100 ä»£ç  è¿­ä»£æ³• 12345678910111213141516171819class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); TreeNode cur = root; // åˆšå¼€å§‹ å¾ªçŽ¯ æœ‰ cur æ¥ä¿è¯ï¼ŒåŽé¢ç”± stack æ˜¯å¦ä¸ºç©º æ¥ä¿è¯ï¼ˆå½“ç„¶è®¿é—®ä¸­é—´çš„æ—¶å€™ä¸éœ€è¦å€ŸåŠ© empty()æ–¹æ³• æ€§èƒ½æœ‰æ‰€æé«˜ï¼‰ while(cur != null || !stack.empty()) &#123; if(cur != null) &#123; stack.push(cur); cur = cur.left; &#125; else &#123; cur = stack.pop(); res.add(cur.val); cur = cur.right; &#125; &#125; return res; &#125;&#125; é€’å½’æ³• 123456789101112131415class Solution &#123; private List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; traversal(root); return res; &#125; private void traversal(TreeNode root) &#123; if(root == null) &#123; return; &#125; traversal(root.left); res.add(root.val); traversal(root.right); &#125;&#125; ç»Ÿä¸€è¿­ä»£æ³• 12345678910111213141516171819202122232425class Solution &#123; public List&lt;Integer&gt; inorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root == null) &#123; return res; &#125; stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); if(node.right != null) stack.push(node.right); stack.push(node); stack.push(null); if(node.left != null) stack.push(node.left); &#125; else &#123; stack.pop(); node = stack.pop(); res.add(node.val); &#125; &#125; return res; &#125;&#125; 3. 145. äºŒå‰æ ‘çš„åŽåºéåŽ†é—®é¢˜ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›žå…¶èŠ‚ç‚¹å€¼çš„ åŽåºéåŽ† ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,null,2,3]è¾“å‡ºï¼š[3,2,1] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼š[] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [1]è¾“å‡ºï¼š[1] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [0, 100] å†… -100 &lt;= Node.val &lt;= 100 ä»£ç  è¿­ä»£æ³• 12345678910111213141516class Solution &#123; public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root != null) stack.push(root); while(!stack.empty()) &#123; TreeNode cur = stack.pop(); res.add(cur.val); if(cur.left != null) stack.push(cur.left); if(cur.right != null) stack.push(cur.right); &#125; Collections.reverse(res); return res; &#125;&#125; é€’å½’æ³• 123456789101112131415class Solution &#123; private List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; traversal(root); return res; &#125; private void traversal(TreeNode root) &#123; if(root == null) &#123; return; &#125; traversal(root.left); traversal(root.right); res.add(root.val); &#125;&#125; ç»Ÿä¸€è¿­ä»£æ³• 12345678910111213141516171819202122232425class Solution &#123; public List&lt;Integer&gt; postorderTraversal(TreeNode root) &#123; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root == null) &#123; return res; &#125; stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); stack.push(node); stack.push(null); if(node.right != null) stack.push(node.right); if(node.left != null) stack.push(node.left); &#125; else &#123; stack.pop(); node = stack.pop(); res.add(node.val); &#125; &#125; return res; &#125;&#125; 4. 102. äºŒå‰æ ‘çš„å±‚åºéåŽ†é—®é¢˜ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›žå…¶èŠ‚ç‚¹å€¼çš„ å±‚åºéåŽ† ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»Žå·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [3,9,20,null,null,15,7]è¾“å‡ºï¼š[[3],[9,20],[15,7]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [1]è¾“å‡ºï¼š[[1]] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼š[] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 2000] å†… -1000 &lt;= Node.val &lt;= 1000 ä»£ç 1234567891011121314151617181920212223class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; levelOrder(TreeNode root) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); List&lt;Integer&gt; tempList = new ArrayList&lt;&gt;(); Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); if(root == null) &#123; return res; &#125; queue.offer(root); while(!queue.isEmpty()) &#123; int size = queue.size(); while(size-- &gt; 0) &#123; TreeNode node = queue.poll(); tempList.add(node.val); if(node.left != null) queue.offer(node.left); if(node.right != null) queue.offer(node.right); &#125; res.add(new ArrayList&lt;&gt;(tempList)); tempList.clear(); &#125; return res; &#125;&#125; 5. 226. ç¿»è½¬äºŒå‰æ ‘é—®é¢˜ç»™ä½ ä¸€æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œç¿»è½¬è¿™æ£µäºŒå‰æ ‘ï¼Œå¹¶è¿”å›žå…¶æ ¹èŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [4,2,7,1,3,6,9]è¾“å‡ºï¼š[4,7,2,9,6,3,1] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [2,1,3]è¾“å‡ºï¼š[2,3,1] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼š[] ä»£ç é€’å½’å’Œè¿­ä»£å‰åºéåŽ†å’ŒåŽåºå¯ä»¥å®žçŽ°ï¼Œä½†ä¸­åºåªèƒ½ç”¨è¿­ä»£ï¼Œç”¨é€’å½’ä¸å¯ä»¥æ˜¯å› ä¸ºçˆ¶èŠ‚ç‚¹ç¿»è½¬åŽè¿˜åŽ»ç¿»è½¬å·²ç¿»è½¬çš„å­èŠ‚ç‚¹ï¼Œå¯¼è‡´æœ‰äº›èŠ‚ç‚¹æ²¡ç¿»è½¬ï¼Œæœ‰äº›èŠ‚ç‚¹ç¿»è½¬ä¸¤æ¬¡ ä½†å‡ä¸­åºé€’å½’å¯ä»¥å®žçŽ° 123invertTree(root-&gt;left); // å·¦swap(root-&gt;left, root-&gt;right); // ä¸­invertTree(root-&gt;left); // æ³¨æ„ è¿™é‡Œä¾ç„¶è¦éåŽ†å·¦å­©å­ï¼Œå› ä¸ºä¸­é—´èŠ‚ç‚¹å·²ç»ç¿»è½¬äº† é€’å½’æ³• 1234567891011121314151617181920class Solution &#123; public TreeNode invertTree(TreeNode root) &#123; if(root == null) &#123; return root; &#125; invert(root); return root; &#125; private void invert(TreeNode root) &#123; if(root == null) &#123; return; &#125; // åŽåºéåŽ†çš„ æ€æƒ³ç¿»è½¬ï¼Œç”±ä¸‹å¾€ä¸Š invert(root.left); invert(root.right); TreeNode node = root.left; root.left = root.right; root.right = node; &#125;&#125; è¿­ä»£æ³• 1234567891011121314151617181920// å‰åºéåŽ† ä»Žä¸Šå¾€ä¸‹ ç¿»è½¬class Solution &#123; public TreeNode invertTree(TreeNode root) &#123; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root == null) &#123; return root; &#125; stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.pop(); TreeNode tempNode = node.left; node.left = node.right; node.right = tempNode; if(node.right != null) stack.push(node.right); if(node.left != null) stack.push(node.left); &#125; return root; &#125;&#125; 6. 101. å¯¹ç§°äºŒå‰æ ‘é—®é¢˜ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œ æ£€æŸ¥å®ƒæ˜¯å¦è½´å¯¹ç§°ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,2,2,3,4,4,3]è¾“å‡ºï¼štrue ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [1,2,2,null,3,null,3] è¾“å‡ºï¼šfalse æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [1, 1000] å†… -100 &lt;= Node.val &lt;= 100 ä»£ç  é€’å½’æ³• 123456789101112131415161718192021class Solution &#123; public boolean isSymmetric(TreeNode root) &#123; return compare(root.left, root.right); &#125; private boolean compare(TreeNode left, TreeNode right) &#123; if(left == null &amp;&amp; right != null) &#123; return false; &#125; else if(left != null &amp;&amp; right == null) &#123; return false; &#125; else if(left == null &amp;&amp; right == null) &#123; return true; &#125; else if(left.val != right.val) &#123; return false; &#125; boolean outside = compare(left.left, right.right); boolean inside = compare(left.right, right.left); boolean isSame = outside &amp;&amp; inside; return isSame; &#125;&#125; è¿­ä»£æ³• 123456789101112131415161718192021222324252627class Solution &#123; public boolean isSymmetric(TreeNode root) &#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); if(root == null) &#123; return true; &#125; queue.offer(root.left); queue.offer(root.right); while(!queue.isEmpty()) &#123; TreeNode leftNode = queue.poll(); TreeNode rightNode = queue.poll(); // leftNode å’Œ rightNode éƒ½ä¸ºç©º if(leftNode == null &amp;&amp; rightNode == null) &#123; continue; &#125; // leftNode å’Œ rightNode æœ‰ä¸€ä¸ª ä¸ºç©ºï¼Œå¦åˆ™ä¸¤ä¸ªéƒ½ä¸ä¸ºç©ºæ—¶ï¼Œä¸¤è€…ä¸‹æ ‡çš„ å€¼ä¸åŒ if(leftNode == null || rightNode == null || leftNode.val != rightNode.val) &#123; return false; &#125; queue.offer(leftNode.left); queue.offer(rightNode.right); queue.offer(leftNode.right); queue.offer(rightNode.left); &#125; return true; &#125;&#125; 7. 104. äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å¤§æ·±åº¦ã€‚ äºŒå‰æ ‘çš„æ·±åº¦ä¸ºæ ¹èŠ‚ç‚¹åˆ°æœ€è¿œå¶å­èŠ‚ç‚¹çš„æœ€é•¿è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°ã€‚ è¯´æ˜Ž: å¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹ï¼š ç»™å®šäºŒå‰æ ‘ [3,9,20,null,null,15,7]ï¼Œ 12345678910graph TBA((3))B((9))C((20))D((15))E((7))A --- BA --- CC --- DC --- E è¿”å›žå®ƒçš„æœ€å¤§æ·±åº¦ 3 ã€‚ ä»£ç  å‰åºéåŽ†å›žæº¯æ³• 12345678910111213141516171819202122class Solution &#123; private Integer res = 0; public int maxDepth(TreeNode root) &#123; if(root == null) return 0; getDepth(root, 1); return res; &#125; private void getDepth(TreeNode root, Integer depth) &#123; res = depth &gt; res ? depth : res; if(root.left != null) &#123; depth++; getDepth(root.left, depth); depth--; // å›žæº¯ &#125; if(root.right != null) &#123; depth++; getDepth(root.right, depth); depth--; // å›žæº¯ &#125; return; &#125;&#125; ç®€åŒ–ä»£ç  12345678910111213141516class Solution &#123; private Integer res = 0; public int maxDepth(TreeNode root) &#123; if(root == null) return 0; getDepth(root, 1); return res; &#125; private void getDepth(TreeNode root, Integer depth) &#123; res = depth &gt; res ? depth : res; if(root.left != null) getDepth(root.left, depth + 1); if(root.right != null) getDepth(root.right, depth + 1); return; &#125;&#125; åŽåºéåŽ†é€’å½’æ³• 1234567891011121314class Solution &#123; public int maxDepth(TreeNode root) &#123; return getDepth(root); &#125; private int getDepth(TreeNode root) &#123; if(root == null) &#123; return 0; &#125; int leftDepth = getDepth(root.left); int rightDepth = getDepth(root.right); return 1 + Math.max(leftDepth, rightDepth); &#125;&#125; 8. 111. äºŒå‰æ ‘çš„æœ€å°æ·±åº¦é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ‰¾å‡ºå…¶æœ€å°æ·±åº¦ã€‚ æœ€å°æ·±åº¦æ˜¯ä»Žæ ¹èŠ‚ç‚¹åˆ°æœ€è¿‘å¶å­èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„ä¸Šçš„èŠ‚ç‚¹æ•°é‡ã€‚ è¯´æ˜Žï¼šå¶å­èŠ‚ç‚¹æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [3,9,20,null,null,15,7]è¾“å‡ºï¼š2 ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [2,null,3,null,4,null,5,null,6]è¾“å‡ºï¼š5 æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°çš„èŒƒå›´åœ¨ [0, 105] å†… -1000 &lt;= Node.val &lt;= 1000 ä»£ç 12345678910111213141516171819class Solution &#123; public int minDepth(TreeNode root) &#123; return getDepth(root); &#125; private int getDepth(TreeNode root) &#123; if(root == null) &#123; return 0; &#125; int leftDepth = getDepth(root.left); int rightDepth = getDepth(root.right); if(root.left == null &amp;&amp; root.right != null) &#123; return 1 + rightDepth; &#125; if(root.left != null &amp;&amp; root.right == null) &#123; return 1 + leftDepth; &#125; return 1 + Math.min(leftDepth, rightDepth); &#125;&#125; 9. 222. å®Œå…¨äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°é—®é¢˜ç»™ä½ ä¸€æ£µ å®Œå…¨äºŒå‰æ ‘ çš„æ ¹èŠ‚ç‚¹ root ï¼Œæ±‚å‡ºè¯¥æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°ã€‚ å®Œå…¨äºŒå‰æ ‘ çš„å®šä¹‰å¦‚ä¸‹ï¼šåœ¨å®Œå…¨äºŒå‰æ ‘ä¸­ï¼Œé™¤äº†æœ€åº•å±‚èŠ‚ç‚¹å¯èƒ½æ²¡å¡«æ»¡å¤–ï¼Œå…¶ä½™æ¯å±‚èŠ‚ç‚¹æ•°éƒ½è¾¾åˆ°æœ€å¤§å€¼ï¼Œå¹¶ä¸”æœ€ä¸‹é¢ä¸€å±‚çš„èŠ‚ç‚¹éƒ½é›†ä¸­åœ¨è¯¥å±‚æœ€å·¦è¾¹çš„è‹¥å¹²ä½ç½®ã€‚è‹¥æœ€åº•å±‚ä¸ºç¬¬ h å±‚ï¼Œåˆ™è¯¥å±‚åŒ…å« 1~ 2h ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,2,3,4,5,6]è¾“å‡ºï¼š6 ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼š0 ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [1]è¾“å‡ºï¼š1 æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯[0, 5 * 104] 0 &lt;= Node.val &lt;= 5 * 104 é¢˜ç›®æ•°æ®ä¿è¯è¾“å…¥çš„æ ‘æ˜¯ å®Œå…¨äºŒå‰æ ‘ ä»£ç  å±‚æ¬¡éåŽ†è¿­ä»£æ³• 123456789101112131415161718 // æ ¹æ®å®Œå…¨äºŒå‰æ ‘çš„ç‰¹æ€§ï¼Œä½¿ç”¨å±‚åºéåŽ†è§£å†³class Solution &#123; public int countNodes(TreeNode root) &#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); if(root == null) &#123; return 0; &#125; int nodeCount = 0; queue.offer(root); while(!queue.isEmpty()) &#123; nodeCount++; TreeNode node = queue.poll(); if(node.left != null) queue.offer(node.left); if(node.right != null) queue.offer(node.right); &#125; return nodeCount; &#125;&#125; åŽåºéåŽ†é€’å½’æ³• 1234567891011121314 // æ™®é€šäºŒå‰æ ‘ é€’å½’ åŽåºéåŽ†class Solution &#123; public int countNodes(TreeNode root) &#123; return getNoeCounts(root); &#125; private int getNoeCounts(TreeNode node) &#123; if(node == null) &#123; return 0; &#125; int leftNodeCounts = getNoeCounts(node.left); int rightNodeCounts = getNoeCounts(node.right); return leftNodeCounts + rightNodeCounts + 1; &#125;&#125; 10. 110. å¹³è¡¡äºŒå‰æ ‘é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œåˆ¤æ–­å®ƒæ˜¯å¦æ˜¯é«˜åº¦å¹³è¡¡çš„äºŒå‰æ ‘ã€‚ æœ¬é¢˜ä¸­ï¼Œä¸€æ£µé«˜åº¦å¹³è¡¡äºŒå‰æ ‘å®šä¹‰ä¸ºï¼š ä¸€ä¸ªäºŒå‰æ ‘æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1 ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [3,9,20,null,null,15,7]è¾“å‡ºï¼štrue ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [1,2,2,3,3,null,null,4,4]è¾“å‡ºï¼šfalse ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = []è¾“å‡ºï¼štrue æç¤ºï¼š æ ‘ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ [0, 5000] å†… -104 &lt;= Node.val &lt;= 104 ä»£ç åŽåºéåŽ†é€’å½’æ³• 1234567891011121314151617181920 // æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1class Solution &#123; public boolean isBalanced(TreeNode root) &#123; if(root == null) &#123; return true; &#125; return NodeHeigh(root) == -1 ? false : true; &#125; // é€’å½’å°è¯• æ‰¾åˆ°ä¸€å¤„ é«˜åº¦å·® ä¸º &gt; 1,å¦‚æœ‰ åœæ­¢ è®¡ç®—é«˜åº¦ï¼Œç›´æŽ¥ ç”±å†…åˆ°å¤–è¿”å›ž ç»“æžœ private int NodeHeigh(TreeNode node) &#123; if(node == null) &#123; return 0; &#125; int leftHeigh = NodeHeigh(node.left); int rightHeigh = NodeHeigh(node.right); if(leftHeigh == -1 || rightHeigh == -1) return -1; int heigh = Math.max(leftHeigh, rightHeigh) + 1; return Math.abs(leftHeigh - rightHeigh) &gt; 1 ? -1 : heigh; &#125;&#125; å‰åºéåŽ†è¿­ä»£æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152 // æ¯ä¸ªèŠ‚ç‚¹ çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1// å‰åº éåŽ† æ±‚ æ·±åº¦class Solution &#123; public boolean isBalanced(TreeNode root) &#123; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root == null) &#123; return true; &#125; stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.pop(); // èŽ·å– ä¸¤æ£µ å­æ ‘ çš„é«˜åº¦å·® if(Math.abs(getDepth(node.left) - getDepth(node.right)) &gt; 1) &#123; return false; &#125; // å¤§å­æ ‘ ä¸è¶…è¿‡ï¼ŒéåŽ† å°å­æ ‘ if(node.right != null) stack.push(node.right); if(node.left != null) stack.push(node.left); &#125; return true; &#125; // å‡†ç¡®æ¥è¯´ è®¡ç®—çš„æ˜¯ èŠ‚ç‚¹çš„é«˜åº¦ï¼ˆè¯¥èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹ï¼‰ // åŽåº éåŽ† æ±‚ é«˜åº¦ private int getDepth(TreeNode root) &#123; Integer depth = 0; Integer res = 0; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); if(root == null) &#123; return 0; &#125; stack.push(root); while(!stack.empty()) &#123; // æ ˆå­˜æ”¾äº† ç©ºæŒ‡é’ˆ TreeNode node = stack.peek(); if(node != null) &#123; node = stack.pop(); stack.push(node); stack.push(null); depth++; if(node.right != null) stack.push(node.right); if(node.left != null) stack.push(node.left); &#125; else &#123; // å¼¹å‡º ç©ºæŒ‡é’ˆ stack.pop(); node = stack.pop(); depth--; // ç±»ä¼¼ å›žæº¯ &#125; res = depth &gt; res ? depth : res; &#125; return res; &#125; &#125; 11. 257. äºŒå‰æ ‘çš„æ‰€æœ‰è·¯å¾„ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼ŒæŒ‰ ä»»æ„é¡ºåº ï¼Œè¿”å›žæ‰€æœ‰ä»Žæ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚ å¶å­èŠ‚ç‚¹ æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹1: 12è¾“å…¥ï¼šroot = [1,2,3,null,5]è¾“å‡ºï¼š[&quot;1-&gt;2-&gt;5&quot;,&quot;1-&gt;3&quot;] å®žä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [1]è¾“å‡ºï¼š[&quot;1&quot;] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [1, 100] å†… -100 &lt;= Node.val &lt;= 100 ä»£ç  é€’å½’æ³• 1234567891011121314151617181920212223class Solution &#123; public List&lt;String&gt; binaryTreePaths(TreeNode root) &#123; List&lt;String&gt; res = new ArrayList&lt;&gt;(); if(root == null) &#123; return res; &#125; backtrack(root, res, &quot;&quot;); return res; &#125; // å‰åºé€’å½’éåŽ† æ‰€æœ‰èŠ‚ç‚¹ private void backtrack(TreeNode cur,List&lt;String&gt; res, String path) &#123; // ä¸æ˜¯ç©ºèŠ‚ç‚¹ åŠ ä¸Š path += cur.val; // æ‰¾åˆ° å¶å­èŠ‚ç‚¹ if(cur.left == null &amp;&amp; cur.right == null) &#123; res.add(path); return; &#125; if(cur.left != null) backtrack(cur.left, res, path + &quot;-&gt;&quot;); // éšè—äº† å›žæº¯ï¼Œpath æ˜¯ String ç±»åž‹ï¼Œä¸å¯å˜ç±» if(cur.right != null) backtrack(cur.right, res, path + &quot;-&gt;&quot;); &#125;&#125; è¿­ä»£æ³• 12345678910111213141516171819202122232425262728class Solution &#123; public List&lt;String&gt; binaryTreePaths(TreeNode root) &#123; List&lt;String&gt; res = new ArrayList&lt;&gt;(); if(root == null) &#123; return res; &#125; Stack&lt;String&gt; pathSt = new Stack&lt;&gt;(); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); pathSt.push(root.val + &quot;&quot;); stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.pop(); String path = pathSt.pop(); if(node.left == null &amp;&amp; node.right == null) &#123; res.add(path); &#125; if(node.right != null) &#123; pathSt.push(path + &quot;-&gt;&quot; + node.right.val); stack.push(node.right); &#125; if(node.left != null) &#123; pathSt.push(path + &quot;-&gt;&quot; + node.left.val); stack.push(node.left); &#125; &#125; return res; &#125;&#125; 12. 100. ç›¸åŒçš„æ ‘é—®é¢˜ç»™ä½ ä¸¤æ£µäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ p å’Œ q ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ£€éªŒè¿™ä¸¤æ£µæ ‘æ˜¯å¦ç›¸åŒã€‚ å¦‚æžœä¸¤ä¸ªæ ‘åœ¨ç»“æž„ä¸Šç›¸åŒï¼Œå¹¶ä¸”èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„å€¼ï¼Œåˆ™è®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šp = [1,2,3], q = [1,2,3]è¾“å‡ºï¼štrue ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šp = [1,2], q = [1,null,2]è¾“å‡ºï¼šfalse ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šp = [1,2,1], q = [1,1,2]è¾“å‡ºï¼šfalse æç¤ºï¼š ä¸¤æ£µæ ‘ä¸Šçš„èŠ‚ç‚¹æ•°ç›®éƒ½åœ¨èŒƒå›´ [0, 100] å†… -104 &lt;= Node.val &lt;= 104 ä»£ç  é€’å½’æ³• 1234567891011121314 // å‰åºé€’å½’éåŽ†class Solution &#123; public boolean isSameTree(TreeNode p, TreeNode q) &#123; if(p == null &amp;&amp; q == null) return true; else if(p == null &amp;&amp; q != null) return false; else if(p != null &amp;&amp; q == null) return false; else if(p.val != q.val) return false; boolean leftTreeSame = isSameTree(p.left, q.left); boolean rightTreeSame = isSameTree(p.right, q.right); boolean isSame = leftTreeSame &amp;&amp; rightTreeSame; return isSame; &#125;&#125; è¿­ä»£æ³• 12345678910111213141516171819202122232425 // å±‚åºè¿­ä»£éåŽ†class Solution &#123; public boolean isSameTree(TreeNode p, TreeNode q) &#123; if(p == null &amp;&amp; q == null) return true; if(p == null || q == null) return false; // p å’Œ q éƒ½ä¸ç­‰äºŽ null Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(p); stack.push(q); while(!stack.empty()) &#123; TreeNode leftNode = stack.pop(); TreeNode rightNode = stack.pop(); if(leftNode == null &amp;&amp; rightNode == null) continue; if(leftNode == null || rightNode == null || leftNode.val != rightNode.val) &#123; return false; &#125; // leftNode å’Œ rightNode éƒ½ä¸ä¸º null stack.push(leftNode.left); stack.push(rightNode.left); stack.push(leftNode.right); stack.push(rightNode.right); &#125; return true; &#125;&#125; 13. 112. è·¯å¾„æ€»å’Œé—®é¢˜ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªè¡¨ç¤ºç›®æ ‡å’Œçš„æ•´æ•° targetSum ã€‚åˆ¤æ–­è¯¥æ ‘ä¸­æ˜¯å¦å­˜åœ¨ æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹ çš„è·¯å¾„ï¼Œè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰èŠ‚ç‚¹å€¼ç›¸åŠ ç­‰äºŽç›®æ ‡å’Œ targetSum ã€‚å¦‚æžœå­˜åœ¨ï¼Œè¿”å›ž true ï¼›å¦åˆ™ï¼Œè¿”å›ž false ã€‚ å¶å­èŠ‚ç‚¹ æ˜¯æŒ‡æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šroot = [5,4,8,11,null,13,4,7,2,null,null,null,1], targetSum = 22è¾“å‡ºï¼štrueè§£é‡Šï¼šç­‰äºŽç›®æ ‡å’Œçš„æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹è·¯å¾„å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚ ç¤ºä¾‹2ï¼š 123456è¾“å…¥ï¼šroot = [1,2,3], targetSum = 5è¾“å‡ºï¼šfalseè§£é‡Šï¼šæ ‘ä¸­å­˜åœ¨ä¸¤æ¡æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ï¼š(1 --&gt; 2): å’Œä¸º 3(1 --&gt; 3): å’Œä¸º 4ä¸å­˜åœ¨ sum = 5 çš„æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚ ç¤ºä¾‹3ï¼š 123è¾“å…¥ï¼šroot = [], targetSum = 0è¾“å‡ºï¼šfalseè§£é‡Šï¼šç”±äºŽæ ‘æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹çš„è·¯å¾„ã€‚ æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [0, 5000] å†… 1000 &lt;= Node.val &lt;= 1000 1000 &lt;= targetSum &lt;= 1000 ä»£ç  å‰åºéåŽ†é€’å½’æ³• 1234567891011121314151617class Solution &#123; boolean res = false; public boolean hasPathSum(TreeNode root, int targetSum) &#123; if(root == null) &#123; return false; &#125; backtrack(root, targetSum, root.val); return res; &#125; private void backtrack(TreeNode node, int targetSum, int sum) &#123; if(node.left == null &amp;&amp; node.right == null &amp;&amp; sum == targetSum) &#123; res = true; &#125; if(node.left != null) backtrack(node.left, targetSum, sum + node.left.val); if(node.right != null) backtrack(node.right, targetSum, sum + node.right.val); &#125;&#125; å‰åºéåŽ†è¿­ä»£æ³• 12345678910111213141516171819202122232425262728class Solution &#123; boolean res = false; public boolean hasPathSum(TreeNode root, int targetSum) &#123; if(root == null) &#123; return false; &#125; Stack&lt;TreeNode&gt; tNst = new Stack&lt;&gt;(); Stack&lt;Integer&gt; valSt = new Stack&lt;&gt;(); tNst.push(root); valSt.push(root.val); while(!tNst.empty()) &#123; TreeNode node = tNst.pop(); int sum = valSt.pop(); if(node.left == null &amp;&amp; node.right == null &amp;&amp; sum == targetSum) &#123; return true; &#125; if(node.left != null) &#123; valSt.push(sum + node.left.val); tNst.push(node.left); &#125; if(node.right != null) &#123; valSt.push(sum + node.right.val); tNst.push(node.right); &#125; &#125; return false; &#125;&#125; 14. 106. ä»Žä¸­åºä¸ŽåŽåºéåŽ†åºåˆ—æž„é€ äºŒå‰æ ‘é—®é¢˜ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ inorder å’Œ postorder ï¼Œå…¶ä¸­ inorder æ˜¯äºŒå‰æ ‘çš„ä¸­åºéåŽ†ï¼Œ postorder æ˜¯åŒä¸€æ£µæ ‘çš„åŽåºéåŽ†ï¼Œè¯·ä½ æž„é€ å¹¶è¿”å›žè¿™é¢— äºŒå‰æ ‘ ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šinorder = [9,3,15,20,7], postorder = [9,15,7,20,3]è¾“å‡ºï¼š[3,9,20,null,null,15,7] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šinorder = [-1], postorder = [-1]è¾“å‡ºï¼š[-1] æç¤º: 1 &lt;= inorder.length &lt;= 3000 postorder.length == inorder.length -3000 &lt;= inorder[i], postorder[i] &lt;= 3000 inorder å’Œ postorder éƒ½ç”± ä¸åŒ çš„å€¼ç»„æˆ postorder ä¸­æ¯ä¸€ä¸ªå€¼éƒ½åœ¨ inorder ä¸­ inorder ä¿è¯æ˜¯æ ‘çš„ä¸­åºéåŽ† postorder ä¿è¯æ˜¯æ ‘çš„åŽåºéåŽ† ä»£ç  å‰åºéåŽ†é€’å½’æ³• ( DFS å†™æ³• ) 1234567891011121314151617181920212223class Solution &#123; public TreeNode buildTree(int[] inorder, int[] postorder) &#123; return backtrack(inorder, 0, inorder.length, postorder, 0, postorder.length); &#125; // å·¦é—­å³å¼€åŒºé—´ private TreeNode backtrack(int[] inorder, int inLeft, int inRight, int[] postorder, int postLeft, int postRight) &#123; int index = inLeft; if(inLeft == inRight) return null; TreeNode root = new TreeNode(postorder[postRight - 1]); // æ‰€ä»¥for å¾ªçŽ¯ ç»ˆæ­¢æ¡ä»¶æ˜¯ &lt; ç¬¦åˆ for(int i = inLeft; i &lt; inRight; i++) &#123; if(inorder[i] == postorder[postRight - 1]) &#123; index = i; break; &#125; &#125; // æ‰¾çš„æ˜¯ å·¦åŒºé—´ï¼Œä¹Ÿå°±æ˜¯ å·¦èŠ‚ç‚¹ root.left = backtrack(inorder, inLeft, index, postorder, postLeft, postLeft + (index - inLeft)); // æ‰¾çš„æ˜¯ å³åŒºé—´ï¼Œä¹Ÿå°±æ˜¯ å³èŠ‚ç‚¹ root.right = backtrack(inorder, index + 1, inRight, postorder, postLeft + (index - inLeft), postRight - 1); return root; &#125;&#125; 15. 105. ä»Žå‰åºä¸Žä¸­åºéåŽ†åºåˆ—æž„é€ äºŒå‰æ ‘é—®é¢˜ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ preorder å’Œ inorder ï¼Œå…¶ä¸­ preorder æ˜¯äºŒå‰æ ‘çš„å…ˆåºéåŽ†ï¼Œ inorder æ˜¯åŒä¸€æ£µæ ‘çš„ä¸­åºéåŽ†ï¼Œè¯·æž„é€ äºŒå‰æ ‘å¹¶è¿”å›žå…¶æ ¹èŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥: preorder = [3,9,20,15,7], inorder = [9,3,15,20,7]è¾“å‡º: [3,9,20,null,null,15,7] ç¤ºä¾‹2ï¼š 12è¾“å…¥: preorder = [-1], inorder = [-1]è¾“å‡º: [-1] æç¤º: 1 &lt;= preorder.length &lt;= 3000 inorder.length == preorder.length -3000 &lt;= preorder[i], inorder[i] &lt;= 3000 preorder å’Œ inorder å‡ æ— é‡å¤ å…ƒç´  inorder å‡å‡ºçŽ°åœ¨ preorder preorder ä¿è¯ ä¸ºäºŒå‰æ ‘çš„å‰åºéåŽ†åºåˆ— inorder ä¿è¯ ä¸ºäºŒå‰æ ‘çš„ä¸­åºéåŽ†åºåˆ— ä»£ç  DFS é€’å½’æ³• 12345678910111213141516171819class Solution &#123; public TreeNode buildTree(int[] preorder, int[] inorder) &#123; return backtrack(preorder, 0, preorder.length, inorder, 0, inorder.length); &#125; private TreeNode backtrack(int[] preorder, int preLeft, int preRight, int[] inorder, int inLeft, int inRight) &#123; if(inLeft == inRight) return null; TreeNode root = new TreeNode(preorder[preLeft]); int index = inLeft; for(int i = inLeft; i &lt; inRight; i++) &#123; if(inorder[i] == preorder[preLeft]) &#123; index = i; break; &#125; &#125; root.left = backtrack(preorder, preLeft + 1, preLeft + 1 + (index - inLeft), inorder, inLeft, index); root.right = backtrack(preorder, preLeft + 1 + (index - inLeft), preRight, inorder, index + 1, inRight); return root; &#125;&#125; 16. 654. æœ€å¤§äºŒå‰æ ‘é—®é¢˜ç»™å®šä¸€ä¸ªä¸é‡å¤çš„æ•´æ•°æ•°ç»„ nums ã€‚ æœ€å¤§äºŒå‰æ ‘ å¯ä»¥ç”¨ä¸‹é¢çš„ç®—æ³•ä»Ž nums é€’å½’åœ°æž„å»º: åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå…¶å€¼ä¸º nums ä¸­çš„æœ€å¤§å€¼ã€‚é€’å½’åœ°åœ¨æœ€å¤§å€¼ å·¦è¾¹ çš„ å­æ•°ç»„å‰ç¼€ä¸Š æž„å»ºå·¦å­æ ‘ã€‚é€’å½’åœ°åœ¨æœ€å¤§å€¼ å³è¾¹ çš„ å­æ•°ç»„åŽç¼€ä¸Š æž„å»ºå³å­æ ‘ã€‚è¿”å›ž nums æž„å»ºçš„ æœ€å¤§äºŒå‰æ ‘ ã€‚ ç¤ºä¾‹1ï¼š 123456789101112è¾“å…¥ï¼šnums = [3,2,1,6,0,5]è¾“å‡ºï¼š[6,3,5,null,2,0,null,null,1]è§£é‡Šï¼šé€’å½’è°ƒç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š- [3,2,1,6,0,5] ä¸­çš„æœ€å¤§å€¼æ˜¯ 6 ï¼Œå·¦è¾¹éƒ¨åˆ†æ˜¯ [3,2,1] ï¼Œå³è¾¹éƒ¨åˆ†æ˜¯ [0,5] ã€‚ - [3,2,1] ä¸­çš„æœ€å¤§å€¼æ˜¯ 3 ï¼Œå·¦è¾¹éƒ¨åˆ†æ˜¯ [] ï¼Œå³è¾¹éƒ¨åˆ†æ˜¯ [2,1] ã€‚ - ç©ºæ•°ç»„ï¼Œæ— å­èŠ‚ç‚¹ã€‚ - [2,1] ä¸­çš„æœ€å¤§å€¼æ˜¯ 2 ï¼Œå·¦è¾¹éƒ¨åˆ†æ˜¯ [] ï¼Œå³è¾¹éƒ¨åˆ†æ˜¯ [1] ã€‚ - ç©ºæ•°ç»„ï¼Œæ— å­èŠ‚ç‚¹ã€‚ - åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå€¼ä¸º 1 çš„èŠ‚ç‚¹ã€‚ - [0,5] ä¸­çš„æœ€å¤§å€¼æ˜¯ 5 ï¼Œå·¦è¾¹éƒ¨åˆ†æ˜¯ [0] ï¼Œå³è¾¹éƒ¨åˆ†æ˜¯ [] ã€‚ - åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥å­èŠ‚ç‚¹æ˜¯ä¸€ä¸ªå€¼ä¸º 0 çš„èŠ‚ç‚¹ã€‚ - ç©ºæ•°ç»„ï¼Œæ— å­èŠ‚ç‚¹ã€‚ ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šnums = [3,2,1]è¾“å‡ºï¼š[3,null,2,null,1] æç¤ºï¼š 1 &lt;= nums.length &lt;= 1000 0 &lt;= nums[i] &lt;= 1000 nums ä¸­çš„æ‰€æœ‰æ•´æ•° äº’ä¸ç›¸åŒ ä»£ç 12345678910111213141516171819202122class Solution &#123; public TreeNode constructMaximumBinaryTree(int[] nums) &#123; return recursion(nums, 0, nums.length); &#125; private TreeNode recursion(int[] nums, int leftIndex, int rightIndex) &#123; if(leftIndex == rightIndex) &#123; return null; &#125; int maxIndex = leftIndex; int max = nums[maxIndex]; for(int i = leftIndex; i &lt; rightIndex; i++) &#123; if(max &lt; nums[i]) &#123; max = nums[i]; maxIndex = i; &#125; &#125; TreeNode root = new TreeNode(max); root.left = recursion(nums, leftIndex, maxIndex); root.right = recursion(nums, maxIndex + 1, rightIndex); return root; &#125;&#125; å°æ€»ç»“æ¶‰åŠåˆ°ä½¿ç”¨æ•°ç»„é€’å½’åˆ›å»ºäºŒå‰æ ‘å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ¨¡æ¿ 1234567891011121314151617181920class Solution &#123; public TreeNode constructMaximumBinaryTree(int[] nums) &#123; return recursion(nums, 0, nums.length, ...); &#125; private TreeNode recursion(int[] nums, int leftIndex, int rightIndex, ...) &#123; if(leftIndex == rightIndex) &#123; return null; &#125; // åˆå§‹åŒ– è¦åˆ›å»ºçš„èŠ‚ç‚¹åæ ‡ int rootIndex = 0; for(int i = leftIndex; i &lt; rightIndex; i++) &#123; // æ»¡è¶³åˆ›å»ºèŠ‚ç‚¹æ¡ä»¶ // rootIndex = ? &#125; TreeNode root = new TreeNode(nums[rootIndex]); root.left = recursion(nums, leftIndex, maxIndex, ...); root.right = recursion(nums, maxIndex + 1, rightIndex, ...); return root; &#125;&#125; 17. 617. åˆå¹¶äºŒå‰æ ‘é—®é¢˜ç»™ä½ ä¸¤æ£µäºŒå‰æ ‘ï¼š root1 å’Œ root2 ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œå½“ä½ å°†å…¶ä¸­ä¸€æ£µè¦†ç›–åˆ°å¦ä¸€æ£µä¹‹ä¸Šæ—¶ï¼Œä¸¤æ£µæ ‘ä¸Šçš„ä¸€äº›èŠ‚ç‚¹å°†ä¼šé‡å ï¼ˆè€Œå¦ä¸€äº›ä¸ä¼šï¼‰ã€‚ä½ éœ€è¦å°†è¿™ä¸¤æ£µæ ‘åˆå¹¶æˆä¸€æ£µæ–°äºŒå‰æ ‘ã€‚åˆå¹¶çš„è§„åˆ™æ˜¯ï¼šå¦‚æžœä¸¤ä¸ªèŠ‚ç‚¹é‡å ï¼Œé‚£ä¹ˆå°†è¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼ç›¸åŠ ä½œä¸ºåˆå¹¶åŽèŠ‚ç‚¹çš„æ–°å€¼ï¼›å¦åˆ™ï¼Œä¸ä¸º null çš„èŠ‚ç‚¹å°†ç›´æŽ¥ä½œä¸ºæ–°äºŒå‰æ ‘çš„èŠ‚ç‚¹ã€‚ è¿”å›žåˆå¹¶åŽçš„äºŒå‰æ ‘ã€‚ æ³¨æ„: åˆå¹¶è¿‡ç¨‹å¿…é¡»ä»Žä¸¤ä¸ªæ ‘çš„æ ¹èŠ‚ç‚¹å¼€å§‹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot1 = [1,3,2,5], root2 = [2,1,3,null,4,null,7]è¾“å‡ºï¼š[3,4,5,5,4,null,7] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot1 = [1], root2 = [1,2]è¾“å‡ºï¼š[2,2] æç¤ºï¼š ä¸¤æ£µæ ‘ä¸­çš„èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [0, 2000] å†… -104 &lt;= Node.val &lt;= 104 ä»£ç  å‰åºéåŽ†é€’å½’æ³• 12345678910class Solution &#123; public TreeNode mergeTrees(TreeNode root1, TreeNode root2) &#123; if(root1 == null) return root2; if(root2 == null) return root1; root1.val += root2.val; root1.left = mergeTrees(root1.left, root2.left); root1.right = mergeTrees(root1.right, root2.right); return root1; &#125;&#125; å±‚åºéåŽ†è¿­ä»£æ³• 123456789101112131415161718192021222324252627282930class Solution &#123; public TreeNode mergeTrees(TreeNode root1, TreeNode root2) &#123; if(root1 == null) return root2; if(root2 == null) return root1; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root2); stack.push(root1); while(!stack.empty()) &#123; TreeNode node1 = stack.pop(); TreeNode node2 = stack.pop(); node1.val += node2.val; if(node1.left != null &amp;&amp; node2.left != null) &#123; stack.push(node2.left); stack.push(node1.left); &#125; if(node1.right != null &amp;&amp; node2.right != null) &#123; stack.push(node2.right); stack.push(node1.right); &#125; // è¿™é‡Œ èµ‹å€¼çš„ æ˜¯ node2 çš„å­æ ‘ï¼ˆå­æ ‘ï¼ï¼‰ if(node1.left == null &amp;&amp; node2.left != null) &#123; node1.left = node2.left; &#125; if(node1.right == null &amp;&amp; node2.right != null) &#123; node1.right = node2.right; &#125; &#125; return root1; &#125;&#125; 18. 700. äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢é—®é¢˜ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªæ•´æ•°å€¼ valã€‚ ä½ éœ€è¦åœ¨ BST ä¸­æ‰¾åˆ°èŠ‚ç‚¹å€¼ç­‰äºŽ val çš„èŠ‚ç‚¹ã€‚ è¿”å›žä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ã€‚ å¦‚æžœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ž null ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [4,2,7,1,3], val = 2è¾“å‡ºï¼š[2,1,3] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [4,2,7,1,3], val = 5è¾“å‡ºï¼š[] æç¤ºï¼š æ•°ä¸­èŠ‚ç‚¹æ•°åœ¨ [1, 5000] èŒƒå›´å†… 1 &lt;= Node.val &lt;= 107 root æ˜¯äºŒå‰æœç´¢æ ‘ 1 &lt;= val &lt;= 107 ä»£ç  å‰åºéåŽ†é€’å½’æ³• 123456789101112131415class Solution &#123; private TreeNode res = null; public TreeNode searchBST(TreeNode root, int val) &#123; search(root, val); return res; &#125; private void search(TreeNode root, int val) &#123; if(root.val == val) &#123; res = root; return; &#125; if(root.left != null) search(root.left, val); if(root.right != null) search(root.right, val); &#125;&#125; 19. 700. äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢é—®é¢˜ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªæ•´æ•°å€¼ valã€‚ ä½ éœ€è¦åœ¨ BST ä¸­æ‰¾åˆ°èŠ‚ç‚¹å€¼ç­‰äºŽ val çš„èŠ‚ç‚¹ã€‚ è¿”å›žä»¥è¯¥èŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ã€‚ å¦‚æžœèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ž null ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [4,2,7,1,3], val = 2è¾“å‡ºï¼š[2,1,3] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [4,2,7,1,3], val = 5è¾“å‡ºï¼š[] æç¤ºï¼š æ•°ä¸­èŠ‚ç‚¹æ•°åœ¨ [1, 5000] èŒƒå›´å†… 1 &lt;= Node.val &lt;= 107 root æ˜¯äºŒå‰æœç´¢æ ‘ 1 &lt;= val &lt;= 107 ä»£ç 123456789101112131415class Solution &#123; public TreeNode searchBST(TreeNode root, int val) &#123; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.pop(); if(node.val == val) &#123; return node; &#125; if(node.right != null) stack.push(node.right); if(node.left != null) stack.push(node.left); &#125; return null; &#125;&#125; 20. 98. éªŒè¯äºŒå‰æœç´¢æ ‘é—®é¢˜ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œåˆ¤æ–­å…¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘ã€‚ æœ‰æ•ˆ äºŒå‰æœç´¢æ ‘å®šä¹‰å¦‚ä¸‹ï¼š èŠ‚ç‚¹çš„å·¦å­æ ‘åªåŒ…å« å°äºŽ å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚èŠ‚ç‚¹çš„å³å­æ ‘åªåŒ…å« å¤§äºŽ å½“å‰èŠ‚ç‚¹çš„æ•°ã€‚æ‰€æœ‰å·¦å­æ ‘å’Œå³å­æ ‘è‡ªèº«å¿…é¡»ä¹Ÿæ˜¯äºŒå‰æœç´¢æ ‘ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [2,1,3]è¾“å‡ºï¼štrue ç¤ºä¾‹2ï¼š 123è¾“å…¥ï¼šroot = [5,1,4,null,null,3,6]è¾“å‡ºï¼šfalseè§£é‡Šï¼šæ ¹èŠ‚ç‚¹çš„å€¼æ˜¯ 5 ï¼Œä½†æ˜¯å³å­èŠ‚ç‚¹çš„å€¼æ˜¯ 4 ã€‚ æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®èŒƒå›´åœ¨[1, 104] å†… -231 &lt;= Node.val &lt;= 231 - 1 ä»£ç  ä¸­åºéåŽ†é€’å½’æ³• 12345678910111213141516171819 // æ³¨æ„ ä¿å­˜ä¸Šä¸€ä¸ªå€¼æ¥æ¯”è¾ƒï¼Œåˆå§‹åŒ–è¦å°äºŽ int ç±»åž‹æœ€å°å€¼class Solution &#123; private long preVal = ((long)Integer.MIN_VALUE - 1); private boolean isTrue = true; public boolean isValidBST(TreeNode root) &#123; recursion(root); return isTrue; &#125; private void recursion(TreeNode node) &#123; if(node == null) return; if(node.left != null &amp;&amp; isTrue) recursion(node.left); if(node.val &lt;= preVal) &#123; isTrue = false; return; &#125; preVal = node.val; if(node.right != null &amp; isTrue) recursion(node.right); &#125;&#125; ä¸­åºéåŽ†è¿­ä»£æ³• 12345678910111213141516171819202122232425class Solution &#123; public boolean isValidBST(TreeNode root) &#123; long preVal = ((long)Integer.MIN_VALUE - 1); Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); if(node.right != null) stack.push(node.right); stack.push(node); stack.push(null); if(node.left != null) stack.push(node.left); &#125; else &#123; stack.pop(); node = stack.pop(); if(node.val &lt;= preVal) &#123; return false; &#125; preVal = node.val; &#125; &#125; return true; &#125;&#125; 21. 530. äºŒå‰æœç´¢æ ‘çš„æœ€å°ç»å¯¹å·®é—®é¢˜ç»™ä½ ä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›ž æ ‘ä¸­ä»»æ„ä¸¤ä¸åŒèŠ‚ç‚¹å€¼ä¹‹é—´çš„æœ€å°å·®å€¼ ã€‚ å·®å€¼æ˜¯ä¸€ä¸ªæ­£æ•°ï¼Œå…¶æ•°å€¼ç­‰äºŽä¸¤å€¼ä¹‹å·®çš„ç»å¯¹å€¼ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [4,2,6,1,3]è¾“å‡ºï¼š1 ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [1,0,48,null,null,12,49]è¾“å‡ºï¼š1 æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [2, 104] 0 &lt;= Node.val &lt;= 105 ä»£ç  ä¸­åºéåŽ†é€’å½’æ³• 12345678910111213141516171819 // ä¸­åºéåŽ†ï¼Œä¿å­˜å‰ä¸€å…ƒç´ å˜é‡å’Œå½“å‰æœ€æ–°å·®å˜é‡class Solution &#123; private int diffVal = Integer.MAX_VALUE; private int preVal = - 100000; public int getMinimumDifference(TreeNode root) &#123; recursion(root); return diffVal; &#125; private void recursion(TreeNode node) &#123; if(node == null) return; if(node.left != null) recursion(node.left); int curDiff = node.val - preVal; if(curDiff &lt; diffVal) &#123; diffVal = curDiff; &#125; preVal = node.val; if(node.right != null) recursion(node.right); &#125;&#125; ä¸­åºéåŽ†è¿­ä»£æ³• 12345678910111213141516171819202122232425262728 // ä¸­åºéåŽ†ï¼Œä¿å­˜å‰ä¸€å…ƒç´ å˜é‡å’Œå½“å‰æœ€æ–°å·®å˜é‡class Solution &#123; public int getMinimumDifference(TreeNode root) &#123; int diffVal = Integer.MAX_VALUE; int preVal = - 100000; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); if(node.right != null) stack.push(node.right); stack.push(node); stack.push(null); if(node.left != null) stack.push(node.left); &#125; else &#123; stack.pop(); node = stack.pop(); int curDiff = node.val - preVal; if(curDiff &lt; diffVal) &#123; diffVal = curDiff; &#125; preVal = node.val; &#125; &#125; return diffVal; &#125;&#125; 22. 501. äºŒå‰æœç´¢æ ‘ä¸­çš„ä¼—æ•°é—®é¢˜ç»™ä½ ä¸€ä¸ªå«é‡å¤å€¼çš„äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹ root ï¼Œæ‰¾å‡ºå¹¶è¿”å›ž BST ä¸­çš„æ‰€æœ‰ ä¼—æ•°ï¼ˆå³ï¼Œå‡ºçŽ°é¢‘çŽ‡æœ€é«˜çš„å…ƒç´ ï¼‰ã€‚ å¦‚æžœæ ‘ä¸­æœ‰ä¸æ­¢ä¸€ä¸ªä¼—æ•°ï¼Œå¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›žã€‚ å‡å®š BST æ»¡è¶³å¦‚ä¸‹å®šä¹‰ï¼š ç»“ç‚¹å·¦å­æ ‘ä¸­æ‰€å«èŠ‚ç‚¹çš„å€¼ å°äºŽç­‰äºŽ å½“å‰èŠ‚ç‚¹çš„å€¼ç»“ç‚¹å³å­æ ‘ä¸­æ‰€å«èŠ‚ç‚¹çš„å€¼ å¤§äºŽç­‰äºŽ å½“å‰èŠ‚ç‚¹çš„å€¼å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯äºŒå‰æœç´¢æ ‘ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,null,2,2]è¾“å‡ºï¼š[2] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [0]è¾“å‡ºï¼š[0] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [1, 104] å†… -105 &lt;= Node.val &lt;= 105 ä»£ç  ä¸­åºéåŽ†è¿­ä»£æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041class Solution &#123; public int[] findMode(TreeNode root) &#123; int preVal = - 100000 - 1; List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); int maxTime = 1; int currentTime = 1; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); if(node.right != null) stack.push(node.right); stack.push(node); stack.push(null); if(node.left != null) stack.push(node.left); &#125; else &#123; stack.pop(); node = stack.pop(); // å…ˆ åˆ¤æ–­ æ˜¯å¦æœ‰ ç›¸åŒå…ƒç´  æ¥ è®¡å½“å‰å…ƒç´  æ¬¡æ•° if(node.val == preVal) &#123; currentTime++; &#125; else &#123; currentTime = 1; &#125; // å† é€šè¿‡ ç›¸åŒå…ƒç´ æ¬¡æ•° å’Œæœ€å¤§æ¬¡æ•° æ¯”è¾ƒ // ç›¸ç­‰å°± å†åŠ å…¥ç»“æžœ if(currentTime == maxTime) &#123; res.add(node.val); // å­˜åœ¨ ä¸€ä¸ªå…ƒç´  æ¯”ä¹‹å‰ æ¬¡æ•°è¿˜å¤šçš„ï¼Œé‚£ä¹‹å‰çš„å°±ä¸è¦äº†,æŠŠå½“å‰çš„å…ƒç´  åŠ å…¥ç»“æžœ &#125; else if(currentTime &gt; maxTime) &#123; maxTime = currentTime; res.clear(); res.add(node.val); &#125; preVal = node.val; &#125; &#125; return Arrays.stream(res.toArray(new Integer[0])).mapToInt(Integer::intValue).toArray(); &#125;&#125; ä¸­åºéåŽ†é€’å½’æ³• 12345678910111213141516171819202122232425262728293031323334class Solution &#123; private int preVal = - 100000 - 1; private List&lt;Integer&gt; res = new ArrayList&lt;&gt;(); private int maxTime = 1; private int currentTime = 1; public int[] findMode(TreeNode root) &#123; recursion(root); int[] intRes = new int[res.size()]; for(int i = 0; i &lt; res.size(); i++) &#123; intRes[i] = res.get(i); &#125; return intRes; &#125; private void recursion(TreeNode node) &#123; if(node.left != null )recursion(node.left); if(node.val == preVal) &#123; currentTime++; &#125; else &#123; currentTime = 1; &#125; // å† é€šè¿‡ ç›¸åŒå…ƒç´ æ¬¡æ•° å’Œæœ€å¤§æ¬¡æ•° æ¯”è¾ƒ // ç›¸ç­‰å°± å†åŠ å…¥ç»“æžœ if(currentTime == maxTime) &#123; res.add(node.val); // å­˜åœ¨ ä¸€ä¸ªå…ƒç´  æ¯”ä¹‹å‰ æ¬¡æ•°è¿˜å¤šçš„ï¼Œé‚£ä¹‹å‰çš„å°±ä¸è¦äº†,æŠŠå½“å‰çš„å…ƒç´  åŠ å…¥ç»“æžœ &#125; else if(currentTime &gt; maxTime) &#123; maxTime = currentTime; res.clear(); res.add(node.val); &#125; preVal = node.val; if(node.right != null) recursion(node.right); &#125;&#125; 23. 236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆé—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºŽæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€ ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1è¾“å‡ºï¼š3è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3 ã€‚ ç¤ºä¾‹2ï¼š 123è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4è¾“å‡ºï¼š5è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5 ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚ ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [1,2], p = 1, q = 2è¾“å‡ºï¼š1 æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°ç›®åœ¨èŒƒå›´ [2, 105] å†…ã€‚-109 &lt;= Node.val &lt;= 109æ‰€æœ‰ Node.val äº’ä¸ç›¸åŒ ã€‚p != qp å’Œ q å‡å­˜åœ¨äºŽç»™å®šçš„äºŒå‰æ ‘ä¸­ã€‚ ä»£ç  åŽåºéåŽ†é€’å½’æ³• 12345678910111213141516171819202122class Solution &#123; public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; // ç»ˆæ­¢æ¡ä»¶ï¼Œæ‰¾ä¸åˆ° è¿”å›ž nullï¼Œå¦åˆ™ è¿”å›ž ç›®æ ‡èŠ‚ç‚¹ if(root == null || root == p || root == q) return root; // åŽåºé€’å½’ TreeNode left = lowestCommonAncestor(root.left, p, q); TreeNode right = lowestCommonAncestor(root.right, p, q); // ç”± å…¬å…± ç¥–å…ˆ æ‰¾åˆ°ï¼Œè€Œä¸” å…¬å…±ç¥–å…ˆ ä¸ä¸º left æˆ– right if(left != null &amp;&amp; right != null) &#123; return root; &#125; // ç”± left å­æ ‘ä¸­ æ‰¾åˆ°ï¼Œå³ä¾§ä¸­ æ²¡æœ‰ p å’Œ qï¼Œè€Œä¸” æ‰¾åˆ°çš„ å¿…ç„¶æ˜¯ èŠ‚ç‚¹æ›´é«˜çš„ é‚£ä¸ª(åŽåºéåŽ†) if(left != null &amp;&amp; right == null) &#123; return left; // ç”± right å­æ ‘ä¸­ æ‰¾åˆ°ï¼Œå·¦ä¾§ä¸­ æ²¡æœ‰ p å’Œ qï¼Œè€Œä¸” æ‰¾åˆ°çš„ å¿…ç„¶æ˜¯ èŠ‚ç‚¹æ›´é«˜çš„ é‚£ä¸ª(åŽåºéåŽ†) &#125; else if(left == null &amp;&amp; right != null) &#123; return right; &#125; else &#123; return null; &#125; &#125;&#125; 24. 235. äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆé—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚ ç™¾åº¦ç™¾ç§‘ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºŽæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªç»“ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªç»“ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆï¼‰ã€‚â€ ä¾‹å¦‚ï¼Œç»™å®šå¦‚ä¸‹äºŒå‰æœç´¢æ ‘: root = [6,2,8,0,4,7,9,null,null,3,5] ç¤ºä¾‹1ï¼š 123è¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 8è¾“å‡º: 6 è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 8 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 6ã€‚ ç¤ºä¾‹2ï¼š 123è¾“å…¥: root = [6,2,8,0,4,7,9,null,null,3,5], p = 2, q = 4è¾“å‡º: 2è§£é‡Š: èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ 2, å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚ è¯´æ˜Ž: æ‰€æœ‰èŠ‚ç‚¹çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ã€‚ pã€q ä¸ºä¸åŒèŠ‚ç‚¹ä¸”å‡å­˜åœ¨äºŽç»™å®šçš„äºŒå‰æœç´¢æ ‘ä¸­ã€‚ ä»£ç  è¿­ä»£æ³• 1234567891011121314class Solution &#123; public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; while(root != null) &#123; if(root.val &lt; p.val &amp;&amp; root.val &lt; q.val) &#123; root = root.right; &#125; else if(root.val &gt; p.val &amp;&amp; root.val &gt; q.val) &#123; root = root.left; &#125; else &#123; break; &#125; &#125; return root; &#125;&#125; é€’å½’æ³• 12345678910class Solution &#123; public TreeNode lowestCommonAncestor(TreeNode root, TreeNode p, TreeNode q) &#123; if(root.val &lt; Math.min(p.val, q.val)) &#123; return lowestCommonAncestor(root.right, p, q); &#125; else if (root.val &gt; Math.max(p.val, q.val)) &#123; return lowestCommonAncestor(root.left, p, q); &#125; return root; &#125;&#125; 25. 701. äºŒå‰æœç´¢æ ‘ä¸­çš„æ’å…¥æ“ä½œé—®é¢˜ç»™å®šäºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰çš„æ ¹èŠ‚ç‚¹ root å’Œè¦æ’å…¥æ ‘ä¸­çš„å€¼ value ï¼Œå°†å€¼æ’å…¥äºŒå‰æœç´¢æ ‘ã€‚ è¿”å›žæ’å…¥åŽäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ è¾“å…¥æ•°æ® ä¿è¯ ï¼Œæ–°å€¼å’ŒåŽŸå§‹äºŒå‰æœç´¢æ ‘ä¸­çš„ä»»æ„èŠ‚ç‚¹å€¼éƒ½ä¸åŒã€‚ æ³¨æ„ï¼Œå¯èƒ½å­˜åœ¨å¤šç§æœ‰æ•ˆçš„æ’å…¥æ–¹å¼ï¼Œåªè¦æ ‘åœ¨æ’å…¥åŽä»ä¿æŒä¸ºäºŒå‰æœç´¢æ ‘å³å¯ã€‚ ä½ å¯ä»¥è¿”å›ž ä»»æ„æœ‰æ•ˆçš„ç»“æžœ ã€‚ ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šroot = [4,2,7,1,3], val = 5è¾“å‡ºï¼š[4,2,7,1,3,5]è§£é‡Šï¼šå¦ä¸€ä¸ªæ»¡è¶³é¢˜ç›®è¦æ±‚å¯ä»¥é€šè¿‡çš„æ ‘æ˜¯ï¼š ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [40,20,60,10,30,50,70], val = 25è¾“å‡ºï¼š[40,20,60,10,30,50,70,null,null,25] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [4,2,7,1,3,null,null,null,null,null,null], val = 5è¾“å‡ºï¼š[4,2,7,1,3,5] æç¤ºï¼š æ ‘ä¸­çš„èŠ‚ç‚¹æ•°å°†åœ¨ [0, 104]çš„èŒƒå›´å†…ã€‚ -108 &lt;= Node.val &lt;= 108 æ‰€æœ‰å€¼ Node.val æ˜¯ ç‹¬ä¸€æ— äºŒ çš„ã€‚ -108 &lt;= val &lt;= 108 ä¿è¯ val åœ¨åŽŸå§‹BSTä¸­ä¸å­˜åœ¨ã€‚ ä»£ç  é€’å½’æ³•ï¼ˆæ‰¾åˆ° å¯¹åº” ä½ç½®ï¼Œå›žæº¯åŽ æŒ‡å‘è§£å†³ï¼‰ 1234567891011class Solution &#123; public TreeNode insertIntoBST(TreeNode root, int val) &#123; // å‘ä¸‹æœç´¢åˆ° æŒ‡å®š ç©ºèŠ‚ç‚¹ä½ç½®ï¼Œå›žæº¯åŽç”±å¯¹åº”çš„ çˆ¶èŠ‚ç‚¹çš„å¯¹åº” å­èŠ‚ç‚¹ æŒ‡å‘å¾…æ’å…¥èŠ‚ç‚¹å°±å¯ä»¥äº† if(root == null) &#123; return new TreeNode(val); &#125; if(root.val &gt; val) root.left = insertIntoBST(root.left, val); if(root.val &lt; val) root.right = insertIntoBST(root.right, val); return root; &#125;&#125; è¿­ä»£æ³• 1234567891011121314151617181920212223class Solution &#123; public TreeNode insertIntoBST(TreeNode root, int val) &#123; if(root == null) &#123; return new TreeNode(val); &#125; TreeNode pre = root; TreeNode cur = root; while(cur != null) &#123; pre = cur; if(cur.val &lt; val) &#123; cur = cur.right; &#125; else &#123; cur = cur.left; &#125; &#125; if(pre.val &lt; val) &#123; pre.right = new TreeNode(val); &#125; else &#123; pre.left = new TreeNode(val); &#125; return root; &#125;&#125; 26. 450. åˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„èŠ‚ç‚¹é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root å’Œä¸€ä¸ªå€¼ keyï¼Œåˆ é™¤äºŒå‰æœç´¢æ ‘ä¸­çš„ key å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶ä¿è¯äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ä¸å˜ã€‚è¿”å›žäºŒå‰æœç´¢æ ‘ï¼ˆæœ‰å¯èƒ½è¢«æ›´æ–°ï¼‰çš„æ ¹èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤èŠ‚ç‚¹å¯åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š é¦–å…ˆæ‰¾åˆ°éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ï¼›å¦‚æžœæ‰¾åˆ°äº†ï¼Œåˆ é™¤å®ƒã€‚ ç¤ºä¾‹1ï¼š 12345è¾“å…¥ï¼šroot = [5,3,6,2,4,null,7], key = 3è¾“å‡ºï¼š[5,4,6,2,null,null,7]è§£é‡Šï¼šç»™å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹å€¼æ˜¯ 3ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆæ‰¾åˆ° 3 è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åŽåˆ é™¤å®ƒã€‚ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆæ˜¯ [5,4,6,2,null,null,7], å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å¦ä¸€ä¸ªæ­£ç¡®ç­”æ¡ˆæ˜¯ [5,2,6,null,4,null,7]ã€‚ ç¤ºä¾‹2ï¼š 123è¾“å…¥: root = [5,3,6,2,4,null,7], key = 0è¾“å‡º: [5,3,6,2,4,null,7]è§£é‡Š: äºŒå‰æ ‘ä¸åŒ…å«å€¼ä¸º 0 çš„èŠ‚ç‚¹ ç¤ºä¾‹3ï¼š 12è¾“å…¥: root = [], key = 0è¾“å‡º: [] æç¤º: èŠ‚ç‚¹æ•°çš„èŒƒå›´ [0, 104]. -105 &lt;= Node.val &lt;= 105 èŠ‚ç‚¹å€¼å”¯ä¸€ root æ˜¯åˆæ³•çš„äºŒå‰æœç´¢æ ‘ -105 &lt;= key &lt;= 105 ä»£ç  é€’å½’æ³• 12345678910111213141516171819202122232425262728293031323334class Solution &#123; public TreeNode deleteNode(TreeNode root, int key) &#123; if(root == null) return null; if(root.val == key) &#123; if(root.left == null &amp;&amp; root.right == null) &#123; return null; &#125; else if(root.left == null) &#123; TreeNode target = root.right; // gc åžƒåœ¾ å›žæ”¶ root.right = null; return target; &#125; else if(root.right == null) &#123; TreeNode target = root.left; // gc åžƒåœ¾ å›žæ”¶ root.left = null; return target; &#125; else &#123; TreeNode cur = root.right; TreeNode target = cur; while(cur.left != null) &#123; cur = cur.left; &#125; cur.left = root.left; // gc å›žæ”¶ root.left = null; root.right = null; return target; &#125; &#125; if(root.val &gt; key) root.left = deleteNode(root.left, key); if(root.val &lt; key) root.right = deleteNode(root.right, key); return root; &#125;&#125; å°æ€»ç»“æ¶‰åŠåˆ°äºŒå‰æœç´¢æ ‘å¢žåŠ å’Œåˆ é™¤èŠ‚ç‚¹æ“ä½œçš„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é€’å½’æ¨¡æ¿ 12345678910111213141516class Solution &#123; public TreeNode recursion(TreeNode root, int key) &#123; // æŸ¥æ‰¾åˆ° å…·ä½“ä½ç½®ï¼Œä½†ä¸ºç©º if(root == null) &#123; /*å…·ä½“æ“ä½œ*/ return /**/; &#125; // æ‰¾åˆ° å…·ä½“ å…ƒç´ ä½ç½® if(root.val == key) &#123; &#125; root.left = recursion(root.left, key); root.right = recursion(root.right, key); return root; &#125;&#125; 669. ä¿®å‰ªäºŒå‰æœç´¢æ ‘é—®é¢˜ç»™ä½ äºŒå‰æœç´¢æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼ŒåŒæ—¶ç»™å®šæœ€å°è¾¹ç•Œlow å’Œæœ€å¤§è¾¹ç•Œ highã€‚é€šè¿‡ä¿®å‰ªäºŒå‰æœç´¢æ ‘ï¼Œä½¿å¾—æ‰€æœ‰èŠ‚ç‚¹çš„å€¼åœ¨[low, high]ä¸­ã€‚ä¿®å‰ªæ ‘ ä¸åº”è¯¥ æ”¹å˜ä¿ç•™åœ¨æ ‘ä¸­çš„å…ƒç´ çš„ç›¸å¯¹ç»“æž„ (å³ï¼Œå¦‚æžœæ²¡æœ‰è¢«ç§»é™¤ï¼ŒåŽŸæœ‰çš„çˆ¶ä»£å­ä»£å…³ç³»éƒ½åº”å½“ä¿ç•™)ã€‚ å¯ä»¥è¯æ˜Žï¼Œå­˜åœ¨ å”¯ä¸€çš„ç­”æ¡ˆ ã€‚ æ‰€ä»¥ç»“æžœåº”å½“è¿”å›žä¿®å‰ªå¥½çš„äºŒå‰æœç´¢æ ‘çš„æ–°çš„æ ¹èŠ‚ç‚¹ã€‚æ³¨æ„ï¼Œæ ¹èŠ‚ç‚¹å¯èƒ½ä¼šæ ¹æ®ç»™å®šçš„è¾¹ç•Œå‘ç”Ÿæ”¹å˜ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šroot = [1,0,2], low = 1, high = 2è¾“å‡ºï¼š[1,null,2] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [3,0,4,null,2,null,null,1], low = 1, high = 3è¾“å‡ºï¼š[3,2,null,1] æç¤ºï¼š æ ‘ä¸­èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ [1, 104] å†…0 &lt;= Node.val &lt;= 104æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½æ˜¯ å”¯ä¸€ çš„é¢˜ç›®æ•°æ®ä¿è¯è¾“å…¥æ˜¯ä¸€æ£µæœ‰æ•ˆçš„äºŒå‰æœç´¢æ ‘0 &lt;= low &lt;= high &lt;= 104 ä»£ç  é€’å½’æ³• å› ä¸ºæ¶‰åŠåˆ°èŠ‚ç‚¹åˆ é™¤ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨ä¹‹å‰é‚£ä¸€å¥—æ¨¡æ¿ 12345678910111213141516class Solution &#123; public TreeNode trimBST(TreeNode root, int low, int high) &#123; if(root == null) &#123; return null; &#125; if(root.val &lt; low) &#123; return trimBST(root.right, low, high); &#125; if(root.val &gt; high) &#123; return trimBST(root.left, low, high); &#125; root.left = trimBST(root.left, low, high); root.right = trimBST(root.right, low, high); return root; &#125;&#125; è¿­ä»£æ³• 12345678910111213141516171819202122232425262728293031323334class Solution &#123; public TreeNode trimBST(TreeNode root, int low, int high) &#123; if(root == null) &#123; return null; &#125; // éåŽ†äºŒå‰æœç´¢æ ‘æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ å¤„åœ¨ åŒºé—´low - high // è¿™ä¸€æ­¥ä¹Ÿæ˜¯åœ¨åš ä¿®å‡ while(root != null &amp;&amp; (root.val &lt; low || root.val &gt; high)) &#123; if(root.val &lt; low) root = root.right; if(root.val &gt; high) root = root.left; &#125; TreeNode cur = root; // è¿™æ ·ï¼Œå·¦è¾¹çš„èŠ‚ç‚¹å€¼ä¸å¯èƒ½å¤§äºŽ highï¼Œåªè¦ä¿®å‡ å°äºŽ low while(cur != null) &#123; while(cur.left != null &amp;&amp; cur.left.val &lt; low) &#123; // å·¦å­æ ‘root èŠ‚ç‚¹å€¼å°ï¼Œåˆ é™¤ å·¦å­æ ‘ä¸­çš„ å·¦å­æ ‘ cur.left = cur.left.right; &#125; // éåŽ†æ¯” è¢«ä¿®å‡çš„èŠ‚ç‚¹å€¼æ›´å¤§çš„ èŠ‚ç‚¹ cur = cur.left; &#125; cur = root; // å³è¾¹çš„ èŠ‚ç‚¹å€¼ ä¸å¯èƒ½ å°äºŽ lowï¼Œåªè¦ä¿®å‡ å¤§äºŽ high while(cur != null) &#123; while(cur.right != null &amp;&amp; cur.right.val &gt; high) &#123; // å³å­æ ‘root èŠ‚ç‚¹å€¼å¤§ï¼Œåˆ é™¤ å³å­æ ‘ä¸­çš„ å³å­æ ‘ cur.right = cur.right.left; &#125; // éåŽ†æ¯” è¢«ä¿®å‡çš„èŠ‚ç‚¹å€¼æ›´å°çš„ èŠ‚ç‚¹ cur = cur.right; &#125; return root; &#125;&#125; 108. å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘é—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œå…¶ä¸­å…ƒç´ å·²ç»æŒ‰ å‡åº æŽ’åˆ—ï¼Œè¯·ä½ å°†å…¶è½¬æ¢ä¸ºä¸€æ£µ é«˜åº¦å¹³è¡¡ äºŒå‰æœç´¢æ ‘ã€‚ é«˜åº¦å¹³è¡¡ äºŒå‰æ ‘æ˜¯ä¸€æ£µæ»¡è¶³ã€Œæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³ä¸¤ä¸ªå­æ ‘çš„é«˜åº¦å·®çš„ç»å¯¹å€¼ä¸è¶…è¿‡ 1 ã€çš„äºŒå‰æ ‘ã€‚ ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šnums = [-10,-3,0,5,9]è¾“å‡ºï¼š[0,-3,9,-10,null,5]è§£é‡Šï¼š[0,-10,5,null,-3,null,9] ä¹Ÿå°†è¢«è§†ä¸ºæ­£ç¡®ç­”æ¡ˆ ç¤ºä¾‹2ï¼š 123è¾“å…¥ï¼šnums = [1,3]è¾“å‡ºï¼š[3,1]è§£é‡Šï¼š[1,null,3] å’Œ [3,1] éƒ½æ˜¯é«˜åº¦å¹³è¡¡äºŒå‰æœç´¢æ ‘ã€‚ æç¤ºï¼š 1 &lt;= nums.length &lt;= 104 -104 &lt;= nums[i] &lt;= 104 nums æŒ‰ ä¸¥æ ¼é€’å¢ž é¡ºåºæŽ’åˆ— ä»£ç  é€’å½’æ³• 1234567891011121314151617class Solution &#123; public TreeNode sortedArrayToBST(int[] nums) &#123; return recursion(nums, 0, nums.length); &#125; // å®šä¹‰ ä¸ºå·¦é—­å³å¼€çš„åŒºé—´ private TreeNode recursion(int[] nums, int left, int right) &#123; // å·²ç»å–ä¸åˆ°å€¼äº† if(left == right) &#123; return null; &#125; int rootIndex = left + (right - left) / 2; TreeNode root = new TreeNode(nums[rootIndex]); root.left = recursion(nums, left, rootIndex); root.right = recursion(nums, rootIndex + 1, right); return root; &#125;&#125; è¿­ä»£æ³• 12345678910111213141516171819202122232425262728293031323334353637class Solution &#123; public TreeNode sortedArrayToBST(int[] nums) &#123; if(nums.length == 0) &#123; return null; &#125; Queue&lt;TreeNode&gt; nodeQueue = new LinkedList&lt;&gt;(); Queue&lt;Integer&gt; leftQueue = new LinkedList&lt;&gt;(); Queue&lt;Integer&gt; rightQueue = new LinkedList&lt;&gt;(); TreeNode root = new TreeNode(0); nodeQueue.offer(root); leftQueue.offer(0); rightQueue.offer(nums.length); while(!nodeQueue.isEmpty()) &#123; TreeNode curNode = nodeQueue.poll(); int left = leftQueue.poll(); int right = rightQueue.poll(); int mid = left + (right - left) / 2; // å¤„ç†æ¯ä¸ªå…ƒç´  curNode.val = nums[mid]; // å·¦é—­å³å¼€ åŒºé—´ ä»»ç”±å…ƒç´  if(left &lt; mid) &#123; curNode.left = new TreeNode(0); nodeQueue.offer(curNode.left); leftQueue.offer(left); rightQueue.offer(mid); &#125; // å·¦é—­å³å¼€ åŒºé—´ ä»æœ‰å…ƒç´  if(right &gt; mid + 1) &#123; curNode.right = new TreeNode(0); nodeQueue.offer(curNode.right); leftQueue.offer(mid + 1); rightQueue.offer(right); &#125; &#125; return root; &#125;&#125; 538. æŠŠäºŒå‰æœç´¢æ ‘è½¬æ¢ä¸ºç´¯åŠ æ ‘é—®é¢˜ç»™å‡ºäºŒå‰ æœç´¢ æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œè¯¥æ ‘çš„èŠ‚ç‚¹å€¼å„ä¸ç›¸åŒï¼Œè¯·ä½ å°†å…¶è½¬æ¢ä¸ºç´¯åŠ æ ‘ï¼ˆGreater Sum Treeï¼‰ï¼Œä½¿æ¯ä¸ªèŠ‚ç‚¹ node çš„æ–°å€¼ç­‰äºŽåŽŸæ ‘ä¸­å¤§äºŽæˆ–ç­‰äºŽ node.val çš„å€¼ä¹‹å’Œã€‚ æé†’ä¸€ä¸‹ï¼ŒäºŒå‰æœç´¢æ ‘æ»¡è¶³ä¸‹åˆ—çº¦æŸæ¡ä»¶ï¼š èŠ‚ç‚¹çš„å·¦å­æ ‘ä»…åŒ…å«é”® å°äºŽ èŠ‚ç‚¹é”®çš„èŠ‚ç‚¹ã€‚ èŠ‚ç‚¹çš„å³å­æ ‘ä»…åŒ…å«é”® å¤§äºŽ èŠ‚ç‚¹é”®çš„èŠ‚ç‚¹ã€‚ å·¦å³å­æ ‘ä¹Ÿå¿…é¡»æ˜¯äºŒå‰æœç´¢æ ‘ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼š[4,1,6,0,2,5,7,null,null,null,3,null,null,null,8]è¾“å‡ºï¼š[30,36,21,36,35,26,15,null,null,null,33,null,null,null,8] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šroot = [0,null,1]è¾“å‡ºï¼š[1,null,1] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šroot = [1,0,2]è¾“å‡ºï¼š[3,3,2] ç¤ºä¾‹4ï¼š 12è¾“å…¥ï¼šroot = [3,2,4,1]è¾“å‡ºï¼š[7,9,4,10] æç¤ºï¼š æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ä»‹äºŽ 0 å’Œ 104 ä¹‹é—´ã€‚ æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ä»‹äºŽ -104 å’Œ 104 ä¹‹é—´ã€‚ æ ‘ä¸­çš„æ‰€æœ‰å€¼ äº’ä¸ç›¸åŒ ã€‚ ç»™å®šçš„æ ‘ä¸ºäºŒå‰æœç´¢æ ‘ã€‚ ä»£ç  é€’å½’æ³• å…¶å®žå°±æ˜¯åä¸­åºéåŽ†ï¼Œæ›´é€šä¿—å°±æ˜¯ä»Žå¤§åˆ°å°éåŽ† 12345678910111213141516class Solution &#123; private int sumWeight = 0; public TreeNode convertBST(TreeNode root) &#123; if(root == null) &#123; return null; &#125; recursion(root); return root; &#125; private void recursion(TreeNode node) &#123; if(node.right != null) recursion(node.right); sumWeight += node.val; node.val = sumWeight; if(node.left != null) recursion(node.left); &#125;&#125; è¿­ä»£æ³• 1234567891011121314151617181920212223242526class Solution &#123; private int sumWeight = 0; public TreeNode convertBST(TreeNode root) &#123; if(root == null) &#123; return null; &#125; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); while(!stack.empty()) &#123; TreeNode node = stack.peek(); if(node != null) &#123; stack.pop(); if(node.left != null) stack.push(node.left); stack.push(node); stack.push(null); if(node.right != null) stack.push(node.right); &#125; else &#123; stack.pop(); node = stack.pop(); sumWeight += node.val; node.val = sumWeight; &#125; &#125; return root; &#125;&#125; äºŒå‰æ ‘æ€»ç»“äºŒå‰æ ‘éåŽ†æ–¹å¼ï¼šå‰åºéåŽ†ã€ä¸­åºéåŽ†ã€åŽåºéåŽ†ã€å±‚æ¬¡éåŽ† äºŒå‰æ ‘éåŽ†ç®—æ³•ï¼šå›žæº¯ã€å•é˜Ÿåˆ—ã€å¤šé˜Ÿåˆ—ã€å•æ ˆã€å¤šæ ˆ äºŒå‰æ ‘åˆ†ç±»ï¼šæ™®é€šäºŒå‰æ ‘ã€å®Œå…¨äºŒå‰æ ‘ã€äºŒå‰æœç´¢æ ‘ã€äºŒå‰å¹³è¡¡æœç´¢æ ‘ã€æœ€å¤§æ ‘ã€æœ€å°æ ‘ æ€§è´¨ï¼š æ™®é€šäºŒå‰æ ‘ï¼šæ™®é€šéåŽ†æ–¹å¼ å®Œå…¨äºŒå‰æ ‘ï¼šå±‚æ¬¡éåŽ† + é˜Ÿåˆ— äºŒå‰æœç´¢æ ‘ï¼šä¸­åºéåŽ† + é€’å½’ï¼Œä¸­åºéåŽ† + è¿­ä»£ï¼Œæ·»åŠ èŠ‚ç‚¹ï¼Œä¿®æ”¹èŠ‚ç‚¹ äºŒå‰å¹³è¡¡æœç´¢æ ‘ï¼šæœ‰åºæ•°ç»„ + é€’å½’ æž„é€ å¹³è¡¡æœç´¢æ ‘ æœ€å¤§æ ‘ï¼šç¬¬ n ä¸ª æœ€å¤§å€¼ æœ€å°æ ‘ï¼šç¬¬ n ä¸ª æœ€å°å€¼","categories":[{"name":"leetCodeç®—æ³•","slug":"leetCodeç®—æ³•","permalink":"http://fyupeng.github.io/categories/leetCode%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"http://fyupeng.github.io/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"}],"author":"fyupeng"},{"title":"å›žæº¯","slug":"å›žæº¯","date":"2022-06-25T06:45:06.000Z","updated":"2022-06-25T06:55:47.792Z","comments":true,"path":"2022/06/25/å›žæº¯/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/%E5%9B%9E%E6%BA%AF/","excerpt":"","text":"1. 22. æ‹¬å·ç”Ÿæˆé—®é¢˜æ•°å­— n ä»£è¡¨ç”Ÿæˆæ‹¬å·çš„å¯¹æ•°ï¼Œè¯·ä½ è®¾è®¡ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºŽèƒ½å¤Ÿç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¹¶ä¸” æœ‰æ•ˆçš„ æ‹¬å·ç»„åˆã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šn = 3è¾“å‡ºï¼š[&quot;((()))&quot;,&quot;(()())&quot;,&quot;(())()&quot;,&quot;()(())&quot;,&quot;()()()&quot;] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šn = 1è¾“å‡ºï¼š[&quot;()&quot;] æç¤ºï¼š 1 &lt;= n &lt;= 8 ä»£ç 12345678910111213141516171819202122class Solution &#123; public List&lt;String&gt; generateParenthesis(int n) &#123; List&lt;String&gt; result = new ArrayList&lt;&gt;(); backtracking(n, result, 0, 0, &quot;&quot;); return result; &#125; private static void backtracking(int n, List&lt;String&gt; result, int left, int right, String str) &#123; if(right &gt; left) &#123; return; &#125; if(left == right &amp;&amp; right == n) &#123; result.add(str); return; &#125; if(left &lt; n) &#123; backtracking(n, result, left + 1, right, str + &quot;(&quot;); &#125; if(right &lt; left) &#123; backtracking(n, result, left, right + 1, str + &quot;)&quot;); &#125; &#125;&#125; 2. 77. ç»„åˆé—®é¢˜ç»™å®šä¸¤ä¸ªæ•´æ•° n å’Œ kï¼Œè¿”å›žèŒƒå›´ [1, n] ä¸­æ‰€æœ‰å¯èƒ½çš„ k ä¸ªæ•°çš„ç»„åˆã€‚ ä½ å¯ä»¥æŒ‰ ä»»ä½•é¡ºåº è¿”å›žç­”æ¡ˆã€‚ ç¤ºä¾‹1ï¼š 12345678910è¾“å…¥ï¼šn = 4, k = 2è¾“å‡ºï¼š[ [2,4], [3,4], [2,3], [1,2], [1,3], [1,4],] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šn = 1, k = 1è¾“å‡ºï¼š[[1]] æç¤ºï¼š 1 &lt;= n &lt;= 20 1 &lt;= k &lt;= n ä»£ç 12345678910111213141516171819202122class Solution &#123; private List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;(); private List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; combine(int n, int k) &#123; backtracking(n, k, 1); return result; &#125; private void backtracking(int n, int k, int startIndex) &#123; // ç»ˆæ­¢æ¡ä»¶ if(path.size() == k) &#123; result.add(new ArrayList&lt;&gt;(path)); return; &#125; for(int i = startIndex; i &lt;= n; i++) &#123; path.add(i); backtracking(n, k, i + 1); // éåŽ† ä¸‹ä¸€ä¸ª çºµå‘ å…ƒç´  path.remove(path.size() - 1); // éåŽ†ä¸‹ä¸€ä¸ª æ¨ªå‘ å…ƒç´ (è¨€å¤–ä¹‹æ„å°±æ˜¯çºµå‘å…ƒç´ å·²ç»éåŽ†å®Œå›žæº¯äº†ï¼Œéœ€è¦ç§»é™¤) &#125; &#125;&#125; å‰ªæžä¼˜åŒ–æœç´¢èµ·ç‚¹çš„ä¸Šç•Œ + æŽ¥ä¸‹æ¥è¦é€‰æ‹©çš„å…ƒç´ ä¸ªæ•° - 1 = nå…¶ä¸­ï¼ŒæŽ¥ä¸‹æ¥è¦é€‰æ‹©çš„å…ƒç´ ä¸ªæ•° = k - path.size()ï¼Œæ•´ç†å¾—åˆ°ï¼š æœç´¢èµ·ç‚¹çš„ä¸Šç•Œ = n - (k - path.size()) + 1æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„å‰ªæžè¿‡ç¨‹å°±æ˜¯ï¼šæŠŠ i &lt;= n æ”¹æˆ i &lt;= n - (k - path.size()) + 1 ï¼š 12345for(int i = startIndex; i &lt;= n - (k - path.size()) + 1; i++) &#123; path.add(i); backtracking(n, k, i + 1); // éåŽ† ä¸‹ä¸€ä¸ª çºµå‘ å…ƒç´  path.remove(path.size() - 1); // éåŽ†ä¸‹ä¸€ä¸ª æ¨ªå‘ å…ƒç´  &#125; 3. 216. ç»„åˆæ€»å’Œ IIIé—®é¢˜æ‰¾å‡ºæ‰€æœ‰ç›¸åŠ ä¹‹å’Œä¸º n çš„ k ä¸ªæ•°çš„ç»„åˆï¼Œä¸”æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼š åªä½¿ç”¨æ•°å­—1åˆ°9æ¯ä¸ªæ•°å­— æœ€å¤šä½¿ç”¨ä¸€æ¬¡è¿”å›ž æ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆç»„åˆçš„åˆ—è¡¨ ã€‚è¯¥åˆ—è¡¨ä¸èƒ½åŒ…å«ç›¸åŒçš„ç»„åˆä¸¤æ¬¡ï¼Œç»„åˆå¯ä»¥ä»¥ä»»ä½•é¡ºåºè¿”å›žã€‚ ç¤ºä¾‹1ï¼š 12345è¾“å…¥: k = 3, n = 7è¾“å‡º: [[1,2,4]]è§£é‡Š:1 + 2 + 4 = 7æ²¡æœ‰å…¶ä»–ç¬¦åˆçš„ç»„åˆäº†ã€‚ ç¤ºä¾‹2ï¼š 1234567è¾“å…¥: k = 3, n = 9è¾“å‡º: [[1,2,6], [1,3,5], [2,3,4]]è§£é‡Š:1 + 2 + 6 = 91 + 3 + 5 = 92 + 3 + 4 = 9æ²¡æœ‰å…¶ä»–ç¬¦åˆçš„ç»„åˆäº†ã€‚ ç¤ºä¾‹3ï¼š 1234è¾“å…¥: k = 4, n = 1è¾“å‡º: []è§£é‡Š: ä¸å­˜åœ¨æœ‰æ•ˆçš„ç»„åˆã€‚åœ¨[1,9]èŒƒå›´å†…ä½¿ç”¨4ä¸ªä¸åŒçš„æ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°çš„æœ€å°å’Œæ˜¯1+2+3+4 = 10ï¼Œå› ä¸º10 &gt; 1ï¼Œæ²¡æœ‰æœ‰æ•ˆçš„ç»„åˆã€‚ â€‹ æç¤º: 2 &lt;= k &lt;= 9 1 &lt;= n &lt;= 60 ä»£ç 123456789101112131415161718192021222324class Solution &#123; private List&lt;Integer&gt; path = new ArrayList&lt;&gt;(); private List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;(); public List&lt;List&lt;Integer&gt;&gt; combinationSum3(int k, int n) &#123; backtracking(k, n, 1, 0); return result; &#125; private void backtracking(int k, int n, int startIndex, int sum) &#123; if(path.size() == k) &#123; if(sum == n) &#123; result.add(new ArrayList&lt;&gt;(path)); return; &#125; &#125; for(int i = startIndex; i &lt;= 9; i++) &#123; sum += i; path.add(i); backtracking(k, n, i + 1, sum); sum -= i; path.remove(path.size() - 1); &#125; &#125;&#125; å‰ªæžä¼˜åŒ–ï¼š123456789if(sum &gt; n) &#123; return;&#125;if(path.size() == k) &#123; if(sum == n) &#123; result.add(new ArrayList&lt;&gt;(path)); return; &#125;&#125; 4. 17. ç”µè¯å·ç çš„å­—æ¯ç»„åˆé—®é¢˜ç»™å®šä¸€ä¸ªä»…åŒ…å«æ•°å­— 2-9 çš„å­—ç¬¦ä¸²ï¼Œè¿”å›žæ‰€æœ‰å®ƒèƒ½è¡¨ç¤ºçš„å­—æ¯ç»„åˆã€‚ç­”æ¡ˆå¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›žã€‚ ç»™å‡ºæ•°å­—åˆ°å­—æ¯çš„æ˜ å°„å¦‚ä¸‹ï¼ˆä¸Žç”µè¯æŒ‰é”®ç›¸åŒï¼‰ã€‚æ³¨æ„ 1 ä¸å¯¹åº”ä»»ä½•å­—æ¯ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šdigits = &quot;23&quot;è¾“å‡ºï¼š[&quot;ad&quot;,&quot;ae&quot;,&quot;af&quot;,&quot;bd&quot;,&quot;be&quot;,&quot;bf&quot;,&quot;cd&quot;,&quot;ce&quot;,&quot;cf&quot;] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šdigits = &quot;&quot;è¾“å‡ºï¼š[] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šdigits = &quot;2&quot;è¾“å‡ºï¼š[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;] æç¤ºï¼š 0 &lt;= digits.length &lt;= 4 digits[i] æ˜¯èŒƒå›´ [&#39;2&#39;, &#39;9&#39;] çš„ä¸€ä¸ªæ•°å­—ã€‚ ä»£ç 123456789101112131415161718192021222324252627282930313233343536class Solution &#123; private final String[] letterMap = &#123; &quot;&quot;, // 0 &quot;&quot;, // 1 &quot;abc&quot;, // 2 &quot;def&quot;, // 3 &quot;ghi&quot;, // 4 &quot;jkl&quot;, // 5 &quot;mno&quot;, // 6 &quot;pqrs&quot;, // 7 &quot;tuv&quot;, // 8 &quot;wxyz&quot; // 9 &#125;; private List&lt;String&gt; result = new ArrayList&lt;&gt;(); public List&lt;String&gt; letterCombinations(String digits) &#123; if(&quot;&quot;.equals(digits)) &#123; return result; &#125; backtracking(digits, 0, new StringBuilder()); return result; &#125; private void backtracking(String digits, int index, StringBuilder subString) &#123; if(index == digits.length()) &#123; result.add(subString.toString()); return; &#125; int digit = digits.charAt(index) - &#x27;0&#x27;; String letters = letterMap[digit]; for(int i = 0; i &lt; letters.length(); i++) &#123; subString.append(letters.charAt(i)); backtracking(digits, index + 1, subString); subString.delete(subString.length() - 1, subString.length()); &#125; &#125;&#125; 5. 39. ç»„åˆæ€»å’Œ æ ‘æžå‰ªæžæˆ–forå¾ªçŽ¯å‰ªæžé—®é¢˜ç»™ä½ ä¸€ä¸ª æ— é‡å¤å…ƒç´  çš„æ•´æ•°æ•°ç»„ candidates å’Œä¸€ä¸ªç›®æ ‡æ•´æ•° target ï¼Œæ‰¾å‡º candidates ä¸­å¯ä»¥ä½¿æ•°å­—å’Œä¸ºç›®æ ‡æ•° target çš„ æ‰€æœ‰ ä¸åŒç»„åˆ ï¼Œå¹¶ä»¥åˆ—è¡¨å½¢å¼è¿”å›žã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›žè¿™äº›ç»„åˆã€‚ candidates ä¸­çš„ åŒä¸€ä¸ª æ•°å­—å¯ä»¥ æ— é™åˆ¶é‡å¤è¢«é€‰å– ã€‚å¦‚æžœè‡³å°‘ä¸€ä¸ªæ•°å­—çš„è¢«é€‰æ•°é‡ä¸åŒï¼Œåˆ™ä¸¤ç§ç»„åˆæ˜¯ä¸åŒçš„ã€‚ å¯¹äºŽç»™å®šçš„è¾“å…¥ï¼Œä¿è¯å’Œä¸º target çš„ä¸åŒç»„åˆæ•°å°‘äºŽ 150 ä¸ªã€‚ ç¤ºä¾‹1ï¼š 123456è¾“å…¥ï¼šcandidates = [2,3,6,7], target = 7è¾“å‡ºï¼š[[2,2,3],[7]]è§£é‡Šï¼š2 å’Œ 3 å¯ä»¥å½¢æˆä¸€ç»„å€™é€‰ï¼Œ2 + 2 + 3 = 7 ã€‚æ³¨æ„ 2 å¯ä»¥ä½¿ç”¨å¤šæ¬¡ã€‚7 ä¹Ÿæ˜¯ä¸€ä¸ªå€™é€‰ï¼Œ 7 = 7 ã€‚ä»…æœ‰è¿™ä¸¤ç§ç»„åˆã€‚ ç¤ºä¾‹2ï¼š 12è¾“å…¥: candidates = [2,3,5], target = 8è¾“å‡º: [[2,2,2,2],[2,3,3],[3,5]] ç¤ºä¾‹3ï¼š 12è¾“å…¥: candidates = [2], target = 1è¾“å‡º: [] ä»£ç 12345678910111213141516171819202122232425class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; combinationSum(int[] candidates, int target) &#123; List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;(); Arrays.sort(candiates); backtracking(result, new ArrayList&lt;&gt;(), candidates, target, 0, 0); return result; &#125; private void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int[] candidates, int target, int startIndex, int sum) &#123; if(sum &gt; target) &#123; return; &#125; if(sum == target) &#123; res.add(new ArrayList&lt;&gt;(path)); return; &#125; for(int i = startIndex; i &lt; candidates.length; i++) &#123; sum += candidates[i]; path.add(candidates[i]); backtracking(res, path, candidates, target, i, sum); sum -= candidates[i]; path.remove(path.size() - 1); &#125; &#125;&#125; å‰ªæžä¼˜åŒ–12345678910111213/*if(sum &gt; target) &#123; return;&#125;*/for(int i = startIndex; i &lt; candidates.length &amp;&amp; sum + candidates[i] &lt;= target; i++) &#123; sum += candidates[i]; path.add(candidates[i]); backtracking(res, path, candidates, target, i, sum); sum -= candidates[i]; path.remove(path.size() - 1);&#125; 6. 40. ç»„åˆæ€»å’Œ II æŽ’åºæ ‘å±‚åŽ»é‡é—®é¢˜ç»™å®šä¸€ä¸ªå€™é€‰äººç¼–å·çš„é›†åˆ candidates å’Œä¸€ä¸ªç›®æ ‡æ•° target ï¼Œæ‰¾å‡º candidates ä¸­æ‰€æœ‰å¯ä»¥ä½¿æ•°å­—å’Œä¸º target çš„ç»„åˆã€‚ candidates ä¸­çš„æ¯ä¸ªæ•°å­—åœ¨æ¯ä¸ªç»„åˆä¸­åªèƒ½ä½¿ç”¨ ä¸€æ¬¡ ã€‚ æ³¨æ„ï¼šè§£é›†ä¸èƒ½åŒ…å«é‡å¤çš„ç»„åˆã€‚ ç¤ºä¾‹1ï¼š 12345678è¾“å…¥: candidates = [10,1,2,7,6,1,5], target = 8,è¾“å‡º:[[1,1,6],[1,2,5],[1,7],[2,6]] ç¤ºä¾‹2ï¼š 123456è¾“å…¥: candidates = [2,5,2,1,2], target = 5,è¾“å‡º:[[1,2,2],[5]] ä»£ç 12345678910111213141516171819202122232425262728class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; combinationSum2(int[] candidates, int target) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); Arrays.sort(candidates); backtracking(candidates, target, res, new ArrayList&lt;Integer&gt;(), 0, new boolean[candidates.length], 0); return res; &#125; private void backtracking(int[] candidates, int target, List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int startIndex, boolean[] used, int sum) &#123; if(sum &gt; target) &#123; return; &#125; if(sum == target) &#123; res.add(new ArrayList&lt;&gt;(path)); return; &#125; for(int i = startIndex; i &lt; candidates.length; i++) &#123; if(i &gt; 0 &amp;&amp; candidates[i] == candidates[i - 1] &amp;&amp; used[i - 1] == false) &#123; continue; &#125; path.add(candidates[i]); used[i] = true; backtracking(candidates, target, res, path, i + 1, used, sum + candidates[i]); path.remove(path.size() - 1); used[i] = false; &#125; &#125;&#125; å‰ªæžä¼˜åŒ–12345678/*if(sum &gt; target) &#123; return;&#125;*/for(int i = startIndex; i &lt; candidates.length &amp;&amp; sum + candidates[i] &lt;= target; i++) &#123; &#125; å¦ä¸€ç§ä»£ç ä½¿ç”¨ i &gt; startIndex å·§å¦™ è®¾è®¡ æˆ æ·±åº¦ å¯é‡å¤ æ•°å­—ï¼Œ æ¨ªå‘ ä¸å…è®¸ é‡å¤æ•°å­— 1234567891011121314151617181920212223class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; combinationSum2(int[] candidates, int target) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); Arrays.sort(candidates); backtracking(candidates, target, res, new ArrayList&lt;Integer&gt;(), 0, 0); return res; &#125; private void backtracking(int[] candidates, int target, List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int startIndex, int sum) &#123; if(sum == target) &#123; res.add(new ArrayList&lt;&gt;(path)); return; &#125; for(int i = startIndex; i &lt; candidates.length &amp;&amp; sum + candidates[i] &lt;= target; i++) &#123; if(i &gt; startIndex &amp;&amp; candidates[i] == candidates[i - 1]) &#123; continue; &#125; path.add(candidates[i]); backtracking(candidates, target, res, path, i + 1, sum + candidates[i]); path.remove(path.size() - 1); &#125; &#125;&#125; 7. 131. åˆ†å‰²å›žæ–‡ä¸² åˆ¤æ–­å‰ªæžé—®é¢˜ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œè¯·ä½ å°† s åˆ†å‰²æˆä¸€äº›å­ä¸²ï¼Œä½¿æ¯ä¸ªå­ä¸²éƒ½æ˜¯ å›žæ–‡ä¸² ã€‚è¿”å›ž s æ‰€æœ‰å¯èƒ½çš„åˆ†å‰²æ–¹æ¡ˆã€‚ å›žæ–‡ä¸² æ˜¯æ­£ç€è¯»å’Œåç€è¯»éƒ½ä¸€æ ·çš„å­—ç¬¦ä¸²ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šs = &quot;aab&quot;è¾“å‡ºï¼š[[&quot;a&quot;,&quot;a&quot;,&quot;b&quot;],[&quot;aa&quot;,&quot;b&quot;]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šs = &quot;a&quot;è¾“å‡ºï¼š[[&quot;a&quot;]] æç¤ºï¼š 1 &lt;= s.length &lt;= 16 s ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ ä»£ç 12345678910111213141516171819202122232425262728293031323334class Solution &#123; public List&lt;List&lt;String&gt;&gt; partition(String s) &#123; List&lt;List&lt;String&gt;&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new ArrayList&lt;String&gt;(), s, 0); return res; &#125; private void backtracking(List&lt;List&lt;String&gt;&gt; res, List&lt;String&gt; path, String s, int startIndex) &#123; if(startIndex == s.length()) &#123; res.add(new ArrayList&lt;&gt;(path)); return; &#125; for(int i = startIndex; i &lt; s.length(); i++) &#123; if(isPartition(s, startIndex, i)) &#123; String substring = s.substring(startIndex, i + 1); path.add(substring); &#125; else &#123; continue; &#125; backtracking(res, path, s, i + 1); path.remove(path.size() - 1); &#125; &#125; private boolean isPartition(String s, int start, int end) &#123; for(int i = start,j = end; i &lt; j; i++, j--) &#123; if(s.charAt(i) != s.charAt(j)) &#123; return false; &#125; &#125; return true; &#125;&#125; 8. 93. å¤åŽŸ IP åœ°å€ forå¾ªçŽ¯å’Œåˆ¤æ–­å‰ªæžé—®é¢˜æœ‰æ•ˆ IP åœ°å€ æ­£å¥½ç”±å››ä¸ªæ•´æ•°ï¼ˆæ¯ä¸ªæ•´æ•°ä½äºŽ 0 åˆ° 255 ä¹‹é—´ç»„æˆï¼Œä¸”ä¸èƒ½å«æœ‰å‰å¯¼ 0ï¼‰ï¼Œæ•´æ•°ä¹‹é—´ç”¨ â€˜.â€™ åˆ†éš”ã€‚ ä¾‹å¦‚ï¼šâ€0.1.2.201â€ å’Œ â€œ192.168.1.1â€ æ˜¯ æœ‰æ•ˆ IP åœ°å€ï¼Œä½†æ˜¯ â€œ0.011.255.245â€ã€â€192.168.1.312â€ å’Œ â€œ&#x31;&#x39;&#x32;&#x2e;&#49;&#54;&#x38;&#64;&#x31;&#x2e;&#x31;â€œ æ˜¯ æ— æ•ˆ IP åœ°å€ã€‚ç»™å®šä¸€ä¸ªåªåŒ…å«æ•°å­—çš„å­—ç¬¦ä¸² s ï¼Œç”¨ä»¥è¡¨ç¤ºä¸€ä¸ª IP åœ°å€ï¼Œè¿”å›žæ‰€æœ‰å¯èƒ½çš„æœ‰æ•ˆ IP åœ°å€ï¼Œè¿™äº›åœ°å€å¯ä»¥é€šè¿‡åœ¨ s ä¸­æ’å…¥ â€˜.â€™ æ¥å½¢æˆã€‚ä½  ä¸èƒ½ é‡æ–°æŽ’åºæˆ–åˆ é™¤ s ä¸­çš„ä»»ä½•æ•°å­—ã€‚ä½ å¯ä»¥æŒ‰ ä»»ä½• é¡ºåºè¿”å›žç­”æ¡ˆã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šs = &quot;25525511135&quot;è¾“å‡ºï¼š[&quot;255.255.11.135&quot;,&quot;255.255.111.35&quot;] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šs = &quot;0000&quot;è¾“å‡ºï¼š[&quot;0.0.0.0&quot;] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šs = &quot;101023&quot;è¾“å‡ºï¼š[&quot;1.0.10.23&quot;,&quot;1.0.102.3&quot;,&quot;10.1.0.23&quot;,&quot;10.10.2.3&quot;,&quot;101.0.2.3&quot;] ä»£ç 1234567891011121314151617181920212223242526272829303132class Solution &#123; public List&lt;String&gt; restoreIpAddresses(String s) &#123; List&lt;String&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new StringBuilder(), s, 0, 0); return res; &#125; private void backtracking(List&lt;String&gt; res, StringBuilder substring, String s, int startIndex, int pointCount) &#123; if(startIndex == s.length() &amp;&amp; pointCount == 4) &#123; String withPointString = substring.toString(); res.add(withPointString.substring(0, withPointString.length() - 1)); return; &#125; // ç›´æŽ¥ åœ¨ for å¾ªçŽ¯ å‰ªæž é•¿åº¦ å¤§äºŽ 3 æˆ–è€… ç‚¹æ•° å¤§äºŽç­‰äºŽ 4 ä½çš„ï¼ˆç­‰äºŽ4 ä½ å·²ç»åœ¨ å‰é¢ åˆ¤æ–­äº†ï¼‰ for(int i = startIndex; i &lt; s.length() &amp;&amp; pointCount &lt; 4 &amp;&amp; i - startIndex &lt; 3; i++) &#123; if((i &gt; startIndex &amp;&amp; s.charAt(startIndex) == &#x27;0&#x27;)) &#123; continue; &#125; String str = s.substring(startIndex, i + 1); if(Integer.parseInt(str) &gt;= 0 &amp;&amp; Integer.parseInt(str) &lt;= 255) &#123; substring.append(str).append(&quot;.&quot;); &#125; else &#123; continue; &#125; backtracking(res, substring, s, i + 1, pointCount + 1); substring.deleteCharAt(substring.lastIndexOf(&quot;.&quot;)); substring.delete(substring.lastIndexOf(&quot;.&quot;) + 1, substring.length()); &#125; &#125;&#125; 9. 78. å­é›† ä¸å‰ªæžé—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ•°ç»„ä¸­çš„å…ƒç´  äº’ä¸ç›¸åŒ ã€‚è¿”å›žè¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚ è§£é›† ä¸èƒ½ åŒ…å«é‡å¤çš„å­é›†ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›žè§£é›†ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šnums = [1,2,3]è¾“å‡ºï¼š[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šnums = [0]è¾“å‡ºï¼š[[],[0]] æç¤ºï¼š 1 &lt;= nums.length &lt;= 10 -10 &lt;= nums[i] &lt;= 10 nums ä¸­çš„æ‰€æœ‰å…ƒç´  äº’ä¸ç›¸åŒ ä»£ç 12345678910111213141516171819class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new ArrayList&lt;Integer&gt;(), nums, 0); return res; &#125; private void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path ,int[] nums, int startIndex) &#123; res.add(new ArrayList&lt;&gt;(path)); if(startIndex == nums.length) &#123; return; &#125; for(int i = startIndex; i &lt; nums.length; i++) &#123; path.add(nums[i]); backtracking(res, path, nums, i + 1); path.remove(path.size() - 1); &#125; &#125;&#125; æ¨¡æ¿1234result.push_back(path); // æ”¶é›†å­é›†ï¼Œè¦æ”¾åœ¨ç»ˆæ­¢æ·»åŠ çš„ä¸Šé¢ï¼Œå¦åˆ™ä¼šæ¼æŽ‰è‡ªå·±if (startIndex &gt;= nums.size()) &#123; // ç»ˆæ­¢æ¡ä»¶å¯ä»¥ä¸åŠ  return;&#125; 10. 90. å­é›† II æŽ’åºæ ‘å±‚åŽ»é‡é—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«é‡å¤å…ƒç´ ï¼Œè¯·ä½ è¿”å›žè¯¥æ•°ç»„æ‰€æœ‰å¯èƒ½çš„å­é›†ï¼ˆå¹‚é›†ï¼‰ã€‚ è§£é›† ä¸èƒ½ åŒ…å«é‡å¤çš„å­é›†ã€‚è¿”å›žçš„è§£é›†ä¸­ï¼Œå­é›†å¯ä»¥æŒ‰ ä»»æ„é¡ºåº æŽ’åˆ—ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šnums = [1,2,2]è¾“å‡ºï¼š[[],[1],[1,2],[1,2,2],[2],[2,2]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šnums = [0]è¾“å‡ºï¼š[[],[0]] æç¤º 1 &lt;= nums.length &lt;= 10 -10 &lt;= nums[i] &lt;= 10 ä»£ç 123456789101112131415161718192021222324class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; subsetsWithDup(int[] nums) &#123; Arrays.sort(nums); List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new ArrayList&lt;Integer&gt;(), nums, 0); return res; &#125; private void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int[] nums, int startIndex) &#123; res.add(new ArrayList&lt;&gt;(path)); if(startIndex == nums.length) &#123; return; &#125; for(int i = startIndex; i &lt; nums.length; i++) &#123; // åŽ»é‡ æ¡ä»¶ åªå¯¹ å¹¿åº¦ æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯ å¯¹ä¸åŒ å­é›†åŽ»é‡ if(i &gt; startIndex &amp;&amp; nums[i] == nums[i - 1]) &#123; continue; &#125; path.add(nums[i]); backtracking(res, path, nums, i + 1); path.remove(path.size() - 1); &#125; &#125;&#125; 11. 491. é€’å¢žå­åºåˆ— éžæŽ’åºæ ‘å±‚åŽ»é‡é—®é¢˜ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œæ‰¾å‡ºå¹¶è¿”å›žæ‰€æœ‰è¯¥æ•°ç»„ä¸­ä¸åŒçš„é€’å¢žå­åºåˆ—ï¼Œé€’å¢žå­åºåˆ—ä¸­ è‡³å°‘æœ‰ä¸¤ä¸ªå…ƒç´  ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›žç­”æ¡ˆã€‚ æ•°ç»„ä¸­å¯èƒ½å«æœ‰é‡å¤å…ƒç´ ï¼Œå¦‚å‡ºçŽ°ä¸¤ä¸ªæ•´æ•°ç›¸ç­‰ï¼Œä¹Ÿå¯ä»¥è§†ä½œé€’å¢žåºåˆ—çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šnums = [4,6,7,7]è¾“å‡ºï¼š[[4,6],[4,6,7],[4,6,7,7],[4,7],[4,7,7],[6,7],[6,7,7],[7,7]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šnums = [4,4,3,2,1]è¾“å‡ºï¼š[[4,4]] æç¤º 1 &lt;= nums.length &lt;= 15 -100 &lt;= nums[i] &lt;= 100 ä»£ç 1234567891011121314151617181920212223242526class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; findSubsequences(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new ArrayList&lt;Integer&gt;(), nums, 0); return res; &#125; private void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int[] nums, int startIndex) &#123; if (path.size() &gt; 1) &#123; res.add(new ArrayList&lt;&gt;(path)); // æ³¨æ„è¿™é‡Œä¸è¦åŠ returnï¼Œè¦å–æ ‘ä¸Šæ‰€æœ‰çš„èŠ‚ç‚¹ &#125; // ç”Ÿå‘½å‘¨æœŸ å­˜æ´»åœ¨ é€’å½’å‡½æ•°ä¸­ï¼Œæ‰€ä»¥å¯¹ åŒä¸€å±‚æœ‰æ•ˆ Set&lt;Integer&gt; uset = new HashSet&lt;&gt;(); for(int i = startIndex; i &lt; nums.length; i++) &#123; // å½“ path æœ‰å€¼ æ—¶ï¼Œåˆ¤æ–­ å½“å‰ i æ‰€åœ¨ä¸‹æ ‡çš„ å€¼ æ˜¯å¦ å°äºŽ path æœ‰åºåˆ—è¡¨æœ€åŽ ä¸€ä¸ªå…ƒç´  æˆ–è€… åŒä¸€å±‚å‡ºçŽ° é‡å¤å…ƒç´  if(path.size() &gt; 0 &amp;&amp; nums[i] &lt; path.get(path.size() - 1) || !uset.add(nums[i])) &#123; continue; &#125; //uset.add(nums[i]); path.add(nums[i]); backtracking(res, path, nums, i + 1); path.remove(path.size() - 1); &#125; &#125;&#125; 12. 46. å…¨æŽ’åˆ— æ ‘æžåŽ»é‡é—®é¢˜ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ nums ï¼Œè¿”å›žå…¶ æ‰€æœ‰å¯èƒ½çš„å…¨æŽ’åˆ— ã€‚ä½ å¯ä»¥ æŒ‰ä»»æ„é¡ºåº è¿”å›žç­”æ¡ˆã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šnums = [1,2,3]è¾“å‡ºï¼š[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šnums = [0,1]è¾“å‡ºï¼š[[0,1],[1,0]] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šnums = [1]è¾“å‡ºï¼š[[1]] æç¤ºï¼š 1 &lt;= nums.length &lt;= 6 -10 &lt;= nums[i] &lt;= 10 nums ä¸­çš„æ‰€æœ‰æ•´æ•° äº’ä¸ç›¸åŒ ä»£ç 123456789101112131415161718192021222324class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; permute(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new ArrayList&lt;Integer&gt;(), nums, new boolean[nums.length]); return res; &#125; private void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int[] nums, boolean[] used) &#123; // å…¨æŽ’åˆ—ï¼Œæ¯ä¸ªå…ƒç´ åªèƒ½ç”¨ä¸€æ¬¡å¹¶ä¸”å…¨éƒ¨è¦ç”¨åˆ° if(path.size() == nums.length) &#123; res.add(new ArrayList&lt;&gt;(path)); return; &#125; for(int i = 0; i &lt; nums.length; i++) &#123; // é€’å½’ï¼ˆçºµå‘éåŽ†ï¼‰ä¸èƒ½å‡ºçŽ°é‡å¤ï¼Œä¸€ä¸ªå…ƒç´ åªèƒ½ç”¨ä¸€æ¬¡ if(used[i]) continue; path.add(nums[i]); used[i] = true; backtracking(res, path, nums, used); path.remove(path.size() - 1); used[i] = false; &#125; &#125;&#125; 13. 47. å…¨æŽ’åˆ— II æ ‘æžå’Œæ ‘å±‚åŽ»é‡é—®é¢˜ç»™å®šä¸€ä¸ªå¯åŒ…å«é‡å¤æ•°å­—çš„åºåˆ— nums ï¼ŒæŒ‰ä»»æ„é¡ºåº è¿”å›žæ‰€æœ‰ä¸é‡å¤çš„å…¨æŽ’åˆ—ã€‚ ç¤ºä¾‹1ï¼š 12345è¾“å…¥ï¼šnums = [1,1,2]è¾“å‡ºï¼š[[1,1,2], [1,2,1], [2,1,1]] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šnums = [1,2,3]è¾“å‡ºï¼š[[1,2,3],[1,3,2],[2,1,3],[2,3,1],[3,1,2],[3,2,1]] æç¤ºï¼š 1 &lt;= nums.length &lt;= 8 -10 &lt;= nums[i] &lt;= 10 ä»£ç 1234567891011121314151617181920212223242526class Solution &#123; public List&lt;List&lt;Integer&gt;&gt; permuteUnique(int[] nums) &#123; List&lt;List&lt;Integer&gt;&gt; res = new ArrayList&lt;&gt;(); backtracking(res, new ArrayList&lt;Integer&gt;(), nums, new boolean[nums.length]); return res; &#125; private void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; path, int[] nums, boolean[] used) &#123; if(path.size() == nums.length) &#123; res.add(new ArrayList&lt;&gt;(path)); return; &#125; Set&lt;Integer&gt; uset = new HashSet&lt;&gt;(); for(int i = 0; i &lt; nums.length; i++) &#123; // çºµå‘ éåŽ† åŒä¸€ä¸ªä¸‹æ ‡å…ƒç´  é‡å¤ï¼Œè·³è¿‡ // å¦åˆ™ æ¨ªå‘ éåŽ† åˆ° é‡å¤å…ƒç´ (ä¸åŒä¸‹æ ‡)ï¼Œè·³è¿‡ if(used[i] || !uset.add(nums[i])) continue; path.add(nums[i]); used[i] = true; backtracking(res, path, nums, used); path.remove(path.size() - 1); used[i] = false; &#125; &#125;&#125; 14. 404. å·¦å¶å­ä¹‹å’Œé—®é¢˜ç»™å®šäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ root ï¼Œè¿”å›žæ‰€æœ‰å·¦å¶å­ä¹‹å’Œã€‚ ç¤ºä¾‹1ï¼š 123è¾“å…¥: root = [3,9,20,null,null,15,7] è¾“å‡º: 24 è§£é‡Š: åœ¨è¿™ä¸ªäºŒå‰æ ‘ä¸­ï¼Œæœ‰ä¸¤ä¸ªå·¦å¶å­ï¼Œåˆ†åˆ«æ˜¯ 9 å’Œ 15ï¼Œæ‰€ä»¥è¿”å›ž 24 ç¤ºä¾‹2ï¼š 12è¾“å…¥: root = [1]è¾“å‡º: 0 æç¤º: èŠ‚ç‚¹æ•°åœ¨ [1, 1000] èŒƒå›´å†… -1000 &lt;= Node.val &lt;= 1000 ä»£ç  åŽåºéåŽ†é€’å½’æ³• 1234567891011121314151617181920// åŽåºéåŽ†é€’å½’class Solution &#123; public int sumOfLeftLeaves(TreeNode root) &#123; if(root == null) &#123; return 0; &#125; return sumRecurision(root); &#125; private int sumRecurision(TreeNode node) &#123; // ç»ˆæ­¢æ¡ä»¶ï¼Œå¶å­èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ if(node == null || node.left == null &amp;&amp; node.right == null) return 0; int sumLeft = sumRecurision(node.left); int sumRight = sumRecurision(node.right); // å­˜åœ¨èŠ‚ç‚¹ çš„å·¦å¶å­èŠ‚ç‚¹ if(node.left != null &amp;&amp; node.left.left == null &amp;&amp; node.left.right == null) &#123; return node.left.val + sumLeft + sumRight; &#125; return sumLeft + sumRight; &#125;&#125; å‰åºè¿­ä»£æ³• 12345678910111213141516171819class Solution &#123; public int sumOfLeftLeaves(TreeNode root) &#123; if(root == null) &#123; return 0; &#125; Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;(); stack.push(root); int sum = 0; while(!stack.empty()) &#123; TreeNode node = stack.pop(); if(node.left != null &amp;&amp; node.left.left == null &amp;&amp; node.left.right == null) &#123; sum += node.left.val; &#125; if(node.left != null) stack.push(node.left); if(node.right != null) stack.push(node.right); &#125; return sum; &#125;&#125; 15. 513. æ‰¾æ ‘å·¦ä¸‹è§’çš„å€¼é—®é¢˜ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„ æ ¹èŠ‚ç‚¹ rootï¼Œè¯·æ‰¾å‡ºè¯¥äºŒå‰æ ‘çš„ æœ€åº•å±‚ æœ€å·¦è¾¹ èŠ‚ç‚¹çš„å€¼ã€‚ å‡è®¾äºŒå‰æ ‘ä¸­è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥: root = [2,1,3]è¾“å‡º: 1 ç¤ºä¾‹2ï¼š 12è¾“å…¥: [1,2,3,4,null,5,6,null,null,7]è¾“å‡º: 7 æç¤º: äºŒå‰æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°çš„èŒƒå›´æ˜¯ [1,104] -231 &lt;= Node.val &lt;= 231 - 1 ä»£ç  ç±»å±‚åºéåŽ†è¿­ä»£æ³• 1234567891011121314151617class Solution &#123; public int findBottomLeftValue(TreeNode root) &#123; Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;(); queue.offer(root); TreeNode res = root; while(!queue.isEmpty()) &#123; TreeNode node = queue.poll(); if(node == null) &#123; continue; &#125; res = node; queue.offer(node.right); queue.offer(node.left); &#125; return res.val; &#125;&#125; å‰åºéåŽ†é€’å½’æ³• 123456789101112131415161718192021class Solution &#123; TreeNode res = null; int max = 0; public int findBottomLeftValue(TreeNode root) &#123; res = root; // å› ä¸º è¿™é‡Œå·²ç»è¯´äº†,æ ¹èŠ‚ç‚¹ ä¸ä¸ºç©ºäº† reversivion(root, 1); return res.val; &#125; private void reversivion(TreeNode node, int depth) &#123; if(node == null) &#123; return; &#125; if(node != null &amp;&amp; max &lt; depth) &#123; max = depth; res = node; &#125; reversivion(node.left, depth + 1); reversivion(node.right, depth + 1); &#125;&#125;","categories":[{"name":"leetCodeç®—æ³•","slug":"leetCodeç®—æ³•","permalink":"http://fyupeng.github.io/categories/leetCode%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"å›žæº¯","slug":"å›žæº¯","permalink":"http://fyupeng.github.io/tags/%E5%9B%9E%E6%BA%AF/"}],"author":"fyupeng"},{"title":"é“¾è¡¨","slug":"é“¾è¡¨","date":"2022-06-25T06:44:53.000Z","updated":"2022-06-25T06:58:27.847Z","comments":true,"path":"2022/06/25/é“¾è¡¨/","link":"","permalink":"http://fyupeng.github.io/2022/06/25/%E9%93%BE%E8%A1%A8/","excerpt":"","text":"1.ç¿»è½¬é“¾è¡¨å‰‘æŒ‡ Offer II 024. åè½¬é“¾è¡¨ ç»™å®šå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œè¯·åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›žåè½¬åŽçš„é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šhead = [1,2,3,4,5]è¾“å‡ºï¼š[5,4,3,2,1] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šhead = [1,2]è¾“å‡ºï¼š[2,1] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šhead = []è¾“å‡ºï¼š[] æç¤ºï¼š é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [0, 5000] -5000 &lt;= Node.val &lt;= 5000 1.1 é€’å½’1234567891011121314151617181920212223class Solution &#123; public ListNode reverseList(ListNode head) &#123; return reverse(head); &#125; private ListNode reverse(ListNode head) &#123; // åˆ¤æ–­ å¤´ç»“ç‚¹ä¸´ç•Œ if(head == null) &#123; return head; &#125; // åˆ¤æ–­ å°¾ç»“ç‚¹ä¸´ç•Œ if(head.next == null) &#123; return head; &#125; ListNode last = reverse(head.next); // ç¿»è½¬å¤´ç»“ç‚¹ ä¸Ž ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘ head.next.next = head; // ç½® å¤´ç»“ç‚¹ çš„ next ä¸º null head.next = null; // è¿”å›ž æœ€åŽ ä¸€ä¸ªèŠ‚ç‚¹ return last; &#125;&#125; 1.2 åŒæŒ‡é’ˆ123456789101112131415161718192021class Solution &#123; public ListNode reverseList(ListNode head) &#123; // cur çš„ å‰ä¸€ä¸ª èŠ‚ç‚¹ ListNode prev = null; // å½“å‰èŠ‚ç‚¹ ListNode cur = head; // ä¿å­˜ ä¸´æ—¶èŠ‚ç‚¹ ListNode temp = null; while(cur != null) &#123; // ä¿å­˜ cur çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ temp = cur.next; // ç¿»è½¬ cur ä¸Ž prev èŠ‚ç‚¹çš„ nextæŒ‡å‘ cur.next = prev; // prev æ€»æ˜¯ cur çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ prev = cur; // cur å‘å‰ ç§»åŠ¨ 1ä½ cur = temp; &#125; return prev; &#125;&#125; 2. ä¸¤ä¸¤äº¤æ¢ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œä¸¤ä¸¤äº¤æ¢å…¶ä¸­ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›žäº¤æ¢åŽé“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚ä½ å¿…é¡»åœ¨ä¸ä¿®æ”¹èŠ‚ç‚¹å†…éƒ¨çš„å€¼çš„æƒ…å†µä¸‹å®Œæˆæœ¬é¢˜ï¼ˆå³ï¼Œåªèƒ½è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ï¼‰ã€‚ ç¤ºä¾‹1ï¼š 12è¾“å…¥ï¼šhead = [1,2,3,4]è¾“å‡ºï¼š[2,1,4,3] ç¤ºä¾‹2ï¼š 12è¾“å…¥ï¼šhead = []è¾“å‡ºï¼š[] ç¤ºä¾‹3ï¼š 12è¾“å…¥ï¼šhead = [1]è¾“å‡ºï¼š[1] æç¤ºï¼š é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [0, 100] å†… 0 &lt;= Node.val &lt;= 100 2.1 é€’å½’12345678910111213141516class Solution &#123; public ListNode swapPairs(ListNode head) &#123; // å¤„ç† å¤´ç»“ç‚¹ å’Œ å°¾ç»“ç‚¹ è¾¹ç•Œ if(head == null || head.next == null) &#123; return head; &#125; ListNode next = head.next; // é€’å½’ æ‹¿åˆ° å·²ç» ä¸¤ä¸¤ äº¤æ¢å¥½äº†çš„ nextçš„ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ListNode newSwapNode = swapPairs(next.next); // äº¤æ¢ head ä¸Ž next èŠ‚ç‚¹ çš„æŒ‡é’ˆæŒ‡å‘ next.next = head; // head èŠ‚ç‚¹ æŒ‡å‘ next å¾€åŽ å·²ç» ä¸¤ä¸¤äº¤æ¢ å¥½çš„ èŠ‚ç‚¹ head.next = newSwapNode; return next; &#125;&#125; 2.2 è™šæ‹Ÿå¤´ç»“ç‚¹123456789101112131415161718192021222324class Solution &#123; public ListNode swapPairs(ListNode head) &#123; // å“‘å…ƒèŠ‚ç‚¹ ListNode dumpNode = new ListNode(0); dumpNode.next = head; // åˆå§‹åŒ– å‰èŠ‚ç‚¹ ä¸º å“‘å…ƒ èŠ‚ç‚¹ ListNode prev = dumpNode; // å‡†å¤‡ ä¸¤ä¸ªè¦ äº¤æ¢çš„ èŠ‚ç‚¹ ä¸”ä¿è¯ ä¸èƒ½ä¸º ç©º while(head != null &amp;&amp; head.next != null) &#123; // ä¿å­˜ next çš„èŠ‚ç‚¹ çš„ åŽä¸€ä¸ª èŠ‚ç‚¹ // head ä¸Ž next äº¤æ¢åŽ ä¼šè®© å‰é¢å’ŒåŽé¢çš„ èŠ‚ç‚¹ ä¸¢å¤± ListNode temp = head.next.next; prev.next = head.next; // äº¤æ¢ ä¸¤ èŠ‚ç‚¹ å¹¶ è®© å¤´ç»“ç‚¹ ä¸Ž åŽé¢èŠ‚ç‚¹ è¿žæŽ¥ head.next.next = head; head.next = temp; // è‡ªå˜é‡ è‡ªå¢ž prev = head; head = head.next; &#125; // è¿”å›ž å“‘å…ƒèŠ‚ç‚¹ çš„ åŽä¸€ä¸ªèŠ‚ç‚¹ å³ head èŠ‚ç‚¹ return dumpNode.next; &#125;&#125; 3. åˆ é™¤å€’æ•°ç¬¬nèŠ‚ç‚¹19. åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹ ç»™ä½ ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ n ä¸ªç»“ç‚¹ï¼Œå¹¶ä¸”è¿”å›žé“¾è¡¨çš„å¤´ç»“ç‚¹ã€‚ ç¤ºä¾‹ 1ï¼š 12è¾“å…¥ï¼šhead = [1,2,3,4,5], n = 2è¾“å‡ºï¼š[1,2,3,5] ç¤ºä¾‹ 2ï¼š 12è¾“å…¥ï¼šhead = [1], n = 1è¾“å‡ºï¼š[] ç¤ºä¾‹ 3ï¼š 12è¾“å…¥ï¼šhead = [1,2], n = 1è¾“å‡ºï¼š[1] 3.1 æ•°å­¦123456789101112131415161718192021222324252627class Solution &#123; public ListNode removeNthFromEnd(ListNode head, int n) &#123; int length = getLenth(head); // è®¾ç½® å“‘å…ƒ èŠ‚ç‚¹ ListNode dummyNode = new ListNode(0); dummyNode.next = head; // å€’æ•° ç¬¬ n ä¸ª å³ é¡ºæ•° ç¬¬ length - (n - 1) ä¸ª // æ‰¾åˆ°ç¬¬ length - (n - 1) - 1ä¸ª, åˆ é™¤ å®ƒçš„ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ int num = length - (n - 1) - 1; ListNode prev = dummyNode; while(num &gt; 0) &#123; prev = prev.next; num -= 1; &#125; prev.next = prev.next.next; return dummyNode.next; &#125; private int getLenth(ListNode head) &#123; ListNode p = head; int length = 0; while(p != null) &#123; length++; p = p.next; &#125; return length; &#125;&#125; 3.2 åŒæŒ‡é’ˆ1234567891011121314151617181920212223class Solution &#123; public ListNode removeNthFromEnd(ListNode head, int n) &#123; ListNode dummyNode = new ListNode(0); dummyNode.next = head; ListNode fast = dummyNode; ListNode slow = dummyNode; // å¾ªçŽ¯ n - 1æ¬¡ï¼Œè®© fast æ¯” slow å…ˆ n - 1 ä¸ªèŠ‚ç‚¹ while(n &gt; 1) &#123; fast = fast.next; n--; &#125; ListNode prev = null; while(fast != null &amp;&amp; fast.next != null) &#123; prev = slow; fast = fast.next; slow = slow.next; &#125; prev.next = slow.next; slow.next = null; return dummyNode.next; &#125;&#125; 4. é“¾è¡¨ç›¸äº¤é¢è¯•é¢˜ 02.07. é“¾è¡¨ç›¸äº¤ ç»™ä½ ä¸¤ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ headA å’Œ headB ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å›žä¸¤ä¸ªå•é“¾è¡¨ç›¸äº¤çš„èµ·å§‹èŠ‚ç‚¹ã€‚å¦‚æžœä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰äº¤ç‚¹ï¼Œè¿”å›ž null ã€‚ é¢˜ç›®æ•°æ® ä¿è¯ æ•´ä¸ªé“¾å¼ç»“æž„ä¸­ä¸å­˜åœ¨çŽ¯ã€‚ æ³¨æ„ï¼Œå‡½æ•°è¿”å›žç»“æžœåŽï¼Œé“¾è¡¨å¿…é¡» ä¿æŒå…¶åŽŸå§‹ç»“æž„ ã€‚ ç¤ºä¾‹1ï¼š 12345è¾“å…¥ï¼šintersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5], skipA = 2, skipB = 3è¾“å‡ºï¼šIntersected at &#x27;8&#x27;è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æžœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»Žå„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º [5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹2ï¼š 12345è¾“å…¥ï¼šintersectVal = 2, listA = [0,9,1,2,4], listB = [3,2,4], skipA = 3, skipB = 1è¾“å‡ºï¼šIntersected at &#x27;2&#x27;è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æžœä¸¤ä¸ªé“¾è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º 0ï¼‰ã€‚ä»Žå„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹3ï¼š 12345è¾“å…¥ï¼šintersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3, skipB = 2è¾“å‡ºï¼šnullè§£é‡Šï¼šä»Žå„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºŽè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º 0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚è¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å›ž null ã€‚ æç¤ºï¼š listA ä¸­èŠ‚ç‚¹æ•°ç›®ä¸º mlistB ä¸­èŠ‚ç‚¹æ•°ç›®ä¸º n0 &lt;= m, n &lt;= 3 * 1041 &lt;= Node.val &lt;= 1050 &lt;= skipA &lt;= m0 &lt;= skipB &lt;= nå¦‚æžœ listA å’Œ listB æ²¡æœ‰äº¤ç‚¹ï¼ŒintersectVal ä¸º 0å¦‚æžœ listA å’Œ listB æœ‰äº¤ç‚¹ï¼ŒintersectVal == listA[skipA + 1] == listB[skipB + 1] 4.1 æŒ‡é’ˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445public class Solution &#123; public ListNode getIntersectionNode(ListNode headA, ListNode headB) &#123; // å®šä¹‰ é“¾è¡¨ A å’Œ Bçš„é•¿åº¦ int lenA = getLength(headA); int lenB = getLength(headB); // ä¸¤è¡¨é•¿åº¦ ä¹‹å·® int dfLenAB = lenA - lenB; // è®°å½• å½“å‰ èŠ‚ç‚¹ä½ç½® ListNode curA = headA; ListNode curB = headB; // A é•¿ Bï¼Œè®© è¾ƒé•¿çš„ éåŽ† ç›´åˆ° å½“å‰ä½ç½® åˆ° å°¾ç»“ç‚¹ ä¹‹é—´è·ç¦»ç›¸åŒ if(dfLenAB &gt;= 0) &#123; while(dfLenAB &gt; 0) &#123; curA = curA.next; dfLenAB--; &#125; &#125; else &#123; dfLenAB = -dfLenAB; while(dfLenAB &gt; 0) &#123; curB = curB.next; dfLenAB--; &#125; &#125; // åŒæ­¥ éåŽ†ï¼Œæ‰¾åˆ° ä¸€ä¸ª ç›¸åŒçš„èŠ‚ç‚¹ while(curA != null) &#123; if(curA == curB) &#123; return curA; &#125; curA = curA.next; curB = curB.next; &#125; // æ‰¾ä¸åˆ° è¿”å›ž null return null; &#125; private int getLength(ListNode head) &#123; ListNode p = head; int length = 0; while(p != null) &#123; length++; p = p.next; &#125; return length; &#125;&#125; 5. çŽ¯å½¢é“¾è¡¨141. çŽ¯å½¢é“¾è¡¨ ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ head ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰çŽ¯ã€‚ å¦‚æžœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿žç»­è·Ÿè¸ª next æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨çŽ¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„çŽ¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° pos æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿žæŽ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä»Ž 0 å¼€å§‹ï¼‰ã€‚æ³¨æ„ï¼špos ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®žé™…æƒ…å†µã€‚ å¦‚æžœé“¾è¡¨ä¸­å­˜åœ¨çŽ¯ ï¼Œåˆ™è¿”å›ž true ã€‚ å¦åˆ™ï¼Œè¿”å›ž false ã€‚ ç¤ºä¾‹1ï¼š 123è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1è¾“å‡ºï¼štrueè§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªçŽ¯ï¼Œå…¶å°¾éƒ¨è¿žæŽ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹2ï¼š 123è¾“å…¥ï¼šhead = [1,2], pos = 0è¾“å‡ºï¼štrueè§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªçŽ¯ï¼Œå…¶å°¾éƒ¨è¿žæŽ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚ ç¤ºä¾‹3ï¼š 123è¾“å…¥ï¼šhead = [1], pos = -1è¾“å‡ºï¼šfalseè§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰çŽ¯ã€‚ æç¤ºï¼š é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®èŒƒå›´æ˜¯ [0, 104] -105 &lt;= Node.val &lt;= 105 pos ä¸º -1 æˆ–è€…é“¾è¡¨ä¸­çš„ä¸€ä¸ª æœ‰æ•ˆç´¢å¼• ã€‚ 5.1 å¿«æ…¢æŒ‡é’ˆ1234567891011121314151617public class Solution &#123; public boolean hasCycle(ListNode head) &#123; if(head == null) &#123; return false; &#125; ListNode fast = head.next; ListNode slow = head; while(fast != null &amp;&amp; fast.next != null) &#123; fast = fast.next.next; slow = slow.next; if(fast == slow) &#123; return true; &#125; &#125; return false; &#125;&#125;","categories":[{"name":"leetCodeç®—æ³•","slug":"leetCodeç®—æ³•","permalink":"http://fyupeng.github.io/categories/leetCode%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"http://fyupeng.github.io/tags/%E9%93%BE%E8%A1%A8/"}],"author":"fyupeng"}],"categories":[{"name":"é¢ç»","slug":"é¢ç»","permalink":"http://fyupeng.github.io/categories/%E9%9D%A2%E7%BB%8F/"},{"name":"Javaç¬”è®°","slug":"Javaç¬”è®°","permalink":"http://fyupeng.github.io/categories/Java%E7%AC%94%E8%AE%B0/"},{"name":"leetCodeç®—æ³•","slug":"leetCodeç®—æ³•","permalink":"http://fyupeng.github.io/categories/leetCode%E7%AE%97%E6%B3%95/"},{"name":"Javaæ¡†æž¶","slug":"Javaæ¡†æž¶","permalink":"http://fyupeng.github.io/categories/Java%E6%A1%86%E6%9E%B6/"}],"tags":[{"name":"Javaé¢ç»","slug":"Javaé¢ç»","permalink":"http://fyupeng.github.io/tags/Java%E9%9D%A2%E7%BB%8F/"},{"name":"RPC","slug":"RPC","permalink":"http://fyupeng.github.io/tags/RPC/"},{"name":"JavaåŽŸç†","slug":"JavaåŽŸç†","permalink":"http://fyupeng.github.io/tags/Java%E5%8E%9F%E7%90%86/"},{"name":"è´ªå¿ƒç®—æ³•","slug":"è´ªå¿ƒç®—æ³•","permalink":"http://fyupeng.github.io/tags/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95/"},{"name":"Spring","slug":"Spring","permalink":"http://fyupeng.github.io/tags/Spring/"},{"name":"MVC","slug":"MVC","permalink":"http://fyupeng.github.io/tags/MVC/"},{"name":"MongoDB","slug":"MongoDB","permalink":"http://fyupeng.github.io/tags/MongoDB/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"http://fyupeng.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"JDBC","slug":"JDBC","permalink":"http://fyupeng.github.io/tags/JDBC/"},{"name":"Oracle","slug":"Oracle","permalink":"http://fyupeng.github.io/tags/Oracle/"},{"name":"MySQL","slug":"MySQL","permalink":"http://fyupeng.github.io/tags/MySQL/"},{"name":"é…ç½®","slug":"é…ç½®","permalink":"http://fyupeng.github.io/tags/%E9%85%8D%E7%BD%AE/"},{"name":"æ•°æ®åº“ã€Redis","slug":"æ•°æ®åº“ã€Redis","permalink":"http://fyupeng.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81Redis/"},{"name":"MySQLã€æ•°æ®åº“","slug":"MySQLã€æ•°æ®åº“","permalink":"http://fyupeng.github.io/tags/MySQL%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"juc","slug":"juc","permalink":"http://fyupeng.github.io/tags/juc/"},{"name":"jvm","slug":"jvm","permalink":"http://fyupeng.github.io/tags/jvm/"},{"name":"netty","slug":"netty","permalink":"http://fyupeng.github.io/tags/netty/"},{"name":"äºŒåˆ†æŸ¥æ‰¾","slug":"äºŒåˆ†æŸ¥æ‰¾","permalink":"http://fyupeng.github.io/tags/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/"},{"name":"äºŒå‰æ ‘","slug":"äºŒå‰æ ‘","permalink":"http://fyupeng.github.io/tags/%E4%BA%8C%E5%8F%89%E6%A0%91/"},{"name":"å›žæº¯","slug":"å›žæº¯","permalink":"http://fyupeng.github.io/tags/%E5%9B%9E%E6%BA%AF/"},{"name":"é“¾è¡¨","slug":"é“¾è¡¨","permalink":"http://fyupeng.github.io/tags/%E9%93%BE%E8%A1%A8/"}]}